(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();function ad(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Cf={exports:{}},Ql={};var C0;function v1(){if(C0)return Ql;C0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(i,o,c){var f=null;if(c!==void 0&&(f=""+c),o.key!==void 0&&(f=""+o.key),"key"in o){c={};for(var g in o)g!=="key"&&(c[g]=o[g])}else c=o;return o=c.ref,{$$typeof:a,type:i,key:f,ref:o!==void 0?o:null,props:c}}return Ql.Fragment=e,Ql.jsx=r,Ql.jsxs=r,Ql}var M0;function b1(){return M0||(M0=1,Cf.exports=v1()),Cf.exports}var d=b1(),Mf={exports:{}},pt={};var N0;function x1(){if(N0)return pt;N0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),T=Symbol.iterator;function S(q){return q===null||typeof q!="object"?null:(q=T&&q[T]||q["@@iterator"],typeof q=="function"?q:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,D={};function j(q,Q,be){this.props=q,this.context=Q,this.refs=D,this.updater=be||E}j.prototype.isReactComponent={},j.prototype.setState=function(q,Q){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,Q,"setState")},j.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function P(){}P.prototype=j.prototype;function F(q,Q,be){this.props=q,this.context=Q,this.refs=D,this.updater=be||E}var _=F.prototype=new P;_.constructor=F,M(_,j.prototype),_.isPureReactComponent=!0;var L=Array.isArray,I={H:null,A:null,T:null,S:null,V:null},V=Object.prototype.hasOwnProperty;function $(q,Q,be,ke,ve,_e){return be=_e.ref,{$$typeof:a,type:q,key:Q,ref:be!==void 0?be:null,props:_e}}function J(q,Q){return $(q.type,Q,void 0,void 0,void 0,q.props)}function ie(q){return typeof q=="object"&&q!==null&&q.$$typeof===a}function oe(q){var Q={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(be){return Q[be]})}var U=/\/+/g;function K(q,Q){return typeof q=="object"&&q!==null&&q.key!=null?oe(""+q.key):Q.toString(36)}function Z(){}function W(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(Z,Z):(q.status="pending",q.then(function(Q){q.status==="pending"&&(q.status="fulfilled",q.value=Q)},function(Q){q.status==="pending"&&(q.status="rejected",q.reason=Q)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function re(q,Q,be,ke,ve){var _e=typeof q;(_e==="undefined"||_e==="boolean")&&(q=null);var Oe=!1;if(q===null)Oe=!0;else switch(_e){case"bigint":case"string":case"number":Oe=!0;break;case"object":switch(q.$$typeof){case a:case e:Oe=!0;break;case x:return Oe=q._init,re(Oe(q._payload),Q,be,ke,ve)}}if(Oe)return ve=ve(q),Oe=ke===""?"."+K(q,0):ke,L(ve)?(be="",Oe!=null&&(be=Oe.replace(U,"$&/")+"/"),re(ve,Q,be,"",function(Je){return Je})):ve!=null&&(ie(ve)&&(ve=J(ve,be+(ve.key==null||q&&q.key===ve.key?"":(""+ve.key).replace(U,"$&/")+"/")+Oe)),Q.push(ve)),1;Oe=0;var We=ke===""?".":ke+":";if(L(q))for(var Ye=0;Ye<q.length;Ye++)ke=q[Ye],_e=We+K(ke,Ye),Oe+=re(ke,Q,be,_e,ve);else if(Ye=S(q),typeof Ye=="function")for(q=Ye.call(q),Ye=0;!(ke=q.next()).done;)ke=ke.value,_e=We+K(ke,Ye++),Oe+=re(ke,Q,be,_e,ve);else if(_e==="object"){if(typeof q.then=="function")return re(W(q),Q,be,ke,ve);throw Q=String(q),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return Oe}function Y(q,Q,be){if(q==null)return q;var ke=[],ve=0;return re(q,ke,"","",function(_e){return Q.call(be,_e,ve++)}),ke}function ee(q){if(q._status===-1){var Q=q._result;Q=Q(),Q.then(function(be){(q._status===0||q._status===-1)&&(q._status=1,q._result=be)},function(be){(q._status===0||q._status===-1)&&(q._status=2,q._result=be)}),q._status===-1&&(q._status=0,q._result=Q)}if(q._status===1)return q._result.default;throw q._result}var ue=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)};function Ee(){}return pt.Children={map:Y,forEach:function(q,Q,be){Y(q,function(){Q.apply(this,arguments)},be)},count:function(q){var Q=0;return Y(q,function(){Q++}),Q},toArray:function(q){return Y(q,function(Q){return Q})||[]},only:function(q){if(!ie(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},pt.Component=j,pt.Fragment=r,pt.Profiler=o,pt.PureComponent=F,pt.StrictMode=i,pt.Suspense=m,pt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,pt.__COMPILER_RUNTIME={__proto__:null,c:function(q){return I.H.useMemoCache(q)}},pt.cache=function(q){return function(){return q.apply(null,arguments)}},pt.cloneElement=function(q,Q,be){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var ke=M({},q.props),ve=q.key,_e=void 0;if(Q!=null)for(Oe in Q.ref!==void 0&&(_e=void 0),Q.key!==void 0&&(ve=""+Q.key),Q)!V.call(Q,Oe)||Oe==="key"||Oe==="__self"||Oe==="__source"||Oe==="ref"&&Q.ref===void 0||(ke[Oe]=Q[Oe]);var Oe=arguments.length-2;if(Oe===1)ke.children=be;else if(1<Oe){for(var We=Array(Oe),Ye=0;Ye<Oe;Ye++)We[Ye]=arguments[Ye+2];ke.children=We}return $(q.type,ve,void 0,void 0,_e,ke)},pt.createContext=function(q){return q={$$typeof:f,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:c,_context:q},q},pt.createElement=function(q,Q,be){var ke,ve={},_e=null;if(Q!=null)for(ke in Q.key!==void 0&&(_e=""+Q.key),Q)V.call(Q,ke)&&ke!=="key"&&ke!=="__self"&&ke!=="__source"&&(ve[ke]=Q[ke]);var Oe=arguments.length-2;if(Oe===1)ve.children=be;else if(1<Oe){for(var We=Array(Oe),Ye=0;Ye<Oe;Ye++)We[Ye]=arguments[Ye+2];ve.children=We}if(q&&q.defaultProps)for(ke in Oe=q.defaultProps,Oe)ve[ke]===void 0&&(ve[ke]=Oe[ke]);return $(q,_e,void 0,void 0,null,ve)},pt.createRef=function(){return{current:null}},pt.forwardRef=function(q){return{$$typeof:g,render:q}},pt.isValidElement=ie,pt.lazy=function(q){return{$$typeof:x,_payload:{_status:-1,_result:q},_init:ee}},pt.memo=function(q,Q){return{$$typeof:v,type:q,compare:Q===void 0?null:Q}},pt.startTransition=function(q){var Q=I.T,be={};I.T=be;try{var ke=q(),ve=I.S;ve!==null&&ve(be,ke),typeof ke=="object"&&ke!==null&&typeof ke.then=="function"&&ke.then(Ee,ue)}catch(_e){ue(_e)}finally{I.T=Q}},pt.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},pt.use=function(q){return I.H.use(q)},pt.useActionState=function(q,Q,be){return I.H.useActionState(q,Q,be)},pt.useCallback=function(q,Q){return I.H.useCallback(q,Q)},pt.useContext=function(q){return I.H.useContext(q)},pt.useDebugValue=function(){},pt.useDeferredValue=function(q,Q){return I.H.useDeferredValue(q,Q)},pt.useEffect=function(q,Q,be){var ke=I.H;if(typeof be=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ke.useEffect(q,Q)},pt.useId=function(){return I.H.useId()},pt.useImperativeHandle=function(q,Q,be){return I.H.useImperativeHandle(q,Q,be)},pt.useInsertionEffect=function(q,Q){return I.H.useInsertionEffect(q,Q)},pt.useLayoutEffect=function(q,Q){return I.H.useLayoutEffect(q,Q)},pt.useMemo=function(q,Q){return I.H.useMemo(q,Q)},pt.useOptimistic=function(q,Q){return I.H.useOptimistic(q,Q)},pt.useReducer=function(q,Q,be){return I.H.useReducer(q,Q,be)},pt.useRef=function(q){return I.H.useRef(q)},pt.useState=function(q){return I.H.useState(q)},pt.useSyncExternalStore=function(q,Q,be){return I.H.useSyncExternalStore(q,Q,be)},pt.useTransition=function(){return I.H.useTransition()},pt.version="19.1.1",pt}var k0;function rd(){return k0||(k0=1,Mf.exports=x1()),Mf.exports}var R=rd();const Yn=ad(R);var Nf={exports:{}},Kl={},kf={exports:{}},Rf={};var R0;function S1(){return R0||(R0=1,(function(a){function e(Y,ee){var ue=Y.length;Y.push(ee);e:for(;0<ue;){var Ee=ue-1>>>1,q=Y[Ee];if(0<o(q,ee))Y[Ee]=ee,Y[ue]=q,ue=Ee;else break e}}function r(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var ee=Y[0],ue=Y.pop();if(ue!==ee){Y[0]=ue;e:for(var Ee=0,q=Y.length,Q=q>>>1;Ee<Q;){var be=2*(Ee+1)-1,ke=Y[be],ve=be+1,_e=Y[ve];if(0>o(ke,ue))ve<q&&0>o(_e,ke)?(Y[Ee]=_e,Y[ve]=ue,Ee=ve):(Y[Ee]=ke,Y[be]=ue,Ee=be);else if(ve<q&&0>o(_e,ue))Y[Ee]=_e,Y[ve]=ue,Ee=ve;else break e}}return ee}function o(Y,ee){var ue=Y.sortIndex-ee.sortIndex;return ue!==0?ue:Y.id-ee.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;a.unstable_now=function(){return c.now()}}else{var f=Date,g=f.now();a.unstable_now=function(){return f.now()-g}}var m=[],v=[],x=1,T=null,S=3,E=!1,M=!1,D=!1,j=!1,P=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function L(Y){for(var ee=r(v);ee!==null;){if(ee.callback===null)i(v);else if(ee.startTime<=Y)i(v),ee.sortIndex=ee.expirationTime,e(m,ee);else break;ee=r(v)}}function I(Y){if(D=!1,L(Y),!M)if(r(m)!==null)M=!0,V||(V=!0,K());else{var ee=r(v);ee!==null&&re(I,ee.startTime-Y)}}var V=!1,$=-1,J=5,ie=-1;function oe(){return j?!0:!(a.unstable_now()-ie<J)}function U(){if(j=!1,V){var Y=a.unstable_now();ie=Y;var ee=!0;try{e:{M=!1,D&&(D=!1,F($),$=-1),E=!0;var ue=S;try{t:{for(L(Y),T=r(m);T!==null&&!(T.expirationTime>Y&&oe());){var Ee=T.callback;if(typeof Ee=="function"){T.callback=null,S=T.priorityLevel;var q=Ee(T.expirationTime<=Y);if(Y=a.unstable_now(),typeof q=="function"){T.callback=q,L(Y),ee=!0;break t}T===r(m)&&i(m),L(Y)}else i(m);T=r(m)}if(T!==null)ee=!0;else{var Q=r(v);Q!==null&&re(I,Q.startTime-Y),ee=!1}}break e}finally{T=null,S=ue,E=!1}ee=void 0}}finally{ee?K():V=!1}}}var K;if(typeof _=="function")K=function(){_(U)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,W=Z.port2;Z.port1.onmessage=U,K=function(){W.postMessage(null)}}else K=function(){P(U,0)};function re(Y,ee){$=P(function(){Y(a.unstable_now())},ee)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(Y){Y.callback=null},a.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<Y?Math.floor(1e3/Y):5},a.unstable_getCurrentPriorityLevel=function(){return S},a.unstable_next=function(Y){switch(S){case 1:case 2:case 3:var ee=3;break;default:ee=S}var ue=S;S=ee;try{return Y()}finally{S=ue}},a.unstable_requestPaint=function(){j=!0},a.unstable_runWithPriority=function(Y,ee){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var ue=S;S=Y;try{return ee()}finally{S=ue}},a.unstable_scheduleCallback=function(Y,ee,ue){var Ee=a.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?Ee+ue:Ee):ue=Ee,Y){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=ue+q,Y={id:x++,callback:ee,priorityLevel:Y,startTime:ue,expirationTime:q,sortIndex:-1},ue>Ee?(Y.sortIndex=ue,e(v,Y),r(m)===null&&Y===r(v)&&(D?(F($),$=-1):D=!0,re(I,ue-Ee))):(Y.sortIndex=q,e(m,Y),M||E||(M=!0,V||(V=!0,K()))),Y},a.unstable_shouldYield=oe,a.unstable_wrapCallback=function(Y){var ee=S;return function(){var ue=S;S=ee;try{return Y.apply(this,arguments)}finally{S=ue}}}})(Rf)),Rf}var D0;function E1(){return D0||(D0=1,kf.exports=S1()),kf.exports}var Df={exports:{}},Qn={};var _0;function w1(){if(_0)return Qn;_0=1;var a=rd();function e(m){var v="https://react.dev/errors/"+m;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)v+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+m+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},o=Symbol.for("react.portal");function c(m,v,x){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:T==null?null:""+T,children:m,containerInfo:v,implementation:x}}var f=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(m,v){if(m==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return Qn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Qn.createPortal=function(m,v){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(e(299));return c(m,v,null,x)},Qn.flushSync=function(m){var v=f.T,x=i.p;try{if(f.T=null,i.p=2,m)return m()}finally{f.T=v,i.p=x,i.d.f()}},Qn.preconnect=function(m,v){typeof m=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,i.d.C(m,v))},Qn.prefetchDNS=function(m){typeof m=="string"&&i.d.D(m)},Qn.preinit=function(m,v){if(typeof m=="string"&&v&&typeof v.as=="string"){var x=v.as,T=g(x,v.crossOrigin),S=typeof v.integrity=="string"?v.integrity:void 0,E=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;x==="style"?i.d.S(m,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:T,integrity:S,fetchPriority:E}):x==="script"&&i.d.X(m,{crossOrigin:T,integrity:S,fetchPriority:E,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},Qn.preinitModule=function(m,v){if(typeof m=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var x=g(v.as,v.crossOrigin);i.d.M(m,{crossOrigin:x,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&i.d.M(m)},Qn.preload=function(m,v){if(typeof m=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var x=v.as,T=g(x,v.crossOrigin);i.d.L(m,x,{crossOrigin:T,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},Qn.preloadModule=function(m,v){if(typeof m=="string")if(v){var x=g(v.as,v.crossOrigin);i.d.m(m,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:x,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else i.d.m(m)},Qn.requestFormReset=function(m){i.d.r(m)},Qn.unstable_batchedUpdates=function(m,v){return m(v)},Qn.useFormState=function(m,v,x){return f.H.useFormState(m,v,x)},Qn.useFormStatus=function(){return f.H.useHostTransitionStatus()},Qn.version="19.1.1",Qn}var O0;function Pm(){if(O0)return Df.exports;O0=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Df.exports=w1(),Df.exports}var I0;function A1(){if(I0)return Kl;I0=1;var a=E1(),e=rd(),r=Pm();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,l=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(l=s.return),n=s.return;while(n)}return s.tag===3?l:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function g(n){if(c(n)!==n)throw Error(i(188))}function m(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var l=n,u=s;;){var h=l.return;if(h===null)break;var y=h.alternate;if(y===null){if(u=h.return,u!==null){l=u;continue}break}if(h.child===y.child){for(y=h.child;y;){if(y===l)return g(h),n;if(y===u)return g(h),s;y=y.sibling}throw Error(i(188))}if(l.return!==u.return)l=h,u=y;else{for(var k=!1,B=h.child;B;){if(B===l){k=!0,l=h,u=y;break}if(B===u){k=!0,u=h,l=y;break}B=B.sibling}if(!k){for(B=y.child;B;){if(B===l){k=!0,l=y,u=h;break}if(B===u){k=!0,u=y,l=h;break}B=B.sibling}if(!k)throw Error(i(189))}}if(l.alternate!==u)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?n:s}function v(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=v(n),s!==null)return s;n=n.sibling}return null}var x=Object.assign,T=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),F=Symbol.for("react.consumer"),_=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ie=Symbol.for("react.activity"),oe=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function K(n){return n===null||typeof n!="object"?null:(n=U&&n[U]||n["@@iterator"],typeof n=="function"?n:null)}var Z=Symbol.for("react.client.reference");function W(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===Z?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case M:return"Fragment";case j:return"Profiler";case D:return"StrictMode";case I:return"Suspense";case V:return"SuspenseList";case ie:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case E:return"Portal";case _:return(n.displayName||"Context")+".Provider";case F:return(n._context.displayName||"Context")+".Consumer";case L:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case $:return s=n.displayName||null,s!==null?s:W(n.type)||"Memo";case J:s=n._payload,n=n._init;try{return W(n(s))}catch{}}return null}var re=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ue={pending:!1,data:null,method:null,action:null},Ee=[],q=-1;function Q(n){return{current:n}}function be(n){0>q||(n.current=Ee[q],Ee[q]=null,q--)}function ke(n,s){q++,Ee[q]=n.current,n.current=s}var ve=Q(null),_e=Q(null),Oe=Q(null),We=Q(null);function Ye(n,s){switch(ke(Oe,s),ke(_e,n),ke(ve,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?e0(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=e0(s),n=t0(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}be(ve),ke(ve,n)}function Je(){be(ve),be(_e),be(Oe)}function yn(n){n.memoizedState!==null&&ke(We,n);var s=ve.current,l=t0(s,n.type);s!==l&&(ke(_e,n),ke(ve,l))}function _t(n){_e.current===n&&(be(ve),be(_e)),We.current===n&&(be(We),Vl._currentValue=ue)}var vn=Object.prototype.hasOwnProperty,Wt=a.unstable_scheduleCallback,Kt=a.unstable_cancelCallback,je=a.unstable_shouldYield,$e=a.unstable_requestPaint,Ie=a.unstable_now,nt=a.unstable_getCurrentPriorityLevel,Ue=a.unstable_ImmediatePriority,xe=a.unstable_UserBlockingPriority,Ze=a.unstable_NormalPriority,Zt=a.unstable_LowPriority,fn=a.unstable_IdlePriority,Et=a.log,it=a.unstable_setDisableYieldValue,qn=null,Xt=null;function Nn(n){if(typeof Et=="function"&&it(n),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(qn,n)}catch{}}var dn=Math.clz32?Math.clz32:nr,us=Math.log,tr=Math.LN2;function nr(n){return n>>>=0,n===0?32:31-(us(n)/tr|0)|0}var rn=256,ar=4194304;function bn(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Ve(n,s,l){var u=n.pendingLanes;if(u===0)return 0;var h=0,y=n.suspendedLanes,k=n.pingedLanes;n=n.warmLanes;var B=u&134217727;return B!==0?(u=B&~y,u!==0?h=bn(u):(k&=B,k!==0?h=bn(k):l||(l=B&~n,l!==0&&(h=bn(l))))):(B=u&~y,B!==0?h=bn(B):k!==0?h=bn(k):l||(l=u&~n,l!==0&&(h=bn(l)))),h===0?0:s!==0&&s!==h&&(s&y)===0&&(y=h&-h,l=s&-s,y>=l||y===32&&(l&4194048)!==0)?s:h}function lt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Vs(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jn(){var n=rn;return rn<<=1,(rn&4194048)===0&&(rn=256),n}function ea(){var n=ar;return ar<<=1,(ar&62914560)===0&&(ar=4194304),n}function rr(n){for(var s=[],l=0;31>l;l++)s.push(n);return s}function la(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Pa(n,s,l,u,h,y){var k=n.pendingLanes;n.pendingLanes=l,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=l,n.entangledLanes&=l,n.errorRecoveryDisabledLanes&=l,n.shellSuspendCounter=0;var B=n.entanglements,te=n.expirationTimes,de=n.hiddenUpdates;for(l=k&~l;0<l;){var Ae=31-dn(l),Ne=1<<Ae;B[Ae]=0,te[Ae]=-1;var me=de[Ae];if(me!==null)for(de[Ae]=null,Ae=0;Ae<me.length;Ae++){var ge=me[Ae];ge!==null&&(ge.lane&=-536870913)}l&=~Ne}u!==0&&Sa(n,u,0),y!==0&&h===0&&n.tag!==0&&(n.suspendedLanes|=y&~(k&~s))}function Sa(n,s,l){n.pendingLanes|=s,n.suspendedLanes&=~s;var u=31-dn(s);n.entangledLanes|=s,n.entanglements[u]=n.entanglements[u]|1073741824|l&4194090}function Ea(n,s){var l=n.entangledLanes|=s;for(n=n.entanglements;l;){var u=31-dn(l),h=1<<u;h&s|n[u]&s&&(n[u]|=s),l&=~h}}function oa(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function jn(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function ca(){var n=ee.p;return n!==0?n:(n=window.event,n===void 0?32:x0(n.type))}function ua(n,s){var l=ee.p;try{return ee.p=n,s()}finally{ee.p=l}}var fa=Math.random().toString(36).slice(2),sn="__reactFiber$"+fa,Gt="__reactProps$"+fa,Dt="__reactContainer$"+fa,wa="__reactEvents$"+fa,ot="__reactListeners$"+fa,Xs="__reactHandles$"+fa,Br="__reactResources$"+fa,Aa="__reactMarker$"+fa;function sr(n){delete n[sn],delete n[Gt],delete n[wa],delete n[ot],delete n[Xs]}function Jt(n){var s=n[sn];if(s)return s;for(var l=n.parentNode;l;){if(s=l[Dt]||l[sn]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(n=s0(n);n!==null;){if(l=n[sn])return l;n=s0(n)}return s}n=l,l=n.parentNode}return null}function xn(n){if(n=n[sn]||n[Dt]){var s=n.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return n}return null}function vt(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function dt(n){var s=n[Br];return s||(s=n[Br]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ct(n){n[Aa]=!0}var At=new Set,qe={};function ft(n,s){da(n,s),da(n+"Capture",s)}function da(n,s){for(qe[n]=s,n=0;n<s.length;n++)At.add(s[n])}var Ta=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),br={},en={};function kn(n){return vn.call(en,n)?!0:vn.call(br,n)?!1:Ta.test(n)?en[n]=!0:(br[n]=!0,!1)}function Ca(n,s,l){if(kn(s))if(l===null)n.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+l)}}function ta(n,s,l){if(l===null)n.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+l)}}function Vn(n,s,l,u){if(u===null)n.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(l);return}n.setAttributeNS(s,l,""+u)}}var pa,xr;function Bn(n){if(pa===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);pa=s&&s[1]||"",xr=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+pa+n+xr}var ha=!1;function Ut(n,s){if(!n||ha)return"";ha=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(ge){var me=ge}Reflect.construct(n,[],Ne)}else{try{Ne.call()}catch(ge){me=ge}n.call(Ne.prototype)}}else{try{throw Error()}catch(ge){me=ge}(Ne=n())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(ge){if(ge&&me&&typeof ge.stack=="string")return[ge.stack,me.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=u.DetermineComponentFrameRoot(),k=y[0],B=y[1];if(k&&B){var te=k.split(`
`),de=B.split(`
`);for(h=u=0;u<te.length&&!te[u].includes("DetermineComponentFrameRoot");)u++;for(;h<de.length&&!de[h].includes("DetermineComponentFrameRoot");)h++;if(u===te.length||h===de.length)for(u=te.length-1,h=de.length-1;1<=u&&0<=h&&te[u]!==de[h];)h--;for(;1<=u&&0<=h;u--,h--)if(te[u]!==de[h]){if(u!==1||h!==1)do if(u--,h--,0>h||te[u]!==de[h]){var Ae=`
`+te[u].replace(" at new "," at ");return n.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",n.displayName)),Ae}while(1<=u&&0<=h);break}}}finally{ha=!1,Error.prepareStackTrace=l}return(l=n?n.displayName||n.name:"")?Bn(l):""}function na(n){switch(n.tag){case 26:case 27:case 5:return Bn(n.type);case 16:return Bn("Lazy");case 13:return Bn("Suspense");case 19:return Bn("SuspenseList");case 0:case 15:return Ut(n.type,!1);case 11:return Ut(n.type.render,!1);case 1:return Ut(n.type,!0);case 31:return Bn("Activity");default:return""}}function Sr(n){try{var s="";do s+=na(n),n=n.return;while(n);return s}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function ln(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ma(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function $s(n){var s=Ma(n)?"checked":"value",l=Object.getOwnPropertyDescriptor(n.constructor.prototype,s),u=""+n[s];if(!n.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var h=l.get,y=l.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return h.call(this)},set:function(k){u=""+k,y.call(this,k)}}),Object.defineProperty(n,s,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(k){u=""+k},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Er(n){n._valueTracker||(n._valueTracker=$s(n))}function za(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var l=s.getValue(),u="";return n&&(u=Ma(n)?n.checked?"true":"false":n.value),n=u,n!==l?(s.setValue(n),!0):!1}function Fr(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var wr=/[\n"\\]/g;function Rn(n){return n.replace(wr,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Ws(n,s,l,u,h,y,k,B){n.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?n.type=k:n.removeAttribute("type"),s!=null?k==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+ln(s)):n.value!==""+ln(s)&&(n.value=""+ln(s)):k!=="submit"&&k!=="reset"||n.removeAttribute("value"),s!=null?Na(n,k,ln(s)):l!=null?Na(n,k,ln(l)):u!=null&&n.removeAttribute("value"),h==null&&y!=null&&(n.defaultChecked=!!y),h!=null&&(n.checked=h&&typeof h!="function"&&typeof h!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?n.name=""+ln(B):n.removeAttribute("name")}function Zs(n,s,l,u,h,y,k,B){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(n.type=y),s!=null||l!=null){if(!(y!=="submit"&&y!=="reset"||s!=null))return;l=l!=null?""+ln(l):"",s=s!=null?""+ln(s):l,B||s===n.value||(n.value=s),n.defaultValue=s}u=u??h,u=typeof u!="function"&&typeof u!="symbol"&&!!u,n.checked=B?n.checked:!!u,n.defaultChecked=!!u,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(n.name=k)}function Na(n,s,l){s==="number"&&Fr(n.ownerDocument)===n||n.defaultValue===""+l||(n.defaultValue=""+l)}function Ga(n,s,l,u){if(n=n.options,s){s={};for(var h=0;h<l.length;h++)s["$"+l[h]]=!0;for(l=0;l<n.length;l++)h=s.hasOwnProperty("$"+n[l].value),n[l].selected!==h&&(n[l].selected=h),h&&u&&(n[l].defaultSelected=!0)}else{for(l=""+ln(l),s=null,h=0;h<n.length;h++){if(n[h].value===l){n[h].selected=!0,u&&(n[h].defaultSelected=!0);return}s!==null||n[h].disabled||(s=n[h])}s!==null&&(s.selected=!0)}}function fs(n,s,l){if(s!=null&&(s=""+ln(s),s!==n.value&&(n.value=s),l==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=l!=null?""+ln(l):""}function Pr(n,s,l,u){if(s==null){if(u!=null){if(l!=null)throw Error(i(92));if(re(u)){if(1<u.length)throw Error(i(93));u=u[0]}l=u}l==null&&(l=""),s=l}l=ln(s),n.defaultValue=l,u=n.textContent,u===l&&u!==""&&u!==null&&(n.value=u)}function ka(n,s){if(s){var l=n.firstChild;if(l&&l===n.lastChild&&l.nodeType===3){l.nodeValue=s;return}}n.textContent=s}var ma=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function aa(n,s,l){var u=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":u?n.setProperty(s,l):typeof l!="number"||l===0||ma.has(s)?s==="float"?n.cssFloat=l:n[s]=(""+l).trim():n[s]=l+"px"}function Qs(n,s,l){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?n.setProperty(u,""):u==="float"?n.cssFloat="":n[u]="");for(var h in s)u=s[h],s.hasOwnProperty(h)&&l[h]!==u&&aa(n,h,u)}else for(var y in s)s.hasOwnProperty(y)&&aa(n,y,s[y])}function Ar(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ds=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),cl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zr(n){return cl.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var ps=null;function tn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ir=null,ra=null;function Ks(n){var s=xn(n);if(s&&(n=s.stateNode)){var l=n[Gt]||null;e:switch(n=s.stateNode,s.type){case"input":if(Ws(n,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=n;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Rn(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var u=l[s];if(u!==n&&u.form===n.form){var h=u[Gt]||null;if(!h)throw Error(i(90));Ws(u,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(s=0;s<l.length;s++)u=l[s],u.form===n.form&&za(u)}break e;case"textarea":fs(n,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&Ga(n,!!l.multiple,s,!1)}}}var Js=!1;function Ei(n,s,l){if(Js)return n(s,l);Js=!0;try{var u=n(s);return u}finally{if(Js=!1,(ir!==null||ra!==null)&&(Wo(),ir&&(s=ir,n=ra,ra=ir=null,Ks(s),n)))for(s=0;s<n.length;s++)Ks(n[s])}}function Gr(n,s){var l=n.stateNode;if(l===null)return null;var u=l[Gt]||null;if(u===null)return null;l=u[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break e;default:n=!1}if(n)return null;if(l&&typeof l!="function")throw Error(i(231,s,typeof l));return l}var Dn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sa=!1;if(Dn)try{var Xn={};Object.defineProperty(Xn,"passive",{get:function(){sa=!0}}),window.addEventListener("test",Xn,Xn),window.removeEventListener("test",Xn,Xn)}catch{sa=!1}var Fn=null,Ha=null,Ya=null;function hs(){if(Ya)return Ya;var n,s=Ha,l=s.length,u,h="value"in Fn?Fn.value:Fn.textContent,y=h.length;for(n=0;n<l&&s[n]===h[n];n++);var k=l-n;for(u=1;u<=k&&s[l-u]===h[y-u];u++);return Ya=h.slice(n,1<u?1-u:void 0)}function qa(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function ms(){return!0}function Va(){return!1}function Sn(n){function s(l,u,h,y,k){this._reactName=l,this._targetInst=h,this.type=u,this.nativeEvent=y,this.target=k,this.currentTarget=null;for(var B in n)n.hasOwnProperty(B)&&(l=n[B],this[B]=l?l(y):y[B]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?ms:Va,this.isPropagationStopped=Va,this}return x(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ms)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ms)},persist:function(){},isPersistent:ms}),s}var lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hr=Sn(lr),Tr=x({},lr,{view:0,detail:0}),_n=Sn(Tr),gs,Yr,Cr,Mr=x({},Tr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:N,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Cr&&(Cr&&n.type==="mousemove"?(gs=n.screenX-Cr.screenX,Yr=n.screenY-Cr.screenY):Yr=gs=0,Cr=n),gs)},movementY:function(n){return"movementY"in n?n.movementY:Yr}}),wi=Sn(Mr),$n=x({},Mr,{dataTransfer:0}),qr=Sn($n),Ai=x({},Tr,{relatedTarget:0}),Vr=Sn(Ai),ys=x({},lr,{animationName:0,elapsedTime:0,pseudoElement:0}),ul=Sn(ys),Ra=x({},lr,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),vs=Sn(Ra),fl=x({},lr,{data:0}),p=Sn(fl),b={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},w={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function C(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=w[n])?!!s[n]:!1}function N(){return C}var O=x({},Tr,{key:function(n){if(n.key){var s=b[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=qa(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?A[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:N,charCode:function(n){return n.type==="keypress"?qa(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?qa(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),X=Sn(O),z=x({},Mr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),H=Sn(z),G=x({},Tr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:N}),ne=Sn(G),ae=x({},lr,{propertyName:0,elapsedTime:0,pseudoElement:0}),le=Sn(ae),he=x({},Mr,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),pe=Sn(he),Se=x({},lr,{newState:0,oldState:0}),Me=Sn(Se),we=[9,13,27,32],Re=Dn&&"CompositionEvent"in window,Pe=null;Dn&&"documentMode"in document&&(Pe=document.documentMode);var et=Dn&&"TextEvent"in window&&!Pe,ct=Dn&&(!Re||Pe&&8<Pe&&11>=Pe),mt=" ",ht=!1;function st(n,s){switch(n){case"keyup":return we.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tn(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ot=!1;function Nt(n,s){switch(n){case"compositionend":return Tn(s);case"keypress":return s.which!==32?null:(ht=!0,mt);case"textInput":return n=s.data,n===mt&&ht?null:n;default:return null}}function wt(n,s){if(Ot)return n==="compositionend"||!Re&&st(n,s)?(n=hs(),Ya=Ha=Fn=null,Ot=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ct&&s.locale!=="ko"?null:s.data;default:return null}}var Mt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nn(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Mt[n.type]:s==="textarea"}function Ht(n,s,l,u){ir?ra?ra.push(u):ra=[u]:ir=u,s=tc(s,"onChange"),0<s.length&&(l=new Hr("onChange","change",null,l,u),n.push({event:l,listeners:s}))}var gt=null,Yt=null;function Pn(n){Wh(n,0)}function Xa(n){var s=vt(n);if(za(s))return n}function Nr(n,s){if(n==="change")return s}var pn=!1;if(Dn){var ut;if(Dn){var ga="oninput"in document;if(!ga){var Wn=document.createElement("div");Wn.setAttribute("oninput","return;"),ga=typeof Wn.oninput=="function"}ut=ga}else ut=!1;pn=ut&&(!document.documentMode||9<document.documentMode)}function ya(){gt&&(gt.detachEvent("onpropertychange",Ti),Yt=gt=null)}function Ti(n){if(n.propertyName==="value"&&Xa(Yt)){var s=[];Ht(s,Yt,n,tn(n)),Ei(Pn,s)}}function Xr(n,s,l){n==="focusin"?(ya(),gt=s,Yt=l,gt.attachEvent("onpropertychange",Ti)):n==="focusout"&&ya()}function or(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Xa(Yt)}function ei(n,s){if(n==="click")return Xa(s)}function Uc(n,s){if(n==="input"||n==="change")return Xa(s)}function cr(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var qt=typeof Object.is=="function"?Object.is:cr;function dl(n,s){if(qt(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var l=Object.keys(n),u=Object.keys(s);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var h=l[u];if(!vn.call(s,h)||!qt(n[h],s[h]))return!1}return!0}function Sd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ed(n,s){var l=Sd(n);n=0;for(var u;l;){if(l.nodeType===3){if(u=n+l.textContent.length,n<=s&&u>=s)return{node:l,offset:s-n};n=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Sd(l)}}function wd(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?wd(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Ad(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=Fr(n.document);s instanceof n.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)n=s.contentWindow;else break;s=Fr(n.document)}return s}function jc(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var Jg=Dn&&"documentMode"in document&&11>=document.documentMode,Ci=null,Bc=null,pl=null,Fc=!1;function Td(n,s,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Fc||Ci==null||Ci!==Fr(u)||(u=Ci,"selectionStart"in u&&jc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),pl&&dl(pl,u)||(pl=u,u=tc(Bc,"onSelect"),0<u.length&&(s=new Hr("onSelect","select",null,s,l),n.push({event:s,listeners:u}),s.target=Ci)))}function ti(n,s){var l={};return l[n.toLowerCase()]=s.toLowerCase(),l["Webkit"+n]="webkit"+s,l["Moz"+n]="moz"+s,l}var Mi={animationend:ti("Animation","AnimationEnd"),animationiteration:ti("Animation","AnimationIteration"),animationstart:ti("Animation","AnimationStart"),transitionrun:ti("Transition","TransitionRun"),transitionstart:ti("Transition","TransitionStart"),transitioncancel:ti("Transition","TransitionCancel"),transitionend:ti("Transition","TransitionEnd")},Pc={},Cd={};Dn&&(Cd=document.createElement("div").style,"AnimationEvent"in window||(delete Mi.animationend.animation,delete Mi.animationiteration.animation,delete Mi.animationstart.animation),"TransitionEvent"in window||delete Mi.transitionend.transition);function ni(n){if(Pc[n])return Pc[n];if(!Mi[n])return n;var s=Mi[n],l;for(l in s)if(s.hasOwnProperty(l)&&l in Cd)return Pc[n]=s[l];return n}var Md=ni("animationend"),Nd=ni("animationiteration"),kd=ni("animationstart"),ey=ni("transitionrun"),ty=ni("transitionstart"),ny=ni("transitioncancel"),Rd=ni("transitionend"),Dd=new Map,zc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zc.push("scrollEnd");function ur(n,s){Dd.set(n,s),ft(s,[n])}var _d=new WeakMap;function $a(n,s){if(typeof n=="object"&&n!==null){var l=_d.get(n);return l!==void 0?l:(s={value:n,source:s,stack:Sr(s)},_d.set(n,s),s)}return{value:n,source:s,stack:Sr(s)}}var Wa=[],Ni=0,Gc=0;function yo(){for(var n=Ni,s=Gc=Ni=0;s<n;){var l=Wa[s];Wa[s++]=null;var u=Wa[s];Wa[s++]=null;var h=Wa[s];Wa[s++]=null;var y=Wa[s];if(Wa[s++]=null,u!==null&&h!==null){var k=u.pending;k===null?h.next=h:(h.next=k.next,k.next=h),u.pending=h}y!==0&&Od(l,h,y)}}function vo(n,s,l,u){Wa[Ni++]=n,Wa[Ni++]=s,Wa[Ni++]=l,Wa[Ni++]=u,Gc|=u,n.lanes|=u,n=n.alternate,n!==null&&(n.lanes|=u)}function Hc(n,s,l,u){return vo(n,s,l,u),bo(n)}function ki(n,s){return vo(n,null,null,s),bo(n)}function Od(n,s,l){n.lanes|=l;var u=n.alternate;u!==null&&(u.lanes|=l);for(var h=!1,y=n.return;y!==null;)y.childLanes|=l,u=y.alternate,u!==null&&(u.childLanes|=l),y.tag===22&&(n=y.stateNode,n===null||n._visibility&1||(h=!0)),n=y,y=y.return;return n.tag===3?(y=n.stateNode,h&&s!==null&&(h=31-dn(l),n=y.hiddenUpdates,u=n[h],u===null?n[h]=[s]:u.push(s),s.lane=l|536870912),y):null}function bo(n){if(50<Bl)throw Bl=0,Wu=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Ri={};function ay(n,s,l,u){this.tag=n,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Da(n,s,l,u){return new ay(n,s,l,u)}function Yc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function $r(n,s){var l=n.alternate;return l===null?(l=Da(n.tag,s,n.key,n.mode),l.elementType=n.elementType,l.type=n.type,l.stateNode=n.stateNode,l.alternate=n,n.alternate=l):(l.pendingProps=s,l.type=n.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=n.flags&65011712,l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,s=n.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=n.sibling,l.index=n.index,l.ref=n.ref,l.refCleanup=n.refCleanup,l}function Id(n,s){n.flags&=65011714;var l=n.alternate;return l===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=l.childLanes,n.lanes=l.lanes,n.child=l.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=l.memoizedProps,n.memoizedState=l.memoizedState,n.updateQueue=l.updateQueue,n.type=l.type,s=l.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function xo(n,s,l,u,h,y){var k=0;if(u=n,typeof n=="function")Yc(n)&&(k=1);else if(typeof n=="string")k=s1(n,l,ve.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case ie:return n=Da(31,l,s,h),n.elementType=ie,n.lanes=y,n;case M:return ai(l.children,h,y,s);case D:k=8,h|=24;break;case j:return n=Da(12,l,s,h|2),n.elementType=j,n.lanes=y,n;case I:return n=Da(13,l,s,h),n.elementType=I,n.lanes=y,n;case V:return n=Da(19,l,s,h),n.elementType=V,n.lanes=y,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case P:case _:k=10;break e;case F:k=9;break e;case L:k=11;break e;case $:k=14;break e;case J:k=16,u=null;break e}k=29,l=Error(i(130,n===null?"null":typeof n,"")),u=null}return s=Da(k,l,s,h),s.elementType=n,s.type=u,s.lanes=y,s}function ai(n,s,l,u){return n=Da(7,n,u,s),n.lanes=l,n}function qc(n,s,l){return n=Da(6,n,null,s),n.lanes=l,n}function Vc(n,s,l){return s=Da(4,n.children!==null?n.children:[],n.key,s),s.lanes=l,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var Di=[],_i=0,So=null,Eo=0,Za=[],Qa=0,ri=null,Wr=1,Zr="";function si(n,s){Di[_i++]=Eo,Di[_i++]=So,So=n,Eo=s}function Ld(n,s,l){Za[Qa++]=Wr,Za[Qa++]=Zr,Za[Qa++]=ri,ri=n;var u=Wr;n=Zr;var h=32-dn(u)-1;u&=~(1<<h),l+=1;var y=32-dn(s)+h;if(30<y){var k=h-h%5;y=(u&(1<<k)-1).toString(32),u>>=k,h-=k,Wr=1<<32-dn(s)+h|l<<h|u,Zr=y+n}else Wr=1<<y|l<<h|u,Zr=n}function Xc(n){n.return!==null&&(si(n,1),Ld(n,1,0))}function $c(n){for(;n===So;)So=Di[--_i],Di[_i]=null,Eo=Di[--_i],Di[_i]=null;for(;n===ri;)ri=Za[--Qa],Za[Qa]=null,Zr=Za[--Qa],Za[Qa]=null,Wr=Za[--Qa],Za[Qa]=null}var ia=null,on=null,Rt=!1,ii=null,kr=!1,Wc=Error(i(519));function li(n){var s=Error(i(418,""));throw gl($a(s,n)),Wc}function Ud(n){var s=n.stateNode,l=n.type,u=n.memoizedProps;switch(s[sn]=n,s[Gt]=u,l){case"dialog":St("cancel",s),St("close",s);break;case"iframe":case"object":case"embed":St("load",s);break;case"video":case"audio":for(l=0;l<Pl.length;l++)St(Pl[l],s);break;case"source":St("error",s);break;case"img":case"image":case"link":St("error",s),St("load",s);break;case"details":St("toggle",s);break;case"input":St("invalid",s),Zs(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),Er(s);break;case"select":St("invalid",s);break;case"textarea":St("invalid",s),Pr(s,u.value,u.defaultValue,u.children),Er(s)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||u.suppressHydrationWarning===!0||Jh(s.textContent,l)?(u.popover!=null&&(St("beforetoggle",s),St("toggle",s)),u.onScroll!=null&&St("scroll",s),u.onScrollEnd!=null&&St("scrollend",s),u.onClick!=null&&(s.onclick=nc),s=!0):s=!1,s||li(n)}function jd(n){for(ia=n.return;ia;)switch(ia.tag){case 5:case 13:kr=!1;return;case 27:case 3:kr=!0;return;default:ia=ia.return}}function hl(n){if(n!==ia)return!1;if(!Rt)return jd(n),Rt=!0,!1;var s=n.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=n.type,l=!(l!=="form"&&l!=="button")||df(n.type,n.memoizedProps)),l=!l),l&&on&&li(n),jd(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));e:{for(n=n.nextSibling,s=0;n;){if(n.nodeType===8)if(l=n.data,l==="/$"){if(s===0){on=dr(n.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++;n=n.nextSibling}on=null}}else s===27?(s=on,Is(n.type)?(n=gf,gf=null,on=n):on=s):on=ia?dr(n.stateNode.nextSibling):null;return!0}function ml(){on=ia=null,Rt=!1}function Bd(){var n=ii;return n!==null&&(xa===null?xa=n:xa.push.apply(xa,n),ii=null),n}function gl(n){ii===null?ii=[n]:ii.push(n)}var Zc=Q(null),oi=null,Qr=null;function bs(n,s,l){ke(Zc,s._currentValue),s._currentValue=l}function Kr(n){n._currentValue=Zc.current,be(Zc)}function Qc(n,s,l){for(;n!==null;){var u=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),n===l)break;n=n.return}}function Kc(n,s,l,u){var h=n.child;for(h!==null&&(h.return=n);h!==null;){var y=h.dependencies;if(y!==null){var k=h.child;y=y.firstContext;e:for(;y!==null;){var B=y;y=h;for(var te=0;te<s.length;te++)if(B.context===s[te]){y.lanes|=l,B=y.alternate,B!==null&&(B.lanes|=l),Qc(y.return,l,n),u||(k=null);break e}y=B.next}}else if(h.tag===18){if(k=h.return,k===null)throw Error(i(341));k.lanes|=l,y=k.alternate,y!==null&&(y.lanes|=l),Qc(k,l,n),k=null}else k=h.child;if(k!==null)k.return=h;else for(k=h;k!==null;){if(k===n){k=null;break}if(h=k.sibling,h!==null){h.return=k.return,k=h;break}k=k.return}h=k}}function yl(n,s,l,u){n=null;for(var h=s,y=!1;h!==null;){if(!y){if((h.flags&524288)!==0)y=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var k=h.alternate;if(k===null)throw Error(i(387));if(k=k.memoizedProps,k!==null){var B=h.type;qt(h.pendingProps.value,k.value)||(n!==null?n.push(B):n=[B])}}else if(h===We.current){if(k=h.alternate,k===null)throw Error(i(387));k.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(n!==null?n.push(Vl):n=[Vl])}h=h.return}n!==null&&Kc(s,n,l,u),s.flags|=262144}function wo(n){for(n=n.firstContext;n!==null;){if(!qt(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ci(n){oi=n,Qr=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Zn(n){return Fd(oi,n)}function Ao(n,s){return oi===null&&ci(n),Fd(n,s)}function Fd(n,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Qr===null){if(n===null)throw Error(i(308));Qr=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Qr=Qr.next=s;return l}var ry=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(l,u){n.push(u)}};this.abort=function(){s.aborted=!0,n.forEach(function(l){return l()})}},sy=a.unstable_scheduleCallback,iy=a.unstable_NormalPriority,Cn={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jc(){return{controller:new ry,data:new Map,refCount:0}}function vl(n){n.refCount--,n.refCount===0&&sy(iy,function(){n.controller.abort()})}var bl=null,eu=0,Oi=0,Ii=null;function ly(n,s){if(bl===null){var l=bl=[];eu=0,Oi=nf(),Ii={status:"pending",value:void 0,then:function(u){l.push(u)}}}return eu++,s.then(Pd,Pd),s}function Pd(){if(--eu===0&&bl!==null){Ii!==null&&(Ii.status="fulfilled");var n=bl;bl=null,Oi=0,Ii=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function oy(n,s){var l=[],u={status:"pending",value:null,reason:null,then:function(h){l.push(h)}};return n.then(function(){u.status="fulfilled",u.value=s;for(var h=0;h<l.length;h++)(0,l[h])(s)},function(h){for(u.status="rejected",u.reason=h,h=0;h<l.length;h++)(0,l[h])(void 0)}),u}var zd=Y.S;Y.S=function(n,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&ly(n,s),zd!==null&&zd(n,s)};var ui=Q(null);function tu(){var n=ui.current;return n!==null?n:Vt.pooledCache}function To(n,s){s===null?ke(ui,ui.current):ke(ui,s.pool)}function Gd(){var n=tu();return n===null?null:{parent:Cn._currentValue,pool:n}}var xl=Error(i(460)),Hd=Error(i(474)),Co=Error(i(542)),nu={then:function(){}};function Yd(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Mo(){}function qd(n,s,l){switch(l=n[l],l===void 0?n.push(s):l!==s&&(s.then(Mo,Mo),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Xd(n),n;default:if(typeof s.status=="string")s.then(Mo,Mo);else{if(n=Vt,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(u){if(s.status==="pending"){var h=s;h.status="fulfilled",h.value=u}},function(u){if(s.status==="pending"){var h=s;h.status="rejected",h.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Xd(n),n}throw Sl=s,xl}}var Sl=null;function Vd(){if(Sl===null)throw Error(i(459));var n=Sl;return Sl=null,n}function Xd(n){if(n===xl||n===Co)throw Error(i(483))}var xs=!1;function au(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ru(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ss(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Es(n,s,l){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(It&2)!==0){var h=u.pending;return h===null?s.next=s:(s.next=h.next,h.next=s),u.pending=s,s=bo(n),Od(n,null,l),s}return vo(n,u,s,l),bo(n)}function El(n,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,Ea(n,l)}}function su(n,s){var l=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var h=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var k={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};y===null?h=y=k:y=y.next=k,l=l.next}while(l!==null);y===null?h=y=s:y=y.next=s}else h=y=s;l={baseState:u.baseState,firstBaseUpdate:h,lastBaseUpdate:y,shared:u.shared,callbacks:u.callbacks},n.updateQueue=l;return}n=l.lastBaseUpdate,n===null?l.firstBaseUpdate=s:n.next=s,l.lastBaseUpdate=s}var iu=!1;function wl(){if(iu){var n=Ii;if(n!==null)throw n}}function Al(n,s,l,u){iu=!1;var h=n.updateQueue;xs=!1;var y=h.firstBaseUpdate,k=h.lastBaseUpdate,B=h.shared.pending;if(B!==null){h.shared.pending=null;var te=B,de=te.next;te.next=null,k===null?y=de:k.next=de,k=te;var Ae=n.alternate;Ae!==null&&(Ae=Ae.updateQueue,B=Ae.lastBaseUpdate,B!==k&&(B===null?Ae.firstBaseUpdate=de:B.next=de,Ae.lastBaseUpdate=te))}if(y!==null){var Ne=h.baseState;k=0,Ae=de=te=null,B=y;do{var me=B.lane&-536870913,ge=me!==B.lane;if(ge?(Tt&me)===me:(u&me)===me){me!==0&&me===Oi&&(iu=!0),Ae!==null&&(Ae=Ae.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var at=n,Qe=B;me=s;var Ft=l;switch(Qe.tag){case 1:if(at=Qe.payload,typeof at=="function"){Ne=at.call(Ft,Ne,me);break e}Ne=at;break e;case 3:at.flags=at.flags&-65537|128;case 0:if(at=Qe.payload,me=typeof at=="function"?at.call(Ft,Ne,me):at,me==null)break e;Ne=x({},Ne,me);break e;case 2:xs=!0}}me=B.callback,me!==null&&(n.flags|=64,ge&&(n.flags|=8192),ge=h.callbacks,ge===null?h.callbacks=[me]:ge.push(me))}else ge={lane:me,tag:B.tag,payload:B.payload,callback:B.callback,next:null},Ae===null?(de=Ae=ge,te=Ne):Ae=Ae.next=ge,k|=me;if(B=B.next,B===null){if(B=h.shared.pending,B===null)break;ge=B,B=ge.next,ge.next=null,h.lastBaseUpdate=ge,h.shared.pending=null}}while(!0);Ae===null&&(te=Ne),h.baseState=te,h.firstBaseUpdate=de,h.lastBaseUpdate=Ae,y===null&&(h.shared.lanes=0),Rs|=k,n.lanes=k,n.memoizedState=Ne}}function $d(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function Wd(n,s){var l=n.callbacks;if(l!==null)for(n.callbacks=null,n=0;n<l.length;n++)$d(l[n],s)}var Li=Q(null),No=Q(0);function Zd(n,s){n=ss,ke(No,n),ke(Li,s),ss=n|s.baseLanes}function lu(){ke(No,ss),ke(Li,Li.current)}function ou(){ss=No.current,be(Li),be(No)}var ws=0,yt=null,jt=null,En=null,ko=!1,Ui=!1,fi=!1,Ro=0,Tl=0,ji=null,cy=0;function hn(){throw Error(i(321))}function cu(n,s){if(s===null)return!1;for(var l=0;l<s.length&&l<n.length;l++)if(!qt(n[l],s[l]))return!1;return!0}function uu(n,s,l,u,h,y){return ws=y,yt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Y.H=n===null||n.memoizedState===null?Op:Ip,fi=!1,y=l(u,h),fi=!1,Ui&&(y=Kd(s,l,u,h)),Qd(n),y}function Qd(n){Y.H=Uo;var s=jt!==null&&jt.next!==null;if(ws=0,En=jt=yt=null,ko=!1,Tl=0,ji=null,s)throw Error(i(300));n===null||On||(n=n.dependencies,n!==null&&wo(n)&&(On=!0))}function Kd(n,s,l,u){yt=n;var h=0;do{if(Ui&&(ji=null),Tl=0,Ui=!1,25<=h)throw Error(i(301));if(h+=1,En=jt=null,n.updateQueue!=null){var y=n.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}Y.H=gy,y=s(l,u)}while(Ui);return y}function uy(){var n=Y.H,s=n.useState()[0];return s=typeof s.then=="function"?Cl(s):s,n=n.useState()[0],(jt!==null?jt.memoizedState:null)!==n&&(yt.flags|=1024),s}function fu(){var n=Ro!==0;return Ro=0,n}function du(n,s,l){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~l}function pu(n){if(ko){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}ko=!1}ws=0,En=jt=yt=null,Ui=!1,Tl=Ro=0,ji=null}function va(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?yt.memoizedState=En=n:En=En.next=n,En}function wn(){if(jt===null){var n=yt.alternate;n=n!==null?n.memoizedState:null}else n=jt.next;var s=En===null?yt.memoizedState:En.next;if(s!==null)En=s,jt=n;else{if(n===null)throw yt.alternate===null?Error(i(467)):Error(i(310));jt=n,n={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},En===null?yt.memoizedState=En=n:En=En.next=n}return En}function hu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cl(n){var s=Tl;return Tl+=1,ji===null&&(ji=[]),n=qd(ji,n,s),s=yt,(En===null?s.memoizedState:En.next)===null&&(s=s.alternate,Y.H=s===null||s.memoizedState===null?Op:Ip),n}function Do(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Cl(n);if(n.$$typeof===_)return Zn(n)}throw Error(i(438,String(n)))}function mu(n){var s=null,l=yt.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var u=yt.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(h){return h.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=hu(),yt.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(n),u=0;u<n;u++)l[u]=oe;return s.index++,l}function Jr(n,s){return typeof s=="function"?s(n):s}function _o(n){var s=wn();return gu(s,jt,n)}function gu(n,s,l){var u=n.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=l;var h=n.baseQueue,y=u.pending;if(y!==null){if(h!==null){var k=h.next;h.next=y.next,y.next=k}s.baseQueue=h=y,u.pending=null}if(y=n.baseState,h===null)n.memoizedState=y;else{s=h.next;var B=k=null,te=null,de=s,Ae=!1;do{var Ne=de.lane&-536870913;if(Ne!==de.lane?(Tt&Ne)===Ne:(ws&Ne)===Ne){var me=de.revertLane;if(me===0)te!==null&&(te=te.next={lane:0,revertLane:0,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),Ne===Oi&&(Ae=!0);else if((ws&me)===me){de=de.next,me===Oi&&(Ae=!0);continue}else Ne={lane:0,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(B=te=Ne,k=y):te=te.next=Ne,yt.lanes|=me,Rs|=me;Ne=de.action,fi&&l(y,Ne),y=de.hasEagerState?de.eagerState:l(y,Ne)}else me={lane:Ne,revertLane:de.revertLane,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},te===null?(B=te=me,k=y):te=te.next=me,yt.lanes|=Ne,Rs|=Ne;de=de.next}while(de!==null&&de!==s);if(te===null?k=y:te.next=B,!qt(y,n.memoizedState)&&(On=!0,Ae&&(l=Ii,l!==null)))throw l;n.memoizedState=y,n.baseState=k,n.baseQueue=te,u.lastRenderedState=y}return h===null&&(u.lanes=0),[n.memoizedState,u.dispatch]}function yu(n){var s=wn(),l=s.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=n;var u=l.dispatch,h=l.pending,y=s.memoizedState;if(h!==null){l.pending=null;var k=h=h.next;do y=n(y,k.action),k=k.next;while(k!==h);qt(y,s.memoizedState)||(On=!0),s.memoizedState=y,s.baseQueue===null&&(s.baseState=y),l.lastRenderedState=y}return[y,u]}function Jd(n,s,l){var u=yt,h=wn(),y=Rt;if(y){if(l===void 0)throw Error(i(407));l=l()}else l=s();var k=!qt((jt||h).memoizedState,l);k&&(h.memoizedState=l,On=!0),h=h.queue;var B=np.bind(null,u,h,n);if(Ml(2048,8,B,[n]),h.getSnapshot!==s||k||En!==null&&En.memoizedState.tag&1){if(u.flags|=2048,Bi(9,Oo(),tp.bind(null,u,h,l,s),null),Vt===null)throw Error(i(349));y||(ws&124)!==0||ep(u,s,l)}return l}function ep(n,s,l){n.flags|=16384,n={getSnapshot:s,value:l},s=yt.updateQueue,s===null?(s=hu(),yt.updateQueue=s,s.stores=[n]):(l=s.stores,l===null?s.stores=[n]:l.push(n))}function tp(n,s,l,u){s.value=l,s.getSnapshot=u,ap(s)&&rp(n)}function np(n,s,l){return l(function(){ap(s)&&rp(n)})}function ap(n){var s=n.getSnapshot;n=n.value;try{var l=s();return!qt(n,l)}catch{return!0}}function rp(n){var s=ki(n,2);s!==null&&Ua(s,n,2)}function vu(n){var s=va();if(typeof n=="function"){var l=n;if(n=l(),fi){Nn(!0);try{l()}finally{Nn(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:n},s}function sp(n,s,l,u){return n.baseState=l,gu(n,jt,typeof u=="function"?u:Jr)}function fy(n,s,l,u,h){if(Lo(n))throw Error(i(485));if(n=s.action,n!==null){var y={payload:h,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){y.listeners.push(k)}};Y.T!==null?l(!0):y.isTransition=!1,u(y),l=s.pending,l===null?(y.next=s.pending=y,ip(s,y)):(y.next=l.next,s.pending=l.next=y)}}function ip(n,s){var l=s.action,u=s.payload,h=n.state;if(s.isTransition){var y=Y.T,k={};Y.T=k;try{var B=l(h,u),te=Y.S;te!==null&&te(k,B),lp(n,s,B)}catch(de){bu(n,s,de)}finally{Y.T=y}}else try{y=l(h,u),lp(n,s,y)}catch(de){bu(n,s,de)}}function lp(n,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){op(n,s,u)},function(u){return bu(n,s,u)}):op(n,s,l)}function op(n,s,l){s.status="fulfilled",s.value=l,cp(s),n.state=l,s=n.pending,s!==null&&(l=s.next,l===s?n.pending=null:(l=l.next,s.next=l,ip(n,l)))}function bu(n,s,l){var u=n.pending;if(n.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=l,cp(s),s=s.next;while(s!==u)}n.action=null}function cp(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function up(n,s){return s}function fp(n,s){if(Rt){var l=Vt.formState;if(l!==null){e:{var u=yt;if(Rt){if(on){t:{for(var h=on,y=kr;h.nodeType!==8;){if(!y){h=null;break t}if(h=dr(h.nextSibling),h===null){h=null;break t}}y=h.data,h=y==="F!"||y==="F"?h:null}if(h){on=dr(h.nextSibling),u=h.data==="F!";break e}}li(u)}u=!1}u&&(s=l[0])}}return l=va(),l.memoizedState=l.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:up,lastRenderedState:s},l.queue=u,l=Rp.bind(null,yt,u),u.dispatch=l,u=vu(!1),y=Au.bind(null,yt,!1,u.queue),u=va(),h={state:s,dispatch:null,action:n,pending:null},u.queue=h,l=fy.bind(null,yt,h,y,l),h.dispatch=l,u.memoizedState=n,[s,l,!1]}function dp(n){var s=wn();return pp(s,jt,n)}function pp(n,s,l){if(s=gu(n,s,up)[0],n=_o(Jr)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=Cl(s)}catch(k){throw k===xl?Co:k}else u=s;s=wn();var h=s.queue,y=h.dispatch;return l!==s.memoizedState&&(yt.flags|=2048,Bi(9,Oo(),dy.bind(null,h,l),null)),[u,y,n]}function dy(n,s){n.action=s}function hp(n){var s=wn(),l=jt;if(l!==null)return pp(s,l,n);wn(),s=s.memoizedState,l=wn();var u=l.queue.dispatch;return l.memoizedState=n,[s,u,!1]}function Bi(n,s,l,u){return n={tag:n,create:l,deps:u,inst:s,next:null},s=yt.updateQueue,s===null&&(s=hu(),yt.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=n.next=n:(u=l.next,l.next=n,n.next=u,s.lastEffect=n),n}function Oo(){return{destroy:void 0,resource:void 0}}function mp(){return wn().memoizedState}function Io(n,s,l,u){var h=va();u=u===void 0?null:u,yt.flags|=n,h.memoizedState=Bi(1|s,Oo(),l,u)}function Ml(n,s,l,u){var h=wn();u=u===void 0?null:u;var y=h.memoizedState.inst;jt!==null&&u!==null&&cu(u,jt.memoizedState.deps)?h.memoizedState=Bi(s,y,l,u):(yt.flags|=n,h.memoizedState=Bi(1|s,y,l,u))}function gp(n,s){Io(8390656,8,n,s)}function yp(n,s){Ml(2048,8,n,s)}function vp(n,s){return Ml(4,2,n,s)}function bp(n,s){return Ml(4,4,n,s)}function xp(n,s){if(typeof s=="function"){n=n();var l=s(n);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Sp(n,s,l){l=l!=null?l.concat([n]):null,Ml(4,4,xp.bind(null,s,n),l)}function xu(){}function Ep(n,s){var l=wn();s=s===void 0?null:s;var u=l.memoizedState;return s!==null&&cu(s,u[1])?u[0]:(l.memoizedState=[n,s],n)}function wp(n,s){var l=wn();s=s===void 0?null:s;var u=l.memoizedState;if(s!==null&&cu(s,u[1]))return u[0];if(u=n(),fi){Nn(!0);try{n()}finally{Nn(!1)}}return l.memoizedState=[u,s],u}function Su(n,s,l){return l===void 0||(ws&1073741824)!==0?n.memoizedState=s:(n.memoizedState=l,n=Ch(),yt.lanes|=n,Rs|=n,l)}function Ap(n,s,l,u){return qt(l,s)?l:Li.current!==null?(n=Su(n,l,u),qt(n,s)||(On=!0),n):(ws&42)===0?(On=!0,n.memoizedState=l):(n=Ch(),yt.lanes|=n,Rs|=n,s)}function Tp(n,s,l,u,h){var y=ee.p;ee.p=y!==0&&8>y?y:8;var k=Y.T,B={};Y.T=B,Au(n,!1,s,l);try{var te=h(),de=Y.S;if(de!==null&&de(B,te),te!==null&&typeof te=="object"&&typeof te.then=="function"){var Ae=oy(te,u);Nl(n,s,Ae,La(n))}else Nl(n,s,u,La(n))}catch(Ne){Nl(n,s,{then:function(){},status:"rejected",reason:Ne},La())}finally{ee.p=y,Y.T=k}}function py(){}function Eu(n,s,l,u){if(n.tag!==5)throw Error(i(476));var h=Cp(n).queue;Tp(n,h,s,ue,l===null?py:function(){return Mp(n),l(u)})}function Cp(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:ue,baseState:ue,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:ue},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:l},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Mp(n){var s=Cp(n).next.queue;Nl(n,s,{},La())}function wu(){return Zn(Vl)}function Np(){return wn().memoizedState}function kp(){return wn().memoizedState}function hy(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var l=La();n=Ss(l);var u=Es(s,n,l);u!==null&&(Ua(u,s,l),El(u,s,l)),s={cache:Jc()},n.payload=s;return}s=s.return}}function my(n,s,l){var u=La();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},Lo(n)?Dp(s,l):(l=Hc(n,s,l,u),l!==null&&(Ua(l,n,u),_p(l,s,u)))}function Rp(n,s,l){var u=La();Nl(n,s,l,u)}function Nl(n,s,l,u){var h={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(Lo(n))Dp(s,h);else{var y=n.alternate;if(n.lanes===0&&(y===null||y.lanes===0)&&(y=s.lastRenderedReducer,y!==null))try{var k=s.lastRenderedState,B=y(k,l);if(h.hasEagerState=!0,h.eagerState=B,qt(B,k))return vo(n,s,h,0),Vt===null&&yo(),!1}catch{}if(l=Hc(n,s,h,u),l!==null)return Ua(l,n,u),_p(l,s,u),!0}return!1}function Au(n,s,l,u){if(u={lane:2,revertLane:nf(),action:u,hasEagerState:!1,eagerState:null,next:null},Lo(n)){if(s)throw Error(i(479))}else s=Hc(n,l,u,2),s!==null&&Ua(s,n,2)}function Lo(n){var s=n.alternate;return n===yt||s!==null&&s===yt}function Dp(n,s){Ui=ko=!0;var l=n.pending;l===null?s.next=s:(s.next=l.next,l.next=s),n.pending=s}function _p(n,s,l){if((l&4194048)!==0){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,Ea(n,l)}}var Uo={readContext:Zn,use:Do,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useLayoutEffect:hn,useInsertionEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useSyncExternalStore:hn,useId:hn,useHostTransitionStatus:hn,useFormState:hn,useActionState:hn,useOptimistic:hn,useMemoCache:hn,useCacheRefresh:hn},Op={readContext:Zn,use:Do,useCallback:function(n,s){return va().memoizedState=[n,s===void 0?null:s],n},useContext:Zn,useEffect:gp,useImperativeHandle:function(n,s,l){l=l!=null?l.concat([n]):null,Io(4194308,4,xp.bind(null,s,n),l)},useLayoutEffect:function(n,s){return Io(4194308,4,n,s)},useInsertionEffect:function(n,s){Io(4,2,n,s)},useMemo:function(n,s){var l=va();s=s===void 0?null:s;var u=n();if(fi){Nn(!0);try{n()}finally{Nn(!1)}}return l.memoizedState=[u,s],u},useReducer:function(n,s,l){var u=va();if(l!==void 0){var h=l(s);if(fi){Nn(!0);try{l(s)}finally{Nn(!1)}}}else h=s;return u.memoizedState=u.baseState=h,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:h},u.queue=n,n=n.dispatch=my.bind(null,yt,n),[u.memoizedState,n]},useRef:function(n){var s=va();return n={current:n},s.memoizedState=n},useState:function(n){n=vu(n);var s=n.queue,l=Rp.bind(null,yt,s);return s.dispatch=l,[n.memoizedState,l]},useDebugValue:xu,useDeferredValue:function(n,s){var l=va();return Su(l,n,s)},useTransition:function(){var n=vu(!1);return n=Tp.bind(null,yt,n.queue,!0,!1),va().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,l){var u=yt,h=va();if(Rt){if(l===void 0)throw Error(i(407));l=l()}else{if(l=s(),Vt===null)throw Error(i(349));(Tt&124)!==0||ep(u,s,l)}h.memoizedState=l;var y={value:l,getSnapshot:s};return h.queue=y,gp(np.bind(null,u,y,n),[n]),u.flags|=2048,Bi(9,Oo(),tp.bind(null,u,y,l,s),null),l},useId:function(){var n=va(),s=Vt.identifierPrefix;if(Rt){var l=Zr,u=Wr;l=(u&~(1<<32-dn(u)-1)).toString(32)+l,s=""+s+"R"+l,l=Ro++,0<l&&(s+="H"+l.toString(32)),s+=""}else l=cy++,s=""+s+"r"+l.toString(32)+"";return n.memoizedState=s},useHostTransitionStatus:wu,useFormState:fp,useActionState:fp,useOptimistic:function(n){var s=va();s.memoizedState=s.baseState=n;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=Au.bind(null,yt,!0,l),l.dispatch=s,[n,s]},useMemoCache:mu,useCacheRefresh:function(){return va().memoizedState=hy.bind(null,yt)}},Ip={readContext:Zn,use:Do,useCallback:Ep,useContext:Zn,useEffect:yp,useImperativeHandle:Sp,useInsertionEffect:vp,useLayoutEffect:bp,useMemo:wp,useReducer:_o,useRef:mp,useState:function(){return _o(Jr)},useDebugValue:xu,useDeferredValue:function(n,s){var l=wn();return Ap(l,jt.memoizedState,n,s)},useTransition:function(){var n=_o(Jr)[0],s=wn().memoizedState;return[typeof n=="boolean"?n:Cl(n),s]},useSyncExternalStore:Jd,useId:Np,useHostTransitionStatus:wu,useFormState:dp,useActionState:dp,useOptimistic:function(n,s){var l=wn();return sp(l,jt,n,s)},useMemoCache:mu,useCacheRefresh:kp},gy={readContext:Zn,use:Do,useCallback:Ep,useContext:Zn,useEffect:yp,useImperativeHandle:Sp,useInsertionEffect:vp,useLayoutEffect:bp,useMemo:wp,useReducer:yu,useRef:mp,useState:function(){return yu(Jr)},useDebugValue:xu,useDeferredValue:function(n,s){var l=wn();return jt===null?Su(l,n,s):Ap(l,jt.memoizedState,n,s)},useTransition:function(){var n=yu(Jr)[0],s=wn().memoizedState;return[typeof n=="boolean"?n:Cl(n),s]},useSyncExternalStore:Jd,useId:Np,useHostTransitionStatus:wu,useFormState:hp,useActionState:hp,useOptimistic:function(n,s){var l=wn();return jt!==null?sp(l,jt,n,s):(l.baseState=n,[n,l.queue.dispatch])},useMemoCache:mu,useCacheRefresh:kp},Fi=null,kl=0;function jo(n){var s=kl;return kl+=1,Fi===null&&(Fi=[]),qd(Fi,n,s)}function Rl(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Bo(n,s){throw s.$$typeof===T?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function Lp(n){var s=n._init;return s(n._payload)}function Up(n){function s(ce,se){if(n){var fe=ce.deletions;fe===null?(ce.deletions=[se],ce.flags|=16):fe.push(se)}}function l(ce,se){if(!n)return null;for(;se!==null;)s(ce,se),se=se.sibling;return null}function u(ce){for(var se=new Map;ce!==null;)ce.key!==null?se.set(ce.key,ce):se.set(ce.index,ce),ce=ce.sibling;return se}function h(ce,se){return ce=$r(ce,se),ce.index=0,ce.sibling=null,ce}function y(ce,se,fe){return ce.index=fe,n?(fe=ce.alternate,fe!==null?(fe=fe.index,fe<se?(ce.flags|=67108866,se):fe):(ce.flags|=67108866,se)):(ce.flags|=1048576,se)}function k(ce){return n&&ce.alternate===null&&(ce.flags|=67108866),ce}function B(ce,se,fe,Te){return se===null||se.tag!==6?(se=qc(fe,ce.mode,Te),se.return=ce,se):(se=h(se,fe),se.return=ce,se)}function te(ce,se,fe,Te){var ze=fe.type;return ze===M?Ae(ce,se,fe.props.children,Te,fe.key):se!==null&&(se.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===J&&Lp(ze)===se.type)?(se=h(se,fe.props),Rl(se,fe),se.return=ce,se):(se=xo(fe.type,fe.key,fe.props,null,ce.mode,Te),Rl(se,fe),se.return=ce,se)}function de(ce,se,fe,Te){return se===null||se.tag!==4||se.stateNode.containerInfo!==fe.containerInfo||se.stateNode.implementation!==fe.implementation?(se=Vc(fe,ce.mode,Te),se.return=ce,se):(se=h(se,fe.children||[]),se.return=ce,se)}function Ae(ce,se,fe,Te,ze){return se===null||se.tag!==7?(se=ai(fe,ce.mode,Te,ze),se.return=ce,se):(se=h(se,fe),se.return=ce,se)}function Ne(ce,se,fe){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=qc(""+se,ce.mode,fe),se.return=ce,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case S:return fe=xo(se.type,se.key,se.props,null,ce.mode,fe),Rl(fe,se),fe.return=ce,fe;case E:return se=Vc(se,ce.mode,fe),se.return=ce,se;case J:var Te=se._init;return se=Te(se._payload),Ne(ce,se,fe)}if(re(se)||K(se))return se=ai(se,ce.mode,fe,null),se.return=ce,se;if(typeof se.then=="function")return Ne(ce,jo(se),fe);if(se.$$typeof===_)return Ne(ce,Ao(ce,se),fe);Bo(ce,se)}return null}function me(ce,se,fe,Te){var ze=se!==null?se.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint")return ze!==null?null:B(ce,se,""+fe,Te);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case S:return fe.key===ze?te(ce,se,fe,Te):null;case E:return fe.key===ze?de(ce,se,fe,Te):null;case J:return ze=fe._init,fe=ze(fe._payload),me(ce,se,fe,Te)}if(re(fe)||K(fe))return ze!==null?null:Ae(ce,se,fe,Te,null);if(typeof fe.then=="function")return me(ce,se,jo(fe),Te);if(fe.$$typeof===_)return me(ce,se,Ao(ce,fe),Te);Bo(ce,fe)}return null}function ge(ce,se,fe,Te,ze){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ce=ce.get(fe)||null,B(se,ce,""+Te,ze);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case S:return ce=ce.get(Te.key===null?fe:Te.key)||null,te(se,ce,Te,ze);case E:return ce=ce.get(Te.key===null?fe:Te.key)||null,de(se,ce,Te,ze);case J:var bt=Te._init;return Te=bt(Te._payload),ge(ce,se,fe,Te,ze)}if(re(Te)||K(Te))return ce=ce.get(fe)||null,Ae(se,ce,Te,ze,null);if(typeof Te.then=="function")return ge(ce,se,fe,jo(Te),ze);if(Te.$$typeof===_)return ge(ce,se,fe,Ao(se,Te),ze);Bo(se,Te)}return null}function at(ce,se,fe,Te){for(var ze=null,bt=null,Xe=se,Ke=se=0,Ln=null;Xe!==null&&Ke<fe.length;Ke++){Xe.index>Ke?(Ln=Xe,Xe=null):Ln=Xe.sibling;var kt=me(ce,Xe,fe[Ke],Te);if(kt===null){Xe===null&&(Xe=Ln);break}n&&Xe&&kt.alternate===null&&s(ce,Xe),se=y(kt,se,Ke),bt===null?ze=kt:bt.sibling=kt,bt=kt,Xe=Ln}if(Ke===fe.length)return l(ce,Xe),Rt&&si(ce,Ke),ze;if(Xe===null){for(;Ke<fe.length;Ke++)Xe=Ne(ce,fe[Ke],Te),Xe!==null&&(se=y(Xe,se,Ke),bt===null?ze=Xe:bt.sibling=Xe,bt=Xe);return Rt&&si(ce,Ke),ze}for(Xe=u(Xe);Ke<fe.length;Ke++)Ln=ge(Xe,ce,Ke,fe[Ke],Te),Ln!==null&&(n&&Ln.alternate!==null&&Xe.delete(Ln.key===null?Ke:Ln.key),se=y(Ln,se,Ke),bt===null?ze=Ln:bt.sibling=Ln,bt=Ln);return n&&Xe.forEach(function(Fs){return s(ce,Fs)}),Rt&&si(ce,Ke),ze}function Qe(ce,se,fe,Te){if(fe==null)throw Error(i(151));for(var ze=null,bt=null,Xe=se,Ke=se=0,Ln=null,kt=fe.next();Xe!==null&&!kt.done;Ke++,kt=fe.next()){Xe.index>Ke?(Ln=Xe,Xe=null):Ln=Xe.sibling;var Fs=me(ce,Xe,kt.value,Te);if(Fs===null){Xe===null&&(Xe=Ln);break}n&&Xe&&Fs.alternate===null&&s(ce,Xe),se=y(Fs,se,Ke),bt===null?ze=Fs:bt.sibling=Fs,bt=Fs,Xe=Ln}if(kt.done)return l(ce,Xe),Rt&&si(ce,Ke),ze;if(Xe===null){for(;!kt.done;Ke++,kt=fe.next())kt=Ne(ce,kt.value,Te),kt!==null&&(se=y(kt,se,Ke),bt===null?ze=kt:bt.sibling=kt,bt=kt);return Rt&&si(ce,Ke),ze}for(Xe=u(Xe);!kt.done;Ke++,kt=fe.next())kt=ge(Xe,ce,Ke,kt.value,Te),kt!==null&&(n&&kt.alternate!==null&&Xe.delete(kt.key===null?Ke:kt.key),se=y(kt,se,Ke),bt===null?ze=kt:bt.sibling=kt,bt=kt);return n&&Xe.forEach(function(y1){return s(ce,y1)}),Rt&&si(ce,Ke),ze}function Ft(ce,se,fe,Te){if(typeof fe=="object"&&fe!==null&&fe.type===M&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case S:e:{for(var ze=fe.key;se!==null;){if(se.key===ze){if(ze=fe.type,ze===M){if(se.tag===7){l(ce,se.sibling),Te=h(se,fe.props.children),Te.return=ce,ce=Te;break e}}else if(se.elementType===ze||typeof ze=="object"&&ze!==null&&ze.$$typeof===J&&Lp(ze)===se.type){l(ce,se.sibling),Te=h(se,fe.props),Rl(Te,fe),Te.return=ce,ce=Te;break e}l(ce,se);break}else s(ce,se);se=se.sibling}fe.type===M?(Te=ai(fe.props.children,ce.mode,Te,fe.key),Te.return=ce,ce=Te):(Te=xo(fe.type,fe.key,fe.props,null,ce.mode,Te),Rl(Te,fe),Te.return=ce,ce=Te)}return k(ce);case E:e:{for(ze=fe.key;se!==null;){if(se.key===ze)if(se.tag===4&&se.stateNode.containerInfo===fe.containerInfo&&se.stateNode.implementation===fe.implementation){l(ce,se.sibling),Te=h(se,fe.children||[]),Te.return=ce,ce=Te;break e}else{l(ce,se);break}else s(ce,se);se=se.sibling}Te=Vc(fe,ce.mode,Te),Te.return=ce,ce=Te}return k(ce);case J:return ze=fe._init,fe=ze(fe._payload),Ft(ce,se,fe,Te)}if(re(fe))return at(ce,se,fe,Te);if(K(fe)){if(ze=K(fe),typeof ze!="function")throw Error(i(150));return fe=ze.call(fe),Qe(ce,se,fe,Te)}if(typeof fe.then=="function")return Ft(ce,se,jo(fe),Te);if(fe.$$typeof===_)return Ft(ce,se,Ao(ce,fe),Te);Bo(ce,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"||typeof fe=="bigint"?(fe=""+fe,se!==null&&se.tag===6?(l(ce,se.sibling),Te=h(se,fe),Te.return=ce,ce=Te):(l(ce,se),Te=qc(fe,ce.mode,Te),Te.return=ce,ce=Te),k(ce)):l(ce,se)}return function(ce,se,fe,Te){try{kl=0;var ze=Ft(ce,se,fe,Te);return Fi=null,ze}catch(Xe){if(Xe===xl||Xe===Co)throw Xe;var bt=Da(29,Xe,null,ce.mode);return bt.lanes=Te,bt.return=ce,bt}}}var Pi=Up(!0),jp=Up(!1),Ka=Q(null),Rr=null;function As(n){var s=n.alternate;ke(Mn,Mn.current&1),ke(Ka,n),Rr===null&&(s===null||Li.current!==null||s.memoizedState!==null)&&(Rr=n)}function Bp(n){if(n.tag===22){if(ke(Mn,Mn.current),ke(Ka,n),Rr===null){var s=n.alternate;s!==null&&s.memoizedState!==null&&(Rr=n)}}else Ts()}function Ts(){ke(Mn,Mn.current),ke(Ka,Ka.current)}function es(n){be(Ka),Rr===n&&(Rr=null),be(Mn)}var Mn=Q(0);function Fo(n){for(var s=n;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||mf(l)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Tu(n,s,l,u){s=n.memoizedState,l=l(u,s),l=l==null?s:x({},s,l),n.memoizedState=l,n.lanes===0&&(n.updateQueue.baseState=l)}var Cu={enqueueSetState:function(n,s,l){n=n._reactInternals;var u=La(),h=Ss(u);h.payload=s,l!=null&&(h.callback=l),s=Es(n,h,u),s!==null&&(Ua(s,n,u),El(s,n,u))},enqueueReplaceState:function(n,s,l){n=n._reactInternals;var u=La(),h=Ss(u);h.tag=1,h.payload=s,l!=null&&(h.callback=l),s=Es(n,h,u),s!==null&&(Ua(s,n,u),El(s,n,u))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var l=La(),u=Ss(l);u.tag=2,s!=null&&(u.callback=s),s=Es(n,u,l),s!==null&&(Ua(s,n,l),El(s,n,l))}};function Fp(n,s,l,u,h,y,k){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,y,k):s.prototype&&s.prototype.isPureReactComponent?!dl(l,u)||!dl(h,y):!0}function Pp(n,s,l,u){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,u),s.state!==n&&Cu.enqueueReplaceState(s,s.state,null)}function di(n,s){var l=s;if("ref"in s){l={};for(var u in s)u!=="ref"&&(l[u]=s[u])}if(n=n.defaultProps){l===s&&(l=x({},l));for(var h in n)l[h]===void 0&&(l[h]=n[h])}return l}var Po=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function zp(n){Po(n)}function Gp(n){console.error(n)}function Hp(n){Po(n)}function zo(n,s){try{var l=n.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function Yp(n,s,l){try{var u=n.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function Mu(n,s,l){return l=Ss(l),l.tag=3,l.payload={element:null},l.callback=function(){zo(n,s)},l}function qp(n){return n=Ss(n),n.tag=3,n}function Vp(n,s,l,u){var h=l.type.getDerivedStateFromError;if(typeof h=="function"){var y=u.value;n.payload=function(){return h(y)},n.callback=function(){Yp(s,l,u)}}var k=l.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(n.callback=function(){Yp(s,l,u),typeof h!="function"&&(Ds===null?Ds=new Set([this]):Ds.add(this));var B=u.stack;this.componentDidCatch(u.value,{componentStack:B!==null?B:""})})}function yy(n,s,l,u,h){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=l.alternate,s!==null&&yl(s,l,h,!0),l=Ka.current,l!==null){switch(l.tag){case 13:return Rr===null?Qu():l.alternate===null&&cn===0&&(cn=3),l.flags&=-257,l.flags|=65536,l.lanes=h,u===nu?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([u]):s.add(u),Ju(n,u,h)),!1;case 22:return l.flags|=65536,u===nu?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([u]):l.add(u)),Ju(n,u,h)),!1}throw Error(i(435,l.tag))}return Ju(n,u,h),Qu(),!1}if(Rt)return s=Ka.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=h,u!==Wc&&(n=Error(i(422),{cause:u}),gl($a(n,l)))):(u!==Wc&&(s=Error(i(423),{cause:u}),gl($a(s,l))),n=n.current.alternate,n.flags|=65536,h&=-h,n.lanes|=h,u=$a(u,l),h=Mu(n.stateNode,u,h),su(n,h),cn!==4&&(cn=2)),!1;var y=Error(i(520),{cause:u});if(y=$a(y,l),jl===null?jl=[y]:jl.push(y),cn!==4&&(cn=2),s===null)return!0;u=$a(u,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,n=h&-h,l.lanes|=n,n=Mu(l.stateNode,u,n),su(l,n),!1;case 1:if(s=l.type,y=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ds===null||!Ds.has(y))))return l.flags|=65536,h&=-h,l.lanes|=h,h=qp(h),Vp(h,n,l,u),su(l,h),!1}l=l.return}while(l!==null);return!1}var Xp=Error(i(461)),On=!1;function zn(n,s,l,u){s.child=n===null?jp(s,null,l,u):Pi(s,n.child,l,u)}function $p(n,s,l,u,h){l=l.render;var y=s.ref;if("ref"in u){var k={};for(var B in u)B!=="ref"&&(k[B]=u[B])}else k=u;return ci(s),u=uu(n,s,l,k,y,h),B=fu(),n!==null&&!On?(du(n,s,h),ts(n,s,h)):(Rt&&B&&Xc(s),s.flags|=1,zn(n,s,u,h),s.child)}function Wp(n,s,l,u,h){if(n===null){var y=l.type;return typeof y=="function"&&!Yc(y)&&y.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=y,Zp(n,s,y,u,h)):(n=xo(l.type,null,u,s,s.mode,h),n.ref=s.ref,n.return=s,s.child=n)}if(y=n.child,!Lu(n,h)){var k=y.memoizedProps;if(l=l.compare,l=l!==null?l:dl,l(k,u)&&n.ref===s.ref)return ts(n,s,h)}return s.flags|=1,n=$r(y,u),n.ref=s.ref,n.return=s,s.child=n}function Zp(n,s,l,u,h){if(n!==null){var y=n.memoizedProps;if(dl(y,u)&&n.ref===s.ref)if(On=!1,s.pendingProps=u=y,Lu(n,h))(n.flags&131072)!==0&&(On=!0);else return s.lanes=n.lanes,ts(n,s,h)}return Nu(n,s,l,u,h)}function Qp(n,s,l){var u=s.pendingProps,h=u.children,y=n!==null?n.memoizedState:null;if(u.mode==="hidden"){if((s.flags&128)!==0){if(u=y!==null?y.baseLanes|l:l,n!==null){for(h=s.child=n.child,y=0;h!==null;)y=y|h.lanes|h.childLanes,h=h.sibling;s.childLanes=y&~u}else s.childLanes=0,s.child=null;return Kp(n,s,u,l)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&To(s,y!==null?y.cachePool:null),y!==null?Zd(s,y):lu(),Bp(s);else return s.lanes=s.childLanes=536870912,Kp(n,s,y!==null?y.baseLanes|l:l,l)}else y!==null?(To(s,y.cachePool),Zd(s,y),Ts(),s.memoizedState=null):(n!==null&&To(s,null),lu(),Ts());return zn(n,s,h,l),s.child}function Kp(n,s,l,u){var h=tu();return h=h===null?null:{parent:Cn._currentValue,pool:h},s.memoizedState={baseLanes:l,cachePool:h},n!==null&&To(s,null),lu(),Bp(s),n!==null&&yl(n,s,u,!0),null}function Go(n,s){var l=s.ref;if(l===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(n===null||n.ref!==l)&&(s.flags|=4194816)}}function Nu(n,s,l,u,h){return ci(s),l=uu(n,s,l,u,void 0,h),u=fu(),n!==null&&!On?(du(n,s,h),ts(n,s,h)):(Rt&&u&&Xc(s),s.flags|=1,zn(n,s,l,h),s.child)}function Jp(n,s,l,u,h,y){return ci(s),s.updateQueue=null,l=Kd(s,u,l,h),Qd(n),u=fu(),n!==null&&!On?(du(n,s,y),ts(n,s,y)):(Rt&&u&&Xc(s),s.flags|=1,zn(n,s,l,y),s.child)}function eh(n,s,l,u,h){if(ci(s),s.stateNode===null){var y=Ri,k=l.contextType;typeof k=="object"&&k!==null&&(y=Zn(k)),y=new l(u,y),s.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Cu,s.stateNode=y,y._reactInternals=s,y=s.stateNode,y.props=u,y.state=s.memoizedState,y.refs={},au(s),k=l.contextType,y.context=typeof k=="object"&&k!==null?Zn(k):Ri,y.state=s.memoizedState,k=l.getDerivedStateFromProps,typeof k=="function"&&(Tu(s,l,k,u),y.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(k=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),k!==y.state&&Cu.enqueueReplaceState(y,y.state,null),Al(s,u,y,h),wl(),y.state=s.memoizedState),typeof y.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(n===null){y=s.stateNode;var B=s.memoizedProps,te=di(l,B);y.props=te;var de=y.context,Ae=l.contextType;k=Ri,typeof Ae=="object"&&Ae!==null&&(k=Zn(Ae));var Ne=l.getDerivedStateFromProps;Ae=typeof Ne=="function"||typeof y.getSnapshotBeforeUpdate=="function",B=s.pendingProps!==B,Ae||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(B||de!==k)&&Pp(s,y,u,k),xs=!1;var me=s.memoizedState;y.state=me,Al(s,u,y,h),wl(),de=s.memoizedState,B||me!==de||xs?(typeof Ne=="function"&&(Tu(s,l,Ne,u),de=s.memoizedState),(te=xs||Fp(s,l,te,u,me,de,k))?(Ae||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(s.flags|=4194308)):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=de),y.props=u,y.state=de,y.context=k,u=te):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{y=s.stateNode,ru(n,s),k=s.memoizedProps,Ae=di(l,k),y.props=Ae,Ne=s.pendingProps,me=y.context,de=l.contextType,te=Ri,typeof de=="object"&&de!==null&&(te=Zn(de)),B=l.getDerivedStateFromProps,(de=typeof B=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(k!==Ne||me!==te)&&Pp(s,y,u,te),xs=!1,me=s.memoizedState,y.state=me,Al(s,u,y,h),wl();var ge=s.memoizedState;k!==Ne||me!==ge||xs||n!==null&&n.dependencies!==null&&wo(n.dependencies)?(typeof B=="function"&&(Tu(s,l,B,u),ge=s.memoizedState),(Ae=xs||Fp(s,l,Ae,u,me,ge,te)||n!==null&&n.dependencies!==null&&wo(n.dependencies))?(de||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(u,ge,te),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(u,ge,te)),typeof y.componentDidUpdate=="function"&&(s.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof y.componentDidUpdate!="function"||k===n.memoizedProps&&me===n.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||k===n.memoizedProps&&me===n.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=ge),y.props=u,y.state=ge,y.context=te,u=Ae):(typeof y.componentDidUpdate!="function"||k===n.memoizedProps&&me===n.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||k===n.memoizedProps&&me===n.memoizedState||(s.flags|=1024),u=!1)}return y=u,Go(n,s),u=(s.flags&128)!==0,y||u?(y=s.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:y.render(),s.flags|=1,n!==null&&u?(s.child=Pi(s,n.child,null,h),s.child=Pi(s,null,l,h)):zn(n,s,l,h),s.memoizedState=y.state,n=s.child):n=ts(n,s,h),n}function th(n,s,l,u){return ml(),s.flags|=256,zn(n,s,l,u),s.child}var ku={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ru(n){return{baseLanes:n,cachePool:Gd()}}function Du(n,s,l){return n=n!==null?n.childLanes&~l:0,s&&(n|=Ja),n}function nh(n,s,l){var u=s.pendingProps,h=!1,y=(s.flags&128)!==0,k;if((k=y)||(k=n!==null&&n.memoizedState===null?!1:(Mn.current&2)!==0),k&&(h=!0,s.flags&=-129),k=(s.flags&32)!==0,s.flags&=-33,n===null){if(Rt){if(h?As(s):Ts(),Rt){var B=on,te;if(te=B){e:{for(te=B,B=kr;te.nodeType!==8;){if(!B){B=null;break e}if(te=dr(te.nextSibling),te===null){B=null;break e}}B=te}B!==null?(s.memoizedState={dehydrated:B,treeContext:ri!==null?{id:Wr,overflow:Zr}:null,retryLane:536870912,hydrationErrors:null},te=Da(18,null,null,0),te.stateNode=B,te.return=s,s.child=te,ia=s,on=null,te=!0):te=!1}te||li(s)}if(B=s.memoizedState,B!==null&&(B=B.dehydrated,B!==null))return mf(B)?s.lanes=32:s.lanes=536870912,null;es(s)}return B=u.children,u=u.fallback,h?(Ts(),h=s.mode,B=Ho({mode:"hidden",children:B},h),u=ai(u,h,l,null),B.return=s,u.return=s,B.sibling=u,s.child=B,h=s.child,h.memoizedState=Ru(l),h.childLanes=Du(n,k,l),s.memoizedState=ku,u):(As(s),_u(s,B))}if(te=n.memoizedState,te!==null&&(B=te.dehydrated,B!==null)){if(y)s.flags&256?(As(s),s.flags&=-257,s=Ou(n,s,l)):s.memoizedState!==null?(Ts(),s.child=n.child,s.flags|=128,s=null):(Ts(),h=u.fallback,B=s.mode,u=Ho({mode:"visible",children:u.children},B),h=ai(h,B,l,null),h.flags|=2,u.return=s,h.return=s,u.sibling=h,s.child=u,Pi(s,n.child,null,l),u=s.child,u.memoizedState=Ru(l),u.childLanes=Du(n,k,l),s.memoizedState=ku,s=h);else if(As(s),mf(B)){if(k=B.nextSibling&&B.nextSibling.dataset,k)var de=k.dgst;k=de,u=Error(i(419)),u.stack="",u.digest=k,gl({value:u,source:null,stack:null}),s=Ou(n,s,l)}else if(On||yl(n,s,l,!1),k=(l&n.childLanes)!==0,On||k){if(k=Vt,k!==null&&(u=l&-l,u=(u&42)!==0?1:oa(u),u=(u&(k.suspendedLanes|l))!==0?0:u,u!==0&&u!==te.retryLane))throw te.retryLane=u,ki(n,u),Ua(k,n,u),Xp;B.data==="$?"||Qu(),s=Ou(n,s,l)}else B.data==="$?"?(s.flags|=192,s.child=n.child,s=null):(n=te.treeContext,on=dr(B.nextSibling),ia=s,Rt=!0,ii=null,kr=!1,n!==null&&(Za[Qa++]=Wr,Za[Qa++]=Zr,Za[Qa++]=ri,Wr=n.id,Zr=n.overflow,ri=s),s=_u(s,u.children),s.flags|=4096);return s}return h?(Ts(),h=u.fallback,B=s.mode,te=n.child,de=te.sibling,u=$r(te,{mode:"hidden",children:u.children}),u.subtreeFlags=te.subtreeFlags&65011712,de!==null?h=$r(de,h):(h=ai(h,B,l,null),h.flags|=2),h.return=s,u.return=s,u.sibling=h,s.child=u,u=h,h=s.child,B=n.child.memoizedState,B===null?B=Ru(l):(te=B.cachePool,te!==null?(de=Cn._currentValue,te=te.parent!==de?{parent:de,pool:de}:te):te=Gd(),B={baseLanes:B.baseLanes|l,cachePool:te}),h.memoizedState=B,h.childLanes=Du(n,k,l),s.memoizedState=ku,u):(As(s),l=n.child,n=l.sibling,l=$r(l,{mode:"visible",children:u.children}),l.return=s,l.sibling=null,n!==null&&(k=s.deletions,k===null?(s.deletions=[n],s.flags|=16):k.push(n)),s.child=l,s.memoizedState=null,l)}function _u(n,s){return s=Ho({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function Ho(n,s){return n=Da(22,n,null,s),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function Ou(n,s,l){return Pi(s,n.child,null,l),n=_u(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function ah(n,s,l){n.lanes|=s;var u=n.alternate;u!==null&&(u.lanes|=s),Qc(n.return,s,l)}function Iu(n,s,l,u,h){var y=n.memoizedState;y===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:h}:(y.isBackwards=s,y.rendering=null,y.renderingStartTime=0,y.last=u,y.tail=l,y.tailMode=h)}function rh(n,s,l){var u=s.pendingProps,h=u.revealOrder,y=u.tail;if(zn(n,s,u.children,l),u=Mn.current,(u&2)!==0)u=u&1|2,s.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&ah(n,l,s);else if(n.tag===19)ah(n,l,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}u&=1}switch(ke(Mn,u),h){case"forwards":for(l=s.child,h=null;l!==null;)n=l.alternate,n!==null&&Fo(n)===null&&(h=l),l=l.sibling;l=h,l===null?(h=s.child,s.child=null):(h=l.sibling,l.sibling=null),Iu(s,!1,h,l,y);break;case"backwards":for(l=null,h=s.child,s.child=null;h!==null;){if(n=h.alternate,n!==null&&Fo(n)===null){s.child=h;break}n=h.sibling,h.sibling=l,l=h,h=n}Iu(s,!0,l,null,y);break;case"together":Iu(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function ts(n,s,l){if(n!==null&&(s.dependencies=n.dependencies),Rs|=s.lanes,(l&s.childLanes)===0)if(n!==null){if(yl(n,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,l=$r(n,n.pendingProps),s.child=l,l.return=s;n.sibling!==null;)n=n.sibling,l=l.sibling=$r(n,n.pendingProps),l.return=s;l.sibling=null}return s.child}function Lu(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&wo(n)))}function vy(n,s,l){switch(s.tag){case 3:Ye(s,s.stateNode.containerInfo),bs(s,Cn,n.memoizedState.cache),ml();break;case 27:case 5:yn(s);break;case 4:Ye(s,s.stateNode.containerInfo);break;case 10:bs(s,s.type,s.memoizedProps.value);break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(As(s),s.flags|=128,null):(l&s.child.childLanes)!==0?nh(n,s,l):(As(s),n=ts(n,s,l),n!==null?n.sibling:null);As(s);break;case 19:var h=(n.flags&128)!==0;if(u=(l&s.childLanes)!==0,u||(yl(n,s,l,!1),u=(l&s.childLanes)!==0),h){if(u)return rh(n,s,l);s.flags|=128}if(h=s.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),ke(Mn,Mn.current),u)break;return null;case 22:case 23:return s.lanes=0,Qp(n,s,l);case 24:bs(s,Cn,n.memoizedState.cache)}return ts(n,s,l)}function sh(n,s,l){if(n!==null)if(n.memoizedProps!==s.pendingProps)On=!0;else{if(!Lu(n,l)&&(s.flags&128)===0)return On=!1,vy(n,s,l);On=(n.flags&131072)!==0}else On=!1,Rt&&(s.flags&1048576)!==0&&Ld(s,Eo,s.index);switch(s.lanes=0,s.tag){case 16:e:{n=s.pendingProps;var u=s.elementType,h=u._init;if(u=h(u._payload),s.type=u,typeof u=="function")Yc(u)?(n=di(u,n),s.tag=1,s=eh(null,s,u,n,l)):(s.tag=0,s=Nu(null,s,u,n,l));else{if(u!=null){if(h=u.$$typeof,h===L){s.tag=11,s=$p(null,s,u,n,l);break e}else if(h===$){s.tag=14,s=Wp(null,s,u,n,l);break e}}throw s=W(u)||u,Error(i(306,s,""))}}return s;case 0:return Nu(n,s,s.type,s.pendingProps,l);case 1:return u=s.type,h=di(u,s.pendingProps),eh(n,s,u,h,l);case 3:e:{if(Ye(s,s.stateNode.containerInfo),n===null)throw Error(i(387));u=s.pendingProps;var y=s.memoizedState;h=y.element,ru(n,s),Al(s,u,null,l);var k=s.memoizedState;if(u=k.cache,bs(s,Cn,u),u!==y.cache&&Kc(s,[Cn],l,!0),wl(),u=k.element,y.isDehydrated)if(y={element:u,isDehydrated:!1,cache:k.cache},s.updateQueue.baseState=y,s.memoizedState=y,s.flags&256){s=th(n,s,u,l);break e}else if(u!==h){h=$a(Error(i(424)),s),gl(h),s=th(n,s,u,l);break e}else for(n=s.stateNode.containerInfo,n.nodeType===9?n=n.body:n=n.nodeName==="HTML"?n.ownerDocument.body:n,on=dr(n.firstChild),ia=s,Rt=!0,ii=null,kr=!0,l=jp(s,null,u,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(ml(),u===h){s=ts(n,s,l);break e}zn(n,s,u,l)}s=s.child}return s;case 26:return Go(n,s),n===null?(l=c0(s.type,null,s.pendingProps,null))?s.memoizedState=l:Rt||(l=s.type,n=s.pendingProps,u=ac(Oe.current).createElement(l),u[sn]=s,u[Gt]=n,Hn(u,l,n),Ct(u),s.stateNode=u):s.memoizedState=c0(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return yn(s),n===null&&Rt&&(u=s.stateNode=i0(s.type,s.pendingProps,Oe.current),ia=s,kr=!0,h=on,Is(s.type)?(gf=h,on=dr(u.firstChild)):on=h),zn(n,s,s.pendingProps.children,l),Go(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&Rt&&((h=u=on)&&(u=Vy(u,s.type,s.pendingProps,kr),u!==null?(s.stateNode=u,ia=s,on=dr(u.firstChild),kr=!1,h=!0):h=!1),h||li(s)),yn(s),h=s.type,y=s.pendingProps,k=n!==null?n.memoizedProps:null,u=y.children,df(h,y)?u=null:k!==null&&df(h,k)&&(s.flags|=32),s.memoizedState!==null&&(h=uu(n,s,uy,null,null,l),Vl._currentValue=h),Go(n,s),zn(n,s,u,l),s.child;case 6:return n===null&&Rt&&((n=l=on)&&(l=Xy(l,s.pendingProps,kr),l!==null?(s.stateNode=l,ia=s,on=null,n=!0):n=!1),n||li(s)),null;case 13:return nh(n,s,l);case 4:return Ye(s,s.stateNode.containerInfo),u=s.pendingProps,n===null?s.child=Pi(s,null,u,l):zn(n,s,u,l),s.child;case 11:return $p(n,s,s.type,s.pendingProps,l);case 7:return zn(n,s,s.pendingProps,l),s.child;case 8:return zn(n,s,s.pendingProps.children,l),s.child;case 12:return zn(n,s,s.pendingProps.children,l),s.child;case 10:return u=s.pendingProps,bs(s,s.type,u.value),zn(n,s,u.children,l),s.child;case 9:return h=s.type._context,u=s.pendingProps.children,ci(s),h=Zn(h),u=u(h),s.flags|=1,zn(n,s,u,l),s.child;case 14:return Wp(n,s,s.type,s.pendingProps,l);case 15:return Zp(n,s,s.type,s.pendingProps,l);case 19:return rh(n,s,l);case 31:return u=s.pendingProps,l=s.mode,u={mode:u.mode,children:u.children},n===null?(l=Ho(u,l),l.ref=s.ref,s.child=l,l.return=s,s=l):(l=$r(n.child,u),l.ref=s.ref,s.child=l,l.return=s,s=l),s;case 22:return Qp(n,s,l);case 24:return ci(s),u=Zn(Cn),n===null?(h=tu(),h===null&&(h=Vt,y=Jc(),h.pooledCache=y,y.refCount++,y!==null&&(h.pooledCacheLanes|=l),h=y),s.memoizedState={parent:u,cache:h},au(s),bs(s,Cn,h)):((n.lanes&l)!==0&&(ru(n,s),Al(s,null,null,l),wl()),h=n.memoizedState,y=s.memoizedState,h.parent!==u?(h={parent:u,cache:u},s.memoizedState=h,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=h),bs(s,Cn,u)):(u=y.cache,bs(s,Cn,u),u!==h.cache&&Kc(s,[Cn],l,!0))),zn(n,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function ns(n){n.flags|=4}function ih(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!h0(s)){if(s=Ka.current,s!==null&&((Tt&4194048)===Tt?Rr!==null:(Tt&62914560)!==Tt&&(Tt&536870912)===0||s!==Rr))throw Sl=nu,Hd;n.flags|=8192}}function Yo(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?ea():536870912,n.lanes|=s,Yi|=s)}function Dl(n,s){if(!Rt)switch(n.tailMode){case"hidden":s=n.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n.tail=null:l.sibling=null;break;case"collapsed":l=n.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function an(n){var s=n.alternate!==null&&n.alternate.child===n.child,l=0,u=0;if(s)for(var h=n.child;h!==null;)l|=h.lanes|h.childLanes,u|=h.subtreeFlags&65011712,u|=h.flags&65011712,h.return=n,h=h.sibling;else for(h=n.child;h!==null;)l|=h.lanes|h.childLanes,u|=h.subtreeFlags,u|=h.flags,h.return=n,h=h.sibling;return n.subtreeFlags|=u,n.childLanes=l,s}function by(n,s,l){var u=s.pendingProps;switch($c(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(s),null;case 1:return an(s),null;case 3:return l=s.stateNode,u=null,n!==null&&(u=n.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Kr(Cn),Je(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(n===null||n.child===null)&&(hl(s)?ns(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Bd())),an(s),null;case 26:return l=s.memoizedState,n===null?(ns(s),l!==null?(an(s),ih(s,l)):(an(s),s.flags&=-16777217)):l?l!==n.memoizedState?(ns(s),an(s),ih(s,l)):(an(s),s.flags&=-16777217):(n.memoizedProps!==u&&ns(s),an(s),s.flags&=-16777217),null;case 27:_t(s),l=Oe.current;var h=s.type;if(n!==null&&s.stateNode!=null)n.memoizedProps!==u&&ns(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return an(s),null}n=ve.current,hl(s)?Ud(s):(n=i0(h,u,l),s.stateNode=n,ns(s))}return an(s),null;case 5:if(_t(s),l=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==u&&ns(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return an(s),null}if(n=ve.current,hl(s))Ud(s);else{switch(h=ac(Oe.current),n){case 1:n=h.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:n=h.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":n=h.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":n=h.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":n=h.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof u.is=="string"?h.createElement("select",{is:u.is}):h.createElement("select"),u.multiple?n.multiple=!0:u.size&&(n.size=u.size);break;default:n=typeof u.is=="string"?h.createElement(l,{is:u.is}):h.createElement(l)}}n[sn]=s,n[Gt]=u;e:for(h=s.child;h!==null;){if(h.tag===5||h.tag===6)n.appendChild(h.stateNode);else if(h.tag!==4&&h.tag!==27&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break e;for(;h.sibling===null;){if(h.return===null||h.return===s)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}s.stateNode=n;e:switch(Hn(n,l,u),l){case"button":case"input":case"select":case"textarea":n=!!u.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&ns(s)}}return an(s),s.flags&=-16777217,null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==u&&ns(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(i(166));if(n=Oe.current,hl(s)){if(n=s.stateNode,l=s.memoizedProps,u=null,h=ia,h!==null)switch(h.tag){case 27:case 5:u=h.memoizedProps}n[sn]=s,n=!!(n.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||Jh(n.nodeValue,l)),n||li(s)}else n=ac(n).createTextNode(u),n[sn]=s,s.stateNode=n}return an(s),null;case 13:if(u=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(h=hl(s),u!==null&&u.dehydrated!==null){if(n===null){if(!h)throw Error(i(318));if(h=s.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));h[sn]=s}else ml(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;an(s),h=!1}else h=Bd(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=h),h=!0;if(!h)return s.flags&256?(es(s),s):(es(s),null)}if(es(s),(s.flags&128)!==0)return s.lanes=l,s;if(l=u!==null,n=n!==null&&n.memoizedState!==null,l){u=s.child,h=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(h=u.alternate.memoizedState.cachePool.pool);var y=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),y!==h&&(u.flags|=2048)}return l!==n&&l&&(s.child.flags|=8192),Yo(s,s.updateQueue),an(s),null;case 4:return Je(),n===null&&lf(s.stateNode.containerInfo),an(s),null;case 10:return Kr(s.type),an(s),null;case 19:if(be(Mn),h=s.memoizedState,h===null)return an(s),null;if(u=(s.flags&128)!==0,y=h.rendering,y===null)if(u)Dl(h,!1);else{if(cn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(y=Fo(n),y!==null){for(s.flags|=128,Dl(h,!1),n=y.updateQueue,s.updateQueue=n,Yo(s,n),s.subtreeFlags=0,n=l,l=s.child;l!==null;)Id(l,n),l=l.sibling;return ke(Mn,Mn.current&1|2),s.child}n=n.sibling}h.tail!==null&&Ie()>Xo&&(s.flags|=128,u=!0,Dl(h,!1),s.lanes=4194304)}else{if(!u)if(n=Fo(y),n!==null){if(s.flags|=128,u=!0,n=n.updateQueue,s.updateQueue=n,Yo(s,n),Dl(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!Rt)return an(s),null}else 2*Ie()-h.renderingStartTime>Xo&&l!==536870912&&(s.flags|=128,u=!0,Dl(h,!1),s.lanes=4194304);h.isBackwards?(y.sibling=s.child,s.child=y):(n=h.last,n!==null?n.sibling=y:s.child=y,h.last=y)}return h.tail!==null?(s=h.tail,h.rendering=s,h.tail=s.sibling,h.renderingStartTime=Ie(),s.sibling=null,n=Mn.current,ke(Mn,u?n&1|2:n&1),s):(an(s),null);case 22:case 23:return es(s),ou(),u=s.memoizedState!==null,n!==null?n.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(l&536870912)!==0&&(s.flags&128)===0&&(an(s),s.subtreeFlags&6&&(s.flags|=8192)):an(s),l=s.updateQueue,l!==null&&Yo(s,l.retryQueue),l=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==l&&(s.flags|=2048),n!==null&&be(ui),null;case 24:return l=null,n!==null&&(l=n.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Kr(Cn),an(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function xy(n,s){switch($c(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Kr(Cn),Je(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return _t(s),null;case 13:if(es(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));ml()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return be(Mn),null;case 4:return Je(),null;case 10:return Kr(s.type),null;case 22:case 23:return es(s),ou(),n!==null&&be(ui),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return Kr(Cn),null;case 25:return null;default:return null}}function lh(n,s){switch($c(s),s.tag){case 3:Kr(Cn),Je();break;case 26:case 27:case 5:_t(s);break;case 4:Je();break;case 13:es(s);break;case 19:be(Mn);break;case 10:Kr(s.type);break;case 22:case 23:es(s),ou(),n!==null&&be(ui);break;case 24:Kr(Cn)}}function _l(n,s){try{var l=s.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var h=u.next;l=h;do{if((l.tag&n)===n){u=void 0;var y=l.create,k=l.inst;u=y(),k.destroy=u}l=l.next}while(l!==h)}}catch(B){zt(s,s.return,B)}}function Cs(n,s,l){try{var u=s.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var y=h.next;u=y;do{if((u.tag&n)===n){var k=u.inst,B=k.destroy;if(B!==void 0){k.destroy=void 0,h=s;var te=l,de=B;try{de()}catch(Ae){zt(h,te,Ae)}}}u=u.next}while(u!==y)}}catch(Ae){zt(s,s.return,Ae)}}function oh(n){var s=n.updateQueue;if(s!==null){var l=n.stateNode;try{Wd(s,l)}catch(u){zt(n,n.return,u)}}}function ch(n,s,l){l.props=di(n.type,n.memoizedProps),l.state=n.memoizedState;try{l.componentWillUnmount()}catch(u){zt(n,s,u)}}function Ol(n,s){try{var l=n.ref;if(l!==null){switch(n.tag){case 26:case 27:case 5:var u=n.stateNode;break;case 30:u=n.stateNode;break;default:u=n.stateNode}typeof l=="function"?n.refCleanup=l(u):l.current=u}}catch(h){zt(n,s,h)}}function Dr(n,s){var l=n.ref,u=n.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(h){zt(n,s,h)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(h){zt(n,s,h)}else l.current=null}function uh(n){var s=n.type,l=n.memoizedProps,u=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(h){zt(n,n.return,h)}}function Uu(n,s,l){try{var u=n.stateNode;zy(u,n.type,l,s),u[Gt]=s}catch(h){zt(n,n.return,h)}}function fh(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Is(n.type)||n.tag===4}function ju(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||fh(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Is(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Bu(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(n,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(n),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=nc));else if(u!==4&&(u===27&&Is(n.type)&&(l=n.stateNode,s=null),n=n.child,n!==null))for(Bu(n,s,l),n=n.sibling;n!==null;)Bu(n,s,l),n=n.sibling}function qo(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?l.insertBefore(n,s):l.appendChild(n);else if(u!==4&&(u===27&&Is(n.type)&&(l=n.stateNode),n=n.child,n!==null))for(qo(n,s,l),n=n.sibling;n!==null;)qo(n,s,l),n=n.sibling}function dh(n){var s=n.stateNode,l=n.memoizedProps;try{for(var u=n.type,h=s.attributes;h.length;)s.removeAttributeNode(h[0]);Hn(s,u,l),s[sn]=n,s[Gt]=l}catch(y){zt(n,n.return,y)}}var as=!1,mn=!1,Fu=!1,ph=typeof WeakSet=="function"?WeakSet:Set,In=null;function Sy(n,s){if(n=n.containerInfo,uf=cc,n=Ad(n),jc(n)){if("selectionStart"in n)var l={start:n.selectionStart,end:n.selectionEnd};else e:{l=(l=n.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var h=u.anchorOffset,y=u.focusNode;u=u.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break e}var k=0,B=-1,te=-1,de=0,Ae=0,Ne=n,me=null;t:for(;;){for(var ge;Ne!==l||h!==0&&Ne.nodeType!==3||(B=k+h),Ne!==y||u!==0&&Ne.nodeType!==3||(te=k+u),Ne.nodeType===3&&(k+=Ne.nodeValue.length),(ge=Ne.firstChild)!==null;)me=Ne,Ne=ge;for(;;){if(Ne===n)break t;if(me===l&&++de===h&&(B=k),me===y&&++Ae===u&&(te=k),(ge=Ne.nextSibling)!==null)break;Ne=me,me=Ne.parentNode}Ne=ge}l=B===-1||te===-1?null:{start:B,end:te}}else l=null}l=l||{start:0,end:0}}else l=null;for(ff={focusedElem:n,selectionRange:l},cc=!1,In=s;In!==null;)if(s=In,n=s.child,(s.subtreeFlags&1024)!==0&&n!==null)n.return=s,In=n;else for(;In!==null;){switch(s=In,y=s.alternate,n=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&y!==null){n=void 0,l=s,h=y.memoizedProps,y=y.memoizedState,u=l.stateNode;try{var at=di(l.type,h,l.elementType===l.type);n=u.getSnapshotBeforeUpdate(at,y),u.__reactInternalSnapshotBeforeUpdate=n}catch(Qe){zt(l,l.return,Qe)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,l=n.nodeType,l===9)hf(n);else if(l===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":hf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,In=n;break}In=s.return}}function hh(n,s,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:Ms(n,l),u&4&&_l(5,l);break;case 1:if(Ms(n,l),u&4)if(n=l.stateNode,s===null)try{n.componentDidMount()}catch(k){zt(l,l.return,k)}else{var h=di(l.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(h,s,n.__reactInternalSnapshotBeforeUpdate)}catch(k){zt(l,l.return,k)}}u&64&&oh(l),u&512&&Ol(l,l.return);break;case 3:if(Ms(n,l),u&64&&(n=l.updateQueue,n!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Wd(n,s)}catch(k){zt(l,l.return,k)}}break;case 27:s===null&&u&4&&dh(l);case 26:case 5:Ms(n,l),s===null&&u&4&&uh(l),u&512&&Ol(l,l.return);break;case 12:Ms(n,l);break;case 13:Ms(n,l),u&4&&yh(n,l),u&64&&(n=l.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(l=Ry.bind(null,l),$y(n,l))));break;case 22:if(u=l.memoizedState!==null||as,!u){s=s!==null&&s.memoizedState!==null||mn,h=as;var y=mn;as=u,(mn=s)&&!y?Ns(n,l,(l.subtreeFlags&8772)!==0):Ms(n,l),as=h,mn=y}break;case 30:break;default:Ms(n,l)}}function mh(n){var s=n.alternate;s!==null&&(n.alternate=null,mh(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&sr(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Qt=null,ba=!1;function rs(n,s,l){for(l=l.child;l!==null;)gh(n,s,l),l=l.sibling}function gh(n,s,l){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(qn,l)}catch{}switch(l.tag){case 26:mn||Dr(l,s),rs(n,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:mn||Dr(l,s);var u=Qt,h=ba;Is(l.type)&&(Qt=l.stateNode,ba=!1),rs(n,s,l),Gl(l.stateNode),Qt=u,ba=h;break;case 5:mn||Dr(l,s);case 6:if(u=Qt,h=ba,Qt=null,rs(n,s,l),Qt=u,ba=h,Qt!==null)if(ba)try{(Qt.nodeType===9?Qt.body:Qt.nodeName==="HTML"?Qt.ownerDocument.body:Qt).removeChild(l.stateNode)}catch(y){zt(l,s,y)}else try{Qt.removeChild(l.stateNode)}catch(y){zt(l,s,y)}break;case 18:Qt!==null&&(ba?(n=Qt,r0(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,l.stateNode),Zl(n)):r0(Qt,l.stateNode));break;case 4:u=Qt,h=ba,Qt=l.stateNode.containerInfo,ba=!0,rs(n,s,l),Qt=u,ba=h;break;case 0:case 11:case 14:case 15:mn||Cs(2,l,s),mn||Cs(4,l,s),rs(n,s,l);break;case 1:mn||(Dr(l,s),u=l.stateNode,typeof u.componentWillUnmount=="function"&&ch(l,s,u)),rs(n,s,l);break;case 21:rs(n,s,l);break;case 22:mn=(u=mn)||l.memoizedState!==null,rs(n,s,l),mn=u;break;default:rs(n,s,l)}}function yh(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Zl(n)}catch(l){zt(s,s.return,l)}}function Ey(n){switch(n.tag){case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new ph),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new ph),s;default:throw Error(i(435,n.tag))}}function Pu(n,s){var l=Ey(n);s.forEach(function(u){var h=Dy.bind(null,n,u);l.has(u)||(l.add(u),u.then(h,h))})}function _a(n,s){var l=s.deletions;if(l!==null)for(var u=0;u<l.length;u++){var h=l[u],y=n,k=s,B=k;e:for(;B!==null;){switch(B.tag){case 27:if(Is(B.type)){Qt=B.stateNode,ba=!1;break e}break;case 5:Qt=B.stateNode,ba=!1;break e;case 3:case 4:Qt=B.stateNode.containerInfo,ba=!0;break e}B=B.return}if(Qt===null)throw Error(i(160));gh(y,k,h),Qt=null,ba=!1,y=h.alternate,y!==null&&(y.return=null),h.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)vh(s,n),s=s.sibling}var fr=null;function vh(n,s){var l=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:_a(s,n),Oa(n),u&4&&(Cs(3,n,n.return),_l(3,n),Cs(5,n,n.return));break;case 1:_a(s,n),Oa(n),u&512&&(mn||l===null||Dr(l,l.return)),u&64&&as&&(n=n.updateQueue,n!==null&&(u=n.callbacks,u!==null&&(l=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var h=fr;if(_a(s,n),Oa(n),u&512&&(mn||l===null||Dr(l,l.return)),u&4){var y=l!==null?l.memoizedState:null;if(u=n.memoizedState,l===null)if(u===null)if(n.stateNode===null){e:{u=n.type,l=n.memoizedProps,h=h.ownerDocument||h;t:switch(u){case"title":y=h.getElementsByTagName("title")[0],(!y||y[Aa]||y[sn]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=h.createElement(u),h.head.insertBefore(y,h.querySelector("head > title"))),Hn(y,u,l),y[sn]=n,Ct(y),u=y;break e;case"link":var k=d0("link","href",h).get(u+(l.href||""));if(k){for(var B=0;B<k.length;B++)if(y=k[B],y.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&y.getAttribute("rel")===(l.rel==null?null:l.rel)&&y.getAttribute("title")===(l.title==null?null:l.title)&&y.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){k.splice(B,1);break t}}y=h.createElement(u),Hn(y,u,l),h.head.appendChild(y);break;case"meta":if(k=d0("meta","content",h).get(u+(l.content||""))){for(B=0;B<k.length;B++)if(y=k[B],y.getAttribute("content")===(l.content==null?null:""+l.content)&&y.getAttribute("name")===(l.name==null?null:l.name)&&y.getAttribute("property")===(l.property==null?null:l.property)&&y.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&y.getAttribute("charset")===(l.charSet==null?null:l.charSet)){k.splice(B,1);break t}}y=h.createElement(u),Hn(y,u,l),h.head.appendChild(y);break;default:throw Error(i(468,u))}y[sn]=n,Ct(y),u=y}n.stateNode=u}else p0(h,n.type,n.stateNode);else n.stateNode=f0(h,u,n.memoizedProps);else y!==u?(y===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):y.count--,u===null?p0(h,n.type,n.stateNode):f0(h,u,n.memoizedProps)):u===null&&n.stateNode!==null&&Uu(n,n.memoizedProps,l.memoizedProps)}break;case 27:_a(s,n),Oa(n),u&512&&(mn||l===null||Dr(l,l.return)),l!==null&&u&4&&Uu(n,n.memoizedProps,l.memoizedProps);break;case 5:if(_a(s,n),Oa(n),u&512&&(mn||l===null||Dr(l,l.return)),n.flags&32){h=n.stateNode;try{ka(h,"")}catch(ge){zt(n,n.return,ge)}}u&4&&n.stateNode!=null&&(h=n.memoizedProps,Uu(n,h,l!==null?l.memoizedProps:h)),u&1024&&(Fu=!0);break;case 6:if(_a(s,n),Oa(n),u&4){if(n.stateNode===null)throw Error(i(162));u=n.memoizedProps,l=n.stateNode;try{l.nodeValue=u}catch(ge){zt(n,n.return,ge)}}break;case 3:if(ic=null,h=fr,fr=rc(s.containerInfo),_a(s,n),fr=h,Oa(n),u&4&&l!==null&&l.memoizedState.isDehydrated)try{Zl(s.containerInfo)}catch(ge){zt(n,n.return,ge)}Fu&&(Fu=!1,bh(n));break;case 4:u=fr,fr=rc(n.stateNode.containerInfo),_a(s,n),Oa(n),fr=u;break;case 12:_a(s,n),Oa(n);break;case 13:_a(s,n),Oa(n),n.child.flags&8192&&n.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Vu=Ie()),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,Pu(n,u)));break;case 22:h=n.memoizedState!==null;var te=l!==null&&l.memoizedState!==null,de=as,Ae=mn;if(as=de||h,mn=Ae||te,_a(s,n),mn=Ae,as=de,Oa(n),u&8192)e:for(s=n.stateNode,s._visibility=h?s._visibility&-2:s._visibility|1,h&&(l===null||te||as||mn||pi(n)),l=null,s=n;;){if(s.tag===5||s.tag===26){if(l===null){te=l=s;try{if(y=te.stateNode,h)k=y.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{B=te.stateNode;var Ne=te.memoizedProps.style,me=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;B.style.display=me==null||typeof me=="boolean"?"":(""+me).trim()}}catch(ge){zt(te,te.return,ge)}}}else if(s.tag===6){if(l===null){te=s;try{te.stateNode.nodeValue=h?"":te.memoizedProps}catch(ge){zt(te,te.return,ge)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=n.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,Pu(n,l))));break;case 19:_a(s,n),Oa(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,Pu(n,u)));break;case 30:break;case 21:break;default:_a(s,n),Oa(n)}}function Oa(n){var s=n.flags;if(s&2){try{for(var l,u=n.return;u!==null;){if(fh(u)){l=u;break}u=u.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var h=l.stateNode,y=ju(n);qo(n,y,h);break;case 5:var k=l.stateNode;l.flags&32&&(ka(k,""),l.flags&=-33);var B=ju(n);qo(n,B,k);break;case 3:case 4:var te=l.stateNode.containerInfo,de=ju(n);Bu(n,de,te);break;default:throw Error(i(161))}}catch(Ae){zt(n,n.return,Ae)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function bh(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;bh(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function Ms(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)hh(n,s.alternate,s),s=s.sibling}function pi(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:Cs(4,s,s.return),pi(s);break;case 1:Dr(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&ch(s,s.return,l),pi(s);break;case 27:Gl(s.stateNode);case 26:case 5:Dr(s,s.return),pi(s);break;case 22:s.memoizedState===null&&pi(s);break;case 30:pi(s);break;default:pi(s)}n=n.sibling}}function Ns(n,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,h=n,y=s,k=y.flags;switch(y.tag){case 0:case 11:case 15:Ns(h,y,l),_l(4,y);break;case 1:if(Ns(h,y,l),u=y,h=u.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(de){zt(u,u.return,de)}if(u=y,h=u.updateQueue,h!==null){var B=u.stateNode;try{var te=h.shared.hiddenCallbacks;if(te!==null)for(h.shared.hiddenCallbacks=null,h=0;h<te.length;h++)$d(te[h],B)}catch(de){zt(u,u.return,de)}}l&&k&64&&oh(y),Ol(y,y.return);break;case 27:dh(y);case 26:case 5:Ns(h,y,l),l&&u===null&&k&4&&uh(y),Ol(y,y.return);break;case 12:Ns(h,y,l);break;case 13:Ns(h,y,l),l&&k&4&&yh(h,y);break;case 22:y.memoizedState===null&&Ns(h,y,l),Ol(y,y.return);break;case 30:break;default:Ns(h,y,l)}s=s.sibling}}function zu(n,s){var l=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==l&&(n!=null&&n.refCount++,l!=null&&vl(l))}function Gu(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&vl(n))}function _r(n,s,l,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)xh(n,s,l,u),s=s.sibling}function xh(n,s,l,u){var h=s.flags;switch(s.tag){case 0:case 11:case 15:_r(n,s,l,u),h&2048&&_l(9,s);break;case 1:_r(n,s,l,u);break;case 3:_r(n,s,l,u),h&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&vl(n)));break;case 12:if(h&2048){_r(n,s,l,u),n=s.stateNode;try{var y=s.memoizedProps,k=y.id,B=y.onPostCommit;typeof B=="function"&&B(k,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(te){zt(s,s.return,te)}}else _r(n,s,l,u);break;case 13:_r(n,s,l,u);break;case 23:break;case 22:y=s.stateNode,k=s.alternate,s.memoizedState!==null?y._visibility&2?_r(n,s,l,u):Il(n,s):y._visibility&2?_r(n,s,l,u):(y._visibility|=2,zi(n,s,l,u,(s.subtreeFlags&10256)!==0)),h&2048&&zu(k,s);break;case 24:_r(n,s,l,u),h&2048&&Gu(s.alternate,s);break;default:_r(n,s,l,u)}}function zi(n,s,l,u,h){for(h=h&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var y=n,k=s,B=l,te=u,de=k.flags;switch(k.tag){case 0:case 11:case 15:zi(y,k,B,te,h),_l(8,k);break;case 23:break;case 22:var Ae=k.stateNode;k.memoizedState!==null?Ae._visibility&2?zi(y,k,B,te,h):Il(y,k):(Ae._visibility|=2,zi(y,k,B,te,h)),h&&de&2048&&zu(k.alternate,k);break;case 24:zi(y,k,B,te,h),h&&de&2048&&Gu(k.alternate,k);break;default:zi(y,k,B,te,h)}s=s.sibling}}function Il(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=n,u=s,h=u.flags;switch(u.tag){case 22:Il(l,u),h&2048&&zu(u.alternate,u);break;case 24:Il(l,u),h&2048&&Gu(u.alternate,u);break;default:Il(l,u)}s=s.sibling}}var Ll=8192;function Gi(n){if(n.subtreeFlags&Ll)for(n=n.child;n!==null;)Sh(n),n=n.sibling}function Sh(n){switch(n.tag){case 26:Gi(n),n.flags&Ll&&n.memoizedState!==null&&l1(fr,n.memoizedState,n.memoizedProps);break;case 5:Gi(n);break;case 3:case 4:var s=fr;fr=rc(n.stateNode.containerInfo),Gi(n),fr=s;break;case 22:n.memoizedState===null&&(s=n.alternate,s!==null&&s.memoizedState!==null?(s=Ll,Ll=16777216,Gi(n),Ll=s):Gi(n));break;default:Gi(n)}}function Eh(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function Ul(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];In=u,Ah(u,n)}Eh(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)wh(n),n=n.sibling}function wh(n){switch(n.tag){case 0:case 11:case 15:Ul(n),n.flags&2048&&Cs(9,n,n.return);break;case 3:Ul(n);break;case 12:Ul(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,Vo(n)):Ul(n);break;default:Ul(n)}}function Vo(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];In=u,Ah(u,n)}Eh(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:Cs(8,s,s.return),Vo(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,Vo(s));break;default:Vo(s)}n=n.sibling}}function Ah(n,s){for(;In!==null;){var l=In;switch(l.tag){case 0:case 11:case 15:Cs(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:vl(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,In=u;else e:for(l=n;In!==null;){u=In;var h=u.sibling,y=u.return;if(mh(u),u===l){In=null;break e}if(h!==null){h.return=y,In=h;break e}In=y}}}var wy={getCacheForType:function(n){var s=Zn(Cn),l=s.data.get(n);return l===void 0&&(l=n(),s.data.set(n,l)),l}},Ay=typeof WeakMap=="function"?WeakMap:Map,It=0,Vt=null,xt=null,Tt=0,Lt=0,Ia=null,ks=!1,Hi=!1,Hu=!1,ss=0,cn=0,Rs=0,hi=0,Yu=0,Ja=0,Yi=0,jl=null,xa=null,qu=!1,Vu=0,Xo=1/0,$o=null,Ds=null,Gn=0,_s=null,qi=null,Vi=0,Xu=0,$u=null,Th=null,Bl=0,Wu=null;function La(){if((It&2)!==0&&Tt!==0)return Tt&-Tt;if(Y.T!==null){var n=Oi;return n!==0?n:nf()}return ca()}function Ch(){Ja===0&&(Ja=(Tt&536870912)===0||Rt?Jn():536870912);var n=Ka.current;return n!==null&&(n.flags|=32),Ja}function Ua(n,s,l){(n===Vt&&(Lt===2||Lt===9)||n.cancelPendingCommit!==null)&&(Xi(n,0),Os(n,Tt,Ja,!1)),la(n,l),((It&2)===0||n!==Vt)&&(n===Vt&&((It&2)===0&&(hi|=l),cn===4&&Os(n,Tt,Ja,!1)),Or(n))}function Mh(n,s,l){if((It&6)!==0)throw Error(i(327));var u=!l&&(s&124)===0&&(s&n.expiredLanes)===0||lt(n,s),h=u?My(n,s):Ku(n,s,!0),y=u;do{if(h===0){Hi&&!u&&Os(n,s,0,!1);break}else{if(l=n.current.alternate,y&&!Ty(l)){h=Ku(n,s,!1),y=!1;continue}if(h===2){if(y=s,n.errorRecoveryDisabledLanes&y)var k=0;else k=n.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){s=k;e:{var B=n;h=jl;var te=B.current.memoizedState.isDehydrated;if(te&&(Xi(B,k).flags|=256),k=Ku(B,k,!1),k!==2){if(Hu&&!te){B.errorRecoveryDisabledLanes|=y,hi|=y,h=4;break e}y=xa,xa=h,y!==null&&(xa===null?xa=y:xa.push.apply(xa,y))}h=k}if(y=!1,h!==2)continue}}if(h===1){Xi(n,0),Os(n,s,0,!0);break}e:{switch(u=n,y=h,y){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:Os(u,s,Ja,!ks);break e;case 2:xa=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(h=Vu+300-Ie(),10<h)){if(Os(u,s,Ja,!ks),Ve(u,0,!0)!==0)break e;u.timeoutHandle=n0(Nh.bind(null,u,l,xa,$o,qu,s,Ja,hi,Yi,ks,y,2,-0,0),h);break e}Nh(u,l,xa,$o,qu,s,Ja,hi,Yi,ks,y,0,-0,0)}}break}while(!0);Or(n)}function Nh(n,s,l,u,h,y,k,B,te,de,Ae,Ne,me,ge){if(n.timeoutHandle=-1,Ne=s.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(ql={stylesheets:null,count:0,unsuspend:i1},Sh(s),Ne=o1(),Ne!==null)){n.cancelPendingCommit=Ne(Lh.bind(null,n,s,y,l,u,h,k,B,te,Ae,1,me,ge)),Os(n,y,k,!de);return}Lh(n,s,y,l,u,h,k,B,te)}function Ty(n){for(var s=n;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var h=l[u],y=h.getSnapshot;h=h.value;try{if(!qt(y(),h))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Os(n,s,l,u){s&=~Yu,s&=~hi,n.suspendedLanes|=s,n.pingedLanes&=~s,u&&(n.warmLanes|=s),u=n.expirationTimes;for(var h=s;0<h;){var y=31-dn(h),k=1<<y;u[y]=-1,h&=~k}l!==0&&Sa(n,l,s)}function Wo(){return(It&6)===0?(Fl(0),!1):!0}function Zu(){if(xt!==null){if(Lt===0)var n=xt.return;else n=xt,Qr=oi=null,pu(n),Fi=null,kl=0,n=xt;for(;n!==null;)lh(n.alternate,n),n=n.return;xt=null}}function Xi(n,s){var l=n.timeoutHandle;l!==-1&&(n.timeoutHandle=-1,Hy(l)),l=n.cancelPendingCommit,l!==null&&(n.cancelPendingCommit=null,l()),Zu(),Vt=n,xt=l=$r(n.current,null),Tt=s,Lt=0,Ia=null,ks=!1,Hi=lt(n,s),Hu=!1,Yi=Ja=Yu=hi=Rs=cn=0,xa=jl=null,qu=!1,(s&8)!==0&&(s|=s&32);var u=n.entangledLanes;if(u!==0)for(n=n.entanglements,u&=s;0<u;){var h=31-dn(u),y=1<<h;s|=n[h],u&=~y}return ss=s,yo(),l}function kh(n,s){yt=null,Y.H=Uo,s===xl||s===Co?(s=Vd(),Lt=3):s===Hd?(s=Vd(),Lt=4):Lt=s===Xp?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ia=s,xt===null&&(cn=1,zo(n,$a(s,n.current)))}function Rh(){var n=Y.H;return Y.H=Uo,n===null?Uo:n}function Dh(){var n=Y.A;return Y.A=wy,n}function Qu(){cn=4,ks||(Tt&4194048)!==Tt&&Ka.current!==null||(Hi=!0),(Rs&134217727)===0&&(hi&134217727)===0||Vt===null||Os(Vt,Tt,Ja,!1)}function Ku(n,s,l){var u=It;It|=2;var h=Rh(),y=Dh();(Vt!==n||Tt!==s)&&($o=null,Xi(n,s)),s=!1;var k=cn;e:do try{if(Lt!==0&&xt!==null){var B=xt,te=Ia;switch(Lt){case 8:Zu(),k=6;break e;case 3:case 2:case 9:case 6:Ka.current===null&&(s=!0);var de=Lt;if(Lt=0,Ia=null,$i(n,B,te,de),l&&Hi){k=0;break e}break;default:de=Lt,Lt=0,Ia=null,$i(n,B,te,de)}}Cy(),k=cn;break}catch(Ae){kh(n,Ae)}while(!0);return s&&n.shellSuspendCounter++,Qr=oi=null,It=u,Y.H=h,Y.A=y,xt===null&&(Vt=null,Tt=0,yo()),k}function Cy(){for(;xt!==null;)_h(xt)}function My(n,s){var l=It;It|=2;var u=Rh(),h=Dh();Vt!==n||Tt!==s?($o=null,Xo=Ie()+500,Xi(n,s)):Hi=lt(n,s);e:do try{if(Lt!==0&&xt!==null){s=xt;var y=Ia;t:switch(Lt){case 1:Lt=0,Ia=null,$i(n,s,y,1);break;case 2:case 9:if(Yd(y)){Lt=0,Ia=null,Oh(s);break}s=function(){Lt!==2&&Lt!==9||Vt!==n||(Lt=7),Or(n)},y.then(s,s);break e;case 3:Lt=7;break e;case 4:Lt=5;break e;case 7:Yd(y)?(Lt=0,Ia=null,Oh(s)):(Lt=0,Ia=null,$i(n,s,y,7));break;case 5:var k=null;switch(xt.tag){case 26:k=xt.memoizedState;case 5:case 27:var B=xt;if(!k||h0(k)){Lt=0,Ia=null;var te=B.sibling;if(te!==null)xt=te;else{var de=B.return;de!==null?(xt=de,Zo(de)):xt=null}break t}}Lt=0,Ia=null,$i(n,s,y,5);break;case 6:Lt=0,Ia=null,$i(n,s,y,6);break;case 8:Zu(),cn=6;break e;default:throw Error(i(462))}}Ny();break}catch(Ae){kh(n,Ae)}while(!0);return Qr=oi=null,Y.H=u,Y.A=h,It=l,xt!==null?0:(Vt=null,Tt=0,yo(),cn)}function Ny(){for(;xt!==null&&!je();)_h(xt)}function _h(n){var s=sh(n.alternate,n,ss);n.memoizedProps=n.pendingProps,s===null?Zo(n):xt=s}function Oh(n){var s=n,l=s.alternate;switch(s.tag){case 15:case 0:s=Jp(l,s,s.pendingProps,s.type,void 0,Tt);break;case 11:s=Jp(l,s,s.pendingProps,s.type.render,s.ref,Tt);break;case 5:pu(s);default:lh(l,s),s=xt=Id(s,ss),s=sh(l,s,ss)}n.memoizedProps=n.pendingProps,s===null?Zo(n):xt=s}function $i(n,s,l,u){Qr=oi=null,pu(s),Fi=null,kl=0;var h=s.return;try{if(yy(n,h,s,l,Tt)){cn=1,zo(n,$a(l,n.current)),xt=null;return}}catch(y){if(h!==null)throw xt=h,y;cn=1,zo(n,$a(l,n.current)),xt=null;return}s.flags&32768?(Rt||u===1?n=!0:Hi||(Tt&536870912)!==0?n=!1:(ks=n=!0,(u===2||u===9||u===3||u===6)&&(u=Ka.current,u!==null&&u.tag===13&&(u.flags|=16384))),Ih(s,n)):Zo(s)}function Zo(n){var s=n;do{if((s.flags&32768)!==0){Ih(s,ks);return}n=s.return;var l=by(s.alternate,s,ss);if(l!==null){xt=l;return}if(s=s.sibling,s!==null){xt=s;return}xt=s=n}while(s!==null);cn===0&&(cn=5)}function Ih(n,s){do{var l=xy(n.alternate,n);if(l!==null){l.flags&=32767,xt=l;return}if(l=n.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(n=n.sibling,n!==null)){xt=n;return}xt=n=l}while(n!==null);cn=6,xt=null}function Lh(n,s,l,u,h,y,k,B,te){n.cancelPendingCommit=null;do Qo();while(Gn!==0);if((It&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(y=s.lanes|s.childLanes,y|=Gc,Pa(n,l,y,k,B,te),n===Vt&&(xt=Vt=null,Tt=0),qi=s,_s=n,Vi=l,Xu=y,$u=h,Th=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,_y(Ze,function(){return Ph(),null})):(n.callbackNode=null,n.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=Y.T,Y.T=null,h=ee.p,ee.p=2,k=It,It|=4;try{Sy(n,s,l)}finally{It=k,ee.p=h,Y.T=u}}Gn=1,Uh(),jh(),Bh()}}function Uh(){if(Gn===1){Gn=0;var n=_s,s=qi,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=Y.T,Y.T=null;var u=ee.p;ee.p=2;var h=It;It|=4;try{vh(s,n);var y=ff,k=Ad(n.containerInfo),B=y.focusedElem,te=y.selectionRange;if(k!==B&&B&&B.ownerDocument&&wd(B.ownerDocument.documentElement,B)){if(te!==null&&jc(B)){var de=te.start,Ae=te.end;if(Ae===void 0&&(Ae=de),"selectionStart"in B)B.selectionStart=de,B.selectionEnd=Math.min(Ae,B.value.length);else{var Ne=B.ownerDocument||document,me=Ne&&Ne.defaultView||window;if(me.getSelection){var ge=me.getSelection(),at=B.textContent.length,Qe=Math.min(te.start,at),Ft=te.end===void 0?Qe:Math.min(te.end,at);!ge.extend&&Qe>Ft&&(k=Ft,Ft=Qe,Qe=k);var ce=Ed(B,Qe),se=Ed(B,Ft);if(ce&&se&&(ge.rangeCount!==1||ge.anchorNode!==ce.node||ge.anchorOffset!==ce.offset||ge.focusNode!==se.node||ge.focusOffset!==se.offset)){var fe=Ne.createRange();fe.setStart(ce.node,ce.offset),ge.removeAllRanges(),Qe>Ft?(ge.addRange(fe),ge.extend(se.node,se.offset)):(fe.setEnd(se.node,se.offset),ge.addRange(fe))}}}}for(Ne=[],ge=B;ge=ge.parentNode;)ge.nodeType===1&&Ne.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Ne.length;B++){var Te=Ne[B];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}cc=!!uf,ff=uf=null}finally{It=h,ee.p=u,Y.T=l}}n.current=s,Gn=2}}function jh(){if(Gn===2){Gn=0;var n=_s,s=qi,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=Y.T,Y.T=null;var u=ee.p;ee.p=2;var h=It;It|=4;try{hh(n,s.alternate,s)}finally{It=h,ee.p=u,Y.T=l}}Gn=3}}function Bh(){if(Gn===4||Gn===3){Gn=0,$e();var n=_s,s=qi,l=Vi,u=Th;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Gn=5:(Gn=0,qi=_s=null,Fh(n,n.pendingLanes));var h=n.pendingLanes;if(h===0&&(Ds=null),jn(l),s=s.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(qn,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=Y.T,h=ee.p,ee.p=2,Y.T=null;try{for(var y=n.onRecoverableError,k=0;k<u.length;k++){var B=u[k];y(B.value,{componentStack:B.stack})}}finally{Y.T=s,ee.p=h}}(Vi&3)!==0&&Qo(),Or(n),h=n.pendingLanes,(l&4194090)!==0&&(h&42)!==0?n===Wu?Bl++:(Bl=0,Wu=n):Bl=0,Fl(0)}}function Fh(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,vl(s)))}function Qo(n){return Uh(),jh(),Bh(),Ph()}function Ph(){if(Gn!==5)return!1;var n=_s,s=Xu;Xu=0;var l=jn(Vi),u=Y.T,h=ee.p;try{ee.p=32>l?32:l,Y.T=null,l=$u,$u=null;var y=_s,k=Vi;if(Gn=0,qi=_s=null,Vi=0,(It&6)!==0)throw Error(i(331));var B=It;if(It|=4,wh(y.current),xh(y,y.current,k,l),It=B,Fl(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(qn,y)}catch{}return!0}finally{ee.p=h,Y.T=u,Fh(n,s)}}function zh(n,s,l){s=$a(l,s),s=Mu(n.stateNode,s,2),n=Es(n,s,2),n!==null&&(la(n,2),Or(n))}function zt(n,s,l){if(n.tag===3)zh(n,n,l);else for(;s!==null;){if(s.tag===3){zh(s,n,l);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ds===null||!Ds.has(u))){n=$a(l,n),l=qp(2),u=Es(s,l,2),u!==null&&(Vp(l,u,s,n),la(u,2),Or(u));break}}s=s.return}}function Ju(n,s,l){var u=n.pingCache;if(u===null){u=n.pingCache=new Ay;var h=new Set;u.set(s,h)}else h=u.get(s),h===void 0&&(h=new Set,u.set(s,h));h.has(l)||(Hu=!0,h.add(l),n=ky.bind(null,n,s,l),s.then(n,n))}function ky(n,s,l){var u=n.pingCache;u!==null&&u.delete(s),n.pingedLanes|=n.suspendedLanes&l,n.warmLanes&=~l,Vt===n&&(Tt&l)===l&&(cn===4||cn===3&&(Tt&62914560)===Tt&&300>Ie()-Vu?(It&2)===0&&Xi(n,0):Yu|=l,Yi===Tt&&(Yi=0)),Or(n)}function Gh(n,s){s===0&&(s=ea()),n=ki(n,s),n!==null&&(la(n,s),Or(n))}function Ry(n){var s=n.memoizedState,l=0;s!==null&&(l=s.retryLane),Gh(n,l)}function Dy(n,s){var l=0;switch(n.tag){case 13:var u=n.stateNode,h=n.memoizedState;h!==null&&(l=h.retryLane);break;case 19:u=n.stateNode;break;case 22:u=n.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(s),Gh(n,l)}function _y(n,s){return Wt(n,s)}var Ko=null,Wi=null,ef=!1,Jo=!1,tf=!1,mi=0;function Or(n){n!==Wi&&n.next===null&&(Wi===null?Ko=Wi=n:Wi=Wi.next=n),Jo=!0,ef||(ef=!0,Iy())}function Fl(n,s){if(!tf&&Jo){tf=!0;do for(var l=!1,u=Ko;u!==null;){if(n!==0){var h=u.pendingLanes;if(h===0)var y=0;else{var k=u.suspendedLanes,B=u.pingedLanes;y=(1<<31-dn(42|n)+1)-1,y&=h&~(k&~B),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(l=!0,Vh(u,y))}else y=Tt,y=Ve(u,u===Vt?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(y&3)===0||lt(u,y)||(l=!0,Vh(u,y));u=u.next}while(l);tf=!1}}function Oy(){Hh()}function Hh(){Jo=ef=!1;var n=0;mi!==0&&(Gy()&&(n=mi),mi=0);for(var s=Ie(),l=null,u=Ko;u!==null;){var h=u.next,y=Yh(u,s);y===0?(u.next=null,l===null?Ko=h:l.next=h,h===null&&(Wi=l)):(l=u,(n!==0||(y&3)!==0)&&(Jo=!0)),u=h}Fl(n)}function Yh(n,s){for(var l=n.suspendedLanes,u=n.pingedLanes,h=n.expirationTimes,y=n.pendingLanes&-62914561;0<y;){var k=31-dn(y),B=1<<k,te=h[k];te===-1?((B&l)===0||(B&u)!==0)&&(h[k]=Vs(B,s)):te<=s&&(n.expiredLanes|=B),y&=~B}if(s=Vt,l=Tt,l=Ve(n,n===s?l:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u=n.callbackNode,l===0||n===s&&(Lt===2||Lt===9)||n.cancelPendingCommit!==null)return u!==null&&u!==null&&Kt(u),n.callbackNode=null,n.callbackPriority=0;if((l&3)===0||lt(n,l)){if(s=l&-l,s===n.callbackPriority)return s;switch(u!==null&&Kt(u),jn(l)){case 2:case 8:l=xe;break;case 32:l=Ze;break;case 268435456:l=fn;break;default:l=Ze}return u=qh.bind(null,n),l=Wt(l,u),n.callbackPriority=s,n.callbackNode=l,s}return u!==null&&u!==null&&Kt(u),n.callbackPriority=2,n.callbackNode=null,2}function qh(n,s){if(Gn!==0&&Gn!==5)return n.callbackNode=null,n.callbackPriority=0,null;var l=n.callbackNode;if(Qo()&&n.callbackNode!==l)return null;var u=Tt;return u=Ve(n,n===Vt?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u===0?null:(Mh(n,u,s),Yh(n,Ie()),n.callbackNode!=null&&n.callbackNode===l?qh.bind(null,n):null)}function Vh(n,s){if(Qo())return null;Mh(n,s,!0)}function Iy(){Yy(function(){(It&6)!==0?Wt(Ue,Oy):Hh()})}function nf(){return mi===0&&(mi=Jn()),mi}function Xh(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:zr(""+n)}function $h(n,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,n.id&&l.setAttribute("form",n.id),s.parentNode.insertBefore(l,s),n=new FormData(n),l.parentNode.removeChild(l),n}function Ly(n,s,l,u,h){if(s==="submit"&&l&&l.stateNode===h){var y=Xh((h[Gt]||null).action),k=u.submitter;k&&(s=(s=k[Gt]||null)?Xh(s.formAction):k.getAttribute("formAction"),s!==null&&(y=s,k=null));var B=new Hr("action","action",null,u,h);n.push({event:B,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(mi!==0){var te=k?$h(h,k):new FormData(h);Eu(l,{pending:!0,data:te,method:h.method,action:y},null,te)}}else typeof y=="function"&&(B.preventDefault(),te=k?$h(h,k):new FormData(h),Eu(l,{pending:!0,data:te,method:h.method,action:y},y,te))},currentTarget:h}]})}}for(var af=0;af<zc.length;af++){var rf=zc[af],Uy=rf.toLowerCase(),jy=rf[0].toUpperCase()+rf.slice(1);ur(Uy,"on"+jy)}ur(Md,"onAnimationEnd"),ur(Nd,"onAnimationIteration"),ur(kd,"onAnimationStart"),ur("dblclick","onDoubleClick"),ur("focusin","onFocus"),ur("focusout","onBlur"),ur(ey,"onTransitionRun"),ur(ty,"onTransitionStart"),ur(ny,"onTransitionCancel"),ur(Rd,"onTransitionEnd"),da("onMouseEnter",["mouseout","mouseover"]),da("onMouseLeave",["mouseout","mouseover"]),da("onPointerEnter",["pointerout","pointerover"]),da("onPointerLeave",["pointerout","pointerover"]),ft("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ft("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ft("onBeforeInput",["compositionend","keypress","textInput","paste"]),ft("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ft("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ft("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),By=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pl));function Wh(n,s){s=(s&4)!==0;for(var l=0;l<n.length;l++){var u=n[l],h=u.event;u=u.listeners;e:{var y=void 0;if(s)for(var k=u.length-1;0<=k;k--){var B=u[k],te=B.instance,de=B.currentTarget;if(B=B.listener,te!==y&&h.isPropagationStopped())break e;y=B,h.currentTarget=de;try{y(h)}catch(Ae){Po(Ae)}h.currentTarget=null,y=te}else for(k=0;k<u.length;k++){if(B=u[k],te=B.instance,de=B.currentTarget,B=B.listener,te!==y&&h.isPropagationStopped())break e;y=B,h.currentTarget=de;try{y(h)}catch(Ae){Po(Ae)}h.currentTarget=null,y=te}}}}function St(n,s){var l=s[wa];l===void 0&&(l=s[wa]=new Set);var u=n+"__bubble";l.has(u)||(Zh(s,n,2,!1),l.add(u))}function sf(n,s,l){var u=0;s&&(u|=4),Zh(l,n,u,s)}var ec="_reactListening"+Math.random().toString(36).slice(2);function lf(n){if(!n[ec]){n[ec]=!0,At.forEach(function(l){l!=="selectionchange"&&(By.has(l)||sf(l,!1,n),sf(l,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[ec]||(s[ec]=!0,sf("selectionchange",!1,s))}}function Zh(n,s,l,u){switch(x0(s)){case 2:var h=f1;break;case 8:h=d1;break;default:h=Sf}l=h.bind(null,s,l,n),h=void 0,!sa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(h=!0),u?h!==void 0?n.addEventListener(s,l,{capture:!0,passive:h}):n.addEventListener(s,l,!0):h!==void 0?n.addEventListener(s,l,{passive:h}):n.addEventListener(s,l,!1)}function of(n,s,l,u,h){var y=u;if((s&1)===0&&(s&2)===0&&u!==null)e:for(;;){if(u===null)return;var k=u.tag;if(k===3||k===4){var B=u.stateNode.containerInfo;if(B===h)break;if(k===4)for(k=u.return;k!==null;){var te=k.tag;if((te===3||te===4)&&k.stateNode.containerInfo===h)return;k=k.return}for(;B!==null;){if(k=Jt(B),k===null)return;if(te=k.tag,te===5||te===6||te===26||te===27){u=y=k;continue e}B=B.parentNode}}u=u.return}Ei(function(){var de=y,Ae=tn(l),Ne=[];e:{var me=Dd.get(n);if(me!==void 0){var ge=Hr,at=n;switch(n){case"keypress":if(qa(l)===0)break e;case"keydown":case"keyup":ge=X;break;case"focusin":at="focus",ge=Vr;break;case"focusout":at="blur",ge=Vr;break;case"beforeblur":case"afterblur":ge=Vr;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=wi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=qr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=ne;break;case Md:case Nd:case kd:ge=ul;break;case Rd:ge=le;break;case"scroll":case"scrollend":ge=_n;break;case"wheel":ge=pe;break;case"copy":case"cut":case"paste":ge=vs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=H;break;case"toggle":case"beforetoggle":ge=Me}var Qe=(s&4)!==0,Ft=!Qe&&(n==="scroll"||n==="scrollend"),ce=Qe?me!==null?me+"Capture":null:me;Qe=[];for(var se=de,fe;se!==null;){var Te=se;if(fe=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||fe===null||ce===null||(Te=Gr(se,ce),Te!=null&&Qe.push(zl(se,Te,fe))),Ft)break;se=se.return}0<Qe.length&&(me=new ge(me,at,null,l,Ae),Ne.push({event:me,listeners:Qe}))}}if((s&7)===0){e:{if(me=n==="mouseover"||n==="pointerover",ge=n==="mouseout"||n==="pointerout",me&&l!==ps&&(at=l.relatedTarget||l.fromElement)&&(Jt(at)||at[Dt]))break e;if((ge||me)&&(me=Ae.window===Ae?Ae:(me=Ae.ownerDocument)?me.defaultView||me.parentWindow:window,ge?(at=l.relatedTarget||l.toElement,ge=de,at=at?Jt(at):null,at!==null&&(Ft=c(at),Qe=at.tag,at!==Ft||Qe!==5&&Qe!==27&&Qe!==6)&&(at=null)):(ge=null,at=de),ge!==at)){if(Qe=wi,Te="onMouseLeave",ce="onMouseEnter",se="mouse",(n==="pointerout"||n==="pointerover")&&(Qe=H,Te="onPointerLeave",ce="onPointerEnter",se="pointer"),Ft=ge==null?me:vt(ge),fe=at==null?me:vt(at),me=new Qe(Te,se+"leave",ge,l,Ae),me.target=Ft,me.relatedTarget=fe,Te=null,Jt(Ae)===de&&(Qe=new Qe(ce,se+"enter",at,l,Ae),Qe.target=fe,Qe.relatedTarget=Ft,Te=Qe),Ft=Te,ge&&at)t:{for(Qe=ge,ce=at,se=0,fe=Qe;fe;fe=Zi(fe))se++;for(fe=0,Te=ce;Te;Te=Zi(Te))fe++;for(;0<se-fe;)Qe=Zi(Qe),se--;for(;0<fe-se;)ce=Zi(ce),fe--;for(;se--;){if(Qe===ce||ce!==null&&Qe===ce.alternate)break t;Qe=Zi(Qe),ce=Zi(ce)}Qe=null}else Qe=null;ge!==null&&Qh(Ne,me,ge,Qe,!1),at!==null&&Ft!==null&&Qh(Ne,Ft,at,Qe,!0)}}e:{if(me=de?vt(de):window,ge=me.nodeName&&me.nodeName.toLowerCase(),ge==="select"||ge==="input"&&me.type==="file")var ze=Nr;else if(nn(me))if(pn)ze=Uc;else{ze=or;var bt=Xr}else ge=me.nodeName,!ge||ge.toLowerCase()!=="input"||me.type!=="checkbox"&&me.type!=="radio"?de&&Ar(de.elementType)&&(ze=Nr):ze=ei;if(ze&&(ze=ze(n,de))){Ht(Ne,ze,l,Ae);break e}bt&&bt(n,me,de),n==="focusout"&&de&&me.type==="number"&&de.memoizedProps.value!=null&&Na(me,"number",me.value)}switch(bt=de?vt(de):window,n){case"focusin":(nn(bt)||bt.contentEditable==="true")&&(Ci=bt,Bc=de,pl=null);break;case"focusout":pl=Bc=Ci=null;break;case"mousedown":Fc=!0;break;case"contextmenu":case"mouseup":case"dragend":Fc=!1,Td(Ne,l,Ae);break;case"selectionchange":if(Jg)break;case"keydown":case"keyup":Td(Ne,l,Ae)}var Xe;if(Re)e:{switch(n){case"compositionstart":var Ke="onCompositionStart";break e;case"compositionend":Ke="onCompositionEnd";break e;case"compositionupdate":Ke="onCompositionUpdate";break e}Ke=void 0}else Ot?st(n,l)&&(Ke="onCompositionEnd"):n==="keydown"&&l.keyCode===229&&(Ke="onCompositionStart");Ke&&(ct&&l.locale!=="ko"&&(Ot||Ke!=="onCompositionStart"?Ke==="onCompositionEnd"&&Ot&&(Xe=hs()):(Fn=Ae,Ha="value"in Fn?Fn.value:Fn.textContent,Ot=!0)),bt=tc(de,Ke),0<bt.length&&(Ke=new p(Ke,n,null,l,Ae),Ne.push({event:Ke,listeners:bt}),Xe?Ke.data=Xe:(Xe=Tn(l),Xe!==null&&(Ke.data=Xe)))),(Xe=et?Nt(n,l):wt(n,l))&&(Ke=tc(de,"onBeforeInput"),0<Ke.length&&(bt=new p("onBeforeInput","beforeinput",null,l,Ae),Ne.push({event:bt,listeners:Ke}),bt.data=Xe)),Ly(Ne,n,de,l,Ae)}Wh(Ne,s)})}function zl(n,s,l){return{instance:n,listener:s,currentTarget:l}}function tc(n,s){for(var l=s+"Capture",u=[];n!==null;){var h=n,y=h.stateNode;if(h=h.tag,h!==5&&h!==26&&h!==27||y===null||(h=Gr(n,l),h!=null&&u.unshift(zl(n,h,y)),h=Gr(n,s),h!=null&&u.push(zl(n,h,y))),n.tag===3)return u;n=n.return}return[]}function Zi(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Qh(n,s,l,u,h){for(var y=s._reactName,k=[];l!==null&&l!==u;){var B=l,te=B.alternate,de=B.stateNode;if(B=B.tag,te!==null&&te===u)break;B!==5&&B!==26&&B!==27||de===null||(te=de,h?(de=Gr(l,y),de!=null&&k.unshift(zl(l,de,te))):h||(de=Gr(l,y),de!=null&&k.push(zl(l,de,te)))),l=l.return}k.length!==0&&n.push({event:s,listeners:k})}var Fy=/\r\n?/g,Py=/\u0000|\uFFFD/g;function Kh(n){return(typeof n=="string"?n:""+n).replace(Fy,`
`).replace(Py,"")}function Jh(n,s){return s=Kh(s),Kh(n)===s}function nc(){}function Bt(n,s,l,u,h,y){switch(l){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||ka(n,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&ka(n,""+u);break;case"className":ta(n,"class",u);break;case"tabIndex":ta(n,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":ta(n,l,u);break;case"style":Qs(n,u,y);break;case"data":if(s!=="object"){ta(n,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||l!=="href")){n.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(l);break}u=zr(""+u),n.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){n.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(l==="formAction"?(s!=="input"&&Bt(n,s,"name",h.name,h,null),Bt(n,s,"formEncType",h.formEncType,h,null),Bt(n,s,"formMethod",h.formMethod,h,null),Bt(n,s,"formTarget",h.formTarget,h,null)):(Bt(n,s,"encType",h.encType,h,null),Bt(n,s,"method",h.method,h,null),Bt(n,s,"target",h.target,h,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(l);break}u=zr(""+u),n.setAttribute(l,u);break;case"onClick":u!=null&&(n.onclick=nc);break;case"onScroll":u!=null&&St("scroll",n);break;case"onScrollEnd":u!=null&&St("scrollend",n);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(h.children!=null)throw Error(i(60));n.innerHTML=l}}break;case"multiple":n.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":n.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){n.removeAttribute("xlink:href");break}l=zr(""+u),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,""+u):n.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,""):n.removeAttribute(l);break;case"capture":case"download":u===!0?n.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,u):n.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?n.setAttribute(l,u):n.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?n.removeAttribute(l):n.setAttribute(l,u);break;case"popover":St("beforetoggle",n),St("toggle",n),Ca(n,"popover",u);break;case"xlinkActuate":Vn(n,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Vn(n,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Vn(n,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Vn(n,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Vn(n,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Vn(n,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Vn(n,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Vn(n,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Vn(n,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Ca(n,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=ds.get(l)||l,Ca(n,l,u))}}function cf(n,s,l,u,h,y){switch(l){case"style":Qs(n,u,y);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(h.children!=null)throw Error(i(60));n.innerHTML=l}}break;case"children":typeof u=="string"?ka(n,u):(typeof u=="number"||typeof u=="bigint")&&ka(n,""+u);break;case"onScroll":u!=null&&St("scroll",n);break;case"onScrollEnd":u!=null&&St("scrollend",n);break;case"onClick":u!=null&&(n.onclick=nc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qe.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(h=l.endsWith("Capture"),s=l.slice(2,h?l.length-7:void 0),y=n[Gt]||null,y=y!=null?y[l]:null,typeof y=="function"&&n.removeEventListener(s,y,h),typeof u=="function")){typeof y!="function"&&y!==null&&(l in n?n[l]=null:n.hasAttribute(l)&&n.removeAttribute(l)),n.addEventListener(s,u,h);break e}l in n?n[l]=u:u===!0?n.setAttribute(l,""):Ca(n,l,u)}}}function Hn(n,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":St("error",n),St("load",n);var u=!1,h=!1,y;for(y in l)if(l.hasOwnProperty(y)){var k=l[y];if(k!=null)switch(y){case"src":u=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Bt(n,s,y,k,l,null)}}h&&Bt(n,s,"srcSet",l.srcSet,l,null),u&&Bt(n,s,"src",l.src,l,null);return;case"input":St("invalid",n);var B=y=k=h=null,te=null,de=null;for(u in l)if(l.hasOwnProperty(u)){var Ae=l[u];if(Ae!=null)switch(u){case"name":h=Ae;break;case"type":k=Ae;break;case"checked":te=Ae;break;case"defaultChecked":de=Ae;break;case"value":y=Ae;break;case"defaultValue":B=Ae;break;case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(i(137,s));break;default:Bt(n,s,u,Ae,l,null)}}Zs(n,y,B,te,de,k,h,!1),Er(n);return;case"select":St("invalid",n),u=k=y=null;for(h in l)if(l.hasOwnProperty(h)&&(B=l[h],B!=null))switch(h){case"value":y=B;break;case"defaultValue":k=B;break;case"multiple":u=B;default:Bt(n,s,h,B,l,null)}s=y,l=k,n.multiple=!!u,s!=null?Ga(n,!!u,s,!1):l!=null&&Ga(n,!!u,l,!0);return;case"textarea":St("invalid",n),y=h=u=null;for(k in l)if(l.hasOwnProperty(k)&&(B=l[k],B!=null))switch(k){case"value":u=B;break;case"defaultValue":h=B;break;case"children":y=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(i(91));break;default:Bt(n,s,k,B,l,null)}Pr(n,u,h,y),Er(n);return;case"option":for(te in l)l.hasOwnProperty(te)&&(u=l[te],u!=null)&&(te==="selected"?n.selected=u&&typeof u!="function"&&typeof u!="symbol":Bt(n,s,te,u,l,null));return;case"dialog":St("beforetoggle",n),St("toggle",n),St("cancel",n),St("close",n);break;case"iframe":case"object":St("load",n);break;case"video":case"audio":for(u=0;u<Pl.length;u++)St(Pl[u],n);break;case"image":St("error",n),St("load",n);break;case"details":St("toggle",n);break;case"embed":case"source":case"link":St("error",n),St("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in l)if(l.hasOwnProperty(de)&&(u=l[de],u!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Bt(n,s,de,u,l,null)}return;default:if(Ar(s)){for(Ae in l)l.hasOwnProperty(Ae)&&(u=l[Ae],u!==void 0&&cf(n,s,Ae,u,l,void 0));return}}for(B in l)l.hasOwnProperty(B)&&(u=l[B],u!=null&&Bt(n,s,B,u,l,null))}function zy(n,s,l,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,y=null,k=null,B=null,te=null,de=null,Ae=null;for(ge in l){var Ne=l[ge];if(l.hasOwnProperty(ge)&&Ne!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":te=Ne;default:u.hasOwnProperty(ge)||Bt(n,s,ge,null,u,Ne)}}for(var me in u){var ge=u[me];if(Ne=l[me],u.hasOwnProperty(me)&&(ge!=null||Ne!=null))switch(me){case"type":y=ge;break;case"name":h=ge;break;case"checked":de=ge;break;case"defaultChecked":Ae=ge;break;case"value":k=ge;break;case"defaultValue":B=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(i(137,s));break;default:ge!==Ne&&Bt(n,s,me,ge,u,Ne)}}Ws(n,k,B,te,de,Ae,y,h);return;case"select":ge=k=B=me=null;for(y in l)if(te=l[y],l.hasOwnProperty(y)&&te!=null)switch(y){case"value":break;case"multiple":ge=te;default:u.hasOwnProperty(y)||Bt(n,s,y,null,u,te)}for(h in u)if(y=u[h],te=l[h],u.hasOwnProperty(h)&&(y!=null||te!=null))switch(h){case"value":me=y;break;case"defaultValue":B=y;break;case"multiple":k=y;default:y!==te&&Bt(n,s,h,y,u,te)}s=B,l=k,u=ge,me!=null?Ga(n,!!l,me,!1):!!u!=!!l&&(s!=null?Ga(n,!!l,s,!0):Ga(n,!!l,l?[]:"",!1));return;case"textarea":ge=me=null;for(B in l)if(h=l[B],l.hasOwnProperty(B)&&h!=null&&!u.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:Bt(n,s,B,null,u,h)}for(k in u)if(h=u[k],y=l[k],u.hasOwnProperty(k)&&(h!=null||y!=null))switch(k){case"value":me=h;break;case"defaultValue":ge=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(i(91));break;default:h!==y&&Bt(n,s,k,h,u,y)}fs(n,me,ge);return;case"option":for(var at in l)me=l[at],l.hasOwnProperty(at)&&me!=null&&!u.hasOwnProperty(at)&&(at==="selected"?n.selected=!1:Bt(n,s,at,null,u,me));for(te in u)me=u[te],ge=l[te],u.hasOwnProperty(te)&&me!==ge&&(me!=null||ge!=null)&&(te==="selected"?n.selected=me&&typeof me!="function"&&typeof me!="symbol":Bt(n,s,te,me,u,ge));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qe in l)me=l[Qe],l.hasOwnProperty(Qe)&&me!=null&&!u.hasOwnProperty(Qe)&&Bt(n,s,Qe,null,u,me);for(de in u)if(me=u[de],ge=l[de],u.hasOwnProperty(de)&&me!==ge&&(me!=null||ge!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(i(137,s));break;default:Bt(n,s,de,me,u,ge)}return;default:if(Ar(s)){for(var Ft in l)me=l[Ft],l.hasOwnProperty(Ft)&&me!==void 0&&!u.hasOwnProperty(Ft)&&cf(n,s,Ft,void 0,u,me);for(Ae in u)me=u[Ae],ge=l[Ae],!u.hasOwnProperty(Ae)||me===ge||me===void 0&&ge===void 0||cf(n,s,Ae,me,u,ge);return}}for(var ce in l)me=l[ce],l.hasOwnProperty(ce)&&me!=null&&!u.hasOwnProperty(ce)&&Bt(n,s,ce,null,u,me);for(Ne in u)me=u[Ne],ge=l[Ne],!u.hasOwnProperty(Ne)||me===ge||me==null&&ge==null||Bt(n,s,Ne,me,u,ge)}var uf=null,ff=null;function ac(n){return n.nodeType===9?n:n.ownerDocument}function e0(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function t0(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function df(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var pf=null;function Gy(){var n=window.event;return n&&n.type==="popstate"?n===pf?!1:(pf=n,!0):(pf=null,!1)}var n0=typeof setTimeout=="function"?setTimeout:void 0,Hy=typeof clearTimeout=="function"?clearTimeout:void 0,a0=typeof Promise=="function"?Promise:void 0,Yy=typeof queueMicrotask=="function"?queueMicrotask:typeof a0<"u"?function(n){return a0.resolve(null).then(n).catch(qy)}:n0;function qy(n){setTimeout(function(){throw n})}function Is(n){return n==="head"}function r0(n,s){var l=s,u=0,h=0;do{var y=l.nextSibling;if(n.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"){if(0<u&&8>u){l=u;var k=n.ownerDocument;if(l&1&&Gl(k.documentElement),l&2&&Gl(k.body),l&4)for(l=k.head,Gl(l),k=l.firstChild;k;){var B=k.nextSibling,te=k.nodeName;k[Aa]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&k.rel.toLowerCase()==="stylesheet"||l.removeChild(k),k=B}}if(h===0){n.removeChild(y),Zl(s);return}h--}else l==="$"||l==="$?"||l==="$!"?h++:u=l.charCodeAt(0)-48;else u=0;l=y}while(l);Zl(s)}function hf(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":hf(l),sr(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}n.removeChild(l)}}function Vy(n,s,l,u){for(;n.nodeType===1;){var h=l;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(u){if(!n[Aa])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(y=n.getAttribute("rel"),y==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(y!==h.rel||n.getAttribute("href")!==(h.href==null||h.href===""?null:h.href)||n.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||n.getAttribute("title")!==(h.title==null?null:h.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(y=n.getAttribute("src"),(y!==(h.src==null?null:h.src)||n.getAttribute("type")!==(h.type==null?null:h.type)||n.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&y&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var y=h.name==null?null:""+h.name;if(h.type==="hidden"&&n.getAttribute("name")===y)return n}else return n;if(n=dr(n.nextSibling),n===null)break}return null}function Xy(n,s,l){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!l||(n=dr(n.nextSibling),n===null))return null;return n}function mf(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function $y(n,s){var l=n.ownerDocument;if(n.data!=="$?"||l.readyState==="complete")s();else{var u=function(){s(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),n._reactRetry=u}}function dr(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return n}var gf=null;function s0(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var l=n.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return n;s--}else l==="/$"&&s++}n=n.previousSibling}return null}function i0(n,s,l){switch(s=ac(l),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function Gl(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);sr(n)}var er=new Map,l0=new Set;function rc(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var is=ee.d;ee.d={f:Wy,r:Zy,D:Qy,C:Ky,L:Jy,m:e1,X:n1,S:t1,M:a1};function Wy(){var n=is.f(),s=Wo();return n||s}function Zy(n){var s=xn(n);s!==null&&s.tag===5&&s.type==="form"?Mp(s):is.r(n)}var Qi=typeof document>"u"?null:document;function o0(n,s,l){var u=Qi;if(u&&typeof s=="string"&&s){var h=Rn(s);h='link[rel="'+n+'"][href="'+h+'"]',typeof l=="string"&&(h+='[crossorigin="'+l+'"]'),l0.has(h)||(l0.add(h),n={rel:n,crossOrigin:l,href:s},u.querySelector(h)===null&&(s=u.createElement("link"),Hn(s,"link",n),Ct(s),u.head.appendChild(s)))}}function Qy(n){is.D(n),o0("dns-prefetch",n,null)}function Ky(n,s){is.C(n,s),o0("preconnect",n,s)}function Jy(n,s,l){is.L(n,s,l);var u=Qi;if(u&&n&&s){var h='link[rel="preload"][as="'+Rn(s)+'"]';s==="image"&&l&&l.imageSrcSet?(h+='[imagesrcset="'+Rn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(h+='[imagesizes="'+Rn(l.imageSizes)+'"]')):h+='[href="'+Rn(n)+'"]';var y=h;switch(s){case"style":y=Ki(n);break;case"script":y=Ji(n)}er.has(y)||(n=x({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:n,as:s},l),er.set(y,n),u.querySelector(h)!==null||s==="style"&&u.querySelector(Hl(y))||s==="script"&&u.querySelector(Yl(y))||(s=u.createElement("link"),Hn(s,"link",n),Ct(s),u.head.appendChild(s)))}}function e1(n,s){is.m(n,s);var l=Qi;if(l&&n){var u=s&&typeof s.as=="string"?s.as:"script",h='link[rel="modulepreload"][as="'+Rn(u)+'"][href="'+Rn(n)+'"]',y=h;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Ji(n)}if(!er.has(y)&&(n=x({rel:"modulepreload",href:n},s),er.set(y,n),l.querySelector(h)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Yl(y)))return}u=l.createElement("link"),Hn(u,"link",n),Ct(u),l.head.appendChild(u)}}}function t1(n,s,l){is.S(n,s,l);var u=Qi;if(u&&n){var h=dt(u).hoistableStyles,y=Ki(n);s=s||"default";var k=h.get(y);if(!k){var B={loading:0,preload:null};if(k=u.querySelector(Hl(y)))B.loading=5;else{n=x({rel:"stylesheet",href:n,"data-precedence":s},l),(l=er.get(y))&&yf(n,l);var te=k=u.createElement("link");Ct(te),Hn(te,"link",n),te._p=new Promise(function(de,Ae){te.onload=de,te.onerror=Ae}),te.addEventListener("load",function(){B.loading|=1}),te.addEventListener("error",function(){B.loading|=2}),B.loading|=4,sc(k,s,u)}k={type:"stylesheet",instance:k,count:1,state:B},h.set(y,k)}}}function n1(n,s){is.X(n,s);var l=Qi;if(l&&n){var u=dt(l).hoistableScripts,h=Ji(n),y=u.get(h);y||(y=l.querySelector(Yl(h)),y||(n=x({src:n,async:!0},s),(s=er.get(h))&&vf(n,s),y=l.createElement("script"),Ct(y),Hn(y,"link",n),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(h,y))}}function a1(n,s){is.M(n,s);var l=Qi;if(l&&n){var u=dt(l).hoistableScripts,h=Ji(n),y=u.get(h);y||(y=l.querySelector(Yl(h)),y||(n=x({src:n,async:!0,type:"module"},s),(s=er.get(h))&&vf(n,s),y=l.createElement("script"),Ct(y),Hn(y,"link",n),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(h,y))}}function c0(n,s,l,u){var h=(h=Oe.current)?rc(h):null;if(!h)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=Ki(l.href),l=dt(h).hoistableStyles,u=l.get(s),u||(u={type:"style",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){n=Ki(l.href);var y=dt(h).hoistableStyles,k=y.get(n);if(k||(h=h.ownerDocument||h,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(n,k),(y=h.querySelector(Hl(n)))&&!y._p&&(k.instance=y,k.state.loading=5),er.has(n)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},er.set(n,l),y||r1(h,n,l,k.state))),s&&u===null)throw Error(i(528,""));return k}if(s&&u!==null)throw Error(i(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Ji(l),l=dt(h).hoistableScripts,u=l.get(s),u||(u={type:"script",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function Ki(n){return'href="'+Rn(n)+'"'}function Hl(n){return'link[rel="stylesheet"]['+n+"]"}function u0(n){return x({},n,{"data-precedence":n.precedence,precedence:null})}function r1(n,s,l,u){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=n.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),Hn(s,"link",l),Ct(s),n.head.appendChild(s))}function Ji(n){return'[src="'+Rn(n)+'"]'}function Yl(n){return"script[async]"+n}function f0(n,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var u=n.querySelector('style[data-href~="'+Rn(l.href)+'"]');if(u)return s.instance=u,Ct(u),u;var h=x({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(n.ownerDocument||n).createElement("style"),Ct(u),Hn(u,"style",h),sc(u,l.precedence,n),s.instance=u;case"stylesheet":h=Ki(l.href);var y=n.querySelector(Hl(h));if(y)return s.state.loading|=4,s.instance=y,Ct(y),y;u=u0(l),(h=er.get(h))&&yf(u,h),y=(n.ownerDocument||n).createElement("link"),Ct(y);var k=y;return k._p=new Promise(function(B,te){k.onload=B,k.onerror=te}),Hn(y,"link",u),s.state.loading|=4,sc(y,l.precedence,n),s.instance=y;case"script":return y=Ji(l.src),(h=n.querySelector(Yl(y)))?(s.instance=h,Ct(h),h):(u=l,(h=er.get(y))&&(u=x({},l),vf(u,h)),n=n.ownerDocument||n,h=n.createElement("script"),Ct(h),Hn(h,"link",u),n.head.appendChild(h),s.instance=h);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,sc(u,l.precedence,n));return s.instance}function sc(n,s,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=u.length?u[u.length-1]:null,y=h,k=0;k<u.length;k++){var B=u[k];if(B.dataset.precedence===s)y=B;else if(y!==h)break}y?y.parentNode.insertBefore(n,y.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(n,s.firstChild))}function yf(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function vf(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var ic=null;function d0(n,s,l){if(ic===null){var u=new Map,h=ic=new Map;h.set(l,u)}else h=ic,u=h.get(l),u||(u=new Map,h.set(l,u));if(u.has(n))return u;for(u.set(n,null),l=l.getElementsByTagName(n),h=0;h<l.length;h++){var y=l[h];if(!(y[Aa]||y[sn]||n==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var k=y.getAttribute(s)||"";k=n+k;var B=u.get(k);B?B.push(y):u.set(k,[y])}}return u}function p0(n,s,l){n=n.ownerDocument||n,n.head.insertBefore(l,s==="title"?n.querySelector("head > title"):null)}function s1(n,s,l){if(l===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(n=s.disabled,typeof s.precedence=="string"&&n==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function h0(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var ql=null;function i1(){}function l1(n,s,l){if(ql===null)throw Error(i(475));var u=ql;if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var h=Ki(l.href),y=n.querySelector(Hl(h));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(u.count++,u=lc.bind(u),n.then(u,u)),s.state.loading|=4,s.instance=y,Ct(y);return}y=n.ownerDocument||n,l=u0(l),(h=er.get(h))&&yf(l,h),y=y.createElement("link"),Ct(y);var k=y;k._p=new Promise(function(B,te){k.onload=B,k.onerror=te}),Hn(y,"link",l),s.instance=y}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(u.count++,s=lc.bind(u),n.addEventListener("load",s),n.addEventListener("error",s))}}function o1(){if(ql===null)throw Error(i(475));var n=ql;return n.stylesheets&&n.count===0&&bf(n,n.stylesheets),0<n.count?function(s){var l=setTimeout(function(){if(n.stylesheets&&bf(n,n.stylesheets),n.unsuspend){var u=n.unsuspend;n.unsuspend=null,u()}},6e4);return n.unsuspend=s,function(){n.unsuspend=null,clearTimeout(l)}}:null}function lc(){if(this.count--,this.count===0){if(this.stylesheets)bf(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var oc=null;function bf(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,oc=new Map,s.forEach(c1,n),oc=null,lc.call(n))}function c1(n,s){if(!(s.state.loading&4)){var l=oc.get(n);if(l)var u=l.get(null);else{l=new Map,oc.set(n,l);for(var h=n.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<h.length;y++){var k=h[y];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(l.set(k.dataset.precedence,k),u=k)}u&&l.set(null,u)}h=s.instance,k=h.getAttribute("data-precedence"),y=l.get(k)||u,y===u&&l.set(null,h),l.set(k,h),this.count++,u=lc.bind(this),h.addEventListener("load",u),h.addEventListener("error",u),y?y.parentNode.insertBefore(h,y.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(h,n.firstChild)),s.state.loading|=4}}var Vl={$$typeof:_,Provider:null,Consumer:null,_currentValue:ue,_currentValue2:ue,_threadCount:0};function u1(n,s,l,u,h,y,k,B){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=rr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rr(0),this.hiddenUpdates=rr(null),this.identifierPrefix=u,this.onUncaughtError=h,this.onCaughtError=y,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function m0(n,s,l,u,h,y,k,B,te,de,Ae,Ne){return n=new u1(n,s,l,k,B,te,de,Ne),s=1,y===!0&&(s|=24),y=Da(3,null,null,s),n.current=y,y.stateNode=n,s=Jc(),s.refCount++,n.pooledCache=s,s.refCount++,y.memoizedState={element:u,isDehydrated:l,cache:s},au(y),n}function g0(n){return n?(n=Ri,n):Ri}function y0(n,s,l,u,h,y){h=g0(h),u.context===null?u.context=h:u.pendingContext=h,u=Ss(s),u.payload={element:l},y=y===void 0?null:y,y!==null&&(u.callback=y),l=Es(n,u,s),l!==null&&(Ua(l,n,s),El(l,n,s))}function v0(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var l=n.retryLane;n.retryLane=l!==0&&l<s?l:s}}function xf(n,s){v0(n,s),(n=n.alternate)&&v0(n,s)}function b0(n){if(n.tag===13){var s=ki(n,67108864);s!==null&&Ua(s,n,67108864),xf(n,67108864)}}var cc=!0;function f1(n,s,l,u){var h=Y.T;Y.T=null;var y=ee.p;try{ee.p=2,Sf(n,s,l,u)}finally{ee.p=y,Y.T=h}}function d1(n,s,l,u){var h=Y.T;Y.T=null;var y=ee.p;try{ee.p=8,Sf(n,s,l,u)}finally{ee.p=y,Y.T=h}}function Sf(n,s,l,u){if(cc){var h=Ef(u);if(h===null)of(n,s,u,uc,l),S0(n,u);else if(h1(h,n,s,l,u))u.stopPropagation();else if(S0(n,u),s&4&&-1<p1.indexOf(n)){for(;h!==null;){var y=xn(h);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var k=bn(y.pendingLanes);if(k!==0){var B=y;for(B.pendingLanes|=2,B.entangledLanes|=2;k;){var te=1<<31-dn(k);B.entanglements[1]|=te,k&=~te}Or(y),(It&6)===0&&(Xo=Ie()+500,Fl(0))}}break;case 13:B=ki(y,2),B!==null&&Ua(B,y,2),Wo(),xf(y,2)}if(y=Ef(u),y===null&&of(n,s,u,uc,l),y===h)break;h=y}h!==null&&u.stopPropagation()}else of(n,s,u,null,l)}}function Ef(n){return n=tn(n),wf(n)}var uc=null;function wf(n){if(uc=null,n=Jt(n),n!==null){var s=c(n);if(s===null)n=null;else{var l=s.tag;if(l===13){if(n=f(s),n!==null)return n;n=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return uc=n,null}function x0(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nt()){case Ue:return 2;case xe:return 8;case Ze:case Zt:return 32;case fn:return 268435456;default:return 32}default:return 32}}var Af=!1,Ls=null,Us=null,js=null,Xl=new Map,$l=new Map,Bs=[],p1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function S0(n,s){switch(n){case"focusin":case"focusout":Ls=null;break;case"dragenter":case"dragleave":Us=null;break;case"mouseover":case"mouseout":js=null;break;case"pointerover":case"pointerout":Xl.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":$l.delete(s.pointerId)}}function Wl(n,s,l,u,h,y){return n===null||n.nativeEvent!==y?(n={blockedOn:s,domEventName:l,eventSystemFlags:u,nativeEvent:y,targetContainers:[h]},s!==null&&(s=xn(s),s!==null&&b0(s)),n):(n.eventSystemFlags|=u,s=n.targetContainers,h!==null&&s.indexOf(h)===-1&&s.push(h),n)}function h1(n,s,l,u,h){switch(s){case"focusin":return Ls=Wl(Ls,n,s,l,u,h),!0;case"dragenter":return Us=Wl(Us,n,s,l,u,h),!0;case"mouseover":return js=Wl(js,n,s,l,u,h),!0;case"pointerover":var y=h.pointerId;return Xl.set(y,Wl(Xl.get(y)||null,n,s,l,u,h)),!0;case"gotpointercapture":return y=h.pointerId,$l.set(y,Wl($l.get(y)||null,n,s,l,u,h)),!0}return!1}function E0(n){var s=Jt(n.target);if(s!==null){var l=c(s);if(l!==null){if(s=l.tag,s===13){if(s=f(l),s!==null){n.blockedOn=s,ua(n.priority,function(){if(l.tag===13){var u=La();u=oa(u);var h=ki(l,u);h!==null&&Ua(h,l,u),xf(l,u)}});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){n.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}n.blockedOn=null}function fc(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var l=Ef(n.nativeEvent);if(l===null){l=n.nativeEvent;var u=new l.constructor(l.type,l);ps=u,l.target.dispatchEvent(u),ps=null}else return s=xn(l),s!==null&&b0(s),n.blockedOn=l,!1;s.shift()}return!0}function w0(n,s,l){fc(n)&&l.delete(s)}function m1(){Af=!1,Ls!==null&&fc(Ls)&&(Ls=null),Us!==null&&fc(Us)&&(Us=null),js!==null&&fc(js)&&(js=null),Xl.forEach(w0),$l.forEach(w0)}function dc(n,s){n.blockedOn===s&&(n.blockedOn=null,Af||(Af=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,m1)))}var pc=null;function A0(n){pc!==n&&(pc=n,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){pc===n&&(pc=null);for(var s=0;s<n.length;s+=3){var l=n[s],u=n[s+1],h=n[s+2];if(typeof u!="function"){if(wf(u||l)===null)continue;break}var y=xn(l);y!==null&&(n.splice(s,3),s-=3,Eu(y,{pending:!0,data:h,method:l.method,action:u},u,h))}}))}function Zl(n){function s(te){return dc(te,n)}Ls!==null&&dc(Ls,n),Us!==null&&dc(Us,n),js!==null&&dc(js,n),Xl.forEach(s),$l.forEach(s);for(var l=0;l<Bs.length;l++){var u=Bs[l];u.blockedOn===n&&(u.blockedOn=null)}for(;0<Bs.length&&(l=Bs[0],l.blockedOn===null);)E0(l),l.blockedOn===null&&Bs.shift();if(l=(n.ownerDocument||n).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var h=l[u],y=l[u+1],k=h[Gt]||null;if(typeof y=="function")k||A0(l);else if(k){var B=null;if(y&&y.hasAttribute("formAction")){if(h=y,k=y[Gt]||null)B=k.formAction;else if(wf(h)!==null)continue}else B=k.action;typeof B=="function"?l[u+1]=B:(l.splice(u,3),u-=3),A0(l)}}}function Tf(n){this._internalRoot=n}hc.prototype.render=Tf.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var l=s.current,u=La();y0(l,u,n,s,null,null)},hc.prototype.unmount=Tf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;y0(n.current,2,null,n,null,null),Wo(),s[Dt]=null}};function hc(n){this._internalRoot=n}hc.prototype.unstable_scheduleHydration=function(n){if(n){var s=ca();n={blockedOn:null,target:n,priority:s};for(var l=0;l<Bs.length&&s!==0&&s<Bs[l].priority;l++);Bs.splice(l,0,n),l===0&&E0(n)}};var T0=e.version;if(T0!=="19.1.1")throw Error(i(527,T0,"19.1.1"));ee.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=m(s),n=n!==null?v(n):null,n=n===null?null:n.stateNode,n};var g1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mc.isDisabled&&mc.supportsFiber)try{qn=mc.inject(g1),Xt=mc}catch{}}return Kl.createRoot=function(n,s){if(!o(n))throw Error(i(299));var l=!1,u="",h=zp,y=Gp,k=Hp,B=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(h=s.onUncaughtError),s.onCaughtError!==void 0&&(y=s.onCaughtError),s.onRecoverableError!==void 0&&(k=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(B=s.unstable_transitionCallbacks)),s=m0(n,1,!1,null,null,l,u,h,y,k,B,null),n[Dt]=s.current,lf(n),new Tf(s)},Kl.hydrateRoot=function(n,s,l){if(!o(n))throw Error(i(299));var u=!1,h="",y=zp,k=Gp,B=Hp,te=null,de=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(h=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(k=l.onCaughtError),l.onRecoverableError!==void 0&&(B=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(te=l.unstable_transitionCallbacks),l.formState!==void 0&&(de=l.formState)),s=m0(n,1,!0,s,l??null,u,h,y,k,B,te,de),s.context=g0(null),l=s.current,u=La(),u=oa(u),h=Ss(u),h.callback=null,Es(l,h,u),l=u,s.current.lanes=l,la(s,l),Or(s),n[Dt]=s.current,lf(n),new hc(s)},Kl.version="19.1.1",Kl}var L0;function T1(){if(L0)return Nf.exports;L0=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Nf.exports=A1(),Nf.exports}var C1=T1();const M1=ad(C1),N1="modulepreload",k1=function(a,e){return new URL(a,e).href},U0={},j0=function(e,r,i){let o=Promise.resolve();if(r&&r.length>0){let v=function(x){return Promise.all(x.map(T=>Promise.resolve(T).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const f=document.getElementsByTagName("link"),g=document.querySelector("meta[property=csp-nonce]"),m=g?.nonce||g?.getAttribute("nonce");o=v(r.map(x=>{if(x=k1(x,i),x in U0)return;U0[x]=!0;const T=x.endsWith(".css"),S=T?'[rel="stylesheet"]':"";if(i)for(let M=f.length-1;M>=0;M--){const D=f[M];if(D.href===x&&(!T||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${x}"]${S}`))return;const E=document.createElement("link");if(E.rel=T?"stylesheet":N1,T||(E.as="script"),E.crossOrigin="",E.href=x,m&&E.setAttribute("nonce",m),document.head.appendChild(E),T)return new Promise((M,D)=>{E.addEventListener("load",M),E.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${x}`)))})}))}function c(f){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=f,window.dispatchEvent(g),!g.defaultPrevented)throw f}return o.then(f=>{for(const g of f||[])g.status==="rejected"&&c(g.reason);return e().catch(c)})};class pr{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,r,i={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==pr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof r!="function")throw new TypeError("The callback must be a function.");const o=new B0(e,this,r,i);return this.eventMap[e]||(this.eventMap[e]=[]),i.prepend?this.eventMap[e].unshift(o):this.eventMap[e].push(o),o}addOneTimeListener(e,r,i={}){i.remaining=1,this.addListener(e,r,i)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,r){return e===void 0?this.eventMap[pr.ANY_EVENT]&&this.eventMap[pr.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,i])=>i.length>0):this.eventMap[e]&&this.eventMap[e].length>0?r instanceof B0?this.eventMap[e].filter(o=>o===r).length>0:typeof r=="function"?this.eventMap[e].filter(o=>o.callback===r).length>0:r==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(r=>{r.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(r=>{r.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...r){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let i=[],o=this.eventMap[pr.ANY_EVENT]||[];return this.eventMap[e]&&(o=o.concat(this.eventMap[e])),o.forEach(c=>{if(c.suspended)return;let f=[...r];Array.isArray(c.arguments)&&(f=f.concat(c.arguments)),c.remaining>0&&(i.push(c.callback.apply(c.context,f)),c.count++),--c.remaining<1&&c.remove()}),i}removeListener(e,r,i={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let o=this.eventMap[e].filter(c=>r&&c.callback!==r||i.remaining&&i.remaining!==c.remaining||i.context&&i.context!==c.context);o.length?this.eventMap[e]=o:delete this.eventMap[e]}async waitFor(e,r={}){return r.duration=parseInt(r.duration),(isNaN(r.duration)||r.duration<=0)&&(r.duration=1/0),new Promise((i,o)=>{let c,f=this.addListener(e,()=>{clearTimeout(c),i()},{remaining:1});r.duration!==1/0&&(c=setTimeout(()=>{f.remove(),o("The duration expired before the event was emitted.")},r.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class B0{constructor(e,r,i,o={}){if(typeof e!="string"&&!(e instanceof String)&&e!==pr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!r)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof i!="function")throw new TypeError("The 'callback' must be a function.");o.arguments!==void 0&&!Array.isArray(o.arguments)&&(o.arguments=[o.arguments]),o=Object.assign({context:r,remaining:1/0,arguments:void 0,duration:1/0},o),o.duration!==1/0&&setTimeout(()=>this.remove(),o.duration),this.arguments=o.arguments,this.callback=i,this.context=o.context,this.count=0,this.event=e,this.remaining=parseInt(o.remaining)>=1?parseInt(o.remaining):1/0,this.suspended=!1,this.target=r}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class Ce{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Ce.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Ce.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Ce.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Ce.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class nl{constructor(e,r={}){this.duration=De.defaults.note.duration,this.attack=De.defaults.note.attack,this.release=De.defaults.note.release,r.duration!=null&&(this.duration=r.duration),r.attack!=null&&(this.attack=r.attack),r.rawAttack!=null&&(this.attack=Le.from7bitToFloat(r.rawAttack)),r.release!=null&&(this.release=r.release),r.rawRelease!=null&&(this.release=Le.from7bitToFloat(r.rawRelease)),Number.isInteger(e)?this.identifier=Le.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const r=Le.getNoteDetails(e);if(De.validation&&!e)throw new Error("Invalid note identifier");this._name=r.name,this._accidental=r.accidental,this._octave=r.octave}get name(){return this._name}set name(e){if(De.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(De.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(De.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(De.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(De.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(De.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Le.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Le.from7bitToFloat(e)}get rawRelease(){return Le.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Le.from7bitToFloat(e)}get number(){return Le.toNoteNumber(this.identifier)}getOffsetNumber(e=0,r=0){return De.validation&&(e=parseInt(e)||0,r=parseInt(r)||0),Math.min(Math.max(this.number+e*12+r,0),127)}}class Le{static toNoteNumber(e,r=0){if(r=r==null?0:parseInt(r),isNaN(r))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const i=this.getNoteDetails(e);if(!i)throw new TypeError("Invalid note identifier");const o={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let c=(i.octave+1+r)*12;if(c+=o[i.name],i.accidental&&(i.accidental.startsWith("b")?c-=i.accidental.length:c+=i.accidental.length),c<0||c>127)throw new RangeError("Invalid octaveOffset value");return c}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const r=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!r)throw new TypeError("Invalid note identifier");const i=r[1].toUpperCase(),o=parseInt(r[3]);let c=r[2].toLowerCase();return c=c===""?void 0:c,{accidental:c,identifier:i+(c||"")+o,name:i,octave:o}}static sanitizeChannels(e){let r;if(De.validation){if(e==="all")r=["all"];else if(e==="none")return[]}return Array.isArray(e)?r=e:r=[e],r.indexOf("all")>-1&&(r=Ce.MIDI_CHANNEL_NUMBERS),r.map(function(i){return parseInt(i)}).filter(function(i){return i>=1&&i<=16})}static toTimestamp(e){let r=!1;const i=parseFloat(e);return isNaN(i)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?i>=0&&(r=De.time+i):i>=0&&(r=i),r)}static guessNoteNumber(e,r){r=parseInt(r)||0;let i=!1;if(Number.isInteger(e)&&e>=0&&e<=127)i=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)i=parseInt(e);else if(typeof e=="string"||e instanceof String)try{i=this.toNoteNumber(e.trim(),r)}catch{return!1}return i}static toNoteIdentifier(e,r){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(r=r==null?0:parseInt(r),isNaN(r))throw new RangeError("Invalid octaveOffset value");const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o=Math.floor(e/12-1)+r;return i[e%12]+o.toString()}static buildNote(e,r={}){if(r.octaveOffset=parseInt(r.octaveOffset)||0,e instanceof nl)return e;let i=this.guessNoteNumber(e,r.octaveOffset);if(i===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return r.octaveOffset=void 0,new nl(i,r)}static buildNoteArray(e,r={}){let i=[];return Array.isArray(e)||(e=[e]),e.forEach(o=>{i.push(this.buildNote(o,r))}),i}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,r=0){De.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),r=Math.min(Math.max(parseInt(r)||0,0),127));const i=((e<<7)+r)/16383;return Math.min(Math.max(i,0),1)}static fromFloatToMsbLsb(e){De.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const r=Math.round(e*16383);return{msb:r>>7,lsb:r&127}}static offsetNumber(e,r=0,i=0){if(De.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");r=parseInt(r)||0,i=parseInt(i)||0}return Math.min(Math.max(e+r*12+i,0),127)}static getPropertyByValue(e,r){return Object.keys(e).find(i=>e[i]===r)}static getCcNameByNumber(e){if(!(De.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return Ce.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let r=Ce.CONTROL_CHANGE_MESSAGES.find(i=>i.name===e);return r?r.number:Ce.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let r in Ce.CHANNEL_MODE_MESSAGES)if(Ce.CHANNEL_MODE_MESSAGES.hasOwnProperty(r)&&e===Ce.CHANNEL_MODE_MESSAGES[r])return r;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}class R1 extends pr{constructor(e,r){super(),this._output=e,this._number=r,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,r={time:0}){return this.output.send(e,r),this}sendKeyAftertouch(e,r,i={}){if(De.validation){if(i.useRawValue&&(i.rawValue=i.useRawValue),isNaN(parseFloat(r)))throw new RangeError("Invalid key aftertouch value.");if(i.rawValue){if(!(r>=0&&r<=127&&Number.isInteger(r)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(r>=0&&r<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}i.rawValue||(r=Le.fromFloatTo7Bit(r));const o=De.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Le.buildNoteArray(e).forEach(c=>{this.send([(Ce.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),c.getOffsetNumber(o),r],{time:Le.toTimestamp(i.time)})}),this}sendControlChange(e,r,i={}){if(typeof e=="string"&&(e=Le.getCcNumberByName(e)),Array.isArray(r)||(r=[r]),De.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(r=r.map(o=>{const c=Math.min(Math.max(parseInt(o),0),127);if(isNaN(c))throw new TypeError("Values must be integers between 0 and 127");return c}),r.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return r.forEach((o,c)=>{this.send([(Ce.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+c*32,r[c]],{time:Le.toTimestamp(i.time)})}),this}_selectNonRegisteredParameter(e,r={}){return this.sendControlChange(99,e[0],r),this.sendControlChange(98,e[1],r),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,r={}){return this.sendControlChange(101,e[0],r),this.sendControlChange(100,e[1],r),this}_setCurrentParameter(e,r={}){return e=[].concat(e),this.sendControlChange(6,e[0],r),e.length<2?this:(this.sendControlChange(38,e[1],r),this)}sendRpnDecrement(e,r={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),De.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(Ce.REGISTERED_PARAMETERS).forEach(o=>{Ce.REGISTERED_PARAMETERS[o][0]===e[0]&&Ce.REGISTERED_PARAMETERS[o][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,r),this.sendControlChange(97,0,r),this._deselectRegisteredParameter(r),this}sendRpnIncrement(e,r={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),De.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(Ce.REGISTERED_PARAMETERS).forEach(o=>{Ce.REGISTERED_PARAMETERS[o][0]===e[0]&&Ce.REGISTERED_PARAMETERS[o][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,r),this.sendControlChange(96,0,r),this._deselectRegisteredParameter(r),this}playNote(e,r={}){this.sendNoteOn(e,r);const i=Array.isArray(e)?e:[e];for(let o of i)if(parseInt(o.duration)>0){const c={time:(Le.toTimestamp(r.time)||De.time)+parseInt(o.duration),release:o.release,rawRelease:o.rawRelease};this.sendNoteOff(o,c)}else if(parseInt(r.duration)>0){const c={time:(Le.toTimestamp(r.time)||De.time)+parseInt(r.duration),release:r.release,rawRelease:r.rawRelease};this.sendNoteOff(o,c)}return this}sendNoteOff(e,r={}){if(De.validation){if(r.rawRelease!=null&&!(r.rawRelease>=0&&r.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(r.release!=null&&!(r.release>=0&&r.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");r.rawVelocity&&(r.rawRelease=r.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),r.velocity&&(r.release=r.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;r.rawRelease!=null?i=r.rawRelease:isNaN(r.release)||(i=Math.round(r.release*127));const o=De.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Le.buildNoteArray(e,{rawRelease:parseInt(i)}).forEach(c=>{this.send([(Ce.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),c.getOffsetNumber(o),c.rawRelease],{time:Le.toTimestamp(r.time)})}),this}stopNote(e,r={}){return this.sendNoteOff(e,r)}sendNoteOn(e,r={}){if(De.validation){if(r.rawAttack!=null&&!(r.rawAttack>=0&&r.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(r.attack!=null&&!(r.attack>=0&&r.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");r.rawVelocity&&(r.rawAttack=r.velocity,r.rawRelease=r.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),r.velocity&&(r.attack=r.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;r.rawAttack!=null?i=r.rawAttack:isNaN(r.attack)||(i=Math.round(r.attack*127));const o=De.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Le.buildNoteArray(e,{rawAttack:i}).forEach(c=>{this.send([(Ce.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),c.getOffsetNumber(o),c.rawAttack],{time:Le.toTimestamp(r.time)})}),this}sendChannelMode(e,r=0,i={}){if(typeof e=="string"&&(e=Ce.CHANNEL_MODE_MESSAGES[e]),De.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(r))||r<0||r>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Ce.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,r],{time:Le.toTimestamp(i.time)}),this}sendOmniMode(e,r={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,r):this.sendChannelMode("omnimodeoff",0,r),this}sendChannelAftertouch(e,r={}){if(De.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(r.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return r.rawValue||(e=Le.fromFloatTo7Bit(e)),this.send([(Ce.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:Le.toTimestamp(r.time)}),this}sendMasterTuning(e,r={}){if(e=parseFloat(e)||0,De.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let i=Math.floor(e)+64,o=e-Math.floor(e);o=Math.round((o+1)/2*16383);let c=o>>7&127,f=o&127;return this.sendRpnValue("channelcoarsetuning",i,r),this.sendRpnValue("channelfinetuning",[c,f],r),this}sendModulationRange(e,r,i={}){if(De.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(r!=null&&(!Number.isInteger(r)||!(r>=0&&r<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return r>=0&&r<=127||(r=0),this.sendRpnValue("modulationrange",[e,r],i),this}sendNrpnValue(e,r,i={}){if(r=[].concat(r),De.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");r.forEach(o=>{if(!(o>=0&&o<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,i),this._setCurrentParameter(r,i),this._deselectNonRegisteredParameter(i),this}sendPitchBend(e,r={}){if(De.validation)if(r.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(r.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let i=0,o=0;if(r.rawValue&&Array.isArray(e))i=e[0],o=e[1];else if(r.rawValue&&!Array.isArray(e))i=e;else{const c=Le.fromFloatToMsbLsb((e+1)/2);i=c.msb,o=c.lsb}return this.send([(Ce.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),o,i],{time:Le.toTimestamp(r.time)}),this}sendPitchBendRange(e,r,i={}){if(De.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(r)||!(r>=0&&r<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,r],i),this}sendProgramChange(e,r={}){if(e=parseInt(e)||0,De.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Ce.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Le.toTimestamp(r.time)}),this}sendRpnValue(e,r,i={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),De.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(r).forEach(o=>{if(!(o>=0&&o<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,i),this._setCurrentParameter(r,i),this._deselectRegisteredParameter(i),this}sendTuningBank(e,r={}){if(De.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,r),this}sendTuningProgram(e,r={}){if(De.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,r),this}sendLocalControl(e,r={}){return e?this.sendChannelMode("localcontrol",127,r):this.sendChannelMode("localcontrol",0,r)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,r={}){return e==="mono"?this.sendChannelMode("monomodeon",0,r):this.sendChannelMode("polymodeon",0,r)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class Yf extends pr{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let r=1;r<=16;r++)this.channels[r]=new R1(this,r);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let r={timestamp:De.time};e.port.connection==="open"?(r.type="opened",r.target=this,r.port=r.target,this.emit("opened",r)):e.port.connection==="closed"&&e.port.state==="connected"?(r.type="closed",r.target=this,r.port=r.target,this.emit("closed",r)):e.port.connection==="closed"&&e.port.state==="disconnected"?(r.type="disconnected",r.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",r)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,r={time:0},i=0){if(e instanceof zm&&(e=Le.isNode?e.data:e.rawData),e instanceof Uint8Array&&Le.isNode&&(e=Array.from(e)),De.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(r)&&(e=e.concat(r)),r=isNaN(i)?{time:0}:{time:i}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(o=>{if(o=parseInt(o),!(o>=0&&o<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),r||(r={time:0})}return this._midiOutput.send(e,Le.toTimestamp(r.time)),this}sendSysex(e,r=[],i={}){if(e=[].concat(e),r instanceof Uint8Array){const o=new Uint8Array(1+e.length+r.length+1);o[0]=Ce.SYSTEM_MESSAGES.sysex,o.set(Uint8Array.from(e),1),o.set(r,1+e.length),o[o.length-1]=Ce.SYSTEM_MESSAGES.sysexend,this.send(o,{time:i.time})}else{const o=e.concat(r,Ce.SYSTEM_MESSAGES.sysexend);this.send([Ce.SYSTEM_MESSAGES.sysex].concat(o),{time:i.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():De.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,r={}){if(De.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Ce.SYSTEM_MESSAGES.timecode,e],{time:r.time}),this}sendSongPosition(e=0,r={}){e=Math.floor(e)||0;var i=e>>7&127,o=e&127;return this.send([Ce.SYSTEM_MESSAGES.songposition,i,o],{time:r.time}),this}sendSongSelect(e=0,r={}){if(De.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Ce.SYSTEM_MESSAGES.songselect,e],{time:r.time}),this}sendTuneRequest(e={}){return this.send([Ce.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Ce.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Ce.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Ce.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Ce.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Ce.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Ce.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return De.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,r,i={}){return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendKeyAftertouch(e,r,i)}),this}sendControlChange(e,r,i={},o={}){if(De.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const c=i;i=o,i.channels=c,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(c=>{this.channels[c].sendControlChange(e,r,i)}),this}sendPitchBendRange(e=0,r=0,i={}){return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendPitchBendRange(e,r,i)}),this}setPitchBendRange(e=0,r=0,i="all",o={}){return De.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,r,o)}sendRpnValue(e,r,i={}){return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendRpnValue(e,r,i)}),this}setRegisteredParameter(e,r=[],i="all",o={}){return De.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,r,o)}sendChannelAftertouch(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendChannelAftertouch(e,r)}),this}sendPitchBend(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendPitchBend(e,r)}),this}sendProgramChange(e=0,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendProgramChange(e,r)}),this}sendModulationRange(e,r,i={}){return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendModulationRange(e,r,i)}),this}setModulationRange(e=0,r=0,i="all",o={}){return De.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,r,o)}sendMasterTuning(e,r={}){return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendMasterTuning(e,r)}),this}setMasterTuning(e,r={},i={}){return De.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,i)}sendTuningProgram(e,r={}){return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendTuningProgram(e,r)}),this}setTuningProgram(e,r="all",i={}){return De.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,i)}sendTuningBank(e=0,r={}){return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendTuningBank(e,r)}),this}setTuningBank(e,r="all",i={}){return De.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,i)}sendChannelMode(e,r=0,i={},o={}){if(De.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const c=i;i=o,i.channels=c,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(c=>{this.channels[c].sendChannelMode(e,r,i)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(e.channels).forEach(r=>{this.channels[r].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(e.channels).forEach(r=>{this.channels[r].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},r={}){if(De.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const i=e;e=r,e.channels=i,e.channels==="all"&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(e.channels).forEach(i=>{this.channels[i].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendPolyphonicMode(e,r)}),this}sendLocalControl(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendLocalControl(e,r)}),this}sendOmniMode(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendOmniMode(e,r)}),this}sendNrpnValue(e,r,i={}){return i.channels==null&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendNrpnValue(e,r,i)}),this}setNonRegisteredParameter(e,r=[],i="all",o={}){return De.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,r,o)}sendRpnIncrement(e,r={}){return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendRpnIncrement(e,r)}),this}incrementRegisteredParameter(e,r="all",i={}){return De.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,i)}sendRpnDecrement(e,r={}){return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendRpnDecrement(e,r)}),this}decrementRegisteredParameter(e,r="all",i={}){return De.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,i)}sendNoteOff(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendNoteOff(e,r)}),this}stopNote(e,r){return this.sendNoteOff(e,r)}playNote(e,r={},i={}){if(De.validation&&(r.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),r.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].playNote(e,r)}),this}sendNoteOn(e,r={},i={}){if(De.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendNoteOn(e,r)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class F0{constructor(e=[],r={}){this.destinations=[],this.types=[...Object.keys(Ce.SYSTEM_MESSAGES),...Object.keys(Ce.CHANNEL_MESSAGES)],this.channels=Ce.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),r.types&&!Array.isArray(r.types)&&(r.types=[r.types]),r.channels&&!Array.isArray(r.channels)&&(r.channels=[r.channels]),De.validation&&(e.forEach(i=>{if(!(i instanceof Yf))throw new TypeError("Destinations must be of type 'Output'.")}),r.types!==void 0&&r.types.forEach(i=>{if(!Ce.SYSTEM_MESSAGES.hasOwnProperty(i)&&!Ce.CHANNEL_MESSAGES.hasOwnProperty(i))throw new TypeError("Type must be a valid message type.")}),r.channels!==void 0&&r.channels.forEach(i=>{if(!Ce.MIDI_CHANNEL_NUMBERS.includes(i))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,r.types&&(this.types=r.types),r.channels&&(this.channels=r.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(r=>{De.validation&&!(r instanceof Yf)||r.send(e)}))}}class D1 extends pr{constructor(e,r){super(),this._input=e,this._number=r,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const r=Object.assign({},e);r.port=this.input,r.target=this,r.type="midimessage",this.emit(r.type,r),this._parseEventForStandardMessages(r)}_parseEventForStandardMessages(e){const r=Object.assign({},e);r.type=r.message.type||"unknownmessage";const i=e.message.dataBytes[0],o=e.message.dataBytes[1];if(r.type==="noteoff"||r.type==="noteon"&&o===0)this.notesState[i]=!1,r.type="noteoff",r.note=new nl(Le.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+De.octaveOffset),{rawAttack:0,rawRelease:o}),r.value=Le.from7bitToFloat(o),r.rawValue=o,r.velocity=r.note.release,r.rawVelocity=r.note.rawRelease;else if(r.type==="noteon")this.notesState[i]=!0,r.note=new nl(Le.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+De.octaveOffset),{rawAttack:o}),r.value=Le.from7bitToFloat(o),r.rawValue=o,r.velocity=r.note.attack,r.rawVelocity=r.note.rawAttack;else if(r.type==="keyaftertouch")r.note=new nl(Le.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+De.octaveOffset)),r.value=Le.from7bitToFloat(o),r.rawValue=o,r.identifier=r.note.identifier,r.key=r.note.number,r.rawKey=i;else if(r.type==="controlchange"){r.controller={number:i,name:Ce.CONTROL_CHANGE_MESSAGES[i].name,description:Ce.CONTROL_CHANGE_MESSAGES[i].description,position:Ce.CONTROL_CHANGE_MESSAGES[i].position},r.subtype=r.controller.name||"controller"+i,r.value=Le.from7bitToFloat(o),r.rawValue=o;const c=Object.assign({},r);c.type=`${r.type}-controller${i}`,delete c.subtype,this.emit(c.type,c);const f=Object.assign({},r);f.type=`${r.type}-`+Ce.CONTROL_CHANGE_MESSAGES[i].name,delete f.subtype,f.type.indexOf("controller")!==0&&this.emit(f.type,f),r.message.dataBytes[0]>=120&&this._parseChannelModeMessage(r),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(r.message.dataBytes[0])&&this._parseEventForParameterNumber(r)}else r.type==="programchange"?(r.value=i,r.rawValue=r.value):r.type==="channelaftertouch"?(r.value=Le.from7bitToFloat(i),r.rawValue=i):r.type==="pitchbend"?(r.value=((o<<7)+i-8192)/8192,r.rawValue=(o<<7)+i):r.type="unknownmessage";this.emit(r.type,r)}_parseChannelModeMessage(e){const r=Object.assign({},e);r.type=r.controller.name,r.type==="localcontrol"&&(r.value=r.message.data[2]===127,r.rawValue=r.message.data[2]),r.type==="omnimodeon"?(r.type="omnimode",r.value=!0,r.rawValue=r.message.data[2]):r.type==="omnimodeoff"&&(r.type="omnimode",r.value=!1,r.rawValue=r.message.data[2]),r.type==="monomodeon"?(r.type="monomode",r.value=!0,r.rawValue=r.message.data[2]):r.type==="polymodeon"&&(r.type="monomode",r.value=!1,r.rawValue=r.message.data[2]),this.emit(r.type,r)}_parseEventForParameterNumber(e){const r=e.message.dataBytes[0],i=e.message.dataBytes[1];r===99||r===101?(this._nrpnBuffer=[],this._rpnBuffer=[],r===99?this._nrpnBuffer=[e.message]:i!==127&&(this._rpnBuffer=[e.message])):r===98||r===100?r===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&i!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(r===6||r===38||r===96||r===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,r,i,o){e=e==="nrpn"?"nrpn":"rpn";const c={target:o.target,timestamp:o.timestamp,message:o.message,parameterMsb:r,parameterLsb:i,value:Le.from7bitToFloat(o.message.dataBytes[1]),rawValue:o.message.dataBytes[1]};e==="rpn"?c.parameter=Object.keys(Ce.REGISTERED_PARAMETERS).find(m=>Ce.REGISTERED_PARAMETERS[m][0]===r&&Ce.REGISTERED_PARAMETERS[m][1]===i):c.parameter=(r<<7)+i;const f=Ce.CONTROL_CHANGE_MESSAGES[o.message.dataBytes[0]].name;c.type=`${e}-${f}`,this.emit(c.type,c);const g=Object.assign({},c);g.type==="nrpn-dataincrement"?g.type="nrpn-databuttonincrement":g.type==="nrpn-datadecrement"?g.type="nrpn-databuttondecrement":g.type==="rpn-dataincrement"?g.type="rpn-databuttonincrement":g.type==="rpn-datadecrement"&&(g.type="rpn-databuttondecrement"),this.emit(g.type,g),c.type=e,c.subtype=f,this.emit(c.type,c)}getChannelModeByNumber(e){return De.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Le.getChannelModeByNumber(e)}getCcNameByNumber(e){if(De.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Le.getCcNameByNumber(e)}getNoteState(e){e instanceof nl&&(e=e.identifier);const r=Le.guessNoteNumber(e,De.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[r]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class zm{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Le.getPropertyByValue(Ce.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Le.getPropertyByValue(Ce.SYSTEM_MESSAGES,this.command)),this.statusByte===Ce.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class _1 extends pr{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let r=1;r<=16;r++)this.channels[r]=new D1(this,r);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let r={timestamp:De.time,target:this,port:this};e.port.connection==="open"?(r.type="opened",this.emit("opened",r)):e.port.connection==="closed"&&e.port.state==="connected"?(r.type="closed",this.emit("closed",r)):e.port.connection==="closed"&&e.port.state==="disconnected"?(r.type="disconnected",r.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",r)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const r=new zm(e.data),i={port:this,target:this,message:r,timestamp:e.timeStamp,type:"midimessage",data:r.data,rawData:r.data,statusByte:r.data[0],dataBytes:r.dataBytes};this.emit("midimessage",i),r.isSystemMessage?this._parseEvent(i):r.isChannelMessage&&this.channels[r.channel]._processMidiMessageEvent(i),this._forwarders.forEach(o=>o.forward(r))}_parseEvent(e){const r=Object.assign({},e);r.type=r.message.type||"unknownmidimessage",r.type==="songselect"&&(r.song=e.data[1]+1,r.value=e.data[1],r.rawValue=r.value),this.emit(r.type,r)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){De.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,r,i={}){if(De.validation&&typeof i=="function"){let o=r!=null?[].concat(r):void 0;r=i,i={channels:o}}if(Ce.CHANNEL_EVENTS.includes(e)){i.channels===void 0&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS);let o=[];return Le.sanitizeChannels(i.channels).forEach(c=>{o.push(this.channels[c].addListener(e,r,i))}),o}else return super.addListener(e,r,i)}addOneTimeListener(e,r,i={}){return i.remaining=1,this.addListener(e,r,i)}on(e,r,i,o){return this.addListener(e,r,i,o)}hasListener(e,r,i={}){if(De.validation&&typeof i=="function"){let o=[].concat(r);r=i,i={channels:o}}return Ce.CHANNEL_EVENTS.includes(e)?(i.channels===void 0&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),Le.sanitizeChannels(i.channels).every(o=>this.channels[o].hasListener(e,r))):super.hasListener(e,r)}removeListener(e,r,i={}){if(De.validation&&typeof i=="function"){let o=[].concat(r);r=i,i={channels:o}}if(i.channels===void 0&&(i.channels=Ce.MIDI_CHANNEL_NUMBERS),e==null)return Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o]&&this.channels[o].removeListener()}),super.removeListener();Ce.CHANNEL_EVENTS.includes(e)?Le.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].removeListener(e,r,i)}):super.removeListener(e,r,i)}addForwarder(e,r={}){let i;return e instanceof F0?i=e:i=new F0(e,r),this._forwarders.push(i),i}removeForwarder(e){this._forwarders=this._forwarders.filter(r=>r!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return De.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class O1 extends pr{constructor(){super(),this.defaults={note:{attack:Le.from7bitToFloat(64),release:Le.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},r=!1){if(Le.isNode)try{window.navigator}catch{let g=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,g)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:r}),r&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const i={timestamp:this.time,target:this,type:"error",error:void 0},o={timestamp:this.time,target:this,type:"midiaccessgranted"},c={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(f){return i.error=f,this.emit("error",i),typeof e.callback=="function"&&e.callback(f),Promise.reject(f)}this.emit("midiaccessgranted",o),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(f){return i.error=f,this.emit("error",i),typeof e.callback=="function"&&e.callback(f),Promise.reject(f)}return this.emit("enabled",c),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(r.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(this._disconnectedInputs[i]._midiInput&&this._disconnectedInputs[i].id===e.toString())return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(this.inputs[i]._midiInput&&this.inputs[i].id===e.toString())return this.inputs[i]}getInputByName(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(r.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(~this._disconnectedInputs[i].name.indexOf(e))return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(e))return this.inputs[i]}getOutputByName(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(r.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(~this._disconnectedOutputs[i].name.indexOf(e))return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(e))return this.outputs[i]}getOutputById(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(r.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(this._disconnectedOutputs[i]._midiOutput&&this._disconnectedOutputs[i].id===e.toString())return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(this.outputs[i]._midiOutput&&this.outputs[i].id===e.toString())return this.outputs[i]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Le.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?Le.getNoteDetails(Le.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Le.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Le.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Le.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,r={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Le.buildNoteArray(e,r)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Le.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(r=>e.push(r.destroy())),this.outputs.forEach(r=>e.push(r.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let r={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?r.port=this.getOutputById(e.port.id):e.port.type==="input"&&(r.port=this.getInputById(e.port.id)),this.emit(e.port.state,r);const i=Object.assign({},r);i.type="portschanged",this.emit(i.type,i)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?r.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(r.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,r);const i=Object.assign({},r);i.type="portschanged",this.emit(i.type,i)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let r=this._inputs.length-1;r>=0;r--){const i=this._inputs[r];Array.from(this.interface.inputs.values()).find(c=>c===i._midiInput)||(this._disconnectedInputs.push(i),this._inputs.splice(r,1))}let e=[];return this.interface.inputs.forEach(r=>{if(!this._inputs.find(i=>i._midiInput===r)){let i=this._disconnectedInputs.find(o=>o._midiInput===r);i||(i=new _1(r)),this._inputs.push(i),e.push(i.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let r=this._outputs.length-1;r>=0;r--){const i=this._outputs[r];Array.from(this.interface.outputs.values()).find(c=>c===i._midiOutput)||(this._disconnectedOutputs.push(i),this._outputs.splice(r,1))}let e=[];return this.interface.outputs.forEach(r=>{if(!this._outputs.find(i=>i._midiOutput===r)){let i=this._disconnectedOutputs.find(o=>o._midiOutput===r);i||(i=new Yf(r)),this._outputs.push(i),e.push(i.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Le.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Le.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Ce.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Ce.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Ce.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Ce.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Ce.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const De=new O1;De.constructor=null;const I1=async()=>{if(De.enabled)return De;try{return await De.enable({sysex:!0}),console.log("WebMidi is enabled with SysEx support!"),De}catch(a){throw console.error("WebMidi could not be enabled.",a),a}},P0=()=>De.enabled?De.inputs.map(a=>({id:a.id,name:a.name})):[],L1=(a,e)=>{if(De.enabled){const r=De.getInputById(a);if(r){const i=f=>{e({type:"noteon",note:f.note.identifier,velocity:f.velocity,controller:null,channel:f.message.channel})},o=f=>{e({type:"noteoff",note:f.note.identifier,velocity:0,controller:null,channel:f.message.channel})},c=f=>{e({type:"controlchange",controller:f.controller.number,value:f.rawValue,note:null,channel:f.message.channel})};return r.addListener("noteon",i),r.addListener("noteoff",o),r.addListener("controlchange",c),()=>{r.removeListener("noteon",i),r.removeListener("noteoff",o),r.removeListener("controlchange",c)}}}return()=>{}},U1=a=>{if(De.enabled){const e=r=>{a(r)};return De.addListener("connected",e),De.addListener("disconnected",e),()=>{De.removeListener("connected",e),De.removeListener("disconnected",e)}}return()=>{}},j1=(a,e)=>{if(De.enabled){const r=De.getInputById(a);if(r){const i=De.outputs.find(o=>o.name===r.name);i?(i.sendSysex(71,e),console.log(`Sent SysEx to ${i.name}`)):console.warn("Could not find matching MIDI Output for SysEx")}}},wc=(a,e,r,i)=>{if(De.enabled){const o=De.getInputById(a);if(o){const c=De.outputs.find(f=>f.name===o.name);c&&c.sendNoteOn(e,{attack:r/127,channels:i})}}},Gm=R.createContext(null),Oc=()=>R.useContext(Gm),B1=({children:a,onMidiCommand:e})=>{const[r,i]=R.useState(!1),[o,c]=R.useState([]),[f,g]=R.useState(""),[m,v]=R.useState(!1),[x,T]=R.useState(null),[S,E]=R.useState({}),[M,D]=R.useState(null),[j,P]=R.useState(!1),F=R.useRef(!1),_=R.useRef(e);R.useEffect(()=>{_.current=e},[e]),R.useEffect(()=>{(async()=>{try{if(await I1(),i(!0),c(P0()),U1(()=>{console.log("MIDI Device change detected, refreshing inputs..."),c(P0())}),window.electronAPI&&window.electronAPI.getMidiMappings){const Y=await window.electronAPI.getMidiMappings();Y&&(console.log("Loaded saved MIDI mappings:",Y),E(Y))}}catch(Y){console.error("MIDI Init Failed:",Y)}})()},[]),R.useEffect(()=>{(async()=>{if(!r||o.length===0)return;let Y=f;if(!Y&&window.electronAPI?.getSelectedMidiInput){const ee=await window.electronAPI.getSelectedMidiInput();ee&&o.some(ue=>ue.id===ee)&&(Y=ee)}(!Y||!o.some(ee=>ee.id===Y))&&(Y=o[0].id),Y!==f&&(console.log(`MIDI: Auto-selecting input: ${Y}`),g(Y))})()},[r,o,f]);const L=async()=>{window.electronAPI&&window.electronAPI.saveMidiMappings&&(await window.electronAPI.saveMidiMappings(S),console.log("MIDI mappings saved to default."))},I=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(S,"midi")},V=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const re=await window.electronAPI.importMappings("midi");re.success&&re.mappings&&(E(re.mappings),console.log("MIDI mappings imported."))}},$=re=>{const Y=o.find(ee=>ee.id===re);Y&&Y.name.toLowerCase().includes("apc40")&&(console.log("Detected APC40, sending initialization SysEx..."),j1(re,[127,41,96,0,4,65,1,1,1]))};R.useEffect(()=>{f&&window.electronAPI&&window.electronAPI.saveSelectedMidiInput&&window.electronAPI.saveSelectedMidiInput(f),f&&r&&$(f)},[f,r,o]);const J=R.useCallback((re,Y,ee=null)=>{if(!f||!r)return;const ue=S[re];if(ue&&ue.type==="note"){let Ee=0;typeof Y=="number"?Ee=Y:Ee=Y?127:0;const q=ee!==null?ee:ue.channel;wc(f,ue.address,Ee,q)}},[f,r,S]);R.useEffect(()=>{let re=()=>{};return f&&(console.log(`(Re)binding MIDI listener for: ${f}`),re=L1(f,Y=>{ie.current&&D(Y),oe(Y)})),re},[f,m,x,S,o]);const ie=R.useRef(m);R.useEffect(()=>{ie.current=m},[m]);const oe=re=>{if(re.channel===1&&re.note==="D7"){const ee=re.type==="noteon";P(ee),F.current=ee,console.log(`Shift ${ee?"Down":"Up"}`);return}if(m&&x){if(re.type==="noteoff")return;const ee=re.note||re.controller,ue=F.current,Ee={type:re.type==="noteon"||re.type==="noteoff"?"note":"cc",channel:re.channel,address:ee,requiresShift:ue,label:`${ue?"":""}CH${re.channel}:${ee}`};console.log(`Mapped ${x} to:`,Ee),E(q=>({...q,[x]:Ee})),T(null);return}Object.entries(S).forEach(([ee,ue])=>{const Ee=(re.type==="noteon"||re.type==="noteoff")&&ue.type==="note"&&re.note===ue.address&&re.channel===ue.channel,q=re.type==="controlchange"&&ue.type==="cc"&&re.controller===ue.address&&re.channel===ue.channel,Q=ue.type==="cc"||!!ue.requiresShift===F.current;if((Ee||q)&&Q&&_.current){let be;re.type==="controlchange"?be=re.value??0:re.type==="noteoff"?be=0:be=re.velocity??0,_.current(ee,be,127,re.type)}})},W={midiInitialized:r,midiInputs:o,selectedMidiInputId:f,setSelectedMidiInputId:g,isMapping:m,startMapping:()=>v(!0),stopMapping:()=>{v(!1),T(null)},learningId:x,setLearningId:T,mappings:S,setMappings:E,removeMapping:re=>{E(Y=>{const ee={...Y};return delete ee[re],ee})},saveMappings:L,exportMappings:I,importMappings:V,initializeApc40:$,sendFeedback:J,lastMidiEvent:M,isShiftDown:j};return d.jsx(Gm.Provider,{value:W,children:a})},Hm=R.createContext(null),sd=()=>R.useContext(Hm),F1=({children:a,onArtnetCommand:e})=>{const[r,i]=R.useState(!1),[o,c]=R.useState(!1),[f,g]=R.useState(null),[m,v]=R.useState({}),[x,T]=R.useState(null),S=R.useRef(e);R.useEffect(()=>{S.current=e},[e]),R.useEffect(()=>{(async()=>{try{if(window.electronAPI&&window.electronAPI.initializeArtnet&&(await window.electronAPI.initializeArtnet()).success&&(i(!0),console.log("Art-Net initialized for mapping")),window.electronAPI&&window.electronAPI.getArtnetMappings){const V=await window.electronAPI.getArtnetMappings();V&&(console.log("Loaded saved Art-Net mappings:",V),v(V))}}catch(V){console.error("Art-Net Init Failed:",V)}})()},[]);const E=async()=>{window.electronAPI&&window.electronAPI.saveArtnetMappings&&(await window.electronAPI.saveArtnetMappings(m),console.log("Art-Net mappings saved."))},M=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(m,"artnet")},D=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const I=await window.electronAPI.importMappings("artnet");I.success&&I.mappings&&(v(I.mappings),console.log("Art-Net mappings imported."))}};R.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onArtnetDataReceived)return window.electronAPI.onArtnetDataReceived(V=>{j.current&&T(V),P(V)})},[o,f,m]);const j=R.useRef(o);R.useEffect(()=>{j.current=o},[o]);const P=I=>{const{universe:V,channel:$,value:J}=I;if(o&&f){if(J===0)return;const ie={universe:V,channel:$,label:`U${V}:CH${$+1}`};console.log(`Mapped ${f} to Art-Net:`,ie),v(oe=>({...oe,[f]:ie})),g(null);return}Object.entries(m).forEach(([ie,oe])=>{oe.universe===V&&oe.channel===$&&S.current&&S.current(ie,J)})},L={artnetInitialized:r,isMapping:o,startMapping:()=>c(!0),stopMapping:()=>{c(!1),g(null)},learningId:f,setLearningId:g,mappings:m,setMappings:v,saveMappings:E,exportMappings:M,importMappings:D,lastDmxEvent:x};return d.jsx(Hm.Provider,{value:L,children:a})},Ym=R.createContext(null),id=()=>R.useContext(Ym),P1=({children:a,onCommand:e,enabled:r=!1})=>{const[i,o]=R.useState(!1),[c,f]=R.useState(null),[g,m]=R.useState({}),v=R.useRef(e);R.useEffect(()=>{v.current=e},[e]),R.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getKeyboardMappings){const D=await window.electronAPI.getKeyboardMappings();D&&m(D)}})()},[]);const x=async()=>{window.electronAPI&&window.electronAPI.saveKeyboardMappings&&await window.electronAPI.saveKeyboardMappings(g)},T=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(g,"keyboard")},S=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const M=await window.electronAPI.importMappings("keyboard");M.success&&M.mappings&&m(M.mappings)}};R.useEffect(()=>{const M=D=>{if(r&&!(D.target.tagName==="INPUT"||D.target.tagName==="TEXTAREA"||D.target.isContentEditable)){if(i&&c){D.preventDefault();const j={key:D.code,label:D.code.replace("Key","").replace("Digit","")};m(P=>({...P,[c]:j})),f(null);return}Object.entries(g).forEach(([j,P])=>{D.code===P.key&&(D.preventDefault(),v.current&&v.current(j,1,1,"keydown"))})}};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[r,i,c,g]);const E={isMapping:i,startMapping:()=>o(!0),stopMapping:()=>{o(!1),f(null)},learningId:c,setLearningId:f,mappings:g,setMappings:m,saveMappings:x,exportMappings:T,importMappings:S,removeMapping:M=>m(D=>{const j={...D};return delete j[M],j})};return d.jsx(Ym.Provider,{value:E,children:a})},$t=({id:a,children:e})=>{const{isMapping:r,setLearningId:i,removeMapping:o}=Oc(),{isMapping:c,setLearningId:f,removeMapping:g}=sd()||{},{isMapping:m,setLearningId:v,removeMapping:x}=id()||{},T=r||c||m,S=D=>{T&&(D.preventDefault(),D.stopPropagation(),r&&i(a),c&&f(a),m&&v(a))},E=D=>{T&&(D.preventDefault(),D.stopPropagation(),r&&o(a),c&&g(a),m&&x(a))},M=Yn.Children.only(e);return Yn.cloneElement(M,{"data-mappable-id":a,onClickCapture:T?S:M.props.onClickCapture,onContextMenu:T?E:M.props.onContextMenu,className:`${M.props.className||""} ${T?"mappable-target":""}`.trim()})},z1=({masterIntensity:a,onMasterIntensityChange:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_intensity",targetType:"global",label:"MASTER",min:0,max:1,step:.01}))};return d.jsx("div",{className:"master-intensity-slider",draggable:!0,onDragStart:r,children:d.jsx($t,{id:"master_intensity",children:d.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,className:"slider_hor",id:"masterIntensityRange",onChange:i=>e(parseFloat(i.target.value))})})})},G1=({masterIntensity:a,onMasterIntensityChange:e,onClearAllActive:r,isGlobalBlackout:i,onToggleGlobalBlackout:o})=>{const c=(f,g)=>{f.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:g,targetType:"global",label:g.toUpperCase()}))};return d.jsxs("div",{className:"composition-controls",children:[d.jsx("span",{className:"layer-control-button",children:"Comp"}),d.jsx($t,{id:"comp_clear",children:d.jsx("span",{className:"layer-control-button",onClick:r,style:{cursor:"pointer"},draggable:!0,onDragStart:f=>c(f,"clear"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),d.jsx($t,{id:"comp_blackout",style:{width:"100%",display:"flex"},children:d.jsx("span",{className:"layer-control-button",onClick:o,style:{cursor:"pointer",backgroundColor:i?"red":""},draggable:!0,onDragStart:f=>c(f,"blackout"),children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),d.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),d.jsx(z1,{masterIntensity:a,onMasterIntensityChange:e})]})},H1=({name:a,index:e,onTrigger:r,onShowColumnHeaderContextMenu:i})=>{const o=f=>{f.preventDefault(),i&&i(e)},c=f=>{f.button===0&&r&&r()};return d.jsx($t,{id:`column_${e}`,children:d.jsx("div",{className:"column-header trigger-button",onClick:c,onContextMenu:o,style:{cursor:"pointer"},children:a})})},rl=[{id:"rotate",name:"Rotate",type:"transform",description:"Rotates the shape around its center.",defaultParams:{angle:0,speed:0,direction:"CW"},paramControls:[{id:"angle",label:"Angle",type:"range",min:0,max:360,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["CW","CCW"]}]},{id:"scale",name:"Scale",type:"transform",description:"Scales the shape.",defaultParams:{scaleX:1,scaleY:1},paramControls:[{id:"scaleX",label:"Scale X",type:"range",min:.01,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"range",min:.01,max:5,step:.01}]},{id:"translate",name:"Translate",type:"transform",description:"Moves the shape.",defaultParams:{translateX:0,translateY:0},paramControls:[{id:"translateX",label:"Translate X",type:"range",min:-1,max:1,step:.01},{id:"translateY",label:"Translate Y",type:"range",min:-1,max:1,step:.01}]},{id:"color",name:"Color",type:"color",description:"Changes the color of the shape with solid, rainbow or custom palette modes.",defaultParams:{mode:"solid",color:"#ffffff",r:255,g:255,b:255,cycleSpeed:0,rainbowSpread:1,rainbowOffset:0,rainbowPalette:"rainbow",paletteColors:["#ff0000","#00ff00","#0000ff","#ffff00"],paletteSize:4,paletteSpread:1,hue:0,saturation:0,brightness:1,enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["solid","rainbow","palette"]},{id:"color",label:"Color",type:"color",showIf:{mode:"solid"}},{id:"hue",label:"Hue",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"saturation",label:"Saturation",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"brightness",label:"Brightness",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"paletteSize",label:"Palette Size",type:"range",min:2,max:16,step:1,showIf:{mode:"palette"}},{id:"paletteSpread",label:"Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"palette"}},{id:"cycleSpeed",label:"Cycle Speed",type:"range",min:0,max:10,step:.1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowSpread",label:"Rainbow Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"rainbow"}},{id:"rainbowOffset",label:"Offset",type:"range",min:0,max:360,step:1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowPalette",label:"Preset",type:"select",options:["rainbow","fire","ice","cyber"],showIf:{mode:"rainbow"}}]},{id:"wave",name:"Wave",type:"animation",description:"Applies a wave distortion to the shape.",defaultParams:{amplitude:.1,frequency:10,speed:1,direction:"x"},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:.01,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["x","y"]}]},{id:"warp",name:"Warp",type:"animation",description:"Symmetrical chaotic wave distortion.",defaultParams:{amount:.1,chaos:.5,speed:1},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1}]},{id:"distortion",name:"Distortion",type:"transform",description:"Distorts the point data.",defaultParams:{amount:.1,scale:10,speed:.5},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"scale",label:"Scale",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:5,step:.1}]},{id:"move",name:"Move (Bounce)",type:"transform",description:"Moves points and bounces them off the borders.",defaultParams:{speedX:.1,speedY:.1},paramControls:[{id:"speedX",label:"Speed X",type:"range",min:0,max:2,step:.01},{id:"speedY",label:"Speed Y",type:"range",min:0,max:2,step:.01}]},{id:"delay",name:"Delay",type:"effect",description:"Frame or Channel based delay effect.",defaultParams:{mode:"frame",playstyle:"repeat",useCustomOrder:!1,delayDirection:"left_to_right",delayAmount:5,decay:.8,steps:10,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat"]},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"delayDirection",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}},{id:"steps",label:"Steps",type:"range",min:2,max:20,step:1,showIf:{mode:"frame"}},{id:"delayAmount",label:"Delay Time",type:"range",min:1,max:60,step:1},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01}]},{id:"chase",name:"Chase",type:"effect",description:"Frame or Channel based chase effect.",defaultParams:{mode:"frame",playstyle:"repeat",steps:4,decay:.8,speed:1,overlap:1,direction:"left_to_right",useCustomOrder:!1,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat","bounce"]},{id:"steps",label:"Steps",type:"range",min:2,max:16,step:1,showIf:{mode:"frame"}},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:5,step:.1},{id:"overlap",label:"Overlap",type:"range",min:1,max:4,step:1},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"direction",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}}]},{id:"blanking",name:"Blanking",type:"animation",description:"Controls the blanking of the laser output.",defaultParams:{blankingInterval:0,spacing:0},paramControls:[{id:"blankingInterval",label:"Blanking Interval",type:"range",min:0,max:10,step:1},{id:"spacing",label:"Spacing",type:"range",min:0,max:20,step:1}]},{id:"strobe",name:"Strobe",type:"animation",description:"Applies a strobe effect to the laser output.",defaultParams:{strobeSpeed:100,strobeAmount:.5},paramControls:[{id:"strobeSpeed",label:"Strobe Speed (ms)",type:"range",min:10,max:1e3,step:10},{id:"strobeAmount",label:"Strobe Amount (0-1)",type:"range",min:0,max:1,step:.01}]},{id:"mirror",name:"Mirror",type:"transform",description:"Mirrors the shape from the center.",defaultParams:{mode:"none",additive:!0},paramControls:[{id:"mode",label:"Mirror Mode",type:"select",options:["none","x+","x-","y+","y-"]},{id:"additive",label:"Additive",type:"checkbox"}]}],Y1=rl.reduce((a,e)=>(a[e.id]=e,a),{});function z0(a,e,r,i){const o=e.style||"loop",c=e.direction||"forward";if(c==="pause")return r;let f=a;o==="bounce"&&(f*=2);let g=0;if(o==="once")g=Math.min(f,1),c==="backward"&&(g=1-g);else if(o==="bounce"){let m=f%1;Math.floor(f)%2===1?g=1-m:g=m,c==="backward"&&(g=1-g)}else g=f%1,c==="backward"&&(g=1-g);return i&&Array.isArray(i)&&i.length===2?i[0]+(i[1]-i[0])*g:r}function Cc(a,e,r,i,o,c){if(!r)return e;const f=typeof r=="string"?{syncMode:r}:r;if(!f.syncMode)return e;const{time:g,progress:m=0,bpm:v=120,clipDuration:x=0,fftLevels:T={low:0,mid:0,high:0},activationTime:S=0}=i;let E=f.range;(!E||!Array.isArray(E)||E.length!==2)&&o!==void 0&&c!==void 0&&(E=[o,c]);let M=0;const D=f.speedMultiplier||1;if((f.style||"loop")==="once"&&S>0){const P=(g-S)*.001;let F=1;if(f.syncMode==="timeline")F=Math.max(.01,f.duration||1);else if(f.syncMode==="bpm"){const _=Math.max(.1,f.beats||4),L=v/60;F=_/(L||2)}else if(f.syncMode==="fps")return M=P*D,z0(M,f,e,E);M=P/F*D}else if(f.syncMode==="fps")M=g*.001*D;else if(f.syncMode==="timeline"){const P=Math.max(.01,f.duration||1);x>0?M=m*x/P*D:M=0}else if(f.syncMode==="bpm"){const P=Math.max(.1,f.beats||4),F=v/60,_=P/(F||2);x>0?M=m*x/_*D:M=0}else if(f.syncMode==="fft"){const P=T[f.fftRange||"low"]||0;return E?E[0]+(E[1]-E[0])*P:e}return z0(M,f,e,E)}let qf=new Float32Array(1024*8);function q1(a){qf.length<a*8&&(qf=new Float32Array(a*8*2))}function so(a,e,r={}){const{progress:i=0,time:o=performance.now(),effectStates:c,syncSettings:f={},fftLevels:g}=r;if(!e||e.length===0)return a;const m=a.points,v=a.isTypedArray||m instanceof Float32Array,x=v?m.length/8:m.length;q1(x);const T=qf.subarray(0,x*8);if(v)T.set(m);else for(let M=0;M<x;M++){const D=m[M],j=M*8;T[j]=D.x,T[j+1]=D.y,T[j+2]=D.z||0,T[j+3]=D.r,T[j+4]=D.g,T[j+5]=D.b,T[j+6]=D.blanking?1:0,T[j+7]=D.lastPoint?1:0}let S=T;for(const M of e){const D=M.params;if(D.enabled===!1||!Y1[M.id])continue;const P=S.length/8;let F=D;const _=M.instanceId?`${M.instanceId}.`:`${M.id}.`;let L=!1;for(const I in D)if(f[_+I]){L=!0;break}if(L){F={...D};for(const I in F){const V=_+I;f[V]&&(F[I]=Cc(I,F[I],f[V],r))}}switch(M.id){case"rotate":V1(S,P,F,i,o);break;case"scale":X1(S,P,F);break;case"translate":$1(S,P,F);break;case"color":Z1(S,P,F,o);break;case"wave":K1(S,P,F,o);break;case"blanking":J1(S,P,F);break;case"strobe":ev(S,P,F,o);break;case"mirror":S=tv(S,P,F);break;case"warp":nv(S,P,F,o);break;case"distortion":av(S,P,F,o);break;case"move":rv(S,P,F,o);break;case"delay":c&&M.instanceId&&(S=sv(S,P,F,c,M.instanceId,r));break;case"chase":S=iv(S,P,F,o,r);break}}const E=new Float32Array(S);return S._channelDistributions&&(E._channelDistributions=S._channelDistributions),{...a,points:E,isTypedArray:!0}}function V1(a,e,r,i,o){const{angle:c,speed:f,direction:g}=r,m=g==="CCW"?-1:1,v=o*.001*f*m,x=c*Math.PI/180+v,T=Math.sin(x),S=Math.cos(x);for(let E=0;E<e;E++){const M=E*8,D=a[M],j=a[M+1];a[M]=D*S-j*T,a[M+1]=D*T+j*S}}function X1(a,e,r){const{scaleX:i,scaleY:o}=r;for(let c=0;c<e;c++){const f=c*8;a[f]*=i,a[f+1]*=o}}function $1(a,e,r){const{translateX:i,translateY:o}=r;for(let c=0;c<e;c++){const f=c*8;a[f]+=i,a[f+1]+=o}}function G0(a){if(!a)return{r:255,g:255,b:255};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function W1(a,e,r){let i,o,c;const f=Math.floor(a*6),g=a*6-f,m=r*(1-e),v=r*(1-g*e),x=r*(1-(1-g)*e);switch(f%6){case 0:i=r,o=x,c=m;break;case 1:i=v,o=r,c=m;break;case 2:i=m,o=r,c=x;break;case 3:i=m,o=v,c=r;break;case 4:i=x,o=m,c=r;break;case 5:i=r,o=m,c=v;break}return[Math.round(i*255),Math.round(o*255),Math.round(c*255)]}function Z1(a,e,r,i){const{mode:o,r:c,g:f,b:g,color:m,hue:v,saturation:x,brightness:T,cycleSpeed:S,rainbowSpread:E,rainbowOffset:M,rainbowPalette:D,paletteColors:j=[],paletteSize:P=4,paletteSpread:F=1}=r,_=i*.001*S;if(o==="palette"){const L=Math.min(j.length,P),I=j.slice(0,L).map(G0);I.length===0&&I.push({r:255,g:255,b:255});for(let V=0;V<e;V++){const $=V*8,ie=(V/e*F+_*.5+M/360)%1*I.length,oe=Math.floor(ie)%I.length,U=(oe+1)%I.length,K=ie-Math.floor(ie),Z=I[oe],W=I[U];a[$+3]=Math.round(Z.r+(W.r-Z.r)*K),a[$+4]=Math.round(Z.g+(W.g-Z.g)*K),a[$+5]=Math.round(Z.b+(W.b-Z.b)*K)}}else if(o==="rainbow"){const L=D||"rainbow";for(let I=0;I<e;I++){const V=I*8,$=(I/e*E+_*.5+M/360)%1;let J,ie,oe;L==="rainbow"?[J,ie,oe]=H0($,1,.5):[J,ie,oe]=Q1(L,$),a[V+3]=J,a[V+4]=ie,a[V+5]=oe}}else{let L=c,I=f,V=g;if(v!==void 0&&x!==void 0&&T!==void 0)[L,I,V]=W1(v,x,T);else if(m){const $=G0(m);L=$.r,I=$.g,V=$.b}if(S>0){const $=_*50%360,[J,ie,oe]=H0($/360,1,.5);for(let U=0;U<e;U++){const K=U*8;a[K+3]=J,a[K+4]=ie,a[K+5]=oe}}else for(let $=0;$<e;$++){const J=$*8;a[J+3]=L,a[J+4]=I,a[J+5]=V}}}function Q1(a,e){const r={fire:[{r:255,g:0,b:0},{r:255,g:128,b:0},{r:255,g:255,b:0},{r:255,g:0,b:0}],ice:[{r:0,g:0,b:255},{r:0,g:255,b:255},{r:255,g:255,b:255},{r:0,g:0,b:255}],cyber:[{r:255,g:0,b:255},{r:0,g:255,b:255},{r:0,g:0,b:255},{r:255,g:0,b:255}]},i=r[a]||r.fire,o=e*(i.length-1),c=Math.floor(o),f=o-c,g=i[c],m=i[c+1]||i[c];return[Math.round(g.r+(m.r-g.r)*f),Math.round(g.g+(m.g-g.g)*f),Math.round(g.b+(m.b-g.b)*f)]}function H0(a,e,r){let i,o,c;{const f=(v,x,T)=>(T<0&&(T+=1),T>1&&(T-=1),T<.16666666666666666?v+(x-v)*6*T:T<.5?x:T<.6666666666666666?v+(x-v)*(.6666666666666666-T)*6:v),g=r+e-r*e,m=2*r-g;i=f(m,g,a+1/3),o=f(m,g,a),c=f(m,g,a-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(c*255)]}function K1(a,e,r,i){const{amplitude:o,frequency:c,speed:f,direction:g}=r,m=i*.001*f;for(let v=0;v<e;v++){const x=v*8;g==="x"?a[x+1]+=o*Math.sin(a[x]*c+m):g==="y"&&(a[x]+=o*Math.sin(a[x+1]*c+m))}}function J1(a,e,r){const{blankingInterval:i,spacing:o=0}=r;if(i<=0)return;const c=i+1+o;for(let f=0;f<e;f++)f%c>=i&&(a[f*8+6]=1)}function ev(a,e,r,i){const{strobeSpeed:o,strobeAmount:c}=r;if(i%o/o<c)for(let g=0;g<e;g++)a[g*8+6]=1}function tv(a,e,r){const{mode:i,additive:o=!0}=r;if(i==="none"||e===0)return a;let c;const f=a._channelDistributions,g=(m,v,x)=>o?!0:x==="x+"?m>=0:x==="x-"?m<=0:x==="y+"?v>=0:x==="y-"?v<=0:!0;if(f){c=new Float32Array((e*2+f.size*2+50)*8);const m=new Map;let v=0;for(const[T,S]of f){const E=S.length/8,M=S.start,D=v;let j=0,P=!0;for(let F=0;F<E;F++){const _=M+F*8,L=g(a[_],a[_+1],i);L&&(!P&&j>0&&(c.set(a.subarray(_,_+8),v),c[v+6]=1,c[v+3]=0,c[v+4]=0,c[v+5]=0,v+=8,j++),c.set(a.subarray(_,_+8),v),v+=8,j++),P=L}if(j>0){const F=v-8;c.set(c.subarray(F,F+8),v),c[v+6]=1,c[v+3]=0,c[v+4]=0,c[v+5]=0,v+=8;let _=!0,L=0;for(let I=E-1;I>=0;I--){const V=M+I*8,$=g(a[V],a[V+1],i);if($){!_&&L>0&&(c.set(a.subarray(V,V+8),v),i==="x-"||i==="x+"?c[v]=-c[v]:(i==="y-"||i==="y+")&&(c[v+1]=-c[v+1]),c[v+6]=1,c[v+3]=0,c[v+4]=0,c[v+5]=0,v+=8),c.set(a.subarray(V,V+8),v);const J=v;i==="x-"||i==="x+"?c[J]=-c[J]:(i==="y-"||i==="y+")&&(c[J+1]=-c[J+1]),v+=8,L++}_=$}m.set(T,{start:D,length:v-D})}}const x=new Float32Array(v);return x.set(c.subarray(0,v)),x._channelDistributions=m,x}else{c=new Float32Array((e*2+50)*8);let m=0,v=0,x=!0;for(let T=0;T<e;T++){const S=T*8,E=g(a[S],a[S+1],i);E&&(!x&&v>0&&(c.set(a.subarray(S,S+8),m),c[m+6]=1,c[m+3]=0,c[m+4]=0,c[m+5]=0,m+=8,v++),c.set(a.subarray(S,S+8),m),m+=8,v++),x=E}if(v>0){const T=m-8;c.set(c.subarray(T,T+8),m),c[m+6]=1,c[m+3]=0,c[m+4]=0,c[m+5]=0,m+=8;let S=!0,E=0;for(let M=e-1;M>=0;M--){const D=M*8,j=g(a[D],a[D+1],i);if(j){!S&&E>0&&(c.set(a.subarray(D,D+8),m),i==="x-"||i==="x+"?c[m]=-c[m]:(i==="y-"||i==="y+")&&(c[m+1]=-c[m+1]),c[m+6]=1,c[m+3]=0,c[m+4]=0,c[m+5]=0,m+=8),c.set(a.subarray(D,D+8),m);const P=m;i==="x-"||i==="x+"?c[P]=-c[P]:(i==="y-"||i==="y+")&&(c[P+1]=-c[P+1]),m+=8,E++}S=j}}return c.slice(0,m)}}function nv(a,e,r,i){const{amount:o,chaos:c,speed:f}=r,g=i*.001*f;for(let m=0;m<e;m++){const v=m*8,x=a[v],T=a[v+1],S=Math.abs(T);a[v]+=Math.sin(S*10*(1+c)+g)*o*Math.cos(g*c),a[v+1]+=Math.cos(Math.abs(x)*10*(1+c)+g)*o*Math.sin(g*c)}}function av(a,e,r,i){const{amount:o,scale:c,speed:f}=r,g=i*.001*f;for(let m=0;m<e;m++){const v=m*8,x=Math.sin(a[v]*c+g)*Math.cos(a[v+1]*c-g),T=Math.cos(a[v]*c-g)*Math.sin(a[v+1]*c+g);a[v]+=x*o,a[v+1]+=T*o}}function rv(a,e,r,i){const{speedX:o,speedY:c}=r,f=i*.001,g=f*o,m=f*c,v=4;for(let x=0;x<e;x++){const T=x*8;let S=a[T]+g,E=a[T+1]+m,M=(S+1)%v;M<0&&(M+=v),M>2&&(M=4-M),S=M-1;let D=(E+1)%v;D<0&&(D+=v),D>2&&(D=4-D),E=D-1,a[T]=S,a[T+1]=E}}function sv(a,e,r,i,o,c){const{mode:f="frame",delayAmount:g,decay:m,delayDirection:v,useCustomOrder:x,customOrder:T,playstyle:S="repeat",steps:E=10}=r;i.has(o)||i.set(o,[]);const M=i.get(o);if(M.unshift(new Float32Array(a)),f==="frame"){const D=g*E+1;M.length>D&&(M.length=D);const j=new Float32Array(a.length);for(let P=0;P<e;P++){let F=0;const _=P/e;v==="left_to_right"?F=Math.floor(_*(E-1)):v==="right_to_left"?F=Math.floor((1-_)*(E-1)):v==="center_to_out"?F=Math.floor(Math.abs(_-.5)*2*(E-1)):v==="out_to_center"&&(F=Math.floor((1-Math.abs(_-.5)*2)*(E-1)));const L=F*g,I=L<M.length?M[L]:null,V=Math.pow(m,F),$=P*8;if(I&&I.length>0){let J;if(I.length===a.length)J=$;else{const ie=I.length/8;let oe=Math.floor(_*ie);oe>=ie&&(oe=ie-1),J=oe*8}if(j[$]=I[J],j[$+1]=I[J+1],j[$+2]=I[J+2],j[$+3]=I[J+3]*V,j[$+4]=I[J+4]*V,j[$+5]=I[J+5]*V,j[$+6]=I[J+6],j[$+7]=I[J+7],P<e-1){const ie=(P+1)/e;let oe=0;v==="left_to_right"?oe=Math.floor(ie*(E-1)):v==="right_to_left"?oe=Math.floor((1-ie)*(E-1)):v==="center_to_out"?oe=Math.floor(Math.abs(ie-.5)*2*(E-1)):v==="out_to_center"&&(oe=Math.floor((1-Math.abs(ie-.5)*2)*(E-1))),oe!==F&&(j[$+6]=1)}}else j.set(a.subarray($,$+8),$),j[$+3]=0,j[$+4]=0,j[$+5]=0,j[$+6]=1}return a._channelDistributions&&(j._channelDistributions=a._channelDistributions),j}else{const{assignedDacs:D}=c||{};let j=new Map,P=0;if(x||r.delayMode==="channel")(T&&T.length>0?T.map(K=>K.originalIndex):D?D.map((K,Z)=>Z):[0]).forEach((K,Z)=>{j.set(K,Z),P=Math.max(P,Z)});else{const K=(D||[]).length||1;for(let Z=0;Z<K;Z++){let W=Z;v==="right_to_left"?W=K-1-Z:v==="center_to_out"?W=Math.floor(Math.abs(Z-(K-1)/2)):v==="out_to_center"&&(W=Math.min(Z,K-1-Z)),j.set(Z,W),P=Math.max(P,W)}}const _=P+1,L=g*_+1;M.length>L&&(M.length=L);const I=[];for(let U=0;U<_;U++){const K=U*g;I.push({points:K<M.length?M[K]:null,factor:Math.pow(m,U),index:U})}const V=I.reduce((U,K)=>U+(K.points?K.points.length/8:a.length/8),0),$=new Float32Array(V*8);let J=0;const ie=new Array(I.length);for(let U=0;U<I.length;U++){const K=I[U],Z=K.points,W=Z?Z.length/8:a.length/8;ie[U]=J;for(let re=0;re<W;re++){const Y=re*8,ee=J+re*8;Z?($[ee]=Z[Y],$[ee+1]=Z[Y+1],$[ee+2]=Z[Y+2],$[ee+3]=Z[Y+3]*K.factor,$[ee+4]=Z[Y+4]*K.factor,$[ee+5]=Z[Y+5]*K.factor,$[ee+6]=Z[Y+6],$[ee+7]=Z[Y+7]):$[ee+6]=1}J+=W*8}const oe=new Map;return j.forEach((U,K)=>{U<I.length&&oe.set(K,{start:ie[U],length:I[U].points?I[U].points.length:a.length})}),$._channelDistributions=oe,$}}function iv(a,e,r,i,o={}){const{mode:c="frame",steps:f,decay:g,speed:m,overlap:v,direction:x,useCustomOrder:T,customOrder:S,playstyle:E="loop"}=r,{progress:M=0,clipDuration:D=1,syncSettings:j={}}=o,P=r.instanceId?`${r.instanceId}.`:"chase.",F=!!j[P+"speed"],_=M!==void 0&&D>0||F;if(c==="frame"){const L=f;let I=(_?M*L:i*.001)*m;if(E==="bounce"){const $=L,J=I%($*2);I=J>$?$*2-J:J}else E==="once"?I=Math.min(I,L):I=I%L;const V=new Float32Array(a.length);for(let $=0;$<e;$++){const J=$/e;let ie=0;x==="left_to_right"?ie=Math.min(L-1,Math.floor(J*L)):x==="right_to_left"?ie=Math.min(L-1,Math.floor((1-J)*L)):x==="center_to_out"?ie=Math.min(L-1,Math.floor(Math.abs(J-.5)*2*L)):x==="out_to_center"&&(ie=Math.min(L-1,Math.floor((1-Math.abs(J-.5)*2)*L)));let oe=Math.abs(I-ie);oe>L/2&&(oe=L-oe);let U=oe<v?1-oe/v:0;g>0&&(U=Math.pow(U,1-g));const K=$*8;if(V.set(a.subarray(K,K+8),K),V[K+3]*=U,V[K+4]*=U,V[K+5]*=U,U<.05&&(V[K+6]=1),$<e-1){const Z=($+1)/e;let W=0;x==="left_to_right"?W=Math.min(L-1,Math.floor(Z*L)):x==="right_to_left"?W=Math.min(L-1,Math.floor((1-Z)*L)):x==="center_to_out"?W=Math.min(L-1,Math.floor(Math.abs(Z-.5)*2*L)):x==="out_to_center"&&(W=Math.min(L-1,Math.floor((1-Math.abs(Z-.5)*2)*L))),W!==ie&&(V[K+6]=1)}}return a._channelDistributions&&(V._channelDistributions=a._channelDistributions),V}else{const{assignedDacs:L}=o||{};let I=new Map,V=0;if(T)(S&&S.length>0?S.map(re=>re.originalIndex):L?L.map((re,Y)=>Y):[0]).forEach((re,Y)=>{I.set(re,Y),V++});else{V=(L?L.length:1)||1;for(let W=0;W<V;W++){let re=W;x==="right_to_left"?re=V-1-W:x==="center_to_out"?re=Math.floor(Math.abs(W-(V-1)/2)):x==="out_to_center"&&(re=Math.min(W,V-1-W)),I.set(W,re)}}const $=V;let J=(_?M*$:i*.001)*m;if(E==="bounce"){const W=$,re=J%(W*2);J=re>W?W*2-re:re}else E==="once"?J=Math.min(J,$):J=J%$;const ie=e*V,oe=new Float32Array(ie*8),U=new Map;let K=0;const Z=Array.from(I.keys());Z.length===0&&Z.push(0);for(const W of Z){const re=I.get(W)||0;let Y=Math.abs(J-re);Y>$/2&&(Y=$-Y);let ee=Y<v?1-Y/v:0;g>0&&(ee=Math.pow(ee,1-g));const ue=K;for(let Ee=0;Ee<e;Ee++){const q=Ee*8,Q=K+Ee*8;oe.set(a.subarray(q,q+8),Q),oe[Q+3]*=ee,oe[Q+4]*=ee,oe[Q+5]*=ee,ee<.05&&(oe[Q+6]=1)}U.set(W,{start:ue,length:e*8}),K+=e*8}return oe._channelDistributions=U,oe}}function Vf(a,e,r=!1){if(!e||!a||!a.points)return a;const{safetyZones:i,outputArea:o,transformationEnabled:c,transformationMode:f,flipX:g,flipY:m}=e;let v=a.points;const x=a.isTypedArray||v instanceof Float32Array,T=x?v.length/8:v.length;let S=r?v:x?new Float32Array(v):v.map(E=>({...E}));for(let E=0;E<T;E++){let M,D,j,P,F,_;if(x?(M=S[E*8],D=S[E*8+1],j=S[E*8+3],P=S[E*8+4],F=S[E*8+5],_=S[E*8+6]):(M=S[E].x,D=S[E].y,j=S[E].r,P=S[E].g,F=S[E].b,_=S[E].blanking?1:0),c&&o){let L=(M+1)/2,I=(1-D)/2;f==="crop"?(L<o.x||L>o.x+o.w||I<o.y||I>o.y+o.h)&&(j=0,P=0,F=0,_=1):f==="scale"&&(L=o.x+L*o.w,I=o.y+I*o.h,M=L*2-1,D=1-I*2)}if(i&&i.length>0){let L=(M+1)/2,I=(1-D)/2;for(const V of i)if(L>=V.x&&L<=V.x+V.w&&I>=V.y&&I<=V.y+V.h){j=0,P=0,F=0,_=1;break}}g&&(M=-M),m&&(D=-D),M=Math.max(-1,Math.min(1,M)),D=Math.max(-1,Math.min(1,D)),x?(S[E*8]=M,S[E*8+1]=D,S[E*8+3]=j,S[E*8+4]=P,S[E*8+5]=F,S[E*8+6]=_):(S[E].x=M,S[E].y=D,S[E].r=j,S[E].g=P,S[E].b=F,S[E].blanking=_>.5)}return{...a,points:S,isTypedArray:x}}const gc=.08,lv=4,ov=1.5;function ld(a){if(!a)return new Float32Array(0);const e=a instanceof Float32Array||a.isTypedArray,r=e?a.length/8:a.length;if(r>4e3){if(a instanceof Float32Array)return a;const j=new Float32Array(r*8);for(let P=0;P<r;P++){const F=a[P];j[P*8]=F.x,j[P*8+1]=F.y,j[P*8+2]=F.z||0,j[P*8+3]=F.r,j[P*8+4]=F.g,j[P*8+5]=F.b,j[P*8+6]=F.blanking?1:0,j[P*8+7]=F.lastPoint?1:0}return j}const i=[],o=(j,P,F,_,L,I,V)=>{const $=V?0:_,J=V?0:L,ie=V?0:I;i.push(j,P,F,$,J,ie,V?1:0,0)},c=j=>{if(e){const P=j*8;return{x:a[P],y:a[P+1],z:a[P+2],r:a[P+3],g:a[P+4],b:a[P+5],blanking:a[P+6]>.5}}else{const P=a[j];return{x:P.x||0,y:P.y||0,z:P.z||0,r:P.r||0,g:P.g||0,b:P.b||0,blanking:!!P.blanking}}};if(r===0)return new Float32Array(0);let f=null;for(let j=0;j<r;j++){const P=c(j);if(!P.blanking){f=P;break}}let g=c(0);for(let j=0;j<r;j++){const P=c(j);P.x-g.x,P.y-g.y,o(P.x,P.y,P.z,P.r,P.g,P.b,P.blanking),g=P}const m=c(0),v=f||m,x=v.x-g.x,T=v.y-g.y,S=Math.sqrt(x*x+T*T),E=S<.1&&!v.blanking&&!g.blanking,M=!E&&(m.blanking||g.blanking||S>ov);if(E){if(S>gc){const j=Math.floor(S/gc);for(let P=1;P<j;P++){const F=P/j;o(g.x+x*F,g.y+T*F,g.z+(v.z-g.z)*F,g.r+(v.r-g.r)*F,g.g+(v.g-g.g)*F,g.b+(v.b-g.b)*F,!1)}}o(v.x,v.y,v.z,v.r,v.g,v.b,!1)}else if(M&&S>.01){o(g.x,g.y,g.z,0,0,0,!0),o(g.x,g.y,g.z,0,0,0,!0);const j=m.x-g.x,P=m.y-g.y,F=Math.sqrt(j*j+P*P);if(F>gc){const _=Math.floor(F/gc);for(let L=1;L<_;L++){const I=L/_;o(g.x+j*I,g.y+P*I,g.z+(m.z-g.z)*I,0,0,0,!0)}}for(let _=0;_<lv;_++)o(m.x,m.y,m.z,0,0,0,!0)}const D=new Float32Array(i);return a._channelDistributions&&(D._channelDistributions=a._channelDistributions),D}class cv{constructor(e,r){if(this.canvas=e,this.type=r,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.animationFrameId=null,this.frameIndexes=Array(10).fill(0),this.pointIndexes=Array(10).fill(0),this.showBeamEffect=!1,this.beamAlpha=.5,this.fadeAlpha=.13,this.beamRenderMode="both",this.positionBuffer=null,this.colorBuffer=null,this.alphaBuffer=null,this.alphaBufferData=new Float32Array(131072),this.lastPointDrawTime=0,!this.gl){console.error("WebGL not supported");return}this.setup()}setup(){const e=this.gl,r=`
      attribute vec2 aPosition;
      attribute vec3 aColor;
      attribute float aAlpha;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        gl_PointSize = 2.0;
        vColor = aColor;
        vAlpha = aAlpha;
      }
    `,i=`
      precision mediump float;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_FragColor = vec4(vColor, vAlpha);
      }
    `,o=this.createShader(e.VERTEX_SHADER,r),c=this.createShader(e.FRAGMENT_SHADER,i),f=this.createProgram(o,c);this.program=f,this.positionAttributeLocation=e.getAttribLocation(f,"aPosition"),this.colorAttributeLocation=e.getAttribLocation(f,"aColor"),this.alphaAttributeLocation=e.getAttribLocation(f,"aAlpha"),this.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer);const g=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(g),e.STATIC_DRAW),this.quadColorUniformLocation=e.getUniformLocation(f,"uColor"),this.quadAlphaUniformLocation=e.getUniformLocation(f,"uAlpha");const m=`
      attribute vec2 aPosition;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `,v=`
      precision mediump float;
      uniform vec4 uColor;
      void main() {
        gl_FragColor = uColor;
      }
    `,x=this.createShader(e.VERTEX_SHADER,m),T=this.createShader(e.FRAGMENT_SHADER,v);this.fadeProgram=this.createProgram(x,T),this.fadePositionAttributeLocation=e.getAttribLocation(this.fadeProgram,"aPosition"),this.fadeColorUniformLocation=e.getUniformLocation(this.fadeProgram,"uColor"),e.useProgram(f);const S=131072;this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,S*2*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,S*3*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.alphaBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.alphaBuffer),e.bufferData(e.ARRAY_BUFFER,S*1*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1)}reset(){this.frameIndexes.fill(0),this.pointIndexes.fill(0),this.clearCanvas()}createShader(e,r){const i=this.gl,o=i.createShader(e);if(i.shaderSource(o,r),i.compileShader(o),i.getShaderParameter(o,i.COMPILE_STATUS))return o;console.error(i.getShaderInfoLog(o)),i.deleteShader(o)}createProgram(e,r){const i=this.gl,o=i.createProgram();if(i.attachShader(o,e),i.attachShader(o,r),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS))return o;console.error(i.getProgramInfoLog(o)),i.deleteProgram(o)}render(e){e.showBeamEffect!==void 0&&this.setBeamEffect(e.showBeamEffect),e.beamAlpha!==void 0&&this.setBeamAlpha(e.beamAlpha),e.fadeAlpha!==void 0&&this.setFadeAlpha(e.fadeAlpha),e.beamRenderMode!==void 0&&(this.beamRenderMode=e.beamRenderMode),this.type==="world"?this.renderWorld(e.worldData,e.previewScanRate,e.layerIntensities,e.masterIntensity,e.dacSettings,e.previewTime,e.fftLevels,e.optimizationEnabled):this.renderSingle(e.ildaFrames,e.previewScanRate,e.intensity,e.effects,e.syncSettings,e.bpm,e.clipDuration,e.progress,e.previewTime,e.fftLevels,e.effectStates,e.optimizationEnabled)}renderSingle(e,r,i,o,c={},f=120,g=1,m=null,v=null,x={low:0,mid:0,high:0},T=null,S=!0){const E=this.gl;if(E.viewport(0,0,E.canvas.width,E.canvas.height),this.drawFadeQuad(),!e||e.length===0)return;const M=this.frameIndexes[0]%e.length,D=e[M],j=m!==null?m:M/e.length,P=v!==null?v:performance.now();this.draw(D,o,this.showBeamEffect,this.beamAlpha,r,this.beamRenderMode,i,0,j,P,c,f,g,x,T,S),this.frameIndexes[0]++,this.frameIndexes[0]>=e.length&&(this.frameIndexes[0]=0)}renderWorld(e,r,i,o,c,f=null,g={low:0,mid:0,high:0},m=!0){const v=this.gl;v.viewport(0,0,v.canvas.width,v.canvas.height),this.drawFadeQuad();const x=f!==null?f:performance.now();e.forEach(T=>{if(T&&T.frames&&T.frames.length>0){const S=T.frames[0];if(S){const E=T.layerIndex||0;if(T.syncSettings,T.bpm,E>=this.frameIndexes.length){const j=E+5;for(;this.frameIndexes.length<j;)this.frameIndexes.push(0),this.pointIndexes.push(0)}const D=(i[E]!==void 0?i[E]:1)*o;if(D>.001){const j=T.progress!==void 0?T.progress:this.frameIndexes[E]%T.frames.length/T.frames.length,{syncSettings:P={},bpm:F=120,clipDuration:_=1,effectStates:L=null}=T;let I=S;if(c){let V=S;if(c.dimmer!==void 0&&c.dimmer<1){const $=S.points,J=S.isTypedArray||$ instanceof Float32Array,ie=J?$.length/8:$.length,oe=J?new Float32Array($):$.map(U=>({...U}));for(let U=0;U<ie;U++)J?(oe[U*8+3]*=c.dimmer,oe[U*8+4]*=c.dimmer,oe[U*8+5]*=c.dimmer):(oe[U].r*=c.dimmer,oe[U].g*=c.dimmer,oe[U].b*=c.dimmer);V={...S,points:oe,isTypedArray:t}}I=Vf(V,c)}this.draw(I,T.effects,this.showBeamEffect,this.beamAlpha,r,this.beamRenderMode,D,E,j,x,P,F,_,g,L,m)}}}}),e.forEach(T=>{if(T&&T.frames){const S=T.layerIndex||0;this.frameIndexes[S]++,this.frameIndexes[S]>=T.frames.length&&(this.frameIndexes[S]=0)}})}drawFadeQuad(){const e=this.gl;this.fadeProgram&&(e.useProgram(this.fadeProgram),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer),e.enableVertexAttribArray(this.fadePositionAttributeLocation),e.vertexAttribPointer(this.fadePositionAttributeLocation,2,e.FLOAT,!1,0,0),e.uniform4f(this.fadeColorUniformLocation,0,0,0,this.fadeAlpha),e.drawArrays(e.TRIANGLES,0,6))}setBeamEffect(e){this.showBeamEffect=e}setBeamAlpha(e){this.beamAlpha=e}setFadeAlpha(e){this.fadeAlpha=e}draw(e,r,i,o,c,f,g=1,m=0,v=0,x=performance.now(),T={},S=120,E=1,M={low:0,mid:0,high:0},D=null,j=!0){if(this.gl,!e||!e.points)return;let P=e;if(j){const K=ld(e.points);P={...e,points:K,isTypedArray:!0}}const F=so(P,r,{progress:v,time:x,syncSettings:T,bpm:S,clipDuration:E,fftLevels:M,effectStates:D}),_=F.points,L=F.isTypedArray,I=L?_.length/8:_.length;if(I===0)return;const V=Math.max(1,Math.floor(I/c));let $=this.pointIndexes[m]||0;$>=I&&($=0);const J=K=>{const Z=($+K)%I;if(L){const W=Z*8;return{x:_[W],y:_[W+1],r:_[W+3],g:_[W+4],b:_[W+5],blanking:_[W+6]===1}}else{const W=_[Z];return{x:W.x,y:W.y,r:W.r,g:W.g,b:W.b,blanking:W.blanking}}},ie=()=>{const K=f==="points"||f==="both";if(f==="lines"||f==="both"){let W=[],re=[],Y=J(0);for(let ee=1;ee<V;ee++){const ue=J(ee);ue.blanking?W.length>0&&(this._drawSegment(new Float32Array(W),new Float32Array(re),1,W.length/2,!1),W=[],re=[]):(W.length===0&&(W.push(Y.x,Y.y),re.push(ue.r/255*g,ue.g/255*g,ue.b/255*g)),W.push(ue.x,ue.y),re.push(ue.r/255*g,ue.g/255*g,ue.b/255*g)),Y=ue}W.length>0&&this._drawSegment(new Float32Array(W),new Float32Array(re),1,W.length/2,!1)}if(K){const W=[],re=[];for(let Y=0;Y<V;Y++){const ee=J(Y);ee.blanking||(W.push(ee.x,ee.y),re.push(ee.r/255*g,ee.g/255*g,ee.b/255*g))}W.length>0&&this._drawSegment(new Float32Array(W),new Float32Array(re),1,W.length/2,!0)}},oe=()=>{const K=[],Z=[];for(let W=0;W<V;W++){const re=J(W);if(!re.blanking){K.push(0,0,re.x,re.y);const Y=[re.r/255*g,re.g/255*g,re.b/255*g];Z.push(...Y,...Y)}}K.length>0&&this._drawLines(new Float32Array(K),new Float32Array(Z),o,K.length/2)},U=()=>{const K=[],Z=[];let W=J(0);for(let re=1;re<V;re++){const Y=J(re);if(!Y.blanking){K.push(0,0,W.x,W.y,Y.x,Y.y);const ee=[Y.r/255*g,Y.g/255*g,Y.b/255*g],ue=[Y.r/255*g,Y.g/255*g,Y.b/255*g],Ee=[ee[0],ee[1],ee[2]],q=.3,Q=[ee[0]*q,ee[1]*q,ee[2]*q],be=[ue[0]*q,ue[1]*q,ue[2]*q];Z.push(...Ee,...Q,...be)}W=Y}K.length>0&&this._drawTriangles(new Float32Array(K),new Float32Array(Z),o,K.length/2)};ie(),i&&(f==="points"?oe():f==="lines"?U():f==="both"&&(U(),oe())),this.pointIndexes[m]=($+V)%I}_drawSegment(e,r,i,o,c=!1){const f=this.gl;f.useProgram(this.program),f.bindBuffer(f.ARRAY_BUFFER,this.positionBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,e),f.enableVertexAttribArray(this.positionAttributeLocation),f.vertexAttribPointer(this.positionAttributeLocation,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,r),f.enableVertexAttribArray(this.colorAttributeLocation),f.vertexAttribPointer(this.colorAttributeLocation,3,f.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const g=this.alphaBufferData.subarray(0,o);f.bindBuffer(f.ARRAY_BUFFER,this.alphaBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,g),f.enableVertexAttribArray(this.alphaAttributeLocation),f.vertexAttribPointer(this.alphaAttributeLocation,1,f.FLOAT,!1,0,0),f.drawArrays(c?f.POINTS:f.LINE_STRIP,0,o)}_drawLines(e,r,i,o){const c=this.gl;c.useProgram(this.program),c.bindBuffer(c.ARRAY_BUFFER,this.positionBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,e),c.enableVertexAttribArray(this.positionAttributeLocation),c.vertexAttribPointer(this.positionAttributeLocation,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,r),c.enableVertexAttribArray(this.colorAttributeLocation),c.vertexAttribPointer(this.colorAttributeLocation,3,c.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const f=this.alphaBufferData.subarray(0,o);c.bindBuffer(c.ARRAY_BUFFER,this.alphaBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,f),c.enableVertexAttribArray(this.alphaAttributeLocation),c.vertexAttribPointer(this.alphaAttributeLocation,1,c.FLOAT,!1,0,0),c.drawArrays(c.LINES,0,o)}_drawTriangles(e,r,i,o){const c=this.gl;c.useProgram(this.program),c.bindBuffer(c.ARRAY_BUFFER,this.positionBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,e),c.enableVertexAttribArray(this.positionAttributeLocation),c.vertexAttribPointer(this.positionAttributeLocation,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,r),c.enableVertexAttribArray(this.colorAttributeLocation),c.vertexAttribPointer(this.colorAttributeLocation,3,c.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const f=this.alphaBufferData.subarray(0,o);c.bindBuffer(c.ARRAY_BUFFER,this.alphaBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,f),c.enableVertexAttribArray(this.alphaAttributeLocation),c.vertexAttribPointer(this.alphaAttributeLocation,1,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,o)}clearCanvas(){const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}destroy(){if(cancelAnimationFrame(this.animationFrameId),this.gl){const e=this.gl.getExtension("WEBGL_losing_context");e&&e.loseContext()}}}const qm=({frame:a,effects:e,width:r=100,height:i=100})=>{const o=R.useRef(null),c=R.useRef(null),[f,g]=R.useState(null);return R.useEffect(()=>(o.current&&!c.current&&(c.current=new cv(o.current,"single")),()=>{c.current&&(c.current.destroy(),c.current=null)}),[]),R.useEffect(()=>{if(!a){g(null);return}let m=a;if(e&&e.length>0){const v=a.points,x=a.isTypedArray||v instanceof Float32Array;let T;x?T=new Float32Array(v):T=v.map(E=>({...E}));const S={...a,points:T,isTypedArray:x};m=so(S,e,{time:performance.now(),progress:0,effectStates:new Map})}g(m)},[a,e]),R.useEffect(()=>{c.current&&f?c.current.render({ildaFrames:[f],previewScanRate:1,intensity:1,effects:[],syncSettings:{}}):c.current&&c.current.clearCanvas()},[f]),d.jsx("div",{className:"clip-thumbnail",style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"black"},children:d.jsx("canvas",{ref:o,width:r,height:i,style:{width:"100%",height:"100%",backgroundColor:"black"}})})},uv=({frame:a,bitmap:e,width:r=50,height:i=50})=>{const o=R.useRef(null);return R.useEffect(()=>{const c=o.current;if(!c)return;const f=c.getContext("2d");if(e){f.clearRect(0,0,r,i),f.drawImage(e,0,0,r,i);return}if(!a||!a.points)return;f.fillStyle="#000000",f.fillRect(0,0,r,i);const g=a.points,m=a.isTypedArray||g instanceof Float32Array,v=m?g.length/8:g.length;f.lineWidth=1.5,f.lineCap="round";let x=null,T=null;for(let S=0;S<v;S++){let E,M,D,j,P,F;if(m)E=g[S*8],M=g[S*8+1],D=g[S*8+3],j=g[S*8+4],P=g[S*8+5],F=g[S*8+6]>.5;else{const I=g[S];E=I.x,M=I.y,D=I.r,j=I.g,P=I.b,F=I.blanking}const _=(E+1)*.5*r,L=(1-(M+1)*.5)*i;if(F){x=null,T=null;continue}else if(x!==null){f.beginPath(),f.moveTo(x,T),f.lineTo(_,L);const I=Math.floor(Math.max(0,Math.min(255,D))),V=Math.floor(Math.max(0,Math.min(255,j))),$=Math.floor(Math.max(0,Math.min(255,P)));f.strokeStyle=`rgb(${I},${V},${$})`,f.stroke()}x=_,T=L}},[a,r,i]),d.jsx("canvas",{ref:o,width:r,height:i,style:{width:"50px",height:"50px",backgroundColor:"black",display:"block",borderRadius:"5px"}})},od=Yn.memo(uv),fv=({layerName:a,index:e,onDropEffect:r,onDropDac:i,layerEffects:o,activeClipData:c,onDeactivateLayerClips:f,onShowLayerFullContextMenu:g,thumbnailRenderMode:m,intensity:v,onIntensityChange:x,liveFrame:T,isBlackout:S,isSolo:E,onToggleBlackout:M,onToggleSolo:D,onLayerSelect:j})=>{const[P,F]=R.useState(o||[]),[_,L]=R.useState(!1),[I,V]=R.useState(!1);R.useEffect(()=>{F(o||[])},[o]);const $=R.useMemo(()=>[...c?.effects||[],...o||[]],[c?.effects,o]),J=(W,re,Y,ee,ue)=>{W.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:re,paramName:Y,targetType:ee,layerIndex:e,label:ue}))},ie=W=>{W.preventDefault(),console.log(`Right-clicked LayerControls at index: ${e}`),g&&g(e)},oe=W=>{W.preventDefault(),W.stopPropagation(),L(!0),W.dataTransfer.dropEffect="copy"},U=W=>{W.preventDefault(),W.stopPropagation(),L(!1)},K=W=>{W.preventDefault(),W.stopPropagation(),L(!1);const re=W.dataTransfer.getData("application/json");if(re)try{const ee=JSON.parse(re);if(ee.type==="transform"||ee.type==="animation"||ee.type==="color"||ee.type==="effect"){if(r){r(ee.id||ee.name);return}}else if(ee.ip&&(typeof ee.channel=="number"||ee.allChannels)&&i){i(e,ee);return}}catch(ee){console.error("Error parsing drop data in LayerControls:",ee)}const Y=W.dataTransfer.getData("text/plain");if(Y.startsWith("effect_")){const ee=Y.replace("effect_","");r&&r(ee)}},Z=m==="active"||m==="hover"&&I;return d.jsxs("div",{className:`layer-controls ${_?"dragging":""}`,onContextMenu:ie,onDragOver:oe,onDragLeave:U,onDrop:K,children:[d.jsxs("div",{className:"grid-layer",children:[d.jsx($t,{id:`layer_${e}_clear`,children:d.jsx("span",{className:"layer-control-button full-height",onClick:()=>f(e),draggable:!0,onDragStart:W=>J(W,"toggle","clear","layer",`L${e+1} Clear`),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),d.jsxs("div",{className:"layer-control-group",children:[d.jsx($t,{id:`layer_${e}_blackout`,children:d.jsx("span",{className:"layer-control-button half-height",onClick:M,style:{backgroundColor:S?"red":""},draggable:!0,onDragStart:W=>J(W,"toggle","blackout","layer",`L${e+1} Blackout`),children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),d.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),d.jsx($t,{id:`layer_${e}_solo`,children:d.jsx("span",{className:"layer-control-button half-height",onClick:D,style:{backgroundColor:E?"var(--theme-color)":"",color:E?"black":""},draggable:!0,onDragStart:W=>J(W,"toggle","solo","layer",`L${e+1} Solo`),children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-1-square",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M9.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z"}),d.jsx("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"})]})})})]}),d.jsxs("select",{className:"layer-blend-dropdown",children:[d.jsx("option",{children:"Normal"}),d.jsx("option",{children:"Add"}),d.jsx("option",{children:"Subtract"})]})]}),d.jsx("div",{className:"layer-control-row",children:d.jsx($t,{id:`layer_${e}_intensity`,children:d.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:v,className:"slider_ver",id:"layer-intensity-slider",onChange:W=>x(parseFloat(W.target.value))})})}),d.jsx("div",{className:"layer-preview-thumbnail",onMouseEnter:()=>V(!0),onMouseLeave:()=>V(!1),style:{overflow:"hidden"},children:c?Z?d.jsx(qm,{frame:T||c.stillFrame,effects:$}):c.thumbnailPath?d.jsx("img",{src:`file://${c.thumbnailPath}?t=${c.thumbnailVersion||Date.now()}`,alt:"layer-thumbnail",style:{width:"100%",height:"100%",objectFit:"contain"}}):d.jsx(od,{frame:c.stillFrame}):P.length>0&&d.jsx("div",{className:"applied-effects",children:P.map((W,re)=>d.jsx("span",{className:"effect-tag",children:(W.name||W.id||"???").substring(0,3).toUpperCase()},W.instanceId||re))})}),d.jsx("span",{className:"layer-name-label",onClick:()=>j&&j(e),children:a})]})},dv=({clipName:a,layerIndex:e,colIndex:r,onDropGenerator:i,onDropEffect:o,clipContent:c,thumbnailFrameIndex:f,onUnsupportedFile:g,onActivateClick:m,onLabelClick:v,isSelected:x,isActive:T,ildaParserWorker:S,onDropDac:E,thumbnailRenderMode:M,liveFrame:D,stillFrame:j,onClipHover:P,onThumbnailError:F})=>{const[_,L]=R.useState(!1),[I,V]=R.useState(!1),$=a,J=M==="active"||M==="hover"&&_,ie=ue=>{ue.preventDefault(),ue.stopPropagation(),V(!0),ue.dataTransfer.dropEffect="copy"},oe=ue=>{ue.preventDefault(),ue.stopPropagation(),ue.currentTarget.contains(ue.relatedTarget)||V(!1)},U=()=>{L(!0),P&&P(e,r,!0)},K=()=>{L(!1),m(!1),P&&P(e,r,!1)},Z=async ue=>{const Ee=ue.name;if(!S){g("ILDA parser not available.");return}if(Ee.toLowerCase().endsWith(".ild"))try{const q=await ue.arrayBuffer();console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFileDrop): ${q.byteLength}`),S.postMessage({type:"parse-ilda",arrayBuffer:q,fileName:Ee,filePath:ue.path,layerIndex:e,colIndex:r},[q])}catch(q){console.error("[Clip.jsx] handleFileDrop - Error reading file:",q),g(`Error reading file: ${q.message}`)}else g("Please drop a valid .ild file")},W=async(ue,Ee)=>{if(!Ee.toLowerCase().endsWith(".ild")){console.log("Unsupported file type:",Ee),g("Please drop a valid .ild file");return}if(!S){g("ILDA parser not available.");return}try{if(window.electronAPI&&window.electronAPI.readFileAsBinary){const q=await window.electronAPI.readFileAsBinary(ue);if(!q||!(q instanceof ArrayBuffer)){console.error("[Clip.jsx] readFileAsBinary did not return an ArrayBuffer:",q),g("Error reading file: Invalid data format received.");return}console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFilePathDrop): ${q.byteLength}`),S.postMessage({type:"parse-ilda",arrayBuffer:q,fileName:Ee,filePath:ue,layerIndex:e,colIndex:r},[q])}else g("Binary file access not available")}catch(q){console.error("Error processing file path:",q),console.error("Error stack:",q.stack),g(`Error processing file: ${q.message}`)}},re=ue=>{ue.preventDefault(),ue.stopPropagation(),V(!1);const Ee=ue.dataTransfer.getData("application/json");if(Ee)try{const Q=JSON.parse(Ee);if(Q.filePath&&Q.fileName){W(Q.filePath,Q.fileName);return}if(Q.type==="transform"||Q.type==="animation"||Q.type==="color"||Q.type==="effect"){if(o){o(Q),v();return}}else if(Q.ip&&(typeof Q.channel=="number"||Q.allChannels)){if(E){E(e,r,Q);return}}else if(Q.name&&i){i(e,r,Q);return}}catch(Q){console.error("Error parsing dropped data:",Q)}const q=ue.dataTransfer.files;if(q&&q.length>0){Z(q[0]);return}console.log("No recognized data format found in drop"),g("No valid ILD file, effect, or generator dropped.")},Y=ue=>{ue.preventDefault(),ue.stopPropagation()},ee=ue=>{ue.preventDefault(),window.electronAPI&&window.electronAPI.showClipContextMenu&&window.electronAPI.showClipContextMenu(e,r,c?.triggerStyle||"normal")};return d.jsxs("div",{className:`clip ${I?"dragging":""} ${T?"active-clip":""} `,onDragEnter:Y,onDragOver:ie,onDragLeave:oe,onDrop:re,onContextMenu:ee,children:[d.jsx($t,{id:`clip_${e}_${r}`,children:d.jsx("div",{className:"clip-thumbnail",onMouseDown:ue=>{ue.button===0&&m(!0)},onMouseUp:ue=>{ue.button===0&&m(!1)},onMouseEnter:U,onMouseLeave:K,style:{overflow:"hidden"},children:c&&c.parsing?d.jsx("div",{className:"clip-loading-spinner"}):d.jsxs(d.Fragment,{children:[J&&c?d.jsx(qm,{frame:D||j,effects:c?.effects}):c?.thumbnailPath?d.jsx("img",{src:`file://${c.thumbnailPath}?t=${c.thumbnailVersion||Date.now()}`,alt:"thumbnail",onError:()=>F&&F(e,r),style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"}}):j&&d.jsx(od,{frame:j}),c?.triggerStyle&&c.triggerStyle!=="normal"&&d.jsxs("p",{className:"clip_icons",children:[c.triggerStyle==="toggle"&&d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-toggles",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7"})}),c.triggerStyle==="flash"&&d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-lightning-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"})})]})]})})}),d.jsx($t,{id:`clip_${e}_${r}_preview`,children:d.jsx("span",{className:`clip-label ${x?"selected-clip":""}`,onClick:v,children:$})})]})},pv=Yn.memo(dv),Vm=R.createContext(null),Xm=()=>R.useContext(Vm),hv=({children:a})=>{const[e,r]=R.useState(null);return R.useEffect(()=>{if(!e){const i=new Worker(new URL(""+new URL("ilda-parser.worker-CjheifOo.js",import.meta.url).href,import.meta.url));r(i)}return()=>{e&&e.terminate()}},[e]),d.jsx(Vm.Provider,{value:e,children:a})},mv=({onDropIld:a,viewMode:e="list",onViewModeChange:r,path:i,onPathChange:o})=>{const[c,f]=R.useState([]),[g,m]=R.useState({}),[v,x]=R.useState(new Set),T=Xm(),S=R.useRef(new Set),E=R.useRef([]),M=R.useRef(!1),D=i,j=o,P=R.useCallback(()=>{if(M.current||E.current.length===0||!T)return;M.current=!0;const _=E.current.shift(),L=_.split(/[/\\]/).pop();T.postMessage({type:"load-and-parse-ilda",fileName:L,filePath:_,browserFile:!0,stopAtFirstFrame:!0})},[T]);R.useEffect(()=>{if(!T)return;const _=L=>{L.data.browserFile&&(L.data.type==="parse-ilda"?L.data.success?T.postMessage({type:"get-frame",workerId:L.data.workerId,frameIndex:0,browserFile:!0,filePath:L.data.filePath}):(console.warn(`[FileBrowser] Skipping invalid ILDA file: ${L.data.filePath}. Reason: ${L.data.error}`),x(I=>new Set(I).add(L.data.filePath)),M.current=!1,P()):L.data.type==="get-frame"&&(L.data.success&&m(I=>({...I,[L.data.filePath]:L.data.bitmap||L.data.frame})),M.current=!1,P()))};return T.addEventListener("message",_),()=>T.removeEventListener("message",_)},[T,P]),R.useEffect(()=>{if(e==="thumbnails"&&c.length>0&&T){let _=!1;c.forEach(L=>{!g[L]&&!S.current.has(L)&&(S.current.add(L),E.current.push(L),_=!0)}),_&&!M.current&&P()}},[e,c,T,g,P]),R.useEffect(()=>{(async()=>{if(i){const L=await window.electronAPI.readIldFiles(i);f(L),S.current.clear(),E.current=[],M.current=!1,m({});return}if(window.electronAPI&&window.electronAPI.getUserIldaPath){const L=await window.electronAPI.getUserIldaPath();if(L){j(L);const I=await window.electronAPI.readIldFiles(L);f(I),S.current.clear(),E.current=[],M.current=!1,m({})}}})()},[i]);const F=async()=>{if(window.electronAPI){const _=await window.electronAPI.openFileExplorer();if(_){j(_);const L=await window.electronAPI.readIldFiles(_);f(L),S.current.clear(),E.current=[],M.current=!1,m({})}}};return d.jsxs("div",{className:"file-browser",children:[d.jsx("button",{onClick:F,children:"Open Folder"}),d.jsxs("div",{className:"list_switcher",children:[d.jsx("button",{className:e==="list"?"active":"",onClick:()=>r&&r("list"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-list",viewBox:"0 0 16 16",children:d.jsx("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"})})}),d.jsx("button",{className:e==="thumbnails"?"active":"",onClick:()=>r&&r("thumbnails"),children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),d.jsx("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})]})})]}),D&&d.jsxs("p",{className:"fileBrowser",children:["Selected Directory: ",D.split(/[/\\]/).filter(Boolean).pop()]}),d.jsx("div",{className:"ild-file-grid",style:{display:e==="thumbnails"?null:"none"},children:c.filter(_=>!v.has(_)).length>0?c.filter(_=>!v.has(_)).map((_,L)=>{const I=_.split(/[/\\]/).pop(),V=g[_];return d.jsxs("div",{className:"ild-file-preview",draggable:!0,onDragStart:$=>$.dataTransfer.setData("application/json",JSON.stringify({filePath:_,fileName:I})),children:[d.jsx("div",{className:"file_thumbnail",children:V?d.jsx(od,{bitmap:V instanceof ImageBitmap?V:null,frame:V instanceof ImageBitmap?null:V}):d.jsx("div",{className:"clip-loading-spinner"})}),d.jsx("div",{className:"file_name",children:I})]},L)}):d.jsx("p",{children:"No valid ILD files found in selected directory."})}),d.jsx("div",{className:"ild-file-list",style:{display:e==="list"?null:"none"},children:c.filter(_=>!v.has(_)).length>0?c.filter(_=>!v.has(_)).map((_,L)=>{const I=_.split(/[/\\]/).pop();return d.jsx("div",{className:"ild-file-item",draggable:!0,onDragStart:V=>V.dataTransfer.setData("application/json",JSON.stringify({filePath:_,fileName:I})),children:I},L)}):d.jsx("p",{children:"No valid ILD files found in selected directory."})})]})},Xf=[{id:"circle",name:"Circle",description:"Generates a simple circle.",defaultParams:{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"radius",label:"Radius",type:"range",min:.01,max:1,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:3,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"square",name:"Square",description:"Generates a simple square.",defaultParams:{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"width",label:"Width",type:"range",min:.01,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"triangle",name:"Triangle",description:"Generates a simple symmetrical triangle.",defaultParams:{size:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"size",label:"Size",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"line",name:"Line",description:"Generates a straight line.",defaultParams:{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"x1",label:"X1",type:"range",min:-1,max:1,step:.01},{id:"y1",label:"Y1",type:"range",min:-1,max:1,step:.01},{id:"x2",label:"X2",type:"range",min:-1,max:1,step:.01},{id:"y2",label:"Y2",type:"range",min:-1,max:1,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:2,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"text",name:"Text",description:"Generates text.",defaultParams:{text:"TrueLazer",x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"text",label:"Text Content",type:"text"},{id:"fontUrl",label:"Fonts",type:"text"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:300,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"star",name:"Star",description:"Generates a star shape.",defaultParams:{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"outerRadius",label:"Outer Radius",type:"range",min:.01,max:1,step:.01},{id:"innerRadius",label:"Inner Radius",type:"range",min:.01,max:1,step:.01},{id:"numSpikes",label:"Number of Spikes",type:"range",min:3,max:20,step:1},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:20,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"ndi-source",name:"NDI Source",description:"Placeholder for NDI Video Input.",defaultParams:{sourceName:"No Source",threshold:128,edgeDetection:!1,captureWidth:480,captureHeight:480,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Source Name",type:"text"},{id:"captureWidth",label:"Width",type:"range",min:128,max:1280,step:1},{id:"captureHeight",label:"Height",type:"range",min:128,max:1280,step:1},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"spout-receiver",name:"Spout Receiver",description:"Placeholder for Spout Video Input.",defaultParams:{sourceName:"Spout Input",threshold:128,edgeDetection:!1,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Sender Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"sinewave",name:"Sine Wave",description:"Generates a customizable sine wave.",defaultParams:{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:0,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:.1,max:10,step:.1},{id:"phase",label:"Phase",type:"range",min:0,max:Math.PI*2,step:.01},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:10,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]}],gv=()=>{const[a,e]=R.useState([]);R.useEffect(()=>{const o=async()=>{if(window.electronAPI&&window.electronAPI.ndiFindSources){const f=await window.electronAPI.ndiFindSources();e(f||[])}};o();const c=setInterval(o,5e3);return()=>clearInterval(c)},[]);const r=(o,c)=>{o.dataTransfer.setData("application/json",JSON.stringify(c))},i=(o,c)=>{const f=Xf.find(m=>m.id==="ndi-source"),g={...f,defaultParams:{...f.defaultParams,sourceName:c.name}};o.dataTransfer.setData("application/json",JSON.stringify(g))};return d.jsxs("div",{className:"generator-panel",children:[d.jsx("div",{className:"generator-list",children:Xf.filter(o=>o.id!=="ndi-source"&&o.id!=="spout-receiver").map(o=>d.jsx("div",{className:"generator-item",draggable:!0,onDragStart:c=>r(c,o),children:o.name},o.id))}),d.jsx("h3",{style:{marginTop:"10px"},children:"NDI Sources"}),d.jsx("div",{className:"generator-list",children:a.length>0?a.map((o,c)=>d.jsx("div",{className:"generator-item ndi-item",draggable:!0,onDragStart:f=>i(f,o),children:o.name},`${o.name}-${c}`)):d.jsx("div",{className:"empty-msg",children:"No NDI sources found"})})]})},yv=()=>{const a=(e,r)=>{e.dataTransfer.setData("application/json",JSON.stringify(r))};return d.jsx("div",{className:"effect-panel",children:rl.map(e=>d.jsx("div",{draggable:!0,onDragStart:r=>a(r,e),className:"effect-item",children:e.name},e.id))})},yi=({value:a,onChange:e,label:r,onDrop:i,size:o=40,isAssigned:c,className:f,...g})=>{const m=R.useRef(null),v=E=>{i&&(E.preventDefault(),E.dataTransfer.dropEffect="link")},x=E=>{if(i){E.preventDefault();try{const M=E.dataTransfer.getData("application/x-truelazer-param");console.log("[RadialKnob] Dropped Data Raw:",M);const D=JSON.parse(M);console.log("[RadialKnob] Dropped Data Parsed:",D),D&&(D.type==="range"||D.type==="number")?i(D):console.warn("[RadialKnob] Invalid data type for knob:",D?.type)}catch(M){console.error("[RadialKnob] Drop Error:",M)}}},T=-135+a*270,S=E=>{if(!c||E.button!==0)return;E.preventDefault();const M=E.clientY,D=a,j=F=>{const L=(M-F.clientY)/200;let I=Math.max(0,Math.min(1,D+L));e(I)},P=()=>{window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",P)};window.addEventListener("mousemove",j),window.addEventListener("mouseup",P)};return R.useEffect(()=>{const E=m.current;if(!E)return;const M=D=>{if(!c)return;D.preventDefault(),D.stopPropagation();const j=D.deltaY*-.001;let P=Math.max(0,Math.min(1,a+j));e(P)};return E.addEventListener("wheel",M,{passive:!1}),()=>{E.removeEventListener("wheel",M)}},[a,e,c]),d.jsxs("div",{className:`quick-assign-knob ${c?"":"unassigned"} ${f||""}`.trim(),ref:m,style:{cursor:c?"ns-resize":"default",userSelect:"none",opacity:c?1:.5},onDragOver:v,onDrop:x,onMouseDown:S,...g,children:[d.jsx("div",{className:"knob-label",title:r,children:r}),d.jsx("div",{className:"knob-circle",children:d.jsx("div",{className:"knob-indicator",style:{transform:`rotate(${T}deg)`}})}),d.jsxs("div",{className:"knob-value",style:{fontSize:"9px",color:"#888",marginTop:"2px"},children:[Math.round(a*100),"%"]})]})},vv=({dacs:a=[],onDacSelected:e,onDacsDiscovered:r,dacSettings:i={},onUpdateDacSettings:o})=>{const[c,f]=R.useState(!1),[g,m]=R.useState(null),[v,x]=R.useState([]),[T,S]=R.useState(null),E=Yn.useRef(!1);R.useEffect(()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(F=>{x(F),F.length>0&&S(F[0])})},[]),R.useEffect(()=>{c&&!E.current&&(E.current=!0,console.log("Starting DAC scan on:",T?.address),window.electronAPI?window.electronAPI.discoverDacs(2e3,T?.address).then(async F=>{console.log("DACs discovered:",F);const _=await Promise.all(F.map(async L=>{try{const I=await window.electronAPI.getDacServices(L.ip,T?.address,L.type),V=L.type&&L.type.toLowerCase()==="etherdream"?I:I.filter($=>$.serviceID!==0);return{...L,channels:V}}catch(I){return console.error(`Error fetching services for DAC ${L.ip}:`,I),{...L,channels:[]}}}));r&&r(_)}).catch(F=>{console.error("Error discovering DACs:",F)}).finally(()=>{f(!1),E.current=!1}):(console.warn("electronAPI is not available. Cannot discover DACs."),f(!1),E.current=!1))},[c,T,r]);const M=(F,_)=>{const L={...F,channel:_};m(L),e&&e(L)},D=(F,_,L)=>{F.stopPropagation();const I={..._,channel:L};F.dataTransfer.setData("application/json",JSON.stringify(I))},j=F=>{const _=F.target.value,L=v.find(I=>I.address===_);S(L)},P=(F,_)=>{F.stopPropagation();const L={..._,allChannels:!0};F.dataTransfer.setData("application/json",JSON.stringify(L))};return d.jsxs("div",{className:"dac-panel",children:[d.jsx("div",{className:"settings-card-header",children:d.jsx("h4",{children:"DACs"})}),d.jsxs("div",{className:"network-interface-selector",style:{display:"flex",gap:5,padding:"5px 10px"},children:[d.jsxs("div",{style:{flex:1,display:"flex"},children:[d.jsx("select",{onChange:j,value:T?.address||"",style:{width:"100%",height:"100%",background:"#2a2a2a",color:"#aaa",borderRadius:"5px",cursor:"pointer",marginBottom:2},children:v.map(F=>d.jsxs("option",{value:F.address,children:[F.name," (",F.address,")"]},F.address))}),d.jsx("button",{onClick:()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(F=>{x(F),F.length>0&&!T&&S(F[0])})},style:{fontSize:"9px",padding:"2px",background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",borderRadius:"5px"},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-clockwise",viewBox:"0 0 16 16",children:[d.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"}),d.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"})]})})]}),d.jsx("label",{style:{display:"flex",alignItems:"center",fontSize:"10px"},children:d.jsx("input",{type:"checkbox",checked:c,onChange:F=>f(F.target.checked),disabled:c,style:{height:"100%"}})})]}),d.jsx("div",{className:"dac-list",children:a.map(F=>d.jsxs("div",{className:"dac-group",draggable:!0,onDragStart:_=>P(_,F),children:[d.jsxs("div",{className:"dac-ip",children:[F.hostName||F.ip," (",F.ip,")"]}),d.jsx("div",{className:"dac-channels",children:F.channels&&F.channels.length>0?F.channels.map(_=>d.jsxs("div",{className:`dac-channel-item ${g&&(g.unitID===F.unitID||g.ip===F.ip)&&g.channel===_.serviceID?"selected":""}`,onClick:()=>M(F,_.serviceID),draggable:!0,onDragStart:L=>D(L,F,_.serviceID),children:["Channel ",_.serviceID," (",_.name,")"]},`${F.unitID||F.ip}-${_.serviceID}`)):d.jsx("div",{className:"dac-channel-item no-channels",children:"No channels found"})})]},F.unitID||F.ip))}),a.length>0&&d.jsxs("div",{className:"dac-dimmers-section",children:[d.jsx("h4",{children:"Channel Dimmers"}),d.jsx("div",{className:"dac-dimmers-grid",children:a.flatMap(F=>(F.channels||[]).map(_=>({dac:F,ch:_}))).map(({dac:F,ch:_})=>{const L=`${F.ip}:${_.serviceID}`,I=i[L]||{},V=I.dimmer!==void 0?I.dimmer:1;return d.jsx($t,{id:`dimmer_${L.replace(/\./g,"_")}`,children:d.jsx(yi,{label:`${F.hostName||F.ip} Ch${_.serviceID}`,value:V,onChange:$=>{o&&o(L,{...I,dimmer:$})}})},`dimmer_${L}`)})})]})]})},$m=({min:a,max:e,step:r,value:i,rangeValue:o,onChange:c,onRangeChange:f,showRange:g=!1,disabled:m=!1,animSettings:v,progressRef:x,workerId:T,clipDuration:S,bpm:E,getFftLevels:M})=>{const D=R.useRef(null),j=R.useRef(null),P=R.useRef(null),[F,_]=R.useState(null),L=a!==void 0?a:0,I=e!==void 0?e:1,V=o&&o[0]!==void 0?o[0]:L,$=o&&o[1]!==void 0?o[1]:I,J=i!==void 0?i:L,ie=U=>{const K=I-L;return K===0?0:(U-L)/K*100};R.useEffect(()=>{let U;const K=()=>{if(F==="value"){U=requestAnimationFrame(K);return}let Z=J;if(v&&v.syncMode&&x&&x.current){const Y={progress:T&&x.current[T]!==void 0?x.current[T]:0,time:performance.now(),clipDuration:S||1,bpm:E||120,fftLevels:M?M():{low:0,mid:0,high:0}};Z=Cc(null,J,v,Y,L,I)}const W=ie(Z);j.current&&(j.current.style.left=`${W}%`),P.current&&(P.current.style.width=`${W}%`),U=requestAnimationFrame(K)};return U=requestAnimationFrame(K),()=>cancelAnimationFrame(U)},[v,x,T,J,F,L,I,E,M,S]);const oe=(U,K)=>{if(m)return;U.preventDefault(),U.stopPropagation(),_(K);const Z=re=>{if(!D.current)return;const Y=D.current.getBoundingClientRect(),ee=re.clientX-Y.left;let ue=Math.max(0,Math.min(100,ee/Y.width*100)),Ee=L+ue/100*(I-L);r&&(Ee=Math.round(Ee/r)*r,ue=(Ee-L)/(I-L)*100),K==="value"?(Ee=Math.max(V,Math.min($,Ee)),j.current&&(j.current.style.left=`${ie(Ee)}%`),P.current&&!g&&(P.current.style.width=`${ie(Ee)}%`),c&&c(Ee)):K==="min"?(Ee=Math.max(L,Math.min($,Ee)),f&&f([Ee,$])):K==="max"&&(Ee=Math.max(V,Math.min(I,Ee)),f&&f([V,Ee]))},W=()=>{_(null),window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",W)};window.addEventListener("mousemove",Z),window.addEventListener("mouseup",W)};return d.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:d.jsxs("div",{className:"range-slider-track",ref:D,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[g&&d.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:`${ie(V)}%`,width:`${ie($)-ie(V)}%`}}),!g&&d.jsx("div",{className:"value-slider-fill",ref:P,style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:"0%",borderRadius:"2px"}}),g&&d.jsx("div",{className:"range-slider-handle min-handle",style:{left:`${ie(V)}%`},onMouseDown:U=>oe(U,"min"),title:`Min: ${V.toFixed(2)}`}),g&&d.jsx("div",{className:"range-slider-handle max-handle",style:{left:`${ie($)}%`},onMouseDown:U=>oe(U,"max"),title:`Max: ${$.toFixed(2)}`}),d.jsx("div",{className:"range-slider-handle value-handle",ref:j,style:{position:"absolute",width:"6px",height:"16px",top:"-50%",transform:"translate(-50%, -25%)",cursor:"pointer",zIndex:20,boxShadow:"0 0 2px rgba(0,0,0,0.5)"},onMouseDown:U=>oe(U,"value"),title:`Value: ${J.toFixed(2)}`})]})})},Kn=({title:a,children:e,icon:r,defaultCollapsed:i=!1,headerActions:o,onToggle:c,isCollapsed:f,dragHandle:g})=>{const[m,v]=R.useState(i),x=c!==void 0?f:m,T=()=>{c?c(!x):v(!x)};return d.jsxs("div",{className:`settings-card ${x?"collapsed":""}`,children:[d.jsxs("div",{className:"settings-card-header",onClick:T,style:{userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer",flex:1,overflow:"hidden"},children:[g&&d.jsx("div",{onClick:S=>S.stopPropagation(),style:{display:"flex",alignItems:"center"},children:g}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",style:{transform:x?"rotate(0deg)":"rotate(90deg)",transition:"transform 0.2s",flexShrink:0},children:d.jsx("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})}),r&&d.jsx("span",{className:`bi ${r}`,style:{flexShrink:0}}),d.jsx("h4",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",margin:0},children:a})]}),o&&d.jsx("div",{onClick:S=>S.stopPropagation(),style:{flexShrink:0,marginLeft:"5px"},children:o})]}),!x&&d.jsx("div",{className:"settings-card-content",children:e})]})},Wm=({animSettings:a,onChange:e})=>{const{direction:r="forward",style:i="loop",syncMode:o=null,duration:c=1,beats:f=8,speedMultiplier:g=1}=a||{},m=(x,T)=>e({...a,[x]:T}),v=(x,T,S=!1)=>{let M=a?.[x]||(x==="beats"?8:1);S?M=T>1?M*2:M/2:M+=T,M<.01&&(M=.01),!S&&x!=="beats"&&(M=Math.round(M*100)/100),m(x,M)};return d.jsxs("div",{className:"anim-controls-container",children:[d.jsxs("div",{className:"anim-row controls-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"5px"},children:[d.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:`speed-control-button ${r==="backward"?"active":""}`,onClick:()=>m("direction","backward"),title:"Backward",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",transform:"scale(-1 1)",children:d.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})}),d.jsx("button",{className:`speed-control-button ${r==="pause"?"active":""}`,onClick:()=>m("direction","pause"),title:"Pause",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsx("svg",{width:"25",height:"20",viewBox:"0 0 16 16",className:"icon flat-color",children:d.jsx("path",{d:"M3 1h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m7 0h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m0 0"})})}),d.jsx("button",{className:`speed-control-button ${r==="forward"?"active":""}`,onClick:()=>m("direction","forward"),title:"Forward",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",children:d.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})})]}),d.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:`speed-control-button ${i==="once"?"active":""}`,onClick:()=>m("style","once"),title:"Once",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[d.jsx("path",{d:"M43.8233 25.2305C43.7019 25.9889 43.5195 26.727 43.2814 27.4395 42.763 28.9914 41.9801 30.4222 40.9863 31.6785 38.4222 34.9201 34.454 37 30 37H16C9.39697 37 4 31.6785 4 25 4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M24 19V31",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M24 19 21 22 19.5 23.5",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),d.jsx("button",{className:`speed-control-button ${i==="bounce"?"active":""}`,onClick:()=>m("style","bounce"),title:"Bounce",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[d.jsx("path",{d:"M42 19H5.99998",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M30 7 42 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M6.79897 29H42.799",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M6.79895 29 18.799 41",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),d.jsx("button",{className:`speed-control-button ${i==="loop"?"active":""}`,onClick:()=>m("style","loop"),title:"Loop",style:{flex:1,padding:0,fontSize:"10px"},children:d.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[d.jsx("path",{d:"M4 25C4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M44 23C44 29.6498 38.6038 35 32 35H4",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M10 41 4 35 10 29",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),d.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:`speed-control-button ${o==="fps"?"active":""}`,onClick:()=>m("syncMode",o==="fps"?null:"fps"),style:{flex:1,padding:0,fontSize:"10px"},children:"F"}),d.jsx("button",{className:`speed-control-button ${o==="timeline"?"active":""}`,onClick:()=>m("syncMode",o==="timeline"?null:"timeline"),style:{flex:1,padding:0,fontSize:"10px"},children:"T"}),d.jsx("button",{className:`speed-control-button ${o==="bpm"?"active":""}`,onClick:()=>m("syncMode",o==="bpm"?null:"bpm"),style:{flex:1,padding:0,fontSize:"10px"},children:"B"}),d.jsx("button",{className:`speed-control-button ${o==="fft"?"active":""}`,onClick:()=>m("syncMode",o==="fft"?null:"fft"),style:{flex:1,padding:0,fontSize:"10px"},children:"FFT"})]})]}),o==="fft"&&d.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:d.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[d.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Range"}),d.jsxs("select",{value:a?.fftRange||"low",onChange:x=>m("fftRange",x.target.value),style:{fontSize:"10px",background:"#333",border:"1px solid #555",color:"white"},children:[d.jsx("option",{value:"low",children:"Low"}),d.jsx("option",{value:"mid",children:"Mid"}),d.jsx("option",{value:"high",children:"High"})]})]})}),o==="timeline"&&d.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:d.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[d.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Duration (s)"}),d.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:"tiny-btn",onClick:()=>v("duration",-1),children:"-1"}),d.jsx("input",{type:"number",value:typeof c=="number"?c.toFixed(2):c,onChange:x=>m("duration",parseFloat(x.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("duration",1),children:"+1"}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("duration",.5,!0),children:"/2"}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("duration",2,!0),children:"*2"})]})]})}),o==="bpm"&&d.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:d.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[d.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Beats"}),d.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:"tiny-btn",onClick:()=>v("beats",-1),children:"-1"}),d.jsx("input",{type:"number",value:f,onChange:x=>m("beats",parseInt(x.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("beats",1),children:"+1"}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("beats",.5,!0),children:"/2"}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("beats",2,!0),children:"*2"})]})]})}),(o==="timeline"||o==="bpm"||o==="fps")&&d.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:d.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[d.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Speed"}),d.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[d.jsx("button",{className:"tiny-btn",onClick:()=>v("speedMultiplier",-.1),children:"-0.1"}),d.jsx("input",{type:"number",value:typeof g=="number"?g.toFixed(2):g,onChange:x=>m("speedMultiplier",parseFloat(x.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),d.jsx("button",{className:"tiny-btn",onClick:()=>v("speedMultiplier",.1),children:"+0.1"})]})]})})]})},Jl=(a,e,r)=>{let i,o,c;const f=Math.floor(a*6),g=a*6-f,m=r*(1-e),v=r*(1-g*e),x=r*(1-(1-g)*e);switch(f%6){case 0:i=r,o=x,c=m;break;case 1:i=v,o=r,c=m;break;case 2:i=m,o=r,c=x;break;case 3:i=m,o=v,c=r;break;case 4:i=x,o=m,c=r;break;case 5:i=r,o=m,c=v;break}const T=S=>{const E=Math.round(S*255).toString(16);return E.length===1?"0"+E:E};return`#${T(i)}${T(o)}${T(c)}`},Y0=a=>{let e=parseInt(a.slice(1,3),16)/255,r=parseInt(a.slice(3,5),16)/255,i=parseInt(a.slice(5,7),16)/255,o=Math.max(e,r,i),c=Math.min(e,r,i),f,g,m=o,v=o-c;if(g=o===0?0:v/o,o===c)f=0;else{switch(o){case e:f=(r-i)/v+(r<i?6:0);break;case r:f=(i-e)/v+2;break;case i:f=(e-r)/v+4;break}f/=6}return{h:f,s:g,v:m}},q0=({color:a="#ffffff",onChange:e})=>{const r=R.useRef(null),[i,o]=R.useState(()=>Y0(a)),[c,f]=R.useState(!1);R.useEffect(()=>{const x=Y0(a);Jl(x.h,x.s,x.v)!==Jl(i.h,i.s,i.v)&&o(x)},[a]);const g=R.useCallback(()=>{const x=r.current;if(!x)return;const T=x.getContext("2d"),S=x.width,E=x.height;T.fillStyle=Jl(i.h,1,1),T.fillRect(0,0,S,E);const M=T.createLinearGradient(0,0,S,0);M.addColorStop(0,"rgba(255,255,255,1)"),M.addColorStop(1,"rgba(255,255,255,0)"),T.fillStyle=M,T.fillRect(0,0,S,E);const D=T.createLinearGradient(0,0,0,E);D.addColorStop(0,"rgba(0,0,0,0)"),D.addColorStop(1,"rgba(0,0,0,1)"),T.fillStyle=D,T.fillRect(0,0,S,E);const j=i.s*S,P=(1-i.v)*E;T.strokeStyle=i.v>.5?"#000":"#fff",T.lineWidth=2,T.beginPath(),T.arc(j,P,5,0,Math.PI*2),T.stroke()},[i]);R.useEffect(()=>{g()},[g]);const m=x=>{const S=r.current.getBoundingClientRect(),E=Math.max(0,Math.min(1,(x.clientX-S.left)/S.width)),M=Math.max(0,Math.min(1,(x.clientY-S.top)/S.height)),D={...i,s:E,v:1-M};o(D),e&&e(Jl(D.h,D.s,D.v))},v=x=>{f(!0),m(x)};return R.useEffect(()=>{if(!c)return;const x=S=>m(S),T=()=>f(!1);return window.addEventListener("mousemove",x),window.addEventListener("mouseup",T),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",T)}},[c,i]),d.jsxs("div",{className:"custom-color-picker",style:{padding:"5px",background:"#222",borderRadius:"4px"},children:[d.jsx("canvas",{ref:r,width:150,height:100,style:{width:"100%",height:"100px",cursor:"crosshair",borderRadius:"2px"},onMouseDown:v}),d.jsx("div",{className:"hue-slider-container",style:{marginTop:"8px"},children:d.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:i.h,onChange:x=>{const T={...i,h:parseFloat(x.target.value)};o(T),e&&e(Jl(T.h,T.s,T.v))},style:{width:"100%",height:"10px",appearance:"none",background:"linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)",borderRadius:"5px"}})})]})},Zm=({control:a,value:e,onChange:r,animSettings:i,onAnimChange:o,effectId:c,context:f,progressRef:g,workerId:m,clipDuration:v,bpm:x,getFftLevels:T,uiState:S,onUpdateUiState:E,paramKey:M})=>{const[D,j]=R.useState(!1),P=!!S?.expandedParams?.[M],F=$=>{E&&E({expandedParams:{...S?.expandedParams||{},[M]:$}})},_=$=>{$.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:a.type,paramName:a.id,effectId:c,min:a.min,max:a.max,step:a.step,...f}))},L=i?.range||[a.min,a.max],I=$=>{o({...i,range:$})},V=$=>{o({range:L,...$})};return d.jsxs("div",{className:`param-editor ${P?"expanded":""}`,onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),style:{marginBottom:"8px",display:"grid",gridTemplateColumns:"1fr",gap:"2px"},children:[d.jsx("div",{className:"param-row-label",style:{width:"100%"},children:d.jsx("label",{className:"param-label",draggable:!0,onDragStart:_,style:{fontSize:"11px",color:"#aaa"},children:a.label})}),d.jsxs("div",{className:"param-row-control",style:{display:"grid",gridTemplateColumns:"20px 1fr 60px",gap:"5px",alignItems:"center"},children:[d.jsx("button",{className:`anim-toggle-btn ${P?"active":""}`,style:{visibility:D||P||i?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>F(!P),title:"Animate",children:""}),d.jsx("div",{className:"control-input-wrapper",style:{display:"flex",alignItems:"center",height:"100%"},children:a.type==="range"?d.jsx($t,{id:`${c}_${a.id}`,style:{width:"100%"},children:d.jsx($m,{min:a.min,max:a.max,step:a.step,value:e,rangeValue:L,onChange:r,onRangeChange:I,showRange:P,animSettings:i,progressRef:g,workerId:m,clipDuration:v,bpm:x,getFftLevels:T})}):a.type==="text"?d.jsx("input",{type:"text",value:e,onChange:$=>r($.target.value),className:"param-text-input"}):a.type==="checkbox"?d.jsx($t,{id:`${c}_${a.id}`,children:d.jsx("input",{type:"checkbox",checked:e,onChange:$=>r($.target.checked),className:"param-checkbox"})}):a.type==="select"?d.jsx("select",{value:e,onChange:$=>r($.target.value),className:"param-select",children:a.options.map($=>d.jsx("option",{value:$,children:$},$))}):null}),a.type==="range"&&d.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:$=>r(parseFloat($.target.value)||0),className:"param-number-input",step:a.step,style:{fontSize:"10px"}})]}),P&&a.type==="range"&&d.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:d.jsx(Wm,{animSettings:i,onChange:V})})]})},bv=({customOrder:a=[],assignedDacs:e=[],onChange:r})=>{const[i,o]=R.useState(null),c=a&&a.length>0?a:e.map((m,v)=>({ip:m.ip,channel:m.channel,label:`Ch ${m.channel} (${m.hostName||m.ip})`,originalIndex:v})),f=(m,v)=>{o(c[v])},g=(m,v)=>{m.preventDefault();const x=c[v];if(i===x)return;const T=c.filter(S=>S!==i);T.splice(v,0,i),r(T)};return d.jsxs("div",{className:"custom-order-editor",style:{marginBottom:"10px",padding:"5px",background:"#222",borderRadius:"4px"},children:[d.jsx("label",{style:{fontSize:"10px",color:"#888"},children:"Channel Order (Drag to Sort)"}),d.jsx("ul",{style:{listStyle:"none",padding:0,margin:"5px 0"},children:c.map((m,v)=>d.jsxs("li",{draggable:!0,onDragStart:x=>f(x,v),onDragOver:x=>g(x,v),style:{background:"#333",border:"1px solid #444",padding:"4px",marginBottom:"2px",fontSize:"10px",cursor:"grab",display:"flex",alignItems:"center"},children:[d.jsx("span",{style:{marginRight:"5px",color:"#666"},children:""}),m.label||`Ch ${m.channel} ${m.ip?`(${m.ip})`:""}`]},v))})]})},xv=({effect:a,onParamChange:e,syncSettings:r,onSetParamSync:i,context:o,progressRef:c,workerId:f,clipDuration:g,bpm:m,getFftLevels:v,uiState:x,onUpdateUiState:T})=>{const{mode:S,color:E,paletteColors:M=[],paletteSize:D=4}=a.params,[j,P]=R.useState(0),F=!!x?.showHsv?.[a.instanceId],_=oe=>{T&&T({showHsv:{...x?.showHsv||{},[a.instanceId]:oe}})},L=oe=>{const U=[...M];for(;U.length<16;)U.push("#ffffff");U[j]=oe,e("paletteColors",U)},I=rl.find(oe=>oe.id==="color"),V=oe=>{if(!oe)return{h:0,s:0,v:1};const U=parseInt(oe.slice(1,3),16)/255,K=parseInt(oe.slice(3,5),16)/255,Z=parseInt(oe.slice(5,7),16)/255,W=Math.max(U,K,Z),re=Math.min(U,K,Z);let Y,ee,ue=W;const Ee=W-re;if(ee=W===0?0:Ee/W,W===re)Y=0;else{switch(W){case U:Y=(K-Z)/Ee+(K<Z?6:0);break;case K:Y=(Z-U)/Ee+2;break;case Z:Y=(U-K)/Ee+4;break}Y/=6}return{h:Y,s:ee,v:ue}},$=oe=>{e("color",oe);const U=V(oe);e("hue",U.h),e("saturation",U.s),e("brightness",U.v)},J=[{name:"RGBY",colors:["#ff0000","#00ff00","#0000ff","#ffff00"]},{name:"CYBER",colors:["#ff00ff","#00ffff","#ffffff","#0000ff"]},{name:"FIRE",colors:["#ff8800","#ff0000","#ffff00","#880000"]},{name:"ICE",colors:["#0000ff","#0088ff","#00ffff","#ffffff"]}],ie=oe=>{const U=I.paramControls.find(Z=>Z.id===oe);if(!U)return null;const K=`${a.instanceId||a.id}.${U.id}`;return d.jsx(Zm,{control:U,value:a.params[oe],onChange:Z=>e(oe,Z),animSettings:r[K],onAnimChange:Z=>i(K,Z),effectId:a.id,context:o,progressRef:c,workerId:f,clipDuration:g,bpm:m,getFftLevels:v,uiState:x,onUpdateUiState:T,paramKey:K},oe)};return d.jsxs("div",{className:"color-effect-editor",children:[ie("mode"),S==="solid"&&d.jsxs("div",{style:{marginTop:"10px"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[d.jsx("label",{style:{fontSize:"11px",color:"#aaa"},children:"Pick Color"}),d.jsx("button",{className:`anim-toggle-btn ${F?"active":""}`,style:{background:"none",border:"none",color:F?"var(--theme-color)":"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>_(!F),title:"Advanced HSV Controls",children:""})]}),!F&&d.jsx(q0,{color:E||"#ffffff",onChange:$}),F&&d.jsxs("div",{className:"hsv-sliders",style:{padding:"5px",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[ie("hue"),ie("saturation"),ie("brightness"),d.jsx("div",{style:{marginTop:"5px",height:"10px",borderRadius:"2px",background:E||"#ffffff",border:"1px solid #444"}})]})]}),S==="palette"&&d.jsxs("div",{style:{marginTop:"10px"},children:[ie("paletteSize"),ie("paletteSpread"),ie("cycleSpeed"),ie("rainbowOffset"),d.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Presets"}),d.jsx("div",{className:"preset-row",style:{display:"flex",gap:"4px",marginBottom:"10px"},children:J.map(oe=>d.jsx("button",{onClick:()=>e("paletteColors",oe.colors),style:{fontSize:"9px",padding:"2px 5px",background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:"3px",cursor:"pointer"},children:oe.name},oe.name))}),d.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Palette Colors"}),d.jsx("div",{className:"palette-grid",style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"10px"},children:Array.from({length:D}).map((oe,U)=>d.jsx("div",{onClick:()=>P(U),style:{width:"20px",height:"20px",background:M[U]||"#ffffff",border:j===U?"2px solid white":"1px solid #444",borderRadius:"3px",cursor:"pointer",boxSizing:"border-box"}},U))}),d.jsx(q0,{color:M[j]||"#ffffff",onChange:L})]}),S==="rainbow"&&d.jsxs("div",{style:{marginTop:"10px"},children:[ie("cycleSpeed"),ie("rainbowSpread"),ie("rainbowOffset"),ie("rainbowPalette")]})]})},Qm=({effect:a,assignedDacs:e=[],onParamChange:r,onRemove:i,syncSettings:o={},onSetParamSync:c,context:f={},progressRef:g,clipDuration:m,bpm:v,getFftLevels:x,uiState:T,onUpdateUiState:S,dragHandle:E})=>{if(!a)return null;const M=rl.find(J=>J.id===a.id);if(!M)return null;const D=a.id==="delay",j=a.id==="chase",P=a.id==="color",F=a.params.enabled!==!1,_=a.params.mode==="channel",L=T?.collapsedEffects||{},I=!!L[a.instanceId],V=J=>{S&&S({collapsedEffects:{...L,[a.instanceId]:J}})},$=J=>{J.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"enabled",label:`${a.name} ON`,...f}))};return d.jsx(Kn,{title:a.name,isCollapsed:I,onToggle:V,dragHandle:E,headerActions:d.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[(D||j)&&d.jsx("button",{className:"mode-toggle-btn",onClick:()=>r("mode",_?"frame":"channel"),style:{fontSize:"9px",padding:"2px 5px",background:_?"#444":"var(--theme-color)",border:"none",color:"white",borderRadius:"3px",cursor:"pointer"},children:_?"CHANNEL":"FRAME"}),d.jsx($t,{id:`${a.id}_blackout`,children:d.jsx("button",{className:`layer-control-button ${F?"":"active"}`,onClick:()=>r("enabled",!F),draggable:!0,onDragStart:$,style:{padding:"2px",background:F?"none":"red",border:"none",color:"white",cursor:"pointer",display:"flex"},title:"Toggle Effect",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),d.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),d.jsx("button",{className:"remove-effect-btn",onClick:i,children:""})]}),children:P?d.jsx(xv,{effect:a,onParamChange:r,syncSettings:o,onSetParamSync:c,context:f,progressRef:g,workerId:f.workerId,clipDuration:m,bpm:v,getFftLevels:x,uiState:T,onUpdateUiState:S}):d.jsxs(d.Fragment,{children:[D&&d.jsx(d.Fragment,{children:a.params.useCustomOrder&&d.jsx(bv,{customOrder:a.params.customOrder,assignedDacs:e,onChange:J=>r("customOrder",J)})}),M.paramControls.map(J=>{if(D&&["customOrder"].includes(J.id)||J.showIf&&!Object.entries(J.showIf).every(([K,Z])=>a.params[K]===Z))return null;const ie=`${a.instanceId||a.id}.${J.id}`,oe=typeof o[ie]=="object"?o[ie]:{syncMode:o[ie]};return d.jsx(Zm,{control:J,value:a.params[J.id],onChange:U=>r(J.id,U),animSettings:oe,onAnimChange:U=>c(ie,U),effectId:a.id,context:f,progressRef:g,workerId:f.workerId,clipDuration:m,bpm:v,getFftLevels:x,uiState:T,onUpdateUiState:S,paramKey:ie},J.id)})]})})},Sv=({control:a,value:e,onChange:r,syncSettings:i,onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:g,workerId:m,generatorId:v,clipDuration:x,uiState:T,onUpdateUiState:S})=>{const[E,M]=R.useState(!1),D=`${v}.${a.id}`,j=!!T?.expandedParams?.[D],P=V=>{S&&S({expandedParams:{...T?.expandedParams||{},[D]:V}})},F=V=>{V.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:a.type,paramName:a.id,targetType:"generator",layerIndex:c,colIndex:f,min:a.min,max:a.max,step:a.step}))},_=typeof i[D]=="object"?i[D]:{syncMode:i[D]},L=_?.range||[a.min,a.max],I=V=>{o(D,{..._,range:V})};return d.jsxs("div",{className:`param-editor ${j?"expanded":""}`,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),style:{marginBottom:"8px"},children:[d.jsx("div",{className:"param-label-row",style:{display:"flex",alignItems:"center"},children:d.jsx("label",{draggable:!0,onDragStart:F,className:"param-label",style:{fontSize:"11px",color:"#aaa",cursor:"grab"},children:a.label})}),d.jsxs("div",{className:"control-row",style:{display:"grid",gridTemplateColumns:"20px 1fr 50px",gap:"5px",alignItems:"center"},children:[d.jsx("button",{className:`anim-toggle-btn ${j?"active":""}`,style:{visibility:E||j||_?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>P(!j),title:"Animate",children:""}),d.jsx("div",{className:"control-input-wrapper",children:a.type==="range"?d.jsx($m,{min:a.min,max:a.max,step:a.step,value:e,rangeValue:L,onChange:V=>r(a.id,V),onRangeChange:I,showRange:j,animSettings:_,progressRef:g,workerId:m,clipDuration:x}):a.type==="number"?d.jsx("input",{type:"number",value:e,onChange:V=>r(a.id,parseFloat(V.target.value)||0),className:"param-number-input",step:a.step}):a.type==="text"?d.jsx("input",{type:"text",value:e,onChange:V=>r(a.id,V.target.value),className:"param-text-input"}):a.type==="checkbox"?d.jsx("input",{type:"checkbox",checked:e,onChange:V=>r(a.id,V.target.checked),className:"param-checkbox"}):a.type==="select"?d.jsx("select",{value:e,onChange:V=>r(a.id,V.target.value),className:"param-select",style:{width:"100%",fontSize:"11px",background:"#333",color:"#fff",border:"1px solid #555"},children:a.options.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))}):null}),a.type==="range"&&d.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:V=>r(a.id,parseFloat(V.target.value)||0),className:"param-number-input",step:a.step,style:{width:"100%",fontSize:"10px"}})]}),j&&a.type==="range"&&d.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:d.jsx(Wm,{animSettings:_,onChange:V=>o(D,V)})})]})},Ev=({selectedGeneratorId:a,selectedGeneratorParams:e,onParameterChange:r,syncSettings:i={},onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:g,workerId:m,clipDuration:v,uiState:x,onUpdateUiState:T})=>{const[S,E]=R.useState([]),[M,D]=R.useState([]),[j,P]=R.useState(!1);if(!a)return d.jsx("div",{className:"generator-settings-panel",children:"No generator selected."});const F=Xf.find(V=>V.id===a);if(!F)return d.jsxs("div",{className:"generator-settings-panel",children:["Generator definition not found for ID: ",a]});const _=x?.collapsedPanels||{},L=V=>{T&&T({collapsedPanels:{..._,generator:V}})};R.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getProjectFonts)try{const $=await window.electronAPI.getProjectFonts();D($)}catch($){console.error("Failed to load project fonts:",$)}})()},[]);const I=async V=>{const $=V.target.value;if($==="browse")if(window.electronAPI&&window.electronAPI.showFontFileDialog){const J=await window.electronAPI.showFontFileDialog();J&&r("fontUrl",J)}else console.error("Font file dialog API not available.");else if($==="load-system"){P(!0);try{const ie=(await window.electronAPI.getSystemFonts()).map(oe=>({name:oe.split(/[\\/]/).pop(),path:oe})).sort((oe,U)=>oe.name.localeCompare(U.name));E(ie)}catch(J){console.error("Failed to load system fonts:",J)}P(!1)}else r("fontUrl",$)};return d.jsx(Kn,{title:`${F.name} Settings`,isCollapsed:!!_.generator,onToggle:L,children:F.paramControls.filter(V=>!V.condition||V.condition(e)).map(V=>{if(V.id==="fontUrl"){const $=e[V.id]||"src/fonts/Geometr415 Blk BT Black.ttf";return d.jsxs("div",{className:"param-editor",children:[d.jsx("label",{className:"param-label",children:V.label}),d.jsxs("div",{className:"font-selector-container",children:[d.jsxs("select",{className:"param-select",onChange:I,value:$,children:[M.length>0?d.jsx("optgroup",{label:"Project Fonts",children:M.map(J=>d.jsx("option",{value:J.path,children:J.name},J.path))}):d.jsx("optgroup",{label:"Default Fonts",children:d.jsx("option",{value:"src/fonts/Geometr415 Blk BT Black.ttf",children:"Geometr415"})}),S.length>0?d.jsx("optgroup",{label:"System Fonts",children:S.map(J=>d.jsx("option",{value:J.path,children:J.name},J.path))}):d.jsx("option",{value:"load-system",children:j?"Loading...":"Load System Fonts..."}),d.jsx("optgroup",{label:"Actions",children:d.jsx("option",{value:"browse",children:"Browse File..."})})]}),d.jsx("span",{className:"font-path-tiny",title:$,children:$.split(/[\\/]/).pop()})]})]},V.id)}return d.jsx(Sv,{control:V,value:e[V.id],onChange:r,syncSettings:i,onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:g,workerId:m,generatorId:a,clipDuration:v,uiState:x,onUpdateUiState:T},V.id)})})},wv=({settings:a,onUpdate:e,uiState:r,onUpdateUiState:i})=>{const{mode:o="fps",duration:c=1,beats:f=8,speedMultiplier:g=1,fps:m=60}=a||{},v=r?.collapsedPanels||{},x=E=>{i&&i({collapsedPanels:{...v,playback:E}})},T=E=>{e({mode:E})},S=(E,M,D=!1)=>{let j=a[E]||(E==="beats"?8:E==="fps"?60:1);D?j=M>1?j*2:j/2:j+=M,j<.01&&(j=.01),e({[E]:j})};return d.jsxs(Kn,{title:"Clip Playback",isCollapsed:!!v.playback,onToggle:x,children:[d.jsxs("div",{className:"playback-mode-selector",children:[d.jsx("button",{className:o==="fps"?"active":"button_inactive",onClick:()=>T("fps"),children:"FPS"}),d.jsx("button",{className:o==="timeline"?"active":"button_inactive",onClick:()=>T("timeline"),children:"Timeline"}),d.jsx("button",{className:o==="bpm"?"active":"button_inactive",onClick:()=>T("bpm"),children:"BPM Sync"})]}),d.jsxs("div",{className:"playback-controls",children:[o==="fps"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"control-group",children:[d.jsx("label",{children:"Speed (FPS)"}),d.jsxs("div",{className:"value-adjuster",children:[d.jsx("button",{onClick:()=>S("fps",-1),children:"-1"}),d.jsx("input",{type:"number",value:m,onChange:E=>e({fps:parseInt(E.target.value)||60})}),d.jsx("button",{onClick:()=>S("fps",1),children:"+1"}),d.jsx("button",{onClick:()=>S("fps",.5,!0),children:"/2"}),d.jsx("button",{onClick:()=>S("fps",2,!0),children:"*2"})]})]}),d.jsxs("div",{className:"control-group",children:[d.jsx("label",{children:"Duration (s) (for effects)"}),d.jsx("div",{className:"value-adjuster",children:d.jsx("input",{type:"number",value:c.toFixed(2),onChange:E=>e({duration:parseFloat(E.target.value)||1})})})]})]}),o==="timeline"&&d.jsxs("div",{className:"control-group",children:[d.jsx("label",{children:"Duration (s)"}),d.jsxs("div",{className:"value-adjuster",children:[d.jsx("button",{onClick:()=>S("duration",-1),children:"-1"}),d.jsx("input",{type:"number",value:c.toFixed(2),onChange:E=>e({duration:parseFloat(E.target.value)||1})}),d.jsx("button",{onClick:()=>S("duration",1),children:"+1"}),d.jsx("button",{onClick:()=>S("duration",.5,!0),children:"/2"}),d.jsx("button",{onClick:()=>S("duration",2,!0),children:"*2"})]})]}),o==="bpm"&&d.jsxs("div",{className:"control-group",children:[d.jsx("label",{children:"Beats"}),d.jsxs("div",{className:"value-adjuster",children:[d.jsx("button",{onClick:()=>S("beats",-1),children:"-1"}),d.jsx("input",{type:"number",value:f,onChange:E=>e({beats:parseInt(E.target.value)||1})}),d.jsx("button",{onClick:()=>S("beats",1),children:"+1"}),d.jsx("button",{onClick:()=>S("beats",.5,!0),children:"/2"}),d.jsx("button",{onClick:()=>S("beats",2,!0),children:"*2"})]})]}),(o==="timeline"||o==="bpm")&&d.jsxs("div",{className:"control-group",children:[d.jsx("label",{children:"Speed Multiplier"}),d.jsxs("div",{className:"value-adjuster",children:[d.jsx("button",{onClick:()=>S("speedMultiplier",-.1),children:"-0.1"}),d.jsx("input",{type:"number",value:g.toFixed(2),onChange:E=>e({speedMultiplier:parseFloat(E.target.value)||1})}),d.jsx("button",{onClick:()=>S("speedMultiplier",.1),children:"+0.1"})]})]})]})]})},Km=R.createContext(),uo=()=>R.useContext(Km),Av=({children:a})=>{const[e,r]=R.useState(null),[i,o]=R.useState(null),[c,f]=R.useState(null),[g,m]=R.useState({source:"external",lowRange:[20,250],midRange:[250,4e3],highRange:[4e3,2e4],gain:1,holdTime:100,fallTime:500,calculationMode:"average",smoothingTimeConstant:.8}),[v,x]=R.useState({low:0,mid:0,high:0}),T=R.useRef(new Uint8Array(0)),S=R.useRef({low:0,mid:0,high:0}),E=R.useRef({low:0,mid:0,high:0,lastUpdateTime:Date.now(),peakTimes:{low:0,mid:0,high:0}}),[M,D]=R.useState([]),[j,P]=R.useState("default"),[F,_]=R.useState(1),L=R.useRef({}),I=R.useRef({}),V=R.useRef({}),$=R.useCallback(async()=>{try{const _e=(await navigator.mediaDevices.enumerateDevices()).filter(Oe=>Oe.kind==="audiooutput");if(D(_e),window.electronAPI&&window.electronAPI.setAudioDevices){const Oe=_e.map(We=>({deviceId:We.deviceId,label:We.label,groupId:We.groupId}));window.electronAPI.setAudioDevices(Oe)}}catch(ve){console.error("Error enumerating audio devices:",ve)}},[]);R.useEffect(()=>{$();let ve;return window.electronAPI&&window.electronAPI.onUpdateAudioDeviceId&&(ve=window.electronAPI.onUpdateAudioDeviceId(_e=>{P(_e)})),navigator.mediaDevices.addEventListener("devicechange",$),()=>{navigator.mediaDevices.removeEventListener("devicechange",$),ve&&ve()}},[$]);const J=R.useCallback(ve=>{if(!e||!i)return null;try{const _e=e.createMediaElementSource(ve);return _e.connect(i),_e.connect(e.destination),_e}catch(_e){return console.warn("MediaElementSource already connected?",_e),null}},[e,i]),ie=R.useCallback(async(ve,_e,Oe=1,We=!0)=>{if(L.current[ve]&&(L.current[ve].pause(),L.current[ve].src=""),V.current[ve]=Oe,!_e)return;if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(_e))throw new Error(`Audio file not found: ${_e}`);const Ye=new Audio(`file:///${_e}`);if(Ye.volume=Oe*F,j&&Ye.setSinkId)try{await Ye.setSinkId(j)}catch(Je){console.error("Error setting audio sink ID:",Je)}if(L.current[ve]=Ye,e){e.state==="suspended"&&await e.resume();const Je=J(Ye);Je&&(I.current[ve]=Je)}if(We)try{await Ye.play()}catch(Je){throw console.error("Error playing audio:",Je),Je}return Ye},[j,J,F,e]),oe=R.useCallback(ve=>{_(ve),Object.keys(L.current).forEach(_e=>{const Oe=L.current[_e],We=V.current[_e]??1;Oe&&(Oe.volume=ve*We)})},[]),U=R.useCallback((ve,_e)=>{V.current[ve]=_e;const Oe=L.current[ve];Oe&&(Oe.volume=_e*F)},[F]),K=R.useCallback(ve=>{if(L.current[ve]&&(L.current[ve].pause(),L.current[ve].src="",delete L.current[ve],I.current[ve])){try{I.current[ve].disconnect()}catch{}delete I.current[ve]}},[]),Z=R.useCallback(ve=>{L.current[ve]&&L.current[ve].pause()},[]),W=R.useCallback(async ve=>{if(L.current[ve]&&L.current[ve].paused)try{await L.current[ve].play()}catch(_e){console.error("Error resuming:",_e)}},[]),re=R.useCallback(ve=>{const _e=Math.max(.0625,Math.min(ve,16));Object.values(L.current).forEach(Oe=>{try{Oe.playbackRate=_e}catch(We){console.warn("Failed to set playbackRate:",We)}})},[]),Y=R.useCallback(ve=>{L.current[ve]&&(L.current[ve].currentTime=0)},[]),ee=R.useCallback((ve,_e)=>{L.current[ve]&&(L.current[ve].currentTime=_e)},[]),ue=R.useCallback(()=>Object.keys(L.current).forEach(K),[K]),Ee=R.useCallback(()=>Object.keys(L.current).forEach(Z),[Z]),q=R.useCallback(()=>Object.keys(L.current).forEach(W),[W]),Q=R.useCallback(()=>Object.keys(L.current).forEach(Y),[Y]),be=R.useCallback(ve=>{const _e=L.current[ve];return _e?{currentTime:_e.currentTime,duration:_e.duration,paused:_e.paused}:null},[]),ke=R.useCallback(async()=>{if(e)return;const ve=new(window.AudioContext||window.webkitAudioContext),_e=ve.createAnalyser();_e.fftSize=2048,_e.smoothingTimeConstant=g.smoothingTimeConstant,T.current=new Uint8Array(_e.frequencyBinCount),ve.state==="suspended"&&await ve.resume(),r(ve),o(_e)},[e,g.smoothingTimeConstant]);return R.useEffect(()=>{const ve=()=>{ke(),window.removeEventListener("mousedown",ve),window.removeEventListener("keydown",ve)};return window.addEventListener("mousedown",ve),window.addEventListener("keydown",ve),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("keydown",ve)}},[ke]),R.useEffect(()=>{i&&(i.smoothingTimeConstant=g.smoothingTimeConstant)},[i,g.smoothingTimeConstant]),R.useEffect(()=>{if(!e||!i||g.source!=="external"){c&&(c.disconnect(),f(null));return}let ve=null;return(async()=>{try{e.state==="suspended"&&await e.resume(),ve=await navigator.mediaDevices.getUserMedia({audio:!0});const Oe=e.createMediaStreamSource(ve);Oe.connect(i),f(Oe)}catch(Oe){console.error("Failed to get external audio stream:",Oe)}})(),()=>{ve&&ve.getTracks().forEach(Oe=>Oe.stop())}},[e,i,g.source]),R.useEffect(()=>{if(!i)return;let ve;const _e=()=>{i.getByteFrequencyData(T.current);const Oe=e.sampleRate,We=i.frequencyBinCount,Ye=Oe/i.fftSize,Je=Ie=>{const nt=Math.floor(Ie[0]/Ye),Ue=Math.floor(Ie[1]/Ye);if(g.calculationMode==="peak"){let xe=0;for(let Ze=nt;Ze<=Ue&&Ze<We;Ze++)T.current[Ze]>xe&&(xe=T.current[Ze]);return xe/255}else{let xe=0,Ze=0;for(let Zt=nt;Zt<=Ue&&Zt<We;Zt++)xe+=T.current[Zt],Ze++;return Ze>0?xe/Ze/255:0}},yn=Je(g.lowRange),_t=Je(g.midRange),vn=Je(g.highRange),Wt=Date.now(),Kt=Math.max(0,Wt-E.current.lastUpdateTime);E.current.lastUpdateTime=Wt;const je=(Ie,nt)=>{let Ue=Ie*g.gain;const xe=E.current[nt],Ze=E.current.peakTimes[nt]||0;if(Ue>=xe)return E.current.peakTimes[nt]=Wt,Ue;{if(Wt-Ze<g.holdTime)return xe;if(g.fallTime<=0)return 0;const fn=Kt/g.fallTime,Et=xe-fn;return Math.max(0,isNaN(Et)?0:Et)}},$e={low:je(yn,"low"),mid:je(_t,"mid"),high:je(vn,"high")};S.current=$e,E.current={...$e,lastUpdateTime:Wt,peakTimes:E.current.peakTimes},ve=requestAnimationFrame(_e)};return _e(),()=>cancelAnimationFrame(ve)},[e,i,g]),d.jsx(Km.Provider,{value:{audioCtx:e,analyser:i,fftSettings:g,setFftSettings:m,fftLevels:S.current,fftLevelsRef:S,getFftLevels:()=>S.current,connectMediaElement:J,initAudio:ke,devices:M,selectedDeviceId:j,setSelectedDeviceId:P,globalVolume:F,setVolume:oe,setClipVolume:U,playAudio:ie,stopAudio:K,pauseAudio:Z,resumeAudio:W,setPlaybackRate:re,resetAudio:Y,seekAudio:ee,stopAllAudio:ue,pauseAllAudio:Ee,resumeAllAudio:q,resetAllAudio:Q,getAudioInfo:be},children:a})},Tv=({audioFile:a,layerIndex:e,onSeek:r,onLoadError:i})=>{const o=R.useRef(null),c=R.useRef(null),{audioCtx:f,getAudioInfo:g}=uo(),[m,v]=R.useState(null),[x,T]=R.useState("rgb(255, 94, 0)"),S=R.useRef(null),E=R.useRef(!1),M=R.useRef([]),D=R.useRef(null),j=R.useCallback(()=>{const I=document.createElement("div");I.style.display="none",I.style.color="var(--theme-color)",document.body.appendChild(I);const V=getComputedStyle(I).color;document.body.removeChild(I),V&&V!=="rgba(0, 0, 0, 0)"&&T(V)},[]);R.useEffect(()=>{j();const I=new MutationObserver(j);return I.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class"]}),()=>I.disconnect()},[j]),R.useEffect(()=>{if(!a?.path||!f)return;let I=!0;const V=async()=>{try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(a.path))throw new Error(`File not found: ${a.path}`);const $=await fetch(`file:///${a.path}`);if(!$.ok)throw new Error(`HTTP error! status: ${$.status}`);const J=await $.arrayBuffer();if(!I)return;const ie=await f.decodeAudioData(J);if(I){const oe=ie.getChannelData(0),U=[],K=Math.max(1,Math.floor(oe.length/500));for(let Z=0;Z<oe.length;Z+=K){let W=1,re=-1;for(let Y=0;Y<K&&Z+Y<oe.length;Y++){const ee=oe[Z+Y];ee<W&&(W=ee),ee>re&&(re=ee)}U.push({min:W,max:re})}M.current=U,D.current=null,v(ie)}}catch($){if(!I)return;console.error("Failed to load/decode audio for waveform:",$),i&&i($)}};return v(null),V(),()=>{I=!1}},[a,f,i]);const P=R.useCallback((I,V,$,J)=>{const ie=M.current;if(!ie||ie.length===0)return;const oe=$/2,U=2,Z=U+1;if(!D.current||D.current.width!==V||D.current.height!==$){const re=document.createElement("canvas");re.width=V,re.height=$;const Y=re.getContext("2d");let ee=x;x.startsWith("rgb(")&&(ee=x.replace("rgb","rgba").replace(")",", 0.2)")),Y.fillStyle=ee;const ue=Math.ceil(V/Z);for(let Ee=0;Ee<ue;Ee++){const q=Math.floor(Ee/ue*ie.length),Q=ie[q],be=(1+Q.min)*oe,ke=Math.max(1,(Q.max-Q.min)*oe);Y.fillRect(Ee*Z,be,U,ke)}D.current=re}I.clearRect(0,0,V,$),I.drawImage(D.current,0,0);const W=V*J;if(W>0){I.save(),I.beginPath(),I.rect(0,0,W,$),I.clip(),I.fillStyle=x;const re=Math.ceil(V/Z);for(let Y=0;Y<re;Y++){const ee=Y*Z;if(ee>W)break;const ue=Math.floor(Y/re*ie.length),Ee=ie[ue],q=(1+Ee.min)*oe,Q=Math.max(1,(Ee.max-Ee.min)*oe);I.fillRect(ee,q,U,Q)}I.restore()}I.fillStyle="#ffffff",I.fillRect(W,0,1,$)},[x]);R.useEffect(()=>{const I=o.current;if(!I||!m)return;const V=I.getContext("2d"),$=()=>{const J=I.getBoundingClientRect();(I.width!==J.width||I.height!==J.height)&&(I.width=J.width,I.height=J.height,D.current=null);const ie=I.width,oe=I.height;let U=0;if(e!=null){const K=g(e);K&&K.duration>0&&(U=K.currentTime/K.duration)}P(V,ie,oe,Math.max(0,Math.min(1,U))),S.current=requestAnimationFrame($)};return $(),()=>{S.current&&cancelAnimationFrame(S.current)}},[m,e,g,P]);const F=I=>{E.current=!0,L(I),window.addEventListener("mouseup",_),window.addEventListener("mousemove",L)},_=()=>{E.current=!1,window.removeEventListener("mouseup",_),window.removeEventListener("mousemove",L)},L=I=>{if(!o.current||!m)return;const V=o.current.getBoundingClientRect(),$=I.clientX-V.left,J=V.width,oe=Math.max(0,Math.min(1,$/J))*m.duration;r&&r(oe)};return d.jsx("div",{ref:c,className:"wave-player-container",style:{width:"100%",height:"35px",marginBottom:"10px",background:"transparent",borderRadius:"4px",overflow:"hidden"},onMouseDown:F,children:d.jsx("canvas",{ref:o,style:{width:"100%",height:"100%",display:"block",cursor:"pointer"}})})},Cv=({selectedLayerIndex:a,selectedColIndex:e,clip:r,audioInfo:i,bpm:o,getFftLevels:c,onAssignAudio:f,onRemoveAudio:g,onUpdateAudioVolume:m,onUpdatePlaybackSettings:v,onSetParamSync:x,onToggleDacMirror:T,onRemoveDac:S,onRemoveEffect:E,onReorderEffects:M,onAddEffect:D,onParameterChange:j,onGeneratorParameterChange:P,onUpdateClipUiState:F,progressRef:_,onAudioError:L})=>{const[I,V]=R.useState({}),[$,J]=R.useState(null),{seekAudio:ie}=uo(),oe=R.useRef(0),U=r?.uiState||{},K=U.collapsedPanels||{},Z=(je,$e)=>{F&&F(a,e,{collapsedPanels:{...K,[je]:$e}})},W=Yn.useCallback(je=>{L&&L(a,e)},[L,a,e]);if(R.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus($e=>{V(Ie=>({...Ie,[$e.ip]:$e.status}))})},[]),a===null||e===null)return d.jsx("div",{className:"clip-settings-panel settings-panel-base",children:d.jsx("p",{className:"info-text",children:"Select a clip to view settings."})});const re=je=>{je.preventDefault(),je.stopPropagation();try{const $e=je.dataTransfer.getData("application/json");if(!$e)return;const Ie=JSON.parse($e);Ie&&Ie.type&&D&&D(Ie)}catch($e){console.error("Failed to drop effect in ClipSettingsPanel:",$e)}},Y=je=>{je.preventDefault(),je.dataTransfer.dropEffect="copy"},ee=je=>{J(je)},ue=(je,$e)=>{if(je.preventDefault(),$===null||$===$e)return;const Ie=Date.now();Ie-oe.current<200||(oe.current=Ie,M&&(M(a,e,$,$e),J($e)))},Ee=je=>{J(null)},{effects:q=[],assignedDacs:Q=[],playbackSettings:be={},syncSettings:ke={},audioFile:ve=null,audioVolume:_e=1,type:Oe=null,generatorDefinition:We=null,currentParams:Ye={},workerId:Je=null}=r||{},yn=q.length>0,_t=Oe==="generator"&&!!We,vn=Q.length>0;let Wt=1;if(be.mode==="timeline")Wt=be.duration||1;else if(be.mode==="bpm"){const je=o||120;Wt=(be.beats||8)*60/je}else{const je=be.fps||r?.fps||30;Wt=(r?.totalFrames||30)/je}const Kt=Je||(Oe==="ilda"?`ilda-${a}-${e}`:Oe==="generator"?`generator-${a}-${e}`:null);return i&&i.duration&&i.currentTime/i.duration*100,d.jsxs("div",{className:"clip-settings-panel settings-panel-base",onDrop:re,onDragOver:Y,children:[d.jsx(Kn,{title:"Audio",isCollapsed:!!K.audio,onToggle:je=>Z("audio",je),children:ve?d.jsxs("div",{className:"assigned-audio-info",style:{position:"relative"},children:[d.jsx("button",{className:"remove-effect-btn",onClick:g,style:{position:"absolute",top:"-5px",right:"-5px",fontSize:"14px"},children:""}),d.jsx("div",{className:"audio-file-name",title:ve.path,style:{paddingRight:"15px",marginBottom:"8px",fontSize:"11px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:ve.name}),d.jsx(Tv,{audioFile:ve,audioInfo:i,layerIndex:a,onSeek:je=>ie(a,je),onLoadError:W}),d.jsxs("div",{className:"audio-volume-control",style:{marginTop:"10px"},children:[d.jsxs("label",{style:{fontSize:"10px",display:"block",marginBottom:"2px"},children:["Volume: ",Math.round(_e*100),"%"]}),d.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:_e,onChange:je=>m(a,e,parseFloat(je.target.value)),className:"slider_hor",style:{width:"100%",height:"4px"}})]})]}):d.jsx("button",{className:"assign-audio-btn",onClick:f,children:"Assign Audio File"})}),d.jsx(wv,{settings:be,onUpdate:je=>v(a,e,je),uiState:U,onUpdateUiState:je=>F(a,e,je)}),vn&&d.jsx(Kn,{title:"Assigned DACs",isCollapsed:!!K.dacs,onToggle:je=>Z("dacs",je),children:d.jsx("ul",{className:"assigned-dacs-list",children:Q.map((je,$e)=>{const Ie=I[je.ip];return d.jsxs("li",{className:"assigned-dac-item",children:[d.jsxs("div",{className:"dac-info-block",children:[d.jsxs("span",{className:"dac-name-tiny",children:[je.hostName||je.ip," - Ch ",je.channel]}),Ie&&d.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",Ie.playback_state===2?"PLAYING":Ie.playback_state===1?"PREPARED":"IDLE"," | Buf: ",Ie.buffer_fullness,Ie.buffer_capacity?`/${Ie.buffer_capacity}`:""," | PPS: ",Ie.point_rate]})]}),d.jsxs("div",{className:"dac-mirror-controls",children:[d.jsx("button",{className:`mirror-btn ${je.mirrorX?"active":""}`,onClick:()=>T(a,e,$e,"x"),title:"Mirror X Axis",children:"X"}),d.jsx("button",{className:`mirror-btn ${je.mirrorY?"active":""}`,onClick:()=>T(a,e,$e,"y"),title:"Mirror Y Axis",children:"Y"})]}),d.jsx("button",{className:"remove-dac-btn",onClick:()=>S($e),children:""})]},`${je.unitID||je.ip}-${je.channel}-${$e}`)})})}),_t&&d.jsx(Ev,{selectedGeneratorId:We.id,selectedGeneratorParams:Ye,onParameterChange:P,syncSettings:ke,onSetParamSync:x,layerIndex:a,colIndex:e,progressRef:_,workerId:Kt,clipDuration:Wt,bpm:o,getFftLevels:c,uiState:U,onUpdateUiState:je=>F(a,e,je)}),d.jsx(Kn,{title:"Clip Effects",isCollapsed:!!K.effects,onToggle:je=>Z("effects",je),children:d.jsx("div",{className:"clip-effects-list",style:{minHeight:"50px"},onDrop:Ee,children:yn?q.map((je,$e)=>d.jsx("div",{onDragOver:Ie=>ue(Ie,$e),style:{marginBottom:"4px"},children:d.jsx(Qm,{effect:je,assignedDacs:Q,syncSettings:ke,onSetParamSync:x,context:{layerIndex:a,colIndex:e,effectIndex:$e,targetType:"effect",workerId:Kt},onParamChange:(Ie,nt)=>j(a,e,$e,Ie,nt),onRemove:()=>E(a,e,$e),progressRef:_,clipDuration:Wt,bpm:o,getFftLevels:c,uiState:U,onUpdateUiState:Ie=>F(a,e,Ie),dragHandle:d.jsx("div",{draggable:!0,onDragStart:()=>ee($e),style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},je.instanceId||je.id+$e)):d.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Mv=({selectedLayerIndex:a,autopilotMode:e,onAutopilotChange:r,layerEffects:i,assignedDacs:o=[],onToggleDacMirror:c,onRemoveDac:f,onAddEffect:g,onRemoveEffect:m,onParamChange:v,uiState:x,onUpdateUiState:T})=>{const[S,E]=R.useState({}),M=x?.collapsedPanels||{},D=(F,_)=>{T&&T({collapsedPanels:{...M,[F]:_}})};if(R.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(_=>{E(L=>({...L,[_.ip]:_.status}))})},[]),a===null)return d.jsx("div",{className:"settings-panel-base",children:d.jsx("p",{className:"info-text",children:"Select a layer to edit settings"})});const j=F=>{F.preventDefault(),F.stopPropagation();try{const _=JSON.parse(F.dataTransfer.getData("application/json"));_&&_.id&&g(_)}catch(_){console.error("Failed to drop effect:",_)}},P=F=>{F.preventDefault(),F.dataTransfer.dropEffect="copy"};return d.jsxs("div",{className:"settings-panel-base",onDrop:j,onDragOver:P,children:[o&&o.length>0&&d.jsx(Kn,{title:"Assigned DACs",isCollapsed:!!M.dacs,onToggle:F=>D("dacs",F),children:d.jsx("ul",{className:"assigned-dacs-list",children:o.map((F,_)=>{const L=S[F.ip];return d.jsxs("li",{className:"assigned-dac-item",children:[d.jsxs("div",{className:"dac-info-block",children:[d.jsxs("span",{className:"dac-name-tiny",children:[F.hostName||F.ip," - Ch ",F.channel]}),L&&d.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",L.playback_state===2?"PLAYING":L.playback_state===1?"PREPARED":"IDLE"," | Buf: ",L.buffer_fullness,L.buffer_capacity?`/${L.buffer_capacity}`:""," | PPS: ",L.point_rate]})]}),d.jsxs("div",{className:"dac-mirror-controls",children:[d.jsx("button",{className:`mirror-btn ${F.mirrorX?"active":""}`,onClick:()=>c(a,_,"x"),title:"Mirror X Axis",children:"X"}),d.jsx("button",{className:`mirror-btn ${F.mirrorY?"active":""}`,onClick:()=>c(a,_,"y"),title:"Mirror Y Axis",children:"Y"})]}),d.jsx("button",{className:"remove-dac-btn",onClick:()=>f(a,_),children:""})]},`${F.unitID||F.ip}-${F.channel}-${_}`)})})}),d.jsx(Kn,{title:`Layer ${a+1} Autopilot`,isCollapsed:!!M.autopilot,onToggle:F=>D("autopilot",F),children:d.jsxs("div",{className:"param-editor",children:[d.jsx("label",{children:"Mode"}),d.jsx("div",{className:"clip-playback-settings",children:d.jsxs("div",{className:"playback-mode-selector",children:[d.jsx("button",{className:e==="off"?"active":"",onClick:()=>r("off"),children:"OFF"}),d.jsx("button",{className:e==="forward"?"active":"",onClick:()=>r("forward"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-forward-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"m9.77 12.11 4.012-2.953a.647.647 0 0 0 0-1.114L9.771 5.09a.644.644 0 0 0-.971.557V6.65H2v3.9h6.8v1.003c0 .505.545.808.97.557"})})}),d.jsx("button",{className:e==="random"?"active":"",onClick:()=>r("random"),children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[d.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),d.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})})]})})]})}),d.jsx(Kn,{title:"Layer Effects",isCollapsed:!!M.effects,onToggle:F=>D("effects",F),children:d.jsx("div",{className:"layer-effects-list",style:{minHeight:"50px"},children:i&&i.length>0?i.map((F,_)=>d.jsx("div",{style:{marginBottom:"4px"},children:d.jsx(Qm,{effect:F,onRemove:()=>m(_),onParamChange:(L,I)=>v(_,L,I),syncSettings:{},onSetParamSync:()=>{},context:{layerIndex:a,colIndex:null,effectIndex:_,targetType:"layerEffect"},uiState:x,onUpdateUiState:T,dragHandle:d.jsx("div",{draggable:!0,onDragStart:L=>{L.dataTransfer.setData("application/json",JSON.stringify({type:"effect-reorder",index:_,layerIndex:a}))},style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},F.instanceId||_)):d.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Nv=({message:a,visible:e})=>e?d.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#333",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:1e3,opacity:e?1:0,transition:"opacity 0.5s ease-in-out"},children:a}):null,Jm=R.createContext(null),eg=()=>R.useContext(Jm),kv=({children:a,onWorkerMessage:e})=>{const r=R.useRef(null);return r.current===null&&(r.current=new Worker(new URL(""+new URL("rendering.worker-BUTWRsDN.js",import.meta.url).href,import.meta.url),{type:"module"})),R.useEffect(()=>{const i=r.current;return e&&(i.onmessage=e),()=>{i.terminate(),e&&(i.onmessage=null)}},[e]),d.jsx(Jm.Provider,{value:r.current,children:a})},Rv=({frame:a,effects:e,showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:g,syncSettings:m={},bpm:v=120,clipDuration:x=1,progress:T=0,previewTime:S=0,fftLevels:E={low:0,mid:0,high:0},effectStates:M=null,optimizationEnabled:D=!0,onToggleBeamEffect:j,onCycleDisplayMode:P})=>{const F=R.useRef(null),_=eg(),L=R.useRef(`ilda-player-${Math.random()}`);return R.useEffect(()=>{const I=F.current;if(!I||!_)return;const V=I.transferControlToOffscreen();return _.postMessage({action:"register",payload:{id:L.current,canvas:V,type:"single",data:{showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:g,syncSettings:m,bpm:v,clipDuration:x,progress:T,previewTime:S,fftLevels:E,effectStates:M,optimizationEnabled:D}}},[V]),()=>{_.postMessage({action:"deregister",payload:{id:L.current}})}},[]),R.useEffect(()=>{if(!_)return;const I=a?[a]:[];_.postMessage({action:"update",payload:{id:L.current,data:{ildaFrames:I,effects:e,showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:g,syncSettings:m,bpm:v,clipDuration:x,progress:T,previewTime:S,fftLevels:E,effectStates:M,optimizationEnabled:D}}})},[_,a,e,r,i,o,c,f,g,m,v,x,T,S,E,M,D]),d.jsxs("div",{className:"ilda-player",children:[d.jsx("h3",{children:"Selected Preview"}),d.jsxs("div",{className:"renderSettingToggle",children:[d.jsx("button",{onClick:j,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),d.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),d.jsx("button",{onClick:P,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),d.jsx("canvas",{ref:F,width:"300",height:"300",style:{backgroundColor:"black"}})]})},Dv=Yn.memo(Rv),_v=({activeFrames:a,showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,layerIntensities:f,masterIntensity:g,dacSettings:m,previewTime:v=0,fftLevels:x={low:0,mid:0,high:0},optimizationEnabled:T=!0,onToggleBeamEffect:S,onCycleDisplayMode:E})=>{const M=R.useRef(null),D=eg(),j=R.useRef(`world-preview-${Math.random()}`);return R.useEffect(()=>{const P=M.current;if(!P||!D)return;const F=P.transferControlToOffscreen();return D.postMessage({action:"register",payload:{id:j.current,canvas:F,type:"world",data:{showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,previewTime:v,fftLevels:x,optimizationEnabled:T}}},[F]),()=>{D.postMessage({action:"deregister",payload:{id:j.current}})}},[]),R.useEffect(()=>{if(!D)return;const P=Object.entries(a).map(([F,{frame:_,effects:L,layerIndex:I,syncSettings:V,bpm:$,clipDuration:J,progress:ie,effectStates:oe}])=>({frames:[_],effects:L,workerId:F,layerIndex:I,syncSettings:V,bpm:$,clipDuration:J,progress:ie,effectStates:oe}));D.postMessage({action:"update",payload:{id:j.current,data:{worldData:P,showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,layerIntensities:f,masterIntensity:g,dacSettings:m,previewTime:v,fftLevels:x,optimizationEnabled:T}}})},[D,a,e,r,i,o,c,f,g,m,v,x,T]),d.jsxs("div",{className:"world-preview",children:[d.jsx("h3",{children:"World Preview"}),d.jsxs("div",{className:"renderSettingToggle",children:[d.jsx("button",{onClick:S,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),d.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),d.jsx("button",{onClick:E,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),d.jsx("canvas",{ref:M,width:"300",height:"300",style:{backgroundColor:"black"}})]})},Ov=({bpm:a,onBpmChange:e})=>{const[r,i]=R.useState([]),[o,c]=R.useState(a);R.useEffect(()=>{c(a)},[a]);const f=()=>{const m=Date.now(),v=[...r,m].slice(-4);if(i(v),v.length>=2){const x=[];for(let E=1;E<v.length;E++)x.push(v[E]-v[E-1]);const T=x.reduce((E,M)=>E+M)/x.length,S=Math.round(6e4/T);e(S)}},g=m=>{const v=parseFloat(m.target.value);c(m.target.value),!isNaN(v)&&v>0&&v<999&&e(v)};return d.jsx("div",{className:"bpm-controls",children:d.jsxs("div",{className:"bpm-display",children:[d.jsx($t,{id:"bpm_tap",children:d.jsx("button",{className:"bpm-tap-btn",onClick:f,children:"TAP"})}),d.jsxs("div",{className:"bpm-fine-controls",children:[d.jsx($t,{id:"bpm_fine_down",children:d.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.max(1,a-.1)),children:"-"})}),d.jsx($t,{id:"bpm_value",children:d.jsx("input",{type:"number",className:"bpm-input",value:o,onChange:g,min:"1",max:"999",step:"0.1"})}),d.jsx($t,{id:"bpm_fine_up",children:d.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.min(999,a+.1)),children:"+"})})]}),d.jsx("span",{className:"bpm-label",children:"BPM"})]})})},Iv=({onPlay:a,onPause:e,onStop:r,isPlaying:i,isStopped:o})=>{const c=(f,g)=>{f.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:g,targetType:"transport",label:g.toUpperCase()}))};return d.jsxs("div",{className:"transport-controls",children:[d.jsx($t,{id:"transport_play",children:d.jsx("button",{className:`speed-control-button ${i?"active":""}`,onClick:a,draggable:!0,onDragStart:f=>c(f,"play"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-play-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"})})})}),d.jsx($t,{id:"transport_pause",children:d.jsx("button",{className:`speed-control-button ${!i&&!o?"active":""}`,onClick:e,draggable:!0,onDragStart:f=>c(f,"pause"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pause-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"})})})}),d.jsx($t,{id:"transport_stop",children:d.jsx("button",{className:`speed-control-button ${o?"active":""}`,onClick:r,draggable:!0,onDragStart:f=>c(f,"stop"),children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-stop-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5"})})})})]})},Lv=({value:a,onToggle:e,label:r,onDrop:i,isAssigned:o,onContextMenu:c,className:f,...g})=>{const m=x=>{x.preventDefault(),x.dataTransfer.dropEffect="link"},v=x=>{x.preventDefault();try{const T=x.dataTransfer.getData("application/x-truelazer-param");console.log("[QuickButton] Dropped Data Raw:",T);const S=JSON.parse(T);console.log("[QuickButton] Dropped Data Parsed:",S),S&&(S.type==="toggle"||S.type==="checkbox")?i(S):console.warn("[QuickButton] Invalid data type for button:",S?.type)}catch(T){console.error("[QuickButton] Drop Error:",T)}};return d.jsx("div",{className:`quick-assign-button ${a?"active":""} ${o?"":"unassigned"} ${f||""}`.trim(),style:{cursor:o?"pointer":"default",userSelect:"none",width:"90%",opacity:o?1:.5},onDragOver:m,onDrop:v,onContextMenu:c,...g,onClick:o?e:x=>x.preventDefault(),children:d.jsx("div",{className:"button-label",title:r||"Empty",children:r||"Assign"})})},Uv=({assigns:a,onUpdateKnob:e,onToggleButton:r,onAssign:i})=>{const o=(c,f,g)=>{c.preventDefault(),window.electronAPI&&window.electronAPI.showQuickAssignContextMenu&&window.electronAPI.showQuickAssignContextMenu(f,g)};return d.jsxs("div",{className:"global-quick-assigns-panel",children:[d.jsx("div",{className:"quick-assigns-row knobs-row",children:Array.from({length:8}).map((c,f)=>{const g=!!a.knobs[f].link;return d.jsx($t,{id:`quick_knob_${f}`,children:d.jsx(yi,{value:a.knobs[f]?.value||0,label:a.knobs[f]?.label,isAssigned:g,onChange:m=>g&&e(f,m),onContextMenu:m=>o(m,"knob",f),onDrop:m=>{console.log(`[GlobalQuickAssigns] Knob ${f} Drop Data:`,m),i("knob",f,m)}})},`knob-${f}`)})}),d.jsx("div",{className:"quick-assigns-row buttons-row",children:Array.from({length:8}).map((c,f)=>{const g=!!a.buttons[f].link;return d.jsx($t,{id:`quick_btn_${f}`,children:d.jsx(Lv,{value:a.buttons[f]?.value||!1,label:a.buttons[f]?.label,isAssigned:g,onToggle:()=>r(f),onContextMenu:m=>o(m,"button",f),onDrop:m=>{console.log(`[GlobalQuickAssigns] Button ${f} Drop Data:`,m),i("button",f,m)}})},`btn-${f}`)})})]})},jv=({enabledShortcuts:a={},onOpenOutputSettings:e,quickAssigns:r,onUpdateKnob:i,onToggleButton:o,onAssign:c,renderSettings:f={},onSetRenderSetting:g})=>{const{midiInitialized:m,midiInputs:v,selectedMidiInputId:x,setSelectedMidiInputId:T,isMapping:S,startMapping:E,stopMapping:M,learningId:D,lastMidiEvent:j,setMappings:P,saveMappings:F,exportMappings:_,importMappings:L}=Oc(),I=f.settingsPanelCollapsed||{},V=(Ze,Zt)=>{g&&g("settingsPanelCollapsed",{...I,[Ze]:Zt})},{artnetInitialized:$,isMapping:J,startMapping:ie,stopMapping:oe,setMappings:U,saveMappings:K,exportMappings:Z,importMappings:W,lastDmxEvent:re}=sd()||{},{isMapping:Y,startMapping:ee,stopMapping:ue,setMappings:Ee,saveMappings:q,exportMappings:Q,importMappings:be}=id()||{},[ke,ve]=R.useState([]),[_e,Oe]=R.useState(""),[We,Ye]=R.useState(!1),[Je,yn]=R.useState(57121),[_t,vn]=R.useState("127.0.0.1"),[Wt,Kt]=R.useState(57120),[je,$e]=R.useState(null);R.useEffect(()=>{const Ze=async()=>{if(a.artnet)try{const Et=await window.electronAPI.getArtnetUniverses();ve(Et),Et.length>0&&Oe(Et[0].id)}catch(Et){console.error("Failed to fetch Art-Net universes:",Et)}},Zt=async()=>{if(a.osc)try{if((await window.electronAPI.initializeOsc({localPort:Je,remoteAddress:_t,remotePort:Wt})).success)return Ye(!0),window.electronAPI.onOscMessageReceived(({oscMessage:qn})=>{$e(qn)})}catch(Et){console.error("Failed to initialize OSC:",Et)}};let fn=()=>{};return Ze(),Zt().then(Et=>{typeof Et=="function"&&(fn=Et)}),()=>{typeof fn=="function"&&fn()}},[a]);const Ie=Ze=>T(Ze.target.value),nt=()=>S?M():E(),Ue=()=>J?oe():ie(),xe=()=>Y?ue():ee();return d.jsxs("div",{className:"settings-panel settings-panel-base",children:[d.jsx("div",{className:"settings-card-header",children:d.jsx("h4",{children:"Global Settings"})}),r&&d.jsx(Kn,{title:"Quick Assigns",isCollapsed:!!I.quickAssigns,onToggle:Ze=>V("quickAssigns",Ze),children:d.jsx(Uv,{assigns:r,onUpdateKnob:i,onToggleButton:o,onAssign:c})}),d.jsxs(Kn,{title:"Channel/DAC Settings",isCollapsed:!!I.dacSettings,onToggle:Ze=>V("dacSettings",Ze),children:[d.jsx("p",{className:"info-text",children:"Output routing and safety zones configuration."}),d.jsx("button",{className:"small-btn",style:{width:"100%",marginTop:"5px"},onClick:e,children:"Open Output Settings"})]}),d.jsxs(Kn,{title:"Processing",isCollapsed:!!I.processing,onToggle:Ze=>V("processing",Ze),children:[d.jsxs("div",{className:"param-editor",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[d.jsx("label",{className:"param-label",style:{fontSize:"11px"},children:"Point Optimization"}),d.jsx("input",{type:"checkbox",checked:f.optimizationEnabled,onChange:Ze=>g("optimizationEnabled",Ze.target.checked)})]}),d.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:"Optimizes geometry (interpolation/dwell) before applying effects. Fixes lines in Delay effect but increases point count."})]}),(a.midi||a.artnet||a.osc||a.keyboard)&&d.jsxs("div",{className:"shortcuts-settings-panel",children:[a.keyboard&&d.jsx(Kn,{title:"Keyboard Shortcuts",isCollapsed:!!I.keyboard,onToggle:Ze=>V("keyboard",Ze),children:d.jsxs("div",{className:"keyboard-config",children:[d.jsxs("div",{className:"button-grid",children:[d.jsx("button",{className:`mapping-btn ${Y?"active":""}`,onClick:xe,style:{backgroundColor:Y?"var(--theme-color)":"",gridColumn:"span 2"},children:Y?"Stop Mapping":"Start Mapping"}),d.jsx("button",{className:"small-btn",onClick:q,children:"Save Default"}),d.jsx("button",{className:"small-btn",onClick:Q,children:"Export"}),d.jsx("button",{className:"small-btn",onClick:be,children:"Import"}),d.jsx("button",{className:"small-btn clear",onClick:()=>Ee({}),children:"Clear"})]}),d.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:'Assign keys to buttons/sliders by activating "Start Mapping" and clicking a control.'})]})}),a.midi&&d.jsx(Kn,{title:"MIDI Shortcuts",isCollapsed:!!I.midi,onToggle:Ze=>V("midi",Ze),children:m?d.jsxs("div",{className:"midi-config",children:[d.jsx("select",{className:"param-select",value:x,onChange:Ie,style:{marginBottom:"8px",width:"100%"},children:v.map(Ze=>d.jsx("option",{value:Ze.id,children:Ze.name},Ze.id))}),d.jsxs("div",{className:"button-grid",children:[d.jsx("button",{className:`mapping-btn ${S?"active":""}`,onClick:nt,style:{backgroundColor:S?"var(--theme-color)":"",gridColumn:"span 2"},children:S?"Stop Mapping":"Start Mapping"}),d.jsx("button",{className:"small-btn",onClick:F,children:"Save Default"}),d.jsx("button",{className:"small-btn",onClick:_,children:"Export"}),d.jsx("button",{className:"small-btn",onClick:L,children:"Import"}),d.jsx("button",{className:"small-btn clear",onClick:()=>P({}),children:"Clear"})]}),j&&d.jsxs("div",{className:"last-event-status",children:[j.type," ",j.note||j.controller," (CH",j.channel,")"]})]}):d.jsx("p",{className:"loading-text",children:"Initializing MIDI..."})}),a.artnet&&d.jsx(Kn,{title:"ArtNet Shortcuts",isCollapsed:!!I.artnet,onToggle:Ze=>V("artnet",Ze),children:$?d.jsxs("div",{className:"artnet-config",children:[d.jsx("select",{className:"param-select",value:_e,onChange:Ze=>{Oe(Ze.target.value);const Zt=parseInt(Ze.target.value.replace("universe-",""));window.electronAPI&&window.electronAPI.listenArtnetUniverse&&window.electronAPI.listenArtnetUniverse(Zt)},style:{marginBottom:"8px",width:"100%"},children:ke.map(Ze=>d.jsx("option",{value:Ze.id,children:Ze.name},Ze.id))}),d.jsxs("div",{className:"button-grid",children:[d.jsx("button",{className:`mapping-btn ${J?"active":""}`,onClick:Ue,style:{backgroundColor:J?"var(--theme-color)":"",gridColumn:"span 2"},children:J?"Stop Mapping":"Start Mapping"}),d.jsx("button",{className:"small-btn",onClick:K,children:"Save Default"}),d.jsx("button",{className:"small-btn",onClick:Z,children:"Export"}),d.jsx("button",{className:"small-btn",onClick:W,children:"Import"}),d.jsx("button",{className:"small-btn clear",onClick:()=>U({}),children:"Clear"})]}),re&&d.jsxs("div",{className:"last-event-status",children:["UNIV ",re.universe," CH ",re.channel+1," (Val: ",re.value,")"]})]}):d.jsx("p",{className:"loading-text",children:"Initializing Art-Net..."})}),a.osc&&d.jsx(Kn,{title:"OSC Shortcuts",isCollapsed:!!I.osc,onToggle:Ze=>V("osc",Ze),children:d.jsx("div",{className:"osc-config",children:d.jsxs("p",{className:"info-text",children:["Listening on port: ",Je]})})})]})]})},Bv=({show:a,title:e,initialValue:r,onSave:i,onClose:o})=>{const[c,f]=R.useState(r||"");if(R.useEffect(()=>{a&&f(r||"")},[a,r]),!a)return null;const g=()=>{i(c),o()},m=v=>{v.key==="Enter"&&g(),v.key==="Escape"&&o()};return d.jsx("div",{className:"shortcuts-modal-overlay",style:{pointerEvents:"auto"},children:d.jsxs("div",{className:"shortcuts-modal-content",style:{maxWidth:"400px"},children:[d.jsx("h3",{children:e||"Rename"}),d.jsxs("div",{className:"settings-section",style:{border:"none"},children:[d.jsx("input",{type:"text",value:c,onChange:v=>f(v.target.value),onKeyDown:m,autoFocus:!0,style:{width:"100%",padding:"8px",backgroundColor:"#1a1a1a",color:"white",border:"1px solid var(--theme-color)",borderRadius:"4px",marginBottom:"15px"}}),d.jsxs("div",{className:"button-row",style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[d.jsx("button",{onClick:o,children:"Cancel"}),d.jsx("button",{onClick:g,style:{backgroundColor:"var(--theme-color)",color:"black"},children:"Save"})]})]})]})})},Fv=({safetyZones:a,outputArea:e,testLineY:r,testLineEnabled:i,transformationEnabled:o,transformationMode:c,flipX:f,flipY:g,onUpdateSafetyZones:m,onUpdateOutputArea:v,selectedZoneIndex:x,onSelectZone:T,gridSize:S=20,snapToGrid:E=!1})=>{const M=R.useRef(null),[D,j]=R.useState(null),P=(U,K,Z)=>{U.strokeStyle="#333",U.lineWidth=1,U.beginPath();for(let W=0;W<=S;W++){const re=W/S,Y=re*K,ee=re*Z;U.moveTo(Y,0),U.lineTo(Y,Z),U.moveTo(0,ee),U.lineTo(K,ee)}U.stroke(),U.strokeStyle="#666",U.lineWidth=2,U.beginPath(),U.moveTo(K/2,0),U.lineTo(K/2,Z),U.moveTo(0,Z/2),U.lineTo(K,Z/2),U.stroke(),U.fillStyle="#aaa",U.font="10px monospace",U.fillText("0,0",5,12),U.fillText("1,0",K-25,12),U.fillText("0,1",5,Z-5),U.fillText("1,1",K-25,Z-5)},F=(U,K,Z,W=!1,re=!1)=>{const{x:Y,y:ee,w:ue,h:Ee}=K;if(U.fillStyle=Z,U.fillRect(Y,ee,ue,Ee),U.strokeStyle=W?"#fff":re?"#0089ff":"#ff0000",U.lineWidth=W?2:1,U.strokeRect(Y,ee,ue,Ee),W||re){U.fillStyle="#fff";const Q=(ve,_e)=>U.fillRect(ve-6/2,_e-6/2,6,6);Q(Y,ee),Q(Y+ue,ee),Q(Y,ee+Ee),Q(Y+ue,ee+Ee);const be=4;U.fillStyle="#ccc";const ke=(ve,_e)=>U.fillRect(ve-be/2,_e-be/2,be,be);ke(Y+ue/2,ee),ke(Y+ue/2,ee+Ee),ke(Y,ee+Ee/2),ke(Y+ue,ee+Ee/2)}},_=()=>{const U=M.current;if(!U)return;const K=U.getContext("2d"),{width:Z,height:W}=U;if(K.clearRect(0,0,Z,W),P(K,Z,W),o&&e&&F(K,{x:e.x*Z,y:e.y*W,w:e.w*Z,h:e.h*W},"rgba(0, 137, 255, 0.2)",!1,!0),a.forEach((re,Y)=>{F(K,{x:re.x*Z,y:re.y*W,w:re.w*Z,h:re.h*W},"rgba(255, 0, 0, 0.3)",Y===x)}),i){let re=r,Y=0,ee=1;if(o&&e){if(c==="scale")Y=e.x,ee=e.x+e.w,re=e.y+re*e.h;else if(c==="crop"){if(re<e.y||re>e.y+e.h)return;Y=Math.max(0,e.x),ee=Math.min(1,e.x+e.w)}}const ue=re*W,Ee=Y*Z,q=ee*Z;let Q=[[Ee,q]];a&&a.length>0&&a.forEach(be=>{const ke=be.y*W,ve=be.h*W,_e=be.x*Z,Oe=be.w*Z;if(ue>=ke&&ue<=ke+ve){const We=[];Q.forEach(Ye=>{const[Je,yn]=Ye,_t=_e,vn=_e+Oe;vn<=Je||_t>=yn?We.push(Ye):(_t>Je&&We.push([Je,_t]),vn<yn&&We.push([vn,yn]))}),Q=We}}),K.strokeStyle="#00ff00",K.lineWidth=2,K.beginPath(),Q.forEach(be=>{K.moveTo(be[0],ue),K.lineTo(be[1],ue)}),K.stroke()}};R.useEffect(()=>{_()},[a,e,r,i,o,x,S,f,g]);const L=U=>{const K=M.current.getBoundingClientRect();return{x:(U.clientX-K.left)/K.width,y:(U.clientY-K.top)/K.height}},I=(U,K,Z)=>{if(!Z)return null;const W=.03;return Math.abs(U-Z.x)<W&&Math.abs(K-Z.y)<W?"nw":Math.abs(U-(Z.x+Z.w))<W&&Math.abs(K-Z.y)<W?"ne":Math.abs(U-Z.x)<W&&Math.abs(K-(Z.y+Z.h))<W?"sw":Math.abs(U-(Z.x+Z.w))<W&&Math.abs(K-(Z.y+Z.h))<W?"se":Math.abs(K-Z.y)<W&&U>=Z.x&&U<=Z.x+Z.w?"n":Math.abs(K-(Z.y+Z.h))<W&&U>=Z.x&&U<=Z.x+Z.w?"s":Math.abs(U-Z.x)<W&&K>=Z.y&&K<=Z.y+Z.h?"w":Math.abs(U-(Z.x+Z.w))<W&&K>=Z.y&&K<=Z.y+Z.h?"e":null},V=(U,K,Z)=>Z?U>=Z.x&&U<=Z.x+Z.w&&K>=Z.y&&K<=Z.y+Z.h:!1,$=U=>{const{x:K,y:Z}=L(U);if(x!==null&&a[x]){const W=a[x],re=I(K,Z,W);if(re){j({type:"zone",index:x,handle:re,startX:K,startY:Z,originalRect:{...W}});return}}for(let W=a.length-1;W>=0;W--){const re=a[W];if(re&&V(K,Z,re)){T(W);const Y=I(K,Z,re);j({type:"zone",index:W,handle:Y||"move",startX:K,startY:Z,originalRect:{...re}});return}}if(o&&e){const W=I(K,Z,e);if(W){j({type:"output",handle:W,startX:K,startY:Z,originalRect:{...e}}),T(null);return}if(V(K,Z,e)){j({type:"output",handle:"move",startX:K,startY:Z,originalRect:{...e}}),T(null);return}}T(null)},J=U=>{if(!E)return U;const K=1/S;return Math.round(U/K)*K},ie=U=>{if(!D)return;const{x:K,y:Z}=L(U),W=K-D.startX,re=Z-D.startY,Y=(ee,ue,Ee,q)=>{let Q={...ee};if(ue==="move")Q.x=J(ee.x+Ee),Q.y=J(ee.y+q);else{if(ue.includes("w")){const be=J(ee.x+Ee);Q.w=ee.x+ee.w-be,Q.x=be}if(ue.includes("e")){const be=J(ee.x+ee.w+Ee);Q.w=be-Q.x}if(ue.includes("n")){const be=J(ee.y+q);Q.h=ee.y+ee.h-be,Q.y=be}if(ue.includes("s")){const be=J(ee.y+ee.h+q);Q.h=be-Q.y}}return Q.w<.01&&(Q.w=.01),Q.h<.01&&(Q.h=.01),Q};if(D.type==="zone"){const ee=Y(D.originalRect,D.handle,W,re);m(D.index,ee)}else if(D.type==="output"){const ee=Y(D.originalRect,D.handle,W,re);v(ee)}},oe=()=>{j(null)};return d.jsx("div",{className:"output-canvas-container",style:{width:"100%",height:"100%"},children:d.jsx("canvas",{ref:M,width:600,height:600,style:{width:"100%",height:"100%",display:"block"},className:"output-canvas",onMouseDown:$,onMouseMove:ie,onMouseUp:oe,onMouseLeave:oe})})},Pv=({show:a,onClose:e,dacs:r=[],dacSettings:i={},onUpdateDacSettings:o})=>{const[c,f]=R.useState(null),[g,m]=R.useState(null),[v,x]=R.useState(20),[T,S]=R.useState(!1),E=R.useMemo(()=>{const _=[];return r.forEach(L=>{L.channels&&L.channels.length>0?L.channels.forEach(I=>{_.push({id:`${L.ip}:${I.serviceID}`,displayName:`${L.hostName||L.unitID||"DAC"} : ${I.name||`CH ${I.serviceID}`}`,ip:L.ip,channel:I.serviceID,dacName:L.hostName||L.unitID})}):_.push({id:`${L.ip}:0`,displayName:L.hostName||L.unitID||`DAC ${L.ip}`,ip:L.ip,channel:0,dacName:L.hostName||L.unitID})}),_},[r]);if(R.useEffect(()=>{E.length>0&&!c&&f(E[0].id)},[E,c]),!a)return null;const M=i[c]||{safetyZones:[],outputArea:{x:.1,y:.1,w:.8,h:.8},transformationEnabled:!1,transformationMode:"crop",testLineEnabled:!1,testLineY:.5,flipX:!1,flipY:!1},D=_=>{c&&o(c,{...M,..._})},j=()=>{const _={x:.4,y:.4,w:.2,h:.2};D({safetyZones:[...M.safetyZones,_]}),m(M.safetyZones.length)},P=()=>{D({safetyZones:[]}),m(null)},F=(_,L)=>{const I=[...M.safetyZones];I[_]=L,D({safetyZones:I})};return d.jsx("div",{className:"output-settings-modal-overlay",children:d.jsxs("div",{className:"output-settings-modal-content",children:[d.jsxs("div",{className:"output-settings-header",children:[d.jsx("h2",{children:"Output Settings"}),d.jsx("button",{className:"close-btn",onClick:e,children:"Close"})]}),d.jsxs("div",{className:"output-settings-body",children:[d.jsx("div",{className:"output-settings-col",children:d.jsxs("div",{className:"settings-group",children:[d.jsx("h4",{children:"Available Outputs"}),d.jsxs("ul",{className:"dac-list",children:[E.length===0?d.jsx("li",{style:{color:"#666",fontStyle:"italic"},children:"No Outputs detected"}):null,E.map((_,L)=>d.jsxs("li",{className:`dac-list-item ${c===_.id?"selected":""}`,onClick:()=>f(_.id),children:[d.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9em"},children:_.displayName}),d.jsx("span",{style:{fontSize:"0.7em",color:"#888"},children:_.ip})]},_.id))]})]})}),d.jsxs("div",{className:"output-settings-col canvas-col",children:[d.jsxs("div",{className:"canvas-toolbar",children:[d.jsx("button",{className:"tool-btn",onClick:j,title:"Add Safety Zone",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus-square",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),d.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})]})}),d.jsx("button",{className:`tool-btn ${M.transformationEnabled?"active":""}`,onClick:()=>D({transformationEnabled:!M.transformationEnabled}),title:"Toggle Output Transformation",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-border-outer",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M7.5 1.906v.938h1v-.938zm0 1.875v.938h1V3.78h-1zm0 1.875v.938h1v-.938zM1.906 8.5h.938v-1h-.938zm1.875 0h.938v-1H3.78v1zm1.875 0h.938v-1h-.938zm2.813 0v-.031H8.5V7.53h-.031V7.5H7.53v.031H7.5v.938h.031V8.5zm.937 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zM7.5 9.406v.938h1v-.938zm0 1.875v.938h1v-.938zm0 1.875v.938h1v-.938z"}),d.jsx("path",{d:"M0 0v16h16V0zm1 1h14v14H1z"})]})}),d.jsx("button",{className:`tool-btn ${M.testLineEnabled?"active":""}`,onClick:()=>D({testLineEnabled:!M.testLineEnabled}),title:"Toggle Test Line",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[d.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),d.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})]})}),d.jsx("span",{style:{width:1,background:"#555",margin:"0 5px"}}),d.jsx("button",{className:`tool-btn ${T?"active":""}`,onClick:()=>S(!T),title:"Snap to Grid",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-magnet-fill",viewBox:"0 0 16 16",children:d.jsx("path",{d:"M15 12h-4v3h4zM5 12H1v3h4zM0 8a8 8 0 1 1 16 0v8h-6V8a2 2 0 1 0-4 0v8H0z"})})}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:5},children:[d.jsx("span",{style:{fontSize:10,color:"#aaa"},children:"Grid:"}),d.jsx("input",{type:"number",min:"5",max:"100",value:v,onChange:_=>x(parseInt(_.target.value)),className:"param-number-input",style:{width:40}})]})]}),d.jsx(Fv,{safetyZones:M.safetyZones,outputArea:M.outputArea,testLineY:M.testLineY,testLineEnabled:M.testLineEnabled,transformationEnabled:M.transformationEnabled,transformationMode:M.transformationMode,flipX:M.flipX,flipY:M.flipY,onUpdateSafetyZones:F,onUpdateOutputArea:_=>D({outputArea:_}),selectedZoneIndex:g,onSelectZone:m,gridSize:v,snapToGrid:T})]}),d.jsx("div",{className:"output-settings-col",children:c?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"settings-group",children:[d.jsx("h4",{children:"Output Transformation"}),d.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[d.jsx("label",{style:{flex:1},children:"Enable Editing"}),d.jsx("input",{type:"checkbox",checked:M.transformationEnabled,onChange:_=>D({transformationEnabled:_.target.checked})})]}),d.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[d.jsx("label",{style:{flex:1},children:"Flip X"}),d.jsx("input",{type:"checkbox",checked:M.flipX||!1,onChange:_=>D({flipX:_.target.checked})})]}),d.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[d.jsx("label",{style:{flex:1},children:"Flip Y"}),d.jsx("input",{type:"checkbox",checked:M.flipY||!1,onChange:_=>D({flipY:_.target.checked})})]}),M.transformationEnabled&&d.jsxs("div",{className:"control-row",children:[d.jsx("label",{style:{flex:1},children:"Mode"}),d.jsxs("select",{className:"param-select",value:M.transformationMode,onChange:_=>D({transformationMode:_.target.value}),children:[d.jsx("option",{value:"crop",children:"Crop"}),d.jsx("option",{value:"scale",children:"Scale"})]})]})]}),d.jsxs("div",{className:"settings-group",children:[d.jsx("h4",{children:"Safety Zones"}),d.jsxs("div",{className:"control-row",style:{justifyContent:"space-between",marginBottom:5},children:[d.jsx("button",{className:"small-btn",onClick:j,children:"Add New"}),d.jsx("button",{className:"small-btn clear",onClick:P,children:"Clear All"})]}),d.jsx("div",{className:"zone-list",children:M.safetyZones.map((_,L)=>d.jsxs("div",{className:`zone-item ${g===L?"selected":""}`,onClick:()=>m(L),children:[d.jsxs("span",{children:["Zone ",L+1]}),d.jsx("button",{className:"delete-zone-btn",onClick:I=>{I.stopPropagation(),g===L&&m(null);const V=M.safetyZones.filter(($,J)=>J!==L);D({safetyZones:V})},children:""})]},L))}),g!==null&&d.jsxs("div",{style:{marginTop:10,borderTop:"1px solid #333",paddingTop:5},children:[d.jsx("label",{children:"Selected Zone Properties"}),d.jsx("div",{style:{fontSize:"0.8em",color:"#aaa"},children:"Select and drag zone on canvas to resize."})]})]}),d.jsxs("div",{className:"settings-group",children:[d.jsx("h4",{children:"Test Output"}),d.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[d.jsx("label",{style:{flex:1},children:"Enable Test Line"}),d.jsx("input",{type:"checkbox",checked:M.testLineEnabled,onChange:_=>D({testLineEnabled:_.target.checked})})]}),M.testLineEnabled&&d.jsxs("div",{className:"control-row",children:[d.jsx("label",{children:"Y Position"}),d.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:M.testLineY,onChange:_=>D({testLineY:parseFloat(_.target.value)}),className:"param-slider"})]})]})]}):d.jsx("div",{style:{padding:20,textAlign:"center",color:"#666"},children:"Select an Output to configure settings"})})]})]})})},tg=()=>{const a=uo();return a||{}},zv=({show:a,onClose:e,initialTab:r="output"})=>{const i=uo(),{fftSettings:o,setFftSettings:c}=i||{},{devices:f,selectedDeviceId:g,setSelectedDeviceId:m,globalVolume:v,setVolume:x}=tg(),[T,S]=R.useState(r);if(Yn.useEffect(()=>{a&&S(r)},[a,r]),!a)return null;if(!o)return d.jsxs("div",{className:"modal-overlay",children:[d.jsxs("div",{className:"modal-content",style:{padding:"20px",color:"red",border:"1px solid red",background:"#222"},children:[d.jsx("h3",{children:"Error"}),d.jsx("p",{children:"Audio Context is not available."}),d.jsx("p",{children:"Please restart the application or report this bug."}),d.jsx("button",{onClick:e,style:{marginTop:"10px",padding:"5px 10px"},children:"Close"})]}),d.jsx("style",{children:`
                    .modal-overlay {
                        position: fixed;
                        top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 10000;
                    }
                `})]});const E=(M,D,j)=>{const P={...o},F=`${M}Range`;P[F][D]=parseFloat(j),c(P)};return d.jsxs("div",{className:"modal-overlay",children:[d.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[d.jsxs("div",{className:"modal-header",children:[d.jsx("h3",{children:"Audio Settings"}),d.jsx("button",{className:"close-btn",onClick:e,children:""})]}),d.jsxs("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"},children:[d.jsx("button",{className:`tab-btn ${T==="output"?"active":""}`,onClick:()=>S("output"),style:{padding:"8px 15px",background:"none",border:"none",color:T==="output"?"var(--theme-color)":"#888",borderBottom:T==="output"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"Audio Output"}),d.jsx("button",{className:`tab-btn ${T==="fft"?"active":""}`,onClick:()=>S("fft"),style:{padding:"8px 15px",background:"none",border:"none",color:T==="fft"?"var(--theme-color)":"#888",borderBottom:T==="fft"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"FFT Settings"})]}),d.jsxs("div",{className:"modal-body",children:[T==="output"&&d.jsxs("div",{className:"audio-output-settings",children:[d.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[d.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Device"}),d.jsx("select",{className:"param-select",value:g,onChange:M=>m(M.target.value),style:{width:"100%",padding:"5px"},children:f.map(M=>d.jsx("option",{value:M.deviceId,children:M.label||`Device ${M.deviceId.slice(0,5)}`},M.deviceId))})]}),d.jsxs("div",{className:"settings-row",style:{textAlign:"center"},children:[d.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Volume"}),d.jsx("div",{style:{display:"flex",justifyContent:"center"},children:d.jsx(yi,{value:v,onChange:x,label:"MASTER",isAssigned:!0,size:60})})]})]}),T==="fft"&&d.jsxs("div",{className:"fft-settings",children:[d.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[d.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Source"}),d.jsxs("select",{className:"param-select",value:o.source,onChange:M=>c({...o,source:M.target.value}),style:{width:"100%",padding:"5px"},children:[d.jsx("option",{value:"external",children:"External (Microphone/Loopback)"}),d.jsx("option",{value:"clip",children:"Clip FFT (Audio from active clips)"})]})]}),d.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[d.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Calculation Mode"}),d.jsxs("select",{className:"param-select",value:o.calculationMode||"average",onChange:M=>c({...o,calculationMode:M.target.value}),style:{width:"100%",padding:"5px"},children:[d.jsx("option",{value:"average",children:"Average (Smooth)"}),d.jsx("option",{value:"peak",children:"Peak (Transient/Punchy)"})]})]}),d.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[d.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Ranges (Hz)"}),d.jsxs("div",{className:"range-controls",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"10px",alignItems:"center"},children:[d.jsx("span",{children:"Low:"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:o.lowRange[0],onChange:M=>E("low",0,M.target.value),style:{width:"60px"}}),d.jsx("span",{children:"-"}),d.jsx("input",{type:"number",value:o.lowRange[1],onChange:M=>E("low",1,M.target.value),style:{width:"60px"}})]}),d.jsx("span",{children:"Mid:"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:o.midRange[0],onChange:M=>E("mid",0,M.target.value),style:{width:"60px"}}),d.jsx("span",{children:"-"}),d.jsx("input",{type:"number",value:o.midRange[1],onChange:M=>E("mid",1,M.target.value),style:{width:"60px"}})]}),d.jsx("span",{children:"High:"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:o.highRange[0],onChange:M=>E("high",0,M.target.value),style:{width:"60px"}}),d.jsx("span",{children:"-"}),d.jsx("input",{type:"number",value:o.highRange[1],onChange:M=>E("high",1,M.target.value),style:{width:"60px"}})]})]})]}),d.jsxs("div",{className:"settings-row",style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"GAIN"}),d.jsx(yi,{value:o.gain/5,onChange:M=>c({...o,gain:M*5}),isAssigned:!0,size:40})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"SMOOTH"}),d.jsx(yi,{value:o.smoothingTimeConstant||.8,onChange:M=>c({...o,smoothingTimeConstant:M}),isAssigned:!0,size:40})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"HOLD"}),d.jsx(yi,{value:o.holdTime/1e3,onChange:M=>c({...o,holdTime:M*1e3}),isAssigned:!0,size:40})]}),d.jsxs("div",{children:[d.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"FALL"}),d.jsx(yi,{value:o.fallTime/2e3,onChange:M=>c({...o,fallTime:M*2e3}),isAssigned:!0,size:40})]})]})]})]})]}),d.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]})},Gv=({missingFiles:a,onRelocate:e,onClose:r})=>!a||a.length===0?null:d.jsxs("div",{className:"modal-overlay",children:[d.jsxs("div",{className:"modal-content",style:{width:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[d.jsxs("div",{className:"modal-header",children:[d.jsx("h3",{children:"Missing Files"}),d.jsx("button",{className:"close-btn",onClick:r,children:""})]}),d.jsxs("div",{className:"modal-body",style:{overflowY:"auto",flex:1},children:[d.jsx("p",{style:{marginBottom:"15px",color:"#ccc",fontSize:"0.9em"},children:"The following files could not be found. Please locate one of them to update the path for all matching files in the same directory."}),d.jsx("ul",{style:{listStyle:"none",padding:0},children:a.map((i,o)=>d.jsxs("li",{style:{background:"#333",padding:"10px",marginBottom:"5px",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("div",{style:{overflow:"hidden"},children:[d.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9em"},children:i.fileName}),d.jsx("div",{style:{fontSize:"0.8em",color:"#888",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"350px"},children:i.filePath})]}),d.jsx("button",{className:"small-btn",onClick:()=>e(i),style:{marginLeft:"10px",whiteSpace:"nowrap"},children:"Locate"})]},o))})]})]}),d.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex; justify-content: center; align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .small-btn {
                    background: var(--theme-color);
                    color: black;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: bold;
                }
                .small-btn:hover {
                    opacity: 0.9;
                }
            `})]});class Hv extends Yn.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){console.error("Uncaught error:",e,r)}render(){return this.state.hasError?d.jsx("h1",{children:"Something went wrong."}):this.props.children}}const V0=32,X0=8;function _f(a,e,r,i){for(let o=0;o<i;o++)a.setUint8(e+o,o<r.length?r.charCodeAt(o):0)}function ng(a){let e=0;a.forEach(c=>{e+=V0;const f=c.points?c.points.length:0;e+=f*X0});const r=new ArrayBuffer(e),i=new DataView(r);let o=0;return a.forEach((c,f)=>{const g=c.points||[],m=g.length;_f(i,o,"ILDA",4),i.setUint8(o+4,0),i.setUint8(o+5,0),i.setUint8(o+6,0),i.setUint8(o+7,5),_f(i,o+8,c.frameName||"TrueLazr",8),_f(i,o+16,c.companyName||"Gemini",8),i.setUint16(o+24,m,!1),i.setUint16(o+26,f,!1),i.setUint16(o+28,a.length,!1),i.setUint8(o+30,c.scannerHead||0),i.setUint8(o+31,0),o+=V0;for(let v=0;v<m;v++){const x=g[v];let T=Math.max(-32768,Math.min(32767,Math.round((x.x||0)*32767))),S=Math.max(-32768,Math.min(32767,Math.round((x.y||0)*32767)));i.setInt16(o,T,!1),i.setInt16(o+2,S,!1);let E=0;x.blanking&&(E|=64),v===m-1&&(E|=128),i.setUint8(o+4,E);let M=x.r||0,D=x.g||0,j=x.b||0;M<=1&&D<=1&&j<=1&&(M>0||D>0||j>0||x.blanking),M<=1&&D<=1&&j<=1?(M=Math.round(M*255),D=Math.round(D*255),j=Math.round(j*255)):(M=Math.round(M),D=Math.round(D),j=Math.round(j)),i.setUint8(o+5,j),i.setUint8(o+6,D),i.setUint8(o+7,M),o+=X0}}),r}const $0=Object.freeze(Object.defineProperty({__proto__:null,framesToIlda:ng},Symbol.toStringTag,{value:"Module"})),Of=[{r:255,g:0,b:0},{r:255,g:17,b:0},{r:255,g:34,b:0},{r:255,g:51,b:0},{r:255,g:68,b:0},{r:255,g:85,b:0},{r:255,g:102,b:0},{r:255,g:119,b:0},{r:255,g:136,b:0},{r:255,g:153,b:0},{r:255,g:170,b:0},{r:255,g:187,b:0},{r:255,g:204,b:0},{r:255,g:221,b:0},{r:255,g:238,b:0},{r:255,g:255,b:0},{r:255,g:255,b:0},{r:238,g:255,b:0},{r:204,g:255,b:0},{r:170,g:255,b:0},{r:136,g:255,b:0},{r:102,g:255,b:0},{r:68,g:255,b:0},{r:34,g:255,b:0},{r:0,g:255,b:0},{r:0,g:255,b:34},{r:0,g:255,b:68},{r:0,g:255,b:102},{r:0,g:255,b:136},{r:0,g:255,b:170},{r:0,g:255,b:204},{r:0,g:255,b:238},{r:0,g:136,b:255},{r:0,g:119,b:255},{r:0,g:102,b:255},{r:0,g:102,b:255},{r:0,g:85,b:255},{r:0,g:68,b:255},{r:0,g:68,b:255},{r:0,g:34,b:255},{r:0,g:0,b:255},{r:34,g:0,b:255},{r:68,g:0,b:255},{r:102,g:0,b:255},{r:136,g:0,b:255},{r:170,g:0,b:255},{r:204,g:0,b:255},{r:238,g:0,b:255},{r:255,g:0,b:255},{r:255,g:34,b:255},{r:255,g:68,b:255},{r:255,g:102,b:255},{r:255,g:136,b:255},{r:255,g:170,b:255},{r:255,g:204,b:255},{r:255,g:238,b:255},{r:255,g:255,b:255},{r:255,g:238,b:238},{r:255,g:204,b:204},{r:255,g:170,b:170},{r:255,g:136,b:136},{r:255,g:102,b:102},{r:255,g:68,b:68},{r:0,g:34,b:34}];function Yv(a,e,r,i,o=Of){const c=[],f=new DataView(a);let g=0;try{for(let m=0;m<i;m++){if(e===2){g+=r;continue}let v,x,T=0,S,E,M,D;e===0||e===4?(v=f.getInt16(g,!1)/32768,x=f.getInt16(g+2,!1)/32768,T=f.getInt16(g+4,!1)/32768,D=f.getUint8(g+6)):(v=f.getInt16(g,!1)/32768,x=f.getInt16(g+2,!1)/32768,D=f.getUint8(g+4));const j=(D&64)!==0,P=(D&128)!==0;if(e===0||e===1){const F=f.getUint8(g+(e===0?7:5)),_=o||Of,L=_[F%_.length]||Of[0];S=L.r,E=L.g,M=L.b}else(e===4||e===5)&&(M=f.getUint8(g+(e===4?7:5)),E=f.getUint8(g+(e===4?8:6)),S=f.getUint8(g+(e===4?9:7)));if(c.push({x:v,y:x,z:T,r:S===void 0?255:S,g:E===void 0?255:E,b:M===void 0?255:M,blanking:j,lastPoint:P}),g+=r,P)break}}catch(m){console.warn("Parser: Error reading points:",m)}return c}const qv=a=>{const e=[],r=new DataView(a);let i=0,o=null,c=null;for(;i+32<=r.byteLength;){if(String.fromCharCode(r.getUint8(i),r.getUint8(i+1),r.getUint8(i+2),r.getUint8(i+3))!=="ILDA"){i++;continue}const g=r.getUint8(i+7);c===null&&(c=g);const m=String.fromCharCode(...new Uint8Array(a,i+8,8)).trim(),v=String.fromCharCode(...new Uint8Array(a,i+16,8)).trim();let x=r.getUint16(i+24,!1);const T=r.getUint16(i+26,!1),S=r.getUint16(i+28,!1),E=r.getUint8(i+30);let M;switch(g){case 0:M=8;break;case 1:M=6;break;case 2:M=3;break;case 4:M=10;break;case 5:M=8;break;default:i+=32;continue}if(g===2){o=[];const P=i+32;for(let F=0;F<x;F++){const _=r.getUint8(P+F*3),L=r.getUint8(P+F*3+1),I=r.getUint8(P+F*3+2);o.push({r:_,g:L,b:I})}}let D=x*M,j=32+D;if(i+j>a.byteLength)break;if(x>0&&g!==2){const P=a.slice(i+32,i+32+D),F=Yv(P,g,M,x,o);e.push({frameName:m,companyName:v,frameNumber:T,totalFrames:S,scannerHead:E,points:F,formatCode:g})}i+=j}return{frames:e,firstFormatCode:c,colorPalette:o}};function el(a,e=!1,r=.5){if(!a||a.length<2)return a||[];const i=[],o=a.length,c=g=>e?a[(g+o)%o]:a[Math.max(0,Math.min(o-1,g))],f=e?o:o-1;for(let g=0;g<f;g++){const m=c(g-1),v=c(g),x=c(g+1),T=c(g+2);let S,E;!e&&o===2?(S={x:v.x+(x.x-v.x)/3,y:v.y+(x.y-v.y)/3},E={x:x.x-(x.x-v.x)/3,y:x.y-(x.y-v.y)/3}):(S={x:v.x+(x.x-m.x)*r/3,y:v.y+(x.y-m.y)*r/3},E={x:x.x-(T.x-v.x)*r/3,y:x.y-(T.y-v.y)*r/3}),g===0&&i.push({...v}),i.push(S),i.push(E),i.push({...x})}return i}const Vv=({onBack:a})=>{const[e,r]=R.useState("select"),[i,o]=R.useState("#00ff00"),[c,f]=R.useState("simple"),[g,m]=R.useState(!1),[v,x]=R.useState(1),[T,S]=R.useState(1),[E,M]=R.useState(0),[D,j]=R.useState(!1),[P,F]=R.useState(!0),[_,L]=R.useState([[]]),[I,V]=R.useState(null),[$,J]=R.useState([[[]]]),[ie,oe]=R.useState(0),[U,K]=R.useState([]),[Z,W]=R.useState([]),[re,Y]=R.useState([]),[ee,ue]=R.useState(null),[Ee,q]=R.useState(null),[Q,be]=R.useState(.6),[ke,ve]=R.useState({x:0,y:0}),[_e,Oe]=R.useState(!0),[We,Ye]=R.useState(!1),[Je,yn]=R.useState(25),[_t,vn]=R.useState(!1),[Wt,Kt]=R.useState(!1),[je,$e]=R.useState(!1),[Ie,nt]=R.useState({visible:!1,x:0,y:0,target:null}),[Ue,xe]=R.useState(0),[Ze,Zt]=R.useState(-1),[fn,Et]=R.useState(0),[it,qn]=R.useState(0),[Xt,Nn]=R.useState(!0),[dn,us]=R.useState(!0),[tr,nr]=R.useState(0),[rn,ar]=R.useState("fps"),[bn,Ve]=R.useState(1),[lt,Vs]=R.useState(120),[Jn,ea]=R.useState(2),[rr,la]=R.useState(30),[Pa,Sa]=R.useState(8),Ea=R.useRef(rn),oa=R.useRef(bn),jn=R.useRef(lt),ca=R.useRef(Jn),ua=R.useRef(rr),fa=R.useRef(Pa),sn=R.useRef(v),Gt=R.useRef(tr);R.useEffect(()=>{Ea.current=rn},[rn]),R.useEffect(()=>{oa.current=bn},[bn]),R.useEffect(()=>{jn.current=lt},[lt]),R.useEffect(()=>{ca.current=Jn},[Jn]),R.useEffect(()=>{ua.current=rr},[rr]),R.useEffect(()=>{fa.current=Pa},[Pa]),R.useEffect(()=>{sn.current=v},[v]),R.useEffect(()=>{Gt.current=tr},[tr]);const Dt=R.useRef(null),wa=R.useRef(null),ot=R.useRef({x:0,y:0}),Xs=R.useRef(!1),Br=R.useRef(!1),Aa=R.useRef(!1),sr=R.useRef(!1),Jt=R.useRef(!1),xn=R.useRef(!1),vt=R.useRef(null);R.useRef(null);const dt=R.useRef(performance.now()),Ct=R.useRef(0),At=1e3,qe=_[E]||[],ft=p=>{const b=$.slice(0,ie+1);b.push(JSON.parse(JSON.stringify(p))),b.length>30&&b.shift(),J(b),oe(b.length-1)},da=(p,b=!0)=>{const A=na(p,b);if(A.length===0)return{x:0,y:0,w:0,h:0};const w=Math.min(...A.map(X=>X.x)),C=Math.max(...A.map(X=>X.x)),N=Math.min(...A.map(X=>X.y)),O=Math.max(...A.map(X=>X.y));return{x:w,y:N,w:C-w,h:O-N}},Ta=()=>{if(U.length<2)return;const p=[..._],b=[...p[E]],A=U.sort((N,O)=>O-N).map(N=>b.splice(N,1)[0]),w={type:"group",shapes:A.reverse(),color:A[0].color,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0},C=pa(w);w.pivotX=C.x,w.pivotY=C.y,b.push(w),p[E]=b,L(p),ft(p),K([b.length-1])},br=()=>{if(U.length!==1)return;const p=qe[U[0]];if(p.type!=="group")return;const b=[..._],A=[...b[E]];A.splice(U[0],1);const w=p.shapes.map(C=>{const N=ha(Ut(C),p);return{...C,points:N,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}});A.push(...w),b[E]=A,L(b),ft(b),K([])},en=(p,b)=>Math.sqrt(Math.pow(b.x-p.x,2)+Math.pow(b.y-p.y,2)),kn=p=>{if(p.startsWith("rgb")){const A=p.match(/\d+/g);return{r:parseInt(A[0]),g:parseInt(A[1]),b:parseInt(A[2])}}const b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:{r:0,g:0,b:0}},Ca=p=>{if(!p)return"#ffffff";if(p.startsWith("#"))return p;if(p.startsWith("rgb")){const b=kn(p),A=b.r.toString(16).padStart(2,"0"),w=b.g.toString(16).padStart(2,"0"),C=b.b.toString(16).padStart(2,"0");return`#${A}${w}${C}`}return"#ffffff"},ta=p=>{const{r:b,g:A,b:w}=kn(Ca(p));return`rgb(${255-b}, ${255-A}, ${255-w})`},Vn=(p,b,A)=>{const w=Math.pow(en(b,A),2);if(w===0)return en(p,b);let C=((p.x-b.x)*(A.x-b.x)+(p.y-b.y)*(A.y-b.y))/w;return C=Math.max(0,Math.min(1,C)),en(p,{x:b.x+C*(A.x-b.x),y:b.y+C*(A.y-b.y)})},pa=(p,b=!1)=>{if(!p)return{x:500,y:500};if(p.type==="rect"&&!b)return{x:p.start.x+p.width/2,y:p.start.y+p.height/2};if((p.type==="circle"||p.type==="star"||p.type==="triangle")&&!b)return p.start;if(p.type==="line"&&!b)return{x:(p.start.x+p.end.x)/2,y:(p.start.y+p.end.y)/2};const A=na(p,b);if(A.length===0)return{x:500,y:500};const w=A.reduce((C,N)=>({x:C.x+(N.x||0),y:C.y+(N.y||0)}),{x:0,y:0});return{x:w.x/A.length,y:w.y/A.length}},xr=(p,b)=>{if(!b||!p)return null;const A=Array.isArray(b)?b:[b];if(p.type==="group")return xr(p.shapes[A[0]],A.slice(1));const w=A[0];return p.type==="line"?w===0?p.start:p.end:p.type==="rect"?[p.start,{x:p.start.x+p.width,y:p.start.y},{x:p.start.x+p.width,y:p.start.y+p.height},{x:p.start.x,y:p.start.y+p.height}][w]:p.type==="circle"||p.type==="star"||p.type==="triangle"?[p.start,{x:p.end.x,y:p.start.y},{x:p.start.x,y:p.end.y}][w]:p.points?p.points[w]:null},Bn=p=>p?p.pivotX!==void 0&&p.pivotY!==void 0?{x:p.pivotX,y:p.pivotY}:pa(p):{x:500,y:500},ha=R.useCallback((p,b)=>{if(!p||p.length===0||!b)return p;b.type==="group"&&b.shapes;const A=Bn(b),w=b.scaleX??1,C=b.scaleY??1,N=b.rotationX||0,O=b.rotationY||0,X=b.rotationZ||b.rotation||0;return w===1&&C===1&&N===0&&O===0&&X===0?p:p.map(z=>{let H=z.x-A.x,G=z.y-A.y,ne=z.z||0;if(H*=w,G*=C,X!==0){const ae=H*Math.cos(X)-G*Math.sin(X),le=H*Math.sin(X)+G*Math.cos(X);H=ae,G=le}if(N!==0){const ae=G*Math.cos(N)-ne*Math.sin(N),le=G*Math.sin(N)+ne*Math.cos(N);G=ae,ne=le}if(O!==0){const ae=H*Math.cos(O)+ne*Math.sin(O),le=-H*Math.sin(O)+ne*Math.cos(O);H=ae,ne=le}return{...z,x:A.x+H,y:A.y+G,z:ne}})},[]),Ut=R.useCallback(p=>{if(!p)return[];let b=[];if(p.type==="pen"||p.type==="polygon"||p.type==="polyline")b=p.points||[];else if(p.type==="bezier"){const A=(p.points||[]).filter(w=>!!w);if(A.length>=4)for(let w=0;w<=A.length-4;w+=3){const C=A[w],N=A[w+1],O=A[w+2],X=A[w+3];if(C&&N&&O&&X){const z=w===0?0:1;for(let H=z;H<=20;H++){const G=H/20,ne=1-G;b.push({x:Math.pow(ne,3)*C.x+3*Math.pow(ne,2)*G*N.x+3*ne*Math.pow(G,2)*O.x+Math.pow(G,3)*X.x,y:Math.pow(ne,3)*C.y+3*Math.pow(ne,2)*G*N.y+3*ne*Math.pow(G,2)*O.y+Math.pow(G,3)*X.y,color:C.color})}}}else b=A}else if(p.type==="line")b=[{x:p.start.x,y:p.start.y,color:p.startColor||p.color},{x:p.end.x,y:p.end.y,color:p.endColor||p.color}];else if(p.type==="rect"){const A=p.color,w=p.cornerColors||[A,A,A,A];b=[{x:p.start.x,y:p.start.y,color:w[0]},{x:p.start.x+p.width,y:p.start.y,color:w[1]},{x:p.start.x+p.width,y:p.start.y+p.height,color:w[2]},{x:p.start.x,y:p.start.y+p.height,color:w[3]}]}else if(p.type==="circle"){const A=Math.abs(p.end.x-p.start.x),w=Math.abs(p.end.y-p.start.y),C=p.color;for(let N=0;N<32;N++){const O=N/32*Math.PI*2;b.push({x:p.start.x+Math.cos(O)*A,y:p.start.y+Math.sin(O)*w,color:C})}}else if(p.type==="star"){const A=Math.abs(p.end.x-p.start.x),w=Math.abs(p.end.y-p.start.y),C=p.color,N=5,O=A,X=A/2.5;let z=Math.PI/2*3;const H=Math.PI/N;for(let G=0;G<N;G++)b.push({x:p.start.x+Math.cos(z)*O,y:p.start.y+Math.sin(z)*w,color:C}),z+=H,b.push({x:p.start.x+Math.cos(z)*X,y:p.start.y+Math.sin(z)*(w/2.5),color:C}),z+=H}else if(p.type==="triangle"){const A=Math.abs(p.end.x-p.start.x),w=Math.abs(p.end.y-p.start.y),C=p.color;b=[{x:p.start.x-A,y:p.start.y+w,color:C},{x:p.start.x+A,y:p.start.y+w,color:C},{x:p.start.x,y:p.start.y-w,color:C}]}else p.type==="group"&&p.shapes.forEach(A=>b.push(...Ut(A)));return ha(b,p)},[ha]),na=R.useCallback((p,b=!0)=>{if(!p)return[];let A=[];if(p.type==="pen"||p.type==="polygon"||p.type==="polyline"||p.type==="bezier")A=p.points||[];else if(p.type==="line")A=[{x:p.start.x,y:p.start.y,color:p.startColor||p.color},{x:p.end.x,y:p.end.y,color:p.endColor||p.color}];else if(p.type==="rect"){const w=p.color,C=p.cornerColors||[w,w,w,w];A=[{x:p.start.x,y:p.start.y,color:C[0]},{x:p.start.x+p.width,y:p.start.y,color:C[1]},{x:p.start.x+p.width,y:p.start.y+p.height,color:C[2]},{x:p.start.x,y:p.start.y+p.height,color:C[3]}]}else p.type==="circle"||p.type==="star"||p.type==="triangle"?A=[p.start,{x:p.end.x,y:p.start.y},{x:p.start.x,y:p.end.y}]:p.type==="group"&&p.shapes.forEach(w=>A.push(...na(w,!0)));return b?ha(A,p):A},[ha]),Sr=(p,b,A,w=[],C=[])=>{if(p.hidden||p.locked)return null;const N=15/Q,O=na(p);if(p.type!=="group"){const ne=[];for(let ae=0;ae<O.length;ae++)en(O[ae],b)<N&&ne.push({type:"point",index:ae,path:[...C,ae]});if(ne.length>0)return ne.find(le=>!w.some(he=>JSON.stringify(he)===JSON.stringify(le.path)))||ne[0]}const X=pa(p),z=Bn(p);if(A&&en(z,b)<15/Q)return{type:"pivot"};if(A&&en(X,b)<20/Q)return{type:"shape"};if(p.type==="group")for(let ne=p.shapes.length-1;ne>=0;ne--){const ae=Sr(p.shapes[ne],b,!0,w,[...C,ne]);if(ae&&ae.type==="point")return ae}const H=Ut(p),G=["rect","circle","star","polygon"].includes(p.type);for(let ne=0;ne<H.length-1;ne++)if(Vn(b,H[ne],H[ne+1])<N)return{type:"segment",index:ne,path:[...C,ne]};return G&&H.length>2&&Vn(b,H[H.length-1],H[0])<N?{type:"segment",index:H.length-1,path:[...C,H.length-1]}:null},ln=R.useCallback((p,b)=>{if(!Dt.current)return{x:500,y:500};const A=Dt.current.getBoundingClientRect(),w=p-A.left,C=b-A.top;return{x:(w-A.width/2)/Q+At/2-ke.x,y:(C-A.height/2)/Q+At/2-ke.y}},[Q,ke]),Ma=R.useCallback((p,b,A=[])=>{if(!We)return{x:p,y:b};const w=10/Q;let C=null,N=w;return qe.forEach((O,X)=>{if(O.hidden)return;na(O).forEach((H,G)=>{const ne=[X,G];if(A.some(he=>JSON.stringify(he)===JSON.stringify(ne)))return;const le=en({x:p,y:b},H);le<N&&(N=le,C={x:H.x,y:H.y})})}),C||{x:Math.round(p/Je)*Je,y:Math.round(b/Je)*Je}},[We,Je,qe,Q,na]),$s=p=>{p.preventDefault();const b=Math.pow(1.1,-p.deltaY/100);be(A=>Math.max(.1,Math.min(10,A*b)))},Er=p=>{if(p.preventDefault(),g&&I){Mr();return}const b=ln(p.clientX,p.clientY);for(let A=qe.length-1;A>=0;A--){const w=Sr(qe[A],b,U.includes(A),Z);if(w){nt({visible:!0,x:p.clientX,y:p.clientY,target:{...w,shapeIndex:A,pos:b}}),U.includes(A)||K([A]);return}}nt({visible:!0,x:p.clientX,y:p.clientY,target:{type:"canvas"}})},za=()=>{if(U.length!==1||Z.length===0)return;const p=U[0],b=[..._],A=[...b[E]],w=A[p];if(!w.points){alert("Only point-based shapes can be split. Convert to points first.");return}const C=Z.map(z=>Array.isArray(z)?z[0]:z).sort((z,H)=>z-H),N=C.map(z=>({...w.points[z]})),O=w.points.filter((z,H)=>!C.includes(H));if(N.length===0)return;O.length<2?A.splice(p,1):A[p]={...w,points:O};const X={...w,type:"polyline",points:N,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};A.push(X),b[E]=A,L(b),ft(b),K([A.length-1]),W([]),nt({visible:!1,x:0,y:0,target:null})},Fr=()=>{const p=Z.length>0?Z:Ie.target?.type==="point"?[Ie.target.path||[Ie.target.index]]:[];if(p.length===0)return;const b=[..._],A=[...b[E]],w={};p.forEach(O=>{const X=Array.isArray(O)?O:[O];if(U.length===1){const z=U[0];w[z]||(w[z]=[]),w[z].push(X)}else if(Ie.target?.shapeIndex!==void 0){const z=Ie.target.shapeIndex;w[z]||(w[z]=[]),w[z].push(X)}});const C=(O,X)=>{if(O.type==="group")return O.shapes=O.shapes.map((z,H)=>{const G=X.filter(ne=>ne[0]===H).map(ne=>ne.slice(1));return G.length>0?C({...z},G):z}).filter(z=>!!z),O.shapes.length>0?O:null;{if(!O.points)return null;const z=X.map(G=>G[0]),H=O.points.filter((G,ne)=>!z.includes(ne));return H.length<2?null:{...O,points:H}}};let N=!1;Object.keys(w).forEach(O=>{const X=parseInt(O),z=C(A[X],w[O]);z?A[X]=z:A.splice(X,1),N=!0}),N&&(b[E]=A,L(b),ft(b),W([])),nt({visible:!1,x:0,y:0,target:null})},wr=()=>{if(!Ie.target||Ie.target.type!=="segment")return;const{shapeIndex:p,index:b}=Ie.target,A=[..._],w=[...A[E]],C={...w[p]};if(C.type==="line"||C.type==="rect"||C.type==="circle"||C.type==="star")w.splice(p,1),K([]);else if(C.points){if(C.type==="polygon"){const N=[];for(let O=0;O<C.points.length;O++)N.push(C.points[(b+1+O)%C.points.length]);C.points=N,C.type="polyline",w[p]=C}else if(C.type==="polyline"||C.type==="pen"){const N=C.points.slice(0,b+1),O=C.points.slice(b+1);w.splice(p,1),N.length>1&&w.push({...C,points:N}),O.length>1&&w.push({...C,points:O}),K([])}else if(C.type==="bezier"){const N=[...C.points];N.splice(b,2),N.length<3?w.splice(p,1):(C.points=N,w[p]=C),K([])}}A[E]=w,L(A),ft(A),nt({visible:!1,x:0,y:0,target:null})},Rn=()=>{if(!Ie.target||Ie.target.type!=="segment")return;const{shapeIndex:p,index:b,pos:A}=Ie.target,w=[..._],C=[...w[E]],N={...C[p]};if(N.points){const O=[...N.points];O.splice(b+1,0,{...A,color:i}),C[p]={...N,points:O}}else N.type==="line"&&(C[p]={type:"polyline",color:N.color,renderMode:N.renderMode||"simple",points:[{x:N.start.x,y:N.start.y,color:N.startColor||N.color},{x:A.x,y:A.y,color:i},{x:N.end.x,y:N.end.y,color:N.endColor||N.color}],rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1});w[E]=C,L(w),ft(w),nt({visible:!1,x:0,y:0,target:null})},Ws=()=>{if(!Ie.target||Ie.target.shapeIndex===void 0)return;const{shapeIndex:p}=Ie.target,b=[..._],A=[...b[E]],w=A[p];if(["rect","circle","star","line"].includes(w.type)){const C=Ut(w),N={type:w.type==="line"?"polyline":"polygon",color:w.color,renderMode:w.renderMode||"simple",points:C,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};A[p]=N,b[E]=A,L(b),ft(b)}nt({visible:!1,x:0,y:0,target:null})},Zs=()=>{if(U.length===0)return;const p=[..._],b=[...p[E]];U.forEach(A=>{const w={...b[A]};delete w.pivotX,delete w.pivotY,b[A]=w}),p[E]=b,L(p),ft(p),nt({visible:!1,x:0,y:0,target:null})},Na=R.useCallback(p=>ar(p),[]),Ga=R.useCallback(p=>Vs(p),[]),fs=R.useCallback(p=>la(p),[]),Pr=R.useCallback(p=>ea(p),[]),ka=R.useCallback(p=>Sa(p),[]),ma=R.useCallback(p=>Ve(p),[]),aa=(p,b,A=1)=>{p.preventDefault();const w=p.deltaY<0?A:-A;b(C=>Math.max(0,C+w))},Qs=p=>aa(p,Vs),Ar=p=>aa(p,Sa),ds=p=>aa(p,ea,.1),cl=p=>{p.preventDefault();const b=p.deltaY<0?1:-1;Et(A=>Math.max(0,A+b))},zr=p=>{p.preventDefault();const b=p.deltaY<0?1:-1;qn(A=>Math.max(0,A+b))},ps=p=>{p.preventDefault();const b=p.deltaY<0?1:-1;nr(A=>Math.max(0,Math.min(v-1,A+b)))},tn=()=>{if(fn>=it){alert("Start frame must be before end frame");return}const p=[..._],b=_[fn],A=_[it];if(!b||!A||b.length===0||A.length===0){alert("Both start and end frames must contain shapes");return}const w=it-fn;for(let C=1;C<w;C++){const N=C/w,O=fn+C,X=[];b.forEach((z,H)=>{const G=A[H];if(!G||z.type!==G.type){X.push(N<.5?JSON.parse(JSON.stringify(z)):JSON.parse(JSON.stringify(G)));return}const ne=JSON.parse(JSON.stringify(z));if(Xt&&(z.start&&G.start&&(ne.start.x=z.start.x+(G.start.x-z.start.x)*N,ne.start.y=z.start.y+(G.start.y-z.start.y)*N),z.end&&G.end&&(ne.end.x=z.end.x+(G.end.x-z.end.x)*N,ne.end.y=z.end.y+(G.end.y-z.end.y)*N),z.width!==void 0&&G.width!==void 0&&(ne.width=z.width+(G.width-z.width)*N),z.height!==void 0&&G.height!==void 0&&(ne.height=z.height+(G.height-z.height)*N),ne.scaleX=(z.scaleX??1)+((G.scaleX??1)-(z.scaleX??1))*N,ne.scaleY=(z.scaleY??1)+((G.scaleY??1)-(z.scaleY??1))*N,ne.rotationX=(z.rotationX??0)+((G.rotationX??0)-(z.rotationX??0))*N,ne.rotationY=(z.rotationY??0)+((G.rotationY??0)-(z.rotationY??0))*N,ne.rotationZ=(z.rotationZ??0)+((G.rotationZ??0)-(z.rotationZ??0))*N,z.rotation!==void 0&&G.rotation!==void 0&&(ne.rotation=z.rotation+(G.rotation-z.rotation)*N)),dn){const ae=kn(z.color),le=kn(G.color),he=Math.round(ae.r+(le.r-ae.r)*N),pe=Math.round(ae.g+(le.g-ae.g)*N),Se=Math.round(ae.b+(le.b-ae.b)*N);ne.color=`rgb(${he},${pe},${Se})`}z.points&&G.points&&z.points.length===G.points.length&&(ne.points=z.points.map((ae,le)=>{const he=G.points[le];let pe=ae.x,Se=ae.y,Me=ae.z||0,we=ae.color||z.color;if(Xt&&(pe=ae.x+(he.x-ae.x)*N,Se=ae.y+(he.y-ae.y)*N,Me=(ae.z||0)+((he.z||0)-(ae.z||0))*N),dn){const Re=kn(ae.color||z.color),Pe=kn(he.color||G.color),et=Math.round(Re.r+(Pe.r-Re.r)*N),ct=Math.round(Re.g+(Pe.g-Re.g)*N),mt=Math.round(Re.b+(Pe.b-Re.b)*N);we=`rgb(${et},${ct},${mt})`}return{x:pe,y:Se,z:Me,color:we}})),X.push(ne)}),p[O]=X}L(p),ft(p),alert("Interpolation complete!")},ir=()=>{if(U.length!==1)return;const p=qe[U[0]];if(!p||!p.points)return;const b=[];for(let A=1;A<p.points.length;A+=2)b.push(A);W(b)},ra=()=>{if(U.length!==1)return;const p=qe[U[0]];if(!p||!p.points)return;const b=[];for(let A=0;A<p.points.length;A+=2)b.push(A);W(b)},Ks=()=>{if(U.length!==1)return;const p=qe[U[0]];if(!p||!p.points)return;const b=[];for(let A=0;A<p.points.length;A++)Z.includes(A)||b.push(A);W(b)},Js=()=>{if(U.length!==1||Z.length===0)return;const p=qe[U[0]];if(!p||!p.points)return;const b=new Set(Z);Z.forEach(A=>{A>0&&b.add(A-1),A<p.points.length-1&&b.add(A+1),(p.type==="polygon"||p.type==="rect"||p.type==="circle"||p.type==="star")&&(A===0&&b.add(p.points.length-1),A===p.points.length-1&&b.add(0))}),W(Array.from(b).sort((A,w)=>A-w))},Ei=()=>{if(U.length!==1||Z.length===0)return;const p=qe[U[0]];if(!p||!p.points)return;const b=Z.filter(A=>{const w=A===0&&(p.type==="polygon"||p.type==="rect")?p.points.length-1:A-1,C=A===p.points.length-1&&(p.type==="polygon"||p.type==="rect")?0:A+1;return Z.includes(w)&&Z.includes(C)});W(b)},Gr=async()=>{if(!window.electronAPI)return;const p=await window.electronAPI.showOpenDialog({title:"Select Background Image",filters:[{name:"Images",extensions:["jpg","png","png","webp","bmp"]}],properties:["openFile"]});if(!p)return;const b=new Image;b.onload=()=>{ue(b)},b.src=`file://${p}`},Dn=()=>{if(U.length===0)return;const p=[..._],b=[...p[E]],A=15/Q,w=C=>{let N=[];return C.points?N=[...C.points]:N=Ut(C),{...C,type:"polyline",points:N,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}};if(U.length===1){const C=U[0],N={...b[C]};if(N.points||(N.points=Ut(N),N.rotationX=0,N.rotationY=0,N.rotationZ=0,N.scaleX=1,N.scaleY=1),Z.length===2){const[O,X]=[...Z].sort((G,ne)=>G-ne),z=[],H=N.points.length;for(let G=0;G<H;G++)z.push(N.points[(O+G)%H]);N.points=z,N.type="polygon"}else N.type="polygon";b[C]=N}else{const N=[...U].sort((O,X)=>X-O).map(O=>w(b.splice(O,1)[0]));if(N.length>0){let O=N.pop();for(;N.length>0;){let X=1/0,z=-1,H="end-end",G=!1,ne=!1,ae=-1;const le=O.points[0],he=O.points[O.points.length-1];if(N.forEach((Se,Me)=>{const we=Se.points[0],Re=Se.points[Se.points.length-1],Pe=en(he,we),et=en(he,Re),ct=en(le,we),mt=en(le,Re);if(Pe<X&&(X=Pe,z=Me,H="end-end",G=!1,ne=!1),et<X&&(X=et,z=Me,H="end-end",G=!1,ne=!0),ct<X&&(X=ct,z=Me,H="end-end",G=!0,ne=!1),mt<X&&(X=mt,z=Me,H="end-end",G=!0,ne=!0),X>A)for(let ht=0;ht<O.points.length;ht++){const st=O.points[ht],Tn=en(st,we),Ot=en(st,Re);Tn<X&&(X=Tn,z=Me,H="mid-insert",ae=ht,ne=!1),Ot<X&&(X=Ot,z=Me,H="mid-insert",ae=ht,ne=!0)}}),z===-1)break;const pe=N.splice(z,1)[0];if(H==="end-end")G&&O.points.reverse(),ne&&pe.points.reverse(),O.points=[...O.points,...pe.points];else{ne&&pe.points.reverse();const Se=[...pe.points].reverse();Se.shift();const Me=[...pe.points,...Se],we=O.points.slice(0,ae+1),Re=O.points.slice(ae+1);O.points=[...we,...Me,...Re]}}b.push(O)}}p[E]=b,L(p),ft(p),K([b.length-1]),W([])},sa=(p,b=!1,A=!1)=>{if(!p||p.length<2)return p;const w=[],C=N=>A?p[(N+p.length)%p.length]:p[Math.max(0,Math.min(p.length-1,N))];for(let N=0;N<p.length;N++){if(!A&&N===p.length-1){w.push(p[N]);break}const O=C(N-1),X=C(N),z=C(N+1),H=C(N+2);if(w.push(X),b){const he=-.0625*O.x+.5625*X.x+.5625*z.x+-.0625*H.x,pe=-.0625*O.y+.5625*X.y+.5625*z.y+-.0625*H.y,Se=kn(X.color||"#ffffff"),Me=kn(z.color||"#ffffff");Math.round((Se.r+Me.r)/2),Math.round((Se.g+Me.g)/2),Math.round((Se.b+Me.b)/2),w.push({x:he,y:pe,color:X.color})}else{const G=(X.x+z.x)/2,ne=(X.y+z.y)/2;w.push({x:G,y:ne,color:X.color})}}return w},Xn=(p=!1)=>{if(U.length===0)return;const b=[..._],A=[...b[E]];let w=!1;const C=(N,O,X)=>{if(!X||X.length===0)return!0;const z=N,H=(N+1)%O;return X.includes(z)&&X.includes(H)};U.forEach(N=>{const O={...A[N]};let X=[];if(Z.length>0&&Z.forEach(z=>{const H=Array.isArray(z)?z:[z];H.length===1&&X.push(H[0])}),O.type==="pen"||O.type==="polyline"||O.type==="polygon")if(X.length>0){const z=O.points,H=[],G=O.type==="polygon",ne=z.length;for(let ae=0;ae<ne;ae++){if(!G&&ae===ne-1){H.push(z[ae]);break}if(H.push(z[ae]),C(ae,ne,X)){const le=z[ae],he=z[(ae+1)%ne];if(p){const pe=ht=>z[(ht+ne)%ne],Se=G?pe(ae-1):ae>0?z[ae-1]:le,Me=G?pe(ae+2):ae<ne-2?z[ae+2]:he,we=-.0625,Re=.5625,Pe=.5625,et=-.0625,ct=we*Se.x+Re*le.x+Pe*he.x+et*Me.x,mt=we*Se.y+Re*le.y+Pe*he.y+et*Me.y;H.push({x:ct,y:mt,color:le.color})}else{const pe=(le.x+he.x)/2,Se=(le.y+he.y)/2;H.push({x:pe,y:Se,color:le.color})}}}O.points=H,A[N]=O,w=!0}else{const z=O.type==="polygon";O.points=sa(O.points,p,z),A[N]=O,w=!0}else if(O.type==="circle"||O.type==="star"||O.type==="rect"){const z=Ut(O),H={type:"polygon",color:O.color,renderMode:O.renderMode,points:sa(z,p,!0),rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};A[N]=H,w=!0}}),w&&(b[E]=A,L(b),ft(b))},Fn=()=>{if(U.length===0)return;const p=[..._],b=[...p[E]];let A=!1;U.forEach(w=>{const C={...b[w]};let N=[];if(Z.length>0&&Z.forEach(O=>{const X=Array.isArray(O)?O:[O];X.length===1&&N.push(X[0])}),C.type==="pen"||C.type==="polyline"||C.type==="polygon")if(N.length>0){N.sort((X,z)=>X-z);const O=N.filter((X,z)=>z%2===1);C.points.length-O.length>=2&&(C.points=C.points.filter((X,z)=>!O.includes(z)),b[w]=C,A=!0)}else C.points.length>2&&(C.points=C.points.filter((O,X)=>X%2===0),b[w]=C,A=!0);else if(C.type==="circle"||C.type==="star"||C.type==="rect"){const O=Ut(C);let X=[];if(N.length>0){N.sort((H,G)=>H-G);const z=N.filter((H,G)=>G%2===1);X=O.filter((H,G)=>!z.includes(G))}else X=O.filter((z,H)=>H%2===0);if(X.length>=2){const z={type:"polygon",color:C.color,renderMode:C.renderMode,points:X,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};b[w]=z,A=!0}}}),A&&(p[E]=b,L(p),ft(p),Z.length>0&&W([]))},Ha=()=>{if(U.length===0)return;const p=[..._],b=[...p[E]];let A=!1;const w=.5;U.forEach(C=>{const N={...b[C]};let O=[];N.type==="pen"||N.type==="polyline"||N.type==="polygon"?O=N.points:(N.type==="circle"||N.type==="star"||N.type==="rect")&&(O=Ut(N),N.type="polygon",N.rotationX=0,N.rotationY=0,N.rotationZ=0,N.scaleX=1,N.scaleY=1);let X=[];if(Z.length>0&&Z.forEach(z=>{const H=Array.isArray(z)?z:[z];H.length===1&&X.push(H[0])}),O.length>1){const z=[O[0]];for(let H=1;H<O.length;H++)X.length===0||X.includes(H)?en(O[H],z[z.length-1])>w&&z.push(O[H]):z.push(O[H]);N.type==="polygon"&&z.length>2&&(X.length===0||X.includes(O.length-1),en(z[z.length-1],z[0])<w&&(X.length,z.pop())),z.length!==O.length&&(N.points=z,b[C]=N,A=!0)}}),A&&(p[E]=b,L(p),ft(p),Z.length>0&&W([]))},Ya=()=>{if(U.length===0)return;const p=[..._],b=[...p[E]];let A=!1;const w=150*(Math.PI/180),C=(N,O,X)=>{const z=Math.atan2(N.y-O.y,N.x-O.x),H=Math.atan2(X.y-O.y,X.x-O.x);let G=Math.abs(z-H);return G>Math.PI&&(G=2*Math.PI-G),G};U.forEach(N=>{const O={...b[N]};let X=[];O.type==="pen"||O.type==="polyline"||O.type==="polygon"?X=O.points:(O.type==="circle"||O.type==="star"||O.type==="rect")&&(X=Ut(O),O.type="polygon",O.rotationX=0,O.rotationY=0,O.rotationZ=0,O.scaleX=1,O.scaleY=1);let z=[];if(Z.length>0&&Z.forEach(H=>{const G=Array.isArray(H)?H:[H];G.length===1&&z.push(G[0])}),X.length>2){const H=[],G=O.type==="polygon"||O.type==="rect"||O.type==="circle"||O.type==="star";for(let ne=0;ne<X.length;ne++){if(H.push(X[ne]),z.length>0&&!z.includes(ne))continue;let ae,le;if(ne===0)if(G)ae=X[X.length-1];else continue;else ae=X[ne-1];if(ne===X.length-1)if(G)le=X[0];else continue;else le=X[ne+1];C(ae,X[ne],le)<w&&H.push({...X[ne]})}H.length!==X.length&&(O.points=H,b[N]=O,A=!0)}}),A&&(p[E]=b,L(p),ft(p)),nt({visible:!1,x:0,y:0,target:null})},hs=async()=>{if(!window.electronAPI)return;const p=await window.electronAPI.showOpenDialog({title:"Import ILDA",filters:[{name:"ILDA Files",extensions:["ild"]}],properties:["openFile"]});if(p){$e(!0);try{const b=await window.electronAPI.readFileAsBinary(p),{frames:A}=qv(b);if(A&&A.length>0){const w=A.map(C=>{const N=[];let O=[];if(C.points.forEach(X=>{const z=X.x*500+500,H=(1-X.y)*500,G=`rgb(${X.r},${X.g},${X.b})`;if(X.blanking){if(O.length>1){const ne=O[0];Math.sqrt(Math.pow(ne.x-z,2)+Math.pow(ne.y-H,2))<2?N.push({type:"polygon",points:O,color:O[0].color,renderMode:"simple",rotation:0}):N.push({type:"polyline",points:O,color:O[0].color,renderMode:"simple",rotation:0})}O=[]}else O.push({x:z,y:H,color:G})}),O.length>1){const X=O[0],z=O[O.length-1];Math.sqrt(Math.pow(X.x-z.x,2)+Math.pow(X.y-z.y,2))<2?N.push({type:"polygon",points:O,color:O[0].color,renderMode:"simple",rotation:0}):N.push({type:"polyline",points:O,color:O[0].color,renderMode:"simple",rotation:0})}return N});L(w),ft(w),x(w.length),M(0)}}catch(b){console.error(b)}finally{$e(!1)}}},qa=async()=>{if(!window.electronAPI)return;const p=await window.electronAPI.showOpenDialog({title:"Import SVG",filters:[{name:"SVG Files",extensions:["svg"]}],properties:["openFile"]});if(p){$e(!0);try{const b=await window.electronAPI.readFileContent(p),A=new DOMParser,w=new TextDecoder().decode(b),N=A.parseFromString(w,"image/svg+xml").querySelector("svg");if(!N)throw new Error("Invalid SVG");let O=N.getAttribute("viewBox")?.split(/[\s,]+/).map(parseFloat);if(!O||O.length!==4){const we=parseFloat(N.getAttribute("width"))||1e3,Re=parseFloat(N.getAttribute("height"))||1e3;O=[0,0,we,Re]}const[X,z,H,G]=O,ne=Math.min(At/H,At/G)*.8,ae=(At-H*ne)/2-X*ne,le=(At-G*ne)/2-z*ne,he=[],pe=document.createElement("div");pe.style.display="none",pe.innerHTML=w,document.body.appendChild(pe);const Se=pe.querySelector("svg"),Me=(we,Re=new DOMMatrix)=>{let Pe="";const et=we.tagName.toLowerCase();let ct=new DOMMatrix(we.getAttribute("transform")||"");const mt=Re.multiply(ct);if(et==="g"){Array.from(we.children).forEach(Tn=>Me(Tn,mt));return}if(et==="path")Pe=we.getAttribute("d");else if(et==="rect"){const Tn=parseFloat(we.getAttribute("x"))||0,Ot=parseFloat(we.getAttribute("y"))||0,Nt=parseFloat(we.getAttribute("width"))||0,wt=parseFloat(we.getAttribute("height"))||0;Pe=`M${Tn},${Ot} h${Nt} v${wt} h${-Nt} z`}else if(et==="circle"||et==="ellipse"){const Tn=parseFloat(we.getAttribute("cx"))||0,Ot=parseFloat(we.getAttribute("cy"))||0,Nt=parseFloat(we.getAttribute("rx"))||parseFloat(we.getAttribute("r"))||0,wt=parseFloat(we.getAttribute("ry"))||parseFloat(we.getAttribute("r"))||0;Pe=`M${Tn-Nt},${Ot} a${Nt},${wt} 0 1,0 ${Nt*2},0 a${Nt},${wt} 0 1,0 ${-Nt*2},0 z`}else et==="line"?Pe=`M${we.getAttribute("x1")},${we.getAttribute("y1")} L${we.getAttribute("x2")},${we.getAttribute("y2")}`:(et==="polyline"||et==="polygon")&&(Pe=`M${we.getAttribute("points")}${et==="polygon"?" z":""}`);if(!Pe)return;const ht=document.createElementNS("http://www.w3.org/2000/svg","path");ht.setAttribute("d",Pe),Se.appendChild(ht);const st=ht.getTotalLength();if(st>0){const Tn=[],Ot=st*ne*Math.max(mt.a,mt.d),Nt=Math.min(1e3,Math.max(10,Math.floor(Ot/5)));for(let wt=0;wt<=Nt;wt++){const Mt=ht.getPointAtLength(wt/Nt*st),nn=new DOMPoint(Mt.x,Mt.y).matrixTransform(mt);Tn.push({x:nn.x*ne+ae,y:nn.y*ne+le,color:i})}he.push({type:"polyline",points:Tn,color:i,renderMode:"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1})}};if(Array.from(N.children).forEach(we=>Me(we)),document.body.removeChild(pe),he.length>0){const we=[..._];we[E]=[...we[E]||[],...he],L(we),ft(we)}}catch(b){console.error("SVG Import Error:",b),alert("Error importing SVG: "+b.message)}finally{$e(!1)}}},ms=()=>{if(confirm("Press OK to clear ALL frames in the animation, or CANCEL to clear only the CURRENT frame.")){const b=_.map(()=>[]);L(b),ft(b)}else{const b=[..._];b[E]=[],L(b),ft(b)}K([]),W([])},Va=()=>{if(U.length===0)return;let p;if(Z.length>0&&U.length===1){const b=qe[U[0]],A=na(b);p={type:"polyline",points:Z.map(C=>({...A[C]})),color:b.color,renderMode:b.renderMode||"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else p=U.map(b=>JSON.parse(JSON.stringify(qe[b])));q({data:p,sourceFrameIndex:E}),nt({visible:!1})},Sn=()=>{if(!Ee)return;const{data:p}=Ee,b=Array.isArray(p)?JSON.parse(JSON.stringify(p)):[JSON.parse(JSON.stringify(p))],A=[..._],w=[...A[E]||[]];b.forEach(C=>{w.push(C)}),A[E]=w,L(A),ft(A),K(b.map((C,N)=>w.length-b.length+N)),W([]),nt({visible:!1})},lr=()=>{const p=[..._];p.splice(E+1,0,JSON.parse(JSON.stringify(_[E]))),L(p),ft(p),x(b=>b+1),M(b=>b+1)},Hr=()=>{if(ie>0&&$[ie-1]){const p=ie-1;oe(p),L(JSON.parse(JSON.stringify($[p])))}},Tr=()=>{if(ie<$.length-1&&$[ie+1]){const p=ie+1;oe(p),L(JSON.parse(JSON.stringify($[p])))}};R.useEffect(()=>{},[_]);const _n=p=>{if(U.length===0)return;const b=(A,w)=>{let C={...A,...w};return w.color&&(C.points&&(C.points=C.points.map(N=>({...N,color:w.color}))),C.startColor&&(C.startColor=w.color),C.endColor&&(C.endColor=w.color),C.cornerColors&&(C.cornerColors=C.cornerColors.map(()=>w.color)),C.centerColor&&(C.centerColor=w.color),C.outerColor&&(C.outerColor=w.color)),C.type==="group"&&C.shapes&&(C.shapes=C.shapes.map(N=>b(N,w))),C};L(A=>{const w=[...A],C=[...w[E]];return U.forEach(N=>{C[N]&&(C[N]=b(C[N],p))}),w[E]=C,ft(w),w})},gs=p=>{U.length!==1||Z.length===0||L(b=>{const A=[...b],w=[...A[E]],C=U[0];if(!w[C])return b;let N={...w[C]};return Z.forEach(O=>{const X=Array.isArray(O)?O:[O],z=(H,G,ne)=>{if(G.length===1){const ae=G[0],le={...H};return le.points?(le.points=[...le.points],le.points[ae]={...le.points[ae],color:ne}):le.type==="line"?ae===0?le.startColor=ne:le.endColor=ne:le.type==="rect"?(le.cornerColors=[...le.cornerColors||[le.color,le.color,le.color,le.color]],le.cornerColors[ae]=ne):(le.type==="circle"||le.type==="star")&&(ae===0?le.centerColor=ne:le.outerColor=ne),le}else{const[ae,...le]=G,he={...H};return he.shapes=[...he.shapes],he.shapes[ae]=z(he.shapes[ae],le,ne),he}};N=z(N,X,p)}),w[C]=N,A[E]=w,ft(A),A})},Yr=async()=>{if(!_.every(p=>p.length===0)){Kt(!0);try{const b=_.slice(tr).map(w=>{const C=[];return w.forEach((N,O)=>{const X=N.renderMode||"simple",z=Ut(N),H=ae=>({...ae,x:(ae.x-500)/500,y:1-ae.y/500}),G=z.map(H);if(G.length<2)return;const ne=[];for(let ae=0;ae<G.length-1;ae++){let le=X;X==="dashed"&&ae%2===1&&(le="blanked");const he=Cr(G[ae],G[ae+1],le);ae<G.length-2?ne.push(...he.slice(0,-1)):ne.push(...he)}if(N.type==="polygon"||N.type==="rect"||N.type==="circle"||N.type==="star"||N.type==="triangle"){const ae=G[0],le=G[G.length-1];if(Math.sqrt(Math.pow(ae.x-le.x,2)+Math.pow(ae.y-le.y,2))>.001){let pe=X;X==="dashed"&&(G.length-1)%2===1&&(pe="blanked");const Se=Cr(G[G.length-1],G[0],pe);Se.length>1&&ne.push(...Se.slice(1))}}ne.length>0&&(C.push({...ne[0],blanking:!0}),C.push(...ne))}),{points:C,frameName:"SHAPE"}}),A=ng(b);await window.electronAPI.saveIldaFile(A,"built_shape.ild")}catch(p){console.error(p)}finally{Kt(!1)}}},Cr=(p,b,A)=>{const w=kn(p.color||i),C=kn(b.color||i);if(A==="dotted")return[{x:p.x,y:p.y,r:w.r,g:w.g,b:w.b,blanking:!1},{x:p.x,y:p.y,r:w.r,g:w.g,b:w.b,blanking:!1}];const N=A==="blanked";return[{x:p.x,y:p.y,r:w.r,g:w.g,b:w.b,blanking:N},{x:b.x,y:b.y,r:C.r,g:C.g,b:C.b,blanking:N}]},Mr=()=>{if(I&&(I.type==="polygon"||I.type==="polyline"||I.type==="bezier")){let p={...I};if(I.type==="polygon"||I.type==="polyline"?p.points=I.points.slice(0,-1):I.type==="bezier"&&_t&&(p.anchors=I.anchors.slice(0,-1),p.points=el(p.anchors,!1)),p.type==="bezier"&&p.anchors.length>1||p.points.length>1){const b=[..._];b[E]=[...b[E]||[],p],L(b),ft(b),K([b[E].length-1])}}m(!1),V(null)},wi=p=>{if(p.button===1||p.button===0&&p.altKey){Jt.current=!0,ot.current={x:p.clientX,y:p.clientY};return}if(p.button!==0)return;const b=ln(p.clientX,p.clientY),A=Ma(b.x,b.y),w=A.x,C=A.y;if(nt({visible:!1}),e==="select"){const N=[];for(let O=qe.length-1;O>=0;O--){const X=Sr(qe[O],b,U.includes(O),Z);X&&N.push({...X,shapeIndex:O})}if(N.length>0){let O=N[0];const X=U[0];if(N.length>1&&N[0].shapeIndex===X)if(N[0].type==="point"){const G=N[0].path||[N[0].index];Z.some(ae=>JSON.stringify(ae)===JSON.stringify(G))&&(O=N[1])}else O=N[1];const z=O.shapeIndex,H=O;if(H.type==="point"){const G=H.path||[H.index];p.shiftKey?U.includes(z)?W(ne=>ne.some(le=>JSON.stringify(le)===JSON.stringify(G))?ne.filter(le=>JSON.stringify(le)!==JSON.stringify(G)):[...ne,G]):(K([z]),W([G])):(W([G]),K([z])),Xs.current=!0}else if(H.type==="segment"){const G=H.path||[H.index];p.shiftKey?U.includes(z)?Y(ne=>ne.some(le=>JSON.stringify(le)===JSON.stringify(G))?ne.filter(le=>JSON.stringify(le)!==JSON.stringify(G)):[...ne,G]):(K([z]),Y([G])):(Y([G]),K([z]),W([])),Br.current=!0}else H.type==="pivot"?Aa.current=!0:(!p.shiftKey&&!U.includes(z)?K([z]):p.shiftKey&&K(G=>G.includes(z)?G.filter(ne=>ne!==z):[...G,z]),Br.current=!0);ot.current=b}else xn.current=!0,ot.current=b,vt.current={x:b.x,y:b.y,w:0,h:0};return}if(m(!0),ot.current=b,e==="polygon"||e==="polyline"||(e==="line"||e==="bezier")&&_t)if(!I)e==="bezier"?(V({type:"bezier",color:i,renderMode:c,isSmooth:!0,anchors:[{x:w,y:C,color:i},{x:w,y:C,color:i}],points:[{x:w,y:C,color:i},{x:w,y:C,color:i},{x:w,y:C,color:i},{x:w,y:C,color:i}],rotation:0}),Zt(-1)):V({type:e==="polygon"?"polygon":"polyline",color:i,renderMode:c,points:[{x:w,y:C,color:i},{x:w,y:C,color:i}],rotation:0});else{const N=I.type==="bezier"?I.anchors[0]:I.points[0];if(en({x:w,y:C},N)<15/Q&&(I.type==="bezier"&&I.anchors.length>2||I.points.length>3)){let X={...I};I.type==="bezier"?(X.anchors=I.anchors.slice(0,-1),X.closed=!0,X.points=el(X.anchors,!0)):(X.points=I.points.slice(0,-1),X.type="polygon");const z=[..._];z[E]=[...z[E]||[],X],L(z),ft(z),K([z[E].length-1]),m(!1),V(null);return}if(e==="bezier"){const X=[...I.anchors,{x:w,y:C,color:i}],z=el(X,!1);V(H=>({...H,anchors:X,points:z}))}else V(X=>({...X,points:[...X.points,{x:w,y:C,color:i}]}))}else{const N={type:e,color:i,renderMode:c,start:{x:w,y:C},end:{x:w,y:C},width:0,height:0,rotation:0,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0};if(e==="pen")N.points=[{x:w,y:C,color:i},{x:w,y:C,color:i}];else if(e==="bezier"){const O=[{x:w,y:C,color:i},{x:w,y:C,color:i}],X=el(O,!1);N.isSmooth=!0,N.anchors=O,N.points=X}V(N)}},$n=R.useCallback((p,b,A)=>{const w={...p};return p.type==="group"?w.shapes=p.shapes.map(C=>$n(C,b,A)):(p.points&&(w.points=p.points.map(C=>({...C,x:C.x+b,y:C.y+A}))),p.anchors&&(w.anchors=p.anchors.map(C=>({...C,x:C.x+b,y:C.y+A}))),p.start&&(w.start={...p.start,x:p.start.x+b,y:p.start.y+A}),p.end&&(w.end={...p.end,x:p.end.x+b,y:p.end.y+A})),p.pivotX!==void 0&&(w.pivotX=p.pivotX+b),p.pivotY!==void 0&&(w.pivotY=p.pivotY+A),w},[]),qr=R.useCallback((p,b,A,w)=>{if(b.length===1){const C=b[0],N={...p};if(N.type==="line")C===0?N.start={...N.start,x:N.start.x+A,y:N.start.y+w}:N.end={...N.end,x:N.end.x+A,y:N.end.y+w};else if(N.type==="rect")C===0?(N.start={...N.start,x:N.start.x+A,y:N.start.y+w},N.width-=A,N.height-=w):C===1?(N.start={...N.start,y:N.start.y+w},N.width+=A,N.height-=w):C===2?(N.width+=A,N.height+=w):C===3&&(N.start={...N.start,x:N.start.x+A},N.width-=A,N.height+=w);else if(N.type==="circle"||N.type==="star"||N.type==="triangle")C===0?N.start={...N.start,x:N.start.x+A,y:N.start.y+w}:C===1?N.end={...N.end,x:N.end.x+A}:C===2&&(N.end={...N.end,y:N.end.y+w});else if(N.points&&(N.points=[...N.points],N.points[C]&&(N.points[C]={...N.points[C],x:N.points[C].x+A,y:N.points[C].y+w},N.type==="bezier"&&N.isSmooth)))if(C%3!==0)N.manualIndices||(N.manualIndices=[]),N.manualIndices.includes(C)||N.manualIndices.push(C);else{const X=C/3;N.anchors&&N.anchors[X]&&(N.anchors[X].x+=A,N.anchors[X].y+=w,el(N.anchors,N.closed).forEach((H,G)=>{N.manualIndices&&N.manualIndices.includes(G)||(N.points[G].x=H.x,N.points[G].y=H.y)}))}return N}else{const[C,...N]=b,O={...p};return O.shapes=[...O.shapes],O.shapes[C]=qr(O.shapes[C],N,A,w),O}},[]),Ai=p=>{const b=ln(p.clientX,p.clientY);if(Jt.current){const N=(p.clientX-ot.current.x)/Q,O=(p.clientY-ot.current.y)/Q;ve(X=>({x:X.x+N,y:X.y+O})),ot.current={x:p.clientX,y:p.clientY};return}if(sr.current&&U.length>0){const N=Bn(qe[U[0]]);_n({rotationZ:Math.atan2(b.y-N.y,b.x-N.x)+Math.PI/2});return}if(xn.current){vt.current={x:Math.min(ot.current.x,b.x),y:Math.min(ot.current.y,b.y),w:Math.abs(b.x-ot.current.x),h:Math.abs(b.y-ot.current.y)},xe(N=>N+1);return}if(Br.current){const N=b.x-ot.current.x,O=b.y-ot.current.y,X=qe[U[0]],z=pa(X),H=Ma(z.x+N,z.y+O),G=H.x-z.x,ne=H.y-z.y;(G!==0||ne!==0)&&(L(ae=>{const le=[...ae],he=[...le[E]];return U.forEach(pe=>{he[pe]=$n({...he[pe]},G,ne)}),le[E]=he,le}),ot.current.x+=G,ot.current.y+=ne);return}if(Aa.current&&U.length===1){const N=Ma(b.x,b.y);L(O=>{const X=[...O],z=[...X[E]];return z[U[0]]={...z[U[0]],pivotX:N.x,pivotY:N.y},X[E]=z,X});return}if(Xs.current&&U.length===1){const N=b.x-ot.current.x,O=b.y-ot.current.y,X=qe[U[0]],z=Z[0],H=xr(X,z);if(H){const G=Ma(H.x+N,H.y+O,Z),ne=G.x-H.x,ae=G.y-H.y;(ne!==0||ae!==0)&&(L(le=>{const he=[...le],pe=[...he[E]];let Se={...pe[U[0]]};return Z.forEach(Me=>{const we=Array.isArray(Me)?Me:[Me];Se=qr(Se,we,ne,ae)}),pe[U[0]]=Se,he[E]=pe,he}),ot.current.x+=ne,ot.current.y+=ae)}return}if(!g)return;const A=Ma(b.x,b.y),w=A.x,C=A.y;V(N=>{if(!N)return null;const O={...N},X=p.shiftKey;if(e==="pen")O.points=[...N.points,{x:w,y:C,color:i}];else if(e==="bezier"){const z=[...O.anchors],H=z.length-1;z[H]={x:w,y:C,color:i},O.anchors=z,O.points=el(z,!1)}else if(O.type==="polyline"||O.type==="polygon"){const z=[...O.points];let H=w,G=C;if(X){const ne=z[z.length-2];Math.abs(w-ne.x)>Math.abs(C-ne.y)?G=ne.y:H=ne.x}z[z.length-1]={x:H,y:G,color:i},O.points=z}else if(e==="line"){let z=w,H=C;X&&(Math.abs(w-ot.current.x)>Math.abs(C-ot.current.y)?H=ot.current.y:z=ot.current.x),O.end={x:z,y:H}}else if(e==="circle"||e==="star"||e==="triangle"){let z=w,H=C;if(X){const G=Math.max(Math.abs(w-ot.current.x),Math.abs(C-ot.current.y));z=ot.current.x+(w>=ot.current.x?G:-G),H=ot.current.y+(C>=ot.current.y?G:-G)}O.end={x:z,y:H}}else if(e==="rect"){let z=w-ot.current.x,H=C-ot.current.y;if(X){const G=Math.max(Math.abs(z),Math.abs(H));z=z>0?G:-G,H=H>0?G:-G}O.width=z,O.height=H}return O})},Vr=p=>{if(xn.current&&vt.current){const w=vt.current,C=p.shiftKey;if(w.w<5/Q&&w.h<5/Q)C||(K([]),W([]),Y([]));else if(U.length===1){const N=U[0],O=qe[N],X=na(O),z=[];if(X.forEach((H,G)=>{H.x>=w.x&&H.x<=w.x+w.w&&H.y>=w.y&&H.y<=w.y+w.h&&z.push(G)}),z.length>0)W(C?H=>Array.from(new Set([...H,...z])).sort((G,ne)=>G-ne):z);else{const H=[];qe.forEach((G,ne)=>{if(G.hidden||G.locked)return;const ae=da(G);ae.x<w.x+w.w&&ae.x+ae.w>w.x&&ae.y<w.y+w.h&&ae.y+ae.h>w.y&&H.push(ne)}),C?K(G=>Array.from(new Set([...G,...H]))):(K(H),W([]))}}else{const N=[];qe.forEach((O,X)=>{if(O.hidden||O.locked)return;const z=da(O);z.x<w.x+w.w&&z.x+z.w>w.x&&z.y<w.y+w.h&&z.y+z.h>w.y&&N.push(X)}),C?K(O=>Array.from(new Set([...O,...N]))):(K(N),W([]))}}if((Xs.current||Br.current||Aa.current)&&ft(_),Xs.current=!1,Br.current=!1,Aa.current=!1,sr.current=!1,xn.current=!1,Jt.current=!1,vt.current=null,!g)return;const b=I.type==="polygon"||I.type==="polyline",A=I.type==="bezier"&&_t;if(I&&!b&&!A){const w=[..._];w[E]=[...w[E]||[],I],L(w),ft(w),K([w[E].length-1]),m(!1),V(null)}},ys=(p,b,A,w=!1,C=[])=>{if(!b||b.hidden)return;if(p.save(),b.type==="group"){if(b.shapes.forEach((H,G)=>ys(p,H,!1,w,[...C,G])),p.restore(),A&&!w){p.save();const H=pa(b),G=Bn(b);p.fillStyle="#0089ff",p.beginPath(),p.arc(H.x,H.y,6/Q,0,Math.PI*2),p.fill(),p.strokeStyle="white",p.lineWidth=1/Q,p.stroke();const ne=da(b);p.beginPath(),p.moveTo(H.x,ne.y),p.lineTo(H.x,ne.y-30/Q),p.strokeStyle="white",p.stroke(),p.beginPath(),p.arc(H.x,ne.y-30/Q,6/Q,0,Math.PI*2),p.fillStyle="#0089ff",p.fill(),p.stroke(),p.strokeStyle="var(--theme-color)",p.lineWidth=2/Q,p.beginPath(),p.moveTo(G.x-10/Q,G.y),p.lineTo(G.x+10/Q,G.y),p.moveTo(G.x,G.y-10/Q),p.lineTo(G.x,G.y+10/Q),p.stroke(),p.beginPath(),p.arc(G.x,G.y,5/Q,0,Math.PI*2),p.stroke(),p.restore()}return}const N=pa(b);p.lineWidth=(A?2.5:1.5)/Q;const O=(H,G,ne="simple",ae=[])=>{if(!H||H.length<2)return;if(re.length>0){p.save(),p.lineWidth=6/Q,p.globalAlpha=.6,p.lineCap="round";for(let he=0;he<H.length-1;he++){const pe=[...ae,he];re.some(Me=>JSON.stringify(Me)===JSON.stringify(pe))&&(p.strokeStyle=ta(H[he].color||b.color),p.beginPath(),p.moveTo(H[he].x,H[he].y),p.lineTo(H[he+1].x,H[he+1].y),p.stroke())}if(G&&H.length>2){const he=H.length-1,pe=[...ae,he];re.some(Me=>JSON.stringify(Me)===JSON.stringify(pe))&&(p.strokeStyle=ta(H[he].color||b.color),p.beginPath(),p.moveTo(H[he].x,H[he].y),p.lineTo(H[0].x,H[0].y),p.stroke())}p.restore()}let le=!1;p.beginPath(),H[0]&&p.moveTo(H[0].x,H[0].y);for(let he=0;he<H.length-1;he++){if(ne==="dashed"&&he%2===1){le&&(p.stroke(),le=!1),p.moveTo(H[he+1].x,H[he+1].y);continue}const pe=H[he],Se=H[he+1];if(!pe||!Se)continue;const Me=w?"#444":pe.color||b.color,we=w?"#444":Se.color||b.color;if(Me!==we){le&&(p.stroke(),le=!1);const Re=p.createLinearGradient(pe.x,pe.y,Se.x,Se.y);Re.addColorStop(0,Me),Re.addColorStop(1,we),p.strokeStyle=Re,p.beginPath(),p.moveTo(pe.x,pe.y),p.lineTo(Se.x,Se.y),p.stroke(),p.beginPath(),p.moveTo(Se.x,Se.y)}else p.strokeStyle!==Me&&(le&&(p.stroke(),p.beginPath(),p.moveTo(pe.x,pe.y)),p.strokeStyle=Me),p.lineTo(Se.x,Se.y),le=!0}if(G&&H.length>2){const he=H.length-1;if(ne==="dashed"&&he%2===1)le&&p.stroke();else{const pe=H[he],Se=H[0],Me=w?"#444":pe.color||b.color,we=w?"#444":Se.color||b.color;if(Me!==we){le&&p.stroke();const Re=p.createLinearGradient(pe.x,pe.y,Se.x,Se.y);Re.addColorStop(0,Me),Re.addColorStop(1,we),p.strokeStyle=Re,p.beginPath(),p.moveTo(pe.x,pe.y),p.lineTo(Se.x,Se.y),p.stroke()}else p.strokeStyle!==Me&&le&&(p.stroke(),p.beginPath(),p.moveTo(pe.x,pe.y),p.strokeStyle=Me),p.lineTo(Se.x,Se.y),p.stroke(),le=!1}}else le&&p.stroke();ne==="dotted"&&H.forEach(he=>{p.fillStyle=w?"#444":he.color||b.color,p.beginPath(),p.arc(he.x,he.y,3/Q,0,Math.PI*2),p.fill()})},X=(H,G,ne="simple",ae=[])=>{if(!H||!G)return;const le=[...ae,0];if(re.some(Me=>JSON.stringify(Me)===JSON.stringify(le))&&(p.save(),p.strokeStyle=ta(H.color||b.color),p.lineWidth=6/Q,p.globalAlpha=.6,p.lineCap="round",p.beginPath(),p.moveTo(H.x,H.y),p.lineTo(G.x,G.y),p.stroke(),p.restore()),ne==="dotted"){[H,G].forEach(Me=>{p.fillStyle=w?"#444":Me.color||b.color,p.beginPath(),p.arc(Me.x,Me.y,3/Q,0,Math.PI*2),p.fill()});return}const pe=w?"#444":H.color||b.color,Se=w?"#444":G.color||b.color;if(pe===Se)p.strokeStyle=pe;else{const Me=p.createLinearGradient(H.x,H.y,G.x,G.y);Me.addColorStop(0,pe),Me.addColorStop(1,Se),p.strokeStyle=Me}p.beginPath(),p.moveTo(H.x,H.y),p.lineTo(G.x,G.y),p.stroke()};if(b.renderMode==="points"){Ut({...b,rotation:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}).forEach(H=>{p.fillStyle=w?"#444":H.color||b.color,p.beginPath(),p.arc(H.x,H.y,3/Q,0,Math.PI*2),p.fill()}),p.restore();return}const z=b.renderMode||"simple";switch(b.type){case"pen":case"polyline":case"bezier":{const H=Ut(b);O(H,!1,z,C);break}case"polygon":{const H=Ut(b);O(H,!0,z,C);break}case"line":{const H=Ut(b);X(H[0],H[1],z,C);break}case"rect":{const H=Ut(b);O(H,!0,z,C);break}case"circle":{const H=Ut(b);O(H,!0,z,C);break}case"star":{const H=Ut(b);O(H,!0,z,C);break}}if(A&&!w){const H=na(b);if(b.type==="bezier"){p.save(),p.setLineDash([5/Q,5/Q]),p.strokeStyle="rgba(255,255,255,0.3)",p.lineWidth=1/Q;for(let ae=0;ae<=H.length-4;ae+=3)p.beginPath(),p.moveTo(H[ae].x,H[ae].y),p.lineTo(H[ae+1].x,H[ae+1].y),p.stroke(),p.beginPath(),p.moveTo(H[ae+2].x,H[ae+2].y),p.lineTo(H[ae+3].x,H[ae+3].y),p.stroke();p.restore()}H.forEach((ae,le)=>{const he=[...C,le],pe=Z.some(Me=>{const we=Array.isArray(Me)?Me:[Me];return JSON.stringify(we)===JSON.stringify(he)});let Se=!1;if(b.type==="bezier"&&(Se=le%3!==0),p.fillStyle=pe?"var(--theme-color)":Se?"#888":"white",p.beginPath(),Se){const Me=4/Q;p.rect(ae.x-Me,ae.y-Me,Me*2,Me*2)}else p.arc(ae.x,ae.y,5/Q,0,Math.PI*2);p.fill(),p.strokeStyle=pe?"white":"black",p.lineWidth=1/Q,p.stroke()});const G=Math.min(...H.map(ae=>ae.y));p.beginPath(),p.moveTo(N.x,G),p.lineTo(N.x,G-30/Q),p.strokeStyle="white",p.stroke(),p.beginPath(),p.arc(N.x,G-30/Q,6/Q,0,Math.PI*2),p.fillStyle="#0089ff",p.fill(),p.stroke();const ne=Bn(b);p.strokeStyle="var(--theme-color)",p.lineWidth=2/Q,p.beginPath(),p.moveTo(ne.x-10/Q,ne.y),p.lineTo(ne.x+10/Q,ne.y),p.moveTo(ne.x,ne.y-10/Q),p.lineTo(ne.x,ne.y+10/Q),p.stroke(),p.beginPath(),p.arc(ne.x,ne.y,5/Q,0,Math.PI*2),p.stroke()}p.restore()};R.useEffect(()=>{const p=Dt.current;if(!p)return;const b=p.getContext("2d");let A;const w=()=>{if(Dt.current){if(b.save(),b.clearRect(0,0,p.width,p.height),b.translate(p.width/2,p.height/2),b.scale(Q,Q),b.translate(-At/2+ke.x,-At/2+ke.y),b.fillStyle="#000",b.fillRect(0,0,At,At),_e){b.beginPath(),b.strokeStyle="#222",b.lineWidth=.5/Q;for(let C=0;C<=At;C+=Je)b.moveTo(C,0),b.lineTo(C,At);for(let C=0;C<=At;C+=Je)b.moveTo(0,C),b.lineTo(At,C);b.stroke(),b.beginPath(),b.strokeStyle="#444",b.lineWidth=1/Q,b.moveTo(At/2,0),b.lineTo(At/2,At),b.moveTo(0,At/2),b.lineTo(At,At/2),b.stroke()}ee&&(b.globalAlpha=.3,b.drawImage(ee,0,0,At,At),b.globalAlpha=1),P&&E>0&&!D&&_[E-1]&&(b.globalAlpha=.15,_[E-1].forEach(C=>ys(b,C,!1,!0)),b.globalAlpha=1),qe.length>0&&qe.forEach((C,N)=>ys(b,C,U.includes(N))),g&&I&&ys(b,I,!1),xn.current&&vt.current&&(b.fillStyle="rgba(0, 137, 255, 0.3)",b.fillRect(vt.current.x,vt.current.y,vt.current.w,vt.current.h),b.strokeStyle="#0089ff",b.lineWidth=2/Q,b.setLineDash([]),b.strokeRect(vt.current.x,vt.current.y,vt.current.w,vt.current.h)),b.restore(),A=requestAnimationFrame(w)}};return A=requestAnimationFrame(w),()=>cancelAnimationFrame(A)},[_,E,I,g,ee,_e,Je,U,Z,re,P,D,Q,ke,Ue]),R.useEffect(()=>{if(!D||v<=1){Ct.current=0;return}let p;dt.current=performance.now();const b=A=>{const w=A-dt.current;if(dt.current=A,w>500||w<=0){p=requestAnimationFrame(b);return}Ct.current+=w;const C=Ea.current,N=Math.max(.01,oa.current),O=Math.max(1,sn.current),X=Gt.current,z=Math.max(1,O-X);let H=33.33;if(C==="fps"?H=1e3/(Math.max(1,ua.current)*N):C==="bpm"?H=6e4/Math.max(1,jn.current)*Math.max(1,fa.current)/z/N:C==="time"&&(H=Math.max(.1,ca.current)*1e3/z/N),H=Math.max(1,H),Ct.current>=H){const G=Math.floor(Ct.current/H);G>0&&(M(ne=>{const ae=ne+G;return ae>=O?X+(ae-X)%z:ae}),Ct.current-=G*H)}p=requestAnimationFrame(b)};return p=requestAnimationFrame(b),()=>{p&&cancelAnimationFrame(p)}},[D,v]),R.useEffect(()=>{const p=wa.current;if(p)return p.addEventListener("wheel",$s,{passive:!1}),()=>p.removeEventListener("wheel",$s)},[Q]),R.useEffect(()=>{S(v)},[v]),R.useEffect(()=>{L(p=>{const b=[...p];if(v>p.length)for(let A=p.length;A<v;A++)b.push([]);else if(v<p.length)return b.slice(0,v);return b})},[v]),R.useEffect(()=>{const p=b=>{nt({visible:!1,x:0,y:0,target:null}),g&&I&&b.target!==Dt.current&&Mr()};return window.addEventListener("click",p),()=>window.removeEventListener("click",p)},[g,I]),R.useEffect(()=>{D||(K([]),W([]),Y([]))},[E,D]),R.useEffect(()=>{const p=b=>{const A=["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)||document.activeElement.isContentEditable;if((b.ctrlKey||b.metaKey)&&b.key==="z")A||(b.preventDefault(),Hr());else if((b.ctrlKey||b.metaKey)&&b.key==="y")A||(b.preventDefault(),Tr());else if((b.ctrlKey||b.metaKey)&&b.key==="c")A||(b.preventDefault(),Va());else if((b.ctrlKey||b.metaKey)&&b.key==="v")A||(b.preventDefault(),Sn());else if(b.key===" "||b.code==="Space")A||(b.preventDefault(),j(w=>!w));else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(b.key)){if(!A){const w=U.length>0||Z.length>0;if(!w&&(b.key==="ArrowLeft"||b.key==="ArrowRight"))b.preventDefault(),b.key==="ArrowLeft"?M(C=>Math.max(0,C-1)):M(C=>Math.min(v-1,C+1));else if(w){b.preventDefault();const C=b.shiftKey?10:1;let N=0,O=0;b.key==="ArrowLeft"?N=-C:b.key==="ArrowRight"?N=C:b.key==="ArrowUp"?O=-C:b.key==="ArrowDown"&&(O=C),L(X=>{const z=[...X],H=[...z[E]];if(Z.length>0&&U.length===1){const G=U[0];let ne={...H[G]};Z.forEach(ae=>{const le=Array.isArray(ae)?ae:[ae];ne=qr(ne,le,N,O)}),H[G]=ne}else U.forEach(G=>{H[G]&&(H[G]=$n({...H[G]},N,O))});return z[E]=H,ft(z),z})}}}else if((b.key==="Delete"||b.key==="Backspace")&&!A&&U.length>0){const w=[..._];w[E]=w[E].filter((C,N)=>!U.includes(N)),L(w),ft(w),K([]),W([])}};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[_,E,U,Z,Ee,$,ie,D,v,$n,qr]);const ul=({currentFrame:p,frameCount:b,syncMode:A,bpm:w,beats:C,duration:N,fps:O,onSeek:X,snapToGrid:z})=>{const H=R.useRef(null),G=he=>{if(A==="bpm"){const pe=6e4/(w||120),Se=pe*(C||8),Me=he/b*Se,we=Math.floor(Me/pe)+1,Re=Math.floor(Me%pe/pe*4)+1;return`B${we}.${Re}`}else if(A==="time"){const pe=(N||2)*1e3,Se=he/b*pe,Me=Math.floor(Se/1e3),we=Math.floor(Se%1e3);return`${Me}:${we.toString().padStart(3,"0")}`}return`F${he+1}`},ne=he=>{if(!H.current)return;const pe=H.current.getBoundingClientRect();let Me=(he.clientX-pe.left)/pe.width,we=Math.round(Me*(b-1));if(z){if(A==="bpm"){const Re=b/C;we=Math.round(we/Re)*Re}else if(A==="time"){const Re=b/N;we=Math.round(we/Re)*Re}}X(Math.max(0,Math.min(b-1,Math.round(we))))},ae=[],le=A==="bpm"?C||8:10;for(let he=0;he<=le;he++){const pe=he/le*100;let Se="";A==="bpm"?Se=`B${he+1}`:A==="time"?Se=`${(he/le*(N||2)).toFixed(1)}s`:Se=Math.round(he/le*b),ae.push(d.jsx("div",{style:{position:"absolute",left:`${pe}%`,top:0,bottom:0,borderLeft:"1px solid #444",pointerEvents:"none"},children:d.jsx("span",{style:{fontSize:"0.6rem",color:"#666",marginLeft:"2px"},children:Se})},he))}return d.jsxs("div",{ref:H,onMouseDown:ne,style:{position:"relative",height:"35px",background:"#111",borderRadius:"4px",border:"1px solid #333",cursor:"pointer",overflow:"hidden"},children:[ae,d.jsx("div",{style:{position:"absolute",left:`${p/(b-1)*100}%`,top:0,bottom:0,width:"2px",background:"var(--theme-color)",boxShadow:"0 0 5px var(--theme-color)",zIndex:10}}),d.jsx("div",{style:{position:"absolute",right:"5px",bottom:"2px",fontSize:"0.7rem",color:"var(--theme-color)",fontWeight:"bold"},children:G(p)})]})},Ra=Yn.memo(({active:p,onClick:b,icon:A})=>d.jsx("button",{onClick:b,style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:p?"var(--theme-color)":"#222",color:p?"black":"#888",border:"none",borderRadius:"4px",fontSize:"1.2rem",padding:0},children:d.jsx("i",{className:`bi ${A}`})})),vs=Yn.memo(({active:p,onClick:b,children:A})=>d.jsx("button",{onClick:b,style:{background:p?"#444":"#222",color:p?"var(--theme-color)":"#888",border:p?"1px solid var(--theme-color)":"1px solid #333",fontSize:"0.7rem",padding:"5px"},children:A})),fl=U.length===1&&qe[U[0]]&&Z.length>0?na(qe[U[0]])[Z[0]]?.color||qe[U[0]].color:"#000000";return d.jsxs("div",{className:"shape-builder",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column",userSelect:"none"},children:[je&&d.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e4,display:"flex",alignItems:"center",justifyContent:"center"},children:d.jsx("h3",{children:"WORKING..."})}),d.jsxs("header",{style:{height:"50px",padding:"0 20px",background:"#1a1a1a",borderBottom:"1px solid #333",display:"flex",alignItems:"center",gap:"15px"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1rem",color:"var(--theme-color)",width:"180px"},children:"SHAPE BUILDER"}),d.jsxs("div",{className:"action-group",style:{display:"flex",gap:"8px"},children:[d.jsx("button",{onClick:Hr,title:"Undo",children:d.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),d.jsx("button",{onClick:Tr,title:"Redo",children:d.jsx("i",{className:"bi bi-arrow-clockwise"})}),d.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),d.jsx("button",{onClick:Va,title:"Copy",children:d.jsx("i",{className:"bi bi-clipboard"})}),d.jsx("button",{onClick:Sn,title:"Paste",children:d.jsx("i",{className:"bi bi-clipboard-check"})}),d.jsx("button",{onClick:Dn,title:"Join Points / Shapes",children:d.jsx("i",{className:"bi bi-share"})}),d.jsx("button",{onClick:Ta,title:"Group",disabled:U.length<2,children:d.jsx("i",{className:"bi bi-intersect"})}),d.jsx("button",{onClick:br,title:"Ungroup",disabled:U.length!==1||qe[U[0]]?.type!=="group",children:d.jsx("i",{className:"bi bi-exclude"})}),d.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),d.jsx("button",{onClick:()=>Xn(!1),title:"Subdivide (Linear)",disabled:U.length===0,children:d.jsx("i",{className:"bi bi-grid-3x3"})}),d.jsx("button",{onClick:()=>Xn(!0),title:"Subdivide (Smooth)",disabled:U.length===0,children:d.jsx("i",{className:"bi bi-bezier"})}),d.jsx("button",{onClick:Fn,title:"Decimate (Reduce Points)",disabled:U.length===0,children:d.jsx("i",{className:"bi bi-filter-left"})}),d.jsx("button",{onClick:Ha,title:"Merge Overlapping Points",disabled:U.length===0,children:d.jsx("i",{className:"bi bi-node-plus"})}),d.jsx("button",{onClick:qa,title:"Import SVG",children:d.jsx("i",{className:"bi bi-vector-pen"})}),d.jsx("button",{onClick:hs,title:"Import ILDA",children:d.jsx("i",{className:"bi bi-folder2-open"})}),d.jsx("button",{onClick:Gr,title:"Import Background Image",children:d.jsx("i",{className:"bi bi-image"})}),d.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),d.jsx("button",{onClick:ms,title:"Clear All",children:d.jsx("i",{className:"bi bi-trash"})}),d.jsx("button",{onClick:()=>{be(.6),ve({x:0,y:0})},title:"Recenter",children:d.jsx("i",{className:"bi bi-aspect-ratio"})})]}),d.jsxs("div",{className:"grid-controls",style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.8rem",marginLeft:"15px"},children:[d.jsxs("label",{children:[d.jsx("input",{type:"checkbox",checked:_e,onChange:p=>Oe(p.target.checked)})," Grid"]}),d.jsxs("label",{children:[d.jsx("input",{type:"checkbox",checked:We,onChange:p=>Ye(p.target.checked)})," Snap"]}),(e==="line"||e==="bezier")&&d.jsxs("label",{children:[d.jsx("input",{type:"checkbox",checked:_t,onChange:p=>vn(p.target.checked)})," Continuous"]}),d.jsxs("select",{value:Je,onChange:p=>yn(parseInt(p.target.value)),style:{background:"#222",color:"white",border:"1px solid #444",borderRadius:"3px"},children:[d.jsx("option",{value:"10",children:"10px"}),d.jsx("option",{value:"25",children:"25px"}),d.jsx("option",{value:"50",children:"50px"}),d.jsx("option",{value:"100",children:"100px"})]})]}),d.jsx("button",{onClick:a,style:{marginLeft:"auto"},children:"Back to Show Control"})]}),d.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[d.jsxs("aside",{style:{width:"60px",background:"#1a1a1a",borderRight:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 0",gap:"10px"},children:[d.jsx(Ra,{active:e==="select",onClick:()=>{r("select"),m(!1),V(null)},icon:"bi-cursor"}),e==="select"&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",background:"#222",padding:"4px",borderRadius:"4px",border:"1px solid #333"},children:[d.jsx("button",{onClick:ir,title:"Select Odd Points",style:{padding:"4px",fontSize:"0.7rem"},children:"ODD"}),d.jsx("button",{onClick:ra,title:"Select Even Points",style:{padding:"4px",fontSize:"0.7rem"},children:"EVN"}),d.jsx("button",{onClick:Ks,title:"Invert Selection",style:{padding:"4px"},children:d.jsx("i",{className:"bi bi-arrow-left-right"})}),d.jsx("button",{onClick:Js,title:"Expand Selection",style:{padding:"4px"},children:d.jsx("i",{className:"bi bi-plus-lg"})}),d.jsx("button",{onClick:Ei,title:"Shrink Selection",style:{padding:"4px"},children:d.jsx("i",{className:"bi bi-dash-lg"})})]}),d.jsx(Ra,{active:e==="pen",onClick:()=>{r("pen"),m(!1),V(null)},icon:"bi-pencil"}),d.jsx(Ra,{active:e==="bezier",onClick:()=>{r("bezier"),m(!1),V(null)},icon:"bi-bezier2"}),d.jsx(Ra,{active:e==="line",onClick:()=>{r("line"),m(!1),V(null)},icon:"bi-slash-lg"}),d.jsx(Ra,{active:e==="rect",onClick:()=>{r("rect"),m(!1),V(null)},icon:"bi-square"}),d.jsx(Ra,{active:e==="circle",onClick:()=>{r("circle"),m(!1),V(null)},icon:"bi-circle"}),d.jsx(Ra,{active:e==="polygon",onClick:()=>{r("polygon"),m(!1),V(null)},icon:"bi-pentagon"}),d.jsx(Ra,{active:e==="star",onClick:()=>{r("star"),m(!1),V(null)},icon:"bi-star"}),d.jsx(Ra,{active:e==="triangle",onClick:()=>{r("triangle"),m(!1),V(null)},icon:"bi-triangle"}),d.jsxs("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",paddingBottom:"10px"},children:[d.jsx("input",{type:"color",value:Ca(i),onChange:p=>{o(p.target.value),U.length>0&&_n({color:p.target.value})},title:"Custom Color",style:{width:"35px",height:"35px",border:"2px solid #333",background:"none",cursor:"pointer",marginBottom:"5px"}}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:[{name:"Red",hex:"#ff0000"},{name:"Orange",hex:"#ff6400"},{name:"Yellow",hex:"#ffff00"},{name:"Green",hex:"#00ff00"},{name:"Cyan",hex:"#00ffff"},{name:"Blue",hex:"#0000ff"},{name:"Violette",hex:"#8000ff"},{name:"Pink",hex:"#ff6496"},{name:"Magenta",hex:"#ff00ff"},{name:"White",hex:"#ffffff"}].map(p=>d.jsx("button",{onClick:()=>{o(p.hex),U.length>0&&_n({color:p.hex})},title:p.name,style:{width:"18px",height:"18px",background:p.hex,border:i===p.hex?"2px solid white":"1px solid #444",borderRadius:"2px",padding:0,cursor:"pointer"}},p.hex))})]})]}),d.jsxs("main",{style:{flex:1,background:"#050505",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[d.jsxs("div",{ref:wa,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[d.jsx("canvas",{ref:Dt,width:window.innerWidth-300,height:window.innerHeight-130,onMouseDown:wi,onMouseMove:Ai,onMouseUp:Vr,onContextMenu:Er,onDoubleClick:Mr,style:{background:"transparent"}}),Ie.visible&&d.jsxs("div",{className:"context-menu",style:{position:"fixed",top:Ie.y,left:Ie.x,background:"#222",border:"1px solid #444",borderRadius:"4px",padding:"5px 0",zIndex:1e4},children:[(Ie.target?.type==="point"||Z.length>0)&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"menu-item",onClick:Fr,children:["Delete ",Z.length>1?"Points":"Point"]}),d.jsx("div",{className:"menu-item",onClick:za,children:"Split to New Shape"})]}),Ie.target?.type==="segment"&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"menu-item",onClick:wr,children:"Delete Line"}),d.jsx("div",{className:"menu-item",onClick:Rn,children:"Split Line"})]}),(Ie.target?.type==="shape"||U.length>0)&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"menu-item",onClick:()=>Xn(!1),children:"Subdivide (Linear)"}),d.jsx("div",{className:"menu-item",onClick:()=>Xn(!0),children:"Subdivide (Smooth)"}),d.jsx("div",{className:"menu-item",onClick:Fn,children:"Decimate"}),d.jsx("div",{className:"menu-item",onClick:Ha,children:"Merge Points"}),d.jsx("div",{className:"menu-item",onClick:Ya,children:"Add Corner Points"}),d.jsx("div",{className:"menu-item",onClick:Zs,children:"Reset Anchor Point"}),d.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),U.length===1&&["rect","circle","star","line"].includes(qe[U[0]]?.type)&&d.jsx("div",{className:"menu-item",onClick:Ws,children:"Convert to Points"}),d.jsx("div",{className:"menu-item",onClick:()=>{const p=[..._],b=U.length>0?U:[Ie.target.shapeIndex];p[E]=p[E].filter((A,w)=>!b.includes(w)),L(p),K([]),W([]),nt({visible:!1})},children:"Delete Shape(s)"})]}),ee&&d.jsx("div",{className:"menu-item",onClick:()=>{ue(null),nt({visible:!1})},children:"Clear Background"}),d.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),d.jsx("div",{className:"menu-item",onClick:Va,children:"Copy"}),d.jsx("div",{className:"menu-item",onClick:Sn,children:"Paste"})]})]}),d.jsxs("div",{className:"timeline-bar",style:{height:"80px",background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",alignItems:"center",padding:"0 20px",gap:"20px"},children:[d.jsxs("div",{className:"playback-controls",style:{display:"flex",gap:"10px"},children:[d.jsx("button",{onClick:()=>j(!D),style:{width:"40px",height:"40px",borderRadius:"50%",background:D?"var(--theme-color)":"#333",color:D?"black":"white"},children:d.jsx("i",{className:`bi ${D?"bi-pause-fill":"bi-play-fill"}`})}),d.jsx("button",{onClick:()=>M(p=>Math.max(0,p-1)),children:d.jsx("i",{className:"bi bi-chevron-left"})}),d.jsx("button",{onClick:()=>M(p=>Math.min(v-1,p+1)),children:d.jsx("i",{className:"bi bi-chevron-right"})}),d.jsx("button",{onClick:lr,title:"Duplicate Frame",children:d.jsx("i",{className:"bi bi-layers-half"})})]}),d.jsxs("div",{className:"frame-slider-container",style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#666"},children:[d.jsxs("span",{children:["FRAME ",E+1," / ",v]}),d.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[d.jsx("input",{type:"checkbox",checked:P,onChange:p=>F(p.target.checked)})," Onion Skin"]})]}),d.jsx(ul,{currentFrame:E,frameCount:v,syncMode:rn,bpm:lt,beats:Pa,duration:Jn,fps:rr,snapToGrid:We,onSeek:M})]}),d.jsxs("div",{className:"timeline-settings",style:{display:"flex",alignItems:"center",gap:"15px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"START:"}),d.jsx("input",{type:"number",min:"1",max:v,value:tr+1,onChange:p=>nr(Math.max(1,parseInt(p.target.value)||1)-1),onWheel:ps,style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"LENGTH:"}),d.jsx("input",{type:"number",min:"1",max:"999",value:T,onChange:p=>S(p.target.value),onBlur:()=>x(Math.max(1,parseInt(T)||1)),onKeyDown:p=>{p.key==="Enter"&&x(Math.max(1,parseInt(T)||1))},onWheel:p=>aa(p,x),style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]})]})]})]}),d.jsxs("aside",{style:{width:"260px",background:"#1a1a1a",borderLeft:"1px solid #333",display:"flex",flexDirection:"column",overflow:"hidden"},children:[d.jsxs("div",{className:"layers-panel",style:{display:"flex",flexDirection:"column",height:"220px",flexShrink:0,overflowY:"auto",borderBottom:"1px solid #333",padding:"15px"},children:[d.jsxs("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["LAYERS",d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("button",{onClick:Ta,title:"Group",disabled:U.length<2,style:{padding:"2px 5px",fontSize:"0.7rem"},children:d.jsx("i",{className:"bi bi-intersect"})}),d.jsx("button",{onClick:br,title:"Ungroup",disabled:U.length!==1||qe[U[0]]?.type!=="group",style:{padding:"2px 5px",fontSize:"0.7rem"},children:d.jsx("i",{className:"bi bi-exclude"})})]})]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:qe.map((p,b)=>({s:p,i:b})).reverse().map(({s:p,i:b})=>d.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"5px",background:U.includes(b)?"#333":"transparent",borderRadius:"3px",cursor:"pointer",border:U.includes(b)?"1px solid var(--theme-color)":"1px solid transparent"},onClick:A=>{p.locked&&!p.hidden||(A.shiftKey?K(w=>w.includes(b)?w.filter(C=>C!==b):[...w,b]):K([b]))},children:[d.jsx("div",{style:{width:"10px",height:"10px",background:p.color,marginRight:"8px",borderRadius:"2px"}}),d.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[p.type.toUpperCase()," ",b]}),d.jsx("button",{onClick:A=>{A.stopPropagation();const w=[..._];w[E][b]={...p,hidden:!p.hidden},L(w),ft(w)},style:{background:"none",border:"none",padding:"2px",color:p.hidden?"#555":"#ccc"},title:p.hidden?"Show":"Hide",children:d.jsx("i",{className:`bi ${p.hidden?"bi-eye-slash":"bi-eye"}`})}),d.jsx("button",{onClick:A=>{A.stopPropagation();const w=[..._];w[E][b]={...p,locked:!p.locked},L(w),ft(w)},style:{background:"none",border:"none",padding:"2px",color:p.locked?"var(--theme-color)":"#555"},title:p.locked?"Unlock":"Lock",children:d.jsx("i",{className:`bi ${p.locked?"bi-lock-fill":"bi-unlock"}`})})]},b))})]}),d.jsxs("div",{className:"properties-scroll-container",style:{flex:1,overflowY:"auto",padding:"15px",display:"flex",flexDirection:"column",gap:"20px"},children:[d.jsx("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",borderBottom:"1px solid #333",paddingBottom:"5px"},children:"PROPERTIES"}),d.jsxs("div",{className:"animation-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[d.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"TWEENING TOOL"}),d.jsxs("div",{style:{display:"flex",gap:"5px",marginBottom:"8px"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"START FRAME"}),d.jsx("input",{type:"number",value:fn+1,onChange:p=>Et(Math.max(1,parseInt(p.target.value)||1)-1),onWheel:cl,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]}),d.jsxs("div",{style:{flex:1},children:[d.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"END FRAME"}),d.jsx("input",{type:"number",value:it+1,onChange:p=>qn(Math.max(1,parseInt(p.target.value)||1)-1),onWheel:zr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]})]}),d.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"8px",fontSize:"0.7rem",color:"#ccc"},children:[d.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[d.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:Xt,onChange:p=>Nn(p.target.checked)})," POS"]}),d.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[d.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:dn,onChange:p=>us(p.target.checked)})," COLOR"]})]}),"                                              ",d.jsx("button",{onClick:tn,className:"primary-btn",style:{width:"100%",padding:"5px"},children:"INTERPOLATE"})]}),d.jsxs("div",{className:"sync-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[d.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"PLAYBACK SYNC"}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"10px"},children:[d.jsx(vs,{active:rn==="fps",onClick:()=>Na("fps"),children:"FPS"}),d.jsx(vs,{active:rn==="bpm",onClick:()=>Na("bpm"),children:"BPM"}),d.jsx(vs,{active:rn==="time",onClick:()=>Na("time"),children:"TIME"})]}),rn==="fps"&&d.jsxs("div",{style:{marginBottom:"8px"},children:[d.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["FPS: ",rr]}),d.jsx("input",{type:"range",min:"1",max:"60",value:rr,onChange:p=>fs(parseInt(p.target.value))})]}),rn==="bpm"&&d.jsxs("div",{style:{marginBottom:"8px",display:"flex",gap:"5px"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BPM: ",lt]}),d.jsx("input",{type:"number",value:lt,onChange:p=>Ga(parseInt(p.target.value)||0),onWheel:Qs,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),d.jsxs("div",{style:{flex:1},children:[d.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BEATS: ",Pa]}),d.jsx("input",{type:"number",value:Pa,onChange:p=>ka(parseInt(p.target.value)||1),onWheel:Ar,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]})]}),rn==="time"&&d.jsxs("div",{style:{marginBottom:"8px"},children:[d.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["DURATION (S): ",Jn]}),d.jsx("input",{type:"number",step:"0.1",value:Jn,onChange:p=>Pr(parseFloat(p.target.value)||0),onWheel:ds,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),d.jsxs("div",{style:{marginTop:"10px"},children:[d.jsxs("label",{style:{fontSize:"0.7rem",color:"#888",display:"flex",justifyContent:"space-between"},children:["SPEED: ",d.jsxs("span",{children:[bn.toFixed(1),"x"]})]}),d.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:bn,onChange:p=>ma(parseFloat(p.target.value))}),d.jsxs("div",{style:{display:"flex",gap:"4px",marginTop:"4px"},children:[d.jsx("button",{onClick:()=>ma(.5),style:{flex:1,fontSize:"0.6rem"},children:"0.5x"}),d.jsx("button",{onClick:()=>ma(1),style:{flex:1,fontSize:"0.6rem"},children:"1.0x"}),d.jsx("button",{onClick:()=>ma(2),style:{flex:1,fontSize:"0.6rem"},children:"2.0x"})]})]})]}),U.length>0?d.jsxs("div",{className:"shape-properties",style:{display:"flex",flexDirection:"column",gap:"15px"},children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#666",display:"block"},children:U.length===1?`TYPE: ${qe[U[0]]?.type?.toUpperCase()}`:`${U.length} SHAPES SELECTED`}),d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"COLOR"}),d.jsx("input",{type:"color",value:Ca(qe[U[0]]?.color||"#ffffff"),onChange:p=>_n({color:p.target.value}),style:{width:"100%",height:"30px",background:"none",border:"1px solid #444",cursor:"pointer"}}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(p=>d.jsx("button",{onClick:()=>_n({color:p}),style:{width:"100%",height:"20px",background:p,border:"1px solid #444",borderRadius:"2px",padding:0}},p))})]}),U.length===1&&qe[U[0]]&&["rect","circle","star","line"].includes(qe[U[0]].type)&&d.jsxs("div",{className:"primitive-properties",style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",background:"#222",borderRadius:"4px"},children:[d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"POSITION (X / Y)"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:Math.round(qe[U[0]].start?.x||0),onChange:p=>{const b=qe[U[0]];if(!b||!b.start)return;const A=(parseInt(p.target.value)||0)-b.start.x;L(w=>{const C=[...w],N=[...C[E]];return N[U[0]]=$n({...N[U[0]]},A,0),C[E]=N,C})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),d.jsx("input",{type:"number",value:Math.round(qe[U[0]].start?.y||0),onChange:p=>{const b=qe[U[0]];if(!b||!b.start)return;const A=(parseInt(p.target.value)||0)-b.start.y;L(w=>{const C=[...w],N=[...C[E]];return N[U[0]]=$n({...N[U[0]]},0,A),C[E]=N,C})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),qe[U[0]].type==="rect"&&d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"SIZE (W / H)"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:Math.round(qe[U[0]].width||0),onChange:p=>_n({width:parseInt(p.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),d.jsx("input",{type:"number",value:Math.round(qe[U[0]].height||0),onChange:p=>_n({height:parseInt(p.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),(qe[U[0]].type==="circle"||qe[U[0]].type==="star")&&d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"RADIUS (X / Y)"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",value:Math.round(Math.abs((qe[U[0]].end?.x||0)-(qe[U[0]].start?.x||0))),onChange:p=>{const b=parseInt(p.target.value)||0,A=qe[U[0]];!A||!A.start||!A.end||_n({end:{...A.end,x:A.start.x+b}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),d.jsx("input",{type:"number",value:Math.round(Math.abs((qe[U[0]].end?.y||0)-(qe[U[0]].start?.y||0))),onChange:p=>{const b=parseInt(p.target.value)||0,A=qe[U[0]];!A||!A.start||!A.end||_n({end:{...A.end,y:A.start.y+b}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]})]}),d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"SCALE X / Y"}),d.jsxs("div",{style:{display:"flex",gap:"5px"},children:[d.jsx("input",{type:"number",step:"0.1",value:qe[U[0]]?.scaleX||1,onChange:p=>_n({scaleX:parseFloat(p.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}}),d.jsx("input",{type:"number",step:"0.1",value:qe[U[0]]?.scaleY||1,onChange:p=>_n({scaleY:parseFloat(p.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}})]})]}),d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"ROTATION X / Y / Z (DEG)"}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:["rotationX","rotationY","rotationZ"].map(p=>{const b=qe[U[0]]?.[p]||0,A=Math.round(b*180/Math.PI*100)/100;return d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[d.jsx("span",{style:{fontSize:"0.7rem",color:"#555",width:"10px"},children:p.slice(-1)}),d.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:A,onChange:w=>_n({[p]:parseFloat(w.target.value)*Math.PI/180}),style:{flex:1}}),d.jsx("input",{type:"number",value:A,onChange:w=>_n({[p]:(parseFloat(w.target.value)||0)*Math.PI/180}),style:{width:"50px",background:"#111",border:"1px solid #444",color:"white",padding:"2px",fontSize:"0.7rem"}})]},p)})})]}),d.jsxs("div",{className:"property-group",children:[d.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"RENDER MODE"}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:["simple","dotted","dashed","points"].map(p=>d.jsx(vs,{active:qe[U[0]]?.renderMode===p,onClick:()=>_n({renderMode:p}),children:p},p))})]})]}):d.jsx("p",{style:{fontSize:"0.8rem",color:"#555",textAlign:"center",marginTop:"20px"},children:"Select shapes or drag a box to begin."}),Z.length>0&&U.length===1&&d.jsxs("div",{className:"point-properties",style:{background:"#222",padding:"10px",borderRadius:"4px",border:"1px solid var(--theme-color)",flexShrink:0},children:[d.jsxs("label",{style:{fontSize:"0.8rem",color:"var(--theme-color)",display:"block",marginBottom:"5px"},children:[Z.length," POINTS SELECTED"]}),d.jsx("input",{type:"color",value:Ca(fl),onChange:p=>gs(p.target.value),style:{width:"100%",height:"40px",background:"none",border:"1px solid #444",cursor:"pointer"}}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(p=>d.jsx("button",{onClick:()=>gs(p),style:{width:"100%",height:"20px",background:p,border:"1px solid #444",borderRadius:"2px",padding:0}},p))})]})]}),d.jsx("div",{className:"save-container",style:{padding:"15px",borderTop:"1px solid #333",background:"#1a1a1a"},children:d.jsx("button",{className:"primary-btn",style:{width:"100%",padding:"12px"},onClick:Yr,disabled:_.every(p=>p.length===0)||Wt,children:Wt?"EXPORTING...":"SAVE AS CLIP"})})]})]}),d.jsx("style",{children:`
        button { padding: 4px 10px; background: #333; border: 1px solid #444; color: #ccc; border-radius: 3px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; }
        button:hover:not(:disabled) { background: #444; color: white; }
        .primary-btn { background: var(--theme-color) !important; color: black !important; font-weight: bold; border: none !important; }
        .context-menu { background: #222; border: 1px solid #444; border-radius: 4px; padding: 5px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-width: 120px; }
        .context-menu .menu-item { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; color: #ccc; }
        .context-menu .menu-item:hover { background: var(--theme-color); color: black; }
        input[type="range"] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--theme-color); border-radius: 50%; cursor: pointer; }
        
        .sb-checkbox {
            appearance: none !important;
            -webkit-appearance: none !important;
            width: 14px !important;
            height: 14px !important;
            min-width: 14px !important;
            min-height: 14px !important;
            background: #111 !important;
            border: 1px solid #444 !important;
            border-radius: 2px !important;
            cursor: pointer;
            position: relative;
            margin: 0 4px 0 0 !important;
            display: inline-block;
            vertical-align: middle;
        }
        /* Crucial: Kill the global "OFF/ON" toggle styling */
        .sb-checkbox:before {
            content: none !important;
            display: none !important;
        }
        .sb-checkbox:checked {
            background: var(--theme-color) !important;
            border-color: var(--theme-color) !important;
        }
        .sb-checkbox:checked::after {
            content: '\\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 10px;
            font-weight: bold;
            display: block !important;
        }
      `})]})},Xv=({onBack:a})=>d.jsxs("div",{className:"timeline-editor-page",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column"},children:[d.jsxs("header",{style:{padding:"10px 20px",borderBottom:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[d.jsx("h2",{children:"Timeline Editor (Coming Soon)"}),d.jsx("button",{onClick:a,style:{padding:"8px 16px",background:"#ff5e00",border:"none",color:"white",borderRadius:"4px",cursor:"pointer"},children:"Back to Show Control"})]}),d.jsx("main",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:d.jsxs("div",{style:{textAlign:"center"},children:[d.jsx("p",{children:"This is the Timeline Editor placeholder."}),d.jsx("p",{children:"Goal: Arrange clips on a timeline for synchronized playback."})]})})]}),$v=({show:a,onClose:e,initialTab:r="output"})=>{const[i,o]=R.useState(r);return Yn.useEffect(()=>{a&&o(r)},[a,r]),a?d.jsxs("div",{className:"modal-overlay",children:[d.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[d.jsxs("div",{className:"modal-header",children:[d.jsx("h3",{children:"About"}),d.jsx("button",{className:"close-btn",onClick:e,children:""})]}),d.jsx("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"}}),d.jsx("div",{className:"modal-body",children:d.jsx("div",{className:"audio-output-settings"})})]}),d.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]}):null},ag=R.createContext(null),Wv=()=>R.useContext(ag),Zv=({children:a})=>{const[e,r]=R.useState(null);return R.useEffect(()=>{if(!e){const i=new Worker(new URL(""+new URL("ilda-parser.worker-CjheifOo.js",import.meta.url).href,import.meta.url));r(i)}return()=>{e&&e.terminate()}},[e]),d.jsx(ag.Provider,{value:e,children:a})},rg=R.createContext(null),Qv=({children:a})=>{const e=R.useMemo(()=>{try{const r=new Worker(new URL(""+new URL("generators.worker-BKwl6R_u.js",import.meta.url).href,import.meta.url),{type:"module"});return r.onerror=i=>{console.error("Generator Worker instantiation or internal error:",i)},r}catch(r){return console.error("Failed to create Generator Worker:",r),null}},[]);return R.useEffect(()=>{if(e)return()=>{e.terminate()}},[e]),d.jsx(rg.Provider,{value:e,children:a})},Kv=()=>{const a=R.useContext(rg);if(a===void 0)throw new Error("useGeneratorWorker must be used within a GeneratorWorkerProvider");return a};var Jv=Pm();const eb=ad(Jv),tb=()=>{const{isMapping:a,mappings:e,learningId:r}=Oc(),{isMapping:i,mappings:o,learningId:c}=sd()||{},{isMapping:f,mappings:g,learningId:m}=id()||{},v=a||i||f,[x,T]=R.useState([]),S=R.useCallback(()=>{if(!v)return;const E=document.querySelectorAll("[data-mappable-id]"),M=Array.from(E).map(D=>{const j=D.getBoundingClientRect();return{id:D.getAttribute("data-mappable-id"),rect:{top:j.top,left:j.left,width:j.width,height:j.height}}});T(M)},[v]);return R.useEffect(()=>{if(v){S(),window.addEventListener("resize",S);const E=setTimeout(S,100);return()=>{window.removeEventListener("resize",S),clearTimeout(E)}}else T([])},[v,S]),v?eb.createPortal(d.jsx("div",{className:"midi-mapping-global-overlay-container",children:x.map(E=>{const M=e[E.id],D=o?o[E.id]:null,j=g?g[E.id]:null,P=a&&r===E.id||i&&c===E.id||f&&m===E.id;let F=null;return a?F=M?M.label:null:i?F=D?D.label:null:f&&(F=j?j.label:null),d.jsx("div",{className:`midi-mapping-label-box ${P?"learning":""} ${F?"mapped":""} ${i?"artnet-mapping":""} ${f?"keyboard-mapping":""}`,style:{position:"fixed",top:E.rect.top,left:E.rect.left,width:E.rect.width,height:E.rect.height,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:d.jsx("div",{className:"mapping-label",children:F||"+"})},E.id)})}),document.body):null};String.prototype.codePointAt||(function(){var a=(function(){try{var r={},i=Object.defineProperty,o=i(r,r,r)&&i}catch{}return o})(),e=function(r){if(this==null)throw TypeError();var i=String(this),o=i.length,c=r?Number(r):0;if(c!=c&&(c=0),!(c<0||c>=o)){var f=i.charCodeAt(c),g;return f>=55296&&f<=56319&&o>c+1&&(g=i.charCodeAt(c+1),g>=56320&&g<=57343)?(f-55296)*1024+g-56320+65536:f}};a?a(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var cd=0,sg=-3;function io(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function nb(a,e){this.source=a,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new io,this.dtree=new io}var ig=new io,lg=new io,ud=new Uint8Array(30),fd=new Uint16Array(30),og=new Uint8Array(30),cg=new Uint16Array(30),ab=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W0=new io,Ir=new Uint8Array(320);function ug(a,e,r,i){var o,c;for(o=0;o<r;++o)a[o]=0;for(o=0;o<30-r;++o)a[o+r]=o/r|0;for(c=i,o=0;o<30;++o)e[o]=c,c+=1<<a[o]}function rb(a,e){var r;for(r=0;r<7;++r)a.table[r]=0;for(a.table[7]=24,a.table[8]=152,a.table[9]=112,r=0;r<24;++r)a.trans[r]=256+r;for(r=0;r<144;++r)a.trans[24+r]=r;for(r=0;r<8;++r)a.trans[168+r]=280+r;for(r=0;r<112;++r)a.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var Z0=new Uint16Array(16);function If(a,e,r,i){var o,c;for(o=0;o<16;++o)a.table[o]=0;for(o=0;o<i;++o)a.table[e[r+o]]++;for(a.table[0]=0,c=0,o=0;o<16;++o)Z0[o]=c,c+=a.table[o];for(o=0;o<i;++o)e[r+o]&&(a.trans[Z0[e[r+o]]++]=o)}function sb(a){a.bitcount--||(a.tag=a.source[a.sourceIndex++],a.bitcount=7);var e=a.tag&1;return a.tag>>>=1,e}function Lr(a,e,r){if(!e)return r;for(;a.bitcount<24;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var i=a.tag&65535>>>16-e;return a.tag>>>=e,a.bitcount-=e,i+r}function $f(a,e){for(;a.bitcount<24;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var r=0,i=0,o=0,c=a.tag;do i=2*i+(c&1),c>>>=1,++o,r+=e.table[o],i-=e.table[o];while(i>=0);return a.tag=c,a.bitcount-=o,e.trans[r+i]}function ib(a,e,r){var i,o,c,f,g,m;for(i=Lr(a,5,257),o=Lr(a,5,1),c=Lr(a,4,4),f=0;f<19;++f)Ir[f]=0;for(f=0;f<c;++f){var v=Lr(a,3,0);Ir[ab[f]]=v}for(If(W0,Ir,0,19),g=0;g<i+o;){var x=$f(a,W0);switch(x){case 16:var T=Ir[g-1];for(m=Lr(a,2,3);m;--m)Ir[g++]=T;break;case 17:for(m=Lr(a,3,3);m;--m)Ir[g++]=0;break;case 18:for(m=Lr(a,7,11);m;--m)Ir[g++]=0;break;default:Ir[g++]=x;break}}If(e,Ir,0,i),If(r,Ir,i,o)}function Q0(a,e,r){for(;;){var i=$f(a,e);if(i===256)return cd;if(i<256)a.dest[a.destLen++]=i;else{var o,c,f,g;for(i-=257,o=Lr(a,ud[i],fd[i]),c=$f(a,r),f=a.destLen-Lr(a,og[c],cg[c]),g=f;g<f+o;++g)a.dest[a.destLen++]=a.dest[g]}}}function lb(a){for(var e,r,i;a.bitcount>8;)a.sourceIndex--,a.bitcount-=8;if(e=a.source[a.sourceIndex+1],e=256*e+a.source[a.sourceIndex],r=a.source[a.sourceIndex+3],r=256*r+a.source[a.sourceIndex+2],e!==(~r&65535))return sg;for(a.sourceIndex+=4,i=e;i;--i)a.dest[a.destLen++]=a.source[a.sourceIndex++];return a.bitcount=0,cd}function ob(a,e){var r=new nb(a,e),i,o,c;do{switch(i=sb(r),o=Lr(r,2,0),o){case 0:c=lb(r);break;case 1:c=Q0(r,ig,lg);break;case 2:ib(r,r.ltree,r.dtree),c=Q0(r,r.ltree,r.dtree);break;default:c=sg}if(c!==cd)throw new Error("Data error")}while(!i);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}rb(ig,lg);ug(ud,fd,4,3);ug(og,cg,2,1);ud[28]=0;fd[28]=258;var cb=ob;function tl(a,e,r,i,o){return Math.pow(1-o,3)*a+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*i}function cs(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}cs.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};cs.prototype.addPoint=function(a,e){typeof a=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};cs.prototype.addX=function(a){this.addPoint(a,null)};cs.prototype.addY=function(a){this.addPoint(null,a)};cs.prototype.addBezier=function(a,e,r,i,o,c,f,g){var m=[a,e],v=[r,i],x=[o,c],T=[f,g];this.addPoint(a,e),this.addPoint(f,g);for(var S=0;S<=1;S++){var E=6*m[S]-12*v[S]+6*x[S],M=-3*m[S]+9*v[S]-9*x[S]+3*T[S],D=3*v[S]-3*m[S];if(M===0){if(E===0)continue;var j=-D/E;0<j&&j<1&&(S===0&&this.addX(tl(m[S],v[S],x[S],T[S],j)),S===1&&this.addY(tl(m[S],v[S],x[S],T[S],j)));continue}var P=Math.pow(E,2)-4*D*M;if(!(P<0)){var F=(-E+Math.sqrt(P))/(2*M);0<F&&F<1&&(S===0&&this.addX(tl(m[S],v[S],x[S],T[S],F)),S===1&&this.addY(tl(m[S],v[S],x[S],T[S],F)));var _=(-E-Math.sqrt(P))/(2*M);0<_&&_<1&&(S===0&&this.addX(tl(m[S],v[S],x[S],T[S],_)),S===1&&this.addY(tl(m[S],v[S],x[S],T[S],_)))}}};cs.prototype.addQuad=function(a,e,r,i,o,c){var f=a+.6666666666666666*(r-a),g=e+2/3*(i-e),m=f+1/3*(o-a),v=g+1/3*(c-e);this.addBezier(a,e,f,g,m,v,o,c)};function An(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}An.prototype.moveTo=function(a,e){this.commands.push({type:"M",x:a,y:e})};An.prototype.lineTo=function(a,e){this.commands.push({type:"L",x:a,y:e})};An.prototype.curveTo=An.prototype.bezierCurveTo=function(a,e,r,i,o,c){this.commands.push({type:"C",x1:a,y1:e,x2:r,y2:i,x:o,y:c})};An.prototype.quadTo=An.prototype.quadraticCurveTo=function(a,e,r,i){this.commands.push({type:"Q",x1:a,y1:e,x:r,y:i})};An.prototype.close=An.prototype.closePath=function(){this.commands.push({type:"Z"})};An.prototype.extend=function(a){if(a.commands)a=a.commands;else if(a instanceof cs){var e=a;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,a)};An.prototype.getBoundingBox=function(){for(var a=new cs,e=0,r=0,i=0,o=0,c=0;c<this.commands.length;c++){var f=this.commands[c];switch(f.type){case"M":a.addPoint(f.x,f.y),e=i=f.x,r=o=f.y;break;case"L":a.addPoint(f.x,f.y),i=f.x,o=f.y;break;case"Q":a.addQuad(i,o,f.x1,f.y1,f.x,f.y),i=f.x,o=f.y;break;case"C":a.addBezier(i,o,f.x1,f.y1,f.x2,f.y2,f.x,f.y),i=f.x,o=f.y;break;case"Z":i=e,o=r;break;default:throw new Error("Unexpected path command "+f.type)}}return a.isEmpty()&&a.addPoint(0,0),a};An.prototype.draw=function(a){a.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?a.moveTo(r.x,r.y):r.type==="L"?a.lineTo(r.x,r.y):r.type==="C"?a.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?a.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&a.closePath()}this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.stroke())};An.prototype.toPathData=function(a){a=a!==void 0?a:2;function e(f){return Math.round(f)===f?""+Math.round(f):f.toFixed(a)}function r(){for(var f=arguments,g="",m=0;m<arguments.length;m+=1){var v=f[m];v>=0&&m>0&&(g+=" "),g+=e(v)}return g}for(var i="",o=0;o<this.commands.length;o+=1){var c=this.commands[o];c.type==="M"?i+="M"+r(c.x,c.y):c.type==="L"?i+="L"+r(c.x,c.y):c.type==="C"?i+="C"+r(c.x1,c.y1,c.x2,c.y2,c.x,c.y):c.type==="Q"?i+="Q"+r(c.x1,c.y1,c.x,c.y):c.type==="Z"&&(i+="Z")}return i};An.prototype.toSVG=function(a){var e='<path d="';return e+=this.toPathData(a),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};An.prototype.toDOMElement=function(a){var e=this.toPathData(a),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function fg(a){throw new Error(a)}function K0(a,e){a||fg(e)}var tt={fail:fg,argument:K0,assert:K0},J0=32768,em=2147483648,sl={},Be={},rt={};function yr(a){return function(){return a}}Be.BYTE=function(a){return tt.argument(a>=0&&a<=255,"Byte value should be between 0 and 255."),[a]};rt.BYTE=yr(1);Be.CHAR=function(a){return[a.charCodeAt(0)]};rt.CHAR=yr(1);Be.CHARARRAY=function(a){typeof a>"u"&&(a="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<a.length;r+=1)e[r]=a.charCodeAt(r);return e};rt.CHARARRAY=function(a){return typeof a>"u"?0:a.length};Be.USHORT=function(a){return[a>>8&255,a&255]};rt.USHORT=yr(2);Be.SHORT=function(a){return a>=J0&&(a=-(2*J0-a)),[a>>8&255,a&255]};rt.SHORT=yr(2);Be.UINT24=function(a){return[a>>16&255,a>>8&255,a&255]};rt.UINT24=yr(3);Be.ULONG=function(a){return[a>>24&255,a>>16&255,a>>8&255,a&255]};rt.ULONG=yr(4);Be.LONG=function(a){return a>=em&&(a=-(2*em-a)),[a>>24&255,a>>16&255,a>>8&255,a&255]};rt.LONG=yr(4);Be.FIXED=Be.ULONG;rt.FIXED=rt.ULONG;Be.FWORD=Be.SHORT;rt.FWORD=rt.SHORT;Be.UFWORD=Be.USHORT;rt.UFWORD=rt.USHORT;Be.LONGDATETIME=function(a){return[0,0,0,0,a>>24&255,a>>16&255,a>>8&255,a&255]};rt.LONGDATETIME=yr(8);Be.TAG=function(a){return tt.argument(a.length===4,"Tag should be exactly 4 ASCII characters."),[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]};rt.TAG=yr(4);Be.Card8=Be.BYTE;rt.Card8=rt.BYTE;Be.Card16=Be.USHORT;rt.Card16=rt.USHORT;Be.OffSize=Be.BYTE;rt.OffSize=rt.BYTE;Be.SID=Be.USHORT;rt.SID=rt.USHORT;Be.NUMBER=function(a){return a>=-107&&a<=107?[a+139]:a>=108&&a<=1131?(a=a-108,[(a>>8)+247,a&255]):a>=-1131&&a<=-108?(a=-a-108,[(a>>8)+251,a&255]):a>=-32768&&a<=32767?Be.NUMBER16(a):Be.NUMBER32(a)};rt.NUMBER=function(a){return Be.NUMBER(a).length};Be.NUMBER16=function(a){return[28,a>>8&255,a&255]};rt.NUMBER16=yr(3);Be.NUMBER32=function(a){return[29,a>>24&255,a>>16&255,a>>8&255,a&255]};rt.NUMBER32=yr(5);Be.REAL=function(a){var e=a.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var i=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(a*i)/i).toString()}for(var o="",c=0,f=e.length;c<f;c+=1){var g=e[c];g==="e"?o+=e[++c]==="-"?"c":"b":g==="."?o+="a":g==="-"?o+="e":o+=g}o+=o.length&1?"f":"ff";for(var m=[30],v=0,x=o.length;v<x;v+=2)m.push(parseInt(o.substr(v,2),16));return m};rt.REAL=function(a){return Be.REAL(a).length};Be.NAME=Be.CHARARRAY;rt.NAME=rt.CHARARRAY;Be.STRING=Be.CHARARRAY;rt.STRING=rt.CHARARRAY;sl.UTF8=function(a,e,r){for(var i=[],o=r,c=0;c<o;c++,e+=1)i[c]=a.getUint8(e);return String.fromCharCode.apply(null,i)};sl.UTF16=function(a,e,r){for(var i=[],o=r/2,c=0;c<o;c++,e+=2)i[c]=a.getUint16(e);return String.fromCharCode.apply(null,i)};Be.UTF16=function(a){for(var e=[],r=0;r<a.length;r+=1){var i=a.charCodeAt(r);e[e.length]=i>>8&255,e[e.length]=i&255}return e};rt.UTF16=function(a){return a.length*2};var Wf={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};sl.MACSTRING=function(a,e,r,i){var o=Wf[i];if(o!==void 0){for(var c="",f=0;f<r;f++){var g=a.getUint8(e+f);g<=127?c+=String.fromCharCode(g):c+=o[g&127]}return c}};var yc=typeof WeakMap=="function"&&new WeakMap,vc,ub=function(a){if(!vc){vc={};for(var e in Wf)vc[e]=new String(e)}var r=vc[a];if(r!==void 0){if(yc){var i=yc.get(r);if(i!==void 0)return i}var o=Wf[a];if(o!==void 0){for(var c={},f=0;f<o.length;f++)c[o.charCodeAt(f)]=f+128;return yc&&yc.set(r,c),c}}};Be.MACSTRING=function(a,e){var r=ub(e);if(r!==void 0){for(var i=[],o=0;o<a.length;o++){var c=a.charCodeAt(o);if(c>=128&&(c=r[c],c===void 0))return;i[o]=c}return i}};rt.MACSTRING=function(a,e){var r=Be.MACSTRING(a,e);return r!==void 0?r.length:0};function Zf(a){return a>=-128&&a<=127}function fb(a,e,r){for(var i=0,o=a.length;e<o&&i<64&&a[e]===0;)++e,++i;return r.push(128|i-1),e}function db(a,e,r){for(var i=0,o=a.length,c=e;c<o&&i<64;){var f=a[c];if(!Zf(f)||f===0&&c+1<o&&a[c+1]===0)break;++c,++i}r.push(i-1);for(var g=e;g<c;++g)r.push(a[g]+256&255);return c}function pb(a,e,r){for(var i=0,o=a.length,c=e;c<o&&i<64;){var f=a[c];if(f===0||Zf(f)&&c+1<o&&Zf(a[c+1]))break;++c,++i}r.push(64|i-1);for(var g=e;g<c;++g){var m=a[g];r.push(m+65536>>8&255,m+256&255)}return c}Be.VARDELTAS=function(a){for(var e=0,r=[];e<a.length;){var i=a[e];i===0?e=fb(a,e,r):i>=-128&&i<=127?e=db(a,e,r):e=pb(a,e,r)}return r};Be.INDEX=function(a){for(var e=1,r=[e],i=[],o=0;o<a.length;o+=1){var c=Be.OBJECT(a[o]);Array.prototype.push.apply(i,c),e+=c.length,r.push(e)}if(i.length===0)return[0,0];for(var f=[],g=1+Math.floor(Math.log(e)/Math.log(2))/8|0,m=[void 0,Be.BYTE,Be.USHORT,Be.UINT24,Be.ULONG][g],v=0;v<r.length;v+=1){var x=m(r[v]);Array.prototype.push.apply(f,x)}return Array.prototype.concat(Be.Card16(a.length),Be.OffSize(g),f,i)};rt.INDEX=function(a){return Be.INDEX(a).length};Be.DICT=function(a){for(var e=[],r=Object.keys(a),i=r.length,o=0;o<i;o+=1){var c=parseInt(r[o],0),f=a[c];e=e.concat(Be.OPERAND(f.value,f.type)),e=e.concat(Be.OPERATOR(c))}return e};rt.DICT=function(a){return Be.DICT(a).length};Be.OPERATOR=function(a){return a<1200?[a]:[12,a-1200]};Be.OPERAND=function(a,e){var r=[];if(Array.isArray(e))for(var i=0;i<e.length;i+=1)tt.argument(a.length===e.length,"Not enough arguments given for type"+e),r=r.concat(Be.OPERAND(a[i],e[i]));else if(e==="SID")r=r.concat(Be.NUMBER(a));else if(e==="offset")r=r.concat(Be.NUMBER32(a));else if(e==="number")r=r.concat(Be.NUMBER(a));else if(e==="real")r=r.concat(Be.REAL(a));else throw new Error("Unknown operand type "+e);return r};Be.OP=Be.BYTE;rt.OP=rt.BYTE;var bc=typeof WeakMap=="function"&&new WeakMap;Be.CHARSTRING=function(a){if(bc){var e=bc.get(a);if(e!==void 0)return e}for(var r=[],i=a.length,o=0;o<i;o+=1){var c=a[o];r=r.concat(Be[c.type](c.value))}return bc&&bc.set(a,r),r};rt.CHARSTRING=function(a){return Be.CHARSTRING(a).length};Be.OBJECT=function(a){var e=Be[a.type];return tt.argument(e!==void 0,"No encoding function for type "+a.type),e(a.value)};rt.OBJECT=function(a){var e=rt[a.type];return tt.argument(e!==void 0,"No sizeOf function for type "+a.type),e(a.value)};Be.TABLE=function(a){for(var e=[],r=a.fields.length,i=[],o=[],c=0;c<r;c+=1){var f=a.fields[c],g=Be[f.type];tt.argument(g!==void 0,"No encoding function for field type "+f.type+" ("+f.name+")");var m=a[f.name];m===void 0&&(m=f.value);var v=g(m);f.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),i.push(v)):e=e.concat(v)}for(var x=0;x<i.length;x+=1){var T=o[x],S=e.length;tt.argument(S<65536,"Table "+a.tableName+" too big."),e[T]=S>>8,e[T+1]=S&255,e=e.concat(i[x])}return e};rt.TABLE=function(a){for(var e=0,r=a.fields.length,i=0;i<r;i+=1){var o=a.fields[i],c=rt[o.type];tt.argument(c!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var f=a[o.name];f===void 0&&(f=o.value),e+=c(f),o.type==="TABLE"&&(e+=2)}return e};Be.RECORD=Be.TABLE;rt.RECORD=rt.TABLE;Be.LITERAL=function(a){return a};rt.LITERAL=function(a){return a.length};function Un(a,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var i=0;i<e.length;i+=1){var o=e[i];this[o.name]=o.value}if(this.tableName=a,this.fields=e,r)for(var c=Object.keys(r),f=0;f<c.length;f+=1){var g=c[f],m=r[g];this[g]!==void 0&&(this[g]=m)}}Un.prototype.encode=function(){return Be.TABLE(this)};Un.prototype.sizeOf=function(){return rt.TABLE(this)};function lo(a,e,r){r===void 0&&(r=e.length);var i=new Array(e.length+1);i[0]={name:a+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)i[o+1]={name:a+o,type:"USHORT",value:e[o]};return i}function Qf(a,e,r){var i=e.length,o=new Array(i+1);o[0]={name:a+"Count",type:"USHORT",value:i};for(var c=0;c<i;c++)o[c+1]={name:a+c,type:"TABLE",value:r(e[c],c)};return o}function oo(a,e,r){var i=e.length,o=[];o[0]={name:a+"Count",type:"USHORT",value:i};for(var c=0;c<i;c++)o=o.concat(r(e[c],c));return o}function Mc(a){a.format===1?Un.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(lo("glyph",a.glyphs))):a.format===2?Un.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(oo("rangeRecord",a.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):tt.assert(!1,"Coverage format must be 1 or 2.")}Mc.prototype=Object.create(Un.prototype);Mc.prototype.constructor=Mc;function Nc(a){Un.call(this,"scriptListTable",oo("scriptRecord",a,function(e,r){var i=e.script,o=i.defaultLangSys;return tt.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Un("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Un("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(lo("featureIndex",o.featureIndexes)))}].concat(oo("langSys",i.langSysRecords,function(c,f){var g=c.langSys;return[{name:"langSysTag"+f,type:"TAG",value:c.tag},{name:"langSys"+f,type:"TABLE",value:new Un("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:g.reqFeatureIndex}].concat(lo("featureIndex",g.featureIndexes)))}]})))}]}))}Nc.prototype=Object.create(Un.prototype);Nc.prototype.constructor=Nc;function kc(a){Un.call(this,"featureListTable",oo("featureRecord",a,function(e,r){var i=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Un("featureTable",[{name:"featureParams",type:"USHORT",value:i.featureParams}].concat(lo("lookupListIndex",i.lookupListIndexes)))}]}))}kc.prototype=Object.create(Un.prototype);kc.prototype.constructor=kc;function Rc(a,e){Un.call(this,"lookupListTable",Qf("lookup",a,function(r){var i=e[r.lookupType];return tt.assert(!!i,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Un("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Qf("subtable",r.subtables,i)))}))}Rc.prototype=Object.create(Un.prototype);Rc.prototype.constructor=Rc;var Fe={Table:Un,Record:Un,Coverage:Mc,ScriptList:Nc,FeatureList:kc,LookupList:Rc,ushortList:lo,tableList:Qf,recordList:oo};function tm(a,e){return a.getUint8(e)}function Dc(a,e){return a.getUint16(e,!1)}function hb(a,e){return a.getInt16(e,!1)}function dd(a,e){return a.getUint32(e,!1)}function dg(a,e){var r=a.getInt16(e,!1),i=a.getUint16(e+2,!1);return r+i/65535}function mb(a,e){for(var r="",i=e;i<e+4;i+=1)r+=String.fromCharCode(a.getInt8(i));return r}function gb(a,e,r){for(var i=0,o=0;o<r;o+=1)i<<=8,i+=a.getUint8(e+o);return i}function yb(a,e,r){for(var i=[],o=e;o<r;o+=1)i.push(a.getUint8(o));return i}function vb(a){for(var e="",r=0;r<a.length;r+=1)e+=String.fromCharCode(a[r]);return e}var bb={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function ye(a,e){this.data=a,this.offset=e,this.relativeOffset=0}ye.prototype.parseByte=function(){var a=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,a};ye.prototype.parseChar=function(){var a=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,a};ye.prototype.parseCard8=ye.prototype.parseByte;ye.prototype.parseUShort=function(){var a=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,a};ye.prototype.parseCard16=ye.prototype.parseUShort;ye.prototype.parseSID=ye.prototype.parseUShort;ye.prototype.parseOffset16=ye.prototype.parseUShort;ye.prototype.parseShort=function(){var a=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,a};ye.prototype.parseF2Dot14=function(){var a=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,a};ye.prototype.parseULong=function(){var a=dd(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,a};ye.prototype.parseOffset32=ye.prototype.parseULong;ye.prototype.parseFixed=function(){var a=dg(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,a};ye.prototype.parseString=function(a){var e=this.data,r=this.offset+this.relativeOffset,i="";this.relativeOffset+=a;for(var o=0;o<a;o++)i+=String.fromCharCode(e.getUint8(r+o));return i};ye.prototype.parseTag=function(){return this.parseString(4)};ye.prototype.parseLongDateTime=function(){var a=dd(this.data,this.offset+this.relativeOffset+4);return a-=2082844800,this.relativeOffset+=8,a};ye.prototype.parseVersion=function(a){var e=Dc(this.data,this.offset+this.relativeOffset),r=Dc(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,a===void 0&&(a=4096),e+r/a/10};ye.prototype.skip=function(a,e){e===void 0&&(e=1),this.relativeOffset+=bb[a]*e};ye.prototype.parseULongList=function(a){a===void 0&&(a=this.parseULong());for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint32(i),i+=4;return this.relativeOffset+=a*4,e};ye.prototype.parseOffset16List=ye.prototype.parseUShortList=function(a){a===void 0&&(a=this.parseUShort());for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint16(i),i+=2;return this.relativeOffset+=a*2,e};ye.prototype.parseShortList=function(a){for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getInt16(i),i+=2;return this.relativeOffset+=a*2,e};ye.prototype.parseByteList=function(a){for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint8(i++);return this.relativeOffset+=a,e};ye.prototype.parseList=function(a,e){e||(e=a,a=this.parseUShort());for(var r=new Array(a),i=0;i<a;i++)r[i]=e.call(this);return r};ye.prototype.parseList32=function(a,e){e||(e=a,a=this.parseULong());for(var r=new Array(a),i=0;i<a;i++)r[i]=e.call(this);return r};ye.prototype.parseRecordList=function(a,e){e||(e=a,a=this.parseUShort());for(var r=new Array(a),i=Object.keys(e),o=0;o<a;o++){for(var c={},f=0;f<i.length;f++){var g=i[f],m=e[g];c[g]=m.call(this)}r[o]=c}return r};ye.prototype.parseRecordList32=function(a,e){e||(e=a,a=this.parseULong());for(var r=new Array(a),i=Object.keys(e),o=0;o<a;o++){for(var c={},f=0;f<i.length;f++){var g=i[f],m=e[g];c[g]=m.call(this)}r[o]=c}return r};ye.prototype.parseStruct=function(a){if(typeof a=="function")return a.call(this);for(var e=Object.keys(a),r={},i=0;i<e.length;i++){var o=e[i],c=a[o];r[o]=c.call(this)}return r};ye.prototype.parseValueRecord=function(a){if(a===void 0&&(a=this.parseUShort()),a!==0){var e={};return a&1&&(e.xPlacement=this.parseShort()),a&2&&(e.yPlacement=this.parseShort()),a&4&&(e.xAdvance=this.parseShort()),a&8&&(e.yAdvance=this.parseShort()),a&16&&(e.xPlaDevice=void 0,this.parseShort()),a&32&&(e.yPlaDevice=void 0,this.parseShort()),a&64&&(e.xAdvDevice=void 0,this.parseShort()),a&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};ye.prototype.parseValueRecordList=function(){for(var a=this.parseUShort(),e=this.parseUShort(),r=new Array(e),i=0;i<e;i++)r[i]=this.parseValueRecord(a);return r};ye.prototype.parsePointer=function(a){var e=this.parseOffset16();if(e>0)return new ye(this.data,this.offset+e).parseStruct(a)};ye.prototype.parsePointer32=function(a){var e=this.parseOffset32();if(e>0)return new ye(this.data,this.offset+e).parseStruct(a)};ye.prototype.parseListOfLists=function(a){for(var e=this.parseOffset16List(),r=e.length,i=this.relativeOffset,o=new Array(r),c=0;c<r;c++){var f=e[c];if(f===0){o[c]=void 0;continue}if(this.relativeOffset=f,a){for(var g=this.parseOffset16List(),m=new Array(g.length),v=0;v<g.length;v++)this.relativeOffset=f+g[v],m[v]=a.call(this);o[c]=m}else o[c]=this.parseUShortList()}return this.relativeOffset=i,o};ye.prototype.parseCoverage=function(){var a=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var i=new Array(r),o=0;o<r;o++)i[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+a.toString(16)+": Coverage format must be 1 or 2.")};ye.prototype.parseClassDef=function(){var a=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:ye.uShort,end:ye.uShort,classId:ye.uShort})};throw new Error("0x"+a.toString(16)+": ClassDef format must be 1 or 2.")};ye.list=function(a,e){return function(){return this.parseList(a,e)}};ye.list32=function(a,e){return function(){return this.parseList32(a,e)}};ye.recordList=function(a,e){return function(){return this.parseRecordList(a,e)}};ye.recordList32=function(a,e){return function(){return this.parseRecordList32(a,e)}};ye.pointer=function(a){return function(){return this.parsePointer(a)}};ye.pointer32=function(a){return function(){return this.parsePointer32(a)}};ye.tag=ye.prototype.parseTag;ye.byte=ye.prototype.parseByte;ye.uShort=ye.offset16=ye.prototype.parseUShort;ye.uShortList=ye.prototype.parseUShortList;ye.uLong=ye.offset32=ye.prototype.parseULong;ye.uLongList=ye.prototype.parseULongList;ye.struct=ye.prototype.parseStruct;ye.coverage=ye.prototype.parseCoverage;ye.classDef=ye.prototype.parseClassDef;var nm={reserved:ye.uShort,reqFeatureIndex:ye.uShort,featureIndexes:ye.uShortList};ye.prototype.parseScriptList=function(){return this.parsePointer(ye.recordList({tag:ye.tag,script:ye.pointer({defaultLangSys:ye.pointer(nm),langSysRecords:ye.recordList({tag:ye.tag,langSys:ye.pointer(nm)})})}))||[]};ye.prototype.parseFeatureList=function(){return this.parsePointer(ye.recordList({tag:ye.tag,feature:ye.pointer({featureParams:ye.offset16,lookupListIndexes:ye.uShortList})}))||[]};ye.prototype.parseLookupList=function(a){return this.parsePointer(ye.list(ye.pointer(function(){var e=this.parseUShort();tt.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),i=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(ye.pointer(a[e])),markFilteringSet:i?this.parseUShort():void 0}})))||[]};ye.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var a=this.parseUShort(),e=this.parseUShort();tt.argument(a===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:ye.offset32,featureTableSubstitutionOffset:ye.offset32});return r})||[]};var He={getByte:tm,getCard8:tm,getUShort:Dc,getCard16:Dc,getShort:hb,getULong:dd,getFixed:dg,getTag:mb,getOffset:gb,getBytes:yb,bytesToString:vb,Parser:ye};function xb(a,e){e.parseUShort(),a.length=e.parseULong(),a.language=e.parseULong();var r;a.groupCount=r=e.parseULong(),a.glyphIndexMap={};for(var i=0;i<r;i+=1)for(var o=e.parseULong(),c=e.parseULong(),f=e.parseULong(),g=o;g<=c;g+=1)a.glyphIndexMap[g]=f,f++}function Sb(a,e,r,i,o){a.length=e.parseUShort(),a.language=e.parseUShort();var c;a.segCount=c=e.parseUShort()>>1,e.skip("uShort",3),a.glyphIndexMap={};for(var f=new He.Parser(r,i+o+14),g=new He.Parser(r,i+o+16+c*2),m=new He.Parser(r,i+o+16+c*4),v=new He.Parser(r,i+o+16+c*6),x=i+o+16+c*8,T=0;T<c-1;T+=1)for(var S=void 0,E=f.parseUShort(),M=g.parseUShort(),D=m.parseShort(),j=v.parseUShort(),P=M;P<=E;P+=1)j!==0?(x=v.offset+v.relativeOffset-2,x+=j,x+=(P-M)*2,S=He.getUShort(r,x),S!==0&&(S=S+D&65535)):S=P+D&65535,a.glyphIndexMap[P]=S}function Eb(a,e){var r={};r.version=He.getUShort(a,e),tt.argument(r.version===0,"cmap table version should be 0."),r.numTables=He.getUShort(a,e+2);for(var i=-1,o=r.numTables-1;o>=0;o-=1){var c=He.getUShort(a,e+4+o*8),f=He.getUShort(a,e+4+o*8+2);if(c===3&&(f===0||f===1||f===10)||c===0&&(f===0||f===1||f===2||f===3||f===4)){i=He.getULong(a,e+4+o*8+4);break}}if(i===-1)throw new Error("No valid cmap sub-tables found.");var g=new He.Parser(a,e+i);if(r.format=g.parseUShort(),r.format===12)xb(r,g);else if(r.format===4)Sb(r,g,a,e,i);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function wb(a,e,r){a.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Ab(a){a.segments.push({end:65535,start:65535,delta:1,offset:0})}function Tb(a){var e=!0,r;for(r=a.length-1;r>0;r-=1){var i=a.get(r);if(i.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var c=new Fe.Table("cmap",o);for(c.segments=[],r=0;r<a.length;r+=1){for(var f=a.get(r),g=0;g<f.unicodes.length;g+=1)wb(c,f.unicodes[g],r);c.segments=c.segments.sort(function(F,_){return F.start-_.start})}Ab(c);var m=c.segments.length,v=0,x=[],T=[],S=[],E=[],M=[],D=[];for(r=0;r<m;r+=1){var j=c.segments[r];j.end<=65535&&j.start<=65535?(x=x.concat({name:"end_"+r,type:"USHORT",value:j.end}),T=T.concat({name:"start_"+r,type:"USHORT",value:j.start}),S=S.concat({name:"idDelta_"+r,type:"SHORT",value:j.delta}),E=E.concat({name:"idRangeOffset_"+r,type:"USHORT",value:j.offset}),j.glyphId!==void 0&&(M=M.concat({name:"glyph_"+r,type:"USHORT",value:j.glyphId}))):v+=1,!e&&j.glyphIndex!==void 0&&(D=D.concat({name:"cmap12Start_"+r,type:"ULONG",value:j.start}),D=D.concat({name:"cmap12End_"+r,type:"ULONG",value:j.end}),D=D.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:j.glyphIndex}))}if(c.segCountX2=(m-v)*2,c.searchRange=Math.pow(2,Math.floor(Math.log(m-v)/Math.log(2)))*2,c.entrySelector=Math.log(c.searchRange/2)/Math.log(2),c.rangeShift=c.segCountX2-c.searchRange,c.fields=c.fields.concat(x),c.fields.push({name:"reservedPad",type:"USHORT",value:0}),c.fields=c.fields.concat(T),c.fields=c.fields.concat(S),c.fields=c.fields.concat(E),c.fields=c.fields.concat(M),c.cmap4Length=14+x.length*2+2+T.length*2+S.length*2+E.length*2+M.length*2,!e){var P=16+D.length*4;c.cmap12Offset=20+c.cmap4Length,c.fields=c.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:P},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:D.length/3}]),c.fields=c.fields.concat(D)}return c}var pg={parse:Eb,make:Tb},Ac=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Cb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Mb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],vi=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function hg(a){this.font=a}hg.prototype.charToGlyphIndex=function(a){var e=a.codePointAt(0),r=this.font.glyphs;if(r){for(var i=0;i<r.length;i+=1)for(var o=r.get(i),c=0;c<o.unicodes.length;c+=1)if(o.unicodes[c]===e)return i}return null};function mg(a){this.cmap=a}mg.prototype.charToGlyphIndex=function(a){return this.cmap.glyphIndexMap[a.codePointAt(0)]||0};function _c(a,e){this.encoding=a,this.charset=e}_c.prototype.charToGlyphIndex=function(a){var e=a.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function pd(a){switch(a.version){case 1:this.names=vi.slice();break;case 2:this.names=new Array(a.numberOfGlyphs);for(var e=0;e<a.numberOfGlyphs;e++)a.glyphNameIndex[e]<vi.length?this.names[e]=vi[a.glyphNameIndex[e]]:this.names[e]=a.names[a.glyphNameIndex[e]-vi.length];break;case 2.5:this.names=new Array(a.numberOfGlyphs);for(var r=0;r<a.numberOfGlyphs;r++)this.names[r]=vi[r+a.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}pd.prototype.nameToGlyphIndex=function(a){return this.names.indexOf(a)};pd.prototype.glyphIndexToName=function(a){return this.names[a]};function Nb(a){for(var e,r=a.tables.cmap.glyphIndexMap,i=Object.keys(r),o=0;o<i.length;o+=1){var c=i[o],f=r[c];e=a.glyphs.get(f),e.addUnicode(parseInt(c))}for(var g=0;g<a.glyphs.length;g+=1)e=a.glyphs.get(g),a.cffEncoding?a.isCIDFont?e.name="gid"+g:e.name=a.cffEncoding.charset[g]:a.glyphNames.names&&(e.name=a.glyphNames.glyphIndexToName(g))}function kb(a){a._IndexToUnicodeMap={};for(var e=a.tables.cmap.glyphIndexMap,r=Object.keys(e),i=0;i<r.length;i+=1){var o=r[i],c=e[o];a._IndexToUnicodeMap[c]===void 0?a._IndexToUnicodeMap[c]={unicodes:[parseInt(o)]}:a._IndexToUnicodeMap[c].unicodes.push(parseInt(o))}}function Rb(a,e){e.lowMemory?kb(a):Nb(a)}function Db(a,e,r,i,o){a.beginPath(),a.moveTo(e,r),a.lineTo(i,o),a.stroke()}var gi={line:Db};function _b(a,e){var r=e||new An;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(i){r=i}}}function ja(a){this.bindConstructorValues(a)}ja.prototype.bindConstructorValues=function(a){this.index=a.index||0,this.name=a.name||null,this.unicode=a.unicode||void 0,this.unicodes=a.unicodes||a.unicode!==void 0?[a.unicode]:[],"xMin"in a&&(this.xMin=a.xMin),"yMin"in a&&(this.yMin=a.yMin),"xMax"in a&&(this.xMax=a.xMax),"yMax"in a&&(this.yMax=a.yMax),"advanceWidth"in a&&(this.advanceWidth=a.advanceWidth),Object.defineProperty(this,"path",_b(this,a.path))};ja.prototype.addUnicode=function(a){this.unicodes.length===0&&(this.unicode=a),this.unicodes.push(a)};ja.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};ja.prototype.getPath=function(a,e,r,i,o){a=a!==void 0?a:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var c,f;i||(i={});var g=i.xScale,m=i.yScale;if(i.hinting&&o&&o.hinting&&(f=this.path&&o.hinting.exec(this,r)),f)c=o.hinting.getCommands(f),a=Math.round(a),e=Math.round(e),g=m=1;else{c=this.path.commands;var v=1/(this.path.unitsPerEm||1e3)*r;g===void 0&&(g=v),m===void 0&&(m=v)}for(var x=new An,T=0;T<c.length;T+=1){var S=c[T];S.type==="M"?x.moveTo(a+S.x*g,e+-S.y*m):S.type==="L"?x.lineTo(a+S.x*g,e+-S.y*m):S.type==="Q"?x.quadraticCurveTo(a+S.x1*g,e+-S.y1*m,a+S.x*g,e+-S.y*m):S.type==="C"?x.curveTo(a+S.x1*g,e+-S.y1*m,a+S.x2*g,e+-S.y2*m,a+S.x*g,e+-S.y*m):S.type==="Z"&&x.closePath()}return x};ja.prototype.getContours=function(){if(this.points===void 0)return[];for(var a=[],e=[],r=0;r<this.points.length;r+=1){var i=this.points[r];e.push(i),i.lastPointOfContour&&(a.push(e),e=[])}return tt.argument(e.length===0,"There are still points left in the current contour."),a};ja.prototype.getMetrics=function(){for(var a=this.path.commands,e=[],r=[],i=0;i<a.length;i+=1){var o=a[i];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var c={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(c.xMin)||(c.xMin=0),isFinite(c.xMax)||(c.xMax=this.advanceWidth),isFinite(c.yMin)||(c.yMin=0),isFinite(c.yMax)||(c.yMax=0),c.rightSideBearing=this.advanceWidth-c.leftSideBearing-(c.xMax-c.xMin),c};ja.prototype.draw=function(a,e,r,i,o){this.getPath(e,r,i,o).draw(a)};ja.prototype.drawPoints=function(a,e,r,i){function o(T,S,E,M){a.beginPath();for(var D=0;D<T.length;D+=1)a.moveTo(S+T[D].x*M,E+T[D].y*M),a.arc(S+T[D].x*M,E+T[D].y*M,2,0,Math.PI*2,!1);a.closePath(),a.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:24;for(var c=1/this.path.unitsPerEm*i,f=[],g=[],m=this.path,v=0;v<m.commands.length;v+=1){var x=m.commands[v];x.x!==void 0&&f.push({x:x.x,y:-x.y}),x.x1!==void 0&&g.push({x:x.x1,y:-x.y1}),x.x2!==void 0&&g.push({x:x.x2,y:-x.y2})}a.fillStyle="blue",o(f,e,r,c),a.fillStyle="red",o(g,e,r,c)};ja.prototype.drawMetrics=function(a,e,r,i){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:24,o=1/this.path.unitsPerEm*i,a.lineWidth=1,a.strokeStyle="black",gi.line(a,e,-1e4,e,1e4),gi.line(a,-1e4,r,1e4,r);var c=this.xMin||0,f=this.yMin||0,g=this.xMax||0,m=this.yMax||0,v=this.advanceWidth||0;a.strokeStyle="blue",gi.line(a,e+c*o,-1e4,e+c*o,1e4),gi.line(a,e+g*o,-1e4,e+g*o,1e4),gi.line(a,-1e4,r+-f*o,1e4,r+-f*o),gi.line(a,-1e4,r+-m*o,1e4,r+-m*o),a.strokeStyle="green",gi.line(a,e+v*o,-1e4,e+v*o,1e4)};function xc(a,e,r){Object.defineProperty(a,e,{get:function(){return a.path,a[r]},set:function(i){a[r]=i},enumerable:!0,configurable:!0})}function hd(a,e){if(this.font=a,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var i=e[r];i.path.unitsPerEm=a.unitsPerEm,this.glyphs[r]=i}this.length=e&&e.length||0}hd.prototype.get=function(a){if(this.glyphs[a]===void 0){this.font._push(a),typeof this.glyphs[a]=="function"&&(this.glyphs[a]=this.glyphs[a]());var e=this.glyphs[a],r=this.font._IndexToUnicodeMap[a];if(r)for(var i=0;i<r.unicodes.length;i++)e.addUnicode(r.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+a:e.name=this.font.cffEncoding.charset[a]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(a)),this.glyphs[a].advanceWidth=this.font._hmtxTableData[a].advanceWidth,this.glyphs[a].leftSideBearing=this.font._hmtxTableData[a].leftSideBearing}else typeof this.glyphs[a]=="function"&&(this.glyphs[a]=this.glyphs[a]());return this.glyphs[a]};hd.prototype.push=function(a,e){this.glyphs[a]=e,this.length++};function Ob(a,e){return new ja({index:e,font:a})}function Ib(a,e,r,i,o,c){return function(){var f=new ja({index:e,font:a});return f.path=function(){r(f,i,o);var g=c(a.glyphs,f);return g.unitsPerEm=a.unitsPerEm,g},xc(f,"xMin","_xMin"),xc(f,"xMax","_xMax"),xc(f,"yMin","_yMin"),xc(f,"yMax","_yMax"),f}}function Lb(a,e,r,i){return function(){var o=new ja({index:e,font:a});return o.path=function(){var c=r(a,o,i);return c.unitsPerEm=a.unitsPerEm,c},o}}var jr={GlyphSet:hd,glyphLoader:Ob,ttfGlyphLoader:Ib,cffGlyphLoader:Lb};function gg(a,e){if(a===e)return!0;if(Array.isArray(a)&&Array.isArray(e)){if(a.length!==e.length)return!1;for(var r=0;r<a.length;r+=1)if(!gg(a[r],e[r]))return!1;return!0}else return!1}function Kf(a){var e;return a.length<1240?e=107:a.length<33900?e=1131:e=32768,e}function Gs(a,e,r){var i=[],o=[],c=He.getCard16(a,e),f,g;if(c!==0){var m=He.getByte(a,e+2);f=e+(c+1)*m+2;for(var v=e+3,x=0;x<c+1;x+=1)i.push(He.getOffset(a,v,m)),v+=m;g=f+i[c]}else g=e+2;for(var T=0;T<i.length-1;T+=1){var S=He.getBytes(a,f+i[T],f+i[T+1]);r&&(S=r(S)),o.push(S)}return{objects:o,startOffset:e,endOffset:g}}function Ub(a,e){var r=[],i=He.getCard16(a,e),o,c;if(i!==0){var f=He.getByte(a,e+2);o=e+(i+1)*f+2;for(var g=e+3,m=0;m<i+1;m+=1)r.push(He.getOffset(a,g,f)),g+=f;c=o+r[i]}else c=e+2;return{offsets:r,startOffset:e,endOffset:c}}function jb(a,e,r,i,o){var c=He.getCard16(r,i),f=0;if(c!==0){var g=He.getByte(r,i+2);f=i+(c+1)*g+2}var m=He.getBytes(r,f+e[a],f+e[a+1]);return m}function Bb(a){for(var e="",r=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=a.parseByte(),c=o>>4,f=o&15;if(c===r||(e+=i[c],f===r))break;e+=i[f]}return parseFloat(e)}function Fb(a,e){var r,i,o,c;if(e===28)return r=a.parseByte(),i=a.parseByte(),r<<8|i;if(e===29)return r=a.parseByte(),i=a.parseByte(),o=a.parseByte(),c=a.parseByte(),r<<24|i<<16|o<<8|c;if(e===30)return Bb(a);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=a.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=a.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function Pb(a){for(var e={},r=0;r<a.length;r+=1){var i=a[r][0],o=a[r][1],c=void 0;if(o.length===1?c=o[0]:c=o,e.hasOwnProperty(i)&&!isNaN(e[i]))throw new Error("Object "+e+" already has key "+i);e[i]=c}return e}function yg(a,e,r){e=e!==void 0?e:0;var i=new He.Parser(a,e),o=[],c=[];for(r=r!==void 0?r:a.length;i.relativeOffset<r;){var f=i.parseByte();f<=21?(f===12&&(f=1200+i.parseByte()),o.push([f,c]),c=[]):c.push(Fb(i,f))}return Pb(o)}function no(a,e){return e<=390?e=Ac[e]:e=a[e-391],e}function vg(a,e,r){for(var i={},o,c=0;c<e.length;c+=1){var f=e[c];if(Array.isArray(f.type)){var g=[];g.length=f.type.length;for(var m=0;m<f.type.length;m++)o=a[f.op]!==void 0?a[f.op][m]:void 0,o===void 0&&(o=f.value!==void 0&&f.value[m]!==void 0?f.value[m]:null),f.type[m]==="SID"&&(o=no(r,o)),g[m]=o;i[f.name]=g}else o=a[f.op],o===void 0&&(o=f.value!==void 0?f.value:null),f.type==="SID"&&(o=no(r,o)),i[f.name]=o}return i}function zb(a,e){var r={};return r.formatMajor=He.getCard8(a,e),r.formatMinor=He.getCard8(a,e+1),r.size=He.getCard8(a,e+2),r.offsetSize=He.getCard8(a,e+3),r.startOffset=e,r.endOffset=e+4,r}var bg=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],xg=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Gb(a,e){var r=yg(a,0,a.byteLength);return vg(r,bg,e)}function Sg(a,e,r,i){var o=yg(a,e,r);return vg(o,xg,i)}function am(a,e,r,i){for(var o=[],c=0;c<r.length;c+=1){var f=new DataView(new Uint8Array(r[c]).buffer),g=Gb(f,i);g._subrs=[],g._subrsBias=0,g._defaultWidthX=0,g._nominalWidthX=0;var m=g.private[0],v=g.private[1];if(m!==0&&v!==0){var x=Sg(a,v+e,m,i);if(g._defaultWidthX=x.defaultWidthX,g._nominalWidthX=x.nominalWidthX,x.subrs!==0){var T=v+x.subrs,S=Gs(a,T+e);g._subrs=S.objects,g._subrsBias=Kf(g._subrs)}g._privateDict=x}o.push(g)}return o}function Hb(a,e,r,i){var o,c,f=new He.Parser(a,e);r-=1;var g=[".notdef"],m=f.parseCard8();if(m===0)for(var v=0;v<r;v+=1)o=f.parseSID(),g.push(no(i,o));else if(m===1)for(;g.length<=r;){o=f.parseSID(),c=f.parseCard8();for(var x=0;x<=c;x+=1)g.push(no(i,o)),o+=1}else if(m===2)for(;g.length<=r;){o=f.parseSID(),c=f.parseCard16();for(var T=0;T<=c;T+=1)g.push(no(i,o)),o+=1}else throw new Error("Unknown charset format "+m);return g}function Yb(a,e,r){var i,o={},c=new He.Parser(a,e),f=c.parseCard8();if(f===0)for(var g=c.parseCard8(),m=0;m<g;m+=1)i=c.parseCard8(),o[i]=m;else if(f===1){var v=c.parseCard8();i=1;for(var x=0;x<v;x+=1)for(var T=c.parseCard8(),S=c.parseCard8(),E=T;E<=T+S;E+=1)o[E]=i,i+=1}else throw new Error("Unknown encoding format "+f);return new _c(o,r)}function rm(a,e,r){var i,o,c,f,g=new An,m=[],v=0,x=!1,T=!1,S=0,E=0,M,D,j,P;if(a.isCIDFont){var F=a.tables.cff.topDict._fdSelect[e.index],_=a.tables.cff.topDict._fdArray[F];M=_._subrs,D=_._subrsBias,j=_._defaultWidthX,P=_._nominalWidthX}else M=a.tables.cff.topDict._subrs,D=a.tables.cff.topDict._subrsBias,j=a.tables.cff.topDict._defaultWidthX,P=a.tables.cff.topDict._nominalWidthX;var L=j;function I(J,ie){T&&g.closePath(),g.moveTo(J,ie),T=!0}function V(){var J;J=m.length%2!==0,J&&!x&&(L=m.shift()+P),v+=m.length>>1,m.length=0,x=!0}function $(J){for(var ie,oe,U,K,Z,W,re,Y,ee,ue,Ee,q,Q=0;Q<J.length;){var be=J[Q];switch(Q+=1,be){case 1:V();break;case 3:V();break;case 4:m.length>1&&!x&&(L=m.shift()+P,x=!0),E+=m.pop(),I(S,E);break;case 5:for(;m.length>0;)S+=m.shift(),E+=m.shift(),g.lineTo(S,E);break;case 6:for(;m.length>0&&(S+=m.shift(),g.lineTo(S,E),m.length!==0);)E+=m.shift(),g.lineTo(S,E);break;case 7:for(;m.length>0&&(E+=m.shift(),g.lineTo(S,E),m.length!==0);)S+=m.shift(),g.lineTo(S,E);break;case 8:for(;m.length>0;)i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f+m.shift(),g.curveTo(i,o,c,f,S,E);break;case 10:Z=m.pop()+D,W=M[Z],W&&$(W);break;case 11:return;case 12:switch(be=J[Q],Q+=1,be){case 35:i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),re=c+m.shift(),Y=f+m.shift(),ee=re+m.shift(),ue=Y+m.shift(),Ee=ee+m.shift(),q=ue+m.shift(),S=Ee+m.shift(),E=q+m.shift(),m.shift(),g.curveTo(i,o,c,f,re,Y),g.curveTo(ee,ue,Ee,q,S,E);break;case 34:i=S+m.shift(),o=E,c=i+m.shift(),f=o+m.shift(),re=c+m.shift(),Y=f,ee=re+m.shift(),ue=f,Ee=ee+m.shift(),q=E,S=Ee+m.shift(),g.curveTo(i,o,c,f,re,Y),g.curveTo(ee,ue,Ee,q,S,E);break;case 36:i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),re=c+m.shift(),Y=f,ee=re+m.shift(),ue=f,Ee=ee+m.shift(),q=ue+m.shift(),S=Ee+m.shift(),g.curveTo(i,o,c,f,re,Y),g.curveTo(ee,ue,Ee,q,S,E);break;case 37:i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),re=c+m.shift(),Y=f+m.shift(),ee=re+m.shift(),ue=Y+m.shift(),Ee=ee+m.shift(),q=ue+m.shift(),Math.abs(Ee-S)>Math.abs(q-E)?S=Ee+m.shift():E=q+m.shift(),g.curveTo(i,o,c,f,re,Y),g.curveTo(ee,ue,Ee,q,S,E);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+be),m.length=0}break;case 14:m.length>0&&!x&&(L=m.shift()+P,x=!0),T&&(g.closePath(),T=!1);break;case 18:V();break;case 19:case 20:V(),Q+=v+7>>3;break;case 21:m.length>2&&!x&&(L=m.shift()+P,x=!0),E+=m.pop(),S+=m.pop(),I(S,E);break;case 22:m.length>1&&!x&&(L=m.shift()+P,x=!0),S+=m.pop(),I(S,E);break;case 23:V();break;case 24:for(;m.length>2;)i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f+m.shift(),g.curveTo(i,o,c,f,S,E);S+=m.shift(),E+=m.shift(),g.lineTo(S,E);break;case 25:for(;m.length>6;)S+=m.shift(),E+=m.shift(),g.lineTo(S,E);i=S+m.shift(),o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f+m.shift(),g.curveTo(i,o,c,f,S,E);break;case 26:for(m.length%2&&(S+=m.shift());m.length>0;)i=S,o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c,E=f+m.shift(),g.curveTo(i,o,c,f,S,E);break;case 27:for(m.length%2&&(E+=m.shift());m.length>0;)i=S+m.shift(),o=E,c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f,g.curveTo(i,o,c,f,S,E);break;case 28:ie=J[Q],oe=J[Q+1],m.push((ie<<24|oe<<16)>>16),Q+=2;break;case 29:Z=m.pop()+a.gsubrsBias,W=a.gsubrs[Z],W&&$(W);break;case 30:for(;m.length>0&&(i=S,o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f+(m.length===1?m.shift():0),g.curveTo(i,o,c,f,S,E),m.length!==0);)i=S+m.shift(),o=E,c=i+m.shift(),f=o+m.shift(),E=f+m.shift(),S=c+(m.length===1?m.shift():0),g.curveTo(i,o,c,f,S,E);break;case 31:for(;m.length>0&&(i=S+m.shift(),o=E,c=i+m.shift(),f=o+m.shift(),E=f+m.shift(),S=c+(m.length===1?m.shift():0),g.curveTo(i,o,c,f,S,E),m.length!==0);)i=S,o=E+m.shift(),c=i+m.shift(),f=o+m.shift(),S=c+m.shift(),E=f+(m.length===1?m.shift():0),g.curveTo(i,o,c,f,S,E);break;default:be<32?console.log("Glyph "+e.index+": unknown operator "+be):be<247?m.push(be-139):be<251?(ie=J[Q],Q+=1,m.push((be-247)*256+ie+108)):be<255?(ie=J[Q],Q+=1,m.push(-(be-251)*256-ie-108)):(ie=J[Q],oe=J[Q+1],U=J[Q+2],K=J[Q+3],Q+=4,m.push((ie<<24|oe<<16|U<<8|K)/65536))}}}return $(r),e.advanceWidth=L,g}function qb(a,e,r,i){var o=[],c,f=new He.Parser(a,e),g=f.parseCard8();if(g===0)for(var m=0;m<r;m++){if(c=f.parseCard8(),c>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+c+" (FD count "+i+")");o.push(c)}else if(g===3){var v=f.parseCard16(),x=f.parseCard16();if(x!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+x);for(var T,S=0;S<v;S++){if(c=f.parseCard8(),T=f.parseCard16(),c>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+c+" (FD count "+i+")");if(T>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+T);for(;x<T;x++)o.push(c);x=T}if(T!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+T)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+g);return o}function Vb(a,e,r,i){r.tables.cff={};var o=zb(a,e),c=Gs(a,o.endOffset,He.bytesToString),f=Gs(a,c.endOffset),g=Gs(a,f.endOffset,He.bytesToString),m=Gs(a,g.endOffset);r.gsubrs=m.objects,r.gsubrsBias=Kf(r.gsubrs);var v=am(a,e,f.objects,g.objects);if(v.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+v.length);var x=v[0];if(r.tables.cff.topDict=x,x._privateDict&&(r.defaultWidthX=x._privateDict.defaultWidthX,r.nominalWidthX=x._privateDict.nominalWidthX),x.ros[0]!==void 0&&x.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var T=x.fdArray,S=x.fdSelect;if(T===0||S===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");T+=e;var E=Gs(a,T),M=am(a,e,E.objects,g.objects);x._fdArray=M,S+=e,x._fdSelect=qb(a,S,r.numGlyphs,M.length)}var D=e+x.private[1],j=Sg(a,D,x.private[0],g.objects);if(r.defaultWidthX=j.defaultWidthX,r.nominalWidthX=j.nominalWidthX,j.subrs!==0){var P=D+j.subrs,F=Gs(a,P);r.subrs=F.objects,r.subrsBias=Kf(r.subrs)}else r.subrs=[],r.subrsBias=0;var _;i.lowMemory?(_=Ub(a,e+x.charStrings),r.nGlyphs=_.offsets.length):(_=Gs(a,e+x.charStrings),r.nGlyphs=_.objects.length);var L=Hb(a,e+x.charset,r.nGlyphs,g.objects);if(x.encoding===0?r.cffEncoding=new _c(Cb,L):x.encoding===1?r.cffEncoding=new _c(Mb,L):r.cffEncoding=Yb(a,e+x.encoding,L),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new jr.GlyphSet(r),i.lowMemory)r._push=function($){var J=jb($,_.offsets,a,e+x.charStrings);r.glyphs.push($,jr.cffGlyphLoader(r,$,rm,J))};else for(var I=0;I<r.nGlyphs;I+=1){var V=_.objects[I];r.glyphs.push(I,jr.cffGlyphLoader(r,I,rm,V))}}function Eg(a,e){var r,i=Ac.indexOf(a);return i>=0&&(r=i),i=e.indexOf(a),i>=0?r=i+Ac.length:(r=Ac.length+e.length,e.push(a)),r}function Xb(){return new Fe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function $b(a){var e=new Fe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<a.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:a[r]});return e}function wg(a,e,r){for(var i={},o=0;o<a.length;o+=1){var c=a[o],f=e[c.name];f!==void 0&&!gg(f,c.value)&&(c.type==="SID"&&(f=Eg(f,r)),i[c.op]={name:c.name,type:c.type,value:f})}return i}function sm(a,e){var r=new Fe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=wg(bg,a,e),r}function im(a){var e=new Fe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:a}],e}function Wb(a){var e=new Fe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<a.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:a[r]});return e}function Zb(){return new Fe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Qb(a,e){for(var r=new Fe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<a.length;i+=1){var o=a[i],c=Eg(o,e);r.fields.push({name:"glyph_"+i,type:"SID",value:c})}return r}function Kb(a){var e=[],r=a.path;e.push({name:"width",type:"NUMBER",value:a.advanceWidth});for(var i=0,o=0,c=0;c<r.commands.length;c+=1){var f=void 0,g=void 0,m=r.commands[c];if(m.type==="Q"){var v=.3333333333333333,x=2/3;m={type:"C",x:m.x,y:m.y,x1:Math.round(v*i+x*m.x1),y1:Math.round(v*o+x*m.y1),x2:Math.round(v*m.x+x*m.x1),y2:Math.round(v*m.y+x*m.y1)}}if(m.type==="M")f=Math.round(m.x-i),g=Math.round(m.y-o),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:g}),e.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(m.x),o=Math.round(m.y);else if(m.type==="L")f=Math.round(m.x-i),g=Math.round(m.y-o),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:g}),e.push({name:"rlineto",type:"OP",value:5}),i=Math.round(m.x),o=Math.round(m.y);else if(m.type==="C"){var T=Math.round(m.x1-i),S=Math.round(m.y1-o),E=Math.round(m.x2-m.x1),M=Math.round(m.y2-m.y1);f=Math.round(m.x-m.x2),g=Math.round(m.y-m.y2),e.push({name:"dx1",type:"NUMBER",value:T}),e.push({name:"dy1",type:"NUMBER",value:S}),e.push({name:"dx2",type:"NUMBER",value:E}),e.push({name:"dy2",type:"NUMBER",value:M}),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:g}),e.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(m.x),o=Math.round(m.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Jb(a){for(var e=new Fe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<a.length;r+=1){var i=a.get(r),o=Kb(i);e.charStrings.push({name:i.name,type:"CHARSTRING",value:o})}return e}function ex(a,e){var r=new Fe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=wg(xg,a,e),r}function tx(a,e){for(var r=new Fe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},c={},f=[],g,m=1;m<a.length;m+=1)g=a.get(m),f.push(g.name);var v=[];r.header=Xb(),r.nameIndex=$b([e.postScriptName]);var x=sm(o,v);r.topDictIndex=im(x),r.globalSubrIndex=Zb(),r.charsets=Qb(f,v),r.charStringsIndex=Jb(a),r.privateDict=ex(c,v),r.stringIndex=Wb(v);var T=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=T,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),x=sm(o,v),r.topDictIndex=im(x),r}var Ag={parse:Vb,make:tx};function nx(a,e){var r={},i=new He.Parser(a,e);return r.version=i.parseVersion(),r.fontRevision=Math.round(i.parseFixed()*1e3)/1e3,r.checkSumAdjustment=i.parseULong(),r.magicNumber=i.parseULong(),tt.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=i.parseUShort(),r.unitsPerEm=i.parseUShort(),r.created=i.parseLongDateTime(),r.modified=i.parseLongDateTime(),r.xMin=i.parseShort(),r.yMin=i.parseShort(),r.xMax=i.parseShort(),r.yMax=i.parseShort(),r.macStyle=i.parseUShort(),r.lowestRecPPEM=i.parseUShort(),r.fontDirectionHint=i.parseShort(),r.indexToLocFormat=i.parseShort(),r.glyphDataFormat=i.parseShort(),r}function ax(a){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return a.createdTimestamp&&(r=a.createdTimestamp+2082844800),new Fe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],a)}var Tg={parse:nx,make:ax};function rx(a,e){var r={},i=new He.Parser(a,e);return r.version=i.parseVersion(),r.ascender=i.parseShort(),r.descender=i.parseShort(),r.lineGap=i.parseShort(),r.advanceWidthMax=i.parseUShort(),r.minLeftSideBearing=i.parseShort(),r.minRightSideBearing=i.parseShort(),r.xMaxExtent=i.parseShort(),r.caretSlopeRise=i.parseShort(),r.caretSlopeRun=i.parseShort(),r.caretOffset=i.parseShort(),i.relativeOffset+=8,r.metricDataFormat=i.parseShort(),r.numberOfHMetrics=i.parseUShort(),r}function sx(a){return new Fe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],a)}var Cg={parse:rx,make:sx};function ix(a,e,r,i,o){for(var c,f,g=new He.Parser(a,e),m=0;m<i;m+=1){m<r&&(c=g.parseUShort(),f=g.parseShort());var v=o.get(m);v.advanceWidth=c,v.leftSideBearing=f}}function lx(a,e,r,i,o){a._hmtxTableData={};for(var c,f,g=new He.Parser(e,r),m=0;m<o;m+=1)m<i&&(c=g.parseUShort(),f=g.parseShort()),a._hmtxTableData[m]={advanceWidth:c,leftSideBearing:f}}function ox(a,e,r,i,o,c,f){f.lowMemory?lx(a,e,r,i,o):ix(e,r,i,o,c)}function cx(a){for(var e=new Fe.Table("hmtx",[]),r=0;r<a.length;r+=1){var i=a.get(r),o=i.advanceWidth||0,c=i.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:c})}return e}var Mg={parse:ox,make:cx};function ux(a){for(var e=new Fe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:a.length}]),r="",i=12+a.length*4,o=0;o<a.length;++o){var c=r.indexOf(a[o]);c<0&&(c=r.length,r+=a[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:i+c}),e.fields.push({name:"length "+o,type:"USHORT",value:a[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function fx(a,e){var r=new He.Parser(a,e),i=r.parseULong();tt.argument(i===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),c=[],f=0;f<o;f++){for(var g="",m=e+r.parseUShort(),v=r.parseUShort(),x=m;x<m+v;++x)g+=String.fromCharCode(a.getInt8(x));c.push(g)}return c}var Ng={make:ux,parse:fx};function dx(a,e){var r={},i=new He.Parser(a,e);return r.version=i.parseVersion(),r.numGlyphs=i.parseUShort(),r.version===1&&(r.maxPoints=i.parseUShort(),r.maxContours=i.parseUShort(),r.maxCompositePoints=i.parseUShort(),r.maxCompositeContours=i.parseUShort(),r.maxZones=i.parseUShort(),r.maxTwilightPoints=i.parseUShort(),r.maxStorage=i.parseUShort(),r.maxFunctionDefs=i.parseUShort(),r.maxInstructionDefs=i.parseUShort(),r.maxStackElements=i.parseUShort(),r.maxSizeOfInstructions=i.parseUShort(),r.maxComponentElements=i.parseUShort(),r.maxComponentDepth=i.parseUShort()),r}function px(a){return new Fe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:a}])}var kg={parse:dx,make:px},Rg=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Dg={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},hx={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},_g={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function mx(a,e,r){switch(a){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Dg[e];case 3:return _g[e]}}var Jf="utf-16",gx={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},yx={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Og(a,e,r){switch(a){case 0:return Jf;case 1:return yx[r]||gx[e];case 3:if(e===1||e===10)return Jf;break}}function vx(a,e,r){for(var i={},o=new He.Parser(a,e),c=o.parseUShort(),f=o.parseUShort(),g=o.offset+o.parseUShort(),m=0;m<f;m++){var v=o.parseUShort(),x=o.parseUShort(),T=o.parseUShort(),S=o.parseUShort(),E=Rg[S]||S,M=o.parseUShort(),D=o.parseUShort(),j=mx(v,T,r),P=Og(v,x,T);if(P!==void 0&&j!==void 0){var F=void 0;if(P===Jf?F=sl.UTF16(a,g+D,M):F=sl.MACSTRING(a,g+D,M,P),F){var _=i[E];_===void 0&&(_=i[E]={}),_[j]=F}}}return c===1&&o.parseUShort(),i}function Lf(a){var e={};for(var r in a)e[a[r]]=parseInt(r);return e}function lm(a,e,r,i,o,c){return new Fe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:a},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:c}])}function bx(a,e){var r=a.length,i=e.length-r+1;e:for(var o=0;o<i;o++)for(;o<i;o++){for(var c=0;c<r;c++)if(e[o+c]!==a[c])continue e;return o}return-1}function om(a,e){var r=bx(a,e);if(r<0){r=e.length;for(var i=0,o=a.length;i<o;++i)e.push(a[i])}return r}function xx(a,e){var r,i=[],o={},c=Lf(Rg);for(var f in a){var g=c[f];if(g===void 0&&(g=f),r=parseInt(g),isNaN(r))throw new Error('Name table entry "'+f+'" does not exist, see nameTableNames for complete list.');o[r]=a[f],i.push(r)}for(var m=Lf(Dg),v=Lf(_g),x=[],T=[],S=0;S<i.length;S++){r=i[S];var E=o[r];for(var M in E){var D=E[M],j=1,P=m[M],F=hx[P],_=Og(j,F,P),L=Be.MACSTRING(D,_);L===void 0&&(j=0,P=e.indexOf(M),P<0&&(P=e.length,e.push(M)),F=4,L=Be.UTF16(D));var I=om(L,T);x.push(lm(j,F,P,r,L.length,I));var V=v[M];if(V!==void 0){var $=Be.UTF16(D),J=om($,T);x.push(lm(3,1,V,r,$.length,J))}}}x.sort(function(U,K){return U.platformID-K.platformID||U.encodingID-K.encodingID||U.languageID-K.languageID||U.nameID-K.nameID});for(var ie=new Fe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:x.length},{name:"stringOffset",type:"USHORT",value:6+x.length*12}]),oe=0;oe<x.length;oe++)ie.fields.push({name:"record_"+oe,type:"RECORD",value:x[oe]});return ie.fields.push({name:"strings",type:"LITERAL",value:T}),ie}var Ig={parse:vx,make:xx},ed=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Sx(a){for(var e=0;e<ed.length;e+=1){var r=ed[e];if(a>=r.begin&&a<r.end)return e}return-1}function Ex(a,e){var r={},i=new He.Parser(a,e);r.version=i.parseUShort(),r.xAvgCharWidth=i.parseShort(),r.usWeightClass=i.parseUShort(),r.usWidthClass=i.parseUShort(),r.fsType=i.parseUShort(),r.ySubscriptXSize=i.parseShort(),r.ySubscriptYSize=i.parseShort(),r.ySubscriptXOffset=i.parseShort(),r.ySubscriptYOffset=i.parseShort(),r.ySuperscriptXSize=i.parseShort(),r.ySuperscriptYSize=i.parseShort(),r.ySuperscriptXOffset=i.parseShort(),r.ySuperscriptYOffset=i.parseShort(),r.yStrikeoutSize=i.parseShort(),r.yStrikeoutPosition=i.parseShort(),r.sFamilyClass=i.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=i.parseByte();return r.ulUnicodeRange1=i.parseULong(),r.ulUnicodeRange2=i.parseULong(),r.ulUnicodeRange3=i.parseULong(),r.ulUnicodeRange4=i.parseULong(),r.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),r.fsSelection=i.parseUShort(),r.usFirstCharIndex=i.parseUShort(),r.usLastCharIndex=i.parseUShort(),r.sTypoAscender=i.parseShort(),r.sTypoDescender=i.parseShort(),r.sTypoLineGap=i.parseShort(),r.usWinAscent=i.parseUShort(),r.usWinDescent=i.parseUShort(),r.version>=1&&(r.ulCodePageRange1=i.parseULong(),r.ulCodePageRange2=i.parseULong()),r.version>=2&&(r.sxHeight=i.parseShort(),r.sCapHeight=i.parseShort(),r.usDefaultChar=i.parseUShort(),r.usBreakChar=i.parseUShort(),r.usMaxContent=i.parseUShort()),r}function wx(a){return new Fe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],a)}var td={parse:Ex,make:wx,unicodeRanges:ed,getUnicodeRange:Sx};function Ax(a,e){var r={},i=new He.Parser(a,e);switch(r.version=i.parseVersion(),r.italicAngle=i.parseFixed(),r.underlinePosition=i.parseShort(),r.underlineThickness=i.parseShort(),r.isFixedPitch=i.parseULong(),r.minMemType42=i.parseULong(),r.maxMemType42=i.parseULong(),r.minMemType1=i.parseULong(),r.maxMemType1=i.parseULong(),r.version){case 1:r.names=vi.slice();break;case 2:r.numberOfGlyphs=i.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=i.parseUShort();r.names=[];for(var c=0;c<r.numberOfGlyphs;c++)if(r.glyphNameIndex[c]>=vi.length){var f=i.parseChar();r.names.push(i.parseString(f))}break;case 2.5:r.numberOfGlyphs=i.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var g=0;g<r.numberOfGlyphs;g++)r.offset[g]=i.parseChar();break}return r}function Tx(){return new Fe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Lg={parse:Ax,make:Tx},hr=new Array(9);hr[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(ye.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(ye.coverage),substitute:this.parseOffset16List()};tt.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};hr[2]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),sequences:this.parseListOfLists()}};hr[3]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),alternateSets:this.parseListOfLists()}};hr[4]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var al={sequenceIndex:ye.uShort,lookupListIndex:ye.uShort};hr[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(ye.coverage),ruleSets:this.parseListOfLists(function(){var c=this.parseUShort(),f=this.parseUShort();return{input:this.parseUShortList(c-1),lookupRecords:this.parseRecordList(f,al)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(ye.coverage),classDef:this.parsePointer(ye.classDef),classSets:this.parseListOfLists(function(){var c=this.parseUShort(),f=this.parseUShort();return{classes:this.parseUShortList(c-1),lookupRecords:this.parseRecordList(f,al)}})};if(r===3){var i=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(i,ye.pointer(ye.coverage)),lookupRecords:this.parseRecordList(o,al)}}tt.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};hr[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(ye.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(al)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(ye.coverage),backtrackClassDef:this.parsePointer(ye.classDef),inputClassDef:this.parsePointer(ye.classDef),lookaheadClassDef:this.parsePointer(ye.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(al)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(ye.pointer(ye.coverage)),inputCoverage:this.parseList(ye.pointer(ye.coverage)),lookaheadCoverage:this.parseList(ye.pointer(ye.coverage)),lookupRecords:this.parseRecordList(al)};tt.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};hr[7]=function(){var e=this.parseUShort();tt.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),i=new ye(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:hr[r].call(i)}};hr[8]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),backtrackCoverage:this.parseList(ye.pointer(ye.coverage)),lookaheadCoverage:this.parseList(ye.pointer(ye.coverage)),substitutes:this.parseUShortList()}};function Cx(a,e){e=e||0;var r=new ye(a,e),i=r.parseVersion(1);return tt.argument(i===1||i===1.1,"Unsupported GSUB table version."),i===1?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(hr)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(hr),variations:r.parseFeatureVariationsList()}}var il=new Array(9);il[1]=function(e){return e.substFormat===1?new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.ushortList("substitute",e.substitute)))};il[2]=function(e){return tt.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("seqSet",e.sequences,function(r){return new Fe.Table("sequenceSetTable",Fe.ushortList("sequence",r))})))};il[3]=function(e){return tt.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("altSet",e.alternateSets,function(r){return new Fe.Table("alternateSetTable",Fe.ushortList("alternate",r))})))};il[4]=function(e){return tt.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("ligSet",e.ligatureSets,function(r){return new Fe.Table("ligatureSetTable",Fe.tableList("ligature",r,function(i){return new Fe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:i.ligGlyph}].concat(Fe.ushortList("component",i.components,i.components.length+1)))}))})))};il[6]=function(e){if(e.substFormat===1){var r=new Fe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("chainRuleSet",e.chainRuleSets,function(c){return new Fe.Table("chainRuleSetTable",Fe.tableList("chainRule",c,function(f){var g=Fe.ushortList("backtrackGlyph",f.backtrack,f.backtrack.length).concat(Fe.ushortList("inputGlyph",f.input,f.input.length+1)).concat(Fe.ushortList("lookaheadGlyph",f.lookahead,f.lookahead.length)).concat(Fe.ushortList("substitution",[],f.lookupRecords.length));return f.lookupRecords.forEach(function(m,v){g=g.concat({name:"sequenceIndex"+v,type:"USHORT",value:m.sequenceIndex}).concat({name:"lookupListIndex"+v,type:"USHORT",value:m.lookupListIndex})}),new Fe.Table("chainRuleTable",g)}))})));return r}else if(e.substFormat===2)tt.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var i=[{name:"substFormat",type:"USHORT",value:e.substFormat}];i.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(c,f){i.push({name:"backtrackCoverage"+f,type:"TABLE",value:new Fe.Coverage(c)})}),i.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(c,f){i.push({name:"inputCoverage"+f,type:"TABLE",value:new Fe.Coverage(c)})}),i.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(c,f){i.push({name:"lookaheadCoverage"+f,type:"TABLE",value:new Fe.Coverage(c)})}),i.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(c,f){i=i.concat({name:"sequenceIndex"+f,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+f,type:"USHORT",value:c.lookupListIndex})});var o=new Fe.Table("chainContextTable",i);return o}tt.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Mx(a){return new Fe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Fe.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Fe.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Fe.LookupList(a.lookups,il)}])}var Ug={parse:Cx,make:Mx};function Nx(a,e){var r=new He.Parser(a,e),i=r.parseULong();tt.argument(i===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),c={},f=0;f<o;f++){var g=r.parseTag(),m=r.parseULong(),v=r.parseULong(),x=sl.UTF8(a,e+m,v);c[g]=x}return c}function kx(a){var e=Object.keys(a).length,r="",i=16+e*12,o=new Fe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:e}]);for(var c in a){var f=r.length;r+=a[c],o.fields.push({name:"tag "+c,type:"TAG",value:c}),o.fields.push({name:"offset "+c,type:"ULONG",value:i+f}),o.fields.push({name:"length "+c,type:"ULONG",value:a[c].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var jg={parse:Nx,make:kx};function cm(a){return Math.log(a)/Math.log(2)|0}function md(a){for(;a.length%4!==0;)a.push(0);for(var e=0,r=0;r<a.length;r+=4)e+=(a[r]<<24)+(a[r+1]<<16)+(a[r+2]<<8)+a[r+3];return e%=Math.pow(2,32),e}function um(a,e,r,i){return new Fe.Record("Table Record",[{name:"tag",type:"TAG",value:a!==void 0?a:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:i!==void 0?i:0}])}function Bg(a){var e=new Fe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=a,e.numTables=a.length;var r=Math.pow(2,cm(e.numTables));e.searchRange=16*r,e.entrySelector=cm(r),e.rangeShift=e.numTables*16-e.searchRange;for(var i=[],o=[],c=e.sizeOf()+um().sizeOf()*e.numTables;c%4!==0;)c+=1,o.push({name:"padding",type:"BYTE",value:0});for(var f=0;f<a.length;f+=1){var g=a[f];tt.argument(g.tableName.length===4,"Table name"+g.tableName+" is invalid.");var m=g.sizeOf(),v=um(g.tableName,md(g.encode()),c,m);for(i.push({name:v.tag+" Table Record",type:"RECORD",value:v}),o.push({name:g.tableName+" table",type:"RECORD",value:g}),c+=m,tt.argument(!isNaN(c),"Something went wrong calculating the offset.");c%4!==0;)c+=1,o.push({name:"padding",type:"BYTE",value:0})}return i.sort(function(x,T){return x.value.tag>T.value.tag?1:-1}),e.fields=e.fields.concat(i),e.fields=e.fields.concat(o),e}function fm(a,e,r){for(var i=0;i<e.length;i+=1){var o=a.charToGlyphIndex(e[i]);if(o>0){var c=a.glyphs.get(o);return c.getMetrics()}}return r}function Rx(a){for(var e=0,r=0;r<a.length;r+=1)e+=a[r];return e/a.length}function Dx(a){for(var e=[],r=[],i=[],o=[],c=[],f=[],g=[],m,v=0,x=0,T=0,S=0,E=0,M=0;M<a.glyphs.length;M+=1){var D=a.glyphs.get(M),j=D.unicode|0;if(isNaN(D.advanceWidth))throw new Error("Glyph "+D.name+" ("+M+"): advanceWidth is not a number.");(m>j||m===void 0)&&j>0&&(m=j),v<j&&(v=j);var P=td.getUnicodeRange(j);if(P<32)x|=1<<P;else if(P<64)T|=1<<P-32;else if(P<96)S|=1<<P-64;else if(P<123)E|=1<<P-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(D.name!==".notdef"){var F=D.getMetrics();e.push(F.xMin),r.push(F.yMin),i.push(F.xMax),o.push(F.yMax),f.push(F.leftSideBearing),g.push(F.rightSideBearing),c.push(D.advanceWidth)}}var _={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,c),advanceWidthAvg:Rx(c),minLeftSideBearing:Math.min.apply(null,f),maxLeftSideBearing:Math.max.apply(null,f),minRightSideBearing:Math.min.apply(null,g)};_.ascender=a.ascender,_.descender=a.descender;var L=Tg.make({flags:3,unitsPerEm:a.unitsPerEm,xMin:_.xMin,yMin:_.yMin,xMax:_.xMax,yMax:_.yMax,lowestRecPPEM:3,createdTimestamp:a.createdTimestamp}),I=Cg.make({ascender:_.ascender,descender:_.descender,advanceWidthMax:_.advanceWidthMax,minLeftSideBearing:_.minLeftSideBearing,minRightSideBearing:_.minRightSideBearing,xMaxExtent:_.maxLeftSideBearing+(_.xMax-_.xMin),numberOfHMetrics:a.glyphs.length}),V=kg.make(a.glyphs.length),$=td.make(Object.assign({xAvgCharWidth:Math.round(_.advanceWidthAvg),usFirstCharIndex:m,usLastCharIndex:v,ulUnicodeRange1:x,ulUnicodeRange2:T,ulUnicodeRange3:S,ulUnicodeRange4:E,sTypoAscender:_.ascender,sTypoDescender:_.descender,sTypoLineGap:0,usWinAscent:_.yMax,usWinDescent:Math.abs(_.yMin),ulCodePageRange1:1,sxHeight:fm(a,"xyvw",{yMax:Math.round(_.ascender/2)}).yMax,sCapHeight:fm(a,"HIKLEFJMNTZBDPRAGOQSUVWXY",_).yMax,usDefaultChar:a.hasChar(" ")?32:0,usBreakChar:a.hasChar(" ")?32:0},a.tables.os2)),J=Mg.make(a.glyphs),ie=pg.make(a.glyphs),oe=a.getEnglishName("fontFamily"),U=a.getEnglishName("fontSubfamily"),K=oe+" "+U,Z=a.getEnglishName("postScriptName");Z||(Z=oe.replace(/\s/g,"")+"-"+U);var W={};for(var re in a.names)W[re]=a.names[re];W.uniqueID||(W.uniqueID={en:a.getEnglishName("manufacturer")+":"+K}),W.postScriptName||(W.postScriptName={en:Z}),W.preferredFamily||(W.preferredFamily=a.names.fontFamily),W.preferredSubfamily||(W.preferredSubfamily=a.names.fontSubfamily);var Y=[],ee=Ig.make(W,Y),ue=Y.length>0?Ng.make(Y):void 0,Ee=Lg.make(),q=Ag.make(a.glyphs,{version:a.getEnglishName("version"),fullName:K,familyName:oe,weightName:U,postScriptName:Z,unitsPerEm:a.unitsPerEm,fontBBox:[0,_.yMin,_.ascender,_.advanceWidthMax]}),Q=a.metas&&Object.keys(a.metas).length>0?jg.make(a.metas):void 0,be=[L,I,V,$,ee,ie,Ee,q,J];ue&&be.push(ue),a.tables.gsub&&be.push(Ug.make(a.tables.gsub)),Q&&be.push(Q);for(var ke=Bg(be),ve=ke.encode(),_e=md(ve),Oe=ke.fields,We=!1,Ye=0;Ye<Oe.length;Ye+=1)if(Oe[Ye].name==="head table"){Oe[Ye].value.checkSumAdjustment=2981146554-_e,We=!0;break}if(!We)throw new Error("Could not find head table with checkSum to adjust.");return ke}var _x={make:Bg,fontToTable:Dx,computeCheckSum:md};function Uf(a,e){for(var r=0,i=a.length-1;r<=i;){var o=r+i>>>1,c=a[o].tag;if(c===e)return o;c<e?r=o+1:i=o-1}return-r-1}function dm(a,e){for(var r=0,i=a.length-1;r<=i;){var o=r+i>>>1,c=a[o];if(c===e)return o;c<e?r=o+1:i=o-1}return-r-1}function pm(a,e){for(var r,i=0,o=a.length-1;i<=o;){var c=i+o>>>1;r=a[c];var f=r.start;if(f===e)return r;f<e?i=c+1:o=c-1}if(i>0)return r=a[i-1],e>r.end?0:r}function fo(a,e){this.font=a,this.tableName=e}fo.prototype={searchTag:Uf,binSearch:dm,getTable:function(a){var e=this.font.tables[this.tableName];return!e&&a&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var a=this.getTable();return a?a.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var a=this.getTable();if(a){for(var e=!1,r=0;r<a.scripts.length;r++){var i=a.scripts[r].tag;if(i==="DFLT")return i;i==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(a,e){var r=this.getTable(e);if(r){a=a||"DFLT";var i=r.scripts,o=Uf(r.scripts,a);if(o>=0)return i[o].script;if(e){var c={tag:a,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-o,0,c),c.script}}},getLangSysTable:function(a,e,r){var i=this.getScriptTable(a,r);if(i){if(!e||e==="dflt"||e==="DFLT")return i.defaultLangSys;var o=Uf(i.langSysRecords,e);if(o>=0)return i.langSysRecords[o].langSys;if(r){var c={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-o,0,c),c.langSys}}},getFeatureTable:function(a,e,r,i){var o=this.getLangSysTable(a,e,i);if(o){for(var c,f=o.featureIndexes,g=this.font.tables[this.tableName].features,m=0;m<f.length;m++)if(c=g[f[m]],c.tag===r)return c.feature;if(i){var v=g.length;return tt.assert(v===0||r>=g[v-1].tag,"Features must be added in alphabetical order."),c={tag:r,feature:{params:0,lookupListIndexes:[]}},g.push(c),f.push(v),c.feature}}},getLookupTables:function(a,e,r,i,o){var c=this.getFeatureTable(a,e,r,o),f=[];if(c){for(var g,m=c.lookupListIndexes,v=this.font.tables[this.tableName].lookups,x=0;x<m.length;x++)g=v[m[x]],g.lookupType===i&&f.push(g);if(f.length===0&&o){g={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var T=v.length;return v.push(g),m.push(T),[g]}}return f},getGlyphClass:function(a,e){switch(a.format){case 1:return a.startGlyph<=e&&e<a.startGlyph+a.classes.length?a.classes[e-a.startGlyph]:0;case 2:var r=pm(a.ranges,e);return r?r.classId:0}},getCoverageIndex:function(a,e){switch(a.format){case 1:var r=dm(a.glyphs,e);return r>=0?r:-1;case 2:var i=pm(a.ranges,e);return i?i.index+e-i.start:-1}},expandCoverage:function(a){if(a.format===1)return a.glyphs;for(var e=[],r=a.ranges,i=0;i<r.length;i++)for(var o=r[i],c=o.start,f=o.end,g=c;g<=f;g++)e.push(g);return e}};function po(a){fo.call(this,a,"gpos")}po.prototype=fo.prototype;po.prototype.init=function(){var a=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(a)};po.prototype.getKerningValue=function(a,e,r){for(var i=0;i<a.length;i++)for(var o=a[i].subtables,c=0;c<o.length;c++){var f=o[c],g=this.getCoverageIndex(f.coverage,e);if(!(g<0))switch(f.posFormat){case 1:for(var m=f.pairSets[g],v=0;v<m.length;v++){var x=m[v];if(x.secondGlyph===r)return x.value1&&x.value1.xAdvance||0}break;case 2:var T=this.getGlyphClass(f.classDef1,e),S=this.getGlyphClass(f.classDef2,r),E=f.classRecords[T][S];return E.value1&&E.value1.xAdvance||0}}return 0};po.prototype.getKerningTables=function(a,e){if(this.font.tables.gpos)return this.getLookupTables(a,e,"kern",2)};function Ba(a){fo.call(this,a,"gsub")}function Ox(a,e){var r=a.length;if(r!==e.length)return!1;for(var i=0;i<r;i++)if(a[i]!==e[i])return!1;return!0}function gd(a,e,r){for(var i=a.subtables,o=0;o<i.length;o++){var c=i[o];if(c.substFormat===e)return c}if(r)return i.push(r),r}Ba.prototype=fo.prototype;Ba.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};Ba.prototype.getSingle=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,1),c=0;c<o.length;c++)for(var f=o[c].subtables,g=0;g<f.length;g++){var m=f[g],v=this.expandCoverage(m.coverage),x=void 0;if(m.substFormat===1){var T=m.deltaGlyphId;for(x=0;x<v.length;x++){var S=v[x];i.push({sub:S,by:S+T})}}else{var E=m.substitute;for(x=0;x<v.length;x++)i.push({sub:v[x],by:E[x]})}}return i};Ba.prototype.getMultiple=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,2),c=0;c<o.length;c++)for(var f=o[c].subtables,g=0;g<f.length;g++){var m=f[g],v=this.expandCoverage(m.coverage),x=void 0;for(x=0;x<v.length;x++){var T=v[x],S=m.sequences[x];i.push({sub:T,by:S})}}return i};Ba.prototype.getAlternates=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,3),c=0;c<o.length;c++)for(var f=o[c].subtables,g=0;g<f.length;g++)for(var m=f[g],v=this.expandCoverage(m.coverage),x=m.alternateSets,T=0;T<v.length;T++)i.push({sub:v[T],by:x[T]});return i};Ba.prototype.getLigatures=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,4),c=0;c<o.length;c++)for(var f=o[c].subtables,g=0;g<f.length;g++)for(var m=f[g],v=this.expandCoverage(m.coverage),x=m.ligatureSets,T=0;T<v.length;T++)for(var S=v[T],E=x[T],M=0;M<E.length;M++){var D=E[M];i.push({sub:[S].concat(D.components),by:D.ligGlyph})}return i};Ba.prototype.addSingle=function(a,e,r,i){var o=this.getLookupTables(r,i,a,1,!0)[0],c=gd(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});tt.assert(c.coverage.format===1,"Single: unable to modify coverage table format "+c.coverage.format);var f=e.sub,g=this.binSearch(c.coverage.glyphs,f);g<0&&(g=-1-g,c.coverage.glyphs.splice(g,0,f),c.substitute.splice(g,0,0)),c.substitute[g]=e.by};Ba.prototype.addMultiple=function(a,e,r,i){tt.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,i,a,2,!0)[0],c=gd(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});tt.assert(c.coverage.format===1,"Multiple: unable to modify coverage table format "+c.coverage.format);var f=e.sub,g=this.binSearch(c.coverage.glyphs,f);g<0&&(g=-1-g,c.coverage.glyphs.splice(g,0,f),c.sequences.splice(g,0,0)),c.sequences[g]=e.by};Ba.prototype.addAlternate=function(a,e,r,i){var o=this.getLookupTables(r,i,a,3,!0)[0],c=gd(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});tt.assert(c.coverage.format===1,"Alternate: unable to modify coverage table format "+c.coverage.format);var f=e.sub,g=this.binSearch(c.coverage.glyphs,f);g<0&&(g=-1-g,c.coverage.glyphs.splice(g,0,f),c.alternateSets.splice(g,0,0)),c.alternateSets[g]=e.by};Ba.prototype.addLigature=function(a,e,r,i){var o=this.getLookupTables(r,i,a,4,!0)[0],c=o.subtables[0];c||(c={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=c),tt.assert(c.coverage.format===1,"Ligature: unable to modify coverage table format "+c.coverage.format);var f=e.sub[0],g=e.sub.slice(1),m={ligGlyph:e.by,components:g},v=this.binSearch(c.coverage.glyphs,f);if(v>=0){for(var x=c.ligatureSets[v],T=0;T<x.length;T++)if(Ox(x[T].components,g))return;x.push(m)}else v=-1-v,c.coverage.glyphs.splice(v,0,f),c.ligatureSets.splice(v,0,[m])};Ba.prototype.getFeature=function(a,e,r){if(/ss\d\d/.test(a))return this.getSingle(a,e,r);switch(a){case"aalt":case"salt":return this.getSingle(a,e,r).concat(this.getAlternates(a,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(a,e,r);case"ccmp":return this.getMultiple(a,e,r).concat(this.getLigatures(a,e,r));case"stch":return this.getMultiple(a,e,r)}};Ba.prototype.add=function(a,e,r,i){if(/ss\d\d/.test(a))return this.addSingle(a,e,r,i);switch(a){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(a,e,r,i):this.addAlternate(a,e,r,i);case"dlig":case"liga":case"rlig":return this.addLigature(a,e,r,i);case"ccmp":return e.by instanceof Array?this.addMultiple(a,e,r,i):this.addLigature(a,e,r,i)}};function Ix(){return typeof window<"u"}function Fg(a){for(var e=new ArrayBuffer(a.length),r=new Uint8Array(e),i=0;i<a.length;++i)r[i]=a[i];return e}function Lx(a){for(var e=new Buffer(a.byteLength),r=new Uint8Array(a),i=0;i<e.length;++i)e[i]=r[i];return e}function eo(a,e){if(!a)throw e}function hm(a,e,r,i,o){var c;return(e&i)>0?(c=a.parseByte(),(e&o)===0&&(c=-c),c=r+c):(e&o)>0?c=r:c=r+a.parseShort(),c}function Pg(a,e,r){var i=new He.Parser(e,r);a.numberOfContours=i.parseShort(),a._xMin=i.parseShort(),a._yMin=i.parseShort(),a._xMax=i.parseShort(),a._yMax=i.parseShort();var o,c;if(a.numberOfContours>0){for(var f=a.endPointIndices=[],g=0;g<a.numberOfContours;g+=1)f.push(i.parseUShort());a.instructionLength=i.parseUShort(),a.instructions=[];for(var m=0;m<a.instructionLength;m+=1)a.instructions.push(i.parseByte());var v=f[f.length-1]+1;o=[];for(var x=0;x<v;x+=1)if(c=i.parseByte(),o.push(c),(c&8)>0)for(var T=i.parseByte(),S=0;S<T;S+=1)o.push(c),x+=1;if(tt.argument(o.length===v,"Bad flags."),f.length>0){var E=[],M;if(v>0){for(var D=0;D<v;D+=1)c=o[D],M={},M.onCurve=!!(c&1),M.lastPointOfContour=f.indexOf(D)>=0,E.push(M);for(var j=0,P=0;P<v;P+=1)c=o[P],M=E[P],M.x=hm(i,c,j,2,16),j=M.x;for(var F=0,_=0;_<v;_+=1)c=o[_],M=E[_],M.y=hm(i,c,F,4,32),F=M.y}a.points=E}else a.points=[]}else if(a.numberOfContours===0)a.points=[];else{a.isComposite=!0,a.points=[],a.components=[];for(var L=!0;L;){o=i.parseUShort();var I={glyphIndex:i.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(I.dx=i.parseShort(),I.dy=i.parseShort()):I.matchedPoints=[i.parseUShort(),i.parseUShort()]:(o&2)>0?(I.dx=i.parseChar(),I.dy=i.parseChar()):I.matchedPoints=[i.parseByte(),i.parseByte()],(o&8)>0?I.xScale=I.yScale=i.parseF2Dot14():(o&64)>0?(I.xScale=i.parseF2Dot14(),I.yScale=i.parseF2Dot14()):(o&128)>0&&(I.xScale=i.parseF2Dot14(),I.scale01=i.parseF2Dot14(),I.scale10=i.parseF2Dot14(),I.yScale=i.parseF2Dot14()),a.components.push(I),L=!!(o&32)}if(o&256){a.instructionLength=i.parseUShort(),a.instructions=[];for(var V=0;V<a.instructionLength;V+=1)a.instructions.push(i.parseByte())}}}function jf(a,e){for(var r=[],i=0;i<a.length;i+=1){var o=a[i],c={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(c)}return r}function Ux(a){for(var e=[],r=[],i=0;i<a.length;i+=1){var o=a[i];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return tt.argument(r.length===0,"There are still points left in the current contour."),e}function zg(a){var e=new An;if(!a)return e;for(var r=Ux(a),i=0;i<r.length;++i){var o=r[i],c=null,f=o[o.length-1],g=o[0];if(f.onCurve)e.moveTo(f.x,f.y);else if(g.onCurve)e.moveTo(g.x,g.y);else{var m={x:(f.x+g.x)*.5,y:(f.y+g.y)*.5};e.moveTo(m.x,m.y)}for(var v=0;v<o.length;++v)if(c=f,f=g,g=o[(v+1)%o.length],f.onCurve)e.lineTo(f.x,f.y);else{var x=g;c.onCurve||((f.x+c.x)*.5,(f.y+c.y)*.5),g.onCurve||(x={x:(f.x+g.x)*.5,y:(f.y+g.y)*.5}),e.quadraticCurveTo(f.x,f.y,x.x,x.y)}e.closePath()}return e}function Gg(a,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var i=e.components[r],o=a.get(i.glyphIndex);if(o.getPath(),o.points){var c=void 0;if(i.matchedPoints===void 0)c=jf(o.points,i);else{if(i.matchedPoints[0]>e.points.length-1||i.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var f=e.points[i.matchedPoints[0]],g=o.points[i.matchedPoints[1]],m={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};g=jf([g],m)[0],m.dx=f.x-g.x,m.dy=f.y-g.y,c=jf(o.points,m)}e.points=e.points.concat(c)}}return zg(e.points)}function jx(a,e,r,i){for(var o=new jr.GlyphSet(i),c=0;c<r.length-1;c+=1){var f=r[c],g=r[c+1];f!==g?o.push(c,jr.ttfGlyphLoader(i,c,Pg,a,e+f,Gg)):o.push(c,jr.glyphLoader(i,c))}return o}function Bx(a,e,r,i){var o=new jr.GlyphSet(i);return i._push=function(c){var f=r[c],g=r[c+1];f!==g?o.push(c,jr.ttfGlyphLoader(i,c,Pg,a,e+f,Gg)):o.push(c,jr.glyphLoader(i,c))},o}function Fx(a,e,r,i,o){return o.lowMemory?Bx(a,e,r,i):jx(a,e,r,i)}var Hg={getPath:zg,parse:Fx},Yg,xi,qg,nd;function Vg(a){this.font=a,this.getCommands=function(e){return Hg.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Px(a){return a}function Xg(a){return Math.sign(a)*Math.round(Math.abs(a))}function zx(a){return Math.sign(a)*Math.round(Math.abs(a*2))/2}function Gx(a){return Math.sign(a)*(Math.round(Math.abs(a)+.5)-.5)}function Hx(a){return Math.sign(a)*Math.ceil(Math.abs(a))}function Yx(a){return Math.sign(a)*Math.floor(Math.abs(a))}var $g=function(a){var e=this.srPeriod,r=this.srPhase,i=this.srThreshold,o=1;return a<0&&(a=-a,o=-1),a+=i-r,a=Math.trunc(a/e)*e,a+=r,a<0?r*o:a*o},Ur={x:1,y:0,axis:"x",distance:function(a,e,r,i){return(r?a.xo:a.x)-(i?e.xo:e.x)},interpolate:function(a,e,r,i){var o,c,f,g,m,v,x;if(!i||i===this){if(o=a.xo-e.xo,c=a.xo-r.xo,m=e.x-e.xo,v=r.x-r.xo,f=Math.abs(o),g=Math.abs(c),x=f+g,x===0){a.x=a.xo+(m+v)/2;return}a.x=a.xo+(m*g+v*f)/x;return}if(o=i.distance(a,e,!0,!0),c=i.distance(a,r,!0,!0),m=i.distance(e,e,!1,!0),v=i.distance(r,r,!1,!0),f=Math.abs(o),g=Math.abs(c),x=f+g,x===0){Ur.setRelative(a,a,(m+v)/2,i,!0);return}Ur.setRelative(a,a,(m*g+v*f)/x,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(a,e,r,i,o){if(!i||i===this){a.x=(o?e.xo:e.x)+r;return}var c=o?e.xo:e.x,f=o?e.yo:e.y,g=c+r*i.x,m=f+r*i.y;a.x=g+(a.y-m)/i.normalSlope},slope:0,touch:function(a){a.xTouched=!0},touched:function(a){return a.xTouched},untouch:function(a){a.xTouched=!1}},ls={x:0,y:1,axis:"y",distance:function(a,e,r,i){return(r?a.yo:a.y)-(i?e.yo:e.y)},interpolate:function(a,e,r,i){var o,c,f,g,m,v,x;if(!i||i===this){if(o=a.yo-e.yo,c=a.yo-r.yo,m=e.y-e.yo,v=r.y-r.yo,f=Math.abs(o),g=Math.abs(c),x=f+g,x===0){a.y=a.yo+(m+v)/2;return}a.y=a.yo+(m*g+v*f)/x;return}if(o=i.distance(a,e,!0,!0),c=i.distance(a,r,!0,!0),m=i.distance(e,e,!1,!0),v=i.distance(r,r,!1,!0),f=Math.abs(o),g=Math.abs(c),x=f+g,x===0){ls.setRelative(a,a,(m+v)/2,i,!0);return}ls.setRelative(a,a,(m*g+v*f)/x,i,!0)},normalSlope:0,setRelative:function(a,e,r,i,o){if(!i||i===this){a.y=(o?e.yo:e.y)+r;return}var c=o?e.xo:e.x,f=o?e.yo:e.y,g=c+r*i.x,m=f+r*i.y;a.y=m+i.normalSlope*(a.x-g)},slope:Number.POSITIVE_INFINITY,touch:function(a){a.yTouched=!0},touched:function(a){return a.yTouched},untouch:function(a){a.yTouched=!1}};Object.freeze(Ur);Object.freeze(ls);function ho(a,e){this.x=a,this.y=e,this.axis=void 0,this.slope=e/a,this.normalSlope=-a/e,Object.freeze(this)}ho.prototype.distance=function(a,e,r,i){return this.x*Ur.distance(a,e,r,i)+this.y*ls.distance(a,e,r,i)};ho.prototype.interpolate=function(a,e,r,i){var o,c,f,g,m,v,x;if(f=i.distance(a,e,!0,!0),g=i.distance(a,r,!0,!0),o=i.distance(e,e,!1,!0),c=i.distance(r,r,!1,!0),m=Math.abs(f),v=Math.abs(g),x=m+v,x===0){this.setRelative(a,a,(o+c)/2,i,!0);return}this.setRelative(a,a,(o*v+c*m)/x,i,!0)};ho.prototype.setRelative=function(a,e,r,i,o){i=i||this;var c=o?e.xo:e.x,f=o?e.yo:e.y,g=c+r*i.x,m=f+r*i.y,v=i.normalSlope,x=this.slope,T=a.x,S=a.y;a.x=(x*T-v*g+m-S)/(x-v),a.y=x*(a.x-T)+S};ho.prototype.touch=function(a){a.xTouched=!0,a.yTouched=!0};function mo(a,e){var r=Math.sqrt(a*a+e*e);return a/=r,e/=r,a===1&&e===0?Ur:a===0&&e===1?ls:new ho(a,e)}function os(a,e,r,i){this.x=this.xo=Math.round(a*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}os.prototype.nextTouched=function(a){for(var e=this.nextPointOnContour;!a.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};os.prototype.prevTouched=function(a){for(var e=this.prevPointOnContour;!a.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var co=Object.freeze(new os(0,0)),qx={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Hs(a,e){switch(this.env=a,this.stack=[],this.prog=e,a){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Ur,this.round=Xg}}Vg.prototype.exec=function(a,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,i=this._prepState;if(!i||i.ppem!==e){var o=this._fpgmState;if(!o){Hs.prototype=qx,o=this._fpgmState=new Hs("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{xi(o)}catch(v){console.log("Hinting error in FPGM:"+v),this._errorState=3;return}}Hs.prototype=o,i=this._prepState=new Hs("prep",r.tables.prep),i.ppem=e;var c=r.tables.cvt;if(c)for(var f=i.cvt=new Array(c.length),g=e/r.unitsPerEm,m=0;m<c.length;m++)f[m]=c[m]*g;else i.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{xi(i)}catch(v){this._errorState<2&&console.log("Hinting error in PREP:"+v),this._errorState=2}}if(!(this._errorState>1))try{return qg(a,i)}catch(v){this._errorState<1&&(console.log("Hinting error:"+v),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};qg=function(a,e){var r=e.ppem/e.font.unitsPerEm,i=r,o=a.components,c,f,g;if(Hs.prototype=e,!o)g=new Hs("glyf",a.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),g.step=-1),nd(a,g,r,i),f=g.gZone;else{var m=e.font;f=[],c=[];for(var v=0;v<o.length;v++){var x=o[v],T=m.glyphs.get(x.glyphIndex);g=new Hs("glyf",T.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+v+"---"),g.step=-1),nd(T,g,r,i);for(var S=Math.round(x.dx*r),E=Math.round(x.dy*i),M=g.gZone,D=g.contours,j=0;j<M.length;j++){var P=M[j];P.xTouched=P.yTouched=!1,P.xo=P.x=P.x+S,P.yo=P.y=P.y+E}var F=f.length;f.push.apply(f,M);for(var _=0;_<D.length;_++)c.push(D[_]+F)}a.instructions&&!g.inhibitGridFit&&(g=new Hs("glyf",a.instructions),g.gZone=g.z0=g.z1=g.z2=f,g.contours=c,f.push(new os(0,0),new os(Math.round(a.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),g.step=-1),xi(g),f.length-=2)}return f};nd=function(a,e,r,i){for(var o=a.points||[],c=o.length,f=e.gZone=e.z0=e.z1=e.z2=[],g=e.contours=[],m,v=0;v<c;v++)m=o[v],f[v]=new os(m.x*r,m.y*i,m.lastPointOfContour,m.onCurve);for(var x,T,S=0;S<c;S++)m=f[S],x||(x=m,g.push(S)),m.lastPointOfContour?(m.nextPointOnContour=x,x.prevPointOnContour=m,x=void 0):(T=f[S+1],m.nextPointOnContour=T,T.prevPointOnContour=m);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var E=0;E<c;E++)console.log(E,f[E].x,f[E].y)}if(f.push(new os(0,0),new os(Math.round(a.advanceWidth*r),0)),xi(e),f.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var M=0;M<c;M++)console.log(M,f[M].x,f[M].y)}}};xi=function(a){var e=a.prog;if(e){var r=e.length,i;for(a.ip=0;a.ip<r;a.ip++){if(exports.DEBUG&&a.step++,i=Yg[e[a.ip]],!i)throw new Error("unknown instruction: 0x"+Number(e[a.ip]).toString(16));i(a)}}};function Ic(a){for(var e=a.tZone=new Array(a.gZone.length),r=0;r<e.length;r++)e[r]=new os(0,0)}function Wg(a,e){var r=a.prog,i=a.ip,o=1,c;do if(c=r[++i],c===88)o++;else if(c===89)o--;else if(c===64)i+=r[i+1]+1;else if(c===65)i+=2*r[i+1]+1;else if(c>=176&&c<=183)i+=c-176+1;else if(c>=184&&c<=191)i+=(c-184+1)*2;else if(e&&o===1&&c===27)break;while(o>0);a.ip=i}function mm(a,e){exports.DEBUG&&console.log(e.step,"SVTCA["+a.axis+"]"),e.fv=e.pv=e.dpv=a}function gm(a,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+a.axis+"]"),e.pv=e.dpv=a}function ym(a,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+a.axis+"]"),e.fv=a}function vm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log("SPVTL["+a+"]",i,o);var g,m;a?(g=c.y-f.y,m=f.x-c.x):(g=f.x-c.x,m=f.y-c.y),e.pv=e.dpv=mo(g,m)}function bm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log("SFVTL["+a+"]",i,o);var g,m;a?(g=c.y-f.y,m=f.x-c.x):(g=f.x-c.x,m=f.y-c.y),e.fv=mo(g,m)}function Vx(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SPVFS[]",r,i),a.pv=a.dpv=mo(i,r)}function Xx(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SPVFS[]",r,i),a.fv=mo(i,r)}function $x(a){var e=a.stack,r=a.pv;exports.DEBUG&&console.log(a.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Wx(a){var e=a.stack,r=a.fv;exports.DEBUG&&console.log(a.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Zx(a){a.fv=a.pv,exports.DEBUG&&console.log(a.step,"SFVTPV[]")}function Qx(a){var e=a.stack,r=e.pop(),i=e.pop(),o=e.pop(),c=e.pop(),f=e.pop(),g=a.z0,m=a.z1,v=g[r],x=g[i],T=m[o],S=m[c],E=a.z2[f];exports.DEBUG&&console.log("ISECT[], ",r,i,o,c,f);var M=v.x,D=v.y,j=x.x,P=x.y,F=T.x,_=T.y,L=S.x,I=S.y,V=(M-j)*(_-I)-(D-P)*(F-L),$=M*P-D*j,J=F*I-_*L;E.x=($*(F-L)-J*(M-j))/V,E.y=($*(_-I)-J*(D-P))/V}function Kx(a){a.rp0=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP0[]",a.rp0)}function Jx(a){a.rp1=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP1[]",a.rp1)}function eS(a){a.rp2=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP2[]",a.rp2)}function tS(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP0[]",e),a.zp0=e,e){case 0:a.tZone||Ic(a),a.z0=a.tZone;break;case 1:a.z0=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function nS(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP1[]",e),a.zp1=e,e){case 0:a.tZone||Ic(a),a.z1=a.tZone;break;case 1:a.z1=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function aS(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP2[]",e),a.zp2=e,e){case 0:a.tZone||Ic(a),a.z2=a.tZone;break;case 1:a.z2=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function rS(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZPS[]",e),a.zp0=a.zp1=a.zp2=e,e){case 0:a.tZone||Ic(a),a.z0=a.z1=a.z2=a.tZone;break;case 1:a.z0=a.z1=a.z2=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function sS(a){a.loop=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SLOOP[]",a.loop)}function iS(a){exports.DEBUG&&console.log(a.step,"RTG[]"),a.round=Xg}function lS(a){exports.DEBUG&&console.log(a.step,"RTHG[]"),a.round=Gx}function oS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SMD[]",e),a.minDis=e/64}function cS(a){exports.DEBUG&&console.log(a.step,"ELSE[]"),Wg(a,!1)}function uS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"JMPR[]",e),a.ip+=e-1}function fS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCVTCI[]",e),a.cvCutIn=e/64}function dS(a){var e=a.stack;exports.DEBUG&&console.log(a.step,"DUP[]"),e.push(e[e.length-1])}function Bf(a){exports.DEBUG&&console.log(a.step,"POP[]"),a.stack.pop()}function pS(a){exports.DEBUG&&console.log(a.step,"CLEAR[]"),a.stack.length=0}function hS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SWAP[]"),e.push(r),e.push(i)}function mS(a){var e=a.stack;exports.DEBUG&&console.log(a.step,"DEPTH[]"),e.push(e.length)}function gS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LOOPCALL[]",r,i);var o=a.ip,c=a.prog;a.prog=a.funcs[r];for(var f=0;f<i;f++)xi(a),exports.DEBUG&&console.log(++a.step,f+1<i?"next loopcall":"done loopcall",f);a.ip=o,a.prog=c}function yS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"CALL[]",e);var r=a.ip,i=a.prog;a.prog=a.funcs[e],xi(a),a.ip=r,a.prog=i,exports.DEBUG&&console.log(++a.step,"returning from",e)}function vS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"CINDEX[]",r),e.push(e[e.length-r])}function bS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function xS(a){if(a.env!=="fpgm")throw new Error("FDEF not allowed here");var e=a.stack,r=a.prog,i=a.ip,o=e.pop(),c=i;for(exports.DEBUG&&console.log(a.step,"FDEF[]",o);r[++i]!==45;);a.ip=i,a.funcs[o]=r.slice(c+1,i)}function xm(a,e){var r=e.stack.pop(),i=e.z0[r],o=e.fv,c=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+a+"]",r);var f=c.distance(i,co);a&&(f=e.round(f)),o.setRelative(i,co,f,c),o.touch(i),e.rp0=e.rp1=r}function Sm(a,e){var r=e.z2,i=r.length-2,o,c,f;exports.DEBUG&&console.log(e.step,"IUP["+a.axis+"]");for(var g=0;g<i;g++)o=r[g],!a.touched(o)&&(c=o.prevTouched(a),c!==o&&(f=o.nextTouched(a),c===f&&a.setRelative(o,o,a.distance(c,c,!1,!0),a,!0),a.interpolate(o,c,f,a)))}function Em(a,e){for(var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,g=e.loop,m=e.z2;g--;){var v=r.pop(),x=m[v],T=f.distance(o,o,!1,!0);c.setRelative(x,x,T,f),c.touch(x),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-g)+": ":"")+"SHP["+(a?"rp1":"rp2")+"]",v)}e.loop=1}function wm(a,e){var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,g=r.pop(),m=e.z2[e.contours[g]],v=m;exports.DEBUG&&console.log(e.step,"SHC["+a+"]",g);var x=f.distance(o,o,!1,!0);do v!==o&&c.setRelative(v,v,x,f),v=v.nextPointOnContour;while(v!==m)}function Am(a,e){var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,g=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+a+"]",g);var m;switch(g){case 0:m=e.tZone;break;case 1:m=e.gZone;break;default:throw new Error("Invalid zone")}for(var v,x=f.distance(o,o,!1,!0),T=m.length-2,S=0;S<T;S++)v=m[S],c.setRelative(v,v,x,f)}function SS(a){for(var e=a.stack,r=a.loop,i=a.fv,o=e.pop()/64,c=a.z2;r--;){var f=e.pop(),g=c[f];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-r)+": ":"")+"SHPIX[]",f,o),i.setRelative(g,g,o),i.touch(g)}a.loop=1}function ES(a){for(var e=a.stack,r=a.rp1,i=a.rp2,o=a.loop,c=a.z0[r],f=a.z1[i],g=a.fv,m=a.dpv,v=a.z2;o--;){var x=e.pop(),T=v[x];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-o)+": ":"")+"IP[]",x,r,"<->",i),g.interpolate(T,c,f,m),g.touch(T)}a.loop=1}function Tm(a,e){var r=e.stack,i=r.pop()/64,o=r.pop(),c=e.z1[o],f=e.z0[e.rp0],g=e.fv,m=e.pv;g.setRelative(c,f,i,m),g.touch(c),exports.DEBUG&&console.log(e.step,"MSIRP["+a+"]",i,o),e.rp1=e.rp0,e.rp2=o,a&&(e.rp0=o)}function wS(a){for(var e=a.stack,r=a.rp0,i=a.z0[r],o=a.loop,c=a.fv,f=a.pv,g=a.z1;o--;){var m=e.pop(),v=g[m];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-o)+": ":"")+"ALIGNRP[]",m),c.setRelative(v,i,0,f),c.touch(v)}a.loop=1}function AS(a){exports.DEBUG&&console.log(a.step,"RTDG[]"),a.round=zx}function Cm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z0[o],f=e.fv,g=e.pv,m=e.cvt[i];exports.DEBUG&&console.log(e.step,"MIAP["+a+"]",i,"(",m,")",o);var v=g.distance(c,co);a&&(Math.abs(v-m)<e.cvCutIn&&(v=m),v=e.round(v)),f.setRelative(c,co,v,g),e.zp0===0&&(c.xo=c.x,c.yo=c.y),f.touch(c),e.rp0=e.rp1=o}function TS(a){var e=a.prog,r=a.ip,i=a.stack,o=e[++r];exports.DEBUG&&console.log(a.step,"NPUSHB[]",o);for(var c=0;c<o;c++)i.push(e[++r]);a.ip=r}function CS(a){var e=a.ip,r=a.prog,i=a.stack,o=r[++e];exports.DEBUG&&console.log(a.step,"NPUSHW[]",o);for(var c=0;c<o;c++){var f=r[++e]<<8|r[++e];f&32768&&(f=-((f^65535)+1)),i.push(f)}a.ip=e}function MS(a){var e=a.stack,r=a.store;r||(r=a.store=[]);var i=e.pop(),o=e.pop();exports.DEBUG&&console.log(a.step,"WS",i,o),r[o]=i}function NS(a){var e=a.stack,r=a.store,i=e.pop();exports.DEBUG&&console.log(a.step,"RS",i);var o=r&&r[i]||0;e.push(o)}function kS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"WCVTP",r,i),a.cvt[i]=r/64}function RS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"RCVT",r),e.push(a.cvt[r]*64)}function Mm(a,e){var r=e.stack,i=r.pop(),o=e.z2[i];exports.DEBUG&&console.log(e.step,"GC["+a+"]",i),r.push(e.dpv.distance(o,co,a,!1)*64)}function Nm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z1[i],f=e.z0[o],g=e.dpv.distance(f,c,a,a);exports.DEBUG&&console.log(e.step,"MD["+a+"]",i,o,"->",g),e.stack.push(Math.round(g*64))}function DS(a){exports.DEBUG&&console.log(a.step,"MPPEM[]"),a.stack.push(a.ppem)}function _S(a){exports.DEBUG&&console.log(a.step,"FLIPON[]"),a.autoFlip=!0}function OS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LT[]",r,i),e.push(i<r?1:0)}function IS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LTEQ[]",r,i),e.push(i<=r?1:0)}function LS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"GT[]",r,i),e.push(i>r?1:0)}function US(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"GTEQ[]",r,i),e.push(i>=r?1:0)}function jS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"EQ[]",r,i),e.push(r===i?1:0)}function BS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"NEQ[]",r,i),e.push(r!==i?1:0)}function FS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function PS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function zS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"IF[]",e),e||(Wg(a,!0),exports.DEBUG&&console.log(a.step,"EIF[]"))}function GS(a){exports.DEBUG&&console.log(a.step,"EIF[]")}function HS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"AND[]",r,i),e.push(r&&i?1:0)}function YS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"OR[]",r,i),e.push(r||i?1:0)}function qS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"NOT[]",r),e.push(r?0:1)}function Ff(a,e){var r=e.stack,i=r.pop(),o=e.fv,c=e.pv,f=e.ppem,g=e.deltaBase+(a-1)*16,m=e.deltaShift,v=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+a+"]",i,r);for(var x=0;x<i;x++){var T=r.pop(),S=r.pop(),E=g+((S&240)>>4);if(E===f){var M=(S&15)-8;M>=0&&M++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",T,"by",M*m);var D=v[T];o.setRelative(D,D,M*m,c)}}}function VS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"SDB[]",r),a.deltaBase=r}function XS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"SDS[]",r),a.deltaShift=Math.pow(.5,r)}function $S(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"ADD[]",r,i),e.push(i+r)}function WS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SUB[]",r,i),e.push(i-r)}function ZS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"DIV[]",r,i),e.push(i*64/r)}function QS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MUL[]",r,i),e.push(i*r/64)}function KS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"ABS[]",r),e.push(Math.abs(r))}function JS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"NEG[]",r),e.push(-r)}function e2(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function t2(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Sc(a,e){var r=e.stack,i=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(i/64)*64)}function n2(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"WCVTF[]",r,i),a.cvt[i]=r*a.ppem/a.font.unitsPerEm}function Pf(a,e){var r=e.stack,i=r.pop(),o=e.ppem,c=e.deltaBase+(a-1)*16,f=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+a+"]",i,r);for(var g=0;g<i;g++){var m=r.pop(),v=r.pop(),x=c+((v&240)>>4);if(x===o){var T=(v&15)-8;T>=0&&T++;var S=T*f;exports.DEBUG&&console.log(e.step,"DELTACFIX",m,"by",S),e.cvt[m]+=S}}}function a2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SROUND[]",e),a.round=$g;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(a.srPeriod=r,e&48){case 0:a.srPhase=0;break;case 16:a.srPhase=.25*r;break;case 32:a.srPhase=.5*r;break;case 48:a.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?a.srThreshold=0:a.srThreshold=(e/8-.5)*r}function r2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"S45ROUND[]",e),a.round=$g;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(a.srPeriod=r,e&48){case 0:a.srPhase=0;break;case 16:a.srPhase=.25*r;break;case 32:a.srPhase=.5*r;break;case 48:a.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?a.srThreshold=0:a.srThreshold=(e/8-.5)*r}function s2(a){exports.DEBUG&&console.log(a.step,"ROFF[]"),a.round=Px}function i2(a){exports.DEBUG&&console.log(a.step,"RUTG[]"),a.round=Hx}function l2(a){exports.DEBUG&&console.log(a.step,"RDTG[]"),a.round=Yx}function o2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCANCTRL[]",e)}function km(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+a+"]",i,o);var g,m;a?(g=c.y-f.y,m=f.x-c.x):(g=f.x-c.x,m=f.y-c.y),e.dpv=mo(g,m)}function c2(a){var e=a.stack,r=e.pop(),i=0;exports.DEBUG&&console.log(a.step,"GETINFO[]",r),r&1&&(i=35),r&32&&(i|=4096),e.push(i)}function u2(a){var e=a.stack,r=e.pop(),i=e.pop(),o=e.pop();exports.DEBUG&&console.log(a.step,"ROLL[]"),e.push(i),e.push(r),e.push(o)}function f2(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MAX[]",r,i),e.push(Math.max(i,r))}function d2(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MIN[]",r,i),e.push(Math.min(i,r))}function p2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCANTYPE[]",e)}function h2(a){var e=a.stack.pop(),r=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"INSTCTRL[]",e,r),e){case 1:a.inhibitGridFit=!!r;return;case 2:a.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Ps(a,e){var r=e.stack,i=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+a+"]");for(var c=0;c<a;c++)r.push(i[++o]);e.ip=o}function zs(a,e){var r=e.ip,i=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+a+"]");for(var c=0;c<a;c++){var f=i[++r]<<8|i[++r];f&32768&&(f=-((f^65535)+1)),o.push(f)}e.ip=r}function Ge(a,e,r,i,o,c){var f=c.stack,g=a&&f.pop(),m=f.pop(),v=c.rp0,x=c.z0[v],T=c.z1[m],S=c.minDis,E=c.fv,M=c.dpv,D,j,P,F;j=D=M.distance(T,x,!0,!0),P=j>=0?1:-1,j=Math.abs(j),a&&(F=c.cvt[g],i&&Math.abs(j-F)<c.cvCutIn&&(j=F)),r&&j<S&&(j=S),i&&(j=c.round(j)),E.setRelative(T,x,P*j,M),E.touch(T),exports.DEBUG&&console.log(c.step,(a?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(i?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",a?g+"("+c.cvt[g]+","+F+")":"",m,"(d =",D,"->",P*j,")"),c.rp1=c.rp0,c.rp2=m,e&&(c.rp0=m)}Yg=[mm.bind(void 0,ls),mm.bind(void 0,Ur),gm.bind(void 0,ls),gm.bind(void 0,Ur),ym.bind(void 0,ls),ym.bind(void 0,Ur),vm.bind(void 0,0),vm.bind(void 0,1),bm.bind(void 0,0),bm.bind(void 0,1),Vx,Xx,$x,Wx,Zx,Qx,Kx,Jx,eS,tS,nS,aS,rS,sS,iS,lS,oS,cS,uS,fS,void 0,void 0,dS,Bf,pS,hS,mS,vS,bS,void 0,void 0,void 0,gS,yS,xS,void 0,xm.bind(void 0,0),xm.bind(void 0,1),Sm.bind(void 0,ls),Sm.bind(void 0,Ur),Em.bind(void 0,0),Em.bind(void 0,1),wm.bind(void 0,0),wm.bind(void 0,1),Am.bind(void 0,0),Am.bind(void 0,1),SS,ES,Tm.bind(void 0,0),Tm.bind(void 0,1),wS,AS,Cm.bind(void 0,0),Cm.bind(void 0,1),TS,CS,MS,NS,kS,RS,Mm.bind(void 0,0),Mm.bind(void 0,1),void 0,Nm.bind(void 0,0),Nm.bind(void 0,1),DS,void 0,_S,void 0,void 0,OS,IS,LS,US,jS,BS,FS,PS,zS,GS,HS,YS,qS,Ff.bind(void 0,1),VS,XS,$S,WS,ZS,QS,KS,JS,e2,t2,Sc.bind(void 0,0),Sc.bind(void 0,1),Sc.bind(void 0,2),Sc.bind(void 0,3),void 0,void 0,void 0,void 0,n2,Ff.bind(void 0,2),Ff.bind(void 0,3),Pf.bind(void 0,1),Pf.bind(void 0,2),Pf.bind(void 0,3),a2,r2,void 0,void 0,s2,void 0,i2,l2,Bf,Bf,void 0,void 0,void 0,void 0,void 0,o2,km.bind(void 0,0),km.bind(void 0,1),c2,void 0,u2,f2,d2,p2,h2,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ps.bind(void 0,1),Ps.bind(void 0,2),Ps.bind(void 0,3),Ps.bind(void 0,4),Ps.bind(void 0,5),Ps.bind(void 0,6),Ps.bind(void 0,7),Ps.bind(void 0,8),zs.bind(void 0,1),zs.bind(void 0,2),zs.bind(void 0,3),zs.bind(void 0,4),zs.bind(void 0,5),zs.bind(void 0,6),zs.bind(void 0,7),zs.bind(void 0,8),Ge.bind(void 0,0,0,0,0,0),Ge.bind(void 0,0,0,0,0,1),Ge.bind(void 0,0,0,0,0,2),Ge.bind(void 0,0,0,0,0,3),Ge.bind(void 0,0,0,0,1,0),Ge.bind(void 0,0,0,0,1,1),Ge.bind(void 0,0,0,0,1,2),Ge.bind(void 0,0,0,0,1,3),Ge.bind(void 0,0,0,1,0,0),Ge.bind(void 0,0,0,1,0,1),Ge.bind(void 0,0,0,1,0,2),Ge.bind(void 0,0,0,1,0,3),Ge.bind(void 0,0,0,1,1,0),Ge.bind(void 0,0,0,1,1,1),Ge.bind(void 0,0,0,1,1,2),Ge.bind(void 0,0,0,1,1,3),Ge.bind(void 0,0,1,0,0,0),Ge.bind(void 0,0,1,0,0,1),Ge.bind(void 0,0,1,0,0,2),Ge.bind(void 0,0,1,0,0,3),Ge.bind(void 0,0,1,0,1,0),Ge.bind(void 0,0,1,0,1,1),Ge.bind(void 0,0,1,0,1,2),Ge.bind(void 0,0,1,0,1,3),Ge.bind(void 0,0,1,1,0,0),Ge.bind(void 0,0,1,1,0,1),Ge.bind(void 0,0,1,1,0,2),Ge.bind(void 0,0,1,1,0,3),Ge.bind(void 0,0,1,1,1,0),Ge.bind(void 0,0,1,1,1,1),Ge.bind(void 0,0,1,1,1,2),Ge.bind(void 0,0,1,1,1,3),Ge.bind(void 0,1,0,0,0,0),Ge.bind(void 0,1,0,0,0,1),Ge.bind(void 0,1,0,0,0,2),Ge.bind(void 0,1,0,0,0,3),Ge.bind(void 0,1,0,0,1,0),Ge.bind(void 0,1,0,0,1,1),Ge.bind(void 0,1,0,0,1,2),Ge.bind(void 0,1,0,0,1,3),Ge.bind(void 0,1,0,1,0,0),Ge.bind(void 0,1,0,1,0,1),Ge.bind(void 0,1,0,1,0,2),Ge.bind(void 0,1,0,1,0,3),Ge.bind(void 0,1,0,1,1,0),Ge.bind(void 0,1,0,1,1,1),Ge.bind(void 0,1,0,1,1,2),Ge.bind(void 0,1,0,1,1,3),Ge.bind(void 0,1,1,0,0,0),Ge.bind(void 0,1,1,0,0,1),Ge.bind(void 0,1,1,0,0,2),Ge.bind(void 0,1,1,0,0,3),Ge.bind(void 0,1,1,0,1,0),Ge.bind(void 0,1,1,0,1,1),Ge.bind(void 0,1,1,0,1,2),Ge.bind(void 0,1,1,0,1,3),Ge.bind(void 0,1,1,1,0,0),Ge.bind(void 0,1,1,1,0,1),Ge.bind(void 0,1,1,1,0,2),Ge.bind(void 0,1,1,1,0,3),Ge.bind(void 0,1,1,1,1,0),Ge.bind(void 0,1,1,1,1,1),Ge.bind(void 0,1,1,1,1,2),Ge.bind(void 0,1,1,1,1,3)];function ll(a){this.char=a,this.state={},this.activeState=null}function yd(a,e,r){this.contextName=r,this.startIndex=a,this.endOffset=e}function m2(a,e,r){this.contextName=a,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function mr(a,e){this.context=a,this.index=e,this.length=a.length,this.current=a[e],this.backtrack=a.slice(0,e),this.lookahead=a.slice(e+1)}function Lc(a){this.eventId=a,this.subscribers=[]}function g2(a){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Lc(o)})}),a&&r.forEach(function(o){var c=a[o];typeof c=="function"&&e.events[o].subscribe(c)});var i=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];i.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function un(a){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],g2.call(this,a)}ll.prototype.setState=function(a,e){return this.state[a]=e,this.activeState={key:a,value:this.state[a]},this.activeState};ll.prototype.getState=function(a){return this.state[a]||null};un.prototype.inboundIndex=function(a){return a>=0&&a<this.tokens.length};un.prototype.composeRUD=function(a){var e=this,r=!0,i=a.map(function(c){return e[c[0]].apply(e,c.slice(1).concat(r))}),o=function(c){return typeof c=="object"&&c.hasOwnProperty("FAIL")};if(i.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(o)};this.dispatch("composeRUD",[i.filter(function(c){return!o(c)})])};un.prototype.replaceRange=function(a,e,r,i){e=e!==null?e:this.tokens.length;var o=r.every(function(f){return f instanceof ll});if(!isNaN(a)&&this.inboundIndex(a)&&o){var c=this.tokens.splice.apply(this.tokens,[a,e].concat(r));return i||this.dispatch("replaceToken",[a,e,r]),[c,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};un.prototype.replaceToken=function(a,e,r){if(!isNaN(a)&&this.inboundIndex(a)&&e instanceof ll){var i=this.tokens.splice(a,1,e);return r||this.dispatch("replaceToken",[a,e]),[i[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};un.prototype.removeRange=function(a,e,r){e=isNaN(e)?this.tokens.length:e;var i=this.tokens.splice(a,e);return r||this.dispatch("removeRange",[i,a,e]),i};un.prototype.removeToken=function(a,e){if(!isNaN(a)&&this.inboundIndex(a)){var r=this.tokens.splice(a,1);return e||this.dispatch("removeToken",[r,a]),r}else return{FAIL:"removeToken: invalid token index."}};un.prototype.insertToken=function(a,e,r){var i=a.every(function(o){return o instanceof ll});return i?(this.tokens.splice.apply(this.tokens,[e,0].concat(a)),r||this.dispatch("insertToken",[a,e]),a):{FAIL:"insertToken: invalid token(s)."}};un.prototype.registerModifier=function(a,e,r){this.events.newToken.subscribe(function(i,o){var c=[i,o],f=e===null||e.apply(this,c)===!0,g=[i,o];if(f){var m=r.apply(this,g);i.setState(a,m)}}),this.registeredModifiers.push(a)};Lc.prototype.subscribe=function(a){return typeof a=="function"?this.subscribers.push(a)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Lc.prototype.unsubscribe=function(a){this.subscribers.splice(a,1)};mr.prototype.setCurrentIndex=function(a){this.index=a,this.current=this.context[a],this.backtrack=this.context.slice(0,a),this.lookahead=this.context.slice(a+1)};mr.prototype.get=function(a){switch(!0){case a===0:return this.current;case(a<0&&Math.abs(a)<=this.backtrack.length):return this.backtrack.slice(a)[0];case(a>0&&a<=this.lookahead.length):return this.lookahead[a-1];default:return null}};un.prototype.rangeToText=function(a){if(a instanceof yd)return this.getRangeTokens(a).map(function(e){return e.char}).join("")};un.prototype.getText=function(){return this.tokens.map(function(a){return a.char}).join("")};un.prototype.getContext=function(a){var e=this.registeredContexts[a];return e||null};un.prototype.on=function(a,e){var r=this.events[a];return r?r.subscribe(e):null};un.prototype.dispatch=function(a,e){var r=this,i=this.events[a];i instanceof Lc&&i.subscribers.forEach(function(o){o.apply(r,e||[])})};un.prototype.registerContextChecker=function(a,e,r){if(this.getContext(a))return{FAIL:"context name '"+a+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var i=new m2(a,e,r);return this.registeredContexts[a]=i,this.contextCheckers.push(i),i};un.prototype.getRangeTokens=function(a){var e=a.startIndex+a.endOffset;return[].concat(this.tokens.slice(a.startIndex,e))};un.prototype.getContextRanges=function(a){var e=this.getContext(a);return e?e.ranges:{FAIL:"context checker '"+a+"' is not registered."}};un.prototype.resetContextsRanges=function(){var a=this.registeredContexts;for(var e in a)if(a.hasOwnProperty(e)){var r=a[e];r.ranges=[]}};un.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var a=this.tokens.map(function(i){return i.char}),e=0;e<a.length;e++){var r=new mr(a,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};un.prototype.setEndOffset=function(a,e){var r=this.getContext(e).openRange.startIndex,i=new yd(r,a,e),o=this.getContext(e).ranges;return i.rangeId=e+"."+o.length,o.push(i),this.getContext(e).openRange=null,i};un.prototype.runContextCheck=function(a){var e=this,r=a.index;this.contextCheckers.forEach(function(i){var o=i.contextName,c=e.getContext(o).openRange;if(!c&&i.checkStart(a)&&(c=new yd(r,null,o),e.getContext(o).openRange=c,e.dispatch("contextStart",[o,r])),c&&i.checkEnd(a)){var f=r-c.startIndex+1,g=e.setEndOffset(f,o);e.dispatch("contextEnd",[o,g])}})};un.prototype.tokenize=function(a){this.tokens=[],this.resetContextsRanges();var e=Array.from(a);this.dispatch("start");for(var r=0;r<e.length;r++){var i=e[r],o=new mr(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var c=new ll(i);this.tokens.push(c),this.dispatch("newToken",[c,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Ys(a){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(a)}function Zg(a){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(a)}function qs(a){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(a)}function Tc(a){return/[A-z]/.test(a)}function y2(a){return/\s/.test(a)}function Fa(a){this.font=a,this.features={}}function bi(a){this.id=a.id,this.tag=a.tag,this.substitution=a.substitution}function go(a,e){if(!a)return-1;switch(e.format){case 1:return e.glyphs.indexOf(a);case 2:for(var r=e.ranges,i=0;i<r.length;i++){var o=r[i];if(a>=o.start&&a<=o.end){var c=a-o.start;return o.index+c}}break;default:return-1}return-1}function v2(a,e){var r=go(a,e.coverage);return r===-1?null:a+e.deltaGlyphId}function b2(a,e){var r=go(a,e.coverage);return r===-1?null:e.substitute[r]}function zf(a,e){for(var r=[],i=0;i<a.length;i++){var o=a[i],c=e.current;c=Array.isArray(c)?c[0]:c;var f=go(c,o);f!==-1&&r.push(f)}return r.length!==a.length?-1:r}function x2(a,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(a.context.length<r)return[];var i=zf(e.inputCoverage,a);if(i===-1)return[];var o=e.inputCoverage.length-1;if(a.lookahead.length<e.lookaheadCoverage.length)return[];for(var c=a.lookahead.slice(o);c.length&&qs(c[0].char);)c.shift();var f=new mr(c,0),g=zf(e.lookaheadCoverage,f),m=[].concat(a.backtrack);for(m.reverse();m.length&&qs(m[0].char);)m.shift();if(m.length<e.backtrackCoverage.length)return[];var v=new mr(m,0),x=zf(e.backtrackCoverage,v),T=i.length===e.inputCoverage.length&&g.length===e.lookaheadCoverage.length&&x.length===e.backtrackCoverage.length,S=[];if(T)for(var E=0;E<e.lookupRecords.length;E++)for(var M=e.lookupRecords[E],D=M.lookupListIndex,j=this.getLookupByIndex(D),P=0;P<j.subtables.length;P++){var F=j.subtables[P],_=this.getLookupMethod(j,F),L=this.getSubstitutionType(j,F);if(L==="12")for(var I=0;I<i.length;I++){var V=a.get(I),$=_(V);$&&S.push($)}}return S}function S2(a,e){var r=a.current,i=go(r,e.coverage);if(i===-1)return null;for(var o,c=e.ligatureSets[i],f=0;f<c.length;f++){o=c[f];for(var g=0;g<o.components.length;g++){var m=a.lookahead[g],v=o.components[g];if(m!==v)break;if(g===o.components.length-1)return o}}return null}function E2(a,e){var r=go(a,e.coverage);return r===-1?null:e.sequences[r]}Fa.prototype.getDefaultScriptFeaturesIndexes=function(){for(var a=this.font.tables.gsub.scripts,e=0;e<a.length;e++){var r=a[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};Fa.prototype.getScriptFeaturesIndexes=function(a){var e=this.font.tables;if(!e.gsub)return[];if(!a)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,i=0;i<r.length;i++){var o=r[i];if(o.tag===a&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var c=o.langSysRecords;if(c)for(var f=0;f<c.length;f++){var g=c[f];if(g.tag===a){var m=g.langSys;return m.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};Fa.prototype.mapTagsToFeatures=function(a,e){for(var r={},i=0;i<a.length;i++){var o=a[i].tag,c=a[i].feature;r[o]=c}this.features[e].tags=r};Fa.prototype.getScriptFeatures=function(a){var e=this.features[a];if(this.features.hasOwnProperty(a))return e;var r=this.getScriptFeaturesIndexes(a);if(!r)return null;var i=this.font.tables.gsub;return e=r.map(function(o){return i.features[o]}),this.features[a]=e,this.mapTagsToFeatures(e,a),e};Fa.prototype.getSubstitutionType=function(a,e){var r=a.lookupType.toString(),i=e.substFormat.toString();return r+i};Fa.prototype.getLookupMethod=function(a,e){var r=this,i=this.getSubstitutionType(a,e);switch(i){case"11":return function(o){return v2.apply(r,[o,e])};case"12":return function(o){return b2.apply(r,[o,e])};case"63":return function(o){return x2.apply(r,[o,e])};case"41":return function(o){return S2.apply(r,[o,e])};case"21":return function(o){return E2.apply(r,[o,e])};default:throw new Error("lookupType: "+a.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};Fa.prototype.lookupFeature=function(a){var e=a.contextParams,r=e.index,i=this.getFeature({tag:a.tag,script:a.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+a.tag+"' for script '"+a.script+"'.");for(var o=this.getFeatureLookups(i),c=[].concat(e.context),f=0;f<o.length;f++)for(var g=o[f],m=this.getLookupSubtables(g),v=0;v<m.length;v++){var x=m[v],T=this.getSubstitutionType(g,x),S=this.getLookupMethod(g,x),E=void 0;switch(T){case"11":E=S(e.current),E&&c.splice(r,1,new bi({id:11,tag:a.tag,substitution:E}));break;case"12":E=S(e.current),E&&c.splice(r,1,new bi({id:12,tag:a.tag,substitution:E}));break;case"63":E=S(e),Array.isArray(E)&&E.length&&c.splice(r,1,new bi({id:63,tag:a.tag,substitution:E}));break;case"41":E=S(e),E&&c.splice(r,1,new bi({id:41,tag:a.tag,substitution:E}));break;case"21":E=S(e.current),E&&c.splice(r,1,new bi({id:21,tag:a.tag,substitution:E}));break}e=new mr(c,r),!(Array.isArray(E)&&!E.length)&&(E=null)}return c.length?c:null};Fa.prototype.supports=function(a){if(!a.script)return!1;this.getScriptFeatures(a.script);var e=this.features.hasOwnProperty(a.script);if(!a.tag)return e;var r=this.features[a.script].some(function(i){return i.tag===a.tag});return e&&r};Fa.prototype.getLookupSubtables=function(a){return a.subtables||null};Fa.prototype.getLookupByIndex=function(a){var e=this.font.tables.gsub.lookups;return e[a]||null};Fa.prototype.getFeatureLookups=function(a){return a.lookupListIndexes.map(this.getLookupByIndex.bind(this))};Fa.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function w2(a){var e=a.current,r=a.get(-1);return r===null&&Ys(e)||!Ys(r)&&Ys(e)}function A2(a){var e=a.get(1);return e===null||!Ys(e)}var T2={startCheck:w2,endCheck:A2};function C2(a){var e=a.current,r=a.get(-1);return(Ys(e)||qs(e))&&!Ys(r)}function M2(a){var e=a.get(1);switch(!0){case e===null:return!0;case(!Ys(e)&&!qs(e)):var r=y2(e);if(!r)return!0;if(r){var i=!1;if(i=a.lookahead.some(function(o){return Ys(o)||qs(o)}),!i)return!0}break;default:return!1}}var N2={startCheck:C2,endCheck:M2};function k2(a,e,r){e[r].setState(a.tag,a.substitution)}function R2(a,e,r){e[r].setState(a.tag,a.substitution)}function D2(a,e,r){a.substitution.forEach(function(i,o){var c=e[r+o];c.setState(a.tag,i)})}function _2(a,e,r){var i=e[r];i.setState(a.tag,a.substitution.ligGlyph);for(var o=a.substitution.components.length,c=0;c<o;c++)i=e[r+c+1],i.setState("deleted",!0)}var Rm={11:k2,12:R2,63:D2,41:_2};function vd(a,e,r){a instanceof bi&&Rm[a.id]&&Rm[a.id](a,e,r)}function O2(a){for(var e=[].concat(a.backtrack),r=e.length-1;r>=0;r--){var i=e[r],o=Zg(i),c=qs(i);if(!o&&!c)return!0;if(o)return!1}return!1}function I2(a){if(Zg(a.current))return!1;for(var e=0;e<a.lookahead.length;e++){var r=a.lookahead[e],i=qs(r);if(!i)return!0}return!1}function L2(a){var e=this,r="arab",i=this.featuresTags[r],o=this.tokenizer.getRangeTokens(a);if(o.length!==1){var c=new mr(o.map(function(g){return g.getState("glyphIndex")}),0),f=new mr(o.map(function(g){return g.char}),0);o.forEach(function(g,m){if(!qs(g.char)){c.setCurrentIndex(m),f.setCurrentIndex(m);var v=0;O2(f)&&(v|=1),I2(f)&&(v|=2);var x;switch(v){case 1:x="fina";break;case 2:x="init";break;case 3:x="medi";break}if(i.indexOf(x)!==-1){var T=e.query.lookupFeature({tag:x,script:r,contextParams:c});if(T instanceof Error)return console.info(T.message);T.forEach(function(S,E){S instanceof bi&&(vd(S,o,E),c.context[E]=S.substitution)})}}})}}function Dm(a,e){var r=a.map(function(i){return i.activeState.value});return new mr(r,0)}function U2(a){var e=this,r="arab",i=this.tokenizer.getRangeTokens(a),o=Dm(i);o.context.forEach(function(c,f){o.setCurrentIndex(f);var g=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});g.length&&(g.forEach(function(m){return vd(m,i,f)}),o=Dm(i))})}function j2(a){var e=a.current,r=a.get(-1);return r===null&&Tc(e)||!Tc(r)&&Tc(e)}function B2(a){var e=a.get(1);return e===null||!Tc(e)}var F2={startCheck:j2,endCheck:B2};function _m(a,e){var r=a.map(function(i){return i.activeState.value});return new mr(r,0)}function P2(a){var e=this,r="latn",i=this.tokenizer.getRangeTokens(a),o=_m(i);o.context.forEach(function(c,f){o.setCurrentIndex(f);var g=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});g.length&&(g.forEach(function(m){return vd(m,i,f)}),o=_m(i))})}function vr(a){this.baseDir=a||"ltr",this.tokenizer=new un,this.featuresTags={}}vr.prototype.setText=function(a){this.text=a};vr.prototype.contextChecks={latinWordCheck:F2,arabicWordCheck:T2,arabicSentenceCheck:N2};function Gf(a){var e=this.contextChecks[a+"Check"];return this.tokenizer.registerContextChecker(a,e.startCheck,e.endCheck)}function z2(){return Gf.call(this,"latinWord"),Gf.call(this,"arabicWord"),Gf.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function G2(){var a=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var i=a.tokenizer.getRangeTokens(r);a.tokenizer.replaceRange(r.startIndex,r.endOffset,i.reverse())})}vr.prototype.registerFeatures=function(a,e){var r=this,i=e.filter(function(o){return r.query.supports({script:a,tag:o})});this.featuresTags.hasOwnProperty(a)?this.featuresTags[a]=this.featuresTags[a].concat(i):this.featuresTags[a]=i};vr.prototype.applyFeatures=function(a,e){if(!a)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Fa(a));for(var r=0;r<e.length;r++){var i=e[r];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}};vr.prototype.registerModifier=function(a,e,r){this.tokenizer.registerModifier(a,e,r)};function bd(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function H2(){var a=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){bd.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(i){L2.call(a,i)})}}function Y2(){var a=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){bd.call(this);var i=this.tokenizer.getContextRanges("arabicWord");i.forEach(function(o){U2.call(a,o)})}}}function q2(){var a=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){bd.call(this);var i=this.tokenizer.getContextRanges("latinWord");i.forEach(function(o){P2.call(a,o)})}}}vr.prototype.checkContextReady=function(a){return!!this.tokenizer.getContext(a)};vr.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(H2.call(this),Y2.call(this)),this.checkContextReady("latinWord")&&q2.call(this),this.checkContextReady("arabicSentence")&&G2.call(this)};vr.prototype.processText=function(a){(!this.text||this.text!==a)&&(this.setText(a),z2.call(this),this.applyFeaturesToContexts())};vr.prototype.getBidiText=function(a){return this.processText(a),this.tokenizer.getText()};vr.prototype.getTextGlyphs=function(a){this.processText(a);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var i=this.tokenizer.tokens[r];if(!i.state.deleted){var o=i.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Pt(a){a=a||{},a.tables=a.tables||{},a.empty||(eo(a.familyName,"When creating a new Font object, familyName is required."),eo(a.styleName,"When creating a new Font object, styleName is required."),eo(a.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),eo(a.ascender,"When creating a new Font object, ascender is required."),eo(a.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:a.familyName||" "},fontSubfamily:{en:a.styleName||" "},fullName:{en:a.fullName||a.familyName+" "+a.styleName},postScriptName:{en:a.postScriptName||(a.familyName+a.styleName).replace(/\s/g,"")},designer:{en:a.designer||" "},designerURL:{en:a.designerURL||" "},manufacturer:{en:a.manufacturer||" "},manufacturerURL:{en:a.manufacturerURL||" "},license:{en:a.license||" "},licenseURL:{en:a.licenseURL||" "},version:{en:a.version||"Version 0.1"},description:{en:a.description||" "},copyright:{en:a.copyright||" "},trademark:{en:a.trademark||" "}},this.unitsPerEm=a.unitsPerEm||1e3,this.ascender=a.ascender,this.descender=a.descender,this.createdTimestamp=a.createdTimestamp,this.tables=Object.assign(a.tables,{os2:Object.assign({usWeightClass:a.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:a.widthClass||this.usWidthClasses.MEDIUM,fsSelection:a.fsSelection||this.fsSelectionValues.REGULAR},a.tables.os2)})),this.supported=!0,this.glyphs=new jr.GlyphSet(this,a.glyphs||[]),this.encoding=new hg(this),this.position=new po(this),this.substitution=new Ba(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Vg(this)}})}Pt.prototype.hasChar=function(a){return this.encoding.charToGlyphIndex(a)!==null};Pt.prototype.charToGlyphIndex=function(a){return this.encoding.charToGlyphIndex(a)};Pt.prototype.charToGlyph=function(a){var e=this.charToGlyphIndex(a),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Pt.prototype.updateFeatures=function(a){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return a[r]})}:e})};Pt.prototype.stringToGlyphs=function(a,e){var r=this,i=new vr,o=function(T){return r.charToGlyphIndex(T.char)};i.registerModifier("glyphIndex",null,o);var c=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;i.applyFeatures(this,c);for(var f=i.getTextGlyphs(a),g=f.length,m=new Array(g),v=this.glyphs.get(0),x=0;x<g;x+=1)m[x]=this.glyphs.get(f[x])||v;return m};Pt.prototype.nameToGlyphIndex=function(a){return this.glyphNames.nameToGlyphIndex(a)};Pt.prototype.nameToGlyph=function(a){var e=this.nameToGlyphIndex(a),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Pt.prototype.glyphIndexToName=function(a){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(a):""};Pt.prototype.getKerningValue=function(a,e){a=a.index||a,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,a,e):this.kerningPairs[a+","+e]||0};Pt.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Pt.prototype.forEachGlyph=function(a,e,r,i,o,c){e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:72,o=Object.assign({},this.defaultRenderOptions,o);var f=1/this.unitsPerEm*i,g=this.stringToGlyphs(a,o),m;if(o.kerning){var v=o.script||this.position.getDefaultScriptName();m=this.position.getKerningTables(v,o.language)}for(var x=0;x<g.length;x+=1){var T=g[x];if(c.call(this,T,e,r,i,o),T.advanceWidth&&(e+=T.advanceWidth*f),o.kerning&&x<g.length-1){var S=m?this.position.getKerningValue(m,T.index,g[x+1].index):this.getKerningValue(T,g[x+1]);e+=S*f}o.letterSpacing?e+=o.letterSpacing*i:o.tracking&&(e+=o.tracking/1e3*i)}return e};Pt.prototype.getPath=function(a,e,r,i,o){var c=new An;return this.forEachGlyph(a,e,r,i,o,function(f,g,m,v){var x=f.getPath(g,m,v,o,this);c.extend(x)}),c};Pt.prototype.getPaths=function(a,e,r,i,o){var c=[];return this.forEachGlyph(a,e,r,i,o,function(f,g,m,v){var x=f.getPath(g,m,v,o,this);c.push(x)}),c};Pt.prototype.getAdvanceWidth=function(a,e,r){return this.forEachGlyph(a,0,0,e,r,function(){})};Pt.prototype.draw=function(a,e,r,i,o,c){this.getPath(e,r,i,o,c).draw(a)};Pt.prototype.drawPoints=function(a,e,r,i,o,c){this.forEachGlyph(e,r,i,o,c,function(f,g,m,v){f.drawPoints(a,g,m,v)})};Pt.prototype.drawMetrics=function(a,e,r,i,o,c){this.forEachGlyph(e,r,i,o,c,function(f,g,m,v){f.drawMetrics(a,g,m,v)})};Pt.prototype.getEnglishName=function(a){var e=this.names[a];if(e)return e.en};Pt.prototype.validate=function(){var a=this;function e(i,o){}function r(i){var o=a.getEnglishName(i);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Pt.prototype.toTables=function(){return _x.fontToTable(this)};Pt.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Pt.prototype.toArrayBuffer=function(){for(var a=this.toTables(),e=a.encode(),r=new ArrayBuffer(e.length),i=new Uint8Array(r),o=0;o<e.length;o++)i[o]=e[o];return r};Pt.prototype.download=function(a){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");a=a||e.replace(/\s/g,"")+"-"+r+".otf";var i=this.toArrayBuffer();if(Ix())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(i),c=new Blob([o],{type:"font/opentype"}),f=document.createElement("a");f.href=window.URL.createObjectURL(c),f.download=a;var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!1),f.dispatchEvent(g)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var m=require("fs"),v=Lx(i);m.writeFileSync(a,v)}};Pt.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Pt.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Pt.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function Qg(a,e){var r=JSON.stringify(a),i=256;for(var o in e){var c=parseInt(o);if(!(!c||c<256)){if(JSON.stringify(e[o])===r)return c;i<=c&&(i=c+1)}}return e[i]=a,i}function V2(a,e,r){var i=Qg(e.name,r);return[{name:"tag_"+a,type:"TAG",value:e.tag},{name:"minValue_"+a,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+a,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+a,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+a,type:"USHORT",value:0},{name:"nameID_"+a,type:"USHORT",value:i}]}function X2(a,e,r){var i={},o=new He.Parser(a,e);return i.tag=o.parseTag(),i.minValue=o.parseFixed(),i.defaultValue=o.parseFixed(),i.maxValue=o.parseFixed(),o.skip("uShort",1),i.name=r[o.parseUShort()]||{},i}function $2(a,e,r,i){for(var o=Qg(e.name,i),c=[{name:"nameID_"+a,type:"USHORT",value:o},{name:"flags_"+a,type:"USHORT",value:0}],f=0;f<r.length;++f){var g=r[f].tag;c.push({name:"axis_"+a+" "+g,type:"FIXED",value:e.coordinates[g]<<16})}return c}function W2(a,e,r,i){var o={},c=new He.Parser(a,e);o.name=i[c.parseUShort()]||{},c.skip("uShort",1),o.coordinates={};for(var f=0;f<r.length;++f)o.coordinates[r[f].tag]=c.parseFixed();return o}function Z2(a,e){var r=new Fe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:a.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:a.instances.length},{name:"instanceSize",type:"USHORT",value:4+a.axes.length*4}]);r.offsetToData=r.sizeOf();for(var i=0;i<a.axes.length;i++)r.fields=r.fields.concat(V2(i,a.axes[i],e));for(var o=0;o<a.instances.length;o++)r.fields=r.fields.concat($2(o,a.instances[o],a.axes,e));return r}function Q2(a,e,r){var i=new He.Parser(a,e),o=i.parseULong();tt.argument(o===65536,"Unsupported fvar table version.");var c=i.parseOffset16();i.skip("uShort",1);for(var f=i.parseUShort(),g=i.parseUShort(),m=i.parseUShort(),v=i.parseUShort(),x=[],T=0;T<f;T++)x.push(X2(a,e+c+T*g,r));for(var S=[],E=e+c+f*g,M=0;M<m;M++)S.push(W2(a,E+M*v,x,r));return{axes:x,instances:S}}var K2={make:Z2,parse:Q2},J2=function(){return{coverage:this.parsePointer(ye.coverage),attachPoints:this.parseList(ye.pointer(ye.uShortList))}},eE=function(){var a=this.parseUShort();if(tt.argument(a===1||a===2||a===3,"Unsupported CaretValue table version."),a===1)return{coordinate:this.parseShort()};if(a===2)return{pointindex:this.parseShort()};if(a===3)return{coordinate:this.parseShort()}},tE=function(){return this.parseList(ye.pointer(eE))},nE=function(){return{coverage:this.parsePointer(ye.coverage),ligGlyphs:this.parseList(ye.pointer(tE))}},aE=function(){return this.parseUShort(),this.parseList(ye.pointer(ye.coverage))};function rE(a,e){e=e||0;var r=new ye(a,e),i=r.parseVersion(1);tt.argument(i===1||i===1.2||i===1.3,"Unsupported GDEF table version.");var o={version:i,classDef:r.parsePointer(ye.classDef),attachList:r.parsePointer(J2),ligCaretList:r.parsePointer(nE),markAttachClassDef:r.parsePointer(ye.classDef)};return i>=1.2&&(o.markGlyphSets=r.parsePointer(aE)),o}var sE={parse:rE},gr=new Array(10);gr[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(ye.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(ye.coverage),values:this.parseValueRecordList()};tt.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};gr[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();tt.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(ye.coverage),o=this.parseUShort(),c=this.parseUShort();if(r===1)return{posFormat:r,coverage:i,valueFormat1:o,valueFormat2:c,pairSets:this.parseList(ye.pointer(ye.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(c)}})))};if(r===2){var f=this.parsePointer(ye.classDef),g=this.parsePointer(ye.classDef),m=this.parseUShort(),v=this.parseUShort();return{posFormat:r,coverage:i,valueFormat1:o,valueFormat2:c,classDef1:f,classDef2:g,class1Count:m,class2Count:v,classRecords:this.parseList(m,ye.list(v,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(c)}}))}}};gr[3]=function(){return{error:"GPOS Lookup 3 not supported"}};gr[4]=function(){return{error:"GPOS Lookup 4 not supported"}};gr[5]=function(){return{error:"GPOS Lookup 5 not supported"}};gr[6]=function(){return{error:"GPOS Lookup 6 not supported"}};gr[7]=function(){return{error:"GPOS Lookup 7 not supported"}};gr[8]=function(){return{error:"GPOS Lookup 8 not supported"}};gr[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function iE(a,e){e=e||0;var r=new ye(a,e),i=r.parseVersion(1);return tt.argument(i===1||i===1.1,"Unsupported GPOS table version "+i),i===1?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(gr)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(gr),variations:r.parseFeatureVariationsList()}}var lE=new Array(10);function oE(a){return new Fe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Fe.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Fe.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Fe.LookupList(a.lookups,lE)}])}var cE={parse:iE,make:oE};function uE(a){var e={};a.skip("uShort");var r=a.parseUShort();tt.argument(r===0,"Unsupported kern sub-table version."),a.skip("uShort",2);var i=a.parseUShort();a.skip("uShort",3);for(var o=0;o<i;o+=1){var c=a.parseUShort(),f=a.parseUShort(),g=a.parseShort();e[c+","+f]=g}return e}function fE(a){var e={};a.skip("uShort");var r=a.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),a.skip("uLong");var i=a.parseUShort(),o=i&255;if(a.skip("uShort"),o===0){var c=a.parseUShort();a.skip("uShort",3);for(var f=0;f<c;f+=1){var g=a.parseUShort(),m=a.parseUShort(),v=a.parseShort();e[g+","+m]=v}}return e}function dE(a,e){var r=new He.Parser(a,e),i=r.parseUShort();if(i===0)return uE(r);if(i===1)return fE(r);throw new Error("Unsupported kern table version ("+i+").")}var pE={parse:dE};function hE(a,e,r,i){for(var o=new He.Parser(a,e),c=i?o.parseUShort:o.parseULong,f=[],g=0;g<r+1;g+=1){var m=c.call(o);i&&(m*=2),f.push(m)}return f}var mE={parse:hE};function gE(a,e){var r=require("fs");r.readFile(a,function(i,o){if(i)return e(i.message);e(null,Fg(o))})}function yE(a,e){var r=new XMLHttpRequest;r.open("get",a,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function Om(a,e){for(var r=[],i=12,o=0;o<e;o+=1){var c=He.getTag(a,i),f=He.getULong(a,i+4),g=He.getULong(a,i+8),m=He.getULong(a,i+12);r.push({tag:c,checksum:f,offset:g,length:m,compression:!1}),i+=16}return r}function vE(a,e){for(var r=[],i=44,o=0;o<e;o+=1){var c=He.getTag(a,i),f=He.getULong(a,i+4),g=He.getULong(a,i+8),m=He.getULong(a,i+12),v=void 0;g<m?v="WOFF":v=!1,r.push({tag:c,offset:f,compression:v,compressedLength:g,length:m}),i+=20}return r}function gn(a,e){if(e.compression==="WOFF"){var r=new Uint8Array(a.buffer,e.offset+2,e.compressedLength-2),i=new Uint8Array(e.length);if(cb(r,i),i.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var o=new DataView(i.buffer,0);return{data:o,offset:0}}else return{data:a,offset:e.offset}}function xd(a,e){e=e??{};var r,i,o=new Pt({empty:!0}),c=new DataView(a,0),f,g=[],m=He.getTag(c,0);if(m==="\0\0\0"||m==="true"||m==="typ1")o.outlinesFormat="truetype",f=He.getUShort(c,4),g=Om(c,f);else if(m==="OTTO")o.outlinesFormat="cff",f=He.getUShort(c,4),g=Om(c,f);else if(m==="wOFF"){var v=He.getTag(c,4);if(v==="\0\0\0")o.outlinesFormat="truetype";else if(v==="OTTO")o.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+m);f=He.getUShort(c,12),g=vE(c,f)}else throw new Error("Unsupported OpenType signature "+m);for(var x,T,S,E,M,D,j,P,F,_,L,I,V=0;V<f;V+=1){var $=g[V],J=void 0;switch($.tag){case"cmap":J=gn(c,$),o.tables.cmap=pg.parse(J.data,J.offset),o.encoding=new mg(o.tables.cmap);break;case"cvt ":J=gn(c,$),I=new He.Parser(J.data,J.offset),o.tables.cvt=I.parseShortList($.length/2);break;case"fvar":T=$;break;case"fpgm":J=gn(c,$),I=new He.Parser(J.data,J.offset),o.tables.fpgm=I.parseByteList($.length);break;case"head":J=gn(c,$),o.tables.head=Tg.parse(J.data,J.offset),o.unitsPerEm=o.tables.head.unitsPerEm,r=o.tables.head.indexToLocFormat;break;case"hhea":J=gn(c,$),o.tables.hhea=Cg.parse(J.data,J.offset),o.ascender=o.tables.hhea.ascender,o.descender=o.tables.hhea.descender,o.numberOfHMetrics=o.tables.hhea.numberOfHMetrics;break;case"hmtx":j=$;break;case"ltag":J=gn(c,$),i=Ng.parse(J.data,J.offset);break;case"maxp":J=gn(c,$),o.tables.maxp=kg.parse(J.data,J.offset),o.numGlyphs=o.tables.maxp.numGlyphs;break;case"name":_=$;break;case"OS/2":J=gn(c,$),o.tables.os2=td.parse(J.data,J.offset);break;case"post":J=gn(c,$),o.tables.post=Lg.parse(J.data,J.offset),o.glyphNames=new pd(o.tables.post);break;case"prep":J=gn(c,$),I=new He.Parser(J.data,J.offset),o.tables.prep=I.parseByteList($.length);break;case"glyf":S=$;break;case"loca":F=$;break;case"CFF ":x=$;break;case"kern":P=$;break;case"GDEF":E=$;break;case"GPOS":M=$;break;case"GSUB":D=$;break;case"meta":L=$;break}}var ie=gn(c,_);if(o.tables.name=Ig.parse(ie.data,ie.offset,i),o.names=o.tables.name,S&&F){var oe=r===0,U=gn(c,F),K=mE.parse(U.data,U.offset,o.numGlyphs,oe),Z=gn(c,S);o.glyphs=Hg.parse(Z.data,Z.offset,K,o,e)}else if(x){var W=gn(c,x);Ag.parse(W.data,W.offset,o,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var re=gn(c,j);if(Mg.parse(o,re.data,re.offset,o.numberOfHMetrics,o.numGlyphs,o.glyphs,e),Rb(o,e),P){var Y=gn(c,P);o.kerningPairs=pE.parse(Y.data,Y.offset)}else o.kerningPairs={};if(E){var ee=gn(c,E);o.tables.gdef=sE.parse(ee.data,ee.offset)}if(M){var ue=gn(c,M);o.tables.gpos=cE.parse(ue.data,ue.offset),o.position.init()}if(D){var Ee=gn(c,D);o.tables.gsub=Ug.parse(Ee.data,Ee.offset)}if(T){var q=gn(c,T);o.tables.fvar=K2.parse(q.data,q.offset,o.names)}if(L){var Q=gn(c,L);o.tables.meta=jg.parse(Q.data,Q.offset),o.metas=o.tables.meta}return o}function bE(a,e,r){r=r??{};var i=typeof window>"u",o=i&&!r.isUrl?gE:yE;return new Promise(function(c,f){o(a,function(g,m){if(g){if(e)return e(g);f(g)}var v;try{v=xd(m,r)}catch(x){if(e)return e(x,null);f(x)}if(e)return e(null,v);c(v)})})}function xE(a,e){var r=require("fs"),i=r.readFileSync(a);return xd(Fg(i),e)}var SE=Object.freeze({__proto__:null,Font:Pt,Glyph:ja,Path:An,BoundingBox:cs,_parse:He,parse:xd,load:bE,loadSync:xE});const Si=(a,e)=>({...e,...a}),to=new Map;function ol(a,e){const{renderingStyle:r,thickness:i,blankingSize:o}=Si(e,{renderingStyle:"normal",thickness:1,blankingSize:3});if(r==="normal"||!a||a.length===0)return a;const c=[];if(r==="dotted")for(const f of a)for(let g=0;g<i;g++)c.push({...f});else if(r==="blanked"){const f=Math.max(1,Math.floor(o));for(let g=0;g<a.length;g++){const m=a[g];m.blanking?c.push({...m}):Math.floor(g/f)%2===0?c.push({...m}):c.push({...m,r:0,g:0,b:0,blanking:!0})}}else if(r==="dots")for(const f of a)c.push({...f,r:0,g:0,b:0,blanking:!0}),c.push({...f,blanking:!1}),c.push({...f,blanking:!1});return c}async function Im(a,e){try{if(!e)throw new Error("A font buffer is required to generate text.");const r=`${e.byteLength}_${new Uint8Array(e.slice(0,100)).join("")}`;let i=to.get(r);if(!i&&(i=SE.parse(e),to.set(r,i),to.size>10)){const ie=to.keys().next().value;to.delete(ie)}const{text:o,x:c,y:f,r:g,g:m,b:v,fontSize:x,numPoints:T}=Si(a,{text:"TrueLazer",x:0,y:.3,r:255,g:255,b:255,fontSize:72,numPoints:100}),S=i.getPath(o,0,0,x),E=S.commands,M=S.getBoundingBox(),D=(M.x1+M.x2)/2,j=(M.y1+M.y2)/2;let P=0,F=0,_=0;E.forEach(ie=>{if(ie.type==="M")F=ie.x,_=ie.y;else if(ie.type==="L"||ie.type==="Q"||ie.type==="C"){const oe=ie.x-F,U=ie.y-_;P+=Math.sqrt(oe*oe+U*U),F=ie.x,_=ie.y}});const L=T/(P||1),I=[];F=0,_=0;let V=0,$=0;const J=200;if(E.forEach(ie=>{if(ie.type==="M"){if(I.length>0){const K=I[I.length-1];I.push({...K,r:0,g:0,b:0,blanking:!0})}V=ie.x,$=ie.y;const oe=(ie.x-D)/J+c,U=-(ie.y-j)/J+f;I.push({x:oe,y:U,r:0,g:0,b:0,blanking:!0}),I.push({x:oe,y:U,r:g,g:m,b:v,blanking:!1}),F=ie.x,_=ie.y}else if(ie.type==="L"){const oe=ie.x-F,U=ie.y-_,K=Math.sqrt(oe*oe+U*U),Z=Math.max(1,Math.floor(K*L));for(let W=1;W<=Z;W++){const re=W/Z;I.push({x:(F+oe*re-D)/J+c,y:-(_+U*re-j)/J+f,r:g,g:m,b:v})}F=ie.x,_=ie.y}else if(ie.type==="Q"){const oe=ie.x-F,U=ie.y-_,K=Math.sqrt(oe*oe+U*U),Z=Math.max(2,Math.floor(K*L));for(let W=1;W<=Z;W++){const re=W/Z,Y=Math.pow(1-re,2)*F+2*(1-re)*re*ie.x1+Math.pow(re,2)*ie.x,ee=Math.pow(1-re,2)*_+2*(1-re)*re*ie.y1+Math.pow(re,2)*ie.y;I.push({x:(Y-D)/J+c,y:-(ee-j)/J+f,r:g,g:m,b:v})}F=ie.x,_=ie.y}else if(ie.type==="C"){const oe=ie.x-F,U=ie.y-_,K=Math.sqrt(oe*oe+U*U),Z=Math.max(3,Math.floor(K*L));for(let W=1;W<=Z;W++){const re=W/Z,Y=Math.pow(1-re,3)*F+3*Math.pow(1-re,2)*re*ie.x1+3*(1-re)*Math.pow(re,2)*ie.x2+Math.pow(re,3)*ie.x,ee=Math.pow(1-re,3)*_+3*Math.pow(1-re,2)*re*ie.y1+3*(1-re)*Math.pow(re,2)*ie.y2+Math.pow(re,3)*ie.y;I.push({x:(Y-D)/J+c,y:-(ee-j)/J+f,r:g,g:m,b:v})}F=ie.x,_=ie.y}else ie.type==="Z"&&(I.push({x:(V-D)/J+c,y:-($-j)/J+f,r:g,g:m,b:v}),F=V,_=$)}),I.length>0){const ie=I[I.length-1];I.push({...ie,r:0,g:0,b:0,blanking:!0})}return{points:ol(I,a)}}catch(r){throw console.error("Error in generateText:",r),r}}function Lm(a){try{const{radius:e,numPoints:r,x:i,y:o,r:c,g:f,b:g}=Si(a,{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255}),m=[];for(let v=0;v<=r;v++){const x=v/r*2*Math.PI;m.push({x:e*Math.cos(x)+i,y:e*Math.sin(x)+o,r:c,g:f,b:g})}return{points:ol(m,a)}}catch(e){throw console.error("Error in generateCircle:",e),e}}function Um(a){try{const{width:e,height:r,pointDensity:i,x:o,y:c,r:f,g,b:m}=Si(a,{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255}),v=[{x:-e/2+o,y:-r/2+c},{x:e/2+o,y:-r/2+c},{x:e/2+o,y:r/2+c},{x:-e/2+o,y:r/2+c},{x:-e/2+o,y:-r/2+c}],x=[];for(let T=0;T<v.length-1;T++){const S=v[T],E=v[T+1];for(let M=0;M<i;M++){const D=M/i;x.push({x:S.x+(E.x-S.x)*D,y:S.y+(E.y-S.y)*D,r:f,g,b:m})}}return x.push({...v[v.length-1],r:f,g,b:m}),{points:ol(x,a)}}catch(e){throw console.error("Error in generateSquare:",e),e}}function jm(a){try{const{x1:e,y1:r,x2:i,y2:o,pointDensity:c,r:f,g,b:m}=Si(a,{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255}),v=[];for(let x=0;x<=c;x++){const T=x/c;v.push({x:e+(i-e)*T,y:r+(o-r)*T,r:f,g,b:m})}return{points:ol(v,a)}}catch(e){throw console.error("Error in generateLine:",e),e}}function Bm(a){try{const{outerRadius:e,innerRadius:r,numSpikes:i,pointDensity:o,x:c,y:f,r:g,g:m,b:v}=Si(a,{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255}),x=[];for(let S=0;S<i*2;S++){const E=S%2===0?e:r,M=S/(i*2)*2*Math.PI-Math.PI/2;x.push({x:E*Math.cos(M)+c,y:E*Math.sin(M)+f})}x.push({...x[0]});const T=[];for(let S=0;S<x.length-1;S++){const E=x[S],M=x[S+1];for(let D=0;D<o;D++){const j=D/o;T.push({x:E.x+(M.x-E.x)*j,y:E.y+(M.y-E.y)*j,r:g,g:m,b:v})}}return T.push({...x[x.length-1],r:g,g:m,b:v}),{points:ol(T,a)}}catch(e){throw console.error("Error in generateStar:",e),e}}function EE(a){try{const{amplitude:e,frequency:r,phase:i,width:o,numPoints:c,x:f,y:g,r:m,g:v,b:x}=Si(a,{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255}),T=[],S=-o/2;for(let E=0;E<=c;E++){const M=E/c,D=S+M*o,j=e*Math.sin(r*(D*Math.PI)+i);T.push({x:D+f,y:j+g,r:m,g:v,b:x})}return{points:ol(T,a)}}catch(e){throw console.error("Error in generateSinewave:",e),e}}const ao=()=>Math.random().toString(36).substr(2,9),wE=Yn.memo(({playbackFps:a,onSpeedChange:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_speed",targetType:"global",label:"SPEED",min:1,max:120,step:1}))};return d.jsxs("div",{className:"master-speed-slider",children:[d.jsxs("label",{htmlFor:"masterSpeedRange",draggable:!0,onDragStart:r,children:[a," FPS"]}),d.jsx($t,{id:"master_speed",children:d.jsx("input",{type:"range",min:"1",max:"120",value:a,className:"slider_hor",id:"masterSpeedRange",onChange:i=>e(parseInt(i.target.value))})})]})}),AE=Yn.memo(({isWorldOutputActive:a,onToggleWorldOutput:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"laser_output",targetType:"global",label:"LASER"}))};return d.jsx("div",{className:"container",draggable:!0,onDragStart:r,children:d.jsx($t,{id:"laser_output",children:d.jsx("input",{type:"checkbox",checked:a,onChange:e})})})}),ro=(a,e,r,i)=>!Array.isArray(a)||a.length!==e?Array(e).fill(null).map((o,c)=>Array(r).fill(null).map((f,g)=>i(c,g))):a.map((o,c)=>!Array.isArray(o)||o.length!==r?Array(r).fill(null).map((f,g)=>i(c,g)):o),Kg=a=>({columns:Array.from({length:8},(e,r)=>`Col ${r+1}`),layers:Array.from({length:5},(e,r)=>`Layer ${r+1}`),clipContents:ro(a?.clipContents,5,8,()=>({parsing:!1})),clipNames:ro(a?.clipNames,5,8,(e,r)=>`Clip ${e+1}-${r+1}`),thumbnailFrameIndexes:Array(5).fill(null).map(()=>Array(8).fill(0)),layerEffects:Array.from({length:5},()=>[]),layerAssignedDacs:a?.layerAssignedDacs??Array(5).fill([]),layerIntensities:Array(5).fill(1),layerAutopilots:Array(5).fill("off"),layerBlackouts:Array(5).fill(!1),layerSolos:Array(5).fill(!1),masterIntensity:1,globalBlackout:!1,selectedLayerIndex:null,selectedColIndex:null,notification:{message:"",visible:!1},dacs:[],selectedDac:a?.dacAssignment?.selectedDac??a?.selectedDac??null,fileBrowserViewMode:"list",fileBrowserPath:"",layerUiStates:Array(6).fill({}),ildaFrames:[],selectedIldaWorkerId:null,selectedIldaTotalFrames:0,bpm:a?.bpm??120,showBeamEffect:a?.renderSettings?.showBeamEffect??!0,beamAlpha:a?.renderSettings?.beamAlpha??.1,fadeAlpha:a?.renderSettings?.fadeAlpha??.13,playbackFps:a?.renderSettings?.playbackFps??60,previewScanRate:a?.renderSettings?.previewScanRate??1,beamRenderMode:a?.renderSettings?.beamRenderMode??"both",worldShowBeamEffect:a?.renderSettings?.worldShowBeamEffect??!0,worldBeamRenderMode:a?.renderSettings?.worldBeamRenderMode??"both",optimizationEnabled:a?.renderSettings?.optimizationEnabled??!0,activeClipIndexes:Array(5).fill(null),isPlaying:!1,isStopped:!0,isWorldOutputActive:!1,thumbnailRenderMode:a?.thumbnailRenderMode??"still",theme:a?.theme??"orange",projectLoadTimestamp:null,clipClipboard:null,dacOutputSettings:a?.dacOutputSettings??{},quickAssigns:{knobs:Array(8).fill(null).map(()=>({value:0,label:null,link:null})),buttons:Array(8).fill(null).map(()=>({value:!1,label:null,link:null}))}});function TE(a,e){switch(e.type){case"SET_DAC_OUTPUT_SETTINGS":return{...a,dacOutputSettings:{...a.dacOutputSettings,[e.payload.id]:e.payload.settings}};case"SET_COLUMNS":return{...a,columns:e.payload};case"SET_COLUMN_NAME":{const r=[...a.columns];return r[e.payload.index]=e.payload.name,{...a,columns:r}}case"DUPLICATE_COLUMN":{const r=e.payload.index,i=[...a.columns];i.splice(r+1,0,`${i[r]} (Copy)`);const o=a.clipContents.map(g=>{const m=[...g],v=m[r];let x=null;if(v&&(x=JSON.parse(JSON.stringify(v)),x.type==="ilda"&&(x.workerId=null),x.effects)){const T=x.syncSettings||{};x.effects=x.effects.map(S=>{const E=S.instanceId,M=ao();return Object.keys(T).forEach(D=>{E&&D.startsWith(`${E}.`)&&(T[`${M}.${D.split(".")[1]}`]=T[D],delete T[D])}),{...S,instanceId:M}}),x.syncSettings=T}return m.splice(r+1,0,x),m}),c=a.clipNames.map(g=>{const m=[...g];return m.splice(r+1,0,`${m[r]} (Copy)`),m}),f=a.thumbnailFrameIndexes.map(g=>{const m=[...g];return m.splice(r+1,0,m[r]),m});return{...a,columns:i,clipContents:o,clipNames:c,thumbnailFrameIndexes:f}}case"SET_LAYERS":return{...a,layers:e.payload};case"SET_LAYER_NAME":{const r=[...a.layers];return r[e.payload.index]=e.payload.name,{...a,layers:r}}case"SET_CLIP_CONTENT":{const{layerIndex:r,colIndex:i,content:o}=e.payload;if(r===void 0||i===void 0)return a;const c=[...a.clipContents];if(!c[r])return console.error(`Reducer Error: Layer array at index ${r} is undefined. Action:`,e),a;c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,...o},{...a,clipContents:c}}case"SET_CLIP_NAME":{const{layerIndex:r,colIndex:i,name:o}=e.payload;if(r===void 0||i===void 0)return a;const c=[...a.clipNames];return c[r]&&(c[r]=[...c[r]],c[r][i]=o),{...a,clipNames:c}}case"SET_THUMBNAIL_FRAME_INDEX":{const r=[...a.thumbnailFrameIndexes];return r[e.payload.layerIndex][e.payload.colIndex]=e.payload.index,{...a,thumbnailFrameIndexes:r}}case"ADD_LAYER_EFFECT":{const r=[...a.layerEffects],i={...e.payload.effect,instanceId:ao(),params:{...e.payload.effect.defaultParams}};return r[e.payload.layerIndex].push(i),{...a,layerEffects:r}}case"ADD_CLIP_EFFECT":{const r=[...a.clipContents];if(!r[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),a;r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=r[e.payload.layerIndex][e.payload.colIndex]||{},o={...e.payload.effect,instanceId:ao(),params:{...e.payload.effect.defaultParams}},c={...i,effects:[...i.effects||[],o]};return r[e.payload.layerIndex][e.payload.colIndex]=c,{...a,clipContents:r}}case"SET_SELECTED_CLIP":return{...a,selectedLayerIndex:e.payload.layerIndex,selectedColIndex:e.payload.colIndex};case"SET_NOTIFICATION":return{...a,notification:e.payload};case"SET_ILDA_FRAMES":return{...a,ildaFrames:e.payload};case"SET_SELECTED_ILDA_DATA":return{...a,selectedIldaWorkerId:e.payload.workerId,selectedIldaTotalFrames:e.payload.totalFrames,selectedGeneratorId:e.payload.generatorId,selectedGeneratorParams:e.payload.generatorParams};case"SET_ACTIVE_CLIP":{const r=[...a.activeClipIndexes];return r[e.payload.layerIndex]=e.payload.colIndex,{...a,activeClipIndexes:r}}case"CLEAR_CLIP":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]],r[e.payload.layerIndex][e.payload.colIndex]=null;const i=[...a.clipNames];i[e.payload.layerIndex][e.payload.colIndex]=`Clip ${e.payload.layerIndex+1}-${e.payload.colIndex+1}`;const o=[...a.thumbnailFrameIndexes];o[e.payload.layerIndex][e.payload.colIndex]=0;const c=[...a.activeClipIndexes];return c[e.payload.layerIndex]===e.payload.colIndex&&(c[e.payload.layerIndex]=null),a.selectedLayerIndex===e.payload.layerIndex&&a.selectedColIndex===e.payload.colIndex?{...a,clipContents:r,clipNames:i,thumbnailFrameIndexes:o,activeClipIndexes:c,selectedLayerIndex:null,selectedColIndex:null,selectedIldaWorkerId:null,selectedIldaTotalFrames:0,selectedGeneratorId:null,selectedGeneratorParams:{}}:{...a,clipContents:r,clipNames:i,thumbnailFrameIndexes:o,activeClipIndexes:c}}case"DEACTIVATE_LAYER_CLIPS":{const r=[...a.activeClipIndexes];return r[e.payload.layerIndex]=null,{...a,activeClipIndexes:r}}case"CLEAR_ALL_ACTIVE_CLIPS":return{...a,activeClipIndexes:Array(a.layers.length).fill(null)};case"SET_LAYER_INTENSITY":{const r=[...a.layerIntensities];return r[e.payload.layerIndex]=e.payload.intensity,{...a,layerIntensities:r}}case"SET_LAYER_AUTOPILOT":{const r=[...a.layerAutopilots];return r[e.payload.layerIndex]=e.payload.mode,{...a,layerAutopilots:r}}case"TOGGLE_LAYER_BLACKOUT":{const r=[...a.layerBlackouts];return r[e.payload.layerIndex]=!r[e.payload.layerIndex],{...a,layerBlackouts:r}}case"TOGGLE_LAYER_SOLO":{const r=[...a.layerSolos],i=r[e.payload.layerIndex];return r.fill(!1),i||(r[e.payload.layerIndex]=!0),{...a,layerSolos:r}}case"SET_MASTER_INTENSITY":return{...a,masterIntensity:e.payload};case"TOGGLE_GLOBAL_BLACKOUT":return{...a,globalBlackout:!a.globalBlackout};case"SET_RENDER_SETTING":return{...a,[e.payload.setting]:e.payload.value};case"SET_FILE_BROWSER_VIEW_MODE":return{...a,fileBrowserViewMode:e.payload};case"SET_FILE_BROWSER_PATH":return{...a,fileBrowserPath:e.payload};case"UPDATE_CLIP_UI_STATE":{const{layerIndex:r,colIndex:i,uiState:o}=e.payload,c=[...a.clipContents];c[r]=[...c[r]];const f={...c[r][i]};return f&&(f.uiState={...f.uiState||{},...o},c[r][i]=f),{...a,clipContents:c}}case"UPDATE_LAYER_UI_STATE":{const{layerIndex:r,uiState:i}=e.payload,o=[...a.layerUiStates];return o[r]={...o[r],...i},{...a,layerUiStates:o}}case"REMOVE_CLIP_EFFECT":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};if(i&&i.effects){const o=[...i.effects];o.splice(e.payload.effectIndex,1),i.effects=o,r[e.payload.layerIndex][e.payload.colIndex]=i}return{...a,clipContents:r}}case"REORDER_CLIP_EFFECTS":{const{layerIndex:r,colIndex:i,oldIndex:o,newIndex:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const g={...f[r][i]};if(g&&g.effects){const m=[...g.effects],[v]=m.splice(o,1);m.splice(c,0,v),g.effects=m,f[r][i]=g}return{...a,clipContents:f}}case"REMOVE_LAYER_EFFECT":{const r=[...a.layerEffects];return r[e.payload.layerIndex]&&(r[e.payload.layerIndex]=[...r[e.payload.layerIndex]],r[e.payload.layerIndex].splice(e.payload.effectIndex,1)),{...a,layerEffects:r}}case"UPDATE_LAYER_EFFECT_PARAMETER":{const r=[...a.layerEffects];if(r[e.payload.layerIndex]){r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=e.payload.effectIndex;if(r[e.payload.layerIndex][i]){const o={...r[e.payload.layerIndex][i]};o.params={...o.params,[e.payload.paramName]:e.payload.newValue},r[e.payload.layerIndex][i]=o}}return{...a,layerEffects:r}}case"UPDATE_EFFECT_PARAMETER":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};if(i&&i.effects){const o=[...i.effects],c={...o[e.payload.effectIndex]};c.params={...c.params,[e.payload.paramName]:e.payload.newValue},o[e.payload.effectIndex]=c,i.effects=o,r[e.payload.layerIndex][e.payload.colIndex]=i}return{...a,clipContents:r}}case"UPDATE_CLIP_PLAYBACK_SETTINGS":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};return i&&(i.playbackSettings={...i.playbackSettings||{mode:"fps",duration:1,beats:8,speedMultiplier:1},...e.payload.settings},r[e.payload.layerIndex][e.payload.colIndex]=i),{...a,clipContents:r}}case"SET_CLIP_PARAM_SYNC":{const{layerIndex:r,colIndex:i,paramId:o,syncMode:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const g={...f[r][i]};if(g){const m=g.syncSettings||{},v=m[o]===c?null:c;g.syncSettings={...m,[o]:v},f[r][i]=g}return{...a,clipContents:f}}case"UPDATE_GENERATOR_PARAM":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};return i&&i.type==="generator"&&i.currentParams&&(i.currentParams={...i.currentParams,[e.payload.paramName]:e.payload.newValue},r[e.payload.layerIndex][e.payload.colIndex]=i,a.selectedLayerIndex===e.payload.layerIndex&&a.selectedColIndex===e.payload.colIndex)?{...a,clipContents:r,selectedGeneratorParams:i.currentParams}:{...a,clipContents:r}}case"SET_DACS":return{...a,dacs:e.payload};case"SET_BPM":return{...a,bpm:e.payload};case"SET_SELECTED_DAC":return{...a,selectedDac:e.payload};case"SET_IS_PLAYING":return{...a,isPlaying:e.payload};case"SET_IS_STOPPED":return{...a,isStopped:e.payload};case"SET_WORLD_OUTPUT_ACTIVE":return{...a,isWorldOutputActive:e.payload};case"SET_OPTIMIZATION_ENABLED":return{...a,optimizationEnabled:e.payload};case"TOGGLE_WORLD_OUTPUT_ACTIVE":return{...a,isWorldOutputActive:!a.isWorldOutputActive};case"SET_CLIPBOARD":return{...a,clipClipboard:e.payload};case"SET_CLIP_DAC":{const r=[...a.clipContents];if(!r[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),a;r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=r[e.payload.layerIndex][e.payload.colIndex]||{};let o=i.assignedDacs||[];const c=[],f=m=>{const{channels:v,allChannels:x,...T}=m;return T};if(e.payload.dac.allChannels&&e.payload.dac.channels)e.payload.dac.channels.forEach(m=>{o.some(v=>v.ip===e.payload.dac.ip&&v.channel===m.serviceID)||c.push({...f(e.payload.dac),channel:m.serviceID,mirrorX:!1,mirrorY:!1})});else{const m=e.payload.dac.channel;m!==void 0&&!o.some(v=>v.ip===e.payload.dac.ip&&v.channel===m)&&c.push({...f(e.payload.dac),channel:m,mirrorX:!1,mirrorY:!1})}if(c.length===0)return a;const g={...i,assignedDacs:[...o,...c]};return r[e.payload.layerIndex][e.payload.colIndex]=g,{...a,clipContents:r}}case"SET_LAYER_DAC":{const{layerIndex:r,dac:i}=e.payload,o=[...a.layerAssignedDacs],c=o[r]||[];let f=[];const g=m=>{const{channels:v,allChannels:x,...T}=m;return T};if(i.allChannels&&i.channels)i.channels.forEach(m=>{c.some(v=>v.ip===i.ip&&v.channel===m.serviceID)||f.push({...g(i),channel:m.serviceID,mirrorX:!1,mirrorY:!1})});else{const m=i.channel;m!==void 0&&!c.some(v=>v.ip===i.ip&&v.channel===m)&&f.push({...g(i),channel:m,mirrorX:!1,mirrorY:!1})}return f.length===0?a:(o[r]=[...c,...f],{...a,layerAssignedDacs:o})}case"TOGGLE_CLIP_DAC_MIRROR":{const{layerIndex:r,colIndex:i,dacIndex:o,axis:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const g={...f[r][i]};if(g&&g.assignedDacs){const m=[...g.assignedDacs],v={...m[o]};return c==="x"&&(v.mirrorX=!v.mirrorX),c==="y"&&(v.mirrorY=!v.mirrorY),m[o]=v,g.assignedDacs=m,f[r][i]=g,{...a,clipContents:f}}return a}case"REMOVE_CLIP_DAC":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const{layerIndex:i,colIndex:o,dacIndex:c}=e.payload,f=r[i][o];if(f&&f.assignedDacs){const g=[...f.assignedDacs];return g.splice(c,1),r[e.payload.layerIndex][e.payload.colIndex]={...f,assignedDacs:g},{...a,clipContents:r}}return a}case"TOGGLE_LAYER_DAC_MIRROR":{const{layerIndex:r,dacIndex:i,axis:o}=e.payload,c=[...a.layerAssignedDacs],f=c[r]?[...c[r]]:[];if(f[i]){const g={...f[i]};return o==="x"&&(g.mirrorX=!g.mirrorX),o==="y"&&(g.mirrorY=!g.mirrorY),f[i]=g,c[r]=f,{...a,layerAssignedDacs:c}}return a}case"REMOVE_LAYER_DAC":{const{layerIndex:r,dacIndex:i}=e.payload,o=[...a.layerAssignedDacs];if(o[r]){const c=[...o[r]];return c.splice(i,1),o[r]=c,{...a,layerAssignedDacs:o}}return a}case"SET_CLIP_AUDIO":{const r=[...a.clipContents],{layerIndex:i,colIndex:o,audioFile:c}=e.payload;r[i]=[...r[i]];const f=r[i][o];return f?(r[i][o]={...f,audioFile:c,audioVolume:f.audioVolume!==void 0?f.audioVolume:1},{...a,clipContents:r}):a}case"SET_CLIP_AUDIO_VOLUME":{const r=[...a.clipContents],{layerIndex:i,colIndex:o,volume:c}=e.payload;r[i]=[...r[i]];const f=r[i][o];return f?(r[i][o]={...f,audioVolume:c},{...a,clipContents:r}):a}case"REMOVE_CLIP_AUDIO":{const r=[...a.clipContents],{layerIndex:i,colIndex:o}=e.payload;r[i]=[...r[i]];const c=r[i][o];return c?(r[i][o]={...c,audioFile:null},{...a,clipContents:r}):a}case"SET_CLIP_PARSING_STATUS":{const{layerIndex:r,colIndex:i,status:o}=e.payload,c=[...a.clipContents];if(c[r]){c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,parsing:o},{...a,clipContents:c}}return a}case"SET_BULK_PARSING_STATUS":{const r=[...a.clipContents];return new Set(e.payload.map(o=>o.layerIndex)).forEach(o=>{r[o]&&(r[o]=[...r[o]])}),e.payload.forEach(({layerIndex:o,colIndex:c,status:f})=>{if(r[o]){const g=r[o][c]||{};r[o][c]={...g,parsing:f}}}),{...a,clipContents:r}}case"SET_THUMBNAIL_RENDER_MODE":return{...a,thumbnailRenderMode:e.payload};case"SET_CLIP_TRIGGER_STYLE":{const{layerIndex:r,colIndex:i,style:o}=e.payload,c=[...a.clipContents];c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,triggerStyle:o},{...a,clipContents:c}}case"SET_THEME":return{...a,theme:e.payload};case"UPDATE_THUMBNAIL":{const{layerIndex:r,colIndex:i,frameIndex:o}=e.payload,c=[...a.thumbnailFrameIndexes];return c[r]=[...c[r]],c[r][i]=o,{...a,thumbnailFrameIndexes:c}}case"RESET_STATE":return Kg({});case"LOAD_PROJECT":{const r={...a,...e.payload};return r.clipContents=ro(r.clipContents,5,8,()=>({parsing:!1})),r.clipNames=ro(r.clipNames,5,8,(i,o)=>`Clip ${i+1}-${o+1}`),r.clipContents=r.clipContents.map(i=>i.map(o=>o&&o.type==="ilda"?{...o,workerId:null,parsing:!1}:o)),r.activeClipIndexes=Array(a.layers.length).fill(null),r.selectedLayerIndex=null,r.selectedColIndex=null,r.selectedIldaWorkerId=null,r.selectedIldaTotalFrames=0,r.selectedGeneratorId=null,r.selectedGeneratorParams={},r.projectLoadTimestamp=Date.now(),r}case"LOAD_SETTINGS":return{...a,showBeamEffect:e.payload.renderSettings?.showBeamEffect??a.showBeamEffect,beamAlpha:e.payload.renderSettings?.beamAlpha??a.beamAlpha,fadeAlpha:e.payload.renderSettings?.fadeAlpha??a.fadeAlpha,playbackFps:e.payload.renderSettings?.playbackFps??a.playbackFps,previewScanRate:e.payload.renderSettings?.previewScanRate??a.previewScanRate,beamRenderMode:e.payload.renderSettings?.beamRenderMode??a.beamRenderMode,theme:e.payload.theme??a.theme,thumbnailRenderMode:e.payload.thumbnailRenderMode??a.thumbnailRenderMode,selectedDac:e.payload.selectedDac??a.selectedDac,clipNames:e.payload.clipNames?ro(e.payload.clipNames,5,8,(r,i)=>`Clip ${r+1}-${i+1}`):a.clipNames,dacOutputSettings:e.payload.dacOutputSettings??a.dacOutputSettings};case"ASSIGN_QUICK_CONTROL":{const{type:r,index:i,link:o}=e.payload,c={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},f=r==="knob"?"knobs":"buttons";return c[f][i]={...c[f][i],label:o.paramName||o.paramId,link:o,min:o.min,max:o.max,step:o.step},{...a,quickAssigns:c}}case"CLEAR_QUICK_CONTROL":{const{type:r,index:i}=e.payload,o={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},c=r==="knob"?"knobs":"buttons";return o[c][i]={value:r==="knob"?0:!1,label:null,link:null},{...a,quickAssigns:o}}case"UPDATE_QUICK_CONTROL":{const{type:r,index:i,value:o}=e.payload,c={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},f=r==="knob"?"knobs":"buttons",g=c[f][i];c[f][i]={...g,value:o};let m={...a,quickAssigns:c};if(g.link){const{layerIndex:v,colIndex:x,effectIndex:T,targetType:S}=g.link,E=g.link.paramName||g.link.paramId;let M=o;if(r==="knob"&&g.min!==void 0&&g.max!==void 0&&(M=g.min+o*(g.max-g.min),g.step&&(M=Math.round(M/g.step)*g.step),M=parseFloat(M.toFixed(5))),console.log(`Updating ${S} param ${E} to ${M} (Link: L${v} C${x} E${T})`),S==="layerEffect"){const D=[...m.layerEffects];if(D[v]&&(D[v]=[...D[v]],D[v][T])){const j={...D[v][T]};j.params={...j.params,[E]:M},D[v][T]=j,m={...m,layerEffects:D}}}else if(S==="global")E==="master_intensity"?m={...m,masterIntensity:M}:E==="master_speed"&&(m={...m,playbackFps:M});else{const D=[...m.clipContents];if(D[v]){D[v]=[...D[v]];const j=D[v][x];if(j)if(S==="effect"&&j.effects&&j.effects[T]){const P=[...j.effects],F={...P[T]};F.params={...F.params,[E]:M},P[T]=F,D[v][x]={...j,effects:P}}else S==="generator"&&(D[v][x]={...j,currentParams:{...j.currentParams,[E]:M}});m.clipContents=D}}}return m}case"TOGGLE_QUICK_BUTTON":{const{index:r}=e.payload,o=!a.quickAssigns.buttons[r].value,c={...a.quickAssigns,buttons:[...a.quickAssigns.buttons]};c.buttons[r]={...c.buttons[r],value:o};let f={...a,quickAssigns:c};const g=c.buttons[r];if(g.link){const{layerIndex:m,colIndex:v,effectIndex:x,targetType:T}=g.link,S=g.link.paramName||g.link.paramId;if(T==="global")S==="blackout"?f.globalBlackout=o:S==="laser_output"&&(f.isWorldOutputActive=o);else if(T==="layer"){if(S==="blackout"){const E=[...f.layerBlackouts];E[m]=o,f={...f,layerBlackouts:E}}else if(S==="solo"){const E=[...f.layerSolos];o?(E.fill(!1),E[m]=!0):E[m]=!1,f={...f,layerSolos:E}}else if(S==="clear"){if(o){const E=[...f.activeClipIndexes];E[m]=null,f={...f,activeClipIndexes:E},c.buttons[r].value=!1,f.quickAssigns=c}}else if(S==="autopilot"){const E=[...f.layerAutopilots];E[m]=o?"forward":"off",f={...f,layerAutopilots:E}}}else if(T==="layerEffect"){const E=[...f.layerEffects];if(E[m]&&(E[m]=[...E[m]],E[m][x])){const M={...E[m][x]};M.params={...M.params,[S]:o},E[m][x]=M,f={...f,layerEffects:E}}}else{const E=[...f.clipContents];if(E[m]){E[m]=[...E[m]];const M=E[m][v];if(M)if(T==="effect"&&M.effects&&M.effects[x]){const D=[...M.effects],j={...D[x]};j.params={...j.params,[S]:o},D[x]=j,E[m][v]={...M,effects:D}}else T==="generator"&&(E[m][v]={...M,currentParams:{...M.currentParams,[S]:o}});f.clipContents=E}}}return f}case"UPDATE_CLIP_FILE_PATH":{const{oldPath:r,newPath:i}=e.payload;console.log(`Reducer: Updating clip path from ${r} to ${i}`);const o=a.clipContents.map(c=>c.map(f=>{let g=f;return f&&f.filePath===r&&(g={...g,filePath:i,parsingFailed:!1}),f&&f.audioFile&&f.audioFile.path===r&&(g={...g,audioFile:{...f.audioFile,path:i}}),g}));return{...a,clipContents:o}}case"SET_CLIP_PARSING_FAILED":{const{layerIndex:r,colIndex:i,failed:o}=e.payload,c=[...a.clipContents];if(c[r]){c[r]=[...c[r]];const f=c[r][i];f&&(c[r][i]={...f,parsingFailed:o})}return{...a,clipContents:c}}default:return a}}const Ec={orange:{full:60,dim:10},yellow:{full:74,dim:15},cyan:{full:36,dim:35},"light-blue":{full:41,dim:43},blue:{full:45,dim:47},magenta:{full:53,dim:55},red:{full:5,dim:7},green:{full:21,dim:23},white:{full:3,dim:1}},CE=({isPlaying:a,globalBlackout:e,layerBlackouts:r,layerSolos:i,isWorldOutputActive:o,clipContents:c,activeClipIndexes:f,theme:g,bpm:m,quickAssigns:v})=>{const{sendFeedback:x,mappings:T,selectedMidiInputId:S,midiInitialized:E}=Oc();return R.useEffect(()=>{if(!S||!E||!a){E&&S&&wc(S,"F#6",0,1);return}let M=!1;const D=6e4/(m||120),j=setInterval(()=>{M=!M,wc(S,"F#6",M?127:0,1)},D/2);return()=>{clearInterval(j),wc(S,"F#6",0,1)}},[a,m,S,E]),R.useEffect(()=>{x("transport_play",a),x("transport_stop",!a)},[a,x]),R.useEffect(()=>{x("comp_blackout",e)},[e,x]),R.useEffect(()=>{x("laser_output",o)},[o,x]),R.useEffect(()=>{r.forEach((M,D)=>{x(`layer_${D}_blackout`,M)})},[r,x]),R.useEffect(()=>{i.forEach((M,D)=>{x(`layer_${D}_solo`,M)})},[i,x]),R.useEffect(()=>{if(!c||!f)return;const M=Ec[g]||Ec.orange;c.forEach((D,j)=>{D.forEach((P,F)=>{const _=`clip_${j}_${F}`;if(T[_]){const L=f[j]===F,I=P!==null&&(P.type==="ilda"||P.type==="generator"),V=P?.triggerStyle||"normal";let $=0,J=null;L?($=M.full,V==="toggle"&&(J=10)):I&&($=M.dim),x(_,$,J)}})})},[c,f,g,T,x]),R.useEffect(()=>{if(!v)return;const M=Ec[g]||Ec.orange;v.buttons.forEach((D,j)=>{x(`quick_btn_${j}`,D.value?M.full:0)})},[v,g,x]),null},Hf=async(a,e,r,i,o=!0)=>{if(!a||!a.points)return null;let c=a;if(o)try{const P=ld(a.points);c={...a,points:P,isTypedArray:!0}}catch(P){console.warn("Failed to optimize points for thumbnail:",P)}let f=c;try{e&&e.length>0&&(f=so(c,e,{progress:0,time:0,effectStates:{},assignedDacs:[]}))}catch(P){console.warn("Failed to apply effects for thumbnail:",P)}const g=128,m=128,v=document.createElement("canvas");v.width=g,v.height=m;const x=v.getContext("2d");x.fillStyle="#000000",x.fillRect(0,0,g,m);const T=f.points,S=f.isTypedArray||T instanceof Float32Array,E=S?T.length/8:T.length;x.lineWidth=1.5,x.lineCap="round";let M=null,D=null,j=!0;for(let P=0;P<E;P++){let F,_,L,I,V,$;if(S){const oe=P*8;F=T[oe],_=T[oe+1],L=T[oe+3],I=T[oe+4],V=T[oe+5],$=T[oe+6]>.5}else{const oe=T[P];F=oe.x,_=oe.y,L=oe.r,I=oe.g,V=oe.b,$=!!oe.blanking}const J=(F+1)*.5*g,ie=(1-(_+1)*.5)*m;if(!$&&!j&&M!==null){x.beginPath(),x.moveTo(M,D),x.lineTo(J,ie);const oe=Math.floor(Math.max(0,Math.min(255,L))),U=Math.floor(Math.max(0,Math.min(255,I))),K=Math.floor(Math.max(0,Math.min(255,V)));x.strokeStyle=`rgb(${oe},${U},${K})`,x.stroke()}M=J,D=ie,j=$}try{const F=await(await new Promise(_=>v.toBlob(_,"image/png"))).arrayBuffer();if(window.electronAPI&&window.electronAPI.saveThumbnail){const _=`thumb_L${r}_C${i}.png`;return await window.electronAPI.saveThumbnail(F,_)}}catch(P){console.error("Error generating/saving thumbnail:",P)}return null},Fm=Yn.memo(({type:a,previewFrameCountRef:e,totalPointsSentRef:r,activeChannelsCountRef:i,lastStatUpdateTimeRef:o})=>{const[c,f]=R.useState({cpu:"0.0",ram:"0",fps:0,pps:0,avgPps:0});return R.useEffect(()=>{const g=window.electronAPI?.onSystemStats(v=>{f(x=>({...x,...v}))});let m;return a==="performance"&&o&&e&&r&&i&&(m=setInterval(()=>{const v=performance.now(),x=(v-(o.current||0))/1e3;if(x>0){const T=Math.round((e.current||0)/x),S=Math.round((r.current||0)/x),E=(i.current||0)>0?Math.round(S/i.current):0;f(M=>({...M,fps:T,pps:S,avgPps:E})),e.current=0,r.current=0,o.current=v}},1e3)),()=>{g&&g(),m&&clearInterval(m)}},[a,e,r,i,o]),a==="system"?d.jsxs("div",{className:"systemStats",children:[d.jsxs("p",{className:"sysStats",children:["CPU: ",c.cpu,"%"]}),d.jsxs("p",{className:"sysStats",children:["RAM: ",c.ram,"MB"]})]}):d.jsxs("div",{className:"performanceStats",children:[d.jsxs("p",{className:"perfStats",children:["FPS: ",c.fps]}),d.jsxs("p",{className:"perfStats",children:["AnimPPS: ",c.avgPps," (Avg)"]})]})}),ME=Yn.memo(({playbackFps:a,previewScanRate:e,previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c})=>d.jsxs("div",{className:"system-monitor-grid",children:[d.jsx(Fm,{type:"performance",previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c}),d.jsx(Fm,{type:"system",previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c})]})),NE=Yn.memo(({clipContents:a,activeClipIndexes:e,layerEffects:r,bpm:i,playbackFps:o,selectedLayerIndex:c,selectedColIndex:f,liveFramesRef:g,progressRef:m,selectedDac:v,liveDacOutputSettingsRef:x,dacOutputSettings:T,getAudioInfo:S,fftLevels:E,getFftLevels:M,effectStatesRef:D,clipActivationTimesRef:j,showBeamEffect:P,beamAlpha:F,fadeAlpha:_,previewScanRate:L,beamRenderMode:I,worldShowBeamEffect:V,worldBeamRenderMode:$,masterIntensity:J,layerIntensities:ie,globalBlackout:oe,layerSolos:U,layerBlackouts:K,handleToggleBeamEffect:Z,handleCycleDisplayMode:W,previewFrameCountRef:re,totalPointsSentRef:Y,activeChannelsCountRef:ee,lastStatUpdateTimeRef:ue,liveClipContentsRef:Ee,optimizationEnabled:q})=>{const[Q,be]=R.useState(0),ke=R.useRef(0),ve=R.useRef(performance.now()),_e=1e3/70;R.useEffect(()=>{let je;const $e=Ie=>{Ie-ke.current>_e&&(re.current++,ve.current=performance.now(),be(nt=>nt+1),ke.current=Ie),je=requestAnimationFrame($e)};return je=requestAnimationFrame($e),()=>cancelAnimationFrame(je)},[_e,re]);const Oe=Ee?.current||a,We=c!==null&&f!==null?Oe[c][f]:null,Ye=f!==null?We?.type==="ilda"?We?.workerId:`generator-${c}-${f}`:c!==null&&e[c]!==null?Oe[c][e[c]]?.type==="ilda"?Oe[c][e[c]]?.workerId:`generator-${c}-${e[c]}`:null,Je=Ye?g.current[Ye]:null,yn=Ye&&m.current[Ye]||0;let _t=[],vn=1;if(c!==null){const je=r[c]||[];if(f!==null)_t=[...We?.effects||[],...je];else{const nt=e[c];nt!==null?_t=[...Oe[c][nt]?.effects||[],...je]:_t=je}const $e=U.some(nt=>nt);let Ie=ie[c];oe?Ie=0:$e?Ie=U[c]?K[c]?0:Ie:0:K[c]&&(Ie=0),vn=Ie*J}const Wt=R.useMemo(()=>{const je={};return e.forEach(($e,Ie)=>{if($e!==null){const nt=Oe[Ie][$e];if(nt){let Ue=nt.type==="ilda"?nt.workerId:`generator-${Ie}-${$e}`;Ue&&g.current[Ue]&&(je[Ue]={frame:g.current[Ue],effects:[...nt.effects||[],...r[Ie]||[]],layerIndex:Ie,syncSettings:nt.syncSettings||{},bpm:i,clipDuration:(()=>{const xe=nt.playbackSettings||{};return xe.mode==="timeline"?xe.duration||1:xe.mode==="bpm"?(xe.beats||8)*60/(i||120):(nt.totalFrames||30)/(nt.fps||o||30)})(),progress:m.current[Ue]||0,effectStates:D.current,clipActivationTime:j.current[Ie]||0})}}}),je},[e,Oe,Q,i,r,o,g,m,D,j]),Kt=R.useMemo(()=>{const je=U.some($e=>$e);return ie.map(($e,Ie)=>oe?0:je?U[Ie]?K[Ie]?0:$e:0:K[Ie]?0:$e)},[ie,K,U,oe]);return d.jsxs("div",{className:"side-panel",children:[d.jsx(Dv,{frame:Je,effects:_t,showBeamEffect:P,beamAlpha:F,fadeAlpha:_,previewScanRate:L,beamRenderMode:I,intensity:vn,syncSettings:We?.syncSettings,bpm:i,clipDuration:(()=>{const je=We?.playbackSettings||{};return je.mode==="timeline"?je.duration||1:je.mode==="bpm"?(je.beats||8)*60/(i||120):(We?.totalFrames||30)/(We?.fps||o||30)})(),progress:yn,previewTime:ve.current,fftLevels:M?M():E,effectStates:D.current,clipActivationTime:c!==null&&j.current[c]||0,optimizationEnabled:q,onToggleBeamEffect:()=>Z("clip"),onCycleDisplayMode:()=>W("clip")}),d.jsx(_v,{activeFrames:Wt,showBeamEffect:V,beamAlpha:F,fadeAlpha:_,previewScanRate:L,beamRenderMode:$,layerIntensities:Kt,masterIntensity:J,dacSettings:v?x.current?x.current[`${v.ip}:${v.channel}`]:T[`${v.ip}:${v.channel}`]:null,previewTime:ve.current,fftLevels:M?M():E,optimizationEnabled:q,onToggleBeamEffect:()=>Z("world"),onCycleDisplayMode:()=>W("world")})]})});function kE(){const a=Wv(),e=Xm(),r=Kv(),{fftLevels:i,getFftLevels:o}=uo()||{},{devices:c,selectedDeviceId:f,setSelectedDeviceId:g,playAudio:m,stopAudio:v,pauseAllAudio:x,resumeAllAudio:T,setPlaybackRate:S,resetAllAudio:E,stopAllAudio:M,getAudioInfo:D,setClipVolume:j}=tg();R.useRef(new Set),R.useRef(0);const P=R.useRef({}),F=R.useRef(new Map),_=R.useRef({}),L=R.useRef({}),I=R.useRef({}),V=R.useRef({}),[$,J]=R.useState(null),[ie,oe]=R.useState(!1),[U,K]=R.useState("main"),[Z,W]=R.useState(!1),[re,Y]=R.useState(!1),[ee,ue]=R.useState({midi:!1,artnet:!1,osc:!1,keyboard:!1}),[Ee,q]=R.useState(!1),[Q,be]=R.useState(!1),[ke,ve]=R.useState(!1),[_e,Oe]=R.useState(!1),[We,Ye]=R.useState({title:"",initialValue:"",onSave:()=>{}}),[Je,yn]=R.useState("files"),[_t,vn]=R.useState("clip"),[Wt,Kt]=R.useState([]),je=R.useRef(0),$e=R.useRef(0),Ie=R.useRef(0),nt=R.useRef(performance.now()),[Ue,xe]=R.useReducer(TE,Kg(ie?$:{})),Ze=R.useRef(new Map),Zt=R.useCallback((p,b,A=30)=>{Ze.current.has(p)&&clearTimeout(Ze.current.get(p));const w=setTimeout(()=>{xe(b),Ze.current.delete(p)},A);Ze.current.set(p,w)},[]),{columns:fn,layers:Et,clipContents:it,clipNames:qn,thumbnailFrameIndexes:Xt,layerEffects:Nn,layerAssignedDacs:dn,layerIntensities:us,layerAutopilots:tr,layerBlackouts:nr,layerSolos:rn,masterIntensity:ar,globalBlackout:bn,selectedLayerIndex:Ve,selectedColIndex:lt,notification:Vs,dacs:Jn,selectedDac:ea,ildaFrames:rr,selectedIldaWorkerId:la,selectedIldaTotalFrames:Pa,showBeamEffect:Sa,beamAlpha:Ea,fadeAlpha:oa,playbackFps:jn,previewScanRate:ca,beamRenderMode:ua,worldShowBeamEffect:fa,worldBeamRenderMode:sn,optimizationEnabled:Gt,activeClipIndexes:Dt,isPlaying:wa,isWorldOutputActive:ot,selectedGeneratorId:Xs,selectedGeneratorParams:Br,thumbnailRenderMode:Aa,theme:sr,dacOutputSettings:Jt}=Ue,xn=R.useMemo(()=>Et.map((p,b)=>{const A=Dt[b];if(A!==null){const w=it[b][A];if(w){let C,N=null;if(w.type==="ilda"&&w.workerId&&w.totalFrames)return C=w.workerId,N=w.stillFrame,{type:"ilda",workerId:C,totalFrames:w.totalFrames,effects:w.effects||[],dac:w.dac||null,assignedDacs:w.assignedDacs||[],ildaFormat:w.ildaFormat||0,stillFrame:N,layerIndex:b,syncSettings:w.syncSettings||{},fps:w.fps||null};if(w.type==="generator"&&w.frames&&w.generatorDefinition)return C=`generator-${b}-${A}`,N=w.stillFrame||w.frames?.[0]||null,{type:"generator",workerId:C,totalFrames:w.frames.length,effects:w.effects||[],dac:w.dac||null,assignedDacs:w.assignedDacs||[],ildaFormat:0,stillFrame:N,layerIndex:b,syncSettings:w.syncSettings||{},fps:w.fps||null}}}return null}).filter(Boolean),[Et,Dt,it]),vt=R.useRef(it),dt=R.useRef(null),Ct=R.useRef(!1),At=R.useRef(null),qe=R.useRef(!1);R.useEffect(()=>{it&&(dt.current=structuredClone(it))},[]),R.useEffect(()=>{Jt&&(At.current=structuredClone(Jt))},[]);const ft=R.useRef(us),da=R.useRef(tr),Ta=R.useRef(Nn),br=R.useRef(ar),en=R.useRef(nr),kn=R.useRef(rn),Ca=R.useRef(bn),ta=R.useRef(wa),Vn=R.useRef(ot),pa=R.useRef(ea),xr=R.useRef(Ue.bpm),Bn=R.useRef(Ve),ha=R.useRef(lt),Ut=R.useRef(null),na=R.useRef(D),Sr=R.useRef(Gt);R.useEffect(()=>{ta.current=wa},[wa]),R.useEffect(()=>{Vn.current=ot},[ot]),R.useEffect(()=>{pa.current=ea},[ea]),R.useEffect(()=>{xr.current=Ue.bpm},[Ue.bpm]),R.useEffect(()=>{Bn.current=Ve},[Ve]),R.useEffect(()=>{ha.current=lt},[lt]),R.useEffect(()=>{na.current=D},[D]),R.useEffect(()=>{Sr.current=Gt},[Gt]);const ln=R.useRef(jn);R.useEffect(()=>{ln.current=jn},[jn]);const Ma=R.useRef(Jt),$s=R.useRef(Jn),Er=R.useRef([]),za=R.useRef(Dt),Fr=R.useRef(dn),wr=R.useRef(qn),Rn=R.useRef(la),Ws=R.useRef(Pa),Zs=R.useRef({}),Na=R.useRef(new Map),Ga=R.useRef(new Map),fs=R.useRef(new Map),Pr=R.useRef(null),ka=R.useRef({}),ma=R.useRef(null),aa=R.useRef(0),Qs=R.useRef(new Map),Ar=R.useRef(new Map),ds=R.useRef(new Map);R.useRef(performance.now()),R.useEffect(()=>{if(Ct.current){Ct.current=!1;return}it&&(dt.current=structuredClone(it))},[it]),R.useEffect(()=>{if(qe.current){qe.current=!1;return}Jt&&(At.current=structuredClone(Jt))},[Jt]),R.useEffect(()=>{ft.current=us,da.current=tr,Ta.current=Nn,br.current=ar,en.current=nr,kn.current=rn,Ca.current=bn,ln.current=jn,$s.current=Jn,Er.current=xn,vt.current=it,za.current=Dt,Fr.current=dn,wr.current=qn,Rn.current=la,Ws.current=Pa},[us,dn,tr,Nn,ar,nr,rn,bn,Jt,Jn,xn,it,Dt,qn,la,Pa]);const cl=R.useCallback(p=>{const b=1-p*2,A=[],w=100;for(let C=0;C<w;C++){const N=C/(w-1)*2-1;A.push({x:N,y:b,r:0,g:255,b:0,blanking:!1})}return{points:A,isTypedArray:!1}},[]),zr=R.useCallback((p,b)=>{At.current&&(At.current[p]=b,qe.current=!0),xe({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:p,settings:b}})},[]),ps=R.useCallback(p=>{xe({type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:p}})},[]);R.useEffect(()=>{const p=jn/60;S(p)},[jn,S]);const tn=p=>{xe({type:"SET_NOTIFICATION",payload:{message:p,visible:!0}}),setTimeout(()=>{xe({type:"SET_NOTIFICATION",payload:{message:"",visible:!1}})},3e3)};R.useEffect(()=>{const p={orange:"#ff5e00",yellow:"#ffd400",cyan:"#00fff3","light-blue":"#0089ff",blue:"#005aff",magenta:"#fb00ff",red:"#ff0000",green:"#00ff00",white:"#ffffff"},b=p[sr]||p.orange;document.documentElement.style.setProperty("--theme-color",b);const A=parseInt(b.slice(1,3),16),w=parseInt(b.slice(3,5),16),C=parseInt(b.slice(5,7),16);document.documentElement.style.setProperty("--theme-color-transparent",`rgba(${A}, ${w}, ${C}, 0.3)`),window.electronAPI&&window.electronAPI.setTheme&&window.electronAPI.setTheme(sr)},[sr]),R.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedDac&&window.electronAPI.setSelectedDac(ea)},[ea]),R.useMemo(()=>{const p=new Set;return la&&p.add(la),xn.forEach(b=>{b&&b.type==="ilda"&&b.workerId&&p.add(b.workerId)}),Array.from(p)},[la,xn]),R.useEffect(()=>{if(!a)return;const p=async G=>{if(!G.data.browserFile){if(G.data.type==="get-frame"&&G.data.success)if(G.data.isStillFrame){const{workerId:ne,frame:ae,layerIndex:le,colIndex:he}=G.data;if(le===void 0||he===void 0)return;let pe=null;const Me=(dt.current?dt.current:vt.current)?.[le]?.[he],we=Me?.effects||[];let Re=null;const Pe=Me?.assignedDacs||[];if(Pe.length>0){const ct=Pe[0],mt=`${ct.ip}:${ct.channel}`;Re=Ma.current[mt]}else if(ea){const ct=`${ea.ip}:${ea.channel}`;Re=Ma.current[ct]}let et=ae;Re&&(et=Vf(ae,Re)),pe=await Hf(et,we,le,he,Gt),xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:le,colIndex:he,content:{stillFrame:ae,parsing:!1,thumbnailPath:pe,thumbnailVersion:Date.now()}}})}else P.current[G.data.workerId]=G.data.frame;else if(G.data.type==="parse-ilda"&&G.data.success){const{workerId:ne,totalFrames:ae,ildaFormat:le,fileName:he,filePath:pe,layerIndex:Se,colIndex:Me}=G.data;if(Se===void 0||Me===void 0)return;const we={type:"ilda",workerId:ne,totalFrames:ae,ildaFormat:le,fileName:he,filePath:pe,parsing:!0,playbackSettings:{mode:"fps",duration:ae/60,beats:8,speedMultiplier:1}};xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:Se,colIndex:Me,content:we}});const Re=wr.current[Se][Me],Pe=`Clip ${Se+1}-${Me+1}`;Re===Pe&&xe({type:"SET_CLIP_NAME",payload:{layerIndex:Se,colIndex:Me,name:he}})}else if(G.data.type==="get-all-frames"&&G.data.success){console.log("Received get-all-frames response:",G.data);const{frames:ne,workerId:ae,layerIndex:le,colIndex:he}=G.data;if(le===void 0||he===void 0)return;j0(async()=>{const{framesToIlda:pe}=await Promise.resolve().then(()=>$0);return{framesToIlda:pe}},void 0,import.meta.url).then(({framesToIlda:pe})=>{const Se=pe(ne),we=vt.current[le][he].fileName||"export.ild";window.electronAPI&&window.electronAPI.saveIldaFile&&window.electronAPI.saveIldaFile(Se,we).then(Re=>{Re.success?tn(`Exported to ${Re.filePath}`):Re.error&&tn(`Export failed: ${Re.error}`)})}).catch(pe=>console.error("Failed to load ilda-writer in response:",pe))}else if(G.data.success===!1){tn(`Worker error: ${G.data.error}`);const{layerIndex:ne,colIndex:ae}=G.data;ne!==void 0&&ae!==void 0&&xe({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:ne,colIndex:ae,status:!1}})}}};a.addEventListener("message",p);let b,A,w=0;const C=60,N=1e3/C,O=G=>{if(G.length===0)return null;if(G.length===1){const he=G[0],pe=he.points instanceof Float32Array||he.isTypedArray;return{...he,points:pe?new Float32Array(he.points):he.points.map(Se=>({...Se})),isTypedArray:pe}}let ne=0;G.forEach((he,pe)=>{const Me=he.points instanceof Float32Array||he.isTypedArray?he.points.length/8:he.points.length;ne+=Me,pe<G.length-1&&(ne+=2)});const ae=new Float32Array(ne*8);let le=0;return G.forEach((he,pe)=>{const Se=he.points instanceof Float32Array||he.isTypedArray,Me=Se?he.points.length/8:he.points.length;for(let we=0;we<Me;we++){const Re=(le+we)*8;if(Se){const Pe=we*8;ae.set(he.points.subarray(Pe,Pe+8),Re)}else{const Pe=he.points[we];ae[Re]=Pe.x,ae[Re+1]=Pe.y,ae[Re+2]=Pe.z||0,ae[Re+3]=Pe.r,ae[Re+4]=Pe.g,ae[Re+5]=Pe.b,ae[Re+6]=Pe.blanking?1:0,ae[Re+7]=Pe.lastPoint?1:0}ae[Re+7]=0}if(le+=Me,pe<G.length-1){const we=G[pe+1],Re=we.points instanceof Float32Array||we.isTypedArray,Pe=ae[(le-1)*8],et=ae[(le-1)*8+1];let ct,mt;Re?(ct=we.points[0],mt=we.points[1]):(ct=we.points[0].x,mt=we.points[0].y);let ht=le*8;ae[ht]=Pe,ae[ht+1]=et,ae[ht+6]=1,ae[ht+3]=0,ae[ht+4]=0,ae[ht+5]=0;let st=(le+1)*8;ae[st]=ct,ae[st+1]=mt,ae[st+6]=1,ae[st+3]=0,ae[st+4]=0,ae[st+5]=0,le+=2}}),ae[(ne-1)*8+7]=1,{points:ae,isTypedArray:!0}},X=G=>{if(!Vn.current){cancelAnimationFrame(A);return}if(G-w>N){if(window.electronAPI&&Vn.current){const ne=new Map;Er.current.forEach(le=>{if(le&&P.current[le.workerId]){const he=Fr.current[le.layerIndex]||[],pe=le.assignedDacs||[];let Se=[...he,...pe];Se.length===0&&pa.current&&(Se=[pa.current]);const Me=[],we=new Set;if(Se.forEach(ut=>{const ga=ut.channel!==void 0?ut.channel:ut.channels&&ut.channels.length>0?ut.channels[0].serviceID:0,Wn=`${ut.ip}:${ga}`;we.has(Wn)||(we.add(Wn),Me.push({...ut,channel:ga}))}),Me.length===0)return;const Pe=(dt.current||vt.current)[le.layerIndex][za.current[le.layerIndex]],et=Pe?Pe.effects||[]:le.effects||[],ct=le.layerIndex,mt=Ta.current[ct]||[],ht=[...et,...mt],st=P.current[le.workerId],Tn=ft.current[le.layerIndex],Ot=Ca.current,Nt=en.current[le.layerIndex],wt=kn.current[le.layerIndex],Mt=kn.current.some(ut=>ut);let nn=Tn;Ot?nn=0:Mt?wt?Nt&&(nn=0):nn=0:Nt&&(nn=0);const Ht=nn*br.current;if(Ht<=0)return;const gt=_.current[le.workerId]||0;le.syncSettings;const Yt={...st,points:z(st.points)?st.points:st.points.map(ut=>({...ut,r:Math.round(ut.r*Ht),g:Math.round(ut.g*Ht),b:Math.round(ut.b*Ht)}))};if(z(Yt.points)){const ut=Yt.points,ga=ut.length/8,Wn=new Float32Array(ut);for(let ya=0;ya<ga;ya++)Wn[ya*8+3]*=Ht,Wn[ya*8+4]*=Ht,Wn[ya*8+5]*=Ht;Yt.points=Wn}const Pn=Pe?Pe.playbackSettings:le.playbackSettings||{};let Xa=1;if(Pn.mode==="timeline")Xa=Pn.duration||1;else if(Pn.mode==="bpm"){const ut=xr.current||120;Xa=(Pn.beats||8)*60/ut}else{const ut=Pn.fps||le.fps||ln.current||30;Xa=(le.totalFrames||30)/ut}const Nr=Pn.speedMultiplier||1;Nr!==0&&(Xa/=Nr);const pn=so(Yt,ht,{progress:gt,time:G,effectStates:F.current,assignedDacs:Me,syncSettings:le.syncSettings||{},bpm:xr.current,clipDuration:Xa,fftLevels:o?o():i});if(Sr.current){const ut=ld(pn.points);pn.points=ut,pn.isTypedArray=!0}Me.forEach((ut,ga)=>{const Wn=ut.ip,ya=ut.channel||(ut.channels&&ut.channels.length>0?ut.channels[0].serviceID:0);if(ya!==void 0){const Ti=`${Wn}:${ya}`;ne.has(Ti)||ne.set(Ti,{ip:Wn,channel:ya,type:ut.type,frames:[]});let Xr=pn;if(pn.points&&pn.points._channelDistributions){const or=pn.points._channelDistributions.get(ga);if(or){const ei=pn.points.subarray(or.start,or.start+or.length);Xr={...pn,points:ei}}else Xr={...pn,points:new Float32Array(0)}}if(ut.mirrorX||ut.mirrorY){const or=Xr.points,ei=Xr.isTypedArray,Uc=ei?or.length/8:or.length,cr=ei?new Float32Array(or):or.map(qt=>({...qt}));for(let qt=0;qt<Uc;qt++)ei?(ut.mirrorX&&(cr[qt*8]=-cr[qt*8]),ut.mirrorY&&(cr[qt*8+1]=-cr[qt*8+1])):(ut.mirrorX&&(cr[qt].x=-cr[qt].x),ut.mirrorY&&(cr[qt].y=-cr[qt].y));Xr={...Xr,points:cr}}ne.get(Ti).frames.push(Xr)}})}}),$s.current.forEach(le=>{(le.channels&&le.channels.length>0?le.channels.map(pe=>pe.serviceID):[0]).forEach(pe=>{const Se=`${le.ip}:${pe}`,Me=At.current?At.current[Se]:Ma.current[Se];if(Me){ne.has(Se)||ne.set(Se,{ip:le.ip,channel:pe,type:le.type,frames:[]});const we=ne.get(Se);if(Me.testLineEnabled){const Re=cl(Me.testLineY!==void 0?Me.testLineY:.5);we.frames=[Re]}}})});let ae=0;ne.forEach(le=>{let he=O(le.frames);const pe=`${le.ip}:${le.channel}`,Se=At.current?At.current[pe]:Ma.current[pe];if(he&&Se){if(Se.dimmer!==void 0&&Se.dimmer<1){const Me=Se.dimmer,we=he.points,Re=he.isTypedArray,Pe=Re?we.length/8:we.length;for(let et=0;et<Pe;et++)Re?(we[et*8+3]*=Me,we[et*8+4]*=Me,we[et*8+5]*=Me):(we[et].r*=Me,we[et].g*=Me,we[et].b*=Me)}he=Vf(he,Se,!1)}if(he){ae++;const Me=z(he.points)?he.points.length/8:he.points.length;$e.current+=Me,window.electronAPI.sendFrame(le.ip,le.channel,he.points,C,le.type,{skipOptimization:!Sr.current})}}),Ie.current=ae}w=G}A=requestAnimationFrame(X)};function z(G){return!!G&&(G instanceof Float32Array||G.buffer instanceof ArrayBuffer)}const H=G=>{const ne=1e3/ln.current,ae=xr.current||120,le=(pe,Se,Me,we)=>{I.current[we]||(I.current[we]=G);let Re=G-I.current[we];Re>1e3&&(Re=ne),ta.current&&(ka.current[we]===void 0&&(ka.current[we]=0),ka.current[we]+=Re);const Pe=ka.current[we]||0,et=za.current[Se]!==null?na.current(Se):null;let ct=V.current[we]||0,mt=0;const ht=pe.totalFrames||1,st=pe.playbackSettings||{mode:"fps",duration:ht/60,beats:8,speedMultiplier:1};if(et&&ta.current&&!et.paused)mt=et.duration>0?et.currentTime/et.duration:0,ct=Math.floor(mt*ht);else if(st.mode==="timeline"){const wt=st.duration*1e3/(st.speedMultiplier||1);wt>0&&(mt=Pe/wt%1,ct=Math.floor(mt*ht))}else if(st.mode==="bpm"){const wt=6e4/ae,Mt=st.beats*wt/(st.speedMultiplier||1);Mt>0&&(mt=Pe/Mt%1,ct=Math.floor(mt*ht))}else{const Mt=1e3/((st.fps||60)*(st.speedMultiplier||1));if(Re>=Mt){const nn=Math.floor(Re/Mt);ta.current?(I.current[we]=G-Re%Mt,ct=ct+nn):I.current[we]=G,mt=ht>0?ct%ht/ht:0}else return}st.mode!=="fps"&&(I.current[we]=G),isNaN(ct)&&(ct=0),isNaN(mt)&&(mt=0);const Ot=(Zs.current[we]||0)>.9&&mt<.1;if(Zs.current[we]=mt,_.current[we]=mt,ht>0&&(ct=ct%ht,ct<0&&(ct+=ht)),Ot&&ta.current){const wt=da.current[Se];if(wt&&wt!=="off"){const Mt=vt.current[Se],nn=za.current[Se];let Ht=-1;if(wt==="forward")for(let gt=1;gt<Mt.length;gt++){const Yt=(nn+gt)%Mt.length,Pn=Mt[Yt];if(Pn&&(Pn.type==="ilda"||Pn.type==="generator")){Ht=Yt;break}}else if(wt==="random"){const gt=Mt.map((Yt,Pn)=>Yt&&(Yt.type==="ilda"||Yt.type==="generator")?Pn:-1).filter(Yt=>Yt!==-1);if(gt.length>0){const Yt=Math.floor(Math.random()*gt.length);Ht=gt[Yt],Ht===nn&&gt.length>1&&(Ht=gt[(Yt+1)%gt.length])}}Ht!==-1&&Ht!==nn&&setTimeout(()=>{Va(Se,Ht)},0)}}let Nt=1;if(st.mode==="timeline"?Nt=st.duration||1:st.mode==="bpm"?Nt=(st.beats||8)*60/ae:pe.type==="generator"&&(!pe.frames||pe.frames.length<=1)?Nt=st.duration||1:Nt=ht/(st.fps||60),pe.type==="generator"){const wt=pe.syncSettings||{},Mt=pe.generatorDefinition?.id,nn=pe.generatorDefinition,Ht=Object.keys(wt).filter(gt=>gt.startsWith(`${Mt}.`));if(Ht.length>0){const gt=pe.currentParams||{},Yt={...gt};let Pn=!1;const Xa={time:G,progress:mt,bpm:ae,clipDuration:Nt,fftLevels:o?o():i,activationTime:L.current[Se]||0};for(const Nr of Ht){const pn=Nr.split(".")[1],ut=nn?.paramControls?.find(ya=>ya.id===pn),ga=gt[pn]!==void 0?gt[pn]:pe.generatorDefinition.defaultParams[pn],Wn=Cc(pn,ga,wt[Nr],Xa,ut?.min,ut?.max);Wn!==Yt[pn]&&(Yt[pn]=Wn,Pn=!0)}if(Pn){const Nr=++aa.current;Dn(Se,Me,pe.generatorDefinition,Yt,Nr,!0)}}}(V.current[we]!==ct||!P.current[we])&&(V.current[we]=ct,pe.type==="ilda"?a.postMessage({type:"get-frame",workerId:we,frameIndex:ct}):pe.type==="generator"&&(pe.frames&&pe.frames.length>1?pe.frames[ct%pe.frames.length]&&(P.current[we]=pe.frames[ct%pe.frames.length]):!P.current[we]&&pe.frames&&pe.frames.length>0&&(P.current[we]=pe.frames[0])))};Et.forEach((pe,Se)=>{const Me=za.current[Se];if(Me===null)return;const Re=(dt.current||vt.current)[Se][Me];if(!Re)return;let Pe=Re.type==="ilda"?Re.workerId:Re.type==="generator"?`generator-${Se}-${Me}`:null;Pe&&le(Re,Se,Me,Pe)});const he=Rn.current;if(he&&!Er.current.some(pe=>pe.workerId===he)){const pe=Bn.current,Se=ha.current;if(pe!==null&&Se!==null){const we=(dt.current||vt.current)[pe][Se];we&&le(we,pe,Se,he)}}if(ma.current){const{layerIndex:pe,colIndex:Se}=ma.current,Me=za.current[pe]===Se;Bn.current===pe&&ha.current;const we=Rn.current;if(!Me){const Pe=(dt.current||vt.current)[pe]?.[Se];if(Pe){let et=Pe.type==="ilda"?Pe.workerId:Pe.type==="generator"?`generator-${pe}-${Se}`:null;et&&et!==we&&le(Pe,pe,Se,et)}}}b=requestAnimationFrame(H)};return b=requestAnimationFrame(H),ot?A=requestAnimationFrame(X):cancelAnimationFrame(A),()=>{a.removeEventListener("message",p),cancelAnimationFrame(b),cancelAnimationFrame(A)}},[a,ot]),R.useEffect(()=>{let p,b,A;return window.electronAPI&&(p=window.electronAPI.onClipContextMenuCommand((w,C,N)=>{if(console.log(`Clip context menu command received: ${w} for ${C}-${N}`),w==="export-ilda"){const O=vt.current[C][N];console.log("Exporting clip:",O),O&&(O.type==="ilda"&&O.workerId&&a?(tn("Preparing ILDA export..."),console.log("Requesting frames from worker:",O.workerId),a.postMessage({type:"get-all-frames",workerId:O.workerId,layerIndex:C,colIndex:N})):O.type==="generator"?(console.log("Exporting generator frames with parameter animation..."),(async()=>{const{framesToIlda:z}=await j0(async()=>{const{framesToIlda:Re}=await Promise.resolve().then(()=>$0);return{framesToIlda:Re}},void 0,import.meta.url),H=jn||60;let G=2;const ne=O.playbackSettings||{};ne.mode==="timeline"?G=ne.duration||2:ne.mode==="bpm"?G=(ne.beats||8)*60/(Ue.bpm||120):O.frames?.length>1&&(G=O.frames.length/H);const ae=Math.ceil(G*H),le=[],he=new Map,pe=O.generatorDefinition?.id;let Se=null;if(["text","spout-receiver"].includes(pe)){const Re=O.currentParams?.fontUrl||"src/fonts/Geometr415 Blk BT Black.ttf";try{Re.startsWith("http")?Se=await window.electronAPI.fetchUrlAsArrayBuffer(Re):Se=await window.electronAPI.readFileForWorker(Re)}catch(Pe){console.error("Failed to load font for export:",Pe)}}for(let Re=0;Re<ae;Re++){const Pe=Re*(1e3/H),et=Re/ae,ct=O.syncSettings||{},mt=O.generatorDefinition,ht=O.currentParams||{},st={...ht},Tn={time:Pe,progress:et,bpm:Ue.bpm,clipDuration:G,fftLevels:{low:0,mid:0,high:0},activationTime:0};for(const Nt in ct)if(Nt.startsWith(`${pe}.`)){const wt=Nt.split(".")[1],Mt=mt?.paramControls?.find(Ht=>Ht.id===wt),nn=ht[wt]!==void 0?ht[wt]:mt.defaultParams[wt];st[wt]=Cc(wt,nn,ct[Nt],Tn,Mt?.min,Mt?.max)}let Ot=null;try{if(pe==="circle")Ot=Lm(st);else if(pe==="square")Ot=Um(st);else if(pe==="line")Ot=jm(st);else if(pe==="star")Ot=Bm(st);else if(pe==="text")Ot=await Im(st,Se);else if(pe==="spout-receiver")Ot=await Im({...st,text:st.sourceName},Se);else if(O.frames){const Nt=Math.floor(et*O.frames.length)%O.frames.length;Ot=O.frames[Nt]}}catch(Nt){console.error("Generation failed during export:",Nt)}if(Ot){const Nt=(O.effects||[]).filter(gt=>!((gt.id==="delay"||gt.id==="chase")&&gt.params?.mode==="channel")),wt=so(Ot,Nt,{time:Pe,progress:et,effectStates:he,syncSettings:O.syncSettings||{},bpm:Ue.bpm,clipDuration:G,assignedDacs:O.assignedDacs||[]}),Mt=wt.points,nn=Mt.length/8,Ht=[];for(let gt=0;gt<nn;gt++)Ht.push({x:Mt[gt*8],y:Mt[gt*8+1],z:Mt[gt*8+2],r:Mt[gt*8+3],g:Mt[gt*8+4],b:Mt[gt*8+5],blanking:Mt[gt*8+6]>.5,lastPoint:Mt[gt*8+7]>.5});le.push({...wt,points:Ht,frameName:`Frame ${Re}`,companyName:"TrueLazer"})}}const Me=z(le),we=`${O.generatorDefinition?.name||"generator"}_export.ild`;if(window.electronAPI&&window.electronAPI.saveIldaFile){const Re=await window.electronAPI.saveIldaFile(Me,we);Re.success?tn(`Exported to ${Re.filePath}`):Re.error&&tn(`Export failed: ${Re.error}`)}})().catch(z=>console.error("Failed to export generator:",z))):(console.warn("Clip type not supported for export or missing data:",O.type,O),O.type==="ilda"&&!O.workerId?tn("Clip data not loaded. Please play the clip to load it."):O.type==="generator"&&!O.frames&&tn("Generator not rendered yet.")))}else if(w==="update-thumbnail"){const O=it[C][N];if(O){if(O.type==="ilda"&&O.workerId&&a){const X=V.current[O.workerId]||0;a.postMessage({type:"get-frame",workerId:O.workerId,frameIndex:X,isStillFrame:!0,layerIndex:C,colIndex:N})}else if(O.type==="generator"&&O.generatorDefinition){const X=V.current[`generator-${C}-${N}`]||0,z=O.frames?.[X%O.frames.length];if(z){const H=O.effects||[];Hf(z,H,C,N,Gt).then(G=>{xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:C,colIndex:N,content:{stillFrame:z,thumbnailPath:G,thumbnailVersion:Date.now()}}})})}}}}else if(w==="clear-clip")xe({type:"CLEAR_CLIP",payload:{layerIndex:C,colIndex:N}});else if(w==="rename-clip"){const O=wr.current[C][N];Ye({title:"Rename Clip",initialValue:O,onSave:X=>xe({type:"SET_CLIP_NAME",payload:{layerIndex:C,colIndex:N,name:X}})}),q(!0)}else if(w==="copy-clip"){const O={content:vt.current[C][N],name:wr.current[C][N]};xe({type:"SET_CLIPBOARD",payload:O}),tn("Clip copied.")}else if(w==="cut-clip"){const O={content:vt.current[C][N],name:wr.current[C][N]};xe({type:"SET_CLIPBOARD",payload:O}),xe({type:"CLEAR_CLIP",payload:{layerIndex:C,colIndex:N}}),tn("Clip cut.")}else if(w==="paste-clip")if(Ue.clipClipboard){const{content:O,name:X}=Ue.clipClipboard;let z=JSON.parse(JSON.stringify(O));if(z.type==="ilda"&&(z.workerId=null),z.effects&&z.effects.length>0){const G={...z.syncSettings||{}};z.effects=z.effects.map(ne=>{const ae=ne.instanceId,le=ao();return Object.keys(G).forEach(he=>{if(ae&&he.startsWith(`${ae}.`)){const pe=he.substring(ae.length);G[`${le}${pe}`]=G[he],delete G[he]}}),{...ne,instanceId:le}}),z.syncSettings=G}xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:C,colIndex:N,content:z}}),xe({type:"SET_CLIP_NAME",payload:{layerIndex:C,colIndex:N,name:X}}),tn("Clip pasted."),setTimeout(()=>{const H=z;if(H.type==="generator"&&H.generatorDefinition){const G=`${C}-${N}`,ne={...H.generatorDefinition.defaultParams,...H.currentParams};Na.current.set(G,JSON.stringify(ne));const ae=++aa.current;Dn(C,N,H.generatorDefinition,H.currentParams,ae)}},100)}else tn("Clipboard is empty.");else w==="set-trigger-style-normal"?xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:C,colIndex:N,style:"normal"}}):w==="set-trigger-style-toggle"?xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:C,colIndex:N,style:"toggle"}}):w==="set-trigger-style-flash"&&xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:C,colIndex:N,style:"flash"}})}),b=window.electronAPI.onLayerFullContextMenuCommand((w,C)=>{if(console.log(`Layer context menu command received: ${w} for ${C}`),w==="layer-rename"){const N=Et[C];Ye({title:"Rename Layer",initialValue:N,onSave:O=>xe({type:"SET_LAYER_NAME",payload:{index:C,name:O}})}),q(!0)}else w==="layer-clear-clips"&&xe({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:C}})}),A=window.electronAPI.onContextMenuActionFromMain(w=>{if(console.log("General context menu action received:",w),w.type==="rename-column"){const C=fn[w.index];Ye({title:"Rename Column",initialValue:C,onSave:N=>xe({type:"SET_COLUMN_NAME",payload:{index:w.index,name:N}})}),q(!0)}else if(w.type==="rename-layer"){const C=Et[w.index];Ye({title:"Rename Layer",initialValue:C,onSave:N=>xe({type:"SET_LAYER_NAME",payload:{index:w.index,name:N}})}),q(!0)}else if(w.type==="reset-quick-assign"){const C=w.controlType==="knob"?0:!1;xe({type:"UPDATE_QUICK_CONTROL",payload:{type:w.controlType,index:w.index,value:C}})}else w.type==="clear-quick-assign"&&xe({type:"CLEAR_QUICK_CONTROL",payload:{type:w.controlType,index:w.index}})})),()=>{p&&p(),b&&b(),A&&A()}},[it,qn,Et,fn,a,r,Ue.clipClipboard]);const ir=R.useRef(Xt);R.useEffect(()=>{for(let p=0;p<Et.length;p++)for(let b=0;b<fn.length;b++){const A=Xt[p][b],w=ir.current[p][b],C=it[p][b],N=C?.workerId,O=Ga.current.get(`${p}-${b}`),X=A!==w;(X||N&&!O)&&C&&C.type==="ilda"&&N&&(console.log(`[App.jsx] Fetching still frame for ${p}-${b} at index ${A}. Reason: ${X?"index change":"worker ready"}`),a.postMessage({type:"get-frame",workerId:N,frameIndex:A,isStillFrame:!0,layerIndex:p,colIndex:b})),N?Ga.current.set(`${p}-${b}`,N):Ga.current.delete(`${p}-${b}`)}ir.current=Xt},[Xt,it,Et.length,fn.length,a]),R.useEffect(()=>{r&&it.forEach((p,b)=>{p.forEach((A,w)=>{if(A&&A.type==="generator"&&A.generatorDefinition){if(A.generatorDefinition.id==="ndi-source")return;const C=`${b}-${w}`,N={...A.generatorDefinition.defaultParams,...A.currentParams||{}},O=JSON.stringify(N);if(Na.current.get(C)!==O){console.log(`[App.jsx] Generator ${C} params changed, regenerating...`);const X=++aa.current;Dn(b,w,A.generatorDefinition,A.currentParams,X),Na.current.set(C,O)}}})})},[it,r]),R.useEffect(()=>{if(!Ue.projectLoadTimestamp||!a||!r)return;console.log("Project loaded, regenerating content...");const p=[];it.forEach((b,A)=>{b.forEach((w,C)=>{if(w){if(w.type==="ilda"&&w.filePath&&!w.workerId)console.log(`Reparsing ILDA file for clip ${A}-${C}: ${w.filePath}`),a.postMessage({type:"load-and-parse-ilda",fileName:w.fileName,filePath:w.filePath,layerIndex:A,colIndex:C});else if(w.type==="generator"&&w.generatorDefinition){console.log(`Regenerating generator clip ${A}-${C} on project load`);const N=++aa.current;Dn(A,C,w.generatorDefinition,w.currentParams,N)}w.audioFile&&w.audioFile.path&&window.electronAPI&&window.electronAPI.checkFileExists&&p.push(window.electronAPI.checkFileExists(w.audioFile.path).then(N=>{N||Kt(O=>{const X=`audio-${A}-${C}`;return O.some(z=>z.requestId===X)?O:[...O,{filePath:w.audioFile.path,fileName:w.audioFile.name||w.audioFile.path.split(/[/\\]/).pop(),requestId:X,type:"audio"}]})}))}})})},[Ue.projectLoadTimestamp,a,r]),R.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onUpdateThumbnailRenderMode){const p=window.electronAPI.onUpdateThumbnailRenderMode(b=>{console.log("App.jsx: Received thumbnail mode update:",b),xe({type:"SET_THUMBNAIL_RENDER_MODE",payload:b})});return()=>p()}},[]);const ra=R.useRef(Ue);R.useEffect(()=>{ra.current=Ue},[Ue]),R.useEffect(()=>{let p,b,A,w,C;return window.electronAPI&&(p=window.electronAPI.on("new-project",()=>xe({type:"RESET_STATE"})),b=window.electronAPI.on("open-project",()=>{}),A=window.electronAPI.on("save-project",()=>{console.log("Saving project with state:",ra.current),window.electronAPI.send("save-project",ra.current)}),w=window.electronAPI.on("save-project-as",()=>{console.log("Saving project AS with state:",ra.current),window.electronAPI.send("save-project-as",ra.current)}),C=window.electronAPI.on("load-project-data",N=>{xe({type:"LOAD_PROJECT",payload:N})})),()=>{p&&p(),b&&b(),A&&A(),w&&w(),C&&C()}},[]),R.useEffect(()=>{let p,b;return(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const w=await window.electronAPI.getAllSettings();w&&(w.shortcutsState&&ue(w.shortcutsState),xe({type:"LOAD_SETTINGS",payload:w}))}})(),window.electronAPI&&(p=window.electronAPI.onMenuAction(w=>{if(console.log("Menu action received:",w),w==="output-settings")be(!0);else if(w==="shapeBuilder")K("shapeBuilder"),xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(w==="timeline")K("timeline"),xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(w==="about")W(!0);else if(w==="settings-audio-output")ve(!0);else if(w==="settings-audio-fft")Oe(!0);else if(w.startsWith("set-theme-")){const C=w.split("set-theme-")[1];xe({type:"SET_THEME",payload:C})}else if(w==="shortcuts-window"||w.startsWith("open-")&&w.endsWith("-settings"))Y(!0);else if(w==="column-duplicate")lt!==null&&(xe({type:"DUPLICATE_COLUMN",payload:{index:lt}}),tn("Column duplicated."));else if(w==="column-clear-clips")lt!==null&&Et.forEach((C,N)=>{xe({type:"CLEAR_CLIP",payload:{layerIndex:N,colIndex:lt}})});else if(w.startsWith("toggle-")){const C=w.split("-");if(C.length===3){const N=C[1],O=C[2]==="true";ue(X=>({...X,[N]:O}))}}}),b=window.electronAPI.onRenderSettingsCommand(w=>{console.log("Render settings command received:",w),xe({type:"SET_RENDER_SETTING",payload:{setting:w.setting,value:w.value}})})),()=>{p&&p(),b&&b()}},[]),R.useEffect(()=>{if(!a)return;const p=async b=>{if(b.data.type==="request-file-content"){const{filePath:A,requestId:w,maxBytes:C}=b.data;try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(A))throw new Error(`File not found: ${A}`);const N=await window.electronAPI.readFileForWorker(A,C);a.postMessage({type:"file-content-response",requestId:w,arrayBuffer:N},[N])}catch(N){console.warn(`File missing or read error: ${A}`,N.message);const O=A.split(/[/\\]/).pop();Kt(X=>X.some(z=>z.requestId===w)?X:[...X,{filePath:A,fileName:O,requestId:w}])}}else if(b.data.type==="parsing-status"){const{layerIndex:A,colIndex:w,status:C}=b.data;A!==void 0&&w!==void 0&&(xe({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:A,colIndex:w,status:C}}),C||xe({type:"SET_CLIP_PARSING_FAILED",payload:{layerIndex:A,colIndex:w,failed:!0}}))}};return a.addEventListener("message",p),()=>{a.removeEventListener("message",p)}},[a]),R.useEffect(()=>{if(!e)return;const p=async b=>{if(b.data.type==="request-file-content"){const{filePath:A,requestId:w,maxBytes:C}=b.data;try{const N=await window.electronAPI.readFileForWorker(A,C);e.postMessage({type:"file-content-response",requestId:w,arrayBuffer:N},[N])}catch(N){console.error(`Thumbnail Worker: Error reading file: ${A}`,N),e.postMessage({type:"file-content-response",requestId:w,error:N.message})}}};return e.addEventListener("message",p),()=>{e.removeEventListener("message",p)}},[e]),R.useEffect(()=>{if(!a)return;const p=[];it.forEach((b,A)=>{b.forEach((w,C)=>{w&&w.type==="ilda"&&w.filePath&&!w.workerId&&!w.parsing&&!w.parsingFailed&&p.push({layerIndex:A,colIndex:C,fileName:w.fileName,filePath:w.filePath})})}),p.length>0&&(console.log(`Triggering re-parse for ${p.length} clips.`),xe({type:"SET_BULK_PARSING_STATUS",payload:p.map(b=>({layerIndex:b.layerIndex,colIndex:b.colIndex,status:!0}))}),p.forEach(b=>{a.postMessage({type:"load-and-parse-ilda",fileName:b.fileName,filePath:b.filePath,layerIndex:b.layerIndex,colIndex:b.colIndex})}))},[it,a]);const Ks=dt.current||it;if(Ve!==null){const p=Nn[Ve]||[];if(lt!==null)[...Ks[Ve][lt]?.effects||[],...p];else{const b=Dt[Ve];b!==null&&[...Ks[Ve][b]?.effects||[],...p]}}const Js=R.useCallback((p,b,A,w,C)=>{if(dt.current&&dt.current[p]&&dt.current[p][b]){const N=dt.current[p][b];N&&N.effects&&N.effects[A]&&(N.effects[A].params[w]=C,Ct.current=!0)}Zt(`effect-${p}-${b}-${A}-${w}`,{type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:p,colIndex:b,effectIndex:A,paramName:w,newValue:C}})},[Zt]);R.useEffect(()=>{if(!r)return;const p=b=>{if(!b.data.browserFile){if(b.data.layerIndex!==void 0&&b.data.colIndex!==void 0){const A=`${b.data.layerIndex}-${b.data.colIndex}`;if(Ar.current.set(A,!1),ds.current.has(A)){const{message:w,transferables:C}=ds.current.get(A);ds.current.delete(A),Ar.current.set(A,!0),r.postMessage(w,C)}}if(b.data.success){const{layerIndex:A,colIndex:w,frames:C,generatorDefinition:N,currentParams:O,isLive:X,isAutoUpdate:z,seq:H}=b.data;if(A===void 0||w===void 0)return;if(H!==void 0){const ne=`${A}-${w}`,ae=Qs.current.get(ne)||0;if(H<ae){console.log(`[App.jsx] Discarding stale response: seq ${H} < ${ae}`);return}Qs.current.set(ne,H)}const G=`generator-${A}-${w}`;if(P.current[G]=C[0],!X&&!z&&H===aa.current){const ne=vt.current[A][w]||{},ae={...ne,type:"generator",generatorDefinition:N,frames:C,stillFrame:C[0],currentParams:O,playbackSettings:ne.playbackSettings||{mode:"fps",duration:C.length/60,beats:8,speedMultiplier:1}};xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:A,colIndex:w,content:ae}});const le=wr.current[A][w],he=`Clip ${A+1}-${w+1}`;le===he&&xe({type:"SET_CLIP_NAME",payload:{layerIndex:A,colIndex:w,name:N.name}})}else b.data.isNdi&&window.electronAPI&&window.electronAPI.ndiRendererReady&&window.electronAPI.ndiRendererReady()}else tn(`Error generating frames: ${b.data.error}`)}};return r.addEventListener("message",p),()=>{r.removeEventListener("message",p)}},[r]);const Ei=R.useCallback((p,b,A)=>{if(r){const w=`${p}-${b}`,C={...A.defaultParams};Na.current.set(w,JSON.stringify(C));const N=++aa.current;Dn(p,b,A,A.defaultParams,N)}},[r]),Gr=(p,b)=>{try{switch(p){case"circle":return Lm(b);case"square":return Um(b);case"line":return jm(b);case"star":return Bm(b);case"sinewave":return EE(b);default:return null}}catch(A){return console.error(`Error in synchronous live generation for ${p}:`,A),null}},Dn=async(p,b,A,w,C,N=!1,O=!1)=>{const X={...A.defaultParams,...w},z=`${p}-${b}`;let H=null;if(["text","ndi-source","spout-receiver"].includes(A.id)){const ae="src/fonts/Geometr415 Blk BT Black.ttf";let le=X.fontUrl||ae;if(["https://raw.githubusercontent.com/google/fonts/main/ofl/roboto/Roboto-Regular.ttf","https://raw.githubusercontent.com/googlefonts/roboto-2/main/src/hinted/Roboto-Regular.ttf"].includes(le)&&(le=ae),fs.current.has(le))H=fs.current.get(le);else try{if(le.startsWith("http"))if(window.electronAPI&&window.electronAPI.fetchUrlAsArrayBuffer)H=await window.electronAPI.fetchUrlAsArrayBuffer(le);else throw new Error("URL fetching API is not available.");else if(window.electronAPI&&window.electronAPI.readFileForWorker)H=await window.electronAPI.readFileForWorker(le);else throw new Error("File reading API is not available.");H&&fs.current.set(le,H)}catch(pe){console.error(`Failed to load font for text generator at ${p}-${b}:`,pe),tn(`Font error: ${pe.message}`);return}}const G={type:"generate",layerIndex:p,colIndex:b,generator:A,params:X,fontBuffer:H,seq:C,isAutoUpdate:N,isLive:O},ne=[];Ar.current.get(z)?(console.log(`[App.jsx] Generator ${z} busy, queuing seq ${C}`),ds.current.set(z,{message:G,transferables:ne})):(Ar.current.set(z,!0),r&&r.postMessage(G,ne))},sa=R.useCallback(p=>{v(p),xe({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:p}})},[v]),Xn=R.useCallback(()=>{M(),xe({type:"CLEAR_ALL_ACTIVE_CLIPS"})},[M]),Fn=R.useCallback(()=>{T(),Et.forEach((p,b)=>{const A=Dt[b];if(A!==null){const w=it[b][A];w&&w.audioFile&&!D(b)&&m(b,w.audioFile.path,w.audioVolume??1,!0)}}),xe({type:"SET_IS_PLAYING",payload:!0}),xe({type:"SET_IS_STOPPED",payload:!1})},[T,Et,Dt,it,D,m]),Ha=R.useCallback(()=>{x(),xe({type:"SET_IS_PLAYING",payload:!1}),xe({type:"SET_IS_STOPPED",payload:!1})},[x]),Ya=R.useCallback(()=>{E(),x(),xe({type:"SET_IS_PLAYING",payload:!1}),xe({type:"SET_IS_STOPPED",payload:!0}),V.current={}},[E,x]),hs=R.useCallback(()=>{const p=!ot;xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:p}),window.electronAPI&&(p?Ue.dacs.forEach(b=>{window.electronAPI.startDacOutput(b.ip,b.type)}):Ue.dacs.forEach(b=>{window.electronAPI.stopDacOutput(b.ip,b.type)}))},[ot,Ue.dacs]),qa=R.useCallback((p,b)=>{xe({type:"SET_SELECTED_CLIP",payload:{layerIndex:p,colIndex:b}});const A=it[p][b];if(A&&A.type==="ilda")xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:A.workerId,totalFrames:A.totalFrames,generatorId:null,generatorParams:{}}});else if(A&&A.type==="generator"){const w=`generator-${p}-${b}`;xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:w,generatorId:A.generatorDefinition.id,generatorParams:A.currentParams,totalFrames:A.frames.length}})}else xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:null,totalFrames:0,generatorId:null,generatorParams:{}}})},[it]),ms=R.useCallback((p,b,A)=>{A?ma.current={layerIndex:p,colIndex:b}:ma.current&&ma.current.layerIndex===p&&ma.current.colIndex===b&&(ma.current=null)},[]),Va=R.useCallback((p,b,A=!0)=>{const w=it[p][b];if(!w){A&&(qa(p,b),sa(p));return}const C=w.triggerStyle||"normal",N=Dt[p];if(C==="normal"){if(!A)return}else if(C==="toggle"){if(!A)return;if(N===b){sa(p);return}}else if(C==="flash"&&!A){N===b&&sa(p);return}if(w&&w.type==="generator"&&w.frames&&w.frames.length>0){const O=`generator-${p}-${b}`;P.current[O]=w.frames[0],I.current[O]=performance.now(),V.current[O]=0}else w&&w.type==="ilda"&&w.workerId&&(I.current[w.workerId]=performance.now(),V.current[w.workerId]=0);if(w&&w.audioFile?m(p,w.audioFile.path,w.audioVolume??1,ta.current).catch(O=>{console.warn(`Failed to play audio for clip ${p}-${b}:`,O),Kt(X=>{const z=`audio-${p}-${b}`;return X.some(H=>H.requestId===z)?X:[...X,{filePath:w.audioFile.path,fileName:w.audioFile.name||w.audioFile.path.split(/[/\\]/).pop(),requestId:z,type:"audio"}]})}):v(p),L.current[p]=performance.now(),xe({type:"SET_ACTIVE_CLIP",payload:{layerIndex:p,colIndex:b}}),w){if(w.type==="ilda"&&w.workerId){const O=V.current[w.workerId]||0;xe({type:"UPDATE_THUMBNAIL",payload:{layerIndex:p,colIndex:b,frameIndex:O}})}else if(w.type==="generator"&&w.frames){const O=V.current[`generator-${p}-${b}`]||0,X=w.frames[O%w.frames.length];X&&xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:p,colIndex:b,content:{stillFrame:X}}})}}},[it,Dt,sa,m,wa,v,qa]),Sn=R.useCallback((p,b,A)=>{if(dt.current&&dt.current[p]&&dt.current[p][b]){const w=dt.current[p][b];if(w){const C={...A,instanceId:ao(),params:{...A.defaultParams}};w.effects=[...w.effects||[],C],Ct.current=!0}}xe({type:"ADD_CLIP_EFFECT",payload:{layerIndex:p,colIndex:b,effect:A}})},[]),lr=R.useCallback((p,b)=>{const A=rl.find(w=>(w.id||w.name)===b);A&&xe({type:"ADD_LAYER_EFFECT",payload:{layerIndex:p,effect:A}})},[]),Hr=R.useCallback((p,b,A)=>{Ct.current=!0,xe({type:"SET_CLIP_DAC",payload:{layerIndex:p,colIndex:b,dac:A}})},[]),Tr=R.useCallback((p,b)=>{xe({type:"SET_LAYER_DAC",payload:{layerIndex:p,dac:b}})},[]),_n=p=>{window.electronAPI&&window.electronAPI.showLayerFullContextMenu&&window.electronAPI.showLayerFullContextMenu(p)},gs=p=>{window.electronAPI&&window.electronAPI.showColumnContextMenu&&window.electronAPI.showColumnContextMenu(p)},Yr=p=>{Et.forEach((b,A)=>{const w=it[A][p];w&&(w.type==="ilda"||w.type==="generator")?Va(A,p):sa(A)})},Cr=R.useCallback(p=>{xe({type:"SET_SELECTED_DAC",payload:p})},[]),Mr=R.useCallback(p=>{xe({type:"SET_DACS",payload:p})},[]),wi=(p,b)=>{if(Ve!==null&&lt!==null){let A=null,w={};if(dt.current&&dt.current[Ve]&&dt.current[Ve][lt]){const G=dt.current[Ve][lt];G&&G.currentParams&&(G.currentParams[p]=b,Ct.current=!0,A=G,w=G.currentParams)}if(A||(A=it[Ve][lt],A&&A.currentParams&&(w={...A.currentParams,[p]:b})),!A||!A.generatorDefinition)return;const C=A.generatorDefinition.id,N=`generator-${Ve}-${lt}`,O=Gr(C,w);O&&(P.current[N]=O),Zt(`generator-${Ve}-${lt}-${p}`,{type:"UPDATE_GENERATOR_PARAM",payload:{layerIndex:Ve,colIndex:lt,paramName:p,newValue:b}});const X=`${Ve}-${lt}`,z={...A.generatorDefinition.defaultParams,...w};Na.current.set(X,JSON.stringify(z));const H=++aa.current;Dn(Ve,lt,A.generatorDefinition,w,H,!1,!0)}},$n=Ve!==null&&lt!==null?it[Ve][lt]:null;R.useEffect(()=>{if(!window.electronAPI||!r)return;(async()=>{let b=null;Et.forEach((w,C)=>{const N=Dt[C];if(N!==null){const O=it[C][N];O&&O.type==="generator"&&O.generatorDefinition?.id==="ndi-source"&&(b=O)}}),!b&&$n?.type==="generator"&&$n?.generatorDefinition?.id==="ndi-source"&&(b=$n);const A=b?.currentParams?.sourceName;A&&A!=="No Source"?A!==Pr.current&&(console.log(`[NDI] Switching to source: ${A}`),await window.electronAPI.ndiCreateReceiver(A),Pr.current=A):Pr.current&&(console.log("[NDI] Destroying receiver"),await window.electronAPI.ndiDestroyReceiver(),Pr.current=null)})()},[Dt,it,$n,Et]),R.useEffect(()=>{const p=[...xn,$n].find(b=>b?.type==="generator"&&b?.generatorDefinition?.id==="ndi-source");if(p&&window.electronAPI?.ndiUpdateSettings){const{captureWidth:b,captureHeight:A}=p.currentParams||{};b&&A&&window.electronAPI.ndiUpdateSettings({width:b,height:A})}},[xn,$n]),R.useEffect(()=>{if(!window.electronAPI||!r)return;const p=A=>{let w=!1;za.current.forEach((C,N)=>{if(C===null)return;const O=vt.current[N][C];O&&O.type==="generator"&&O.generatorDefinition?.id==="ndi-source"&&(r.postMessage({type:"generate",layerIndex:N,colIndex:C,generator:O.generatorDefinition,params:{...O.generatorDefinition.defaultParams,...O.currentParams},ndiFrame:A,isLive:!0,isNdi:!0}),w=!0)}),Ut.current?.type==="generator"&&Ut.current?.generatorDefinition?.id==="ndi-source"&&(r.postMessage({type:"generate",layerIndex:Bn.current,colIndex:ha.current,generator:Ut.current.generatorDefinition,params:{...Ut.current.generatorDefinition.defaultParams,...Ut.current.currentParams},ndiFrame:A,isLive:!0,isNdi:!0}),w=!0),w||window.electronAPI.ndiRendererReady()},b=window.electronAPI.onNdiFrame(p);return()=>b()},[r]);const qr=R.useCallback((p,b,A)=>{const w=p==="knob"?"knobs":"buttons",C=Ue.quickAssigns[w][b];if(C.link){const{layerIndex:N,colIndex:O,effectIndex:X,targetType:z}=C.link,H=C.link.paramName||C.link.paramId;let G=A;if(p==="knob"&&C.min!==void 0&&C.max!==void 0&&(G=C.min+A*(C.max-C.min),C.step&&(G=Math.round(G/C.step)*C.step),G=parseFloat(G.toFixed(5))),z==="global")H==="master_intensity"?br.current=G:H==="master_speed"&&(ln.current=G);else if(z==="layerEffect")Ta.current[N]&&Ta.current[N][X]&&(Ta.current[N][X].params[H]=G);else if((z==="effect"||z==="generator")&&dt.current&&dt.current[N]&&dt.current[N][O]){const ne=dt.current[N][O];z==="effect"&&ne.effects&&ne.effects[X]?ne.effects[X].params[H]=G:z==="generator"&&ne.currentParams&&(ne.currentParams[H]=G),Ct.current=!0}}Zt(`quick-${p}-${b}`,{type:"UPDATE_QUICK_CONTROL",payload:{type:p,index:b,value:A}})},[Ue.quickAssigns,Zt]),Ai=R.useCallback(p=>{const b=Ue.quickAssigns.buttons[p],A=b.link,w=!b.value;if(A){const{layerIndex:C,colIndex:N,effectIndex:O,targetType:X}=A,z=A.paramName||A.paramId;if(X==="transport"){z==="play"?Fn():z==="pause"?Ha():z==="stop"&&Ya();return}if(X==="global"){if(z==="blackout")Ca.current=w;else if(z==="laser_output"){hs();return}else if(z==="clear"){Xn();return}}else if(X==="layer")z==="blackout"?en.current[C]=w:z==="solo"?(kn.current.fill(!1),kn.current[C]=w):z==="autopilot"&&(da.current[C]=w?"forward":"off");else if(X==="layerEffect")Ta.current[C]&&Ta.current[C][O]&&(Ta.current[C][O].params[z]=w);else if((X==="effect"||X==="generator")&&dt.current&&dt.current[C]&&dt.current[C][N]){const H=dt.current[C][N];X==="effect"&&H.effects&&H.effects[O]?H.effects[O].params[z]=w:X==="generator"&&H.currentParams&&(H.currentParams[z]=w),Ct.current=!0}}xe({type:"TOGGLE_QUICK_BUTTON",payload:{index:p}})},[Ue.quickAssigns,Fn,Ha,Ya,hs,Xn]),Vr=R.useCallback((p,b,A=127,w="noteon")=>{if(b===0&&!p.endsWith("_intensity")&&p!=="master_intensity"&&p!=="master_speed"&&!p.startsWith("clip_")&&p!=="bpm_value"&&p!=="bpm_fine_up"&&p!=="bpm_fine_down"&&!p.startsWith("quick_")&&!p.startsWith("dimmer_"))return;const C=b/A;switch(p){case"transport_play":b>0&&Fn();break;case"transport_pause":b>0&&Ha();break;case"transport_stop":b>0&&Ya();break;case"comp_blackout":b>0&&xe({type:"TOGGLE_GLOBAL_BLACKOUT"});break;case"comp_clear":b>0&&Xn();break;case"master_intensity":br.current=C,Zt("master_intensity",{type:"SET_MASTER_INTENSITY",payload:C});break;case"master_speed":const N=Math.max(1,Math.round(C*120));Zt("master_speed",{type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:N}});break;case"laser_output":b>0&&xe({type:"TOGGLE_WORLD_OUTPUT_ACTIVE"});break;case"bpm_value":if(w==="controlchange"){let O=0;b<=10?O=b:b>=118&&(O=b-128),O!==0&&xe({type:"SET_BPM",payload:Math.max(1,Math.min(999,(Ue.bpm||120)+O))})}break;case"bpm_fine_up":b>0&&xe({type:"SET_BPM",payload:Math.min(999,(Ue.bpm||120)+.1)});break;case"bpm_fine_down":b>0&&xe({type:"SET_BPM",payload:Math.max(1,(Ue.bpm||120)-.1)});break;case"bpm_tap":break;default:if(p.startsWith("layer_")){const O=p.split("_"),X=parseInt(O[1]),z=O[2];z==="blackout"&&b>0?xe({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:X}}):z==="solo"&&b>0?xe({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:X}}):z==="intensity"?(ft.current[X]=C,Zt(`layer_${X}_intensity`,{type:"SET_LAYER_INTENSITY",payload:{layerIndex:X,intensity:C}})):z==="clear"&&b>0&&sa(X)}else if(p.startsWith("clip_")){const O=p.split("_"),X=parseInt(O[1]),z=parseInt(O[2]);O[3]==="preview"?b>0&&qa(X,z):Va(X,z,b>0)}else if(p.startsWith("column_")){const O=p.split("_"),X=parseInt(O[1]);b>0&&Yr(X)}else if(p.startsWith("quick_knob_")){const O=parseInt(p.split("_")[2]);qr("knob",O,C)}else if(p.startsWith("quick_btn_")){const O=parseInt(p.split("_")[2]);b>0&&Ai(O)}else if(p.startsWith("dimmer_")){const O=p.replace("dimmer_","").replace(/_/g,"."),X=Jt[O]||{};xe({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:O,settings:{...X,dimmer:C}}})}else{const O=p.split("_");if(O.length>=2&&Ve!==null&&lt!==null){const X=it[Ve][lt];if(X&&X.effects){const z=O[0],H=O.slice(1).join("_"),G=X.effects.findIndex(ne=>ne.id===z);if(G!==-1){const ae=rl.find(le=>le.id===z)?.paramControls.find(le=>le.id===H);if(ae){let le=C;ae.type==="range"||ae.type==="number"?le=ae.min+(ae.max-ae.min)*C:ae.type==="checkbox"&&(le=C>.5),xe({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:Ve,colIndex:lt,effectIndex:G,paramName:H,newValue:le}})}}}}}}},[Fn,Ha,Ya,Xn,sa,ps,Ue.bpm,qa,Va,Yr,it,Ve,lt,Jt]),ys=R.useCallback(p=>{if(p==="world"){const A=!(Ue.worldShowBeamEffect??!0);if(xe({type:"SET_RENDER_SETTING",payload:{setting:"worldShowBeamEffect",value:A}}),window.electronAPI&&window.electronAPI.setRenderSettings){const w={...Ue.renderSettings,showBeamEffect:Ue.showBeamEffect,beamRenderMode:Ue.beamRenderMode,previewScanRate:Ue.previewScanRate,beamAlpha:Ue.beamAlpha,fadeAlpha:Ue.fadeAlpha,worldShowBeamEffect:A,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(w)}}else{const b=!Sa;if(xe({type:"SET_RENDER_SETTING",payload:{setting:"showBeamEffect",value:b}}),window.electronAPI&&window.electronAPI.setRenderSettings){const A={showBeamEffect:b,beamRenderMode:ua,previewScanRate:ca,beamAlpha:Ea,fadeAlpha:oa,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(A)}}},[Sa,ua,ca,Ea,oa,Ue.worldShowBeamEffect,Ue.worldBeamRenderMode]),ul=R.useCallback(p=>{if(p==="world"){const b=Ue.worldBeamRenderMode??"both";let A="points";if(b==="both"?A="points":b==="points"?A="lines":b==="lines"&&(A="both"),xe({type:"SET_RENDER_SETTING",payload:{setting:"worldBeamRenderMode",value:A}}),window.electronAPI&&window.electronAPI.setRenderSettings){const w={showBeamEffect:Sa,beamRenderMode:ua,previewScanRate:ca,beamAlpha:Ea,fadeAlpha:oa,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:A};window.electronAPI.setRenderSettings(w)}}else{let b="points";if(ua==="both"?b="points":ua==="points"?b="lines":ua==="lines"&&(b="both"),xe({type:"SET_RENDER_SETTING",payload:{setting:"beamRenderMode",value:b}}),window.electronAPI&&window.electronAPI.setRenderSettings){const A={showBeamEffect:Sa,beamRenderMode:b,previewScanRate:ca,beamAlpha:Ea,fadeAlpha:oa,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(A)}}},[Sa,ua,ca,Ea,oa,Ue.worldShowBeamEffect,Ue.worldBeamRenderMode]),Ra=async p=>{if(!(!window.electronAPI||!window.electronAPI.showOpenDialog))try{const b=await window.electronAPI.showOpenDialog({title:`Locate missing file: ${p.fileName}`,defaultPath:p.filePath,filters:[{name:"ILDA Files",extensions:["ild"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(b){const A=b,w=window.electronAPI.pathSeparator||(A.includes("/")?"/":"\\");if(xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:p.filePath,newPath:A}}),p.type!=="audio"){const G=await window.electronAPI.readFileForWorker(A);a&&a.postMessage({type:"file-content-response",requestId:p.requestId,arrayBuffer:G},[G])}Kt(G=>G.filter(ne=>ne.requestId!==p.requestId));const C=G=>G.substring(0,G.lastIndexOf(w)),N=G=>G.substring(G.lastIndexOf(w)+1),O=C(p.filePath),X=C(A);console.log(`[Relocate] Scanning for other files moving from [${O}] to [${X}]`);const z=ra.current.clipContents.flat().filter(G=>G),H=new Set([p.filePath]);for(const G of z){if(G.type==="ilda"&&G.filePath&&!H.has(G.filePath)&&C(G.filePath)===O){const ne=N(G.filePath),ae=`${X}${w}${ne}`;G.filePath!==ae&&await window.electronAPI.checkFileExists(ae)&&(console.log(`[Relocate] Auto-resolving ILDA: ${ne}`),xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:G.filePath,newPath:ae}}),H.add(G.filePath),a&&Kt(he=>he.filter(pe=>pe.filePath!==G.filePath)))}if(G.audioFile&&G.audioFile.path&&!H.has(G.audioFile.path)&&C(G.audioFile.path)===O){const ne=N(G.audioFile.path),ae=`${X}${w}${ne}`;G.audioFile.path!==ae&&await window.electronAPI.checkFileExists(ae)&&(console.log(`[Relocate] Auto-resolving Audio: ${ne}`),xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:G.audioFile.path,newPath:ae}}),H.add(G.audioFile.path),Kt(he=>he.filter(pe=>pe.filePath!==G.audioFile.path)))}}}}catch(b){console.error("Relocation failed:",b),tn(`Relocation failed: ${b.message}`)}},vs=R.useCallback((p,b)=>{console.log(`Thumbnail load error for ${p}-${b}, requesting regeneration...`);const A=vt.current[p][b];if(A)if(A.type==="ilda"&&A.workerId&&a){const w=Xt[p][b]||0;a.postMessage({type:"get-frame",workerId:A.workerId,frameIndex:w,isStillFrame:!0,layerIndex:p,colIndex:b})}else A.type==="generator"&&A.stillFrame&&Hf(A.stillFrame,A.effects,p,b,Gt).then(w=>{w&&xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:p,colIndex:b,content:{thumbnailPath:w,thumbnailVersion:Date.now()}}})})},[vt,Xt,a,Gt]),fl=R.useCallback((p,b)=>{const A=vt.current[p][b];A&&A.audioFile&&Kt(w=>{const C=`audio-${p}-${b}`;return w.some(N=>N.requestId===C)?w:[...w,{filePath:A.audioFile.path,fileName:A.audioFile.name||A.audioFile.path.split(/[/\\]/).pop(),requestId:C,type:"audio"}]})},[vt]);return d.jsx(B1,{onMidiCommand:Vr,children:d.jsx(F1,{onArtnetCommand:(p,b)=>Vr(p,b,255),children:d.jsxs(P1,{onCommand:Vr,enabled:ee.keyboard,children:[d.jsx(CE,{isPlaying:wa,globalBlackout:bn,layerBlackouts:nr,layerSolos:rn,isWorldOutputActive:ot,clipContents:it,activeClipIndexes:Dt,theme:sr,bpm:Ue.bpm,quickAssigns:Ue.quickAssigns}),d.jsx(tb,{}),U==="main"?d.jsx("div",{className:"app",children:d.jsxs(Hv,{children:[d.jsx(Nv,{message:Vs.message,visible:Vs.visible}),d.jsx($v,{show:Z,onClose:()=>W(!1)}),d.jsx(Pv,{show:Q,onClose:()=>be(!1),dacs:Jn,dacSettings:Jt,onUpdateDacSettings:zr}),d.jsx(zv,{show:ke||_e,onClose:()=>{ve(!1),Oe(!1)},initialTab:_e?"fft":"output"}),d.jsx(Bv,{show:Ee,title:We.title,initialValue:We.initialValue,onSave:We.onSave,onClose:()=>Y(!1)||q(!1)}),d.jsx(Gv,{missingFiles:Wt,onRelocate:Ra,onClose:()=>Kt([])}),d.jsxs("div",{className:"main-content",children:[d.jsxs("div",{className:"top-bar-left-area",children:[d.jsx(G1,{masterIntensity:Ue.masterIntensity,onMasterIntensityChange:p=>xe({type:"SET_MASTER_INTENSITY",payload:p}),onClearAllActive:Xn,isGlobalBlackout:bn,onToggleGlobalBlackout:()=>xe({type:"TOGGLE_GLOBAL_BLACKOUT"})}),d.jsx(AE,{isWorldOutputActive:ot,onToggleWorldOutput:hs})]}),d.jsxs("div",{className:"layer-controls-container",children:[Et.map((p,b)=>{const A=xn.find(C=>{const N=Dt[b];if(N===null)return!1;const O=it[b][N];return O?O.type==="ilda"?C.workerId===O.workerId:O.type==="generator"?C.workerId===`generator-${b}-${N}`:!1:!1})||null,w=A?P.current[A.workerId]:null;return d.jsx(fv,{layerName:p,index:b,onDropEffect:C=>lr(b,C),onDropDac:(C,N)=>Tr(C,N),layerEffects:Nn[b],activeClipData:A,liveFrame:w,thumbnailRenderMode:Aa,intensity:Ue.layerIntensities[b],onIntensityChange:C=>xe({type:"SET_LAYER_INTENSITY",payload:{layerIndex:b,intensity:C}}),onDeactivateLayerClips:()=>sa(b),onShowLayerFullContextMenu:()=>_n(b),isBlackout:nr[b],isSolo:rn[b],onToggleBlackout:()=>xe({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:b}}),onToggleSolo:()=>xe({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:b}}),onLayerSelect:C=>xe({type:"SET_SELECTED_CLIP",payload:{layerIndex:C,colIndex:null}})},b)}),"          "]}),d.jsx("div",{className:"clip-deck-container",children:d.jsxs("div",{className:"clip-deck",children:[d.jsx("div",{className:"column-headers-container",children:fn.map((p,b)=>d.jsx(H1,{name:p,index:b,onTrigger:()=>Yr(b),onShowColumnHeaderContextMenu:()=>gs(b)},b))}),Et.map((p,b)=>d.jsx("div",{className:"layer-row",children:fn.map((A,w)=>{const C=it?.[b]?.[w];let N=null;C&&C.type==="ilda"?N=C.workerId:C&&C.type==="generator"&&(N=`generator-${b}-${w}`);const O=N?P.current[N]:null,X=C?.stillFrame||(C?.type==="generator"?C.frames?.[0]:null);return d.jsx(pv,{layerIndex:b,colIndex:w,clipName:qn?.[b]?.[w]||`Clip ${b+1}-${w+1}`,clipContent:C,thumbnailFrameIndex:Xt[b][w],thumbnailRenderMode:Aa,liveFrame:O,stillFrame:X,onActivateClick:z=>Va(b,w,z),isActive:Dt[b]===w,onUnsupportedFile:tn,onDropEffect:z=>Sn(b,w,z),onDropGenerator:Ei,onDropDac:(z,H,G)=>{Hr(z,H,G)},onLabelClick:()=>qa(b,w),isSelected:Ve===b&&lt===w,ildaParserWorker:a,onClipHover:ms,onThumbnailError:vs},w)})},b))]})}),d.jsx(NE,{clipContents:it,activeClipIndexes:Dt,layerEffects:Nn,bpm:Ue.bpm,playbackFps:jn,selectedLayerIndex:Ve,selectedColIndex:lt,liveFramesRef:P,progressRef:_,selectedDac:ea,liveDacOutputSettingsRef:At,dacOutputSettings:Jt,getAudioInfo:D,fftLevels:i,getFftLevels:o,effectStatesRef:F,clipActivationTimesRef:L,showBeamEffect:Sa,beamAlpha:Ea,fadeAlpha:oa,previewScanRate:ca,beamRenderMode:ua,worldShowBeamEffect:fa,worldBeamRenderMode:sn,masterIntensity:ar,layerIntensities:us,globalBlackout:bn,layerSolos:rn,layerBlackouts:nr,handleToggleBeamEffect:ys,handleCycleDisplayMode:ul,previewFrameCountRef:je,totalPointsSentRef:$e,activeChannelsCountRef:Ie,lastStatUpdateTimeRef:nt,liveClipContentsRef:dt,optimizationEnabled:Gt}),d.jsxs("div",{className:"middle-bar",children:[d.jsx("div",{className:"middle-bar-left-area",children:d.jsx(Ov,{bpm:Ue.bpm,onBpmChange:p=>xe({type:"SET_BPM",payload:p})})}),d.jsxs("div",{className:"middle-bar-mid-area",children:[d.jsx(Iv,{onPlay:Fn,onPause:Ha,onStop:Ya,isPlaying:wa,isStopped:Ue.isStopped}),d.jsx(wE,{playbackFps:jn,onSpeedChange:ps})]}),d.jsx("div",{className:"middle-bar-right-area"})]}),d.jsxs("div",{className:"bottom-panel",children:[d.jsxs("div",{className:"bottom-panel-tabs-container-1",children:[d.jsxs("div",{className:"bottom-panel-tabs-1",children:[d.jsx("button",{className:`tab-button-1 ${Je==="files"?"active":""}`,onClick:()=>yn("files"),children:"Files"}),d.jsx("button",{className:`tab-button-1 ${Je==="generators"?"active":""}`,onClick:()=>yn("generators"),children:"Generators"}),d.jsx("button",{className:`tab-button-1 ${Je==="effects"?"active":""}`,onClick:()=>yn("effects"),children:"Effects"})]}),d.jsxs("div",{className:"bottom-panel-tab-content-1",children:[Je==="files"&&d.jsx(mv,{viewMode:Ue.fileBrowserViewMode,onViewModeChange:p=>xe({type:"SET_FILE_BROWSER_VIEW_MODE",payload:p}),path:Ue.fileBrowserPath,onPathChange:p=>xe({type:"SET_FILE_BROWSER_PATH",payload:p}),onDropIld:(p,b,A)=>a.postMessage({type:"parse-ilda",file:A,layerIndex:p,colIndex:b})}),Je==="generators"&&d.jsx(gv,{}),Je==="effects"&&d.jsx(yv,{})]})]}),d.jsxs("div",{className:"bottom-panel-tabs-container-2",children:[d.jsxs("div",{className:"bottom-panel-tabs-2",children:[d.jsx("button",{className:`tab-button-2 ${_t==="clip"?"active":""}`,onClick:()=>vn("clip"),children:"Clip-Settings"}),d.jsx("button",{className:`tab-button-2 ${_t==="layer"?"active":""}`,onClick:()=>vn("layer"),children:"Layer-Settings"})]}),d.jsxs("div",{className:"bottom-panel-tab-content-2",children:[_t==="clip"&&d.jsx(Cv,{selectedLayerIndex:Ve,selectedColIndex:lt,clip:$n,audioInfo:D(Ve),bpm:Ue.bpm,getFftLevels:o,onAssignAudio:async()=>{const p=await window.electronAPI.showAudioFileDialog();if(p){const b=p.split(/[\\/]/).pop();xe({type:"SET_CLIP_AUDIO",payload:{layerIndex:Ve,colIndex:lt,audioFile:{path:p,name:b}}})}},onRemoveAudio:()=>{v(Ve),xe({type:"REMOVE_CLIP_AUDIO",payload:{layerIndex:Ve,colIndex:lt}})},onUpdateAudioVolume:(p,b,A)=>{xe({type:"SET_CLIP_AUDIO_VOLUME",payload:{layerIndex:p,colIndex:b,volume:A}}),j(p,A)},onUpdatePlaybackSettings:(p,b,A)=>xe({type:"UPDATE_CLIP_PLAYBACK_SETTINGS",payload:{layerIndex:p,colIndex:b,settings:A}}),onSetParamSync:(p,b)=>xe({type:"SET_CLIP_PARAM_SYNC",payload:{layerIndex:Ve,colIndex:lt,paramId:p,syncMode:b}}),onToggleDacMirror:(p,b,A,w)=>xe({type:"TOGGLE_CLIP_DAC_MIRROR",payload:{layerIndex:p,colIndex:b,dacIndex:A,axis:w}}),onRemoveDac:p=>xe({type:"REMOVE_CLIP_DAC",payload:{layerIndex:Ve,colIndex:lt,dacIndex:p}}),onRemoveEffect:(p,b,A)=>xe({type:"REMOVE_CLIP_EFFECT",payload:{layerIndex:p,colIndex:b,effectIndex:A}}),onReorderEffects:(p,b,A,w)=>xe({type:"REORDER_CLIP_EFFECTS",payload:{layerIndex:p,colIndex:b,oldIndex:A,newIndex:w}}),onAddEffect:p=>xe({type:"ADD_CLIP_EFFECT",payload:{layerIndex:Ve,colIndex:lt,effect:p}}),onUpdateClipUiState:(p,b,A)=>xe({type:"UPDATE_CLIP_UI_STATE",payload:{layerIndex:p,colIndex:b,uiState:A}}),onParameterChange:Js,onGeneratorParameterChange:wi,progressRef:_,onAudioError:fl}),_t==="layer"&&d.jsx(Mv,{selectedLayerIndex:Ve,autopilotMode:Ve!==null?Ue.layerAutopilots[Ve]:"off",onAutopilotChange:p=>xe({type:"SET_LAYER_AUTOPILOT",payload:{layerIndex:Ve,mode:p}}),layerEffects:Ve!==null?Nn[Ve]:[],assignedDacs:Ve!==null&&Ue.layerAssignedDacs?Ue.layerAssignedDacs[Ve]:[],onToggleDacMirror:(p,b,A)=>xe({type:"TOGGLE_LAYER_DAC_MIRROR",payload:{layerIndex:p,dacIndex:b,axis:A}}),onRemoveDac:(p,b)=>xe({type:"REMOVE_LAYER_DAC",payload:{layerIndex:p,dacIndex:b}}),onAddEffect:p=>Ve!==null&&xe({type:"ADD_LAYER_EFFECT",payload:{layerIndex:Ve,effect:p}}),onRemoveEffect:p=>Ve!==null&&xe({type:"REMOVE_LAYER_EFFECT",payload:{layerIndex:Ve,effectIndex:p}}),onParamChange:(p,b,A)=>Ve!==null&&xe({type:"UPDATE_LAYER_EFFECT_PARAMETER",payload:{layerIndex:Ve,effectIndex:p,paramName:b,newValue:A}}),uiState:Ve!==null?Ue.layerUiStates[Ve]:{},onUpdateUiState:p=>xe({type:"UPDATE_LAYER_UI_STATE",payload:{layerIndex:Ve,uiState:p}})})]})]}),d.jsx(vv,{dacs:Jn,onDacSelected:Cr,onDacsDiscovered:Mr,dacSettings:Jt,onUpdateDacSettings:zr}),d.jsx(jv,{enabledShortcuts:ee,onOpenOutputSettings:()=>be(!0),onOpenShortcutsSettings:()=>Y(!0),quickAssigns:Ue.quickAssigns,renderSettings:{showBeamEffect:Sa,beamAlpha:Ea,fadeAlpha:oa,previewScanRate:ca,beamRenderMode:ua,worldShowBeamEffect:fa,worldBeamRenderMode:sn,settingsPanelCollapsed:Ue.settingsPanelCollapsed,optimizationEnabled:Ue.optimizationEnabled},onSetRenderSetting:(p,b)=>{xe(p==="optimizationEnabled"?{type:"SET_OPTIMIZATION_ENABLED",payload:b}:{type:"SET_RENDER_SETTING",payload:{setting:p,value:b}})},onUpdateKnob:(p,b)=>{qr("knob",p,b)},onToggleButton:p=>{Ai(p)},onAssign:(p,b,A)=>xe({type:"ASSIGN_QUICK_CONTROL",payload:{type:p,index:b,link:A}})})]}),d.jsx("div",{className:"SystemMonitor",children:d.jsx(ME,{playbackFps:jn,previewScanRate:ca,previewFrameCountRef:je,totalPointsSentRef:$e,activeChannelsCountRef:Ie,lastStatUpdateTimeRef:nt})})]})]})}):U==="shapeBuilder"?d.jsx(Vv,{onBack:()=>K("main")}):d.jsx(Xv,{onBack:()=>K("main")})]})})})}M1.createRoot(document.getElementById("root")).render(d.jsx(kv,{children:d.jsx(Zv,{children:d.jsxs(Qv,{children:[" ",d.jsx(hv,{children:d.jsx(Av,{children:d.jsx(kE,{})})})]})})}));

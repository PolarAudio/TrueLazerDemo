(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(l){if(l.ep)return;l.ep=!0;const o=a(l);fetch(l.href,o)}})();function rd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mf={exports:{}},no={};var E0;function v1(){if(E0)return no;E0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function a(s,l,o){var u=null;if(o!==void 0&&(u=""+o),l.key!==void 0&&(u=""+l.key),"key"in l){o={};for(var h in l)h!=="key"&&(o[h]=l[h])}else o=l;return l=o.ref,{$$typeof:n,type:s,key:u,ref:l!==void 0?l:null,props:o}}return no.Fragment=e,no.jsx=a,no.jsxs=a,no}var A0;function b1(){return A0||(A0=1,Mf.exports=v1()),Mf.exports}var f=b1(),kf={exports:{}},xt={};var T0;function x1(){if(T0)return xt;T0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),A=Symbol.iterator;function S(Z){return Z===null||typeof Z!="object"?null:(Z=A&&Z[A]||Z["@@iterator"],typeof Z=="function"?Z:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,D={};function L(Z,J,Se){this.props=Z,this.context=J,this.refs=D,this.updater=Se||b}L.prototype.isReactComponent={},L.prototype.setState=function(Z,J){if(typeof Z!="object"&&typeof Z!="function"&&Z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Z,J,"setState")},L.prototype.forceUpdate=function(Z){this.updater.enqueueForceUpdate(this,Z,"forceUpdate")};function B(){}B.prototype=L.prototype;function Q(Z,J,Se){this.props=Z,this.context=J,this.refs=D,this.updater=Se||b}var _=Q.prototype=new B;_.constructor=Q,M(_,L.prototype),_.isPureReactComponent=!0;var U=Array.isArray,I={H:null,A:null,T:null,S:null,V:null},P=Object.prototype.hasOwnProperty;function Y(Z,J,Se,Ae,Le,Ye){return Se=Ye.ref,{$$typeof:n,type:Z,key:J,ref:Se!==void 0?Se:null,props:Ye}}function te(Z,J){return Y(Z.type,J,void 0,void 0,void 0,Z.props)}function oe(Z){return typeof Z=="object"&&Z!==null&&Z.$$typeof===n}function W(Z){var J={"=":"=0",":":"=2"};return"$"+Z.replace(/[=:]/g,function(Se){return J[Se]})}var O=/\/+/g;function $(Z,J){return typeof Z=="object"&&Z!==null&&Z.key!=null?W(""+Z.key):J.toString(36)}function z(){}function K(Z){switch(Z.status){case"fulfilled":return Z.value;case"rejected":throw Z.reason;default:switch(typeof Z.status=="string"?Z.then(z,z):(Z.status="pending",Z.then(function(J){Z.status==="pending"&&(Z.status="fulfilled",Z.value=J)},function(J){Z.status==="pending"&&(Z.status="rejected",Z.reason=J)})),Z.status){case"fulfilled":return Z.value;case"rejected":throw Z.reason}}throw Z}function re(Z,J,Se,Ae,Le){var Ye=typeof Z;(Ye==="undefined"||Ye==="boolean")&&(Z=null);var Ue=!1;if(Z===null)Ue=!0;else switch(Ye){case"bigint":case"string":case"number":Ue=!0;break;case"object":switch(Z.$$typeof){case n:case e:Ue=!0;break;case v:return Ue=Z._init,re(Ue(Z._payload),J,Se,Ae,Le)}}if(Ue)return Le=Le(Z),Ue=Ae===""?"."+$(Z,0):Ae,U(Le)?(Se="",Ue!=null&&(Se=Ue.replace(O,"$&/")+"/"),re(Le,J,Se,"",function(De){return De})):Le!=null&&(oe(Le)&&(Le=te(Le,Se+(Le.key==null||Z&&Z.key===Le.key?"":(""+Le.key).replace(O,"$&/")+"/")+Ue)),J.push(Le)),1;Ue=0;var pt=Ae===""?".":Ae+":";if(U(Z))for(var it=0;it<Z.length;it++)Ae=Z[it],Ye=pt+$(Ae,it),Ue+=re(Ae,J,Se,Ye,Le);else if(it=S(Z),typeof it=="function")for(Z=it.call(Z),it=0;!(Ae=Z.next()).done;)Ae=Ae.value,Ye=pt+$(Ae,it++),Ue+=re(Ae,J,Se,Ye,Le);else if(Ye==="object"){if(typeof Z.then=="function")return re(K(Z),J,Se,Ae,Le);throw J=String(Z),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(Z).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return Ue}function V(Z,J,Se){if(Z==null)return Z;var Ae=[],Le=0;return re(Z,Ae,"","",function(Ye){return J.call(Se,Ye,Le++)}),Ae}function ee(Z){if(Z._status===-1){var J=Z._result;J=J(),J.then(function(Se){(Z._status===0||Z._status===-1)&&(Z._status=1,Z._result=Se)},function(Se){(Z._status===0||Z._status===-1)&&(Z._status=2,Z._result=Se)}),Z._status===-1&&(Z._status=0,Z._result=J)}if(Z._status===1)return Z._result.default;throw Z._result}var se=typeof reportError=="function"?reportError:function(Z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Z=="object"&&Z!==null&&typeof Z.message=="string"?String(Z.message):String(Z),error:Z});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Z);return}console.error(Z)};function ge(){}return xt.Children={map:V,forEach:function(Z,J,Se){V(Z,function(){J.apply(this,arguments)},Se)},count:function(Z){var J=0;return V(Z,function(){J++}),J},toArray:function(Z){return V(Z,function(J){return J})||[]},only:function(Z){if(!oe(Z))throw Error("React.Children.only expected to receive a single React element child.");return Z}},xt.Component=L,xt.Fragment=a,xt.Profiler=l,xt.PureComponent=Q,xt.StrictMode=s,xt.Suspense=p,xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,xt.__COMPILER_RUNTIME={__proto__:null,c:function(Z){return I.H.useMemoCache(Z)}},xt.cache=function(Z){return function(){return Z.apply(null,arguments)}},xt.cloneElement=function(Z,J,Se){if(Z==null)throw Error("The argument must be a React element, but you passed "+Z+".");var Ae=M({},Z.props),Le=Z.key,Ye=void 0;if(J!=null)for(Ue in J.ref!==void 0&&(Ye=void 0),J.key!==void 0&&(Le=""+J.key),J)!P.call(J,Ue)||Ue==="key"||Ue==="__self"||Ue==="__source"||Ue==="ref"&&J.ref===void 0||(Ae[Ue]=J[Ue]);var Ue=arguments.length-2;if(Ue===1)Ae.children=Se;else if(1<Ue){for(var pt=Array(Ue),it=0;it<Ue;it++)pt[it]=arguments[it+2];Ae.children=pt}return Y(Z.type,Le,void 0,void 0,Ye,Ae)},xt.createContext=function(Z){return Z={$$typeof:u,_currentValue:Z,_currentValue2:Z,_threadCount:0,Provider:null,Consumer:null},Z.Provider=Z,Z.Consumer={$$typeof:o,_context:Z},Z},xt.createElement=function(Z,J,Se){var Ae,Le={},Ye=null;if(J!=null)for(Ae in J.key!==void 0&&(Ye=""+J.key),J)P.call(J,Ae)&&Ae!=="key"&&Ae!=="__self"&&Ae!=="__source"&&(Le[Ae]=J[Ae]);var Ue=arguments.length-2;if(Ue===1)Le.children=Se;else if(1<Ue){for(var pt=Array(Ue),it=0;it<Ue;it++)pt[it]=arguments[it+2];Le.children=pt}if(Z&&Z.defaultProps)for(Ae in Ue=Z.defaultProps,Ue)Le[Ae]===void 0&&(Le[Ae]=Ue[Ae]);return Y(Z,Ye,void 0,void 0,null,Le)},xt.createRef=function(){return{current:null}},xt.forwardRef=function(Z){return{$$typeof:h,render:Z}},xt.isValidElement=oe,xt.lazy=function(Z){return{$$typeof:v,_payload:{_status:-1,_result:Z},_init:ee}},xt.memo=function(Z,J){return{$$typeof:g,type:Z,compare:J===void 0?null:J}},xt.startTransition=function(Z){var J=I.T,Se={};I.T=Se;try{var Ae=Z(),Le=I.S;Le!==null&&Le(Se,Ae),typeof Ae=="object"&&Ae!==null&&typeof Ae.then=="function"&&Ae.then(ge,se)}catch(Ye){se(Ye)}finally{I.T=J}},xt.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},xt.use=function(Z){return I.H.use(Z)},xt.useActionState=function(Z,J,Se){return I.H.useActionState(Z,J,Se)},xt.useCallback=function(Z,J){return I.H.useCallback(Z,J)},xt.useContext=function(Z){return I.H.useContext(Z)},xt.useDebugValue=function(){},xt.useDeferredValue=function(Z,J){return I.H.useDeferredValue(Z,J)},xt.useEffect=function(Z,J,Se){var Ae=I.H;if(typeof Se=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ae.useEffect(Z,J)},xt.useId=function(){return I.H.useId()},xt.useImperativeHandle=function(Z,J,Se){return I.H.useImperativeHandle(Z,J,Se)},xt.useInsertionEffect=function(Z,J){return I.H.useInsertionEffect(Z,J)},xt.useLayoutEffect=function(Z,J){return I.H.useLayoutEffect(Z,J)},xt.useMemo=function(Z,J){return I.H.useMemo(Z,J)},xt.useOptimistic=function(Z,J){return I.H.useOptimistic(Z,J)},xt.useReducer=function(Z,J,Se){return I.H.useReducer(Z,J,Se)},xt.useRef=function(Z){return I.H.useRef(Z)},xt.useState=function(Z){return I.H.useState(Z)},xt.useSyncExternalStore=function(Z,J,Se){return I.H.useSyncExternalStore(Z,J,Se)},xt.useTransition=function(){return I.H.useTransition()},xt.version="19.1.1",xt}var C0;function sd(){return C0||(C0=1,kf.exports=x1()),kf.exports}var T=sd();const vn=rd(T);var Nf={exports:{}},ao={},Rf={exports:{}},Df={};var M0;function S1(){return M0||(M0=1,(function(n){function e(V,ee){var se=V.length;V.push(ee);e:for(;0<se;){var ge=se-1>>>1,Z=V[ge];if(0<l(Z,ee))V[ge]=ee,V[se]=Z,se=ge;else break e}}function a(V){return V.length===0?null:V[0]}function s(V){if(V.length===0)return null;var ee=V[0],se=V.pop();if(se!==ee){V[0]=se;e:for(var ge=0,Z=V.length,J=Z>>>1;ge<J;){var Se=2*(ge+1)-1,Ae=V[Se],Le=Se+1,Ye=V[Le];if(0>l(Ae,se))Le<Z&&0>l(Ye,Ae)?(V[ge]=Ye,V[Le]=se,ge=Le):(V[ge]=Ae,V[Se]=se,ge=Se);else if(Le<Z&&0>l(Ye,se))V[ge]=Ye,V[Le]=se,ge=Le;else break e}}return ee}function l(V,ee){var se=V.sortIndex-ee.sortIndex;return se!==0?se:V.id-ee.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var u=Date,h=u.now();n.unstable_now=function(){return u.now()-h}}var p=[],g=[],v=1,A=null,S=3,b=!1,M=!1,D=!1,L=!1,B=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function U(V){for(var ee=a(g);ee!==null;){if(ee.callback===null)s(g);else if(ee.startTime<=V)s(g),ee.sortIndex=ee.expirationTime,e(p,ee);else break;ee=a(g)}}function I(V){if(D=!1,U(V),!M)if(a(p)!==null)M=!0,P||(P=!0,$());else{var ee=a(g);ee!==null&&re(I,ee.startTime-V)}}var P=!1,Y=-1,te=5,oe=-1;function W(){return L?!0:!(n.unstable_now()-oe<te)}function O(){if(L=!1,P){var V=n.unstable_now();oe=V;var ee=!0;try{e:{M=!1,D&&(D=!1,Q(Y),Y=-1),b=!0;var se=S;try{t:{for(U(V),A=a(p);A!==null&&!(A.expirationTime>V&&W());){var ge=A.callback;if(typeof ge=="function"){A.callback=null,S=A.priorityLevel;var Z=ge(A.expirationTime<=V);if(V=n.unstable_now(),typeof Z=="function"){A.callback=Z,U(V),ee=!0;break t}A===a(p)&&s(p),U(V)}else s(p);A=a(p)}if(A!==null)ee=!0;else{var J=a(g);J!==null&&re(I,J.startTime-V),ee=!1}}break e}finally{A=null,S=se,b=!1}ee=void 0}}finally{ee?$():P=!1}}}var $;if(typeof _=="function")$=function(){_(O)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,K=z.port2;z.port1.onmessage=O,$=function(){K.postMessage(null)}}else $=function(){B(O,0)};function re(V,ee){Y=B(function(){V(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return S},n.unstable_next=function(V){switch(S){case 1:case 2:case 3:var ee=3;break;default:ee=S}var se=S;S=ee;try{return V()}finally{S=se}},n.unstable_requestPaint=function(){L=!0},n.unstable_runWithPriority=function(V,ee){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var se=S;S=V;try{return ee()}finally{S=se}},n.unstable_scheduleCallback=function(V,ee,se){var ge=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ge+se:ge):se=ge,V){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=se+Z,V={id:v++,callback:ee,priorityLevel:V,startTime:se,expirationTime:Z,sortIndex:-1},se>ge?(V.sortIndex=se,e(g,V),a(p)===null&&V===a(g)&&(D?(Q(Y),Y=-1):D=!0,re(I,se-ge))):(V.sortIndex=Z,e(p,V),M||b||(M=!0,P||(P=!0,$()))),V},n.unstable_shouldYield=W,n.unstable_wrapCallback=function(V){var ee=S;return function(){var se=S;S=ee;try{return V.apply(this,arguments)}finally{S=se}}}})(Df)),Df}var k0;function w1(){return k0||(k0=1,Rf.exports=S1()),Rf.exports}var _f={exports:{}},sa={};var N0;function E1(){if(N0)return sa;N0=1;var n=sd();function e(p){var g="https://react.dev/errors/"+p;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)g+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(e(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},l=Symbol.for("react.portal");function o(p,g,v){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:A==null?null:""+A,children:p,containerInfo:g,implementation:v}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,g){if(p==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return sa.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,sa.createPortal=function(p,g){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return o(p,g,null,v)},sa.flushSync=function(p){var g=u.T,v=s.p;try{if(u.T=null,s.p=2,p)return p()}finally{u.T=g,s.p=v,s.d.f()}},sa.preconnect=function(p,g){typeof p=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,s.d.C(p,g))},sa.prefetchDNS=function(p){typeof p=="string"&&s.d.D(p)},sa.preinit=function(p,g){if(typeof p=="string"&&g&&typeof g.as=="string"){var v=g.as,A=h(v,g.crossOrigin),S=typeof g.integrity=="string"?g.integrity:void 0,b=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;v==="style"?s.d.S(p,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:A,integrity:S,fetchPriority:b}):v==="script"&&s.d.X(p,{crossOrigin:A,integrity:S,fetchPriority:b,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},sa.preinitModule=function(p,g){if(typeof p=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var v=h(g.as,g.crossOrigin);s.d.M(p,{crossOrigin:v,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&s.d.M(p)},sa.preload=function(p,g){if(typeof p=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var v=g.as,A=h(v,g.crossOrigin);s.d.L(p,v,{crossOrigin:A,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},sa.preloadModule=function(p,g){if(typeof p=="string")if(g){var v=h(g.as,g.crossOrigin);s.d.m(p,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:v,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else s.d.m(p)},sa.requestFormReset=function(p){s.d.r(p)},sa.unstable_batchedUpdates=function(p,g){return p(g)},sa.useFormState=function(p,g,v){return u.H.useFormState(p,g,v)},sa.useFormStatus=function(){return u.H.useHostTransitionStatus()},sa.version="19.1.1",sa}var R0;function Fm(){if(R0)return _f.exports;R0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),_f.exports=E1(),_f.exports}var D0;function A1(){if(D0)return ao;D0=1;var n=w1(),e=sd(),a=Fm();function s(t){var r="https://react.dev/errors/"+t;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)r+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function o(t){var r=t,i=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,(r.flags&4098)!==0&&(i=r.return),t=r.return;while(t)}return r.tag===3?i:null}function u(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function h(t){if(o(t)!==t)throw Error(s(188))}function p(t){var r=t.alternate;if(!r){if(r=o(t),r===null)throw Error(s(188));return r!==t?null:t}for(var i=t,c=r;;){var d=i.return;if(d===null)break;var m=d.alternate;if(m===null){if(c=d.return,c!==null){i=c;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===i)return h(d),t;if(m===c)return h(d),r;m=m.sibling}throw Error(s(188))}if(i.return!==c.return)i=d,c=m;else{for(var C=!1,F=d.child;F;){if(F===i){C=!0,i=d,c=m;break}if(F===c){C=!0,c=d,i=m;break}F=F.sibling}if(!C){for(F=m.child;F;){if(F===i){C=!0,i=m,c=d;break}if(F===c){C=!0,c=m,i=d;break}F=F.sibling}if(!C)throw Error(s(189))}}if(i.alternate!==c)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?t:r}function g(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t;for(t=t.child;t!==null;){if(r=g(t),r!==null)return r;t=t.sibling}return null}var v=Object.assign,A=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),Q=Symbol.for("react.consumer"),_=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),oe=Symbol.for("react.activity"),W=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function $(t){return t===null||typeof t!="object"?null:(t=O&&t[O]||t["@@iterator"],typeof t=="function"?t:null)}var z=Symbol.for("react.client.reference");function K(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===z?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case M:return"Fragment";case L:return"Profiler";case D:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList";case oe:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case b:return"Portal";case _:return(t.displayName||"Context")+".Provider";case Q:return(t._context.displayName||"Context")+".Consumer";case U:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Y:return r=t.displayName||null,r!==null?r:K(t.type)||"Memo";case te:r=t._payload,t=t._init;try{return K(t(r))}catch{}}return null}var re=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},ge=[],Z=-1;function J(t){return{current:t}}function Se(t){0>Z||(t.current=ge[Z],ge[Z]=null,Z--)}function Ae(t,r){Z++,ge[Z]=t.current,t.current=r}var Le=J(null),Ye=J(null),Ue=J(null),pt=J(null);function it(t,r){switch(Ae(Ue,r),Ae(Ye,t),Ae(Le,null),r.nodeType){case 9:case 11:t=(t=r.documentElement)&&(t=t.namespaceURI)?Qh(t):0;break;default:if(t=r.tagName,r=r.namespaceURI)r=Qh(r),t=Kh(r,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}Se(Le),Ae(Le,t)}function De(){Se(Le),Se(Ye),Se(Ue)}function qe(t){t.memoizedState!==null&&Ae(pt,t);var r=Le.current,i=Kh(r,t.type);r!==i&&(Ae(Ye,t),Ae(Le,i))}function lt(t){Ye.current===t&&(Se(Le),Se(Ye)),pt.current===t&&(Se(pt),Ql._currentValue=se)}var wt=Object.prototype.hasOwnProperty,gt=n.unstable_scheduleCallback,Bt=n.unstable_cancelCallback,ze=n.unstable_shouldYield,nt=n.unstable_requestPaint,Fe=n.unstable_now,at=n.unstable_getCurrentPriorityLevel,In=n.unstable_ImmediatePriority,Tn=n.unstable_UserBlockingPriority,mt=n.unstable_NormalPriority,zn=n.unstable_LowPriority,Pe=n.unstable_IdlePriority,we=n.log,rn=n.unstable_setDisableYieldValue,Ot=null,It=null;function Lt(t){if(typeof we=="function"&&rn(t),It&&typeof It.setStrictMode=="function")try{It.setStrictMode(Ot,t)}catch{}}var et=Math.clz32?Math.clz32:qa,$r=Math.log,la=Math.LN2;function qa(t){return t>>>=0,t===0?32:31-($r(t)/la|0)|0}var Cn=256,cr=4194304;function Gn(t){var r=t&42;if(r!==0)return r;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function ka(t,r,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,C=t.pingedLanes;t=t.warmLanes;var F=c&134217727;return F!==0?(c=F&~m,c!==0?d=Gn(c):(C&=F,C!==0?d=Gn(C):i||(i=F&~t,i!==0&&(d=Gn(i))))):(F=c&~m,F!==0?d=Gn(F):C!==0?d=Gn(C):i||(i=c&~t,i!==0&&(d=Gn(i)))),d===0?0:r!==0&&r!==d&&(r&m)===0&&(m=d&-d,i=r&-r,m>=i||m===32&&(i&4194048)!==0)?r:d}function Mn(t,r){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&r)===0}function Wr(t,r){switch(t){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zn(){var t=Cn;return Cn<<=1,(Cn&4194048)===0&&(Cn=256),t}function $e(){var t=cr;return cr<<=1,(cr&62914560)===0&&(cr=4194304),t}function ct(t){for(var r=[],i=0;31>i;i++)r.push(t);return r}function Tr(t,r){t.pendingLanes|=r,r!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function ha(t,r,i,c,d,m){var C=t.pendingLanes;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=i,t.entangledLanes&=i,t.errorRecoveryDisabledLanes&=i,t.shellSuspendCounter=0;var F=t.entanglements,ne=t.expirationTimes,he=t.hiddenUpdates;for(i=C&~i;0<i;){var Ee=31-et(i),Re=1<<Ee;F[Ee]=0,ne[Ee]=-1;var ye=he[Ee];if(ye!==null)for(he[Ee]=null,Ee=0;Ee<ye.length;Ee++){var ve=ye[Ee];ve!==null&&(ve.lane&=-536870913)}i&=~Re}c!==0&&oa(t,c,0),m!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=m&~(C&~r))}function oa(t,r,i){t.pendingLanes|=r,t.suspendedLanes&=~r;var c=31-et(r);t.entangledLanes|=r,t.entanglements[c]=t.entanglements[c]|1073741824|i&4194090}function Mi(t,r){var i=t.entangledLanes|=r;for(t=t.entanglements;i;){var c=31-et(i),d=1<<c;d&r|t[c]&r&&(t[c]|=r),i&=~d}}function Na(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Cr(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ra(){var t=ee.p;return t!==0?t:(t=window.event,t===void 0?32:y0(t.type))}function Xa(t,r){var i=ee.p;try{return ee.p=t,r()}finally{ee.p=i}}var kn=Math.random().toString(36).slice(2),Ut="__reactFiber$"+kn,Wt="__reactProps$"+kn,sn="__reactContainer$"+kn,Zr="__reactEvents$"+kn,kt="__reactListeners$"+kn,ca="__reactHandles$"+kn,Jt="__reactResources$"+kn,Hn="__reactMarker$"+kn;function Qn(t){delete t[Ut],delete t[Wt],delete t[Zr],delete t[kt],delete t[ca]}function ur(t){var r=t[Ut];if(r)return r;for(var i=t.parentNode;i;){if(r=i[sn]||i[Ut]){if(i=r.alternate,r.child!==null||i!==null&&i.child!==null)for(t=n0(t);t!==null;){if(i=t[Ut])return i;t=n0(t)}return r}t=i,i=t.parentNode}return null}function Da(t){if(t=t[Ut]||t[sn]){var r=t.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return t}return null}function ln(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t.stateNode;throw Error(s(33))}function ma(t){var r=t[Jt];return r||(r=t[Jt]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function At(t){t[Hn]=!0}var Dt=new Set,Ge={};function Ve(t,r){Nn(t,r),Nn(t+"Capture",r)}function Nn(t,r){for(Ge[t]=r,t=0;t<r.length;t++)Dt.add(r[t])}var ga=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qr={},en={};function Kn(t){return wt.call(en,t)?!0:wt.call(Qr,t)?!1:ga.test(t)?en[t]=!0:(Qr[t]=!0,!1)}function Ln(t,r,i){if(Kn(r))if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":t.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){t.removeAttribute(r);return}}t.setAttribute(r,""+i)}}function Jn(t,r,i){if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(r);return}t.setAttribute(r,""+i)}}function ea(t,r,i,c){if(c===null)t.removeAttribute(i);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttributeNS(r,i,""+c)}}var ta,Kr;function Rn(t){if(ta===void 0)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);ta=r&&r[1]||"",Kr=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ta+t+Kr}var _a=!1;function qt(t,r){if(!t||_a)return"";_a=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Re=function(){throw Error()};if(Object.defineProperty(Re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Re,[])}catch(ve){var ye=ve}Reflect.construct(t,[],Re)}else{try{Re.call()}catch(ve){ye=ve}t.call(Re.prototype)}}else{try{throw Error()}catch(ve){ye=ve}(Re=t())&&typeof Re.catch=="function"&&Re.catch(function(){})}}catch(ve){if(ve&&ye&&typeof ve.stack=="string")return[ve.stack,ye.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=c.DetermineComponentFrameRoot(),C=m[0],F=m[1];if(C&&F){var ne=C.split(`
`),he=F.split(`
`);for(d=c=0;c<ne.length&&!ne[c].includes("DetermineComponentFrameRoot");)c++;for(;d<he.length&&!he[d].includes("DetermineComponentFrameRoot");)d++;if(c===ne.length||d===he.length)for(c=ne.length-1,d=he.length-1;1<=c&&0<=d&&ne[c]!==he[d];)d--;for(;1<=c&&0<=d;c--,d--)if(ne[c]!==he[d]){if(c!==1||d!==1)do if(c--,d--,0>d||ne[c]!==he[d]){var Ee=`
`+ne[c].replace(" at new "," at ");return t.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",t.displayName)),Ee}while(1<=c&&0<=d);break}}}finally{_a=!1,Error.prepareStackTrace=i}return(i=t?t.displayName||t.name:"")?Rn(i):""}function Yn(t){switch(t.tag){case 26:case 27:case 5:return Rn(t.type);case 16:return Rn("Lazy");case 13:return Rn("Suspense");case 19:return Rn("SuspenseList");case 0:case 15:return qt(t.type,!1);case 11:return qt(t.type.render,!1);case 1:return qt(t.type,!0);case 31:return Rn("Activity");default:return""}}function $a(t){try{var r="";do r+=Yn(t),t=t.return;while(t);return r}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function hn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ya(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Js(t){var r=ya(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),c=""+t[r];if(!t.hasOwnProperty(r)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,m=i.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return d.call(this)},set:function(C){c=""+C,m.call(this,C)}}),Object.defineProperty(t,r,{enumerable:i.enumerable}),{getValue:function(){return c},setValue:function(C){c=""+C},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function Mr(t){t._valueTracker||(t._valueTracker=Js(t))}function fr(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var i=r.getValue(),c="";return t&&(c=ya(t)?t.checked?"true":"false":t.value),t=c,t!==i?(r.setValue(t),!0):!1}function dr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var ki=/[\n"\\]/g;function jn(t){return t.replace(ki,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Oa(t,r,i,c,d,m,C,F){t.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?t.type=C:t.removeAttribute("type"),r!=null?C==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+hn(r)):t.value!==""+hn(r)&&(t.value=""+hn(r)):C!=="submit"&&C!=="reset"||t.removeAttribute("value"),r!=null?va(t,C,hn(r)):i!=null?va(t,C,hn(i)):c!=null&&t.removeAttribute("value"),d==null&&m!=null&&(t.defaultChecked=!!m),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?t.name=""+hn(F):t.removeAttribute("name")}function ei(t,r,i,c,d,m,C,F){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(t.type=m),r!=null||i!=null){if(!(m!=="submit"&&m!=="reset"||r!=null))return;i=i!=null?""+hn(i):"",r=r!=null?""+hn(r):i,F||r===t.value||(t.value=r),t.defaultValue=r}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,t.checked=F?t.checked:!!c,t.defaultChecked=!!c,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(t.name=C)}function va(t,r,i){r==="number"&&dr(t.ownerDocument)===t||t.defaultValue===""+i||(t.defaultValue=""+i)}function Wa(t,r,i,c){if(t=t.options,r){r={};for(var d=0;d<i.length;d++)r["$"+i[d]]=!0;for(i=0;i<t.length;i++)d=r.hasOwnProperty("$"+t[i].value),t[i].selected!==d&&(t[i].selected=d),d&&c&&(t[i].defaultSelected=!0)}else{for(i=""+hn(i),r=null,d=0;d<t.length;d++){if(t[d].value===i){t[d].selected=!0,c&&(t[d].defaultSelected=!0);return}r!==null||t[d].disabled||(r=t[d])}r!==null&&(r.selected=!0)}}function Ni(t,r,i){if(r!=null&&(r=""+hn(r),r!==t.value&&(t.value=r),i==null)){t.defaultValue!==r&&(t.defaultValue=r);return}t.defaultValue=i!=null?""+hn(i):""}function ti(t,r,i,c){if(r==null){if(c!=null){if(i!=null)throw Error(s(92));if(re(c)){if(1<c.length)throw Error(s(93));c=c[0]}i=c}i==null&&(i=""),r=i}i=hn(r),t.defaultValue=i,c=t.textContent,c===i&&c!==""&&c!==null&&(t.value=c)}function ba(t,r){if(r){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=r;return}}t.textContent=r}var kr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pr(t,r,i){var c=r.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?c?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="":c?t.setProperty(r,i):typeof i!="number"||i===0||kr.has(r)?r==="float"?t.cssFloat=i:t[r]=(""+i).trim():t[r]=i+"px"}function Jr(t,r,i){if(r!=null&&typeof r!="object")throw Error(s(62));if(t=t.style,i!=null){for(var c in i)!i.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?t.setProperty(c,""):c==="float"?t.cssFloat="":t[c]="");for(var d in r)c=r[d],r.hasOwnProperty(d)&&i[d]!==c&&pr(t,d,c)}else for(var m in r)r.hasOwnProperty(m)&&pr(t,m,r[m])}function Nr(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ia=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function es(t){return Ia.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Rr=null;function Dr(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var _r=null,mr=null;function ni(t){var r=Da(t);if(r&&(t=r.stateNode)){var i=t[Wt]||null;e:switch(t=r.stateNode,r.type){case"input":if(Oa(t,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),r=i.name,i.type==="radio"&&r!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+jn(""+r)+'"][type="radio"]'),r=0;r<i.length;r++){var c=i[r];if(c!==t&&c.form===t.form){var d=c[Wt]||null;if(!d)throw Error(s(90));Oa(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(r=0;r<i.length;r++)c=i[r],c.form===t.form&&fr(c)}break e;case"textarea":Ni(t,i.value,i.defaultValue);break e;case"select":r=i.value,r!=null&&Wa(t,!!i.multiple,r,!1)}}}var tn=!1;function ai(t,r,i){if(tn)return t(r,i);tn=!0;try{var c=t(r);return c}finally{if(tn=!1,(_r!==null||mr!==null)&&(tc(),_r&&(r=_r,t=mr,mr=_r=null,ni(r),t)))for(r=0;r<t.length;r++)ni(t[r])}}function xa(t,r){var i=t.stateNode;if(i===null)return null;var c=i[Wt]||null;if(c===null)return null;i=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(s(231,r,typeof i));return i}var Sa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xs=!1;if(Sa)try{var ts={};Object.defineProperty(ts,"passive",{get:function(){xs=!0}}),window.addEventListener("test",ts,ts),window.removeEventListener("test",ts,ts)}catch{xs=!1}var ua=null,fa=null,na=null;function Or(){if(na)return na;var t,r=fa,i=r.length,c,d="value"in ua?ua.value:ua.textContent,m=d.length;for(t=0;t<i&&r[t]===d[t];t++);var C=i-t;for(c=1;c<=C&&r[i-c]===d[m-c];c++);return na=d.slice(t,1<c?1-c:void 0)}function Za(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Qa(){return!0}function Ir(){return!1}function cn(t){function r(i,c,d,m,C){this._reactName=i,this._targetInst=d,this.type=c,this.nativeEvent=m,this.target=C,this.currentTarget=null;for(var F in t)t.hasOwnProperty(F)&&(i=t[F],this[F]=i?i(m):m[F]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Qa:Ir,this.isPropagationStopped=Ir,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Qa)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Qa)},persist:function(){},isPersistent:Qa}),r}var Vn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ss=cn(Vn),wa=v({},Vn,{view:0,detail:0}),Ri=cn(wa),bn,ws,ns,as=v({},wa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:H,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ns&&(ns&&t.type==="mousemove"?(bn=t.screenX-ns.screenX,ws=t.screenY-ns.screenY):ws=bn=0,ns=t),bn)},movementY:function(t){return"movementY"in t?t.movementY:ws}}),Es=cn(as),ri=v({},as,{dataTransfer:0}),Lr=cn(ri),As=v({},wa,{relatedTarget:0}),si=cn(As),yl=v({},Vn,{animationName:0,elapsedTime:0,pseudoElement:0}),Ea=cn(yl),Di=v({},Vn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Aa=cn(Di),jr=v({},Vn,{data:0}),_i=cn(jr),y={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},k={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},X={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function G(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=X[t])?!!r[t]:!1}function H(){return G}var x=v({},wa,{key:function(t){if(t.key){var r=y[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=Za(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?k[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:H,charCode:function(t){return t.type==="keypress"?Za(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Za(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),w=cn(x),R=v({},as,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),E=cn(R),N=v({},wa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:H}),j=cn(N),q=v({},Vn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ie=cn(q),ce=v({},as,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),de=cn(ce),ae=v({},Vn,{newState:0,oldState:0}),xe=cn(ae),fe=[9,13,27,32],me=Sa&&"CompositionEvent"in window,ke=null;Sa&&"documentMode"in document&&(ke=document.documentMode);var Ne=Sa&&"TextEvent"in window&&!ke,Te=Sa&&(!me||ke&&8<ke&&11>=ke),je=" ",Oe=!1;function Ie(t,r){switch(t){case"keyup":return fe.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Je(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var rt=!1;function Ke(t,r){switch(t){case"compositionend":return Je(r);case"keypress":return r.which!==32?null:(Oe=!0,je);case"textInput":return t=r.data,t===je&&Oe?null:t;default:return null}}function st(t,r){if(rt)return t==="compositionend"||!me&&Ie(t,r)?(t=Or(),na=fa=ua=null,rt=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Te&&r.locale!=="ko"?null:r.data;default:return null}}var Tt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yt(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!Tt[t.type]:r==="textarea"}function Ur(t,r,i,c){_r?mr?mr.push(c):mr=[c]:_r=c,r=lc(r,"onChange"),0<r.length&&(i=new Ss("onChange","change",null,i,c),t.push({event:i,listeners:r}))}var Dn=null,nn=null;function Xt(t){qh(t,0)}function Nt(t){var r=ln(t);if(fr(r))return t}function xn(t,r){if(t==="change")return r}var Zt=!1;if(Sa){var vt;if(Sa){var zt="oninput"in document;if(!zt){var un=document.createElement("div");un.setAttribute("oninput","return;"),zt=typeof un.oninput=="function"}vt=zt}else vt=!1;Zt=vt&&(!document.documentMode||9<document.documentMode)}function Ka(){Dn&&(Dn.detachEvent("onpropertychange",Br),nn=Dn=null)}function Br(t){if(t.propertyName==="value"&&Nt(nn)){var r=[];Ur(r,nn,t,Dr(t)),ai(Xt,r)}}function Sn(t,r,i){t==="focusin"?(Ka(),Dn=r,nn=i,Dn.attachEvent("onpropertychange",Br)):t==="focusout"&&Ka()}function bt(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nt(nn)}function Ja(t,r){if(t==="click")return Nt(r)}function da(t,r){if(t==="input"||t==="change")return Nt(r)}function La(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var qn=typeof Object.is=="function"?Object.is:La;function ja(t,r){if(qn(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var i=Object.keys(t),c=Object.keys(r);if(i.length!==c.length)return!1;for(c=0;c<i.length;c++){var d=i[c];if(!wt.call(r,d)||!qn(t[d],r[d]))return!1}return!0}function er(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ts(t,r){var i=er(t);t=0;for(var c;i;){if(i.nodeType===3){if(c=t+i.textContent.length,t<=r&&c>=r)return{node:i,offset:r-t};t=c}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=er(i)}}function wo(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?wo(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function tr(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var r=dr(t.document);r instanceof t.HTMLIFrameElement;){try{var i=typeof r.contentWindow.location.href=="string"}catch{i=!1}if(i)t=r.contentWindow;else break;r=dr(t.document)}return r}function aa(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}var Jg=Sa&&"documentMode"in document&&11>=document.documentMode,Oi=null,Fc=null,vl=null,Pc=!1;function wd(t,r,i){var c=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Pc||Oi==null||Oi!==dr(c)||(c=Oi,"selectionStart"in c&&aa(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),vl&&ja(vl,c)||(vl=c,c=lc(Fc,"onSelect"),0<c.length&&(r=new Ss("onSelect","select",null,r,i),t.push({event:r,listeners:c}),r.target=Oi)))}function ii(t,r){var i={};return i[t.toLowerCase()]=r.toLowerCase(),i["Webkit"+t]="webkit"+r,i["Moz"+t]="moz"+r,i}var Ii={animationend:ii("Animation","AnimationEnd"),animationiteration:ii("Animation","AnimationIteration"),animationstart:ii("Animation","AnimationStart"),transitionrun:ii("Transition","TransitionRun"),transitionstart:ii("Transition","TransitionStart"),transitioncancel:ii("Transition","TransitionCancel"),transitionend:ii("Transition","TransitionEnd")},zc={},Ed={};Sa&&(Ed=document.createElement("div").style,"AnimationEvent"in window||(delete Ii.animationend.animation,delete Ii.animationiteration.animation,delete Ii.animationstart.animation),"TransitionEvent"in window||delete Ii.transitionend.transition);function li(t){if(zc[t])return zc[t];if(!Ii[t])return t;var r=Ii[t],i;for(i in r)if(r.hasOwnProperty(i)&&i in Ed)return zc[t]=r[i];return t}var Ad=li("animationend"),Td=li("animationiteration"),Cd=li("animationstart"),ey=li("transitionrun"),ty=li("transitionstart"),ny=li("transitioncancel"),Md=li("transitionend"),kd=new Map,Gc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Gc.push("scrollEnd");function gr(t,r){kd.set(t,r),Ve(r,[t])}var Nd=new WeakMap;function nr(t,r){if(typeof t=="object"&&t!==null){var i=Nd.get(t);return i!==void 0?i:(r={value:t,source:r,stack:$a(r)},Nd.set(t,r),r)}return{value:t,source:r,stack:$a(r)}}var ar=[],Li=0,Hc=0;function Eo(){for(var t=Li,r=Hc=Li=0;r<t;){var i=ar[r];ar[r++]=null;var c=ar[r];ar[r++]=null;var d=ar[r];ar[r++]=null;var m=ar[r];if(ar[r++]=null,c!==null&&d!==null){var C=c.pending;C===null?d.next=d:(d.next=C.next,C.next=d),c.pending=d}m!==0&&Rd(i,d,m)}}function Ao(t,r,i,c){ar[Li++]=t,ar[Li++]=r,ar[Li++]=i,ar[Li++]=c,Hc|=c,t.lanes|=c,t=t.alternate,t!==null&&(t.lanes|=c)}function Yc(t,r,i,c){return Ao(t,r,i,c),To(t)}function ji(t,r){return Ao(t,null,null,r),To(t)}function Rd(t,r,i){t.lanes|=i;var c=t.alternate;c!==null&&(c.lanes|=i);for(var d=!1,m=t.return;m!==null;)m.childLanes|=i,c=m.alternate,c!==null&&(c.childLanes|=i),m.tag===22&&(t=m.stateNode,t===null||t._visibility&1||(d=!0)),t=m,m=m.return;return t.tag===3?(m=t.stateNode,d&&r!==null&&(d=31-et(i),t=m.hiddenUpdates,c=t[d],c===null?t[d]=[r]:c.push(r),r.lane=i|536870912),m):null}function To(t){if(50<Hl)throw Hl=0,Zu=null,Error(s(185));for(var r=t.return;r!==null;)t=r,r=t.return;return t.tag===3?t.stateNode:null}var Ui={};function ay(t,r,i,c){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ua(t,r,i,c){return new ay(t,r,i,c)}function Vc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function rs(t,r){var i=t.alternate;return i===null?(i=Ua(t.tag,r,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=r,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&65011712,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,r=t.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i.refCleanup=t.refCleanup,i}function Dd(t,r){t.flags&=65011714;var i=t.alternate;return i===null?(t.childLanes=0,t.lanes=r,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,t.type=i.type,r=i.dependencies,t.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t}function Co(t,r,i,c,d,m){var C=0;if(c=t,typeof t=="function")Vc(t)&&(C=1);else if(typeof t=="string")C=s1(t,i,Le.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case oe:return t=Ua(31,i,r,d),t.elementType=oe,t.lanes=m,t;case M:return oi(i.children,d,m,r);case D:C=8,d|=24;break;case L:return t=Ua(12,i,r,d|2),t.elementType=L,t.lanes=m,t;case I:return t=Ua(13,i,r,d),t.elementType=I,t.lanes=m,t;case P:return t=Ua(19,i,r,d),t.elementType=P,t.lanes=m,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case B:case _:C=10;break e;case Q:C=9;break e;case U:C=11;break e;case Y:C=14;break e;case te:C=16,c=null;break e}C=29,i=Error(s(130,t===null?"null":typeof t,"")),c=null}return r=Ua(C,i,r,d),r.elementType=t,r.type=c,r.lanes=m,r}function oi(t,r,i,c){return t=Ua(7,t,c,r),t.lanes=i,t}function qc(t,r,i){return t=Ua(6,t,null,r),t.lanes=i,t}function Xc(t,r,i){return r=Ua(4,t.children!==null?t.children:[],t.key,r),r.lanes=i,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}var Bi=[],Fi=0,Mo=null,ko=0,rr=[],sr=0,ci=null,ss=1,is="";function ui(t,r){Bi[Fi++]=ko,Bi[Fi++]=Mo,Mo=t,ko=r}function _d(t,r,i){rr[sr++]=ss,rr[sr++]=is,rr[sr++]=ci,ci=t;var c=ss;t=is;var d=32-et(c)-1;c&=~(1<<d),i+=1;var m=32-et(r)+d;if(30<m){var C=d-d%5;m=(c&(1<<C)-1).toString(32),c>>=C,d-=C,ss=1<<32-et(r)+d|i<<d|c,is=m+t}else ss=1<<m|i<<d|c,is=t}function $c(t){t.return!==null&&(ui(t,1),_d(t,1,0))}function Wc(t){for(;t===Mo;)Mo=Bi[--Fi],Bi[Fi]=null,ko=Bi[--Fi],Bi[Fi]=null;for(;t===ci;)ci=rr[--sr],rr[sr]=null,is=rr[--sr],rr[sr]=null,ss=rr[--sr],rr[sr]=null}var pa=null,fn=null,jt=!1,fi=null,Fr=!1,Zc=Error(s(519));function di(t){var r=Error(s(418,""));throw Sl(nr(r,t)),Zc}function Od(t){var r=t.stateNode,i=t.type,c=t.memoizedProps;switch(r[Ut]=t,r[Wt]=c,i){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(i=0;i<Vl.length;i++)Mt(Vl[i],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":Mt("invalid",r),ei(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),Mr(r);break;case"select":Mt("invalid",r);break;case"textarea":Mt("invalid",r),ti(r,c.value,c.defaultValue,c.children),Mr(r)}i=c.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||r.textContent===""+i||c.suppressHydrationWarning===!0||Zh(r.textContent,i)?(c.popover!=null&&(Mt("beforetoggle",r),Mt("toggle",r)),c.onScroll!=null&&Mt("scroll",r),c.onScrollEnd!=null&&Mt("scrollend",r),c.onClick!=null&&(r.onclick=oc),r=!0):r=!1,r||di(t)}function Id(t){for(pa=t.return;pa;)switch(pa.tag){case 5:case 13:Fr=!1;return;case 27:case 3:Fr=!0;return;default:pa=pa.return}}function bl(t){if(t!==pa)return!1;if(!jt)return Id(t),jt=!0,!1;var r=t.tag,i;if((i=r!==3&&r!==27)&&((i=r===5)&&(i=t.type,i=!(i!=="form"&&i!=="button")||pf(t.type,t.memoizedProps)),i=!i),i&&fn&&di(t),Id(t),r===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8)if(i=t.data,i==="/$"){if(r===0){fn=vr(t.nextSibling);break e}r--}else i!=="$"&&i!=="$!"&&i!=="$?"||r++;t=t.nextSibling}fn=null}}else r===27?(r=fn,zs(t.type)?(t=yf,yf=null,fn=t):fn=r):fn=pa?vr(t.stateNode.nextSibling):null;return!0}function xl(){fn=pa=null,jt=!1}function Ld(){var t=fi;return t!==null&&(Ma===null?Ma=t:Ma.push.apply(Ma,t),fi=null),t}function Sl(t){fi===null?fi=[t]:fi.push(t)}var Qc=J(null),pi=null,ls=null;function Cs(t,r,i){Ae(Qc,r._currentValue),r._currentValue=i}function os(t){t._currentValue=Qc.current,Se(Qc)}function Kc(t,r,i){for(;t!==null;){var c=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),t===i)break;t=t.return}}function Jc(t,r,i,c){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var m=d.dependencies;if(m!==null){var C=d.child;m=m.firstContext;e:for(;m!==null;){var F=m;m=d;for(var ne=0;ne<r.length;ne++)if(F.context===r[ne]){m.lanes|=i,F=m.alternate,F!==null&&(F.lanes|=i),Kc(m.return,i,t),c||(C=null);break e}m=F.next}}else if(d.tag===18){if(C=d.return,C===null)throw Error(s(341));C.lanes|=i,m=C.alternate,m!==null&&(m.lanes|=i),Kc(C,i,t),C=null}else C=d.child;if(C!==null)C.return=d;else for(C=d;C!==null;){if(C===t){C=null;break}if(d=C.sibling,d!==null){d.return=C.return,C=d;break}C=C.return}d=C}}function wl(t,r,i,c){t=null;for(var d=r,m=!1;d!==null;){if(!m){if((d.flags&524288)!==0)m=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var C=d.alternate;if(C===null)throw Error(s(387));if(C=C.memoizedProps,C!==null){var F=d.type;qn(d.pendingProps.value,C.value)||(t!==null?t.push(F):t=[F])}}else if(d===pt.current){if(C=d.alternate,C===null)throw Error(s(387));C.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push(Ql):t=[Ql])}d=d.return}t!==null&&Jc(r,t,i,c),r.flags|=262144}function No(t){for(t=t.firstContext;t!==null;){if(!qn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function hi(t){pi=t,ls=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ra(t){return jd(pi,t)}function Ro(t,r){return pi===null&&hi(t),jd(t,r)}function jd(t,r){var i=r._currentValue;if(r={context:r,memoizedValue:i,next:null},ls===null){if(t===null)throw Error(s(308));ls=r,t.dependencies={lanes:0,firstContext:r},t.flags|=524288}else ls=ls.next=r;return i}var ry=typeof AbortController<"u"?AbortController:function(){var t=[],r=this.signal={aborted:!1,addEventListener:function(i,c){t.push(c)}};this.abort=function(){r.aborted=!0,t.forEach(function(i){return i()})}},sy=n.unstable_scheduleCallback,iy=n.unstable_NormalPriority,_n={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function eu(){return{controller:new ry,data:new Map,refCount:0}}function El(t){t.refCount--,t.refCount===0&&sy(iy,function(){t.controller.abort()})}var Al=null,tu=0,Pi=0,zi=null;function ly(t,r){if(Al===null){var i=Al=[];tu=0,Pi=af(),zi={status:"pending",value:void 0,then:function(c){i.push(c)}}}return tu++,r.then(Ud,Ud),r}function Ud(){if(--tu===0&&Al!==null){zi!==null&&(zi.status="fulfilled");var t=Al;Al=null,Pi=0,zi=null;for(var r=0;r<t.length;r++)(0,t[r])()}}function oy(t,r){var i=[],c={status:"pending",value:null,reason:null,then:function(d){i.push(d)}};return t.then(function(){c.status="fulfilled",c.value=r;for(var d=0;d<i.length;d++)(0,i[d])(r)},function(d){for(c.status="rejected",c.reason=d,d=0;d<i.length;d++)(0,i[d])(void 0)}),c}var Bd=V.S;V.S=function(t,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&ly(t,r),Bd!==null&&Bd(t,r)};var mi=J(null);function nu(){var t=mi.current;return t!==null?t:Qt.pooledCache}function Do(t,r){r===null?Ae(mi,mi.current):Ae(mi,r.pool)}function Fd(){var t=nu();return t===null?null:{parent:_n._currentValue,pool:t}}var Tl=Error(s(460)),Pd=Error(s(474)),_o=Error(s(542)),au={then:function(){}};function zd(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Oo(){}function Gd(t,r,i){switch(i=t[i],i===void 0?t.push(r):i!==r&&(r.then(Oo,Oo),r=i),r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Yd(t),t;default:if(typeof r.status=="string")r.then(Oo,Oo);else{if(t=Qt,t!==null&&100<t.shellSuspendCounter)throw Error(s(482));t=r,t.status="pending",t.then(function(c){if(r.status==="pending"){var d=r;d.status="fulfilled",d.value=c}},function(c){if(r.status==="pending"){var d=r;d.status="rejected",d.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Yd(t),t}throw Cl=r,Tl}}var Cl=null;function Hd(){if(Cl===null)throw Error(s(459));var t=Cl;return Cl=null,t}function Yd(t){if(t===Tl||t===_o)throw Error(s(483))}var Ms=!1;function ru(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function su(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ks(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ns(t,r,i){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,(Ft&2)!==0){var d=c.pending;return d===null?r.next=r:(r.next=d.next,d.next=r),c.pending=r,r=To(t),Rd(t,null,i),r}return Ao(t,c,r,i),To(t)}function Ml(t,r,i){if(r=r.updateQueue,r!==null&&(r=r.shared,(i&4194048)!==0)){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Mi(t,i)}}function iu(t,r){var i=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,i===c)){var d=null,m=null;if(i=i.firstBaseUpdate,i!==null){do{var C={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};m===null?d=m=C:m=m.next=C,i=i.next}while(i!==null);m===null?d=m=r:m=m.next=r}else d=m=r;i={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:c.shared,callbacks:c.callbacks},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=r:t.next=r,i.lastBaseUpdate=r}var lu=!1;function kl(){if(lu){var t=zi;if(t!==null)throw t}}function Nl(t,r,i,c){lu=!1;var d=t.updateQueue;Ms=!1;var m=d.firstBaseUpdate,C=d.lastBaseUpdate,F=d.shared.pending;if(F!==null){d.shared.pending=null;var ne=F,he=ne.next;ne.next=null,C===null?m=he:C.next=he,C=ne;var Ee=t.alternate;Ee!==null&&(Ee=Ee.updateQueue,F=Ee.lastBaseUpdate,F!==C&&(F===null?Ee.firstBaseUpdate=he:F.next=he,Ee.lastBaseUpdate=ne))}if(m!==null){var Re=d.baseState;C=0,Ee=he=ne=null,F=m;do{var ye=F.lane&-536870913,ve=ye!==F.lane;if(ve?(Rt&ye)===ye:(c&ye)===ye){ye!==0&&ye===Pi&&(lu=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var dt=t,ot=F;ye=r;var Yt=i;switch(ot.tag){case 1:if(dt=ot.payload,typeof dt=="function"){Re=dt.call(Yt,Re,ye);break e}Re=dt;break e;case 3:dt.flags=dt.flags&-65537|128;case 0:if(dt=ot.payload,ye=typeof dt=="function"?dt.call(Yt,Re,ye):dt,ye==null)break e;Re=v({},Re,ye);break e;case 2:Ms=!0}}ye=F.callback,ye!==null&&(t.flags|=64,ve&&(t.flags|=8192),ve=d.callbacks,ve===null?d.callbacks=[ye]:ve.push(ye))}else ve={lane:ye,tag:F.tag,payload:F.payload,callback:F.callback,next:null},Ee===null?(he=Ee=ve,ne=Re):Ee=Ee.next=ve,C|=ye;if(F=F.next,F===null){if(F=d.shared.pending,F===null)break;ve=F,F=ve.next,ve.next=null,d.lastBaseUpdate=ve,d.shared.pending=null}}while(!0);Ee===null&&(ne=Re),d.baseState=ne,d.firstBaseUpdate=he,d.lastBaseUpdate=Ee,m===null&&(d.shared.lanes=0),Us|=C,t.lanes=C,t.memoizedState=Re}}function Vd(t,r){if(typeof t!="function")throw Error(s(191,t));t.call(r)}function qd(t,r){var i=t.callbacks;if(i!==null)for(t.callbacks=null,t=0;t<i.length;t++)Vd(i[t],r)}var Gi=J(null),Io=J(0);function Xd(t,r){t=ms,Ae(Io,t),Ae(Gi,r),ms=t|r.baseLanes}function ou(){Ae(Io,ms),Ae(Gi,Gi.current)}function cu(){ms=Io.current,Se(Gi),Se(Io)}var Rs=0,St=null,Gt=null,wn=null,Lo=!1,Hi=!1,gi=!1,jo=0,Rl=0,Yi=null,cy=0;function mn(){throw Error(s(321))}function uu(t,r){if(r===null)return!1;for(var i=0;i<r.length&&i<t.length;i++)if(!qn(t[i],r[i]))return!1;return!0}function fu(t,r,i,c,d,m){return Rs=m,St=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,V.H=t===null||t.memoizedState===null?Rp:Dp,gi=!1,m=i(c,d),gi=!1,Hi&&(m=Wd(r,i,c,d)),$d(t),m}function $d(t){V.H=Go;var r=Gt!==null&&Gt.next!==null;if(Rs=0,wn=Gt=St=null,Lo=!1,Rl=0,Yi=null,r)throw Error(s(300));t===null||Un||(t=t.dependencies,t!==null&&No(t)&&(Un=!0))}function Wd(t,r,i,c){St=t;var d=0;do{if(Hi&&(Yi=null),Rl=0,Hi=!1,25<=d)throw Error(s(301));if(d+=1,wn=Gt=null,t.updateQueue!=null){var m=t.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}V.H=gy,m=r(i,c)}while(Hi);return m}function uy(){var t=V.H,r=t.useState()[0];return r=typeof r.then=="function"?Dl(r):r,t=t.useState()[0],(Gt!==null?Gt.memoizedState:null)!==t&&(St.flags|=1024),r}function du(){var t=jo!==0;return jo=0,t}function pu(t,r,i){r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~i}function hu(t){if(Lo){for(t=t.memoizedState;t!==null;){var r=t.queue;r!==null&&(r.pending=null),t=t.next}Lo=!1}Rs=0,wn=Gt=St=null,Hi=!1,Rl=jo=0,Yi=null}function Ta(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wn===null?St.memoizedState=wn=t:wn=wn.next=t,wn}function En(){if(Gt===null){var t=St.alternate;t=t!==null?t.memoizedState:null}else t=Gt.next;var r=wn===null?St.memoizedState:wn.next;if(r!==null)wn=r,Gt=t;else{if(t===null)throw St.alternate===null?Error(s(467)):Error(s(310));Gt=t,t={memoizedState:Gt.memoizedState,baseState:Gt.baseState,baseQueue:Gt.baseQueue,queue:Gt.queue,next:null},wn===null?St.memoizedState=wn=t:wn=wn.next=t}return wn}function mu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Dl(t){var r=Rl;return Rl+=1,Yi===null&&(Yi=[]),t=Gd(Yi,t,r),r=St,(wn===null?r.memoizedState:wn.next)===null&&(r=r.alternate,V.H=r===null||r.memoizedState===null?Rp:Dp),t}function Uo(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Dl(t);if(t.$$typeof===_)return ra(t)}throw Error(s(438,String(t)))}function gu(t){var r=null,i=St.updateQueue;if(i!==null&&(r=i.memoCache),r==null){var c=St.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(d){return d.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),i===null&&(i=mu(),St.updateQueue=i),i.memoCache=r,i=r.data[r.index],i===void 0)for(i=r.data[r.index]=Array(t),c=0;c<t;c++)i[c]=W;return r.index++,i}function cs(t,r){return typeof r=="function"?r(t):r}function Bo(t){var r=En();return yu(r,Gt,t)}function yu(t,r,i){var c=t.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=i;var d=t.baseQueue,m=c.pending;if(m!==null){if(d!==null){var C=d.next;d.next=m.next,m.next=C}r.baseQueue=d=m,c.pending=null}if(m=t.baseState,d===null)t.memoizedState=m;else{r=d.next;var F=C=null,ne=null,he=r,Ee=!1;do{var Re=he.lane&-536870913;if(Re!==he.lane?(Rt&Re)===Re:(Rs&Re)===Re){var ye=he.revertLane;if(ye===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),Re===Pi&&(Ee=!0);else if((Rs&ye)===ye){he=he.next,ye===Pi&&(Ee=!0);continue}else Re={lane:0,revertLane:he.revertLane,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},ne===null?(F=ne=Re,C=m):ne=ne.next=Re,St.lanes|=ye,Us|=ye;Re=he.action,gi&&i(m,Re),m=he.hasEagerState?he.eagerState:i(m,Re)}else ye={lane:Re,revertLane:he.revertLane,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},ne===null?(F=ne=ye,C=m):ne=ne.next=ye,St.lanes|=Re,Us|=Re;he=he.next}while(he!==null&&he!==r);if(ne===null?C=m:ne.next=F,!qn(m,t.memoizedState)&&(Un=!0,Ee&&(i=zi,i!==null)))throw i;t.memoizedState=m,t.baseState=C,t.baseQueue=ne,c.lastRenderedState=m}return d===null&&(c.lanes=0),[t.memoizedState,c.dispatch]}function vu(t){var r=En(),i=r.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=t;var c=i.dispatch,d=i.pending,m=r.memoizedState;if(d!==null){i.pending=null;var C=d=d.next;do m=t(m,C.action),C=C.next;while(C!==d);qn(m,r.memoizedState)||(Un=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),i.lastRenderedState=m}return[m,c]}function Zd(t,r,i){var c=St,d=En(),m=jt;if(m){if(i===void 0)throw Error(s(407));i=i()}else i=r();var C=!qn((Gt||d).memoizedState,i);C&&(d.memoizedState=i,Un=!0),d=d.queue;var F=Jd.bind(null,c,d,t);if(_l(2048,8,F,[t]),d.getSnapshot!==r||C||wn!==null&&wn.memoizedState.tag&1){if(c.flags|=2048,Vi(9,Fo(),Kd.bind(null,c,d,i,r),null),Qt===null)throw Error(s(349));m||(Rs&124)!==0||Qd(c,r,i)}return i}function Qd(t,r,i){t.flags|=16384,t={getSnapshot:r,value:i},r=St.updateQueue,r===null?(r=mu(),St.updateQueue=r,r.stores=[t]):(i=r.stores,i===null?r.stores=[t]:i.push(t))}function Kd(t,r,i,c){r.value=i,r.getSnapshot=c,ep(r)&&tp(t)}function Jd(t,r,i){return i(function(){ep(r)&&tp(t)})}function ep(t){var r=t.getSnapshot;t=t.value;try{var i=r();return!qn(t,i)}catch{return!0}}function tp(t){var r=ji(t,2);r!==null&&Ga(r,t,2)}function bu(t){var r=Ta();if(typeof t=="function"){var i=t;if(t=i(),gi){Lt(!0);try{i()}finally{Lt(!1)}}}return r.memoizedState=r.baseState=t,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cs,lastRenderedState:t},r}function np(t,r,i,c){return t.baseState=i,yu(t,Gt,typeof c=="function"?c:cs)}function fy(t,r,i,c,d){if(zo(t))throw Error(s(485));if(t=r.action,t!==null){var m={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){m.listeners.push(C)}};V.T!==null?i(!0):m.isTransition=!1,c(m),i=r.pending,i===null?(m.next=r.pending=m,ap(r,m)):(m.next=i.next,r.pending=i.next=m)}}function ap(t,r){var i=r.action,c=r.payload,d=t.state;if(r.isTransition){var m=V.T,C={};V.T=C;try{var F=i(d,c),ne=V.S;ne!==null&&ne(C,F),rp(t,r,F)}catch(he){xu(t,r,he)}finally{V.T=m}}else try{m=i(d,c),rp(t,r,m)}catch(he){xu(t,r,he)}}function rp(t,r,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(c){sp(t,r,c)},function(c){return xu(t,r,c)}):sp(t,r,i)}function sp(t,r,i){r.status="fulfilled",r.value=i,ip(r),t.state=i,r=t.pending,r!==null&&(i=r.next,i===r?t.pending=null:(i=i.next,r.next=i,ap(t,i)))}function xu(t,r,i){var c=t.pending;if(t.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=i,ip(r),r=r.next;while(r!==c)}t.action=null}function ip(t){t=t.listeners;for(var r=0;r<t.length;r++)(0,t[r])()}function lp(t,r){return r}function op(t,r){if(jt){var i=Qt.formState;if(i!==null){e:{var c=St;if(jt){if(fn){t:{for(var d=fn,m=Fr;d.nodeType!==8;){if(!m){d=null;break t}if(d=vr(d.nextSibling),d===null){d=null;break t}}m=d.data,d=m==="F!"||m==="F"?d:null}if(d){fn=vr(d.nextSibling),c=d.data==="F!";break e}}di(c)}c=!1}c&&(r=i[0])}}return i=Ta(),i.memoizedState=i.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lp,lastRenderedState:r},i.queue=c,i=Mp.bind(null,St,c),c.dispatch=i,c=bu(!1),m=Tu.bind(null,St,!1,c.queue),c=Ta(),d={state:r,dispatch:null,action:t,pending:null},c.queue=d,i=fy.bind(null,St,d,m,i),d.dispatch=i,c.memoizedState=t,[r,i,!1]}function cp(t){var r=En();return up(r,Gt,t)}function up(t,r,i){if(r=yu(t,r,lp)[0],t=Bo(cs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Dl(r)}catch(C){throw C===Tl?_o:C}else c=r;r=En();var d=r.queue,m=d.dispatch;return i!==r.memoizedState&&(St.flags|=2048,Vi(9,Fo(),dy.bind(null,d,i),null)),[c,m,t]}function dy(t,r){t.action=r}function fp(t){var r=En(),i=Gt;if(i!==null)return up(r,i,t);En(),r=r.memoizedState,i=En();var c=i.queue.dispatch;return i.memoizedState=t,[r,c,!1]}function Vi(t,r,i,c){return t={tag:t,create:i,deps:c,inst:r,next:null},r=St.updateQueue,r===null&&(r=mu(),St.updateQueue=r),i=r.lastEffect,i===null?r.lastEffect=t.next=t:(c=i.next,i.next=t,t.next=c,r.lastEffect=t),t}function Fo(){return{destroy:void 0,resource:void 0}}function dp(){return En().memoizedState}function Po(t,r,i,c){var d=Ta();c=c===void 0?null:c,St.flags|=t,d.memoizedState=Vi(1|r,Fo(),i,c)}function _l(t,r,i,c){var d=En();c=c===void 0?null:c;var m=d.memoizedState.inst;Gt!==null&&c!==null&&uu(c,Gt.memoizedState.deps)?d.memoizedState=Vi(r,m,i,c):(St.flags|=t,d.memoizedState=Vi(1|r,m,i,c))}function pp(t,r){Po(8390656,8,t,r)}function hp(t,r){_l(2048,8,t,r)}function mp(t,r){return _l(4,2,t,r)}function gp(t,r){return _l(4,4,t,r)}function yp(t,r){if(typeof r=="function"){t=t();var i=r(t);return function(){typeof i=="function"?i():r(null)}}if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function vp(t,r,i){i=i!=null?i.concat([t]):null,_l(4,4,yp.bind(null,r,t),i)}function Su(){}function bp(t,r){var i=En();r=r===void 0?null:r;var c=i.memoizedState;return r!==null&&uu(r,c[1])?c[0]:(i.memoizedState=[t,r],t)}function xp(t,r){var i=En();r=r===void 0?null:r;var c=i.memoizedState;if(r!==null&&uu(r,c[1]))return c[0];if(c=t(),gi){Lt(!0);try{t()}finally{Lt(!1)}}return i.memoizedState=[c,r],c}function wu(t,r,i){return i===void 0||(Rs&1073741824)!==0?t.memoizedState=r:(t.memoizedState=i,t=Eh(),St.lanes|=t,Us|=t,i)}function Sp(t,r,i,c){return qn(i,r)?i:Gi.current!==null?(t=wu(t,i,c),qn(t,r)||(Un=!0),t):(Rs&42)===0?(Un=!0,t.memoizedState=i):(t=Eh(),St.lanes|=t,Us|=t,r)}function wp(t,r,i,c,d){var m=ee.p;ee.p=m!==0&&8>m?m:8;var C=V.T,F={};V.T=F,Tu(t,!1,r,i);try{var ne=d(),he=V.S;if(he!==null&&he(F,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Ee=oy(ne,c);Ol(t,r,Ee,za(t))}else Ol(t,r,c,za(t))}catch(Re){Ol(t,r,{then:function(){},status:"rejected",reason:Re},za())}finally{ee.p=m,V.T=C}}function py(){}function Eu(t,r,i,c){if(t.tag!==5)throw Error(s(476));var d=Ep(t).queue;wp(t,d,r,se,i===null?py:function(){return Ap(t),i(c)})}function Ep(t){var r=t.memoizedState;if(r!==null)return r;r={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cs,lastRenderedState:se},next:null};var i={};return r.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cs,lastRenderedState:i},next:null},t.memoizedState=r,t=t.alternate,t!==null&&(t.memoizedState=r),r}function Ap(t){var r=Ep(t).next.queue;Ol(t,r,{},za())}function Au(){return ra(Ql)}function Tp(){return En().memoizedState}function Cp(){return En().memoizedState}function hy(t){for(var r=t.return;r!==null;){switch(r.tag){case 24:case 3:var i=za();t=ks(i);var c=Ns(r,t,i);c!==null&&(Ga(c,r,i),Ml(c,r,i)),r={cache:eu()},t.payload=r;return}r=r.return}}function my(t,r,i){var c=za();i={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},zo(t)?kp(r,i):(i=Yc(t,r,i,c),i!==null&&(Ga(i,t,c),Np(i,r,c)))}function Mp(t,r,i){var c=za();Ol(t,r,i,c)}function Ol(t,r,i,c){var d={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(zo(t))kp(r,d);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var C=r.lastRenderedState,F=m(C,i);if(d.hasEagerState=!0,d.eagerState=F,qn(F,C))return Ao(t,r,d,0),Qt===null&&Eo(),!1}catch{}if(i=Yc(t,r,d,c),i!==null)return Ga(i,t,c),Np(i,r,c),!0}return!1}function Tu(t,r,i,c){if(c={lane:2,revertLane:af(),action:c,hasEagerState:!1,eagerState:null,next:null},zo(t)){if(r)throw Error(s(479))}else r=Yc(t,i,c,2),r!==null&&Ga(r,t,2)}function zo(t){var r=t.alternate;return t===St||r!==null&&r===St}function kp(t,r){Hi=Lo=!0;var i=t.pending;i===null?r.next=r:(r.next=i.next,i.next=r),t.pending=r}function Np(t,r,i){if((i&4194048)!==0){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Mi(t,i)}}var Go={readContext:ra,use:Uo,useCallback:mn,useContext:mn,useEffect:mn,useImperativeHandle:mn,useLayoutEffect:mn,useInsertionEffect:mn,useMemo:mn,useReducer:mn,useRef:mn,useState:mn,useDebugValue:mn,useDeferredValue:mn,useTransition:mn,useSyncExternalStore:mn,useId:mn,useHostTransitionStatus:mn,useFormState:mn,useActionState:mn,useOptimistic:mn,useMemoCache:mn,useCacheRefresh:mn},Rp={readContext:ra,use:Uo,useCallback:function(t,r){return Ta().memoizedState=[t,r===void 0?null:r],t},useContext:ra,useEffect:pp,useImperativeHandle:function(t,r,i){i=i!=null?i.concat([t]):null,Po(4194308,4,yp.bind(null,r,t),i)},useLayoutEffect:function(t,r){return Po(4194308,4,t,r)},useInsertionEffect:function(t,r){Po(4,2,t,r)},useMemo:function(t,r){var i=Ta();r=r===void 0?null:r;var c=t();if(gi){Lt(!0);try{t()}finally{Lt(!1)}}return i.memoizedState=[c,r],c},useReducer:function(t,r,i){var c=Ta();if(i!==void 0){var d=i(r);if(gi){Lt(!0);try{i(r)}finally{Lt(!1)}}}else d=r;return c.memoizedState=c.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},c.queue=t,t=t.dispatch=my.bind(null,St,t),[c.memoizedState,t]},useRef:function(t){var r=Ta();return t={current:t},r.memoizedState=t},useState:function(t){t=bu(t);var r=t.queue,i=Mp.bind(null,St,r);return r.dispatch=i,[t.memoizedState,i]},useDebugValue:Su,useDeferredValue:function(t,r){var i=Ta();return wu(i,t,r)},useTransition:function(){var t=bu(!1);return t=wp.bind(null,St,t.queue,!0,!1),Ta().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,r,i){var c=St,d=Ta();if(jt){if(i===void 0)throw Error(s(407));i=i()}else{if(i=r(),Qt===null)throw Error(s(349));(Rt&124)!==0||Qd(c,r,i)}d.memoizedState=i;var m={value:i,getSnapshot:r};return d.queue=m,pp(Jd.bind(null,c,m,t),[t]),c.flags|=2048,Vi(9,Fo(),Kd.bind(null,c,m,i,r),null),i},useId:function(){var t=Ta(),r=Qt.identifierPrefix;if(jt){var i=is,c=ss;i=(c&~(1<<32-et(c)-1)).toString(32)+i,r=""+r+"R"+i,i=jo++,0<i&&(r+="H"+i.toString(32)),r+=""}else i=cy++,r=""+r+"r"+i.toString(32)+"";return t.memoizedState=r},useHostTransitionStatus:Au,useFormState:op,useActionState:op,useOptimistic:function(t){var r=Ta();r.memoizedState=r.baseState=t;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=i,r=Tu.bind(null,St,!0,i),i.dispatch=r,[t,r]},useMemoCache:gu,useCacheRefresh:function(){return Ta().memoizedState=hy.bind(null,St)}},Dp={readContext:ra,use:Uo,useCallback:bp,useContext:ra,useEffect:hp,useImperativeHandle:vp,useInsertionEffect:mp,useLayoutEffect:gp,useMemo:xp,useReducer:Bo,useRef:dp,useState:function(){return Bo(cs)},useDebugValue:Su,useDeferredValue:function(t,r){var i=En();return Sp(i,Gt.memoizedState,t,r)},useTransition:function(){var t=Bo(cs)[0],r=En().memoizedState;return[typeof t=="boolean"?t:Dl(t),r]},useSyncExternalStore:Zd,useId:Tp,useHostTransitionStatus:Au,useFormState:cp,useActionState:cp,useOptimistic:function(t,r){var i=En();return np(i,Gt,t,r)},useMemoCache:gu,useCacheRefresh:Cp},gy={readContext:ra,use:Uo,useCallback:bp,useContext:ra,useEffect:hp,useImperativeHandle:vp,useInsertionEffect:mp,useLayoutEffect:gp,useMemo:xp,useReducer:vu,useRef:dp,useState:function(){return vu(cs)},useDebugValue:Su,useDeferredValue:function(t,r){var i=En();return Gt===null?wu(i,t,r):Sp(i,Gt.memoizedState,t,r)},useTransition:function(){var t=vu(cs)[0],r=En().memoizedState;return[typeof t=="boolean"?t:Dl(t),r]},useSyncExternalStore:Zd,useId:Tp,useHostTransitionStatus:Au,useFormState:fp,useActionState:fp,useOptimistic:function(t,r){var i=En();return Gt!==null?np(i,Gt,t,r):(i.baseState=t,[t,i.queue.dispatch])},useMemoCache:gu,useCacheRefresh:Cp},qi=null,Il=0;function Ho(t){var r=Il;return Il+=1,qi===null&&(qi=[]),Gd(qi,t,r)}function Ll(t,r){r=r.props.ref,t.ref=r!==void 0?r:null}function Yo(t,r){throw r.$$typeof===A?Error(s(525)):(t=Object.prototype.toString.call(r),Error(s(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t)))}function _p(t){var r=t._init;return r(t._payload)}function Op(t){function r(ue,le){if(t){var pe=ue.deletions;pe===null?(ue.deletions=[le],ue.flags|=16):pe.push(le)}}function i(ue,le){if(!t)return null;for(;le!==null;)r(ue,le),le=le.sibling;return null}function c(ue){for(var le=new Map;ue!==null;)ue.key!==null?le.set(ue.key,ue):le.set(ue.index,ue),ue=ue.sibling;return le}function d(ue,le){return ue=rs(ue,le),ue.index=0,ue.sibling=null,ue}function m(ue,le,pe){return ue.index=pe,t?(pe=ue.alternate,pe!==null?(pe=pe.index,pe<le?(ue.flags|=67108866,le):pe):(ue.flags|=67108866,le)):(ue.flags|=1048576,le)}function C(ue){return t&&ue.alternate===null&&(ue.flags|=67108866),ue}function F(ue,le,pe,Ce){return le===null||le.tag!==6?(le=qc(pe,ue.mode,Ce),le.return=ue,le):(le=d(le,pe),le.return=ue,le)}function ne(ue,le,pe,Ce){var We=pe.type;return We===M?Ee(ue,le,pe.props.children,Ce,pe.key):le!==null&&(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===te&&_p(We)===le.type)?(le=d(le,pe.props),Ll(le,pe),le.return=ue,le):(le=Co(pe.type,pe.key,pe.props,null,ue.mode,Ce),Ll(le,pe),le.return=ue,le)}function he(ue,le,pe,Ce){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=Xc(pe,ue.mode,Ce),le.return=ue,le):(le=d(le,pe.children||[]),le.return=ue,le)}function Ee(ue,le,pe,Ce,We){return le===null||le.tag!==7?(le=oi(pe,ue.mode,Ce,We),le.return=ue,le):(le=d(le,pe),le.return=ue,le)}function Re(ue,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=qc(""+le,ue.mode,pe),le.return=ue,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case S:return pe=Co(le.type,le.key,le.props,null,ue.mode,pe),Ll(pe,le),pe.return=ue,pe;case b:return le=Xc(le,ue.mode,pe),le.return=ue,le;case te:var Ce=le._init;return le=Ce(le._payload),Re(ue,le,pe)}if(re(le)||$(le))return le=oi(le,ue.mode,pe,null),le.return=ue,le;if(typeof le.then=="function")return Re(ue,Ho(le),pe);if(le.$$typeof===_)return Re(ue,Ro(ue,le),pe);Yo(ue,le)}return null}function ye(ue,le,pe,Ce){var We=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return We!==null?null:F(ue,le,""+pe,Ce);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case S:return pe.key===We?ne(ue,le,pe,Ce):null;case b:return pe.key===We?he(ue,le,pe,Ce):null;case te:return We=pe._init,pe=We(pe._payload),ye(ue,le,pe,Ce)}if(re(pe)||$(pe))return We!==null?null:Ee(ue,le,pe,Ce,null);if(typeof pe.then=="function")return ye(ue,le,Ho(pe),Ce);if(pe.$$typeof===_)return ye(ue,le,Ro(ue,pe),Ce);Yo(ue,pe)}return null}function ve(ue,le,pe,Ce,We){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return ue=ue.get(pe)||null,F(le,ue,""+Ce,We);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case S:return ue=ue.get(Ce.key===null?pe:Ce.key)||null,ne(le,ue,Ce,We);case b:return ue=ue.get(Ce.key===null?pe:Ce.key)||null,he(le,ue,Ce,We);case te:var Et=Ce._init;return Ce=Et(Ce._payload),ve(ue,le,pe,Ce,We)}if(re(Ce)||$(Ce))return ue=ue.get(pe)||null,Ee(le,ue,Ce,We,null);if(typeof Ce.then=="function")return ve(ue,le,pe,Ho(Ce),We);if(Ce.$$typeof===_)return ve(ue,le,pe,Ro(le,Ce),We);Yo(le,Ce)}return null}function dt(ue,le,pe,Ce){for(var We=null,Et=null,tt=le,ut=le=0,Fn=null;tt!==null&&ut<pe.length;ut++){tt.index>ut?(Fn=tt,tt=null):Fn=tt.sibling;var _t=ye(ue,tt,pe[ut],Ce);if(_t===null){tt===null&&(tt=Fn);break}t&&tt&&_t.alternate===null&&r(ue,tt),le=m(_t,le,ut),Et===null?We=_t:Et.sibling=_t,Et=_t,tt=Fn}if(ut===pe.length)return i(ue,tt),jt&&ui(ue,ut),We;if(tt===null){for(;ut<pe.length;ut++)tt=Re(ue,pe[ut],Ce),tt!==null&&(le=m(tt,le,ut),Et===null?We=tt:Et.sibling=tt,Et=tt);return jt&&ui(ue,ut),We}for(tt=c(tt);ut<pe.length;ut++)Fn=ve(tt,ue,ut,pe[ut],Ce),Fn!==null&&(t&&Fn.alternate!==null&&tt.delete(Fn.key===null?ut:Fn.key),le=m(Fn,le,ut),Et===null?We=Fn:Et.sibling=Fn,Et=Fn);return t&&tt.forEach(function(qs){return r(ue,qs)}),jt&&ui(ue,ut),We}function ot(ue,le,pe,Ce){if(pe==null)throw Error(s(151));for(var We=null,Et=null,tt=le,ut=le=0,Fn=null,_t=pe.next();tt!==null&&!_t.done;ut++,_t=pe.next()){tt.index>ut?(Fn=tt,tt=null):Fn=tt.sibling;var qs=ye(ue,tt,_t.value,Ce);if(qs===null){tt===null&&(tt=Fn);break}t&&tt&&qs.alternate===null&&r(ue,tt),le=m(qs,le,ut),Et===null?We=qs:Et.sibling=qs,Et=qs,tt=Fn}if(_t.done)return i(ue,tt),jt&&ui(ue,ut),We;if(tt===null){for(;!_t.done;ut++,_t=pe.next())_t=Re(ue,_t.value,Ce),_t!==null&&(le=m(_t,le,ut),Et===null?We=_t:Et.sibling=_t,Et=_t);return jt&&ui(ue,ut),We}for(tt=c(tt);!_t.done;ut++,_t=pe.next())_t=ve(tt,ue,ut,_t.value,Ce),_t!==null&&(t&&_t.alternate!==null&&tt.delete(_t.key===null?ut:_t.key),le=m(_t,le,ut),Et===null?We=_t:Et.sibling=_t,Et=_t);return t&&tt.forEach(function(y1){return r(ue,y1)}),jt&&ui(ue,ut),We}function Yt(ue,le,pe,Ce){if(typeof pe=="object"&&pe!==null&&pe.type===M&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case S:e:{for(var We=pe.key;le!==null;){if(le.key===We){if(We=pe.type,We===M){if(le.tag===7){i(ue,le.sibling),Ce=d(le,pe.props.children),Ce.return=ue,ue=Ce;break e}}else if(le.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===te&&_p(We)===le.type){i(ue,le.sibling),Ce=d(le,pe.props),Ll(Ce,pe),Ce.return=ue,ue=Ce;break e}i(ue,le);break}else r(ue,le);le=le.sibling}pe.type===M?(Ce=oi(pe.props.children,ue.mode,Ce,pe.key),Ce.return=ue,ue=Ce):(Ce=Co(pe.type,pe.key,pe.props,null,ue.mode,Ce),Ll(Ce,pe),Ce.return=ue,ue=Ce)}return C(ue);case b:e:{for(We=pe.key;le!==null;){if(le.key===We)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){i(ue,le.sibling),Ce=d(le,pe.children||[]),Ce.return=ue,ue=Ce;break e}else{i(ue,le);break}else r(ue,le);le=le.sibling}Ce=Xc(pe,ue.mode,Ce),Ce.return=ue,ue=Ce}return C(ue);case te:return We=pe._init,pe=We(pe._payload),Yt(ue,le,pe,Ce)}if(re(pe))return dt(ue,le,pe,Ce);if($(pe)){if(We=$(pe),typeof We!="function")throw Error(s(150));return pe=We.call(pe),ot(ue,le,pe,Ce)}if(typeof pe.then=="function")return Yt(ue,le,Ho(pe),Ce);if(pe.$$typeof===_)return Yt(ue,le,Ro(ue,pe),Ce);Yo(ue,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(i(ue,le.sibling),Ce=d(le,pe),Ce.return=ue,ue=Ce):(i(ue,le),Ce=qc(pe,ue.mode,Ce),Ce.return=ue,ue=Ce),C(ue)):i(ue,le)}return function(ue,le,pe,Ce){try{Il=0;var We=Yt(ue,le,pe,Ce);return qi=null,We}catch(tt){if(tt===Tl||tt===_o)throw tt;var Et=Ua(29,tt,null,ue.mode);return Et.lanes=Ce,Et.return=ue,Et}}}var Xi=Op(!0),Ip=Op(!1),ir=J(null),Pr=null;function Ds(t){var r=t.alternate;Ae(On,On.current&1),Ae(ir,t),Pr===null&&(r===null||Gi.current!==null||r.memoizedState!==null)&&(Pr=t)}function Lp(t){if(t.tag===22){if(Ae(On,On.current),Ae(ir,t),Pr===null){var r=t.alternate;r!==null&&r.memoizedState!==null&&(Pr=t)}}else _s()}function _s(){Ae(On,On.current),Ae(ir,ir.current)}function us(t){Se(ir),Pr===t&&(Pr=null),Se(On)}var On=J(0);function Vo(t){for(var r=t;r!==null;){if(r.tag===13){var i=r.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||gf(i)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function Cu(t,r,i,c){r=t.memoizedState,i=i(c,r),i=i==null?r:v({},r,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Mu={enqueueSetState:function(t,r,i){t=t._reactInternals;var c=za(),d=ks(c);d.payload=r,i!=null&&(d.callback=i),r=Ns(t,d,c),r!==null&&(Ga(r,t,c),Ml(r,t,c))},enqueueReplaceState:function(t,r,i){t=t._reactInternals;var c=za(),d=ks(c);d.tag=1,d.payload=r,i!=null&&(d.callback=i),r=Ns(t,d,c),r!==null&&(Ga(r,t,c),Ml(r,t,c))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var i=za(),c=ks(i);c.tag=2,r!=null&&(c.callback=r),r=Ns(t,c,i),r!==null&&(Ga(r,t,i),Ml(r,t,i))}};function jp(t,r,i,c,d,m,C){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,m,C):r.prototype&&r.prototype.isPureReactComponent?!ja(i,c)||!ja(d,m):!0}function Up(t,r,i,c){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(i,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(i,c),r.state!==t&&Mu.enqueueReplaceState(r,r.state,null)}function yi(t,r){var i=r;if("ref"in r){i={};for(var c in r)c!=="ref"&&(i[c]=r[c])}if(t=t.defaultProps){i===r&&(i=v({},i));for(var d in t)i[d]===void 0&&(i[d]=t[d])}return i}var qo=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Bp(t){qo(t)}function Fp(t){console.error(t)}function Pp(t){qo(t)}function Xo(t,r){try{var i=t.onUncaughtError;i(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function zp(t,r,i){try{var c=t.onCaughtError;c(i.value,{componentStack:i.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function ku(t,r,i){return i=ks(i),i.tag=3,i.payload={element:null},i.callback=function(){Xo(t,r)},i}function Gp(t){return t=ks(t),t.tag=3,t}function Hp(t,r,i,c){var d=i.type.getDerivedStateFromError;if(typeof d=="function"){var m=c.value;t.payload=function(){return d(m)},t.callback=function(){zp(r,i,c)}}var C=i.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(t.callback=function(){zp(r,i,c),typeof d!="function"&&(Bs===null?Bs=new Set([this]):Bs.add(this));var F=c.stack;this.componentDidCatch(c.value,{componentStack:F!==null?F:""})})}function yy(t,r,i,c,d){if(i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=i.alternate,r!==null&&wl(r,i,d,!0),i=ir.current,i!==null){switch(i.tag){case 13:return Pr===null?Ku():i.alternate===null&&dn===0&&(dn=3),i.flags&=-257,i.flags|=65536,i.lanes=d,c===au?i.flags|=16384:(r=i.updateQueue,r===null?i.updateQueue=new Set([c]):r.add(c),ef(t,c,d)),!1;case 22:return i.flags|=65536,c===au?i.flags|=16384:(r=i.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},i.updateQueue=r):(i=r.retryQueue,i===null?r.retryQueue=new Set([c]):i.add(c)),ef(t,c,d)),!1}throw Error(s(435,i.tag))}return ef(t,c,d),Ku(),!1}if(jt)return r=ir.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=d,c!==Zc&&(t=Error(s(422),{cause:c}),Sl(nr(t,i)))):(c!==Zc&&(r=Error(s(423),{cause:c}),Sl(nr(r,i))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,c=nr(c,i),d=ku(t.stateNode,c,d),iu(t,d),dn!==4&&(dn=2)),!1;var m=Error(s(520),{cause:c});if(m=nr(m,i),Gl===null?Gl=[m]:Gl.push(m),dn!==4&&(dn=2),r===null)return!0;c=nr(c,i),i=r;do{switch(i.tag){case 3:return i.flags|=65536,t=d&-d,i.lanes|=t,t=ku(i.stateNode,c,t),iu(i,t),!1;case 1:if(r=i.type,m=i.stateNode,(i.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Bs===null||!Bs.has(m))))return i.flags|=65536,d&=-d,i.lanes|=d,d=Gp(d),Hp(d,t,i,c),iu(i,d),!1}i=i.return}while(i!==null);return!1}var Yp=Error(s(461)),Un=!1;function Xn(t,r,i,c){r.child=t===null?Ip(r,null,i,c):Xi(r,t.child,i,c)}function Vp(t,r,i,c,d){i=i.render;var m=r.ref;if("ref"in c){var C={};for(var F in c)F!=="ref"&&(C[F]=c[F])}else C=c;return hi(r),c=fu(t,r,i,C,m,d),F=du(),t!==null&&!Un?(pu(t,r,d),fs(t,r,d)):(jt&&F&&$c(r),r.flags|=1,Xn(t,r,c,d),r.child)}function qp(t,r,i,c,d){if(t===null){var m=i.type;return typeof m=="function"&&!Vc(m)&&m.defaultProps===void 0&&i.compare===null?(r.tag=15,r.type=m,Xp(t,r,m,c,d)):(t=Co(i.type,null,c,r,r.mode,d),t.ref=r.ref,t.return=r,r.child=t)}if(m=t.child,!ju(t,d)){var C=m.memoizedProps;if(i=i.compare,i=i!==null?i:ja,i(C,c)&&t.ref===r.ref)return fs(t,r,d)}return r.flags|=1,t=rs(m,c),t.ref=r.ref,t.return=r,r.child=t}function Xp(t,r,i,c,d){if(t!==null){var m=t.memoizedProps;if(ja(m,c)&&t.ref===r.ref)if(Un=!1,r.pendingProps=c=m,ju(t,d))(t.flags&131072)!==0&&(Un=!0);else return r.lanes=t.lanes,fs(t,r,d)}return Nu(t,r,i,c,d)}function $p(t,r,i){var c=r.pendingProps,d=c.children,m=t!==null?t.memoizedState:null;if(c.mode==="hidden"){if((r.flags&128)!==0){if(c=m!==null?m.baseLanes|i:i,t!==null){for(d=r.child=t.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;r.childLanes=m&~c}else r.childLanes=0,r.child=null;return Wp(t,r,c,i)}if((i&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},t!==null&&Do(r,m!==null?m.cachePool:null),m!==null?Xd(r,m):ou(),Lp(r);else return r.lanes=r.childLanes=536870912,Wp(t,r,m!==null?m.baseLanes|i:i,i)}else m!==null?(Do(r,m.cachePool),Xd(r,m),_s(),r.memoizedState=null):(t!==null&&Do(r,null),ou(),_s());return Xn(t,r,d,i),r.child}function Wp(t,r,i,c){var d=nu();return d=d===null?null:{parent:_n._currentValue,pool:d},r.memoizedState={baseLanes:i,cachePool:d},t!==null&&Do(r,null),ou(),Lp(r),t!==null&&wl(t,r,c,!0),null}function $o(t,r){var i=r.ref;if(i===null)t!==null&&t.ref!==null&&(r.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(t===null||t.ref!==i)&&(r.flags|=4194816)}}function Nu(t,r,i,c,d){return hi(r),i=fu(t,r,i,c,void 0,d),c=du(),t!==null&&!Un?(pu(t,r,d),fs(t,r,d)):(jt&&c&&$c(r),r.flags|=1,Xn(t,r,i,d),r.child)}function Zp(t,r,i,c,d,m){return hi(r),r.updateQueue=null,i=Wd(r,c,i,d),$d(t),c=du(),t!==null&&!Un?(pu(t,r,m),fs(t,r,m)):(jt&&c&&$c(r),r.flags|=1,Xn(t,r,i,m),r.child)}function Qp(t,r,i,c,d){if(hi(r),r.stateNode===null){var m=Ui,C=i.contextType;typeof C=="object"&&C!==null&&(m=ra(C)),m=new i(c,m),r.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Mu,r.stateNode=m,m._reactInternals=r,m=r.stateNode,m.props=c,m.state=r.memoizedState,m.refs={},ru(r),C=i.contextType,m.context=typeof C=="object"&&C!==null?ra(C):Ui,m.state=r.memoizedState,C=i.getDerivedStateFromProps,typeof C=="function"&&(Cu(r,i,C,c),m.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(C=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),C!==m.state&&Mu.enqueueReplaceState(m,m.state,null),Nl(r,c,m,d),kl(),m.state=r.memoizedState),typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(t===null){m=r.stateNode;var F=r.memoizedProps,ne=yi(i,F);m.props=ne;var he=m.context,Ee=i.contextType;C=Ui,typeof Ee=="object"&&Ee!==null&&(C=ra(Ee));var Re=i.getDerivedStateFromProps;Ee=typeof Re=="function"||typeof m.getSnapshotBeforeUpdate=="function",F=r.pendingProps!==F,Ee||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(F||he!==C)&&Up(r,m,c,C),Ms=!1;var ye=r.memoizedState;m.state=ye,Nl(r,c,m,d),kl(),he=r.memoizedState,F||ye!==he||Ms?(typeof Re=="function"&&(Cu(r,i,Re,c),he=r.memoizedState),(ne=Ms||jp(r,i,ne,c,ye,he,C))?(Ee||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(r.flags|=4194308)):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=he),m.props=c,m.state=he,m.context=C,c=ne):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{m=r.stateNode,su(t,r),C=r.memoizedProps,Ee=yi(i,C),m.props=Ee,Re=r.pendingProps,ye=m.context,he=i.contextType,ne=Ui,typeof he=="object"&&he!==null&&(ne=ra(he)),F=i.getDerivedStateFromProps,(he=typeof F=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(C!==Re||ye!==ne)&&Up(r,m,c,ne),Ms=!1,ye=r.memoizedState,m.state=ye,Nl(r,c,m,d),kl();var ve=r.memoizedState;C!==Re||ye!==ve||Ms||t!==null&&t.dependencies!==null&&No(t.dependencies)?(typeof F=="function"&&(Cu(r,i,F,c),ve=r.memoizedState),(Ee=Ms||jp(r,i,Ee,c,ye,ve,ne)||t!==null&&t.dependencies!==null&&No(t.dependencies))?(he||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(c,ve,ne),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(c,ve,ne)),typeof m.componentDidUpdate=="function"&&(r.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof m.componentDidUpdate!="function"||C===t.memoizedProps&&ye===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||C===t.memoizedProps&&ye===t.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=ve),m.props=c,m.state=ve,m.context=ne,c=Ee):(typeof m.componentDidUpdate!="function"||C===t.memoizedProps&&ye===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||C===t.memoizedProps&&ye===t.memoizedState||(r.flags|=1024),c=!1)}return m=c,$o(t,r),c=(r.flags&128)!==0,m||c?(m=r.stateNode,i=c&&typeof i.getDerivedStateFromError!="function"?null:m.render(),r.flags|=1,t!==null&&c?(r.child=Xi(r,t.child,null,d),r.child=Xi(r,null,i,d)):Xn(t,r,i,d),r.memoizedState=m.state,t=r.child):t=fs(t,r,d),t}function Kp(t,r,i,c){return xl(),r.flags|=256,Xn(t,r,i,c),r.child}var Ru={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Du(t){return{baseLanes:t,cachePool:Fd()}}function _u(t,r,i){return t=t!==null?t.childLanes&~i:0,r&&(t|=lr),t}function Jp(t,r,i){var c=r.pendingProps,d=!1,m=(r.flags&128)!==0,C;if((C=m)||(C=t!==null&&t.memoizedState===null?!1:(On.current&2)!==0),C&&(d=!0,r.flags&=-129),C=(r.flags&32)!==0,r.flags&=-33,t===null){if(jt){if(d?Ds(r):_s(),jt){var F=fn,ne;if(ne=F){e:{for(ne=F,F=Fr;ne.nodeType!==8;){if(!F){F=null;break e}if(ne=vr(ne.nextSibling),ne===null){F=null;break e}}F=ne}F!==null?(r.memoizedState={dehydrated:F,treeContext:ci!==null?{id:ss,overflow:is}:null,retryLane:536870912,hydrationErrors:null},ne=Ua(18,null,null,0),ne.stateNode=F,ne.return=r,r.child=ne,pa=r,fn=null,ne=!0):ne=!1}ne||di(r)}if(F=r.memoizedState,F!==null&&(F=F.dehydrated,F!==null))return gf(F)?r.lanes=32:r.lanes=536870912,null;us(r)}return F=c.children,c=c.fallback,d?(_s(),d=r.mode,F=Wo({mode:"hidden",children:F},d),c=oi(c,d,i,null),F.return=r,c.return=r,F.sibling=c,r.child=F,d=r.child,d.memoizedState=Du(i),d.childLanes=_u(t,C,i),r.memoizedState=Ru,c):(Ds(r),Ou(r,F))}if(ne=t.memoizedState,ne!==null&&(F=ne.dehydrated,F!==null)){if(m)r.flags&256?(Ds(r),r.flags&=-257,r=Iu(t,r,i)):r.memoizedState!==null?(_s(),r.child=t.child,r.flags|=128,r=null):(_s(),d=c.fallback,F=r.mode,c=Wo({mode:"visible",children:c.children},F),d=oi(d,F,i,null),d.flags|=2,c.return=r,d.return=r,c.sibling=d,r.child=c,Xi(r,t.child,null,i),c=r.child,c.memoizedState=Du(i),c.childLanes=_u(t,C,i),r.memoizedState=Ru,r=d);else if(Ds(r),gf(F)){if(C=F.nextSibling&&F.nextSibling.dataset,C)var he=C.dgst;C=he,c=Error(s(419)),c.stack="",c.digest=C,Sl({value:c,source:null,stack:null}),r=Iu(t,r,i)}else if(Un||wl(t,r,i,!1),C=(i&t.childLanes)!==0,Un||C){if(C=Qt,C!==null&&(c=i&-i,c=(c&42)!==0?1:Na(c),c=(c&(C.suspendedLanes|i))!==0?0:c,c!==0&&c!==ne.retryLane))throw ne.retryLane=c,ji(t,c),Ga(C,t,c),Yp;F.data==="$?"||Ku(),r=Iu(t,r,i)}else F.data==="$?"?(r.flags|=192,r.child=t.child,r=null):(t=ne.treeContext,fn=vr(F.nextSibling),pa=r,jt=!0,fi=null,Fr=!1,t!==null&&(rr[sr++]=ss,rr[sr++]=is,rr[sr++]=ci,ss=t.id,is=t.overflow,ci=r),r=Ou(r,c.children),r.flags|=4096);return r}return d?(_s(),d=c.fallback,F=r.mode,ne=t.child,he=ne.sibling,c=rs(ne,{mode:"hidden",children:c.children}),c.subtreeFlags=ne.subtreeFlags&65011712,he!==null?d=rs(he,d):(d=oi(d,F,i,null),d.flags|=2),d.return=r,c.return=r,c.sibling=d,r.child=c,c=d,d=r.child,F=t.child.memoizedState,F===null?F=Du(i):(ne=F.cachePool,ne!==null?(he=_n._currentValue,ne=ne.parent!==he?{parent:he,pool:he}:ne):ne=Fd(),F={baseLanes:F.baseLanes|i,cachePool:ne}),d.memoizedState=F,d.childLanes=_u(t,C,i),r.memoizedState=Ru,c):(Ds(r),i=t.child,t=i.sibling,i=rs(i,{mode:"visible",children:c.children}),i.return=r,i.sibling=null,t!==null&&(C=r.deletions,C===null?(r.deletions=[t],r.flags|=16):C.push(t)),r.child=i,r.memoizedState=null,i)}function Ou(t,r){return r=Wo({mode:"visible",children:r},t.mode),r.return=t,t.child=r}function Wo(t,r){return t=Ua(22,t,null,r),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Iu(t,r,i){return Xi(r,t.child,null,i),t=Ou(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function eh(t,r,i){t.lanes|=r;var c=t.alternate;c!==null&&(c.lanes|=r),Kc(t.return,r,i)}function Lu(t,r,i,c,d){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:i,tailMode:d}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=i,m.tailMode=d)}function th(t,r,i){var c=r.pendingProps,d=c.revealOrder,m=c.tail;if(Xn(t,r,c.children,i),c=On.current,(c&2)!==0)c=c&1|2,r.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&eh(t,i,r);else if(t.tag===19)eh(t,i,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}switch(Ae(On,c),d){case"forwards":for(i=r.child,d=null;i!==null;)t=i.alternate,t!==null&&Vo(t)===null&&(d=i),i=i.sibling;i=d,i===null?(d=r.child,r.child=null):(d=i.sibling,i.sibling=null),Lu(r,!1,d,i,m);break;case"backwards":for(i=null,d=r.child,r.child=null;d!==null;){if(t=d.alternate,t!==null&&Vo(t)===null){r.child=d;break}t=d.sibling,d.sibling=i,i=d,d=t}Lu(r,!0,i,null,m);break;case"together":Lu(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function fs(t,r,i){if(t!==null&&(r.dependencies=t.dependencies),Us|=r.lanes,(i&r.childLanes)===0)if(t!==null){if(wl(t,r,i,!1),(i&r.childLanes)===0)return null}else return null;if(t!==null&&r.child!==t.child)throw Error(s(153));if(r.child!==null){for(t=r.child,i=rs(t,t.pendingProps),r.child=i,i.return=r;t.sibling!==null;)t=t.sibling,i=i.sibling=rs(t,t.pendingProps),i.return=r;i.sibling=null}return r.child}function ju(t,r){return(t.lanes&r)!==0?!0:(t=t.dependencies,!!(t!==null&&No(t)))}function vy(t,r,i){switch(r.tag){case 3:it(r,r.stateNode.containerInfo),Cs(r,_n,t.memoizedState.cache),xl();break;case 27:case 5:qe(r);break;case 4:it(r,r.stateNode.containerInfo);break;case 10:Cs(r,r.type,r.memoizedProps.value);break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(Ds(r),r.flags|=128,null):(i&r.child.childLanes)!==0?Jp(t,r,i):(Ds(r),t=fs(t,r,i),t!==null?t.sibling:null);Ds(r);break;case 19:var d=(t.flags&128)!==0;if(c=(i&r.childLanes)!==0,c||(wl(t,r,i,!1),c=(i&r.childLanes)!==0),d){if(c)return th(t,r,i);r.flags|=128}if(d=r.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Ae(On,On.current),c)break;return null;case 22:case 23:return r.lanes=0,$p(t,r,i);case 24:Cs(r,_n,t.memoizedState.cache)}return fs(t,r,i)}function nh(t,r,i){if(t!==null)if(t.memoizedProps!==r.pendingProps)Un=!0;else{if(!ju(t,i)&&(r.flags&128)===0)return Un=!1,vy(t,r,i);Un=(t.flags&131072)!==0}else Un=!1,jt&&(r.flags&1048576)!==0&&_d(r,ko,r.index);switch(r.lanes=0,r.tag){case 16:e:{t=r.pendingProps;var c=r.elementType,d=c._init;if(c=d(c._payload),r.type=c,typeof c=="function")Vc(c)?(t=yi(c,t),r.tag=1,r=Qp(null,r,c,t,i)):(r.tag=0,r=Nu(null,r,c,t,i));else{if(c!=null){if(d=c.$$typeof,d===U){r.tag=11,r=Vp(null,r,c,t,i);break e}else if(d===Y){r.tag=14,r=qp(null,r,c,t,i);break e}}throw r=K(c)||c,Error(s(306,r,""))}}return r;case 0:return Nu(t,r,r.type,r.pendingProps,i);case 1:return c=r.type,d=yi(c,r.pendingProps),Qp(t,r,c,d,i);case 3:e:{if(it(r,r.stateNode.containerInfo),t===null)throw Error(s(387));c=r.pendingProps;var m=r.memoizedState;d=m.element,su(t,r),Nl(r,c,null,i);var C=r.memoizedState;if(c=C.cache,Cs(r,_n,c),c!==m.cache&&Jc(r,[_n],i,!0),kl(),c=C.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:C.cache},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){r=Kp(t,r,c,i);break e}else if(c!==d){d=nr(Error(s(424)),r),Sl(d),r=Kp(t,r,c,i);break e}else for(t=r.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,fn=vr(t.firstChild),pa=r,jt=!0,fi=null,Fr=!0,i=Ip(r,null,c,i),r.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(xl(),c===d){r=fs(t,r,i);break e}Xn(t,r,c,i)}r=r.child}return r;case 26:return $o(t,r),t===null?(i=i0(r.type,null,r.pendingProps,null))?r.memoizedState=i:jt||(i=r.type,t=r.pendingProps,c=cc(Ue.current).createElement(i),c[Ut]=r,c[Wt]=t,Wn(c,i,t),At(c),r.stateNode=c):r.memoizedState=i0(r.type,t.memoizedProps,r.pendingProps,t.memoizedState),null;case 27:return qe(r),t===null&&jt&&(c=r.stateNode=a0(r.type,r.pendingProps,Ue.current),pa=r,Fr=!0,d=fn,zs(r.type)?(yf=d,fn=vr(c.firstChild)):fn=d),Xn(t,r,r.pendingProps.children,i),$o(t,r),t===null&&(r.flags|=4194304),r.child;case 5:return t===null&&jt&&((d=c=fn)&&(c=qy(c,r.type,r.pendingProps,Fr),c!==null?(r.stateNode=c,pa=r,fn=vr(c.firstChild),Fr=!1,d=!0):d=!1),d||di(r)),qe(r),d=r.type,m=r.pendingProps,C=t!==null?t.memoizedProps:null,c=m.children,pf(d,m)?c=null:C!==null&&pf(d,C)&&(r.flags|=32),r.memoizedState!==null&&(d=fu(t,r,uy,null,null,i),Ql._currentValue=d),$o(t,r),Xn(t,r,c,i),r.child;case 6:return t===null&&jt&&((t=i=fn)&&(i=Xy(i,r.pendingProps,Fr),i!==null?(r.stateNode=i,pa=r,fn=null,t=!0):t=!1),t||di(r)),null;case 13:return Jp(t,r,i);case 4:return it(r,r.stateNode.containerInfo),c=r.pendingProps,t===null?r.child=Xi(r,null,c,i):Xn(t,r,c,i),r.child;case 11:return Vp(t,r,r.type,r.pendingProps,i);case 7:return Xn(t,r,r.pendingProps,i),r.child;case 8:return Xn(t,r,r.pendingProps.children,i),r.child;case 12:return Xn(t,r,r.pendingProps.children,i),r.child;case 10:return c=r.pendingProps,Cs(r,r.type,c.value),Xn(t,r,c.children,i),r.child;case 9:return d=r.type._context,c=r.pendingProps.children,hi(r),d=ra(d),c=c(d),r.flags|=1,Xn(t,r,c,i),r.child;case 14:return qp(t,r,r.type,r.pendingProps,i);case 15:return Xp(t,r,r.type,r.pendingProps,i);case 19:return th(t,r,i);case 31:return c=r.pendingProps,i=r.mode,c={mode:c.mode,children:c.children},t===null?(i=Wo(c,i),i.ref=r.ref,r.child=i,i.return=r,r=i):(i=rs(t.child,c),i.ref=r.ref,r.child=i,i.return=r,r=i),r;case 22:return $p(t,r,i);case 24:return hi(r),c=ra(_n),t===null?(d=nu(),d===null&&(d=Qt,m=eu(),d.pooledCache=m,m.refCount++,m!==null&&(d.pooledCacheLanes|=i),d=m),r.memoizedState={parent:c,cache:d},ru(r),Cs(r,_n,d)):((t.lanes&i)!==0&&(su(t,r),Nl(r,null,null,i),kl()),d=t.memoizedState,m=r.memoizedState,d.parent!==c?(d={parent:c,cache:c},r.memoizedState=d,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=d),Cs(r,_n,c)):(c=m.cache,Cs(r,_n,c),c!==d.cache&&Jc(r,[_n],i,!0))),Xn(t,r,r.pendingProps.children,i),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function ds(t){t.flags|=4}function ah(t,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!f0(r)){if(r=ir.current,r!==null&&((Rt&4194048)===Rt?Pr!==null:(Rt&62914560)!==Rt&&(Rt&536870912)===0||r!==Pr))throw Cl=au,Pd;t.flags|=8192}}function Zo(t,r){r!==null&&(t.flags|=4),t.flags&16384&&(r=t.tag!==22?$e():536870912,t.lanes|=r,Qi|=r)}function jl(t,r){if(!jt)switch(t.tailMode){case"hidden":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function on(t){var r=t.alternate!==null&&t.alternate.child===t.child,i=0,c=0;if(r)for(var d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=c,t.childLanes=i,r}function by(t,r,i){var c=r.pendingProps;switch(Wc(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return on(r),null;case 1:return on(r),null;case 3:return i=r.stateNode,c=null,t!==null&&(c=t.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),os(_n),De(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(bl(r)?ds(r):t===null||t.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Ld())),on(r),null;case 26:return i=r.memoizedState,t===null?(ds(r),i!==null?(on(r),ah(r,i)):(on(r),r.flags&=-16777217)):i?i!==t.memoizedState?(ds(r),on(r),ah(r,i)):(on(r),r.flags&=-16777217):(t.memoizedProps!==c&&ds(r),on(r),r.flags&=-16777217),null;case 27:lt(r),i=Ue.current;var d=r.type;if(t!==null&&r.stateNode!=null)t.memoizedProps!==c&&ds(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return on(r),null}t=Le.current,bl(r)?Od(r):(t=a0(d,c,i),r.stateNode=t,ds(r))}return on(r),null;case 5:if(lt(r),i=r.type,t!==null&&r.stateNode!=null)t.memoizedProps!==c&&ds(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return on(r),null}if(t=Le.current,bl(r))Od(r);else{switch(d=cc(Ue.current),t){case 1:t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof c.is=="string"?d.createElement("select",{is:c.is}):d.createElement("select"),c.multiple?t.multiple=!0:c.size&&(t.size=c.size);break;default:t=typeof c.is=="string"?d.createElement(i,{is:c.is}):d.createElement(i)}}t[Ut]=r,t[Wt]=c;e:for(d=r.child;d!==null;){if(d.tag===5||d.tag===6)t.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r.stateNode=t;e:switch(Wn(t,i,c),i){case"button":case"input":case"select":case"textarea":t=!!c.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&ds(r)}}return on(r),r.flags&=-16777217,null;case 6:if(t&&r.stateNode!=null)t.memoizedProps!==c&&ds(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(s(166));if(t=Ue.current,bl(r)){if(t=r.stateNode,i=r.memoizedProps,c=null,d=pa,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}t[Ut]=r,t=!!(t.nodeValue===i||c!==null&&c.suppressHydrationWarning===!0||Zh(t.nodeValue,i)),t||di(r)}else t=cc(t).createTextNode(c),t[Ut]=r,r.stateNode=t}return on(r),null;case 13:if(c=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=bl(r),c!==null&&c.dehydrated!==null){if(t===null){if(!d)throw Error(s(318));if(d=r.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[Ut]=r}else xl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;on(r),d=!1}else d=Ld(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=d),d=!0;if(!d)return r.flags&256?(us(r),r):(us(r),null)}if(us(r),(r.flags&128)!==0)return r.lanes=i,r;if(i=c!==null,t=t!==null&&t.memoizedState!==null,i){c=r.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool);var m=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==d&&(c.flags|=2048)}return i!==t&&i&&(r.child.flags|=8192),Zo(r,r.updateQueue),on(r),null;case 4:return De(),t===null&&of(r.stateNode.containerInfo),on(r),null;case 10:return os(r.type),on(r),null;case 19:if(Se(On),d=r.memoizedState,d===null)return on(r),null;if(c=(r.flags&128)!==0,m=d.rendering,m===null)if(c)jl(d,!1);else{if(dn!==0||t!==null&&(t.flags&128)!==0)for(t=r.child;t!==null;){if(m=Vo(t),m!==null){for(r.flags|=128,jl(d,!1),t=m.updateQueue,r.updateQueue=t,Zo(r,t),r.subtreeFlags=0,t=i,i=r.child;i!==null;)Dd(i,t),i=i.sibling;return Ae(On,On.current&1|2),r.child}t=t.sibling}d.tail!==null&&Fe()>Jo&&(r.flags|=128,c=!0,jl(d,!1),r.lanes=4194304)}else{if(!c)if(t=Vo(m),t!==null){if(r.flags|=128,c=!0,t=t.updateQueue,r.updateQueue=t,Zo(r,t),jl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!jt)return on(r),null}else 2*Fe()-d.renderingStartTime>Jo&&i!==536870912&&(r.flags|=128,c=!0,jl(d,!1),r.lanes=4194304);d.isBackwards?(m.sibling=r.child,r.child=m):(t=d.last,t!==null?t.sibling=m:r.child=m,d.last=m)}return d.tail!==null?(r=d.tail,d.rendering=r,d.tail=r.sibling,d.renderingStartTime=Fe(),r.sibling=null,t=On.current,Ae(On,c?t&1|2:t&1),r):(on(r),null);case 22:case 23:return us(r),cu(),c=r.memoizedState!==null,t!==null?t.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(i&536870912)!==0&&(r.flags&128)===0&&(on(r),r.subtreeFlags&6&&(r.flags|=8192)):on(r),i=r.updateQueue,i!==null&&Zo(r,i.retryQueue),i=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==i&&(r.flags|=2048),t!==null&&Se(mi),null;case 24:return i=null,t!==null&&(i=t.memoizedState.cache),r.memoizedState.cache!==i&&(r.flags|=2048),os(_n),on(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function xy(t,r){switch(Wc(r),r.tag){case 1:return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return os(_n),De(),t=r.flags,(t&65536)!==0&&(t&128)===0?(r.flags=t&-65537|128,r):null;case 26:case 27:case 5:return lt(r),null;case 13:if(us(r),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(s(340));xl()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return Se(On),null;case 4:return De(),null;case 10:return os(r.type),null;case 22:case 23:return us(r),cu(),t!==null&&Se(mi),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 24:return os(_n),null;case 25:return null;default:return null}}function rh(t,r){switch(Wc(r),r.tag){case 3:os(_n),De();break;case 26:case 27:case 5:lt(r);break;case 4:De();break;case 13:us(r);break;case 19:Se(On);break;case 10:os(r.type);break;case 22:case 23:us(r),cu(),t!==null&&Se(mi);break;case 24:os(_n)}}function Ul(t,r){try{var i=r.updateQueue,c=i!==null?i.lastEffect:null;if(c!==null){var d=c.next;i=d;do{if((i.tag&t)===t){c=void 0;var m=i.create,C=i.inst;c=m(),C.destroy=c}i=i.next}while(i!==d)}}catch(F){$t(r,r.return,F)}}function Os(t,r,i){try{var c=r.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var m=d.next;c=m;do{if((c.tag&t)===t){var C=c.inst,F=C.destroy;if(F!==void 0){C.destroy=void 0,d=r;var ne=i,he=F;try{he()}catch(Ee){$t(d,ne,Ee)}}}c=c.next}while(c!==m)}}catch(Ee){$t(r,r.return,Ee)}}function sh(t){var r=t.updateQueue;if(r!==null){var i=t.stateNode;try{qd(r,i)}catch(c){$t(t,t.return,c)}}}function ih(t,r,i){i.props=yi(t.type,t.memoizedProps),i.state=t.memoizedState;try{i.componentWillUnmount()}catch(c){$t(t,r,c)}}function Bl(t,r){try{var i=t.ref;if(i!==null){switch(t.tag){case 26:case 27:case 5:var c=t.stateNode;break;case 30:c=t.stateNode;break;default:c=t.stateNode}typeof i=="function"?t.refCleanup=i(c):i.current=c}}catch(d){$t(t,r,d)}}function zr(t,r){var i=t.ref,c=t.refCleanup;if(i!==null)if(typeof c=="function")try{c()}catch(d){$t(t,r,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(d){$t(t,r,d)}else i.current=null}function lh(t){var r=t.type,i=t.memoizedProps,c=t.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":i.autoFocus&&c.focus();break e;case"img":i.src?c.src=i.src:i.srcSet&&(c.srcset=i.srcSet)}}catch(d){$t(t,t.return,d)}}function Uu(t,r,i){try{var c=t.stateNode;zy(c,t.type,i,r),c[Wt]=r}catch(d){$t(t,t.return,d)}}function oh(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&zs(t.type)||t.tag===4}function Bu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||oh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&zs(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Fu(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(t,r):(r=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,r.appendChild(t),i=i._reactRootContainer,i!=null||r.onclick!==null||(r.onclick=oc));else if(c!==4&&(c===27&&zs(t.type)&&(i=t.stateNode,r=null),t=t.child,t!==null))for(Fu(t,r,i),t=t.sibling;t!==null;)Fu(t,r,i),t=t.sibling}function Qo(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?i.insertBefore(t,r):i.appendChild(t);else if(c!==4&&(c===27&&zs(t.type)&&(i=t.stateNode),t=t.child,t!==null))for(Qo(t,r,i),t=t.sibling;t!==null;)Qo(t,r,i),t=t.sibling}function ch(t){var r=t.stateNode,i=t.memoizedProps;try{for(var c=t.type,d=r.attributes;d.length;)r.removeAttributeNode(d[0]);Wn(r,c,i),r[Ut]=t,r[Wt]=i}catch(m){$t(t,t.return,m)}}var ps=!1,gn=!1,Pu=!1,uh=typeof WeakSet=="function"?WeakSet:Set,Bn=null;function Sy(t,r){if(t=t.containerInfo,ff=mc,t=tr(t),aa(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var c=i.getSelection&&i.getSelection();if(c&&c.rangeCount!==0){i=c.anchorNode;var d=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{i.nodeType,m.nodeType}catch{i=null;break e}var C=0,F=-1,ne=-1,he=0,Ee=0,Re=t,ye=null;t:for(;;){for(var ve;Re!==i||d!==0&&Re.nodeType!==3||(F=C+d),Re!==m||c!==0&&Re.nodeType!==3||(ne=C+c),Re.nodeType===3&&(C+=Re.nodeValue.length),(ve=Re.firstChild)!==null;)ye=Re,Re=ve;for(;;){if(Re===t)break t;if(ye===i&&++he===d&&(F=C),ye===m&&++Ee===c&&(ne=C),(ve=Re.nextSibling)!==null)break;Re=ye,ye=Re.parentNode}Re=ve}i=F===-1||ne===-1?null:{start:F,end:ne}}else i=null}i=i||{start:0,end:0}}else i=null;for(df={focusedElem:t,selectionRange:i},mc=!1,Bn=r;Bn!==null;)if(r=Bn,t=r.child,(r.subtreeFlags&1024)!==0&&t!==null)t.return=r,Bn=t;else for(;Bn!==null;){switch(r=Bn,m=r.alternate,t=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&m!==null){t=void 0,i=r,d=m.memoizedProps,m=m.memoizedState,c=i.stateNode;try{var dt=yi(i.type,d,i.elementType===i.type);t=c.getSnapshotBeforeUpdate(dt,m),c.__reactInternalSnapshotBeforeUpdate=t}catch(ot){$t(i,i.return,ot)}}break;case 3:if((t&1024)!==0){if(t=r.stateNode.containerInfo,i=t.nodeType,i===9)mf(t);else if(i===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":mf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(s(163))}if(t=r.sibling,t!==null){t.return=r.return,Bn=t;break}Bn=r.return}}function fh(t,r,i){var c=i.flags;switch(i.tag){case 0:case 11:case 15:Is(t,i),c&4&&Ul(5,i);break;case 1:if(Is(t,i),c&4)if(t=i.stateNode,r===null)try{t.componentDidMount()}catch(C){$t(i,i.return,C)}else{var d=yi(i.type,r.memoizedProps);r=r.memoizedState;try{t.componentDidUpdate(d,r,t.__reactInternalSnapshotBeforeUpdate)}catch(C){$t(i,i.return,C)}}c&64&&sh(i),c&512&&Bl(i,i.return);break;case 3:if(Is(t,i),c&64&&(t=i.updateQueue,t!==null)){if(r=null,i.child!==null)switch(i.child.tag){case 27:case 5:r=i.child.stateNode;break;case 1:r=i.child.stateNode}try{qd(t,r)}catch(C){$t(i,i.return,C)}}break;case 27:r===null&&c&4&&ch(i);case 26:case 5:Is(t,i),r===null&&c&4&&lh(i),c&512&&Bl(i,i.return);break;case 12:Is(t,i);break;case 13:Is(t,i),c&4&&hh(t,i),c&64&&(t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(i=Ry.bind(null,i),$y(t,i))));break;case 22:if(c=i.memoizedState!==null||ps,!c){r=r!==null&&r.memoizedState!==null||gn,d=ps;var m=gn;ps=c,(gn=r)&&!m?Ls(t,i,(i.subtreeFlags&8772)!==0):Is(t,i),ps=d,gn=m}break;case 30:break;default:Is(t,i)}}function dh(t){var r=t.alternate;r!==null&&(t.alternate=null,dh(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&Qn(r)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var an=null,Ca=!1;function hs(t,r,i){for(i=i.child;i!==null;)ph(t,r,i),i=i.sibling}function ph(t,r,i){if(It&&typeof It.onCommitFiberUnmount=="function")try{It.onCommitFiberUnmount(Ot,i)}catch{}switch(i.tag){case 26:gn||zr(i,r),hs(t,r,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:gn||zr(i,r);var c=an,d=Ca;zs(i.type)&&(an=i.stateNode,Ca=!1),hs(t,r,i),Xl(i.stateNode),an=c,Ca=d;break;case 5:gn||zr(i,r);case 6:if(c=an,d=Ca,an=null,hs(t,r,i),an=c,Ca=d,an!==null)if(Ca)try{(an.nodeType===9?an.body:an.nodeName==="HTML"?an.ownerDocument.body:an).removeChild(i.stateNode)}catch(m){$t(i,r,m)}else try{an.removeChild(i.stateNode)}catch(m){$t(i,r,m)}break;case 18:an!==null&&(Ca?(t=an,t0(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,i.stateNode),to(t)):t0(an,i.stateNode));break;case 4:c=an,d=Ca,an=i.stateNode.containerInfo,Ca=!0,hs(t,r,i),an=c,Ca=d;break;case 0:case 11:case 14:case 15:gn||Os(2,i,r),gn||Os(4,i,r),hs(t,r,i);break;case 1:gn||(zr(i,r),c=i.stateNode,typeof c.componentWillUnmount=="function"&&ih(i,r,c)),hs(t,r,i);break;case 21:hs(t,r,i);break;case 22:gn=(c=gn)||i.memoizedState!==null,hs(t,r,i),gn=c;break;default:hs(t,r,i)}}function hh(t,r){if(r.memoizedState===null&&(t=r.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{to(t)}catch(i){$t(r,r.return,i)}}function wy(t){switch(t.tag){case 13:case 19:var r=t.stateNode;return r===null&&(r=t.stateNode=new uh),r;case 22:return t=t.stateNode,r=t._retryCache,r===null&&(r=t._retryCache=new uh),r;default:throw Error(s(435,t.tag))}}function zu(t,r){var i=wy(t);r.forEach(function(c){var d=Dy.bind(null,t,c);i.has(c)||(i.add(c),c.then(d,d))})}function Ba(t,r){var i=r.deletions;if(i!==null)for(var c=0;c<i.length;c++){var d=i[c],m=t,C=r,F=C;e:for(;F!==null;){switch(F.tag){case 27:if(zs(F.type)){an=F.stateNode,Ca=!1;break e}break;case 5:an=F.stateNode,Ca=!1;break e;case 3:case 4:an=F.stateNode.containerInfo,Ca=!0;break e}F=F.return}if(an===null)throw Error(s(160));ph(m,C,d),an=null,Ca=!1,m=d.alternate,m!==null&&(m.return=null),d.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)mh(r,t),r=r.sibling}var yr=null;function mh(t,r){var i=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Ba(r,t),Fa(t),c&4&&(Os(3,t,t.return),Ul(3,t),Os(5,t,t.return));break;case 1:Ba(r,t),Fa(t),c&512&&(gn||i===null||zr(i,i.return)),c&64&&ps&&(t=t.updateQueue,t!==null&&(c=t.callbacks,c!==null&&(i=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=i===null?c:i.concat(c))));break;case 26:var d=yr;if(Ba(r,t),Fa(t),c&512&&(gn||i===null||zr(i,i.return)),c&4){var m=i!==null?i.memoizedState:null;if(c=t.memoizedState,i===null)if(c===null)if(t.stateNode===null){e:{c=t.type,i=t.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":m=d.getElementsByTagName("title")[0],(!m||m[Hn]||m[Ut]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=d.createElement(c),d.head.insertBefore(m,d.querySelector("head > title"))),Wn(m,c,i),m[Ut]=t,At(m),c=m;break e;case"link":var C=c0("link","href",d).get(c+(i.href||""));if(C){for(var F=0;F<C.length;F++)if(m=C[F],m.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&m.getAttribute("rel")===(i.rel==null?null:i.rel)&&m.getAttribute("title")===(i.title==null?null:i.title)&&m.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){C.splice(F,1);break t}}m=d.createElement(c),Wn(m,c,i),d.head.appendChild(m);break;case"meta":if(C=c0("meta","content",d).get(c+(i.content||""))){for(F=0;F<C.length;F++)if(m=C[F],m.getAttribute("content")===(i.content==null?null:""+i.content)&&m.getAttribute("name")===(i.name==null?null:i.name)&&m.getAttribute("property")===(i.property==null?null:i.property)&&m.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&m.getAttribute("charset")===(i.charSet==null?null:i.charSet)){C.splice(F,1);break t}}m=d.createElement(c),Wn(m,c,i),d.head.appendChild(m);break;default:throw Error(s(468,c))}m[Ut]=t,At(m),c=m}t.stateNode=c}else u0(d,t.type,t.stateNode);else t.stateNode=o0(d,c,t.memoizedProps);else m!==c?(m===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):m.count--,c===null?u0(d,t.type,t.stateNode):o0(d,c,t.memoizedProps)):c===null&&t.stateNode!==null&&Uu(t,t.memoizedProps,i.memoizedProps)}break;case 27:Ba(r,t),Fa(t),c&512&&(gn||i===null||zr(i,i.return)),i!==null&&c&4&&Uu(t,t.memoizedProps,i.memoizedProps);break;case 5:if(Ba(r,t),Fa(t),c&512&&(gn||i===null||zr(i,i.return)),t.flags&32){d=t.stateNode;try{ba(d,"")}catch(ve){$t(t,t.return,ve)}}c&4&&t.stateNode!=null&&(d=t.memoizedProps,Uu(t,d,i!==null?i.memoizedProps:d)),c&1024&&(Pu=!0);break;case 6:if(Ba(r,t),Fa(t),c&4){if(t.stateNode===null)throw Error(s(162));c=t.memoizedProps,i=t.stateNode;try{i.nodeValue=c}catch(ve){$t(t,t.return,ve)}}break;case 3:if(dc=null,d=yr,yr=uc(r.containerInfo),Ba(r,t),yr=d,Fa(t),c&4&&i!==null&&i.memoizedState.isDehydrated)try{to(r.containerInfo)}catch(ve){$t(t,t.return,ve)}Pu&&(Pu=!1,gh(t));break;case 4:c=yr,yr=uc(t.stateNode.containerInfo),Ba(r,t),Fa(t),yr=c;break;case 12:Ba(r,t),Fa(t);break;case 13:Ba(r,t),Fa(t),t.child.flags&8192&&t.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Xu=Fe()),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,zu(t,c)));break;case 22:d=t.memoizedState!==null;var ne=i!==null&&i.memoizedState!==null,he=ps,Ee=gn;if(ps=he||d,gn=Ee||ne,Ba(r,t),gn=Ee,ps=he,Fa(t),c&8192)e:for(r=t.stateNode,r._visibility=d?r._visibility&-2:r._visibility|1,d&&(i===null||ne||ps||gn||vi(t)),i=null,r=t;;){if(r.tag===5||r.tag===26){if(i===null){ne=i=r;try{if(m=ne.stateNode,d)C=m.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{F=ne.stateNode;var Re=ne.memoizedProps.style,ye=Re!=null&&Re.hasOwnProperty("display")?Re.display:null;F.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(ve){$t(ne,ne.return,ve)}}}else if(r.tag===6){if(i===null){ne=r;try{ne.stateNode.nodeValue=d?"":ne.memoizedProps}catch(ve){$t(ne,ne.return,ve)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;i===r&&(i=null),r=r.return}i===r&&(i=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=t.updateQueue,c!==null&&(i=c.retryQueue,i!==null&&(c.retryQueue=null,zu(t,i))));break;case 19:Ba(r,t),Fa(t),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,zu(t,c)));break;case 30:break;case 21:break;default:Ba(r,t),Fa(t)}}function Fa(t){var r=t.flags;if(r&2){try{for(var i,c=t.return;c!==null;){if(oh(c)){i=c;break}c=c.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var d=i.stateNode,m=Bu(t);Qo(t,m,d);break;case 5:var C=i.stateNode;i.flags&32&&(ba(C,""),i.flags&=-33);var F=Bu(t);Qo(t,F,C);break;case 3:case 4:var ne=i.stateNode.containerInfo,he=Bu(t);Fu(t,he,ne);break;default:throw Error(s(161))}}catch(Ee){$t(t,t.return,Ee)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function gh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var r=t;gh(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),t=t.sibling}}function Is(t,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)fh(t,r.alternate,r),r=r.sibling}function vi(t){for(t=t.child;t!==null;){var r=t;switch(r.tag){case 0:case 11:case 14:case 15:Os(4,r,r.return),vi(r);break;case 1:zr(r,r.return);var i=r.stateNode;typeof i.componentWillUnmount=="function"&&ih(r,r.return,i),vi(r);break;case 27:Xl(r.stateNode);case 26:case 5:zr(r,r.return),vi(r);break;case 22:r.memoizedState===null&&vi(r);break;case 30:vi(r);break;default:vi(r)}t=t.sibling}}function Ls(t,r,i){for(i=i&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,d=t,m=r,C=m.flags;switch(m.tag){case 0:case 11:case 15:Ls(d,m,i),Ul(4,m);break;case 1:if(Ls(d,m,i),c=m,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(he){$t(c,c.return,he)}if(c=m,d=c.updateQueue,d!==null){var F=c.stateNode;try{var ne=d.shared.hiddenCallbacks;if(ne!==null)for(d.shared.hiddenCallbacks=null,d=0;d<ne.length;d++)Vd(ne[d],F)}catch(he){$t(c,c.return,he)}}i&&C&64&&sh(m),Bl(m,m.return);break;case 27:ch(m);case 26:case 5:Ls(d,m,i),i&&c===null&&C&4&&lh(m),Bl(m,m.return);break;case 12:Ls(d,m,i);break;case 13:Ls(d,m,i),i&&C&4&&hh(d,m);break;case 22:m.memoizedState===null&&Ls(d,m,i),Bl(m,m.return);break;case 30:break;default:Ls(d,m,i)}r=r.sibling}}function Gu(t,r){var i=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),t=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(t=r.memoizedState.cachePool.pool),t!==i&&(t!=null&&t.refCount++,i!=null&&El(i))}function Hu(t,r){t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&El(t))}function Gr(t,r,i,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)yh(t,r,i,c),r=r.sibling}function yh(t,r,i,c){var d=r.flags;switch(r.tag){case 0:case 11:case 15:Gr(t,r,i,c),d&2048&&Ul(9,r);break;case 1:Gr(t,r,i,c);break;case 3:Gr(t,r,i,c),d&2048&&(t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&El(t)));break;case 12:if(d&2048){Gr(t,r,i,c),t=r.stateNode;try{var m=r.memoizedProps,C=m.id,F=m.onPostCommit;typeof F=="function"&&F(C,r.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(ne){$t(r,r.return,ne)}}else Gr(t,r,i,c);break;case 13:Gr(t,r,i,c);break;case 23:break;case 22:m=r.stateNode,C=r.alternate,r.memoizedState!==null?m._visibility&2?Gr(t,r,i,c):Fl(t,r):m._visibility&2?Gr(t,r,i,c):(m._visibility|=2,$i(t,r,i,c,(r.subtreeFlags&10256)!==0)),d&2048&&Gu(C,r);break;case 24:Gr(t,r,i,c),d&2048&&Hu(r.alternate,r);break;default:Gr(t,r,i,c)}}function $i(t,r,i,c,d){for(d=d&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var m=t,C=r,F=i,ne=c,he=C.flags;switch(C.tag){case 0:case 11:case 15:$i(m,C,F,ne,d),Ul(8,C);break;case 23:break;case 22:var Ee=C.stateNode;C.memoizedState!==null?Ee._visibility&2?$i(m,C,F,ne,d):Fl(m,C):(Ee._visibility|=2,$i(m,C,F,ne,d)),d&&he&2048&&Gu(C.alternate,C);break;case 24:$i(m,C,F,ne,d),d&&he&2048&&Hu(C.alternate,C);break;default:$i(m,C,F,ne,d)}r=r.sibling}}function Fl(t,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var i=t,c=r,d=c.flags;switch(c.tag){case 22:Fl(i,c),d&2048&&Gu(c.alternate,c);break;case 24:Fl(i,c),d&2048&&Hu(c.alternate,c);break;default:Fl(i,c)}r=r.sibling}}var Pl=8192;function Wi(t){if(t.subtreeFlags&Pl)for(t=t.child;t!==null;)vh(t),t=t.sibling}function vh(t){switch(t.tag){case 26:Wi(t),t.flags&Pl&&t.memoizedState!==null&&l1(yr,t.memoizedState,t.memoizedProps);break;case 5:Wi(t);break;case 3:case 4:var r=yr;yr=uc(t.stateNode.containerInfo),Wi(t),yr=r;break;case 22:t.memoizedState===null&&(r=t.alternate,r!==null&&r.memoizedState!==null?(r=Pl,Pl=16777216,Wi(t),Pl=r):Wi(t));break;default:Wi(t)}}function bh(t){var r=t.alternate;if(r!==null&&(t=r.child,t!==null)){r.child=null;do r=t.sibling,t.sibling=null,t=r;while(t!==null)}}function zl(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];Bn=c,Sh(c,t)}bh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)xh(t),t=t.sibling}function xh(t){switch(t.tag){case 0:case 11:case 15:zl(t),t.flags&2048&&Os(9,t,t.return);break;case 3:zl(t);break;case 12:zl(t);break;case 22:var r=t.stateNode;t.memoizedState!==null&&r._visibility&2&&(t.return===null||t.return.tag!==13)?(r._visibility&=-3,Ko(t)):zl(t);break;default:zl(t)}}function Ko(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];Bn=c,Sh(c,t)}bh(t)}for(t=t.child;t!==null;){switch(r=t,r.tag){case 0:case 11:case 15:Os(8,r,r.return),Ko(r);break;case 22:i=r.stateNode,i._visibility&2&&(i._visibility&=-3,Ko(r));break;default:Ko(r)}t=t.sibling}}function Sh(t,r){for(;Bn!==null;){var i=Bn;switch(i.tag){case 0:case 11:case 15:Os(8,i,r);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var c=i.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:El(i.memoizedState.cache)}if(c=i.child,c!==null)c.return=i,Bn=c;else e:for(i=t;Bn!==null;){c=Bn;var d=c.sibling,m=c.return;if(dh(c),c===i){Bn=null;break e}if(d!==null){d.return=m,Bn=d;break e}Bn=m}}}var Ey={getCacheForType:function(t){var r=ra(_n),i=r.data.get(t);return i===void 0&&(i=t(),r.data.set(t,i)),i}},Ay=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Qt=null,Ct=null,Rt=0,Pt=0,Pa=null,js=!1,Zi=!1,Yu=!1,ms=0,dn=0,Us=0,bi=0,Vu=0,lr=0,Qi=0,Gl=null,Ma=null,qu=!1,Xu=0,Jo=1/0,ec=null,Bs=null,$n=0,Fs=null,Ki=null,Ji=0,$u=0,Wu=null,wh=null,Hl=0,Zu=null;function za(){if((Ft&2)!==0&&Rt!==0)return Rt&-Rt;if(V.T!==null){var t=Pi;return t!==0?t:af()}return Ra()}function Eh(){lr===0&&(lr=(Rt&536870912)===0||jt?Zn():536870912);var t=ir.current;return t!==null&&(t.flags|=32),lr}function Ga(t,r,i){(t===Qt&&(Pt===2||Pt===9)||t.cancelPendingCommit!==null)&&(el(t,0),Ps(t,Rt,lr,!1)),Tr(t,i),((Ft&2)===0||t!==Qt)&&(t===Qt&&((Ft&2)===0&&(bi|=i),dn===4&&Ps(t,Rt,lr,!1)),Hr(t))}function Ah(t,r,i){if((Ft&6)!==0)throw Error(s(327));var c=!i&&(r&124)===0&&(r&t.expiredLanes)===0||Mn(t,r),d=c?My(t,r):Ju(t,r,!0),m=c;do{if(d===0){Zi&&!c&&Ps(t,r,0,!1);break}else{if(i=t.current.alternate,m&&!Ty(i)){d=Ju(t,r,!1),m=!1;continue}if(d===2){if(m=r,t.errorRecoveryDisabledLanes&m)var C=0;else C=t.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){r=C;e:{var F=t;d=Gl;var ne=F.current.memoizedState.isDehydrated;if(ne&&(el(F,C).flags|=256),C=Ju(F,C,!1),C!==2){if(Yu&&!ne){F.errorRecoveryDisabledLanes|=m,bi|=m,d=4;break e}m=Ma,Ma=d,m!==null&&(Ma===null?Ma=m:Ma.push.apply(Ma,m))}d=C}if(m=!1,d!==2)continue}}if(d===1){el(t,0),Ps(t,r,0,!0);break}e:{switch(c=t,m=d,m){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:Ps(c,r,lr,!js);break e;case 2:Ma=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(d=Xu+300-Fe(),10<d)){if(Ps(c,r,lr,!js),ka(c,0,!0)!==0)break e;c.timeoutHandle=Jh(Th.bind(null,c,i,Ma,ec,qu,r,lr,bi,Qi,js,m,2,-0,0),d);break e}Th(c,i,Ma,ec,qu,r,lr,bi,Qi,js,m,0,-0,0)}}break}while(!0);Hr(t)}function Th(t,r,i,c,d,m,C,F,ne,he,Ee,Re,ye,ve){if(t.timeoutHandle=-1,Re=r.subtreeFlags,(Re&8192||(Re&16785408)===16785408)&&(Zl={stylesheets:null,count:0,unsuspend:i1},vh(r),Re=o1(),Re!==null)){t.cancelPendingCommit=Re(_h.bind(null,t,r,m,i,c,d,C,F,ne,Ee,1,ye,ve)),Ps(t,m,C,!he);return}_h(t,r,m,i,c,d,C,F,ne)}function Ty(t){for(var r=t;;){var i=r.tag;if((i===0||i===11||i===15)&&r.flags&16384&&(i=r.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var c=0;c<i.length;c++){var d=i[c],m=d.getSnapshot;d=d.value;try{if(!qn(m(),d))return!1}catch{return!1}}if(i=r.child,r.subtreeFlags&16384&&i!==null)i.return=r,r=i;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Ps(t,r,i,c){r&=~Vu,r&=~bi,t.suspendedLanes|=r,t.pingedLanes&=~r,c&&(t.warmLanes|=r),c=t.expirationTimes;for(var d=r;0<d;){var m=31-et(d),C=1<<m;c[m]=-1,d&=~C}i!==0&&oa(t,i,r)}function tc(){return(Ft&6)===0?(Yl(0),!1):!0}function Qu(){if(Ct!==null){if(Pt===0)var t=Ct.return;else t=Ct,ls=pi=null,hu(t),qi=null,Il=0,t=Ct;for(;t!==null;)rh(t.alternate,t),t=t.return;Ct=null}}function el(t,r){var i=t.timeoutHandle;i!==-1&&(t.timeoutHandle=-1,Hy(i)),i=t.cancelPendingCommit,i!==null&&(t.cancelPendingCommit=null,i()),Qu(),Qt=t,Ct=i=rs(t.current,null),Rt=r,Pt=0,Pa=null,js=!1,Zi=Mn(t,r),Yu=!1,Qi=lr=Vu=bi=Us=dn=0,Ma=Gl=null,qu=!1,(r&8)!==0&&(r|=r&32);var c=t.entangledLanes;if(c!==0)for(t=t.entanglements,c&=r;0<c;){var d=31-et(c),m=1<<d;r|=t[d],c&=~m}return ms=r,Eo(),i}function Ch(t,r){St=null,V.H=Go,r===Tl||r===_o?(r=Hd(),Pt=3):r===Pd?(r=Hd(),Pt=4):Pt=r===Yp?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Pa=r,Ct===null&&(dn=1,Xo(t,nr(r,t.current)))}function Mh(){var t=V.H;return V.H=Go,t===null?Go:t}function kh(){var t=V.A;return V.A=Ey,t}function Ku(){dn=4,js||(Rt&4194048)!==Rt&&ir.current!==null||(Zi=!0),(Us&134217727)===0&&(bi&134217727)===0||Qt===null||Ps(Qt,Rt,lr,!1)}function Ju(t,r,i){var c=Ft;Ft|=2;var d=Mh(),m=kh();(Qt!==t||Rt!==r)&&(ec=null,el(t,r)),r=!1;var C=dn;e:do try{if(Pt!==0&&Ct!==null){var F=Ct,ne=Pa;switch(Pt){case 8:Qu(),C=6;break e;case 3:case 2:case 9:case 6:ir.current===null&&(r=!0);var he=Pt;if(Pt=0,Pa=null,tl(t,F,ne,he),i&&Zi){C=0;break e}break;default:he=Pt,Pt=0,Pa=null,tl(t,F,ne,he)}}Cy(),C=dn;break}catch(Ee){Ch(t,Ee)}while(!0);return r&&t.shellSuspendCounter++,ls=pi=null,Ft=c,V.H=d,V.A=m,Ct===null&&(Qt=null,Rt=0,Eo()),C}function Cy(){for(;Ct!==null;)Nh(Ct)}function My(t,r){var i=Ft;Ft|=2;var c=Mh(),d=kh();Qt!==t||Rt!==r?(ec=null,Jo=Fe()+500,el(t,r)):Zi=Mn(t,r);e:do try{if(Pt!==0&&Ct!==null){r=Ct;var m=Pa;t:switch(Pt){case 1:Pt=0,Pa=null,tl(t,r,m,1);break;case 2:case 9:if(zd(m)){Pt=0,Pa=null,Rh(r);break}r=function(){Pt!==2&&Pt!==9||Qt!==t||(Pt=7),Hr(t)},m.then(r,r);break e;case 3:Pt=7;break e;case 4:Pt=5;break e;case 7:zd(m)?(Pt=0,Pa=null,Rh(r)):(Pt=0,Pa=null,tl(t,r,m,7));break;case 5:var C=null;switch(Ct.tag){case 26:C=Ct.memoizedState;case 5:case 27:var F=Ct;if(!C||f0(C)){Pt=0,Pa=null;var ne=F.sibling;if(ne!==null)Ct=ne;else{var he=F.return;he!==null?(Ct=he,nc(he)):Ct=null}break t}}Pt=0,Pa=null,tl(t,r,m,5);break;case 6:Pt=0,Pa=null,tl(t,r,m,6);break;case 8:Qu(),dn=6;break e;default:throw Error(s(462))}}ky();break}catch(Ee){Ch(t,Ee)}while(!0);return ls=pi=null,V.H=c,V.A=d,Ft=i,Ct!==null?0:(Qt=null,Rt=0,Eo(),dn)}function ky(){for(;Ct!==null&&!ze();)Nh(Ct)}function Nh(t){var r=nh(t.alternate,t,ms);t.memoizedProps=t.pendingProps,r===null?nc(t):Ct=r}function Rh(t){var r=t,i=r.alternate;switch(r.tag){case 15:case 0:r=Zp(i,r,r.pendingProps,r.type,void 0,Rt);break;case 11:r=Zp(i,r,r.pendingProps,r.type.render,r.ref,Rt);break;case 5:hu(r);default:rh(i,r),r=Ct=Dd(r,ms),r=nh(i,r,ms)}t.memoizedProps=t.pendingProps,r===null?nc(t):Ct=r}function tl(t,r,i,c){ls=pi=null,hu(r),qi=null,Il=0;var d=r.return;try{if(yy(t,d,r,i,Rt)){dn=1,Xo(t,nr(i,t.current)),Ct=null;return}}catch(m){if(d!==null)throw Ct=d,m;dn=1,Xo(t,nr(i,t.current)),Ct=null;return}r.flags&32768?(jt||c===1?t=!0:Zi||(Rt&536870912)!==0?t=!1:(js=t=!0,(c===2||c===9||c===3||c===6)&&(c=ir.current,c!==null&&c.tag===13&&(c.flags|=16384))),Dh(r,t)):nc(r)}function nc(t){var r=t;do{if((r.flags&32768)!==0){Dh(r,js);return}t=r.return;var i=by(r.alternate,r,ms);if(i!==null){Ct=i;return}if(r=r.sibling,r!==null){Ct=r;return}Ct=r=t}while(r!==null);dn===0&&(dn=5)}function Dh(t,r){do{var i=xy(t.alternate,t);if(i!==null){i.flags&=32767,Ct=i;return}if(i=t.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!r&&(t=t.sibling,t!==null)){Ct=t;return}Ct=t=i}while(t!==null);dn=6,Ct=null}function _h(t,r,i,c,d,m,C,F,ne){t.cancelPendingCommit=null;do ac();while($n!==0);if((Ft&6)!==0)throw Error(s(327));if(r!==null){if(r===t.current)throw Error(s(177));if(m=r.lanes|r.childLanes,m|=Hc,ha(t,i,m,C,F,ne),t===Qt&&(Ct=Qt=null,Rt=0),Ki=r,Fs=t,Ji=i,$u=m,Wu=d,wh=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,_y(mt,function(){return Uh(),null})):(t.callbackNode=null,t.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=V.T,V.T=null,d=ee.p,ee.p=2,C=Ft,Ft|=4;try{Sy(t,r,i)}finally{Ft=C,ee.p=d,V.T=c}}$n=1,Oh(),Ih(),Lh()}}function Oh(){if($n===1){$n=0;var t=Fs,r=Ki,i=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||i){i=V.T,V.T=null;var c=ee.p;ee.p=2;var d=Ft;Ft|=4;try{mh(r,t);var m=df,C=tr(t.containerInfo),F=m.focusedElem,ne=m.selectionRange;if(C!==F&&F&&F.ownerDocument&&wo(F.ownerDocument.documentElement,F)){if(ne!==null&&aa(F)){var he=ne.start,Ee=ne.end;if(Ee===void 0&&(Ee=he),"selectionStart"in F)F.selectionStart=he,F.selectionEnd=Math.min(Ee,F.value.length);else{var Re=F.ownerDocument||document,ye=Re&&Re.defaultView||window;if(ye.getSelection){var ve=ye.getSelection(),dt=F.textContent.length,ot=Math.min(ne.start,dt),Yt=ne.end===void 0?ot:Math.min(ne.end,dt);!ve.extend&&ot>Yt&&(C=Yt,Yt=ot,ot=C);var ue=Ts(F,ot),le=Ts(F,Yt);if(ue&&le&&(ve.rangeCount!==1||ve.anchorNode!==ue.node||ve.anchorOffset!==ue.offset||ve.focusNode!==le.node||ve.focusOffset!==le.offset)){var pe=Re.createRange();pe.setStart(ue.node,ue.offset),ve.removeAllRanges(),ot>Yt?(ve.addRange(pe),ve.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),ve.addRange(pe))}}}}for(Re=[],ve=F;ve=ve.parentNode;)ve.nodeType===1&&Re.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<Re.length;F++){var Ce=Re[F];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}mc=!!ff,df=ff=null}finally{Ft=d,ee.p=c,V.T=i}}t.current=r,$n=2}}function Ih(){if($n===2){$n=0;var t=Fs,r=Ki,i=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||i){i=V.T,V.T=null;var c=ee.p;ee.p=2;var d=Ft;Ft|=4;try{fh(t,r.alternate,r)}finally{Ft=d,ee.p=c,V.T=i}}$n=3}}function Lh(){if($n===4||$n===3){$n=0,nt();var t=Fs,r=Ki,i=Ji,c=wh;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?$n=5:($n=0,Ki=Fs=null,jh(t,t.pendingLanes));var d=t.pendingLanes;if(d===0&&(Bs=null),Cr(i),r=r.stateNode,It&&typeof It.onCommitFiberRoot=="function")try{It.onCommitFiberRoot(Ot,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=V.T,d=ee.p,ee.p=2,V.T=null;try{for(var m=t.onRecoverableError,C=0;C<c.length;C++){var F=c[C];m(F.value,{componentStack:F.stack})}}finally{V.T=r,ee.p=d}}(Ji&3)!==0&&ac(),Hr(t),d=t.pendingLanes,(i&4194090)!==0&&(d&42)!==0?t===Zu?Hl++:(Hl=0,Zu=t):Hl=0,Yl(0)}}function jh(t,r){(t.pooledCacheLanes&=r)===0&&(r=t.pooledCache,r!=null&&(t.pooledCache=null,El(r)))}function ac(t){return Oh(),Ih(),Lh(),Uh()}function Uh(){if($n!==5)return!1;var t=Fs,r=$u;$u=0;var i=Cr(Ji),c=V.T,d=ee.p;try{ee.p=32>i?32:i,V.T=null,i=Wu,Wu=null;var m=Fs,C=Ji;if($n=0,Ki=Fs=null,Ji=0,(Ft&6)!==0)throw Error(s(331));var F=Ft;if(Ft|=4,xh(m.current),yh(m,m.current,C,i),Ft=F,Yl(0,!1),It&&typeof It.onPostCommitFiberRoot=="function")try{It.onPostCommitFiberRoot(Ot,m)}catch{}return!0}finally{ee.p=d,V.T=c,jh(t,r)}}function Bh(t,r,i){r=nr(i,r),r=ku(t.stateNode,r,2),t=Ns(t,r,2),t!==null&&(Tr(t,2),Hr(t))}function $t(t,r,i){if(t.tag===3)Bh(t,t,i);else for(;r!==null;){if(r.tag===3){Bh(r,t,i);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Bs===null||!Bs.has(c))){t=nr(i,t),i=Gp(2),c=Ns(r,i,2),c!==null&&(Hp(i,c,r,t),Tr(c,2),Hr(c));break}}r=r.return}}function ef(t,r,i){var c=t.pingCache;if(c===null){c=t.pingCache=new Ay;var d=new Set;c.set(r,d)}else d=c.get(r),d===void 0&&(d=new Set,c.set(r,d));d.has(i)||(Yu=!0,d.add(i),t=Ny.bind(null,t,r,i),r.then(t,t))}function Ny(t,r,i){var c=t.pingCache;c!==null&&c.delete(r),t.pingedLanes|=t.suspendedLanes&i,t.warmLanes&=~i,Qt===t&&(Rt&i)===i&&(dn===4||dn===3&&(Rt&62914560)===Rt&&300>Fe()-Xu?(Ft&2)===0&&el(t,0):Vu|=i,Qi===Rt&&(Qi=0)),Hr(t)}function Fh(t,r){r===0&&(r=$e()),t=ji(t,r),t!==null&&(Tr(t,r),Hr(t))}function Ry(t){var r=t.memoizedState,i=0;r!==null&&(i=r.retryLane),Fh(t,i)}function Dy(t,r){var i=0;switch(t.tag){case 13:var c=t.stateNode,d=t.memoizedState;d!==null&&(i=d.retryLane);break;case 19:c=t.stateNode;break;case 22:c=t.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(r),Fh(t,i)}function _y(t,r){return gt(t,r)}var rc=null,nl=null,tf=!1,sc=!1,nf=!1,xi=0;function Hr(t){t!==nl&&t.next===null&&(nl===null?rc=nl=t:nl=nl.next=t),sc=!0,tf||(tf=!0,Iy())}function Yl(t,r){if(!nf&&sc){nf=!0;do for(var i=!1,c=rc;c!==null;){if(t!==0){var d=c.pendingLanes;if(d===0)var m=0;else{var C=c.suspendedLanes,F=c.pingedLanes;m=(1<<31-et(42|t)+1)-1,m&=d&~(C&~F),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(i=!0,Hh(c,m))}else m=Rt,m=ka(c,c===Qt?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(m&3)===0||Mn(c,m)||(i=!0,Hh(c,m));c=c.next}while(i);nf=!1}}function Oy(){Ph()}function Ph(){sc=tf=!1;var t=0;xi!==0&&(Gy()&&(t=xi),xi=0);for(var r=Fe(),i=null,c=rc;c!==null;){var d=c.next,m=zh(c,r);m===0?(c.next=null,i===null?rc=d:i.next=d,d===null&&(nl=i)):(i=c,(t!==0||(m&3)!==0)&&(sc=!0)),c=d}Yl(t)}function zh(t,r){for(var i=t.suspendedLanes,c=t.pingedLanes,d=t.expirationTimes,m=t.pendingLanes&-62914561;0<m;){var C=31-et(m),F=1<<C,ne=d[C];ne===-1?((F&i)===0||(F&c)!==0)&&(d[C]=Wr(F,r)):ne<=r&&(t.expiredLanes|=F),m&=~F}if(r=Qt,i=Rt,i=ka(t,t===r?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c=t.callbackNode,i===0||t===r&&(Pt===2||Pt===9)||t.cancelPendingCommit!==null)return c!==null&&c!==null&&Bt(c),t.callbackNode=null,t.callbackPriority=0;if((i&3)===0||Mn(t,i)){if(r=i&-i,r===t.callbackPriority)return r;switch(c!==null&&Bt(c),Cr(i)){case 2:case 8:i=Tn;break;case 32:i=mt;break;case 268435456:i=Pe;break;default:i=mt}return c=Gh.bind(null,t),i=gt(i,c),t.callbackPriority=r,t.callbackNode=i,r}return c!==null&&c!==null&&Bt(c),t.callbackPriority=2,t.callbackNode=null,2}function Gh(t,r){if($n!==0&&$n!==5)return t.callbackNode=null,t.callbackPriority=0,null;var i=t.callbackNode;if(ac()&&t.callbackNode!==i)return null;var c=Rt;return c=ka(t,t===Qt?c:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c===0?null:(Ah(t,c,r),zh(t,Fe()),t.callbackNode!=null&&t.callbackNode===i?Gh.bind(null,t):null)}function Hh(t,r){if(ac())return null;Ah(t,r,!0)}function Iy(){Yy(function(){(Ft&6)!==0?gt(In,Oy):Ph()})}function af(){return xi===0&&(xi=Zn()),xi}function Yh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:es(""+t)}function Vh(t,r){var i=r.ownerDocument.createElement("input");return i.name=r.name,i.value=r.value,t.id&&i.setAttribute("form",t.id),r.parentNode.insertBefore(i,r),t=new FormData(t),i.parentNode.removeChild(i),t}function Ly(t,r,i,c,d){if(r==="submit"&&i&&i.stateNode===d){var m=Yh((d[Wt]||null).action),C=c.submitter;C&&(r=(r=C[Wt]||null)?Yh(r.formAction):C.getAttribute("formAction"),r!==null&&(m=r,C=null));var F=new Ss("action","action",null,c,d);t.push({event:F,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(xi!==0){var ne=C?Vh(d,C):new FormData(d);Eu(i,{pending:!0,data:ne,method:d.method,action:m},null,ne)}}else typeof m=="function"&&(F.preventDefault(),ne=C?Vh(d,C):new FormData(d),Eu(i,{pending:!0,data:ne,method:d.method,action:m},m,ne))},currentTarget:d}]})}}for(var rf=0;rf<Gc.length;rf++){var sf=Gc[rf],jy=sf.toLowerCase(),Uy=sf[0].toUpperCase()+sf.slice(1);gr(jy,"on"+Uy)}gr(Ad,"onAnimationEnd"),gr(Td,"onAnimationIteration"),gr(Cd,"onAnimationStart"),gr("dblclick","onDoubleClick"),gr("focusin","onFocus"),gr("focusout","onBlur"),gr(ey,"onTransitionRun"),gr(ty,"onTransitionStart"),gr(ny,"onTransitionCancel"),gr(Md,"onTransitionEnd"),Nn("onMouseEnter",["mouseout","mouseover"]),Nn("onMouseLeave",["mouseout","mouseover"]),Nn("onPointerEnter",["pointerout","pointerover"]),Nn("onPointerLeave",["pointerout","pointerover"]),Ve("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ve("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ve("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ve("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),By=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vl));function qh(t,r){r=(r&4)!==0;for(var i=0;i<t.length;i++){var c=t[i],d=c.event;c=c.listeners;e:{var m=void 0;if(r)for(var C=c.length-1;0<=C;C--){var F=c[C],ne=F.instance,he=F.currentTarget;if(F=F.listener,ne!==m&&d.isPropagationStopped())break e;m=F,d.currentTarget=he;try{m(d)}catch(Ee){qo(Ee)}d.currentTarget=null,m=ne}else for(C=0;C<c.length;C++){if(F=c[C],ne=F.instance,he=F.currentTarget,F=F.listener,ne!==m&&d.isPropagationStopped())break e;m=F,d.currentTarget=he;try{m(d)}catch(Ee){qo(Ee)}d.currentTarget=null,m=ne}}}}function Mt(t,r){var i=r[Zr];i===void 0&&(i=r[Zr]=new Set);var c=t+"__bubble";i.has(c)||(Xh(r,t,2,!1),i.add(c))}function lf(t,r,i){var c=0;r&&(c|=4),Xh(i,t,c,r)}var ic="_reactListening"+Math.random().toString(36).slice(2);function of(t){if(!t[ic]){t[ic]=!0,Dt.forEach(function(i){i!=="selectionchange"&&(By.has(i)||lf(i,!1,t),lf(i,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[ic]||(r[ic]=!0,lf("selectionchange",!1,r))}}function Xh(t,r,i,c){switch(y0(r)){case 2:var d=f1;break;case 8:d=d1;break;default:d=wf}i=d.bind(null,r,i,t),d=void 0,!xs||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(d=!0),c?d!==void 0?t.addEventListener(r,i,{capture:!0,passive:d}):t.addEventListener(r,i,!0):d!==void 0?t.addEventListener(r,i,{passive:d}):t.addEventListener(r,i,!1)}function cf(t,r,i,c,d){var m=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var C=c.tag;if(C===3||C===4){var F=c.stateNode.containerInfo;if(F===d)break;if(C===4)for(C=c.return;C!==null;){var ne=C.tag;if((ne===3||ne===4)&&C.stateNode.containerInfo===d)return;C=C.return}for(;F!==null;){if(C=ur(F),C===null)return;if(ne=C.tag,ne===5||ne===6||ne===26||ne===27){c=m=C;continue e}F=F.parentNode}}c=c.return}ai(function(){var he=m,Ee=Dr(i),Re=[];e:{var ye=kd.get(t);if(ye!==void 0){var ve=Ss,dt=t;switch(t){case"keypress":if(Za(i)===0)break e;case"keydown":case"keyup":ve=w;break;case"focusin":dt="focus",ve=si;break;case"focusout":dt="blur",ve=si;break;case"beforeblur":case"afterblur":ve=si;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=Es;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=Lr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=j;break;case Ad:case Td:case Cd:ve=Ea;break;case Md:ve=ie;break;case"scroll":case"scrollend":ve=Ri;break;case"wheel":ve=de;break;case"copy":case"cut":case"paste":ve=Aa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=E;break;case"toggle":case"beforetoggle":ve=xe}var ot=(r&4)!==0,Yt=!ot&&(t==="scroll"||t==="scrollend"),ue=ot?ye!==null?ye+"Capture":null:ye;ot=[];for(var le=he,pe;le!==null;){var Ce=le;if(pe=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||pe===null||ue===null||(Ce=xa(le,ue),Ce!=null&&ot.push(ql(le,Ce,pe))),Yt)break;le=le.return}0<ot.length&&(ye=new ve(ye,dt,null,i,Ee),Re.push({event:ye,listeners:ot}))}}if((r&7)===0){e:{if(ye=t==="mouseover"||t==="pointerover",ve=t==="mouseout"||t==="pointerout",ye&&i!==Rr&&(dt=i.relatedTarget||i.fromElement)&&(ur(dt)||dt[sn]))break e;if((ve||ye)&&(ye=Ee.window===Ee?Ee:(ye=Ee.ownerDocument)?ye.defaultView||ye.parentWindow:window,ve?(dt=i.relatedTarget||i.toElement,ve=he,dt=dt?ur(dt):null,dt!==null&&(Yt=o(dt),ot=dt.tag,dt!==Yt||ot!==5&&ot!==27&&ot!==6)&&(dt=null)):(ve=null,dt=he),ve!==dt)){if(ot=Es,Ce="onMouseLeave",ue="onMouseEnter",le="mouse",(t==="pointerout"||t==="pointerover")&&(ot=E,Ce="onPointerLeave",ue="onPointerEnter",le="pointer"),Yt=ve==null?ye:ln(ve),pe=dt==null?ye:ln(dt),ye=new ot(Ce,le+"leave",ve,i,Ee),ye.target=Yt,ye.relatedTarget=pe,Ce=null,ur(Ee)===he&&(ot=new ot(ue,le+"enter",dt,i,Ee),ot.target=pe,ot.relatedTarget=Yt,Ce=ot),Yt=Ce,ve&&dt)t:{for(ot=ve,ue=dt,le=0,pe=ot;pe;pe=al(pe))le++;for(pe=0,Ce=ue;Ce;Ce=al(Ce))pe++;for(;0<le-pe;)ot=al(ot),le--;for(;0<pe-le;)ue=al(ue),pe--;for(;le--;){if(ot===ue||ue!==null&&ot===ue.alternate)break t;ot=al(ot),ue=al(ue)}ot=null}else ot=null;ve!==null&&$h(Re,ye,ve,ot,!1),dt!==null&&Yt!==null&&$h(Re,Yt,dt,ot,!0)}}e:{if(ye=he?ln(he):window,ve=ye.nodeName&&ye.nodeName.toLowerCase(),ve==="select"||ve==="input"&&ye.type==="file")var We=xn;else if(yt(ye))if(Zt)We=da;else{We=bt;var Et=Sn}else ve=ye.nodeName,!ve||ve.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?he&&Nr(he.elementType)&&(We=xn):We=Ja;if(We&&(We=We(t,he))){Ur(Re,We,i,Ee);break e}Et&&Et(t,ye,he),t==="focusout"&&he&&ye.type==="number"&&he.memoizedProps.value!=null&&va(ye,"number",ye.value)}switch(Et=he?ln(he):window,t){case"focusin":(yt(Et)||Et.contentEditable==="true")&&(Oi=Et,Fc=he,vl=null);break;case"focusout":vl=Fc=Oi=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,wd(Re,i,Ee);break;case"selectionchange":if(Jg)break;case"keydown":case"keyup":wd(Re,i,Ee)}var tt;if(me)e:{switch(t){case"compositionstart":var ut="onCompositionStart";break e;case"compositionend":ut="onCompositionEnd";break e;case"compositionupdate":ut="onCompositionUpdate";break e}ut=void 0}else rt?Ie(t,i)&&(ut="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(ut="onCompositionStart");ut&&(Te&&i.locale!=="ko"&&(rt||ut!=="onCompositionStart"?ut==="onCompositionEnd"&&rt&&(tt=Or()):(ua=Ee,fa="value"in ua?ua.value:ua.textContent,rt=!0)),Et=lc(he,ut),0<Et.length&&(ut=new _i(ut,t,null,i,Ee),Re.push({event:ut,listeners:Et}),tt?ut.data=tt:(tt=Je(i),tt!==null&&(ut.data=tt)))),(tt=Ne?Ke(t,i):st(t,i))&&(ut=lc(he,"onBeforeInput"),0<ut.length&&(Et=new _i("onBeforeInput","beforeinput",null,i,Ee),Re.push({event:Et,listeners:ut}),Et.data=tt)),Ly(Re,t,he,i,Ee)}qh(Re,r)})}function ql(t,r,i){return{instance:t,listener:r,currentTarget:i}}function lc(t,r){for(var i=r+"Capture",c=[];t!==null;){var d=t,m=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||m===null||(d=xa(t,i),d!=null&&c.unshift(ql(t,d,m)),d=xa(t,r),d!=null&&c.push(ql(t,d,m))),t.tag===3)return c;t=t.return}return[]}function al(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function $h(t,r,i,c,d){for(var m=r._reactName,C=[];i!==null&&i!==c;){var F=i,ne=F.alternate,he=F.stateNode;if(F=F.tag,ne!==null&&ne===c)break;F!==5&&F!==26&&F!==27||he===null||(ne=he,d?(he=xa(i,m),he!=null&&C.unshift(ql(i,he,ne))):d||(he=xa(i,m),he!=null&&C.push(ql(i,he,ne)))),i=i.return}C.length!==0&&t.push({event:r,listeners:C})}var Fy=/\r\n?/g,Py=/\u0000|\uFFFD/g;function Wh(t){return(typeof t=="string"?t:""+t).replace(Fy,`
`).replace(Py,"")}function Zh(t,r){return r=Wh(r),Wh(t)===r}function oc(){}function Ht(t,r,i,c,d,m){switch(i){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||ba(t,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&ba(t,""+c);break;case"className":Jn(t,"class",c);break;case"tabIndex":Jn(t,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Jn(t,i,c);break;case"style":Jr(t,c,m);break;case"data":if(r!=="object"){Jn(t,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||i!=="href")){t.removeAttribute(i);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=es(""+c),t.setAttribute(i,c);break;case"action":case"formAction":if(typeof c=="function"){t.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(i==="formAction"?(r!=="input"&&Ht(t,r,"name",d.name,d,null),Ht(t,r,"formEncType",d.formEncType,d,null),Ht(t,r,"formMethod",d.formMethod,d,null),Ht(t,r,"formTarget",d.formTarget,d,null)):(Ht(t,r,"encType",d.encType,d,null),Ht(t,r,"method",d.method,d,null),Ht(t,r,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=es(""+c),t.setAttribute(i,c);break;case"onClick":c!=null&&(t.onclick=oc);break;case"onScroll":c!=null&&Mt("scroll",t);break;case"onScrollEnd":c!=null&&Mt("scrollend",t);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"multiple":t.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":t.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){t.removeAttribute("xlink:href");break}i=es(""+c),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""+c):t.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""):t.removeAttribute(i);break;case"capture":case"download":c===!0?t.setAttribute(i,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,c):t.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?t.setAttribute(i,c):t.removeAttribute(i);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?t.removeAttribute(i):t.setAttribute(i,c);break;case"popover":Mt("beforetoggle",t),Mt("toggle",t),Ln(t,"popover",c);break;case"xlinkActuate":ea(t,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":ea(t,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":ea(t,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":ea(t,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":ea(t,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":ea(t,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":ea(t,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":ea(t,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":ea(t,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ln(t,"is",c);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=hr.get(i)||i,Ln(t,i,c))}}function uf(t,r,i,c,d,m){switch(i){case"style":Jr(t,c,m);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"children":typeof c=="string"?ba(t,c):(typeof c=="number"||typeof c=="bigint")&&ba(t,""+c);break;case"onScroll":c!=null&&Mt("scroll",t);break;case"onScrollEnd":c!=null&&Mt("scrollend",t);break;case"onClick":c!=null&&(t.onclick=oc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ge.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(d=i.endsWith("Capture"),r=i.slice(2,d?i.length-7:void 0),m=t[Wt]||null,m=m!=null?m[i]:null,typeof m=="function"&&t.removeEventListener(r,m,d),typeof c=="function")){typeof m!="function"&&m!==null&&(i in t?t[i]=null:t.hasAttribute(i)&&t.removeAttribute(i)),t.addEventListener(r,c,d);break e}i in t?t[i]=c:c===!0?t.setAttribute(i,""):Ln(t,i,c)}}}function Wn(t,r,i){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",t),Mt("load",t);var c=!1,d=!1,m;for(m in i)if(i.hasOwnProperty(m)){var C=i[m];if(C!=null)switch(m){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Ht(t,r,m,C,i,null)}}d&&Ht(t,r,"srcSet",i.srcSet,i,null),c&&Ht(t,r,"src",i.src,i,null);return;case"input":Mt("invalid",t);var F=m=C=d=null,ne=null,he=null;for(c in i)if(i.hasOwnProperty(c)){var Ee=i[c];if(Ee!=null)switch(c){case"name":d=Ee;break;case"type":C=Ee;break;case"checked":ne=Ee;break;case"defaultChecked":he=Ee;break;case"value":m=Ee;break;case"defaultValue":F=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(s(137,r));break;default:Ht(t,r,c,Ee,i,null)}}ei(t,m,F,ne,he,C,d,!1),Mr(t);return;case"select":Mt("invalid",t),c=C=m=null;for(d in i)if(i.hasOwnProperty(d)&&(F=i[d],F!=null))switch(d){case"value":m=F;break;case"defaultValue":C=F;break;case"multiple":c=F;default:Ht(t,r,d,F,i,null)}r=m,i=C,t.multiple=!!c,r!=null?Wa(t,!!c,r,!1):i!=null&&Wa(t,!!c,i,!0);return;case"textarea":Mt("invalid",t),m=d=c=null;for(C in i)if(i.hasOwnProperty(C)&&(F=i[C],F!=null))switch(C){case"value":c=F;break;case"defaultValue":d=F;break;case"children":m=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(s(91));break;default:Ht(t,r,C,F,i,null)}ti(t,c,d,m),Mr(t);return;case"option":for(ne in i)i.hasOwnProperty(ne)&&(c=i[ne],c!=null)&&(ne==="selected"?t.selected=c&&typeof c!="function"&&typeof c!="symbol":Ht(t,r,ne,c,i,null));return;case"dialog":Mt("beforetoggle",t),Mt("toggle",t),Mt("cancel",t),Mt("close",t);break;case"iframe":case"object":Mt("load",t);break;case"video":case"audio":for(c=0;c<Vl.length;c++)Mt(Vl[c],t);break;case"image":Mt("error",t),Mt("load",t);break;case"details":Mt("toggle",t);break;case"embed":case"source":case"link":Mt("error",t),Mt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(he in i)if(i.hasOwnProperty(he)&&(c=i[he],c!=null))switch(he){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Ht(t,r,he,c,i,null)}return;default:if(Nr(r)){for(Ee in i)i.hasOwnProperty(Ee)&&(c=i[Ee],c!==void 0&&uf(t,r,Ee,c,i,void 0));return}}for(F in i)i.hasOwnProperty(F)&&(c=i[F],c!=null&&Ht(t,r,F,c,i,null))}function zy(t,r,i,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,m=null,C=null,F=null,ne=null,he=null,Ee=null;for(ve in i){var Re=i[ve];if(i.hasOwnProperty(ve)&&Re!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":ne=Re;default:c.hasOwnProperty(ve)||Ht(t,r,ve,null,c,Re)}}for(var ye in c){var ve=c[ye];if(Re=i[ye],c.hasOwnProperty(ye)&&(ve!=null||Re!=null))switch(ye){case"type":m=ve;break;case"name":d=ve;break;case"checked":he=ve;break;case"defaultChecked":Ee=ve;break;case"value":C=ve;break;case"defaultValue":F=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(s(137,r));break;default:ve!==Re&&Ht(t,r,ye,ve,c,Re)}}Oa(t,C,F,ne,he,Ee,m,d);return;case"select":ve=C=F=ye=null;for(m in i)if(ne=i[m],i.hasOwnProperty(m)&&ne!=null)switch(m){case"value":break;case"multiple":ve=ne;default:c.hasOwnProperty(m)||Ht(t,r,m,null,c,ne)}for(d in c)if(m=c[d],ne=i[d],c.hasOwnProperty(d)&&(m!=null||ne!=null))switch(d){case"value":ye=m;break;case"defaultValue":F=m;break;case"multiple":C=m;default:m!==ne&&Ht(t,r,d,m,c,ne)}r=F,i=C,c=ve,ye!=null?Wa(t,!!i,ye,!1):!!c!=!!i&&(r!=null?Wa(t,!!i,r,!0):Wa(t,!!i,i?[]:"",!1));return;case"textarea":ve=ye=null;for(F in i)if(d=i[F],i.hasOwnProperty(F)&&d!=null&&!c.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:Ht(t,r,F,null,c,d)}for(C in c)if(d=c[C],m=i[C],c.hasOwnProperty(C)&&(d!=null||m!=null))switch(C){case"value":ye=d;break;case"defaultValue":ve=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==m&&Ht(t,r,C,d,c,m)}Ni(t,ye,ve);return;case"option":for(var dt in i)ye=i[dt],i.hasOwnProperty(dt)&&ye!=null&&!c.hasOwnProperty(dt)&&(dt==="selected"?t.selected=!1:Ht(t,r,dt,null,c,ye));for(ne in c)ye=c[ne],ve=i[ne],c.hasOwnProperty(ne)&&ye!==ve&&(ye!=null||ve!=null)&&(ne==="selected"?t.selected=ye&&typeof ye!="function"&&typeof ye!="symbol":Ht(t,r,ne,ye,c,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ot in i)ye=i[ot],i.hasOwnProperty(ot)&&ye!=null&&!c.hasOwnProperty(ot)&&Ht(t,r,ot,null,c,ye);for(he in c)if(ye=c[he],ve=i[he],c.hasOwnProperty(he)&&ye!==ve&&(ye!=null||ve!=null))switch(he){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(s(137,r));break;default:Ht(t,r,he,ye,c,ve)}return;default:if(Nr(r)){for(var Yt in i)ye=i[Yt],i.hasOwnProperty(Yt)&&ye!==void 0&&!c.hasOwnProperty(Yt)&&uf(t,r,Yt,void 0,c,ye);for(Ee in c)ye=c[Ee],ve=i[Ee],!c.hasOwnProperty(Ee)||ye===ve||ye===void 0&&ve===void 0||uf(t,r,Ee,ye,c,ve);return}}for(var ue in i)ye=i[ue],i.hasOwnProperty(ue)&&ye!=null&&!c.hasOwnProperty(ue)&&Ht(t,r,ue,null,c,ye);for(Re in c)ye=c[Re],ve=i[Re],!c.hasOwnProperty(Re)||ye===ve||ye==null&&ve==null||Ht(t,r,Re,ye,c,ve)}var ff=null,df=null;function cc(t){return t.nodeType===9?t:t.ownerDocument}function Qh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kh(t,r){if(t===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&r==="foreignObject"?0:t}function pf(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var hf=null;function Gy(){var t=window.event;return t&&t.type==="popstate"?t===hf?!1:(hf=t,!0):(hf=null,!1)}var Jh=typeof setTimeout=="function"?setTimeout:void 0,Hy=typeof clearTimeout=="function"?clearTimeout:void 0,e0=typeof Promise=="function"?Promise:void 0,Yy=typeof queueMicrotask=="function"?queueMicrotask:typeof e0<"u"?function(t){return e0.resolve(null).then(t).catch(Vy)}:Jh;function Vy(t){setTimeout(function(){throw t})}function zs(t){return t==="head"}function t0(t,r){var i=r,c=0,d=0;do{var m=i.nextSibling;if(t.removeChild(i),m&&m.nodeType===8)if(i=m.data,i==="/$"){if(0<c&&8>c){i=c;var C=t.ownerDocument;if(i&1&&Xl(C.documentElement),i&2&&Xl(C.body),i&4)for(i=C.head,Xl(i),C=i.firstChild;C;){var F=C.nextSibling,ne=C.nodeName;C[Hn]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&C.rel.toLowerCase()==="stylesheet"||i.removeChild(C),C=F}}if(d===0){t.removeChild(m),to(r);return}d--}else i==="$"||i==="$?"||i==="$!"?d++:c=i.charCodeAt(0)-48;else c=0;i=m}while(i);to(r)}function mf(t){var r=t.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var i=r;switch(r=r.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":mf(i),Qn(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}t.removeChild(i)}}function qy(t,r,i,c){for(;t.nodeType===1;){var d=i;if(t.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(c){if(!t[Hn])switch(r){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(m=t.getAttribute("rel"),m==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(m!==d.rel||t.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(m=t.getAttribute("src"),(m!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&m&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(r==="input"&&t.type==="hidden"){var m=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===m)return t}else return t;if(t=vr(t.nextSibling),t===null)break}return null}function Xy(t,r,i){if(r==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=vr(t.nextSibling),t===null))return null;return t}function gf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function $y(t,r){var i=t.ownerDocument;if(t.data!=="$?"||i.readyState==="complete")r();else{var c=function(){r(),i.removeEventListener("DOMContentLoaded",c)};i.addEventListener("DOMContentLoaded",c),t._reactRetry=c}}function vr(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return t}var yf=null;function n0(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(r===0)return t;r--}else i==="/$"&&r++}t=t.previousSibling}return null}function a0(t,r,i){switch(r=cc(i),t){case"html":if(t=r.documentElement,!t)throw Error(s(452));return t;case"head":if(t=r.head,!t)throw Error(s(453));return t;case"body":if(t=r.body,!t)throw Error(s(454));return t;default:throw Error(s(451))}}function Xl(t){for(var r=t.attributes;r.length;)t.removeAttributeNode(r[0]);Qn(t)}var or=new Map,r0=new Set;function uc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var gs=ee.d;ee.d={f:Wy,r:Zy,D:Qy,C:Ky,L:Jy,m:e1,X:n1,S:t1,M:a1};function Wy(){var t=gs.f(),r=tc();return t||r}function Zy(t){var r=Da(t);r!==null&&r.tag===5&&r.type==="form"?Ap(r):gs.r(t)}var rl=typeof document>"u"?null:document;function s0(t,r,i){var c=rl;if(c&&typeof r=="string"&&r){var d=jn(r);d='link[rel="'+t+'"][href="'+d+'"]',typeof i=="string"&&(d+='[crossorigin="'+i+'"]'),r0.has(d)||(r0.add(d),t={rel:t,crossOrigin:i,href:r},c.querySelector(d)===null&&(r=c.createElement("link"),Wn(r,"link",t),At(r),c.head.appendChild(r)))}}function Qy(t){gs.D(t),s0("dns-prefetch",t,null)}function Ky(t,r){gs.C(t,r),s0("preconnect",t,r)}function Jy(t,r,i){gs.L(t,r,i);var c=rl;if(c&&t&&r){var d='link[rel="preload"][as="'+jn(r)+'"]';r==="image"&&i&&i.imageSrcSet?(d+='[imagesrcset="'+jn(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(d+='[imagesizes="'+jn(i.imageSizes)+'"]')):d+='[href="'+jn(t)+'"]';var m=d;switch(r){case"style":m=sl(t);break;case"script":m=il(t)}or.has(m)||(t=v({rel:"preload",href:r==="image"&&i&&i.imageSrcSet?void 0:t,as:r},i),or.set(m,t),c.querySelector(d)!==null||r==="style"&&c.querySelector($l(m))||r==="script"&&c.querySelector(Wl(m))||(r=c.createElement("link"),Wn(r,"link",t),At(r),c.head.appendChild(r)))}}function e1(t,r){gs.m(t,r);var i=rl;if(i&&t){var c=r&&typeof r.as=="string"?r.as:"script",d='link[rel="modulepreload"][as="'+jn(c)+'"][href="'+jn(t)+'"]',m=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=il(t)}if(!or.has(m)&&(t=v({rel:"modulepreload",href:t},r),or.set(m,t),i.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Wl(m)))return}c=i.createElement("link"),Wn(c,"link",t),At(c),i.head.appendChild(c)}}}function t1(t,r,i){gs.S(t,r,i);var c=rl;if(c&&t){var d=ma(c).hoistableStyles,m=sl(t);r=r||"default";var C=d.get(m);if(!C){var F={loading:0,preload:null};if(C=c.querySelector($l(m)))F.loading=5;else{t=v({rel:"stylesheet",href:t,"data-precedence":r},i),(i=or.get(m))&&vf(t,i);var ne=C=c.createElement("link");At(ne),Wn(ne,"link",t),ne._p=new Promise(function(he,Ee){ne.onload=he,ne.onerror=Ee}),ne.addEventListener("load",function(){F.loading|=1}),ne.addEventListener("error",function(){F.loading|=2}),F.loading|=4,fc(C,r,c)}C={type:"stylesheet",instance:C,count:1,state:F},d.set(m,C)}}}function n1(t,r){gs.X(t,r);var i=rl;if(i&&t){var c=ma(i).hoistableScripts,d=il(t),m=c.get(d);m||(m=i.querySelector(Wl(d)),m||(t=v({src:t,async:!0},r),(r=or.get(d))&&bf(t,r),m=i.createElement("script"),At(m),Wn(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function a1(t,r){gs.M(t,r);var i=rl;if(i&&t){var c=ma(i).hoistableScripts,d=il(t),m=c.get(d);m||(m=i.querySelector(Wl(d)),m||(t=v({src:t,async:!0,type:"module"},r),(r=or.get(d))&&bf(t,r),m=i.createElement("script"),At(m),Wn(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function i0(t,r,i,c){var d=(d=Ue.current)?uc(d):null;if(!d)throw Error(s(446));switch(t){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(r=sl(i.href),i=ma(d).hoistableStyles,c=i.get(r),c||(c={type:"style",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){t=sl(i.href);var m=ma(d).hoistableStyles,C=m.get(t);if(C||(d=d.ownerDocument||d,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(t,C),(m=d.querySelector($l(t)))&&!m._p&&(C.instance=m,C.state.loading=5),or.has(t)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},or.set(t,i),m||r1(d,t,i,C.state))),r&&c===null)throw Error(s(528,""));return C}if(r&&c!==null)throw Error(s(529,""));return null;case"script":return r=i.async,i=i.src,typeof i=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=il(i),i=ma(d).hoistableScripts,c=i.get(r),c||(c={type:"script",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,t))}}function sl(t){return'href="'+jn(t)+'"'}function $l(t){return'link[rel="stylesheet"]['+t+"]"}function l0(t){return v({},t,{"data-precedence":t.precedence,precedence:null})}function r1(t,r,i,c){t.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=t.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Wn(r,"link",i),At(r),t.head.appendChild(r))}function il(t){return'[src="'+jn(t)+'"]'}function Wl(t){return"script[async]"+t}function o0(t,r,i){if(r.count++,r.instance===null)switch(r.type){case"style":var c=t.querySelector('style[data-href~="'+jn(i.href)+'"]');if(c)return r.instance=c,At(c),c;var d=v({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return c=(t.ownerDocument||t).createElement("style"),At(c),Wn(c,"style",d),fc(c,i.precedence,t),r.instance=c;case"stylesheet":d=sl(i.href);var m=t.querySelector($l(d));if(m)return r.state.loading|=4,r.instance=m,At(m),m;c=l0(i),(d=or.get(d))&&vf(c,d),m=(t.ownerDocument||t).createElement("link"),At(m);var C=m;return C._p=new Promise(function(F,ne){C.onload=F,C.onerror=ne}),Wn(m,"link",c),r.state.loading|=4,fc(m,i.precedence,t),r.instance=m;case"script":return m=il(i.src),(d=t.querySelector(Wl(m)))?(r.instance=d,At(d),d):(c=i,(d=or.get(m))&&(c=v({},i),bf(c,d)),t=t.ownerDocument||t,d=t.createElement("script"),At(d),Wn(d,"link",c),t.head.appendChild(d),r.instance=d);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,fc(c,i.precedence,t));return r.instance}function fc(t,r,i){for(var c=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,m=d,C=0;C<c.length;C++){var F=c[C];if(F.dataset.precedence===r)m=F;else if(m!==d)break}m?m.parentNode.insertBefore(t,m.nextSibling):(r=i.nodeType===9?i.head:i,r.insertBefore(t,r.firstChild))}function vf(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.title==null&&(t.title=r.title)}function bf(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.integrity==null&&(t.integrity=r.integrity)}var dc=null;function c0(t,r,i){if(dc===null){var c=new Map,d=dc=new Map;d.set(i,c)}else d=dc,c=d.get(i),c||(c=new Map,d.set(i,c));if(c.has(t))return c;for(c.set(t,null),i=i.getElementsByTagName(t),d=0;d<i.length;d++){var m=i[d];if(!(m[Hn]||m[Ut]||t==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var C=m.getAttribute(r)||"";C=t+C;var F=c.get(C);F?F.push(m):c.set(C,[m])}}return c}function u0(t,r,i){t=t.ownerDocument||t,t.head.insertBefore(i,r==="title"?t.querySelector("head > title"):null)}function s1(t,r,i){if(i===1||r.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(t=r.disabled,typeof r.precedence=="string"&&t==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function f0(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var Zl=null;function i1(){}function l1(t,r,i){if(Zl===null)throw Error(s(475));var c=Zl;if(r.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var d=sl(i.href),m=t.querySelector($l(d));if(m){t=m._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(c.count++,c=pc.bind(c),t.then(c,c)),r.state.loading|=4,r.instance=m,At(m);return}m=t.ownerDocument||t,i=l0(i),(d=or.get(d))&&vf(i,d),m=m.createElement("link"),At(m);var C=m;C._p=new Promise(function(F,ne){C.onload=F,C.onerror=ne}),Wn(m,"link",i),r.instance=m}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(r,t),(t=r.state.preload)&&(r.state.loading&3)===0&&(c.count++,r=pc.bind(c),t.addEventListener("load",r),t.addEventListener("error",r))}}function o1(){if(Zl===null)throw Error(s(475));var t=Zl;return t.stylesheets&&t.count===0&&xf(t,t.stylesheets),0<t.count?function(r){var i=setTimeout(function(){if(t.stylesheets&&xf(t,t.stylesheets),t.unsuspend){var c=t.unsuspend;t.unsuspend=null,c()}},6e4);return t.unsuspend=r,function(){t.unsuspend=null,clearTimeout(i)}}:null}function pc(){if(this.count--,this.count===0){if(this.stylesheets)xf(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var hc=null;function xf(t,r){t.stylesheets=null,t.unsuspend!==null&&(t.count++,hc=new Map,r.forEach(c1,t),hc=null,pc.call(t))}function c1(t,r){if(!(r.state.loading&4)){var i=hc.get(t);if(i)var c=i.get(null);else{i=new Map,hc.set(t,i);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<d.length;m++){var C=d[m];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(i.set(C.dataset.precedence,C),c=C)}c&&i.set(null,c)}d=r.instance,C=d.getAttribute("data-precedence"),m=i.get(C)||c,m===c&&i.set(null,d),i.set(C,d),this.count++,c=pc.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),m?m.parentNode.insertBefore(d,m.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),r.state.loading|=4}}var Ql={$$typeof:_,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function u1(t,r,i,c,d,m,C,F){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ct(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ct(0),this.hiddenUpdates=ct(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=m,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=F,this.incompleteTransitions=new Map}function d0(t,r,i,c,d,m,C,F,ne,he,Ee,Re){return t=new u1(t,r,i,C,F,ne,he,Re),r=1,m===!0&&(r|=24),m=Ua(3,null,null,r),t.current=m,m.stateNode=t,r=eu(),r.refCount++,t.pooledCache=r,r.refCount++,m.memoizedState={element:c,isDehydrated:i,cache:r},ru(m),t}function p0(t){return t?(t=Ui,t):Ui}function h0(t,r,i,c,d,m){d=p0(d),c.context===null?c.context=d:c.pendingContext=d,c=ks(r),c.payload={element:i},m=m===void 0?null:m,m!==null&&(c.callback=m),i=Ns(t,c,r),i!==null&&(Ga(i,t,r),Ml(i,t,r))}function m0(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<r?i:r}}function Sf(t,r){m0(t,r),(t=t.alternate)&&m0(t,r)}function g0(t){if(t.tag===13){var r=ji(t,67108864);r!==null&&Ga(r,t,67108864),Sf(t,67108864)}}var mc=!0;function f1(t,r,i,c){var d=V.T;V.T=null;var m=ee.p;try{ee.p=2,wf(t,r,i,c)}finally{ee.p=m,V.T=d}}function d1(t,r,i,c){var d=V.T;V.T=null;var m=ee.p;try{ee.p=8,wf(t,r,i,c)}finally{ee.p=m,V.T=d}}function wf(t,r,i,c){if(mc){var d=Ef(c);if(d===null)cf(t,r,c,gc,i),v0(t,c);else if(h1(d,t,r,i,c))c.stopPropagation();else if(v0(t,c),r&4&&-1<p1.indexOf(t)){for(;d!==null;){var m=Da(d);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var C=Gn(m.pendingLanes);if(C!==0){var F=m;for(F.pendingLanes|=2,F.entangledLanes|=2;C;){var ne=1<<31-et(C);F.entanglements[1]|=ne,C&=~ne}Hr(m),(Ft&6)===0&&(Jo=Fe()+500,Yl(0))}}break;case 13:F=ji(m,2),F!==null&&Ga(F,m,2),tc(),Sf(m,2)}if(m=Ef(c),m===null&&cf(t,r,c,gc,i),m===d)break;d=m}d!==null&&c.stopPropagation()}else cf(t,r,c,null,i)}}function Ef(t){return t=Dr(t),Af(t)}var gc=null;function Af(t){if(gc=null,t=ur(t),t!==null){var r=o(t);if(r===null)t=null;else{var i=r.tag;if(i===13){if(t=u(r),t!==null)return t;t=null}else if(i===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null)}}return gc=t,null}function y0(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(at()){case In:return 2;case Tn:return 8;case mt:case zn:return 32;case Pe:return 268435456;default:return 32}default:return 32}}var Tf=!1,Gs=null,Hs=null,Ys=null,Kl=new Map,Jl=new Map,Vs=[],p1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function v0(t,r){switch(t){case"focusin":case"focusout":Gs=null;break;case"dragenter":case"dragleave":Hs=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Kl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jl.delete(r.pointerId)}}function eo(t,r,i,c,d,m){return t===null||t.nativeEvent!==m?(t={blockedOn:r,domEventName:i,eventSystemFlags:c,nativeEvent:m,targetContainers:[d]},r!==null&&(r=Da(r),r!==null&&g0(r)),t):(t.eventSystemFlags|=c,r=t.targetContainers,d!==null&&r.indexOf(d)===-1&&r.push(d),t)}function h1(t,r,i,c,d){switch(r){case"focusin":return Gs=eo(Gs,t,r,i,c,d),!0;case"dragenter":return Hs=eo(Hs,t,r,i,c,d),!0;case"mouseover":return Ys=eo(Ys,t,r,i,c,d),!0;case"pointerover":var m=d.pointerId;return Kl.set(m,eo(Kl.get(m)||null,t,r,i,c,d)),!0;case"gotpointercapture":return m=d.pointerId,Jl.set(m,eo(Jl.get(m)||null,t,r,i,c,d)),!0}return!1}function b0(t){var r=ur(t.target);if(r!==null){var i=o(r);if(i!==null){if(r=i.tag,r===13){if(r=u(i),r!==null){t.blockedOn=r,Xa(t.priority,function(){if(i.tag===13){var c=za();c=Na(c);var d=ji(i,c);d!==null&&Ga(d,i,c),Sf(i,c)}});return}}else if(r===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function yc(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var i=Ef(t.nativeEvent);if(i===null){i=t.nativeEvent;var c=new i.constructor(i.type,i);Rr=c,i.target.dispatchEvent(c),Rr=null}else return r=Da(i),r!==null&&g0(r),t.blockedOn=i,!1;r.shift()}return!0}function x0(t,r,i){yc(t)&&i.delete(r)}function m1(){Tf=!1,Gs!==null&&yc(Gs)&&(Gs=null),Hs!==null&&yc(Hs)&&(Hs=null),Ys!==null&&yc(Ys)&&(Ys=null),Kl.forEach(x0),Jl.forEach(x0)}function vc(t,r){t.blockedOn===r&&(t.blockedOn=null,Tf||(Tf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,m1)))}var bc=null;function S0(t){bc!==t&&(bc=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){bc===t&&(bc=null);for(var r=0;r<t.length;r+=3){var i=t[r],c=t[r+1],d=t[r+2];if(typeof c!="function"){if(Af(c||i)===null)continue;break}var m=Da(i);m!==null&&(t.splice(r,3),r-=3,Eu(m,{pending:!0,data:d,method:i.method,action:c},c,d))}}))}function to(t){function r(ne){return vc(ne,t)}Gs!==null&&vc(Gs,t),Hs!==null&&vc(Hs,t),Ys!==null&&vc(Ys,t),Kl.forEach(r),Jl.forEach(r);for(var i=0;i<Vs.length;i++){var c=Vs[i];c.blockedOn===t&&(c.blockedOn=null)}for(;0<Vs.length&&(i=Vs[0],i.blockedOn===null);)b0(i),i.blockedOn===null&&Vs.shift();if(i=(t.ownerDocument||t).$$reactFormReplay,i!=null)for(c=0;c<i.length;c+=3){var d=i[c],m=i[c+1],C=d[Wt]||null;if(typeof m=="function")C||S0(i);else if(C){var F=null;if(m&&m.hasAttribute("formAction")){if(d=m,C=m[Wt]||null)F=C.formAction;else if(Af(d)!==null)continue}else F=C.action;typeof F=="function"?i[c+1]=F:(i.splice(c,3),c-=3),S0(i)}}}function Cf(t){this._internalRoot=t}xc.prototype.render=Cf.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(s(409));var i=r.current,c=za();h0(i,c,t,r,null,null)},xc.prototype.unmount=Cf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;h0(t.current,2,null,t,null,null),tc(),r[sn]=null}};function xc(t){this._internalRoot=t}xc.prototype.unstable_scheduleHydration=function(t){if(t){var r=Ra();t={blockedOn:null,target:t,priority:r};for(var i=0;i<Vs.length&&r!==0&&r<Vs[i].priority;i++);Vs.splice(i,0,t),i===0&&b0(t)}};var w0=e.version;if(w0!=="19.1.1")throw Error(s(527,w0,"19.1.1"));ee.findDOMNode=function(t){var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(s(188)):(t=Object.keys(t).join(","),Error(s(268,t)));return t=p(r),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var g1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sc.isDisabled&&Sc.supportsFiber)try{Ot=Sc.inject(g1),It=Sc}catch{}}return ao.createRoot=function(t,r){if(!l(t))throw Error(s(299));var i=!1,c="",d=Bp,m=Fp,C=Pp,F=null;return r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(d=r.onUncaughtError),r.onCaughtError!==void 0&&(m=r.onCaughtError),r.onRecoverableError!==void 0&&(C=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(F=r.unstable_transitionCallbacks)),r=d0(t,1,!1,null,null,i,c,d,m,C,F,null),t[sn]=r.current,of(t),new Cf(r)},ao.hydrateRoot=function(t,r,i){if(!l(t))throw Error(s(299));var c=!1,d="",m=Bp,C=Fp,F=Pp,ne=null,he=null;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(m=i.onUncaughtError),i.onCaughtError!==void 0&&(C=i.onCaughtError),i.onRecoverableError!==void 0&&(F=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(ne=i.unstable_transitionCallbacks),i.formState!==void 0&&(he=i.formState)),r=d0(t,1,!0,r,i??null,c,d,m,C,F,ne,he),r.context=p0(null),i=r.current,c=za(),c=Na(c),d=ks(c),d.callback=null,Ns(i,d,c),i=c,r.current.lanes=i,Tr(r,i),Hr(r),t[sn]=r.current,of(t),new xc(r)},ao.version="19.1.1",ao}var _0;function T1(){if(_0)return Nf.exports;_0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Nf.exports=A1(),Nf.exports}var C1=T1();const M1=rd(C1),k1="modulepreload",N1=function(n,e){return new URL(n,e).href},O0={},I0=function(e,a,s){let l=Promise.resolve();if(a&&a.length>0){let g=function(v){return Promise.all(v.map(A=>Promise.resolve(A).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");l=g(a.map(v=>{if(v=N1(v,s),v in O0)return;O0[v]=!0;const A=v.endsWith(".css"),S=A?'[rel="stylesheet"]':"";if(s)for(let M=u.length-1;M>=0;M--){const D=u[M];if(D.href===v&&(!A||D.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${S}`))return;const b=document.createElement("link");if(b.rel=A?"stylesheet":k1,A||(b.as="script"),b.crossOrigin="",b.href=v,p&&b.setAttribute("nonce",p),document.head.appendChild(b),A)return new Promise((M,D)=>{b.addEventListener("load",M),b.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return l.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};class br{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,a,s={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==br.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof a!="function")throw new TypeError("The callback must be a function.");const l=new L0(e,this,a,s);return this.eventMap[e]||(this.eventMap[e]=[]),s.prepend?this.eventMap[e].unshift(l):this.eventMap[e].push(l),l}addOneTimeListener(e,a,s={}){s.remaining=1,this.addListener(e,a,s)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,a){return e===void 0?this.eventMap[br.ANY_EVENT]&&this.eventMap[br.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,s])=>s.length>0):this.eventMap[e]&&this.eventMap[e].length>0?a instanceof L0?this.eventMap[e].filter(l=>l===a).length>0:typeof a=="function"?this.eventMap[e].filter(l=>l.callback===a).length>0:a==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...a){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let s=[],l=this.eventMap[br.ANY_EVENT]||[];return this.eventMap[e]&&(l=l.concat(this.eventMap[e])),l.forEach(o=>{if(o.suspended)return;let u=[...a];Array.isArray(o.arguments)&&(u=u.concat(o.arguments)),o.remaining>0&&(s.push(o.callback.apply(o.context,u)),o.count++),--o.remaining<1&&o.remove()}),s}removeListener(e,a,s={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let l=this.eventMap[e].filter(o=>a&&o.callback!==a||s.remaining&&s.remaining!==o.remaining||s.context&&s.context!==o.context);l.length?this.eventMap[e]=l:delete this.eventMap[e]}async waitFor(e,a={}){return a.duration=parseInt(a.duration),(isNaN(a.duration)||a.duration<=0)&&(a.duration=1/0),new Promise((s,l)=>{let o,u=this.addListener(e,()=>{clearTimeout(o),s()},{remaining:1});a.duration!==1/0&&(o=setTimeout(()=>{u.remove(),l("The duration expired before the event was emitted.")},a.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class L0{constructor(e,a,s,l={}){if(typeof e!="string"&&!(e instanceof String)&&e!==br.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!a)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof s!="function")throw new TypeError("The 'callback' must be a function.");l.arguments!==void 0&&!Array.isArray(l.arguments)&&(l.arguments=[l.arguments]),l=Object.assign({context:a,remaining:1/0,arguments:void 0,duration:1/0},l),l.duration!==1/0&&setTimeout(()=>this.remove(),l.duration),this.arguments=l.arguments,this.callback=s,this.context=l.context,this.count=0,this.event=e,this.remaining=parseInt(l.remaining)>=1?parseInt(l.remaining):1/0,this.suspended=!1,this.target=a}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class Me{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Me.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Me.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Me.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Me.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class ul{constructor(e,a={}){this.duration=_e.defaults.note.duration,this.attack=_e.defaults.note.attack,this.release=_e.defaults.note.release,a.duration!=null&&(this.duration=a.duration),a.attack!=null&&(this.attack=a.attack),a.rawAttack!=null&&(this.attack=Be.from7bitToFloat(a.rawAttack)),a.release!=null&&(this.release=a.release),a.rawRelease!=null&&(this.release=Be.from7bitToFloat(a.rawRelease)),Number.isInteger(e)?this.identifier=Be.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const a=Be.getNoteDetails(e);if(_e.validation&&!e)throw new Error("Invalid note identifier");this._name=a.name,this._accidental=a.accidental,this._octave=a.octave}get name(){return this._name}set name(e){if(_e.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(_e.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(_e.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Be.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Be.from7bitToFloat(e)}get rawRelease(){return Be.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Be.from7bitToFloat(e)}get number(){return Be.toNoteNumber(this.identifier)}getOffsetNumber(e=0,a=0){return _e.validation&&(e=parseInt(e)||0,a=parseInt(a)||0),Math.min(Math.max(this.number+e*12+a,0),127)}}class Be{static toNoteNumber(e,a=0){if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const s=this.getNoteDetails(e);if(!s)throw new TypeError("Invalid note identifier");const l={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let o=(s.octave+1+a)*12;if(o+=l[s.name],s.accidental&&(s.accidental.startsWith("b")?o-=s.accidental.length:o+=s.accidental.length),o<0||o>127)throw new RangeError("Invalid octaveOffset value");return o}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const a=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!a)throw new TypeError("Invalid note identifier");const s=a[1].toUpperCase(),l=parseInt(a[3]);let o=a[2].toLowerCase();return o=o===""?void 0:o,{accidental:o,identifier:s+(o||"")+l,name:s,octave:l}}static sanitizeChannels(e){let a;if(_e.validation){if(e==="all")a=["all"];else if(e==="none")return[]}return Array.isArray(e)?a=e:a=[e],a.indexOf("all")>-1&&(a=Me.MIDI_CHANNEL_NUMBERS),a.map(function(s){return parseInt(s)}).filter(function(s){return s>=1&&s<=16})}static toTimestamp(e){let a=!1;const s=parseFloat(e);return isNaN(s)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?s>=0&&(a=_e.time+s):s>=0&&(a=s),a)}static guessNoteNumber(e,a){a=parseInt(a)||0;let s=!1;if(Number.isInteger(e)&&e>=0&&e<=127)s=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)s=parseInt(e);else if(typeof e=="string"||e instanceof String)try{s=this.toNoteNumber(e.trim(),a)}catch{return!1}return s}static toNoteIdentifier(e,a){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid octaveOffset value");const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=Math.floor(e/12-1)+a;return s[e%12]+l.toString()}static buildNote(e,a={}){if(a.octaveOffset=parseInt(a.octaveOffset)||0,e instanceof ul)return e;let s=this.guessNoteNumber(e,a.octaveOffset);if(s===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return a.octaveOffset=void 0,new ul(s,a)}static buildNoteArray(e,a={}){let s=[];return Array.isArray(e)||(e=[e]),e.forEach(l=>{s.push(this.buildNote(l,a))}),s}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,a=0){_e.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),a=Math.min(Math.max(parseInt(a)||0,0),127));const s=((e<<7)+a)/16383;return Math.min(Math.max(s,0),1)}static fromFloatToMsbLsb(e){_e.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const a=Math.round(e*16383);return{msb:a>>7,lsb:a&127}}static offsetNumber(e,a=0,s=0){if(_e.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");a=parseInt(a)||0,s=parseInt(s)||0}return Math.min(Math.max(e+a*12+s,0),127)}static getPropertyByValue(e,a){return Object.keys(e).find(s=>e[s]===a)}static getCcNameByNumber(e){if(!(_e.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return Me.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let a=Me.CONTROL_CHANGE_MESSAGES.find(s=>s.name===e);return a?a.number:Me.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let a in Me.CHANNEL_MODE_MESSAGES)if(Me.CHANNEL_MODE_MESSAGES.hasOwnProperty(a)&&e===Me.CHANNEL_MODE_MESSAGES[a])return a;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}class R1 extends br{constructor(e,a){super(),this._output=e,this._number=a,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,a={time:0}){return this.output.send(e,a),this}sendKeyAftertouch(e,a,s={}){if(_e.validation){if(s.useRawValue&&(s.rawValue=s.useRawValue),isNaN(parseFloat(a)))throw new RangeError("Invalid key aftertouch value.");if(s.rawValue){if(!(a>=0&&a<=127&&Number.isInteger(a)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(a>=0&&a<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}s.rawValue||(a=Be.fromFloatTo7Bit(a));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Be.buildNoteArray(e).forEach(o=>{this.send([(Me.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),o.getOffsetNumber(l),a],{time:Be.toTimestamp(s.time)})}),this}sendControlChange(e,a,s={}){if(typeof e=="string"&&(e=Be.getCcNumberByName(e)),Array.isArray(a)||(a=[a]),_e.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(a=a.map(l=>{const o=Math.min(Math.max(parseInt(l),0),127);if(isNaN(o))throw new TypeError("Values must be integers between 0 and 127");return o}),a.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return a.forEach((l,o)=>{this.send([(Me.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+o*32,a[o]],{time:Be.toTimestamp(s.time)})}),this}_selectNonRegisteredParameter(e,a={}){return this.sendControlChange(99,e[0],a),this.sendControlChange(98,e[1],a),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,a={}){return this.sendControlChange(101,e[0],a),this.sendControlChange(100,e[1],a),this}_setCurrentParameter(e,a={}){return e=[].concat(e),this.sendControlChange(6,e[0],a),e.length<2?this:(this.sendControlChange(38,e[1],a),this)}sendRpnDecrement(e,a={}){if(Array.isArray(e)||(e=Me.REGISTERED_PARAMETERS[e]),_e.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Me.REGISTERED_PARAMETERS).forEach(l=>{Me.REGISTERED_PARAMETERS[l][0]===e[0]&&Me.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(97,0,a),this._deselectRegisteredParameter(a),this}sendRpnIncrement(e,a={}){if(Array.isArray(e)||(e=Me.REGISTERED_PARAMETERS[e]),_e.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Me.REGISTERED_PARAMETERS).forEach(l=>{Me.REGISTERED_PARAMETERS[l][0]===e[0]&&Me.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(96,0,a),this._deselectRegisteredParameter(a),this}playNote(e,a={}){this.sendNoteOn(e,a);const s=Array.isArray(e)?e:[e];for(let l of s)if(parseInt(l.duration)>0){const o={time:(Be.toTimestamp(a.time)||_e.time)+parseInt(l.duration),release:l.release,rawRelease:l.rawRelease};this.sendNoteOff(l,o)}else if(parseInt(a.duration)>0){const o={time:(Be.toTimestamp(a.time)||_e.time)+parseInt(a.duration),release:a.release,rawRelease:a.rawRelease};this.sendNoteOff(l,o)}return this}sendNoteOff(e,a={}){if(_e.validation){if(a.rawRelease!=null&&!(a.rawRelease>=0&&a.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(a.release!=null&&!(a.release>=0&&a.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");a.rawVelocity&&(a.rawRelease=a.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),a.velocity&&(a.release=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawRelease!=null?s=a.rawRelease:isNaN(a.release)||(s=Math.round(a.release*127));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Be.buildNoteArray(e,{rawRelease:parseInt(s)}).forEach(o=>{this.send([(Me.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),o.getOffsetNumber(l),o.rawRelease],{time:Be.toTimestamp(a.time)})}),this}stopNote(e,a={}){return this.sendNoteOff(e,a)}sendNoteOn(e,a={}){if(_e.validation){if(a.rawAttack!=null&&!(a.rawAttack>=0&&a.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(a.attack!=null&&!(a.attack>=0&&a.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");a.rawVelocity&&(a.rawAttack=a.velocity,a.rawRelease=a.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),a.velocity&&(a.attack=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawAttack!=null?s=a.rawAttack:isNaN(a.attack)||(s=Math.round(a.attack*127));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Be.buildNoteArray(e,{rawAttack:s}).forEach(o=>{this.send([(Me.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),o.getOffsetNumber(l),o.rawAttack],{time:Be.toTimestamp(a.time)})}),this}sendChannelMode(e,a=0,s={}){if(typeof e=="string"&&(e=Me.CHANNEL_MODE_MESSAGES[e]),_e.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(a))||a<0||a>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Me.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,a],{time:Be.toTimestamp(s.time)}),this}sendOmniMode(e,a={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,a):this.sendChannelMode("omnimodeoff",0,a),this}sendChannelAftertouch(e,a={}){if(_e.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(a.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return a.rawValue||(e=Be.fromFloatTo7Bit(e)),this.send([(Me.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:Be.toTimestamp(a.time)}),this}sendMasterTuning(e,a={}){if(e=parseFloat(e)||0,_e.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let s=Math.floor(e)+64,l=e-Math.floor(e);l=Math.round((l+1)/2*16383);let o=l>>7&127,u=l&127;return this.sendRpnValue("channelcoarsetuning",s,a),this.sendRpnValue("channelfinetuning",[o,u],a),this}sendModulationRange(e,a,s={}){if(_e.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(a!=null&&(!Number.isInteger(a)||!(a>=0&&a<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return a>=0&&a<=127||(a=0),this.sendRpnValue("modulationrange",[e,a],s),this}sendNrpnValue(e,a,s={}){if(a=[].concat(a),_e.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");a.forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectNonRegisteredParameter(s),this}sendPitchBend(e,a={}){if(_e.validation)if(a.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(a.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let s=0,l=0;if(a.rawValue&&Array.isArray(e))s=e[0],l=e[1];else if(a.rawValue&&!Array.isArray(e))s=e;else{const o=Be.fromFloatToMsbLsb((e+1)/2);s=o.msb,l=o.lsb}return this.send([(Me.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),l,s],{time:Be.toTimestamp(a.time)}),this}sendPitchBendRange(e,a,s={}){if(_e.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(a)||!(a>=0&&a<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,a],s),this}sendProgramChange(e,a={}){if(e=parseInt(e)||0,_e.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Me.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Be.toTimestamp(a.time)}),this}sendRpnValue(e,a,s={}){if(Array.isArray(e)||(e=Me.REGISTERED_PARAMETERS[e]),_e.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(a).forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectRegisteredParameter(s),this}sendTuningBank(e,a={}){if(_e.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,a),this}sendTuningProgram(e,a={}){if(_e.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,a),this}sendLocalControl(e,a={}){return e?this.sendChannelMode("localcontrol",127,a):this.sendChannelMode("localcontrol",0,a)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,a={}){return e==="mono"?this.sendChannelMode("monomodeon",0,a):this.sendChannelMode("polymodeon",0,a)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class Vf extends br{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new R1(this,a);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let a={timestamp:_e.time};e.port.connection==="open"?(a.type="opened",a.target=this,a.port=a.target,this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",a.target=this,a.port=a.target,this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,a={time:0},s=0){if(e instanceof Pm&&(e=Be.isNode?e.data:e.rawData),e instanceof Uint8Array&&Be.isNode&&(e=Array.from(e)),_e.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(a)&&(e=e.concat(a)),a=isNaN(s)?{time:0}:{time:s}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(l=>{if(l=parseInt(l),!(l>=0&&l<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),a||(a={time:0})}return this._midiOutput.send(e,Be.toTimestamp(a.time)),this}sendSysex(e,a=[],s={}){if(e=[].concat(e),a instanceof Uint8Array){const l=new Uint8Array(1+e.length+a.length+1);l[0]=Me.SYSTEM_MESSAGES.sysex,l.set(Uint8Array.from(e),1),l.set(a,1+e.length),l[l.length-1]=Me.SYSTEM_MESSAGES.sysexend,this.send(l,{time:s.time})}else{const l=e.concat(a,Me.SYSTEM_MESSAGES.sysexend);this.send([Me.SYSTEM_MESSAGES.sysex].concat(l),{time:s.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():_e.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,a={}){if(_e.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Me.SYSTEM_MESSAGES.timecode,e],{time:a.time}),this}sendSongPosition(e=0,a={}){e=Math.floor(e)||0;var s=e>>7&127,l=e&127;return this.send([Me.SYSTEM_MESSAGES.songposition,s,l],{time:a.time}),this}sendSongSelect(e=0,a={}){if(_e.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Me.SYSTEM_MESSAGES.songselect,e],{time:a.time}),this}sendTuneRequest(e={}){return this.send([Me.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Me.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Me.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Me.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Me.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Me.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Me.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return _e.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,a,s={}){return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendKeyAftertouch(e,a,s)}),this}sendControlChange(e,a,s={},l={}){if(_e.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendControlChange(e,a,s)}),this}sendPitchBendRange(e=0,a=0,s={}){return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendPitchBendRange(e,a,s)}),this}setPitchBendRange(e=0,a=0,s="all",l={}){return _e.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,a,l)}sendRpnValue(e,a,s={}){return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendRpnValue(e,a,s)}),this}setRegisteredParameter(e,a=[],s="all",l={}){return _e.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,a,l)}sendChannelAftertouch(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendChannelAftertouch(e,a)}),this}sendPitchBend(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPitchBend(e,a)}),this}sendProgramChange(e=0,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendProgramChange(e,a)}),this}sendModulationRange(e,a,s={}){return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendModulationRange(e,a,s)}),this}setModulationRange(e=0,a=0,s="all",l={}){return _e.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,a,l)}sendMasterTuning(e,a={}){return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendMasterTuning(e,a)}),this}setMasterTuning(e,a={},s={}){return _e.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),s.channels=a,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,s)}sendTuningProgram(e,a={}){return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningProgram(e,a)}),this}setTuningProgram(e,a="all",s={}){return _e.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),s.channels=a,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,s)}sendTuningBank(e=0,a={}){return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningBank(e,a)}),this}setTuningBank(e,a="all",s={}){return _e.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),s.channels=a,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,s)}sendChannelMode(e,a=0,s={},l={}){if(_e.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendChannelMode(e,a,s)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},a={}){if(_e.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const s=e;e=a,e.channels=s,e.channels==="all"&&(e.channels=Me.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(e.channels).forEach(s=>{this.channels[s].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPolyphonicMode(e,a)}),this}sendLocalControl(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendLocalControl(e,a)}),this}sendOmniMode(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendOmniMode(e,a)}),this}sendNrpnValue(e,a,s={}){return s.channels==null&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendNrpnValue(e,a,s)}),this}setNonRegisteredParameter(e,a=[],s="all",l={}){return _e.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,a,l)}sendRpnIncrement(e,a={}){return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnIncrement(e,a)}),this}incrementRegisteredParameter(e,a="all",s={}){return _e.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,s)}sendRpnDecrement(e,a={}){return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnDecrement(e,a)}),this}decrementRegisteredParameter(e,a="all",s={}){return _e.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Me.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,s)}sendNoteOff(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOff(e,a)}),this}stopNote(e,a){return this.sendNoteOff(e,a)}playNote(e,a={},s={}){if(_e.validation&&(a.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),a.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].playNote(e,a)}),this}sendNoteOn(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Me.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOn(e,a)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class j0{constructor(e=[],a={}){this.destinations=[],this.types=[...Object.keys(Me.SYSTEM_MESSAGES),...Object.keys(Me.CHANNEL_MESSAGES)],this.channels=Me.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),a.types&&!Array.isArray(a.types)&&(a.types=[a.types]),a.channels&&!Array.isArray(a.channels)&&(a.channels=[a.channels]),_e.validation&&(e.forEach(s=>{if(!(s instanceof Vf))throw new TypeError("Destinations must be of type 'Output'.")}),a.types!==void 0&&a.types.forEach(s=>{if(!Me.SYSTEM_MESSAGES.hasOwnProperty(s)&&!Me.CHANNEL_MESSAGES.hasOwnProperty(s))throw new TypeError("Type must be a valid message type.")}),a.channels!==void 0&&a.channels.forEach(s=>{if(!Me.MIDI_CHANNEL_NUMBERS.includes(s))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,a.types&&(this.types=a.types),a.channels&&(this.channels=a.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(a=>{_e.validation&&!(a instanceof Vf)||a.send(e)}))}}class D1 extends br{constructor(e,a){super(),this._input=e,this._number=a,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const a=Object.assign({},e);a.port=this.input,a.target=this,a.type="midimessage",this.emit(a.type,a),this._parseEventForStandardMessages(a)}_parseEventForStandardMessages(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmessage";const s=e.message.dataBytes[0],l=e.message.dataBytes[1];if(a.type==="noteoff"||a.type==="noteon"&&l===0)this.notesState[s]=!1,a.type="noteoff",a.note=new ul(Be.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset),{rawAttack:0,rawRelease:l}),a.value=Be.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.release,a.rawVelocity=a.note.rawRelease;else if(a.type==="noteon")this.notesState[s]=!0,a.note=new ul(Be.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset),{rawAttack:l}),a.value=Be.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.attack,a.rawVelocity=a.note.rawAttack;else if(a.type==="keyaftertouch")a.note=new ul(Be.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset)),a.value=Be.from7bitToFloat(l),a.rawValue=l,a.identifier=a.note.identifier,a.key=a.note.number,a.rawKey=s;else if(a.type==="controlchange"){a.controller={number:s,name:Me.CONTROL_CHANGE_MESSAGES[s].name,description:Me.CONTROL_CHANGE_MESSAGES[s].description,position:Me.CONTROL_CHANGE_MESSAGES[s].position},a.subtype=a.controller.name||"controller"+s,a.value=Be.from7bitToFloat(l),a.rawValue=l;const o=Object.assign({},a);o.type=`${a.type}-controller${s}`,delete o.subtype,this.emit(o.type,o);const u=Object.assign({},a);u.type=`${a.type}-`+Me.CONTROL_CHANGE_MESSAGES[s].name,delete u.subtype,u.type.indexOf("controller")!==0&&this.emit(u.type,u),a.message.dataBytes[0]>=120&&this._parseChannelModeMessage(a),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(a.message.dataBytes[0])&&this._parseEventForParameterNumber(a)}else a.type==="programchange"?(a.value=s,a.rawValue=a.value):a.type==="channelaftertouch"?(a.value=Be.from7bitToFloat(s),a.rawValue=s):a.type==="pitchbend"?(a.value=((l<<7)+s-8192)/8192,a.rawValue=(l<<7)+s):a.type="unknownmessage";this.emit(a.type,a)}_parseChannelModeMessage(e){const a=Object.assign({},e);a.type=a.controller.name,a.type==="localcontrol"&&(a.value=a.message.data[2]===127,a.rawValue=a.message.data[2]),a.type==="omnimodeon"?(a.type="omnimode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="omnimodeoff"&&(a.type="omnimode",a.value=!1,a.rawValue=a.message.data[2]),a.type==="monomodeon"?(a.type="monomode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="polymodeon"&&(a.type="monomode",a.value=!1,a.rawValue=a.message.data[2]),this.emit(a.type,a)}_parseEventForParameterNumber(e){const a=e.message.dataBytes[0],s=e.message.dataBytes[1];a===99||a===101?(this._nrpnBuffer=[],this._rpnBuffer=[],a===99?this._nrpnBuffer=[e.message]:s!==127&&(this._rpnBuffer=[e.message])):a===98||a===100?a===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&s!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(a===6||a===38||a===96||a===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,a,s,l){e=e==="nrpn"?"nrpn":"rpn";const o={target:l.target,timestamp:l.timestamp,message:l.message,parameterMsb:a,parameterLsb:s,value:Be.from7bitToFloat(l.message.dataBytes[1]),rawValue:l.message.dataBytes[1]};e==="rpn"?o.parameter=Object.keys(Me.REGISTERED_PARAMETERS).find(p=>Me.REGISTERED_PARAMETERS[p][0]===a&&Me.REGISTERED_PARAMETERS[p][1]===s):o.parameter=(a<<7)+s;const u=Me.CONTROL_CHANGE_MESSAGES[l.message.dataBytes[0]].name;o.type=`${e}-${u}`,this.emit(o.type,o);const h=Object.assign({},o);h.type==="nrpn-dataincrement"?h.type="nrpn-databuttonincrement":h.type==="nrpn-datadecrement"?h.type="nrpn-databuttondecrement":h.type==="rpn-dataincrement"?h.type="rpn-databuttonincrement":h.type==="rpn-datadecrement"&&(h.type="rpn-databuttondecrement"),this.emit(h.type,h),o.type=e,o.subtype=u,this.emit(o.type,o)}getChannelModeByNumber(e){return _e.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Be.getChannelModeByNumber(e)}getCcNameByNumber(e){if(_e.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Be.getCcNameByNumber(e)}getNoteState(e){e instanceof ul&&(e=e.identifier);const a=Be.guessNoteNumber(e,_e.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[a]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class Pm{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Be.getPropertyByValue(Me.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Be.getPropertyByValue(Me.SYSTEM_MESSAGES,this.command)),this.statusByte===Me.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class _1 extends br{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new D1(this,a);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let a={timestamp:_e.time,target:this,port:this};e.port.connection==="open"?(a.type="opened",this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const a=new Pm(e.data),s={port:this,target:this,message:a,timestamp:e.timeStamp,type:"midimessage",data:a.data,rawData:a.data,statusByte:a.data[0],dataBytes:a.dataBytes};this.emit("midimessage",s),a.isSystemMessage?this._parseEvent(s):a.isChannelMessage&&this.channels[a.channel]._processMidiMessageEvent(s),this._forwarders.forEach(l=>l.forward(a))}_parseEvent(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmidimessage",a.type==="songselect"&&(a.song=e.data[1]+1,a.value=e.data[1],a.rawValue=a.value),this.emit(a.type,a)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){_e.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=a!=null?[].concat(a):void 0;a=s,s={channels:l}}if(Me.CHANNEL_EVENTS.includes(e)){s.channels===void 0&&(s.channels=Me.MIDI_CHANNEL_NUMBERS);let l=[];return Be.sanitizeChannels(s.channels).forEach(o=>{l.push(this.channels[o].addListener(e,a,s))}),l}else return super.addListener(e,a,s)}addOneTimeListener(e,a,s={}){return s.remaining=1,this.addListener(e,a,s)}on(e,a,s,l){return this.addListener(e,a,s,l)}hasListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}return Me.CHANNEL_EVENTS.includes(e)?(s.channels===void 0&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),Be.sanitizeChannels(s.channels).every(l=>this.channels[l].hasListener(e,a))):super.hasListener(e,a)}removeListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}if(s.channels===void 0&&(s.channels=Me.MIDI_CHANNEL_NUMBERS),e==null)return Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l]&&this.channels[l].removeListener()}),super.removeListener();Me.CHANNEL_EVENTS.includes(e)?Be.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].removeListener(e,a,s)}):super.removeListener(e,a,s)}addForwarder(e,a={}){let s;return e instanceof j0?s=e:s=new j0(e,a),this._forwarders.push(s),s}removeForwarder(e){this._forwarders=this._forwarders.filter(a=>a!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return _e.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class O1 extends br{constructor(){super(),this.defaults={note:{attack:Be.from7bitToFloat(64),release:Be.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},a=!1){if(Be.isNode)try{window.navigator}catch{let h=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,h)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:a}),a&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const s={timestamp:this.time,target:this,type:"error",error:void 0},l={timestamp:this.time,target:this,type:"midiaccessgranted"},o={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}this.emit("midiaccessgranted",l),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}return this.emit("enabled",o),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(this._disconnectedInputs[s]._midiInput&&this._disconnectedInputs[s].id===e.toString())return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(this.inputs[s]._midiInput&&this.inputs[s].id===e.toString())return this.inputs[s]}getInputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(~this._disconnectedInputs[s].name.indexOf(e))return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(~this.inputs[s].name.indexOf(e))return this.inputs[s]}getOutputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(~this._disconnectedOutputs[s].name.indexOf(e))return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(~this.outputs[s].name.indexOf(e))return this.outputs[s]}getOutputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(this._disconnectedOutputs[s]._midiOutput&&this._disconnectedOutputs[s].id===e.toString())return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(this.outputs[s]._midiOutput&&this.outputs[s].id===e.toString())return this.outputs[s]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Be.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?Be.getNoteDetails(Be.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Be.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Be.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Be.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,a={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Be.buildNoteArray(e,a)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Be.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(a=>e.push(a.destroy())),this.outputs.forEach(a=>e.push(a.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let a={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?a.port=this.getOutputById(e.port.id):e.port.type==="input"&&(a.port=this.getInputById(e.port.id)),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?a.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(a.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let a=this._inputs.length-1;a>=0;a--){const s=this._inputs[a];Array.from(this.interface.inputs.values()).find(o=>o===s._midiInput)||(this._disconnectedInputs.push(s),this._inputs.splice(a,1))}let e=[];return this.interface.inputs.forEach(a=>{if(!this._inputs.find(s=>s._midiInput===a)){let s=this._disconnectedInputs.find(l=>l._midiInput===a);s||(s=new _1(a)),this._inputs.push(s),e.push(s.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let a=this._outputs.length-1;a>=0;a--){const s=this._outputs[a];Array.from(this.interface.outputs.values()).find(o=>o===s._midiOutput)||(this._disconnectedOutputs.push(s),this._outputs.splice(a,1))}let e=[];return this.interface.outputs.forEach(a=>{if(!this._outputs.find(s=>s._midiOutput===a)){let s=this._disconnectedOutputs.find(l=>l._midiOutput===a);s||(s=new Vf(a)),this._outputs.push(s),e.push(s.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Be.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Be.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Me.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Me.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Me.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Me.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Me.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const _e=new O1;_e.constructor=null;const I1=async()=>{if(_e.enabled)return _e;try{return await _e.enable({sysex:!0}),console.log("WebMidi is enabled with SysEx support!"),_e}catch(n){throw console.error("WebMidi could not be enabled.",n),n}},U0=()=>_e.enabled?_e.inputs.map(n=>({id:n.id,name:n.name})):[],L1=(n,e)=>{if(_e.enabled){const a=_e.getInputById(n);if(a){const s=u=>{e({type:"noteon",note:u.note.identifier,velocity:u.velocity,controller:null,channel:u.message.channel})},l=u=>{e({type:"noteoff",note:u.note.identifier,velocity:0,controller:null,channel:u.message.channel})},o=u=>{e({type:"controlchange",controller:u.controller.number,value:u.rawValue,note:null,channel:u.message.channel})};return a.addListener("noteon",s),a.addListener("noteoff",l),a.addListener("controlchange",o),()=>{a.removeListener("noteon",s),a.removeListener("noteoff",l),a.removeListener("controlchange",o)}}}return()=>{}},j1=n=>{if(_e.enabled){const e=a=>{n(a)};return _e.addListener("connected",e),_e.addListener("disconnected",e),()=>{_e.removeListener("connected",e),_e.removeListener("disconnected",e)}}return()=>{}},U1=(n,e)=>{if(_e.enabled){const a=_e.getInputById(n);if(a){const s=_e.outputs.find(l=>l.name===a.name);s?(s.sendSysex(71,e),console.log(`Sent SysEx to ${s.name}`)):console.warn("Could not find matching MIDI Output for SysEx")}}},B1=(n,e,a,s)=>{if(_e.enabled){const l=_e.getInputById(n);if(l){const o=_e.outputs.find(u=>u.name===l.name);o&&o.sendNoteOn(e,{attack:a/127,channels:s})}}},zm=T.createContext(null),jc=()=>T.useContext(zm),B0=n=>{if(!n||typeof n!="object")return{};const e=Object.keys(n);if(e.length===0)return{};const a=n[e[0]];if(Array.isArray(a))return n;console.log("MIDI: Migrating old mapping format to new multi-assignment structure...");const s={};return Object.entries(n).forEach(([l,o])=>{if(!o||!o.type||o.channel===void 0||o.address===void 0)return;const u=`${o.type}:${o.channel}:${o.address}`;s[u]||(s[u]=[]),s[u].push({controlId:l,requiresShift:!!o.requiresShift,targetType:"position",label:o.label||`${o.requiresShift?"":""}CH${o.channel}:${o.address}`})}),s},F1=({children:n,onMidiCommand:e})=>{const[a,s]=T.useState(!1),[l,o]=T.useState([]),[u,h]=T.useState(""),[p,g]=T.useState(!1),[v,A]=T.useState(null),[S,b]=T.useState({}),[M,D]=T.useState(null),[L,B]=T.useState(!1),Q=T.useRef(!1),_=T.useRef(e);T.useEffect(()=>{_.current=e},[e]),T.useEffect(()=>{(async()=>{try{if(await I1(),s(!0),o(U0()),j1(()=>{console.log("MIDI Device change detected, refreshing inputs..."),o(U0())}),window.electronAPI&&window.electronAPI.getMidiMappings){const se=await window.electronAPI.getMidiMappings();if(se){const ge=B0(se);console.log("Loaded and migrated MIDI mappings:",ge),b(ge)}}}catch(se){console.error("MIDI Init Failed:",se)}})()},[]),T.useEffect(()=>{(async()=>{if(!a||l.length===0)return;let se=u;if(!se&&window.electronAPI?.getSelectedMidiInput){const ge=await window.electronAPI.getSelectedMidiInput();ge&&l.some(Z=>Z.id===ge)&&(se=ge)}(!se||!l.some(ge=>ge.id===se))&&(se=l[0].id),se!==u&&(console.log(`MIDI: Auto-selecting input: ${se}`),h(se))})()},[a,l,u]);const U=async()=>{window.electronAPI&&window.electronAPI.saveMidiMappings&&(await window.electronAPI.saveMidiMappings(S),console.log("MIDI mappings saved to default."))},I=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(S,"midi")},P=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const ee=await window.electronAPI.importMappings("midi");if(ee.success&&ee.mappings){const se=B0(ee.mappings);b(se),console.log("MIDI mappings imported and migrated.")}}},Y=ee=>{const se=l.find(ge=>ge.id===ee);se&&se.name.toLowerCase().includes("apc40")&&(console.log("Detected APC40, sending initialization SysEx..."),U1(ee,[127,41,96,0,4,65,1,1,1]))};T.useEffect(()=>{u&&window.electronAPI&&window.electronAPI.saveSelectedMidiInput&&window.electronAPI.saveSelectedMidiInput(u),u&&a&&Y(u)},[u,a,l]);const te=T.useCallback((ee,se,ge="inactive",Z=null)=>{if(!a)return;const J=(Se,Ae,Le)=>{const Ye=Se.feedbackMode||"toggle",Ue=Se.feedbackConfig||{};return Ye==="clip"?Le==="active"?Ue.activeVelocity??127:Le==="previewing"?Ue.previewVelocity??64:Le==="inactive"?Ue.inactiveVelocity??1:Le==="empty"?Ue.emptyVelocity??0:0:Ye==="slider"?Math.round(Ae*127):Ye==="dropdown"?Ae?Ue.onVelocity??127:Ue.offVelocity??0:(typeof Ae=="boolean"?Ae:Ae>0)?Ue.onVelocity??127:Ue.offVelocity??0};Object.entries(S).forEach(([Se,Ae])=>{Array.isArray(Ae)&&Ae.forEach(Le=>{if(Le.controlId===ee){const[Ye,Ue,pt]=Se.split(":");if(Ye==="note"){const it=Z!==null?Z:parseInt(Ue),De=Le.outputDeviceId||u;if(De&&De!=="any"){const qe=J(Le,se,ge);B1(De,pt,qe,it)}}}})})},[u,a,S]);T.useEffect(()=>{let ee=()=>{};return u&&(console.log(`(Re)binding MIDI listener for: ${u}`),ee=L1(u,se=>{oe.current&&D(se),O(se)})),ee},[u,p,v,S,l]);const oe=T.useRef(p);T.useEffect(()=>{oe.current=p},[p]);const W=(ee,se,ge)=>`${ee==="noteon"||ee==="noteoff"?"note":"cc"}:${se}:${ge}`,O=ee=>{if(ee.channel===1&&ee.note==="D7"){const J=ee.type==="noteon";B(J),Q.current=J;return}if(p&&v){if(ee.type==="noteoff")return;const J=ee.note||ee.controller,Se=Q.current,Ae=W(ee.type,ee.channel,J),Le={controlId:v,requiresShift:Se,targetType:"position",inputDeviceId:u,outputDeviceId:u,label:`${Se?"":""}CH${ee.channel}:${J}`};b(Ye=>{const Ue=Ye[Ae]||[];return Ue.some(pt=>pt.controlId===v)?Ye:{...Ye,[Ae]:[...Ue,Le]}}),A(null);return}const ge=W(ee.type,ee.channel,ee.note||ee.controller),Z=S[ge];Z&&Z.length>0&&Z.forEach(J=>{const Ae=!ge.startsWith("note:")||!!J.requiresShift===Q.current,Le=!J.inputDeviceId||J.inputDeviceId==="any"||J.inputDeviceId===u;if(Ae&&Le&&_.current){let Ye;ee.type==="controlchange"?Ye=ee.value??0:ee.type==="noteoff"?Ye=0:Ye=ee.velocity??0,_.current(J.controlId,Ye,127,ee.type,J)}})},V={midiInitialized:a,midiInputs:l,selectedMidiInputId:u,setSelectedMidiInputId:h,isMapping:p,startMapping:()=>g(!0),stopMapping:()=>{g(!1),A(null)},learningId:v,setLearningId:A,mappings:S,setMappings:b,removeMapping:ee=>{b(se=>{const ge={...se};return Object.keys(ge).forEach(Z=>{ge[Z]=ge[Z].filter(J=>J.controlId!==ee),ge[Z].length===0&&delete ge[Z]}),ge})},removeAssignment:(ee,se)=>{b(ge=>{if(!ge[ee])return ge;const Z={...ge};return Z[ee]=Z[ee].filter(J=>J.controlId!==se),Z[ee].length===0&&delete Z[ee],Z})},saveMappings:U,exportMappings:I,importMappings:P,initializeApc40:Y,sendFeedback:te,lastMidiEvent:M,isShiftDown:L};return f.jsx(zm.Provider,{value:V,children:n})},Gm=T.createContext(null),id=()=>T.useContext(Gm),P1=({children:n,onArtnetCommand:e})=>{const[a,s]=T.useState(!1),[l,o]=T.useState(!1),[u,h]=T.useState(null),[p,g]=T.useState({}),[v,A]=T.useState(null),S=T.useRef(e);T.useEffect(()=>{S.current=e},[e]),T.useEffect(()=>{(async()=>{try{if(window.electronAPI&&window.electronAPI.initializeArtnet&&(await window.electronAPI.initializeArtnet()).success&&(s(!0),console.log("Art-Net initialized for mapping")),window.electronAPI&&window.electronAPI.getArtnetMappings){const P=await window.electronAPI.getArtnetMappings();P&&(console.log("Loaded saved Art-Net mappings:",P),g(P))}}catch(P){console.error("Art-Net Init Failed:",P)}})()},[]);const b=async()=>{window.electronAPI&&window.electronAPI.saveArtnetMappings&&(await window.electronAPI.saveArtnetMappings(p),console.log("Art-Net mappings saved."))},M=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(p,"artnet")},D=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const I=await window.electronAPI.importMappings("artnet");I.success&&I.mappings&&(g(I.mappings),console.log("Art-Net mappings imported."))}};T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onArtnetDataReceived)return window.electronAPI.onArtnetDataReceived(P=>{L.current&&A(P),B(P)})},[l,u,p]);const L=T.useRef(l);T.useEffect(()=>{L.current=l},[l]);const B=I=>{const{universe:P,channel:Y,value:te}=I;if(l&&u){if(te===0)return;const oe={universe:P,channel:Y,label:`U${P}:CH${Y+1}`};console.log(`Mapped ${u} to Art-Net:`,oe),g(W=>({...W,[u]:oe})),h(null);return}Object.entries(p).forEach(([oe,W])=>{W.universe===P&&W.channel===Y&&S.current&&S.current(oe,te)})},U={artnetInitialized:a,isMapping:l,startMapping:()=>o(!0),stopMapping:()=>{o(!1),h(null)},learningId:u,setLearningId:h,mappings:p,setMappings:g,saveMappings:b,exportMappings:M,importMappings:D,lastDmxEvent:v};return f.jsx(Gm.Provider,{value:U,children:n})},Hm=T.createContext(null),ld=()=>T.useContext(Hm),z1=({children:n,onCommand:e,enabled:a=!1})=>{const[s,l]=T.useState(!1),[o,u]=T.useState(null),[h,p]=T.useState({}),g=T.useRef(e);T.useEffect(()=>{g.current=e},[e]),T.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getKeyboardMappings){const D=await window.electronAPI.getKeyboardMappings();D&&p(D)}})()},[]);const v=async()=>{window.electronAPI&&window.electronAPI.saveKeyboardMappings&&await window.electronAPI.saveKeyboardMappings(h)},A=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(h,"keyboard")},S=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const M=await window.electronAPI.importMappings("keyboard");M.success&&M.mappings&&p(M.mappings)}};T.useEffect(()=>{const M=D=>{if(a&&!(D.target.tagName==="INPUT"||D.target.tagName==="TEXTAREA"||D.target.isContentEditable)){if(s&&o){D.preventDefault();const L={key:D.code,label:D.code.replace("Key","").replace("Digit","")};p(B=>({...B,[o]:L})),u(null);return}Object.entries(h).forEach(([L,B])=>{D.code===B.key&&(D.preventDefault(),g.current&&g.current(L,1,1,"keydown"))})}};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[a,s,o,h]);const b={isMapping:s,startMapping:()=>l(!0),stopMapping:()=>{l(!1),u(null)},learningId:o,setLearningId:u,mappings:h,setMappings:p,saveMappings:v,exportMappings:A,importMappings:S,removeMapping:M=>p(D=>{const L={...D};return delete L[M],L})};return f.jsx(Hm.Provider,{value:b,children:n})},Kt=({id:n,children:e,style:a})=>{const{isMapping:s,setLearningId:l,removeMapping:o,setMappings:u}=jc(),{isMapping:h,setLearningId:p,removeMapping:g}=id()||{},{isMapping:v,setLearningId:A,removeMapping:S}=ld()||{},b=s||h||v,M=(B,Q=null)=>{if(b){B.preventDefault(),B.stopPropagation();const _=Q!==null?`${n}_item_${Q}`:n;s&&l(_),h&&p(_),v&&A(_)}},D=B=>{b&&(B.preventDefault(),B.stopPropagation(),s&&o(n),h&&g(n),v&&S(n))},L=vn.Children.only(e);return L.type==="select"&&b?vn.cloneElement(L,{"data-mappable-id":n,onClickCapture:M,onContextMenu:D,className:`${L.props.className||""} mappable-target`.trim(),children:vn.Children.map(L.props.children,B=>{if(B.type==="option"){const Q=`${n}_item_${B.props.value||B.props.children}`;return f.jsxs("option",{...B.props,"data-mappable-id":Q,style:{...B.props.style,color:"var(--theme-color)"},children:[B.props.children," [Mappable]"]})}return B})}):vn.cloneElement(L,{"data-mappable-id":n,onClickCapture:b?M:L.props.onClickCapture,onContextMenu:b?D:L.props.onContextMenu,className:`${L.props.className||""} ${b?"mappable-target":""}`.trim(),style:{...L.props.style,...a}})},G1=({masterIntensity:n,onMasterIntensityChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_intensity",targetType:"global",label:"MASTER",min:0,max:1,step:.01}))};return f.jsx("div",{className:"master-intensity-slider",draggable:!0,onDragStart:a,children:f.jsx(Kt,{id:"master_intensity",children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n,className:"slider_hor",id:"masterIntensityRange",onChange:s=>e(parseFloat(s.target.value))})})})},H1=({masterIntensity:n,onMasterIntensityChange:e,onClearAllActive:a,isGlobalBlackout:s,onToggleGlobalBlackout:l})=>{const o=(u,h)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"global",label:h.toUpperCase()}))};return f.jsxs("div",{className:"composition-controls",children:[f.jsx("span",{className:"layer-control-button",children:"Comp"}),f.jsx(Kt,{id:"comp_clear",children:f.jsx("span",{className:"layer-control-button",onClick:a,style:{cursor:"pointer"},draggable:!0,onDragStart:u=>o(u,"clear"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsx(Kt,{id:"comp_blackout",style:{width:"100%",display:"flex"},children:f.jsx("span",{className:"layer-control-button",onClick:l,style:{cursor:"pointer",backgroundColor:s?"red":""},draggable:!0,onDragStart:u=>o(u,"blackout"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx(G1,{masterIntensity:n,onMasterIntensityChange:e})]})},Y1=({name:n,index:e,onTrigger:a,onShowColumnHeaderContextMenu:s})=>{const l=u=>{u.preventDefault(),s&&s(e)},o=u=>{u.button===0&&a&&a()};return f.jsx(Kt,{id:`column_${e}`,children:f.jsx("div",{className:"column-header trigger-button",onClick:o,onContextMenu:l,style:{cursor:"pointer"},children:n})})},dl=[{id:"rotate",name:"Rotate",type:"transform",description:"Rotates the shape around its center.",defaultParams:{angle:0,speed:0,direction:"CW"},paramControls:[{id:"angle",label:"Angle",type:"range",min:0,max:360,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["CW","CCW"]}]},{id:"scale",name:"Scale",type:"transform",description:"Scales the shape.",defaultParams:{scaleX:1,scaleY:1},paramControls:[{id:"scaleX",label:"Scale X",type:"range",min:.01,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"range",min:.01,max:5,step:.01}]},{id:"translate",name:"Translate",type:"transform",description:"Moves the shape.",defaultParams:{translateX:0,translateY:0},paramControls:[{id:"translateX",label:"Translate X",type:"range",min:-1,max:1,step:.01},{id:"translateY",label:"Translate Y",type:"range",min:-1,max:1,step:.01}]},{id:"color",name:"Color",type:"color",description:"Changes the color of the shape with solid, rainbow or custom palette modes.",defaultParams:{mode:"solid",color:"#ffffff",r:255,g:255,b:255,cycleSpeed:0,rainbowSpread:1,rainbowOffset:0,rainbowPalette:"rainbow",paletteColors:["#ff0000","#00ff00","#0000ff","#ffff00"],paletteSize:4,paletteSpread:1,hue:0,saturation:0,brightness:1,enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["solid","rainbow","palette"]},{id:"color",label:"Color",type:"color",showIf:{mode:"solid"}},{id:"hue",label:"Hue",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"saturation",label:"Saturation",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"brightness",label:"Brightness",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"paletteSize",label:"Palette Size",type:"range",min:2,max:16,step:1,showIf:{mode:"palette"}},{id:"paletteSpread",label:"Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"palette"}},{id:"cycleSpeed",label:"Cycle Speed",type:"range",min:0,max:10,step:.1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowSpread",label:"Rainbow Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"rainbow"}},{id:"rainbowOffset",label:"Offset",type:"range",min:0,max:360,step:1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowPalette",label:"Preset",type:"select",options:["rainbow","fire","ice","cyber"],showIf:{mode:"rainbow"}}]},{id:"wave",name:"Wave",type:"animation",description:"Applies a wave distortion to the shape.",defaultParams:{amplitude:.1,frequency:10,speed:1,direction:"x"},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:.01,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["x","y"]}]},{id:"warp",name:"Warp",type:"animation",description:"Symmetrical chaotic wave distortion.",defaultParams:{amount:.1,chaos:.5,speed:1},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1}]},{id:"distortion",name:"Distortion",type:"transform",description:"Distorts the point data.",defaultParams:{amount:.1,scale:10,speed:.5},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"scale",label:"Scale",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:5,step:.1}]},{id:"move",name:"Move (Bounce)",type:"transform",description:"Moves points and bounces them off the borders.",defaultParams:{speedX:.1,speedY:.1},paramControls:[{id:"speedX",label:"Speed X",type:"range",min:0,max:2,step:.01},{id:"speedY",label:"Speed Y",type:"range",min:0,max:2,step:.01}]},{id:"delay",name:"Delay",type:"effect",description:"Frame or Channel based delay effect.",defaultParams:{mode:"segment",playstyle:"repeat",useCustomOrder:!1,delayDirection:"left_to_right",delayAmount:5,decay:.8,steps:10,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat"]},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"delayDirection",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}},{id:"steps",label:"Steps",type:"range",min:2,max:20,step:1,showIf:{mode:["segment","frame"]}},{id:"delayAmount",label:"Delay Time",type:"range",min:1,max:60,step:1},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01}]},{id:"chase",name:"Chase",type:"effect",description:"Frame or Channel based chase effect.",defaultParams:{mode:"segment",playstyle:"repeat",steps:4,decay:.8,speed:1,overlap:1,direction:"left_to_right",useCustomOrder:!1,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat","bounce"]},{id:"steps",label:"Steps",type:"range",min:2,max:16,step:1,showIf:{mode:"segment"}},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:5,step:.1},{id:"overlap",label:"Overlap",type:"range",min:1,max:4,step:1},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"direction",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}}]},{id:"blanking",name:"Blanking",type:"animation",description:"Controls the blanking of the laser output.",defaultParams:{blankingInterval:0,spacing:0},paramControls:[{id:"blankingInterval",label:"Blanking Interval",type:"range",min:0,max:10,step:1},{id:"spacing",label:"Spacing",type:"range",min:0,max:20,step:1}]},{id:"strobe",name:"Strobe",type:"animation",description:"Applies a strobe effect to the laser output.",defaultParams:{strobeSpeed:100,strobeAmount:.5},paramControls:[{id:"strobeSpeed",label:"Strobe Speed (ms)",type:"range",min:10,max:1e3,step:10},{id:"strobeAmount",label:"Strobe Amount (0-1)",type:"range",min:0,max:1,step:.01}]},{id:"mirror",name:"Mirror",type:"transform",description:"Mirrors the shape from the center.",defaultParams:{mode:"none",additive:!0,axisOffset:0,planeRotation:0},paramControls:[{id:"mode",label:"Mirror Mode",type:"select",options:["none","x+","x-","y+","y-"]},{id:"additive",label:"Additive",type:"checkbox"},{id:"axisOffset",label:"Axis Offset",type:"range",min:-1,max:1,step:.01},{id:"planeRotation",label:"Plane Rotation",type:"range",min:0,max:360,step:1}]}],V1=dl.reduce((n,e)=>(n[e.id]=e,n),{});function F0(n,e,a,s){const l=e.style||"loop",o=e.direction||"forward";if(o==="pause")return a;let u=n;l==="bounce"&&(u*=2);let h=0;if(l==="once")h=Math.min(u,1),o==="backward"&&(h=1-h);else if(l==="bounce"){let p=u%1;Math.floor(u)%2===1?h=1-p:h=p,o==="backward"&&(h=1-h)}else h=u%1,o==="backward"&&(h=1-h);return s&&Array.isArray(s)&&s.length===2?s[0]+(s[1]-s[0])*h:a}function Nc(n,e,a,s,l,o){if(!a)return e;const u=typeof a=="string"?{syncMode:a}:a;if(!u.syncMode)return e;const{time:h,progress:p=0,bpm:g=120,clipDuration:v=0,fftLevels:A={low:0,mid:0,high:0},activationTime:S=0}=s;let b=u.range;(!b||!Array.isArray(b)||b.length!==2)&&l!==void 0&&o!==void 0&&(b=[l,o]);let M=0;const D=u.speedMultiplier||1;if((u.style||"loop")==="once"&&S>0){const B=(h-S)*.001;let Q=1;if(u.syncMode==="timeline")Q=Math.max(.01,u.duration||1);else if(u.syncMode==="bpm"){const _=Math.max(.1,u.beats||4),U=g/60;Q=_/(U||2)}else if(u.syncMode==="fps")return M=B*D,F0(M,u,e,b);M=B/Q*D}else if(u.syncMode==="fps")M=h*.001*D;else if(u.syncMode==="timeline"){const B=Math.max(.01,u.duration||1);v>0?M=p*v/B*D:M=0}else if(u.syncMode==="bpm"){const B=Math.max(.1,u.beats||4),Q=g/60,_=B/(Q||2);v>0?M=p*v/_*D:M=0}else if(u.syncMode==="fft"){const B=A[u.fftRange||"low"]||0;return b?b[0]+(b[1]-b[0])*B:e}return F0(M,u,e,b)}let qf=new Float32Array(1024*8);function q1(n){qf.length<n*8&&(qf=new Float32Array(n*8*2))}function uo(n,e,a={}){const{progress:s=0,time:l=performance.now(),effectStates:o,syncSettings:u={},fftLevels:h}=a;if(!e||e.length===0)return n;const p=n.points,g=n.isTypedArray||p instanceof Float32Array,v=g?p.length/8:p.length;q1(v);const A=qf.subarray(0,v*8);if(g)A.set(p);else for(let M=0;M<v;M++){const D=p[M],L=M*8;A[L]=D.x,A[L+1]=D.y,A[L+2]=D.z||0,A[L+3]=D.r,A[L+4]=D.g,A[L+5]=D.b,A[L+6]=D.blanking?1:0,A[L+7]=D.lastPoint?1:0}let S=A;for(const M of e){const D=M.params;if(D.enabled===!1||!V1[M.id])continue;const B=S.length/8;let Q=D;const _=M.instanceId?`${M.instanceId}.`:`${M.id}.`;let U=!1;for(const I in D)if(u[_+I]){U=!0;break}if(U){Q={...D};for(const I in Q){const P=_+I;u[P]&&(Q[I]=Nc(I,Q[I],u[P],a))}}switch(M.id){case"rotate":X1(S,B,Q,s,l);break;case"scale":$1(S,B,Q);break;case"translate":W1(S,B,Q);break;case"color":Q1(S,B,Q,l);break;case"wave":J1(S,B,Q,l);break;case"blanking":ev(S,B,Q);break;case"strobe":tv(S,B,Q,l);break;case"mirror":S=nv(S,B,Q);break;case"warp":av(S,B,Q,l);break;case"distortion":rv(S,B,Q,l);break;case"move":sv(S,B,Q,l);break;case"delay":o&&M.instanceId&&(S=iv(S,B,Q,o,M.instanceId,a));break;case"chase":S=lv(S,B,Q,l,a);break}}const b=new Float32Array(S);return S._channelDistributions&&(b._channelDistributions=S._channelDistributions),{...n,points:b,isTypedArray:!0}}function X1(n,e,a,s,l){const{angle:o,speed:u,direction:h}=a,p=h==="CCW"?-1:1,g=l*.001*u*p,v=o*Math.PI/180+g,A=Math.sin(v),S=Math.cos(v);for(let b=0;b<e;b++){const M=b*8,D=n[M],L=n[M+1];n[M]=D*S-L*A,n[M+1]=D*A+L*S}}function $1(n,e,a){const{scaleX:s,scaleY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]*=s,n[u+1]*=l}}function W1(n,e,a){const{translateX:s,translateY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]+=s,n[u+1]+=l}}function P0(n){if(!n)return{r:255,g:255,b:255};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function Z1(n,e,a){let s,l,o;const u=Math.floor(n*6),h=n*6-u,p=a*(1-e),g=a*(1-h*e),v=a*(1-(1-h)*e);switch(u%6){case 0:s=a,l=v,o=p;break;case 1:s=g,l=a,o=p;break;case 2:s=p,l=a,o=v;break;case 3:s=p,l=g,o=a;break;case 4:s=v,l=p,o=a;break;case 5:s=a,l=p,o=g;break}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function Q1(n,e,a,s){const{mode:l,r:o,g:u,b:h,color:p,hue:g,saturation:v,brightness:A,cycleSpeed:S,rainbowSpread:b,rainbowOffset:M,rainbowPalette:D,paletteColors:L=[],paletteSize:B=4,paletteSpread:Q=1}=a,_=s*.001*S;if(l==="palette"){const U=Math.min(L.length,B),I=L.slice(0,U).map(P0);I.length===0&&I.push({r:255,g:255,b:255});for(let P=0;P<e;P++){const Y=P*8,oe=(P/e*Q+_*.5+M/360)%1*I.length,W=Math.floor(oe)%I.length,O=(W+1)%I.length,$=oe-Math.floor(oe),z=I[W],K=I[O];n[Y+3]=Math.round(z.r+(K.r-z.r)*$),n[Y+4]=Math.round(z.g+(K.g-z.g)*$),n[Y+5]=Math.round(z.b+(K.b-z.b)*$)}}else if(l==="rainbow"){const U=D||"rainbow";for(let I=0;I<e;I++){const P=I*8,Y=(I/e*b+_*.5+M/360)%1;let te,oe,W;U==="rainbow"?[te,oe,W]=z0(Y,1,.5):[te,oe,W]=K1(U,Y),n[P+3]=te,n[P+4]=oe,n[P+5]=W}}else{let U=o,I=u,P=h;if(g!==void 0&&v!==void 0&&A!==void 0)[U,I,P]=Z1(g,v,A);else if(p){const Y=P0(p);U=Y.r,I=Y.g,P=Y.b}if(S>0){const Y=_*50%360,[te,oe,W]=z0(Y/360,1,.5);for(let O=0;O<e;O++){const $=O*8;n[$+3]=te,n[$+4]=oe,n[$+5]=W}}else for(let Y=0;Y<e;Y++){const te=Y*8;n[te+3]=U,n[te+4]=I,n[te+5]=P}}}function K1(n,e){const a={fire:[{r:255,g:0,b:0},{r:255,g:128,b:0},{r:255,g:255,b:0},{r:255,g:0,b:0}],ice:[{r:0,g:0,b:255},{r:0,g:255,b:255},{r:255,g:255,b:255},{r:0,g:0,b:255}],cyber:[{r:255,g:0,b:255},{r:0,g:255,b:255},{r:0,g:0,b:255},{r:255,g:0,b:255}]},s=a[n]||a.fire,l=e*(s.length-1),o=Math.floor(l),u=l-o,h=s[o],p=s[o+1]||s[o];return[Math.round(h.r+(p.r-h.r)*u),Math.round(h.g+(p.g-h.g)*u),Math.round(h.b+(p.b-h.b)*u)]}function z0(n,e,a){let s,l,o;{const u=(g,v,A)=>(A<0&&(A+=1),A>1&&(A-=1),A<.16666666666666666?g+(v-g)*6*A:A<.5?v:A<.6666666666666666?g+(v-g)*(.6666666666666666-A)*6:g),h=a+e-a*e,p=2*a-h;s=u(p,h,n+1/3),l=u(p,h,n),o=u(p,h,n-1/3)}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function J1(n,e,a,s){const{amplitude:l,frequency:o,speed:u,direction:h}=a,p=s*.001*u;for(let g=0;g<e;g++){const v=g*8;h==="x"?n[v+1]+=l*Math.sin(n[v]*o+p):h==="y"&&(n[v]+=l*Math.sin(n[v+1]*o+p))}}function ev(n,e,a){const{blankingInterval:s,spacing:l=0}=a;if(s<=0)return;const o=s+1+l;for(let u=0;u<e;u++)u%o>=s&&(n[u*8+6]=1)}function tv(n,e,a,s){const{strobeSpeed:l,strobeAmount:o}=a;if(s%l/l<o)for(let h=0;h<e;h++)n[h*8+6]=1}function nv(n,e,a){const{mode:s,additive:l=!0,axisOffset:o=0,planeRotation:u=0}=a;if(s==="none"||e===0)return n;const h=u*Math.PI/180,p=Math.cos(h),g=Math.sin(h),v={x:0,y:0},A=(D,L)=>{let B=D,Q=L;if(h!==0){const _=D*p+L*g,U=-D*g+L*p;B=_,Q=U}if(s==="x-"||s==="x+"?B=2*o-B:(s==="y-"||s==="y+")&&(Q=2*o-Q),h!==0){const _=B*p-Q*g,U=B*g+Q*p;B=_,Q=U}v.x=B,v.y=Q},S=(D,L)=>{if(l)return!0;let B=D,Q=L;return h!==0&&(B=D*p+L*g,Q=-D*g+L*p),s==="x+"?B>=o:s==="x-"?B<=o:s==="y+"?Q>=o:s==="y-"?Q<=o:!0};let b;const M=n._channelDistributions;if(M){b=new Float32Array((e*2+M.size*2+50)*8);const D=new Map;let L=0;for(const[Q,_]of M){const U=_.length/8,I=_.start,P=L;let Y=0,te=!0;for(let oe=0;oe<U;oe++){const W=I+oe*8,O=S(n[W],n[W+1]);O&&(!te&&Y>0&&(b.set(n.subarray(W,W+8),L),b[L+6]=1,b[L+3]=0,b[L+4]=0,b[L+5]=0,L+=8,Y++),b.set(n.subarray(W,W+8),L),L+=8,Y++),te=O}if(Y>0){const oe=L-8;b.set(b.subarray(oe,oe+8),L),b[L+6]=1,b[L+3]=0,b[L+4]=0,b[L+5]=0,L+=8;let W=!0,O=0;for(let $=U-1;$>=0;$--){const z=I+$*8,K=S(n[z],n[z+1]);if(K){!W&&O>0&&(b.set(n.subarray(z,z+8),L),A(b[L],b[L+1]),b[L]=v.x,b[L+1]=v.y,b[L+6]=1,b[L+3]=0,b[L+4]=0,b[L+5]=0,L+=8),b.set(n.subarray(z,z+8),L);const re=L;A(b[re],b[re+1]),b[re]=v.x,b[re+1]=v.y,$===U-1?(b[re+6]=1,b[re+3]=0,b[re+4]=0,b[re+5]=0):b[re+6]=n[z+8+6],L+=8,O++}W=K}D.set(Q,{start:P,length:L-P})}}const B=new Float32Array(L);return B.set(b.subarray(0,L)),B._channelDistributions=D,B}else{b=new Float32Array((e*2+50)*8);let D=0,L=0,B=!0;for(let Q=0;Q<e;Q++){const _=Q*8,U=S(n[_],n[_+1]);U&&(!B&&L>0&&(b.set(n.subarray(_,_+8),D),b[D+6]=1,b[D+3]=0,b[D+4]=0,b[D+5]=0,D+=8,L++),b.set(n.subarray(_,_+8),D),D+=8,L++),B=U}if(L>0){const Q=D-8;b.set(b.subarray(Q,Q+8),D),b[D+6]=1,b[D+3]=0,b[D+4]=0,b[D+5]=0,D+=8;let _=!0,U=0;for(let I=e-1;I>=0;I--){const P=I*8,Y=S(n[P],n[P+1]);if(Y){!_&&U>0&&(b.set(n.subarray(P,P+8),D),A(b[D],b[D+1]),b[D]=v.x,b[D+1]=v.y,b[D+6]=1,b[D+3]=0,b[D+4]=0,b[D+5]=0,D+=8),b.set(n.subarray(P,P+8),D);const te=D;A(b[te],b[te+1]),b[te]=v.x,b[te+1]=v.y,I===e-1?(b[te+6]=1,b[te+3]=0,b[te+4]=0,b[te+5]=0):b[te+6]=n[P+8+6],D+=8,U++}_=Y}}return b.slice(0,D)}}function av(n,e,a,s){const{amount:l,chaos:o,speed:u}=a,h=s*.001*u;for(let p=0;p<e;p++){const g=p*8,v=n[g],A=n[g+1],S=Math.abs(A);n[g]+=Math.sin(S*10*(1+o)+h)*l*Math.cos(h*o),n[g+1]+=Math.cos(Math.abs(v)*10*(1+o)+h)*l*Math.sin(h*o)}}function rv(n,e,a,s){const{amount:l,scale:o,speed:u}=a,h=s*.001*u;for(let p=0;p<e;p++){const g=p*8,v=Math.sin(n[g]*o+h)*Math.cos(n[g+1]*o-h),A=Math.cos(n[g]*o-h)*Math.sin(n[g+1]*o+h);n[g]+=v*l,n[g+1]+=A*l}}function sv(n,e,a,s){const{speedX:l,speedY:o}=a,u=s*.001,h=u*l,p=u*o,g=4;for(let v=0;v<e;v++){const A=v*8;let S=n[A]+h,b=n[A+1]+p,M=(S+1)%g;M<0&&(M+=g),M>2&&(M=4-M),S=M-1;let D=(b+1)%g;D<0&&(D+=g),D>2&&(D=4-D),b=D-1,n[A]=S,n[A+1]=b}}function iv(n,e,a,s,l,o){const{mode:u="segment",delayAmount:h,decay:p,delayDirection:g,useCustomOrder:v,customOrder:A,playstyle:S="repeat",steps:b=10}=a;s.has(l)||s.set(l,[]);const M=s.get(l);if(M.unshift(new Float32Array(n)),u==="segment"){const D=h*b+1;M.length>D&&(M.length=D);const L=new Float32Array(n.length);for(let B=0;B<e;B++){let Q=0;const _=B/e;g==="left_to_right"?Q=Math.floor(_*b):g==="right_to_left"?Q=Math.floor((1-_)*b):g==="center_to_out"?Q=Math.floor(Math.abs(_-.5)*2*b):g==="out_to_center"&&(Q=Math.floor((1-Math.abs(_-.5)*2)*b)),Q=Math.min(b-1,Math.max(0,Q));const U=Q*h,I=U<M.length?M[U]:null,P=Math.pow(p,Q),Y=B*8;if(I&&I.length>0){let te;if(I.length===n.length)te=Y;else{const W=I.length/8;let O=Math.floor(_*W);O>=W&&(O=W-1),te=O*8}L[Y]=I[te],L[Y+1]=I[te+1],L[Y+2]=I[te+2],L[Y+3]=I[te+3]*P,L[Y+4]=I[te+4]*P,L[Y+5]=I[te+5]*P;const oe=n[Y+6]>.5;if(L[Y+6]=oe?1:I[te+6],L[Y+6]>.5&&(L[Y+3]=0,L[Y+4]=0,L[Y+5]=0),L[Y+7]=I[te+7],B>0){const W=(B-1)/e;let O=0;if(g==="left_to_right"?O=Math.floor(W*b):g==="right_to_left"?O=Math.floor((1-W)*b):g==="center_to_out"?O=Math.floor(Math.abs(W-.5)*2*b):g==="out_to_center"&&(O=Math.floor((1-Math.abs(W-.5)*2)*b)),O=Math.min(b-1,Math.max(0,O)),O!==Q){L[Y+6]=1,L[Y+3]=0,L[Y+4]=0,L[Y+5]=0;const $=(B-1)*8;L[$+6]=1,L[$+3]=0,L[$+4]=0,L[$+5]=0}}}else L.set(n.subarray(Y,Y+8),Y),L[Y+3]=0,L[Y+4]=0,L[Y+5]=0,L[Y+6]=1}return n._channelDistributions&&(L._channelDistributions=n._channelDistributions),L}else if(u==="frame"){const D=b,L=h*D+1;M.length>L&&(M.length=L);const B=[];for(let I=0;I<D;I++){const P=I*h,Y=P<M.length?M[P]:null;B.push({points:Y,factor:Math.pow(p,I)})}let Q=0;for(let I=0;I<B.length;I++){const P=B[I].points||n;Q+=P.length/8,I<B.length-1&&(Q+=1)}const _=new Float32Array(Q*8);let U=0;for(let I=0;I<B.length;I++){const P=B[I],Y=P.points||n,te=P.factor,oe=Y.length/8;for(let W=0;W<oe;W++){const O=W*8,$=U+W*8;_[$]=Y[O],_[$+1]=Y[O+1],_[$+2]=Y[O+2],_[$+3]=Y[O+3]*te,_[$+4]=Y[O+4]*te,_[$+5]=Y[O+5]*te,_[$+6]=Y[O+6],_[$+7]=Y[O+7]}if(U+=oe*8,I<B.length-1){const W=(oe-1)*8,O=U;_[O]=Y[W],_[O+1]=Y[W+1],_[O+2]=Y[W+2],_[O+3]=0,_[O+4]=0,_[O+5]=0,_[O+6]=1,_[O+7]=0,U+=8}}return n._channelDistributions&&(_._channelDistributions=n._channelDistributions),_}else{const{assignedDacs:D}=o||{};let L=new Map,B=0;if(v||a.delayMode==="channel")(A&&A.length>0?A.map($=>$.originalIndex):D?D.map(($,z)=>z):[0]).forEach(($,z)=>{L.set($,z),B=Math.max(B,z)});else{const $=(D||[]).length||1;for(let z=0;z<$;z++){let K=z;g==="right_to_left"?K=$-1-z:g==="center_to_out"?K=Math.floor(Math.abs(z-($-1)/2)):g==="out_to_center"&&(K=Math.min(z,$-1-z)),L.set(z,K),B=Math.max(B,K)}}const _=B+1,U=h*_+1;M.length>U&&(M.length=U);const I=[];for(let O=0;O<_;O++){const $=O*h;I.push({points:$<M.length?M[$]:null,factor:Math.pow(p,O),index:O})}const P=I.reduce((O,$)=>O+($.points?$.points.length/8:n.length/8),0),Y=new Float32Array(P*8);let te=0;const oe=new Array(I.length);for(let O=0;O<I.length;O++){const $=I[O],z=$.points,K=z?z.length/8:n.length/8;oe[O]=te;for(let re=0;re<K;re++){const V=re*8,ee=te+re*8;z?(Y[ee]=z[V],Y[ee+1]=z[V+1],Y[ee+2]=z[V+2],Y[ee+3]=z[V+3]*$.factor,Y[ee+4]=z[V+4]*$.factor,Y[ee+5]=z[V+5]*$.factor,Y[ee+6]=z[V+6],Y[ee+7]=z[V+7]):Y[ee+6]=1}te+=K*8}const W=new Map;return L.forEach((O,$)=>{O<I.length&&W.set($,{start:oe[O],length:I[O].points?I[O].points.length:n.length})}),Y._channelDistributions=W,Y}}function lv(n,e,a,s,l={}){const{mode:o="segment",steps:u,decay:h,speed:p,overlap:g,direction:v,useCustomOrder:A,customOrder:S,playstyle:b="loop"}=a,{progress:M=0,clipDuration:D=1,syncSettings:L={}}=l,B=a.instanceId?`${a.instanceId}.`:"chase.",Q=!!L[B+"speed"],_=M!==void 0&&D>0||Q;if(o==="segment"){const U=u;let I=(_?M*U:s*.001)*p;if(b==="bounce"){const Y=U,te=I%(Y*2);I=te>Y?Y*2-te:te}else b==="once"?I=Math.min(I,U):I=I%U;const P=new Float32Array(n.length);for(let Y=0;Y<e;Y++){const te=Y/e;let oe=0;v==="left_to_right"?oe=Math.min(U-1,Math.floor(te*U)):v==="right_to_left"?oe=Math.min(U-1,Math.floor((1-te)*U)):v==="center_to_out"?oe=Math.min(U-1,Math.floor(Math.abs(te-.5)*2*U)):v==="out_to_center"&&(oe=Math.min(U-1,Math.floor((1-Math.abs(te-.5)*2)*U)));let W=Math.abs(I-oe);W>U/2&&(W=U-W);let O=W<g?1-W/g:0;h>0&&(O=Math.pow(O,1-h));const $=Y*8;if(P.set(n.subarray($,$+8),$),P[$+3]*=O,P[$+4]*=O,P[$+5]*=O,(O<.05||n[$+6]>.5)&&(P[$+6]=1,P[$+3]=0,P[$+4]=0,P[$+5]=0),Y>0){const z=(Y-1)/e;let K=0;if(v==="left_to_right"?K=Math.min(U-1,Math.floor(z*U)):v==="right_to_left"?K=Math.min(U-1,Math.floor((1-z)*U)):v==="center_to_out"?K=Math.min(U-1,Math.floor(Math.abs(z-.5)*2*U)):v==="out_to_center"&&(K=Math.min(U-1,Math.floor((1-Math.abs(z-.5)*2)*U))),K!==oe){P[$+6]=1,P[$+3]=0,P[$+4]=0,P[$+5]=0;const re=(Y-1)*8;P[re+6]=1,P[re+3]=0,P[re+4]=0,P[re+5]=0}}}return n._channelDistributions&&(P._channelDistributions=n._channelDistributions),P}else{const{assignedDacs:U}=l||{};let I=new Map,P=0;if(A)(S&&S.length>0?S.map(re=>re.originalIndex):U?U.map((re,V)=>V):[0]).forEach((re,V)=>{I.set(re,V),P++});else{P=(U?U.length:1)||1;for(let K=0;K<P;K++){let re=K;v==="right_to_left"?re=P-1-K:v==="center_to_out"?re=Math.floor(Math.abs(K-(P-1)/2)):v==="out_to_center"&&(re=Math.min(K,P-1-K)),I.set(K,re)}}const Y=P;let te=(_?M*Y:s*.001)*p;if(b==="bounce"){const K=Y,re=te%(K*2);te=re>K?K*2-re:re}else b==="once"?te=Math.min(te,Y):te=te%Y;const oe=e*P,W=new Float32Array(oe*8),O=new Map;let $=0;const z=Array.from(I.keys());z.length===0&&z.push(0);for(const K of z){const re=I.get(K)||0;let V=Math.abs(te-re);V>Y/2&&(V=Y-V);let ee=V<g?1-V/g:0;h>0&&(ee=Math.pow(ee,1-h));const se=$;for(let ge=0;ge<e;ge++){const Z=ge*8,J=$+ge*8;W.set(n.subarray(Z,Z+8),J),W[J+3]*=ee,W[J+4]*=ee,W[J+5]*=ee,ee<.05&&(W[J+6]=1)}O.set(K,{start:se,length:e*8}),$+=e*8}return W._channelDistributions=O,W}}function Xf(n,e,a=!1){if(!e||!n||!n.points)return n;const{safetyZones:s,outputArea:l,transformationEnabled:o,transformationMode:u,flipX:h,flipY:p}=e;let g=n.points;const v=n.isTypedArray||g instanceof Float32Array,A=v?g.length/8:g.length;let S=a?g:v?new Float32Array(g):g.map(b=>({...b}));for(let b=0;b<A;b++){let M,D,L,B,Q,_;if(v?(M=S[b*8],D=S[b*8+1],L=S[b*8+3],B=S[b*8+4],Q=S[b*8+5],_=S[b*8+6]):(M=S[b].x,D=S[b].y,L=S[b].r,B=S[b].g,Q=S[b].b,_=S[b].blanking?1:0),o&&l){let U=(M+1)/2,I=(1-D)/2;u==="crop"?(U<l.x||U>l.x+l.w||I<l.y||I>l.y+l.h)&&(L=0,B=0,Q=0,_=1):u==="scale"&&(U=l.x+U*l.w,I=l.y+I*l.h,M=U*2-1,D=1-I*2)}if(s&&s.length>0){let U=(M+1)/2,I=(1-D)/2;for(const P of s)if(U>=P.x&&U<=P.x+P.w&&I>=P.y&&I<=P.y+P.h){L=0,B=0,Q=0,_=1;break}}h&&(M=-M),p&&(D=-D),M=Math.max(-1,Math.min(1,M)),D=Math.max(-1,Math.min(1,D)),v?(S[b*8]=M,S[b*8+1]=D,S[b*8+3]=L,S[b*8+4]=B,S[b*8+5]=Q,S[b*8+6]=_):(S[b].x=M,S[b].y=D,S[b].r=L,S[b].g=B,S[b].b=Q,S[b].blanking=_>.5)}return{...n,points:S,isTypedArray:v}}const G0=.08,H0=4;function od(n){if(!n)return new Float32Array(0);const e=n instanceof Float32Array||n.isTypedArray,a=e?n.length/8:n.length;if(a>4e3){if(n instanceof Float32Array)return n;const p=new Float32Array(a*8);for(let g=0;g<a;g++){const v=n[g];p[g*8]=v.x,p[g*8+1]=v.y,p[g*8+2]=v.z||0,p[g*8+3]=v.r,p[g*8+4]=v.g,p[g*8+5]=v.b,p[g*8+6]=v.blanking?1:0,p[g*8+7]=v.lastPoint?1:0}return p}const s=[],l=(p,g,v,A,S,b,M)=>{const D=M?0:A,L=M?0:S,B=M?0:b;s.push(p,g,v,D,L,B,M?1:0,0)},o=p=>{if(e){const g=p*8;return{x:n[g],y:n[g+1],z:n[g+2],r:n[g+3],g:n[g+4],b:n[g+5],blanking:n[g+6]>.5}}else{const g=n[p];return{x:g.x||0,y:g.y||0,z:g.z||0,r:g.r||0,g:g.g||0,b:g.b||0,blanking:!!g.blanking}}};if(a===0)return new Float32Array(0);let u=o(0);for(let p=0;p<a;p++){const g=o(p);if(u.blanking!==g.blanking)if(g.blanking)for(let b=0;b<H0;b++)l(u.x,u.y,u.z,0,0,0,!0);else{l(g.x,g.y,g.z,0,0,0,!0);for(let b=0;b<H0;b++)l(g.x,g.y,g.z,0,0,0,!0)}const v=g.x-u.x,A=g.y-u.y,S=Math.sqrt(v*v+A*A);if(S>G0){const b=Math.floor(S/G0);for(let M=1;M<b;M++){const D=M/b;l(u.x+v*D,u.y+A*D,u.z+(g.z-u.z)*D,g.blanking?0:g.r,g.blanking?0:g.g,g.blanking?0:g.b,g.blanking)}}l(g.x,g.y,g.z,g.r,g.g,g.b,g.blanking),u=g}const h=new Float32Array(s);return n._channelDistributions&&(h._channelDistributions=n._channelDistributions),h}class ov{constructor(e,a){if(this.canvas=e,this.type=a,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.animationFrameId=null,this.frameIndexes=Array(10).fill(0),this.pointIndexes=Array(10).fill(0),this.showBeamEffect=!1,this.beamAlpha=.5,this.fadeAlpha=.13,this.beamRenderMode="both",this.positionBuffer=null,this.colorBuffer=null,this.alphaBuffer=null,this.alphaBufferData=new Float32Array(131072),this.lastPointDrawTime=0,!this.gl){console.error("WebGL not supported");return}this.setup()}setup(){const e=this.gl,a=`
      attribute vec2 aPosition;
      attribute vec3 aColor;
      attribute float aAlpha;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        gl_PointSize = 2.0;
        vColor = aColor;
        vAlpha = aAlpha;
      }
    `,s=`
      precision mediump float;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_FragColor = vec4(vColor, vAlpha);
      }
    `,l=this.createShader(e.VERTEX_SHADER,a),o=this.createShader(e.FRAGMENT_SHADER,s),u=this.createProgram(l,o);this.program=u,this.positionAttributeLocation=e.getAttribLocation(u,"aPosition"),this.colorAttributeLocation=e.getAttribLocation(u,"aColor"),this.alphaAttributeLocation=e.getAttribLocation(u,"aAlpha"),this.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer);const h=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(h),e.STATIC_DRAW),this.quadColorUniformLocation=e.getUniformLocation(u,"uColor"),this.quadAlphaUniformLocation=e.getUniformLocation(u,"uAlpha");const p=`
      attribute vec2 aPosition;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `,g=`
      precision mediump float;
      uniform vec4 uColor;
      void main() {
        gl_FragColor = uColor;
      }
    `,v=this.createShader(e.VERTEX_SHADER,p),A=this.createShader(e.FRAGMENT_SHADER,g);this.fadeProgram=this.createProgram(v,A),this.fadePositionAttributeLocation=e.getAttribLocation(this.fadeProgram,"aPosition"),this.fadeColorUniformLocation=e.getUniformLocation(this.fadeProgram,"uColor"),e.useProgram(u);const S=131072;this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,S*2*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,S*3*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.alphaBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.alphaBuffer),e.bufferData(e.ARRAY_BUFFER,S*1*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1)}reset(){this.frameIndexes.fill(0),this.pointIndexes.fill(0),this.clearCanvas()}createShader(e,a){const s=this.gl,l=s.createShader(e);if(s.shaderSource(l,a),s.compileShader(l),s.getShaderParameter(l,s.COMPILE_STATUS))return l;console.error(s.getShaderInfoLog(l)),s.deleteShader(l)}createProgram(e,a){const s=this.gl,l=s.createProgram();if(s.attachShader(l,e),s.attachShader(l,a),s.linkProgram(l),s.getProgramParameter(l,s.LINK_STATUS))return l;console.error(s.getProgramInfoLog(l)),s.deleteProgram(l)}render(e){e.showBeamEffect!==void 0&&this.setBeamEffect(e.showBeamEffect),e.beamAlpha!==void 0&&this.setBeamAlpha(e.beamAlpha),e.fadeAlpha!==void 0&&this.setFadeAlpha(e.fadeAlpha),e.beamRenderMode!==void 0&&(this.beamRenderMode=e.beamRenderMode),this.type==="world"?this.renderWorld(e.worldData,e.previewScanRate,e.layerIntensities,e.masterIntensity,e.dacSettings,e.previewTime,e.fftLevels,e.optimizationEnabled):this.renderSingle(e.ildaFrames,e.previewScanRate,e.intensity,e.effects,e.syncSettings,e.bpm,e.clipDuration,e.progress,e.previewTime,e.fftLevels,e.effectStates,e.optimizationEnabled)}renderSingle(e,a,s,l,o={},u=120,h=1,p=null,g=null,v={low:0,mid:0,high:0},A=null,S=!0){const b=this.gl;if(b.viewport(0,0,b.canvas.width,b.canvas.height),this.drawFadeQuad(),!e||e.length===0)return;const M=this.frameIndexes[0]%e.length,D=e[M],L=p!==null?p:M/e.length,B=g!==null?g:performance.now();this.draw(D,l,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,s,0,L,B,o,u,h,v,A,S),this.frameIndexes[0]++,this.frameIndexes[0]>=e.length&&(this.frameIndexes[0]=0)}renderWorld(e,a,s,l,o,u=null,h={low:0,mid:0,high:0},p=!0){const g=this.gl;g.viewport(0,0,g.canvas.width,g.canvas.height),this.drawFadeQuad();const v=u!==null?u:performance.now();e.forEach(A=>{if(A&&A.frames&&A.frames.length>0){const S=A.frames[0];if(S){const b=A.layerIndex||0;if(A.syncSettings,A.bpm,b>=this.frameIndexes.length){const L=b+5;for(;this.frameIndexes.length<L;)this.frameIndexes.push(0),this.pointIndexes.push(0)}const D=(s[b]!==void 0?s[b]:1)*l;if(D>.001){const L=A.progress!==void 0?A.progress:this.frameIndexes[b]%A.frames.length/A.frames.length,{syncSettings:B={},bpm:Q=120,clipDuration:_=1,effectStates:U=null}=A;let I=S;if(o){let P=S;if(o.dimmer!==void 0&&o.dimmer<1){const Y=S.points,te=S.isTypedArray||Y instanceof Float32Array,oe=te?Y.length/8:Y.length,W=te?new Float32Array(Y):Y.map(O=>({...O}));for(let O=0;O<oe;O++)te?(W[O*8+3]*=o.dimmer,W[O*8+4]*=o.dimmer,W[O*8+5]*=o.dimmer):(W[O].r*=o.dimmer,W[O].g*=o.dimmer,W[O].b*=o.dimmer);P={...S,points:W,isTypedArray:te}}I=Xf(P,o)}this.draw(I,A.effects,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,D,b,L,v,B,Q,_,h,U,p)}}}}),e.forEach(A=>{if(A&&A.frames){const S=A.layerIndex||0;this.frameIndexes[S]++,this.frameIndexes[S]>=A.frames.length&&(this.frameIndexes[S]=0)}})}drawFadeQuad(){const e=this.gl;this.fadeProgram&&(e.useProgram(this.fadeProgram),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer),e.enableVertexAttribArray(this.fadePositionAttributeLocation),e.vertexAttribPointer(this.fadePositionAttributeLocation,2,e.FLOAT,!1,0,0),e.uniform4f(this.fadeColorUniformLocation,0,0,0,this.fadeAlpha),e.drawArrays(e.TRIANGLES,0,6))}setBeamEffect(e){this.showBeamEffect=e}setBeamAlpha(e){this.beamAlpha=e}setFadeAlpha(e){this.fadeAlpha=e}draw(e,a,s,l,o,u,h=1,p=0,g=0,v=performance.now(),A={},S=120,b=1,M={low:0,mid:0,high:0},D=null,L=!0){if(this.gl,!e||!e.points)return;let B=e;if(L){const $=od(e.points);B={...e,points:$,isTypedArray:!0}}const Q=uo(B,a,{progress:g,time:v,syncSettings:A,bpm:S,clipDuration:b,fftLevels:M,effectStates:D}),_=Q.points,U=Q.isTypedArray,I=U?_.length/8:_.length;if(I===0)return;const P=Math.max(1,Math.floor(I/o));let Y=this.pointIndexes[p]||0;Y>=I&&(Y=0);const te=$=>{const z=(Y+$)%I;if(U){const K=z*8;return{x:_[K],y:_[K+1],r:_[K+3],g:_[K+4],b:_[K+5],blanking:_[K+6]===1}}else{const K=_[z];return{x:K.x,y:K.y,r:K.r,g:K.g,b:K.b,blanking:K.blanking}}},oe=()=>{const $=u==="points"||u==="both";if(u==="lines"||u==="both"){let K=[],re=[],V=te(0);for(let ee=1;ee<P;ee++){const se=te(ee),ge=(Y+ee)%I,Z=(Y+ee-1)%I,J=ge<Z;se.blanking||J?K.length>0&&(this._drawSegment(new Float32Array(K),new Float32Array(re),1,K.length/2,!1),K=[],re=[]):(K.length===0&&(K.push(V.x,V.y),re.push(se.r/255*h,se.g/255*h,se.b/255*h)),K.push(se.x,se.y),re.push(se.r/255*h,se.g/255*h,se.b/255*h)),V=se}K.length>0&&this._drawSegment(new Float32Array(K),new Float32Array(re),1,K.length/2,!1)}if($){const K=[],re=[];for(let V=0;V<P;V++){const ee=te(V);ee.blanking||(K.push(ee.x,ee.y),re.push(ee.r/255*h,ee.g/255*h,ee.b/255*h))}K.length>0&&this._drawSegment(new Float32Array(K),new Float32Array(re),1,K.length/2,!0)}},W=()=>{const $=[],z=[];for(let K=0;K<P;K++){const re=te(K);if(!re.blanking){$.push(0,0,re.x,re.y);const V=[re.r/255*h,re.g/255*h,re.b/255*h];z.push(...V,...V)}}$.length>0&&this._drawLines(new Float32Array($),new Float32Array(z),l,$.length/2)},O=()=>{const $=[],z=[];let K=te(0);for(let re=1;re<P;re++){const V=te(re);if((Y+re)%I<(Y+re-1)%I){K=V;continue}if(!V.blanking){$.push(0,0,K.x,K.y,V.x,V.y);const se=[V.r/255*h,V.g/255*h,V.b/255*h],ge=[V.r/255*h,V.g/255*h,V.b/255*h],Z=[se[0],se[1],se[2]],J=.3,Se=[se[0]*J,se[1]*J,se[2]*J],Ae=[ge[0]*J,ge[1]*J,ge[2]*J];z.push(...Z,...Se,...Ae)}K=V}$.length>0&&this._drawTriangles(new Float32Array($),new Float32Array(z),l,$.length/2)};oe(),s&&(u==="points"?W():u==="lines"?O():u==="both"&&(O(),W())),this.pointIndexes[p]=(Y+P)%I}_drawSegment(e,a,s,l,o=!1){const u=this.gl;u.useProgram(this.program),u.bindBuffer(u.ARRAY_BUFFER,this.positionBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,e),u.enableVertexAttribArray(this.positionAttributeLocation),u.vertexAttribPointer(this.positionAttributeLocation,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,this.colorBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,a),u.enableVertexAttribArray(this.colorAttributeLocation),u.vertexAttribPointer(this.colorAttributeLocation,3,u.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const h=this.alphaBufferData.subarray(0,l);u.bindBuffer(u.ARRAY_BUFFER,this.alphaBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,h),u.enableVertexAttribArray(this.alphaAttributeLocation),u.vertexAttribPointer(this.alphaAttributeLocation,1,u.FLOAT,!1,0,0),u.drawArrays(o?u.POINTS:u.LINE_STRIP,0,l)}_drawLines(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.LINES,0,l)}_drawTriangles(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,l)}clearCanvas(){const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}destroy(){if(cancelAnimationFrame(this.animationFrameId),this.gl){const e=this.gl.getExtension("WEBGL_losing_context");e&&e.loseContext()}}}const Ym=({frame:n,effects:e,width:a=100,height:s=100})=>{const l=T.useRef(null),o=T.useRef(null),[u,h]=T.useState(null);return T.useEffect(()=>(l.current&&!o.current&&(o.current=new ov(l.current,"single")),()=>{o.current&&(o.current.destroy(),o.current=null)}),[]),T.useEffect(()=>{if(!n){h(null);return}let p=n;if(e&&e.length>0){const g=n.points,v=n.isTypedArray||g instanceof Float32Array;let A;v?A=new Float32Array(g):A=g.map(b=>({...b}));const S={...n,points:A,isTypedArray:v};p=uo(S,e,{time:performance.now(),progress:0,effectStates:new Map})}h(p)},[n,e]),T.useEffect(()=>{o.current&&u?o.current.render({ildaFrames:[u],previewScanRate:1,intensity:1,effects:[],syncSettings:{}}):o.current&&o.current.clearCanvas()},[u]),f.jsx("div",{className:"clip-thumbnail",style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"black"},children:f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"100%",height:"100%",backgroundColor:"black"}})})},cv=({frame:n,bitmap:e,width:a=50,height:s=50})=>{const l=T.useRef(null);return T.useEffect(()=>{const o=l.current;if(!o)return;const u=o.getContext("2d");if(e){u.clearRect(0,0,a,s),u.drawImage(e,0,0,a,s);return}if(!n||!n.points)return;u.fillStyle="#000000",u.fillRect(0,0,a,s);const h=n.points,p=n.isTypedArray||h instanceof Float32Array,g=p?h.length/8:h.length;u.lineWidth=1.5,u.lineCap="round";let v=null,A=null;for(let S=0;S<g;S++){let b,M,D,L,B,Q;if(p)b=h[S*8],M=h[S*8+1],D=h[S*8+3],L=h[S*8+4],B=h[S*8+5],Q=h[S*8+6]>.5;else{const I=h[S];b=I.x,M=I.y,D=I.r,L=I.g,B=I.b,Q=I.blanking}const _=(b+1)*.5*a,U=(1-(M+1)*.5)*s;if(Q){v=null,A=null;continue}else if(v!==null){u.beginPath(),u.moveTo(v,A),u.lineTo(_,U);const I=Math.floor(Math.max(0,Math.min(255,D))),P=Math.floor(Math.max(0,Math.min(255,L))),Y=Math.floor(Math.max(0,Math.min(255,B)));u.strokeStyle=`rgb(${I},${P},${Y})`,u.stroke()}v=_,A=U}},[n,a,s]),f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"50px",height:"50px",backgroundColor:"black",display:"block",borderRadius:"5px"}})},cd=vn.memo(cv),uv=({layerName:n,index:e,onDropEffect:a,onDropDac:s,layerEffects:l,activeClipData:o,onDeactivateLayerClips:u,onShowLayerFullContextMenu:h,thumbnailRenderMode:p,intensity:g,onIntensityChange:v,liveFrame:A,isBlackout:S,isSolo:b,onToggleBlackout:M,onToggleSolo:D,onLayerSelect:L})=>{const[B,Q]=T.useState(l||[]),[_,U]=T.useState(!1),[I,P]=T.useState(!1);T.useEffect(()=>{Q(l||[])},[l]);const Y=T.useMemo(()=>[...o?.effects||[],...l||[]],[o?.effects,l]),te=(K,re,V,ee,se)=>{K.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:re,paramName:V,targetType:ee,layerIndex:e,label:se}))},oe=K=>{K.preventDefault(),console.log(`Right-clicked LayerControls at index: ${e}`),h&&h(e)},W=K=>{K.preventDefault(),K.stopPropagation(),U(!0),K.dataTransfer.dropEffect="copy"},O=K=>{K.preventDefault(),K.stopPropagation(),U(!1)},$=K=>{K.preventDefault(),K.stopPropagation(),U(!1);const re=K.dataTransfer.getData("application/json");if(re)try{const ee=JSON.parse(re);if(ee.type==="transform"||ee.type==="animation"||ee.type==="color"||ee.type==="effect"){if(a){a(ee.id||ee.name);return}}else if((ee.isGroup||ee.ip&&(typeof ee.channel=="number"||ee.allChannels))&&s){s(e,ee);return}}catch(ee){console.error("Error parsing drop data in LayerControls:",ee)}const V=K.dataTransfer.getData("text/plain");if(V.startsWith("effect_")){const ee=V.replace("effect_","");a&&a(ee)}},z=p==="active"||p==="hover"&&I;return f.jsxs("div",{className:`layer-controls ${_?"dragging":""}`,onContextMenu:oe,onDragOver:W,onDragLeave:O,onDrop:$,children:[f.jsxs("div",{className:"grid-layer",children:[f.jsx(Kt,{id:`layer_${e}_clear`,children:f.jsx("span",{className:"layer-control-button full-height",onClick:()=>u(e),draggable:!0,onDragStart:K=>te(K,"toggle","clear","layer",`L${e+1} Clear`),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsxs("div",{className:"layer-control-group",children:[f.jsx(Kt,{id:`layer_${e}_blackout`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:M,style:{backgroundColor:S?"red":""},draggable:!0,onDragStart:K=>te(K,"toggle","blackout","layer",`L${e+1} Blackout`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx(Kt,{id:`layer_${e}_solo`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:D,style:{backgroundColor:b?"var(--theme-color)":"",color:b?"black":""},draggable:!0,onDragStart:K=>te(K,"toggle","solo","layer",`L${e+1} Solo`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-1-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M9.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z"}),f.jsx("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"})]})})})]}),f.jsxs("select",{className:"layer-blend-dropdown",children:[f.jsx("option",{children:"Normal"}),f.jsx("option",{children:"Add"}),f.jsx("option",{children:"Subtract"})]})]}),f.jsx("div",{className:"layer-control-row",children:f.jsx(Kt,{id:`layer_${e}_intensity`,children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,className:"slider_ver",id:"layer-intensity-slider",onChange:K=>v(parseFloat(K.target.value))})})}),f.jsx("div",{className:"layer-preview-thumbnail",onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),style:{overflow:"hidden"},children:o?z?f.jsx(Ym,{frame:A||o.stillFrame,effects:Y}):o.thumbnailPath?f.jsx("img",{src:`file://${o.thumbnailPath}?t=${o.thumbnailVersion||Date.now()}`,alt:"layer-thumbnail",style:{width:"100%",height:"100%",objectFit:"contain"}}):f.jsx(cd,{frame:o.stillFrame}):B.length>0&&f.jsx("div",{className:"applied-effects",children:B.map((K,re)=>f.jsx("span",{className:"effect-tag",children:(K.name||K.id||"???").substring(0,3).toUpperCase()},K.instanceId||re))})}),f.jsx("span",{className:"layer-name-label",onClick:()=>L&&L(e),children:n})]})},fv=({clipName:n,layerIndex:e,colIndex:a,onDropGenerator:s,onDropEffect:l,clipContent:o,thumbnailFrameIndex:u,onUnsupportedFile:h,onActivateClick:p,onLabelClick:g,isSelected:v,isActive:A,ildaParserWorker:S,onDropDac:b,thumbnailRenderMode:M,liveFrame:D,stillFrame:L,onClipHover:B,onThumbnailError:Q})=>{const[_,U]=T.useState(!1),[I,P]=T.useState(!1),Y=n,te=M==="active"||M==="hover"&&_,oe=se=>{se.preventDefault(),se.stopPropagation(),P(!0),se.dataTransfer.dropEffect="copy"},W=se=>{se.preventDefault(),se.stopPropagation(),se.currentTarget.contains(se.relatedTarget)||P(!1)},O=()=>{U(!0),B&&B(e,a,!0)},$=()=>{U(!1),p(!1),B&&B(e,a,!1)},z=async se=>{const ge=se.name;if(!S){h("ILDA parser not available.");return}if(ge.toLowerCase().endsWith(".ild"))try{const Z=await se.arrayBuffer();console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFileDrop): ${Z.byteLength}`),S.postMessage({type:"parse-ilda",arrayBuffer:Z,fileName:ge,filePath:se.path,layerIndex:e,colIndex:a},[Z])}catch(Z){console.error("[Clip.jsx] handleFileDrop - Error reading file:",Z),h(`Error reading file: ${Z.message}`)}else h("Please drop a valid .ild file")},K=async(se,ge)=>{if(!ge.toLowerCase().endsWith(".ild")){console.log("Unsupported file type:",ge),h("Please drop a valid .ild file");return}if(!S){h("ILDA parser not available.");return}try{if(window.electronAPI&&window.electronAPI.readFileAsBinary){const Z=await window.electronAPI.readFileAsBinary(se);if(!Z||!(Z instanceof ArrayBuffer)){console.error("[Clip.jsx] readFileAsBinary did not return an ArrayBuffer:",Z),h("Error reading file: Invalid data format received.");return}console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFilePathDrop): ${Z.byteLength}`),S.postMessage({type:"parse-ilda",arrayBuffer:Z,fileName:ge,filePath:se,layerIndex:e,colIndex:a},[Z])}else h("Binary file access not available")}catch(Z){console.error("Error processing file path:",Z),console.error("Error stack:",Z.stack),h(`Error processing file: ${Z.message}`)}},re=se=>{se.preventDefault(),se.stopPropagation(),P(!1);const ge=se.dataTransfer.getData("application/json");if(ge)try{const J=JSON.parse(ge);if(J.filePath&&J.fileName){K(J.filePath,J.fileName);return}if(J.type==="transform"||J.type==="animation"||J.type==="color"||J.type==="effect"){if(l){l(J),g();return}}else if(J.isGroup||J.ip&&(typeof J.channel=="number"||J.allChannels)){if(b){b(e,a,J);return}}else if(J.name&&s){s(e,a,J);return}}catch(J){console.error("Error parsing dropped data:",J)}const Z=se.dataTransfer.files;if(Z&&Z.length>0){z(Z[0]);return}console.log("No recognized data format found in drop"),h("No valid ILD file, effect, or generator dropped.")},V=se=>{se.preventDefault(),se.stopPropagation()},ee=se=>{se.preventDefault(),window.electronAPI&&window.electronAPI.showClipContextMenu&&window.electronAPI.showClipContextMenu(e,a,o?.triggerStyle||"normal")};return f.jsxs("div",{className:`clip ${I?"dragging":""} ${A?"active-clip":""} `,onDragEnter:V,onDragOver:oe,onDragLeave:W,onDrop:re,onContextMenu:ee,children:[f.jsx(Kt,{id:`clip_${e}_${a}`,children:f.jsx("div",{className:"clip-thumbnail",onMouseDown:se=>{se.button===0&&p(!0)},onMouseUp:se=>{se.button===0&&p(!1)},onMouseEnter:O,onMouseLeave:$,style:{overflow:"hidden"},children:o&&o.parsing?f.jsx("div",{className:"clip-loading-spinner"}):f.jsxs(f.Fragment,{children:[te&&o?f.jsx(Ym,{frame:D||L,effects:o?.effects}):o?.thumbnailPath?f.jsx("img",{src:`file://${o.thumbnailPath}?t=${o.thumbnailVersion||Date.now()}`,alt:"thumbnail",onError:()=>Q&&Q(e,a),style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"}}):L&&f.jsx(cd,{frame:L}),o?.triggerStyle&&o.triggerStyle!=="normal"&&f.jsxs("p",{className:"clip_icons",children:[o.triggerStyle==="toggle"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-toggles",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7"})}),o.triggerStyle==="flash"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-lightning-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"})})]})]})})}),f.jsx(Kt,{id:`clip_${e}_${a}_preview`,children:f.jsx("span",{className:`clip-label ${v?"selected-clip":""}`,onClick:g,children:Y})})]})},dv=vn.memo(fv),Vm=T.createContext(null),qm=()=>T.useContext(Vm),pv=({children:n})=>{const[e,a]=T.useState(null);return T.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(Vm.Provider,{value:e,children:n})},hv=({onDropIld:n,viewMode:e="list",onViewModeChange:a,path:s,onPathChange:l})=>{const[o,u]=T.useState([]),[h,p]=T.useState({}),[g,v]=T.useState(new Set),A=qm(),S=T.useRef(new Set),b=T.useRef([]),M=T.useRef(!1),D=s,L=l,B=T.useCallback(()=>{if(M.current||b.current.length===0||!A)return;M.current=!0;const _=b.current.shift(),U=_.split(/[/\\]/).pop();A.postMessage({type:"load-and-parse-ilda",fileName:U,filePath:_,browserFile:!0,stopAtFirstFrame:!0})},[A]);T.useEffect(()=>{if(!A)return;const _=U=>{U.data.browserFile&&(U.data.type==="parse-ilda"?U.data.success?A.postMessage({type:"get-frame",workerId:U.data.workerId,frameIndex:0,browserFile:!0,filePath:U.data.filePath}):(console.warn(`[FileBrowser] Skipping invalid ILDA file: ${U.data.filePath}. Reason: ${U.data.error}`),v(I=>new Set(I).add(U.data.filePath)),M.current=!1,B()):U.data.type==="get-frame"&&(U.data.success&&p(I=>({...I,[U.data.filePath]:U.data.bitmap||U.data.frame})),M.current=!1,B()))};return A.addEventListener("message",_),()=>A.removeEventListener("message",_)},[A,B]),T.useEffect(()=>{if(e==="thumbnails"&&o.length>0&&A){let _=!1;o.forEach(U=>{!h[U]&&!S.current.has(U)&&(S.current.add(U),b.current.push(U),_=!0)}),_&&!M.current&&B()}},[e,o,A,h,B]),T.useEffect(()=>{(async()=>{if(s){const U=await window.electronAPI.readIldFiles(s);u(U),S.current.clear(),b.current=[],M.current=!1,p({});return}if(window.electronAPI&&window.electronAPI.getUserIldaPath){const U=await window.electronAPI.getUserIldaPath();if(U){L(U);const I=await window.electronAPI.readIldFiles(U);u(I),S.current.clear(),b.current=[],M.current=!1,p({})}}})()},[s]);const Q=async()=>{if(window.electronAPI){const _=await window.electronAPI.openFileExplorer();if(_){L(_);const U=await window.electronAPI.readIldFiles(_);u(U),S.current.clear(),b.current=[],M.current=!1,p({})}}};return f.jsxs("div",{className:"file-browser",children:[f.jsx("button",{onClick:Q,children:"Open Folder"}),f.jsxs("div",{className:"list_switcher",children:[f.jsx("button",{className:e==="list"?"active":"",onClick:()=>a&&a("list"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-list",viewBox:"0 0 16 16",children:f.jsx("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"})})}),f.jsx("button",{className:e==="thumbnails"?"active":"",onClick:()=>a&&a("thumbnails"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),f.jsx("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})]})})]}),D&&f.jsxs("p",{className:"fileBrowser",children:["Selected Directory: ",D.split(/[/\\]/).filter(Boolean).pop()]}),f.jsx("div",{className:"ild-file-grid",style:{display:e==="thumbnails"?null:"none"},children:o.filter(_=>!g.has(_)).length>0?o.filter(_=>!g.has(_)).map((_,U)=>{const I=_.split(/[/\\]/).pop(),P=h[_];return f.jsxs("div",{className:"ild-file-preview",draggable:!0,onDragStart:Y=>Y.dataTransfer.setData("application/json",JSON.stringify({filePath:_,fileName:I})),children:[f.jsx("div",{className:"file_thumbnail",children:P?f.jsx(cd,{bitmap:P instanceof ImageBitmap?P:null,frame:P instanceof ImageBitmap?null:P}):f.jsx("div",{className:"clip-loading-spinner"})}),f.jsx("div",{className:"file_name",children:I})]},U)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})}),f.jsx("div",{className:"ild-file-list",style:{display:e==="list"?null:"none"},children:o.filter(_=>!g.has(_)).length>0?o.filter(_=>!g.has(_)).map((_,U)=>{const I=_.split(/[/\\]/).pop();return f.jsx("div",{className:"ild-file-item",draggable:!0,onDragStart:P=>P.dataTransfer.setData("application/json",JSON.stringify({filePath:_,fileName:I})),children:I},U)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})})]})},$f=[{id:"circle",name:"Circle",description:"Generates a simple circle.",defaultParams:{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"radius",label:"Radius",type:"range",min:.01,max:1,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:3,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"square",name:"Square",description:"Generates a simple square.",defaultParams:{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"width",label:"Width",type:"range",min:.01,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"triangle",name:"Triangle",description:"Generates a simple symmetrical triangle.",defaultParams:{size:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"size",label:"Size",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"line",name:"Line",description:"Generates a straight line.",defaultParams:{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"x1",label:"X1",type:"range",min:-1,max:1,step:.01},{id:"y1",label:"Y1",type:"range",min:-1,max:1,step:.01},{id:"x2",label:"X2",type:"range",min:-1,max:1,step:.01},{id:"y2",label:"Y2",type:"range",min:-1,max:1,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:2,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"text",name:"Text",description:"Generates text.",defaultParams:{text:"TrueLazer",x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"text",label:"Text Content",type:"text"},{id:"fontUrl",label:"Fonts",type:"text"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:300,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"star",name:"Star",description:"Generates a star shape.",defaultParams:{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"outerRadius",label:"Outer Radius",type:"range",min:.01,max:1,step:.01},{id:"innerRadius",label:"Inner Radius",type:"range",min:.01,max:1,step:.01},{id:"numSpikes",label:"Number of Spikes",type:"range",min:3,max:20,step:1},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:20,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"ndi-source",name:"NDI Source",description:"Placeholder for NDI Video Input.",defaultParams:{sourceName:"No Source",threshold:128,edgeDetection:!1,captureWidth:480,captureHeight:480,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Source Name",type:"text"},{id:"captureWidth",label:"Width",type:"range",min:128,max:1280,step:1},{id:"captureHeight",label:"Height",type:"range",min:128,max:1280,step:1},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"spout-receiver",name:"Spout Receiver",description:"Placeholder for Spout Video Input.",defaultParams:{sourceName:"Spout Input",threshold:128,edgeDetection:!1,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Sender Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"sinewave",name:"Sine Wave",description:"Generates a customizable sine wave.",defaultParams:{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:0,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:.1,max:10,step:.1},{id:"phase",label:"Phase",type:"range",min:0,max:Math.PI*2,step:.01},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:10,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"waveform",name:"Waveform",description:"Generates a real-time audio visualization.",defaultParams:{mode:"bars",width:2,height:1,numBins:32,freqRange:[0,1],x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Visualization Mode",type:"select",options:[{label:"Candle Bar",value:"bars"},{label:"Waveform (Osc)",value:"waveform"},{label:"Spectrum Line",value:"spectrum"}]},{id:"freqRange",label:"Frequency Range",type:"range",min:0,max:1,step:.01,isRange:!0,default:[0,1],showIf:{mode:["bars","spectrum"]}},{id:"numBins",label:"Resolution",type:"range",min:8,max:128,step:1},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.1,max:2,step:.01},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"timer",name:"Timer",description:"Generates a clock, count-up or count-down visualization.",defaultParams:{mode:"clock",format:"MM:SS",startTime:60,x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Mode",type:"select",options:[{label:"Clock",value:"clock"},{label:"Count-up",value:"count-up"},{label:"Count-down",value:"count-down"}]},{id:"format",label:"Format",type:"select",options:[{label:"HH:MM:SS",value:"HH:MM:SS"},{label:"MM:SS",value:"MM:SS"},{label:"SS.mm",value:"SS.mm"}]},{id:"startTime",label:"Start Time (Sec)",type:"range",min:1,max:3600,step:1,showIf:{mode:"count-down"}},{id:"fontUrl",label:"Fonts",type:"text"},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:500,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]}],mv=()=>{const[n,e]=T.useState([]);T.useEffect(()=>{const l=async()=>{if(window.electronAPI&&window.electronAPI.ndiFindSources){const u=await window.electronAPI.ndiFindSources();e(u||[])}};l();const o=setInterval(l,5e3);return()=>clearInterval(o)},[]);const a=(l,o)=>{l.dataTransfer.setData("application/json",JSON.stringify(o))},s=(l,o)=>{const u=$f.find(p=>p.id==="ndi-source"),h={...u,defaultParams:{...u.defaultParams,sourceName:o.name}};l.dataTransfer.setData("application/json",JSON.stringify(h))};return f.jsxs("div",{className:"generator-panel",children:[f.jsx("div",{className:"generator-list",children:$f.filter(l=>l.id!=="ndi-source"&&l.id!=="spout-receiver").map(l=>f.jsx("div",{className:"generator-item",draggable:!0,onDragStart:o=>a(o,l),children:l.name},l.id))}),f.jsx("h3",{style:{marginTop:"10px"},children:"NDI Sources"}),f.jsx("div",{className:"generator-list",children:n.length>0?n.map((l,o)=>f.jsx("div",{className:"generator-item ndi-item",draggable:!0,onDragStart:u=>s(u,l),children:l.name},`${l.name}-${o}`)):f.jsx("div",{className:"empty-msg",children:"No NDI sources found"})})]})},gv=()=>{const n=(e,a)=>{e.dataTransfer.setData("application/json",JSON.stringify(a))};return f.jsx("div",{className:"effect-panel",children:dl.map(e=>f.jsx("div",{draggable:!0,onDragStart:a=>n(a,e),className:"effect-item",children:e.name},e.id))})},wi=({value:n,onChange:e,label:a,onDrop:s,size:l=40,isAssigned:o,className:u,...h})=>{const p=T.useRef(null),g=b=>{s&&(b.preventDefault(),b.dataTransfer.dropEffect="link")},v=b=>{if(s){b.preventDefault();try{const M=b.dataTransfer.getData("application/x-truelazer-param");console.log("[RadialKnob] Dropped Data Raw:",M);const D=JSON.parse(M);console.log("[RadialKnob] Dropped Data Parsed:",D),D&&(D.type==="range"||D.type==="number")?s(D):console.warn("[RadialKnob] Invalid data type for knob:",D?.type)}catch(M){console.error("[RadialKnob] Drop Error:",M)}}},A=-135+n*270,S=b=>{if(!o||b.button!==0)return;b.preventDefault();const M=b.clientY,D=n,L=Q=>{const U=(M-Q.clientY)/200;let I=Math.max(0,Math.min(1,D+U));e(I)},B=()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",B)};window.addEventListener("mousemove",L),window.addEventListener("mouseup",B)};return T.useEffect(()=>{const b=p.current;if(!b)return;const M=D=>{if(!o)return;D.preventDefault(),D.stopPropagation();const L=D.deltaY*-.001;let B=Math.max(0,Math.min(1,n+L));e(B)};return b.addEventListener("wheel",M,{passive:!1}),()=>{b.removeEventListener("wheel",M)}},[n,e,o]),f.jsxs("div",{className:`quick-assign-knob ${o?"":"unassigned"} ${u||""}`.trim(),ref:p,style:{cursor:o?"ns-resize":"default",userSelect:"none",opacity:o?1:.5},onDragOver:g,onDrop:v,onMouseDown:S,...h,children:[f.jsx("div",{className:"knob-label",title:a,children:a}),f.jsx("div",{className:"knob-circle",children:f.jsx("div",{className:"knob-indicator",style:{transform:`rotate(${A}deg)`}})}),f.jsxs("div",{className:"knob-value",style:{fontSize:"9px",color:"#888",marginTop:"2px"},children:[Math.round(n*100),"%"]})]})},yv=({dacs:n=[],onDacSelected:e,onDacsDiscovered:a,dacSettings:s={},onUpdateDacSettings:l,onApplyGroup:o})=>{const[u,h]=T.useState(!1),[p,g]=T.useState(null),[v,A]=T.useState([]),[S,b]=T.useState(null),[M,D]=T.useState({}),[L,B]=T.useState(""),[Q,_]=T.useState([]),U=vn.useRef(!1);T.useEffect(()=>{window.electronAPI&&window.electronAPI.getDacGroups&&window.electronAPI.getDacGroups().then(D),window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(z=>{A(z),z.length>0&&b(z[0])})},[]),T.useEffect(()=>{u&&!U.current&&(U.current=!0,console.log("Starting DAC scan on:",S?.address),window.electronAPI?window.electronAPI.discoverDacs(2e3,S?.address).then(async z=>{console.log("DACs discovered:",z);const K=await Promise.all(z.map(async re=>{try{const V=await window.electronAPI.getDacServices(re.ip,S?.address,re.type),ee=re.type&&re.type.toLowerCase()==="etherdream"?V:V.filter(se=>se.serviceID!==0);return{...re,channels:ee}}catch(V){return console.error(`Error fetching services for DAC ${re.ip}:`,V),{...re,channels:[]}}}));a&&a(K)}).catch(z=>{console.error("Error discovering DACs:",z)}).finally(()=>{h(!1),U.current=!1}):(console.warn("electronAPI is not available. Cannot discover DACs."),h(!1),U.current=!1))},[u,S,a]);const I=(z,K)=>{const re={...z,channel:K};g(re),e&&e(re)},P=(z,K,re)=>{z.stopPropagation();const V={...K,channel:re};z.dataTransfer.setData("application/json",JSON.stringify(V))},Y=z=>{const K=z.target.value,re=v.find(V=>V.address===K);b(re)},te=(z,K)=>{z.stopPropagation();const re={...K,allChannels:!0};z.dataTransfer.setData("application/json",JSON.stringify(re))},oe=(z,K)=>{const re=Q.some(V=>V.ip===z.ip&&V.channel===K);_(re?Q.filter(V=>!(V.ip===z.ip&&V.channel===K)):[...Q,{ip:z.ip,channel:K,type:z.type,hostName:z.hostName,unitID:z.unitID}])},W=async()=>{if(!L.trim()||Q.length===0)return;const z={...M,[L.trim()]:Q};D(z),window.electronAPI&&window.electronAPI.saveDacGroups&&await window.electronAPI.saveDacGroups(z),B(""),_([])},O=async z=>{const K={...M};delete K[z],D(K),window.electronAPI&&window.electronAPI.saveDacGroups&&await window.electronAPI.saveDacGroups(K)},$=z=>{o&&o(z)};return f.jsxs("div",{className:"dac-panel",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"DACs"})}),f.jsxs("div",{className:"network-interface-selector",style:{display:"flex",gap:5,padding:"5px 10px"},children:[f.jsxs("div",{style:{flex:1,display:"flex"},children:[f.jsx("select",{onChange:Y,value:S?.address||"",style:{width:"100%",height:"100%",background:"#2a2a2a",color:"#aaa",borderRadius:"5px",cursor:"pointer",marginBottom:2},children:v.map(z=>f.jsxs("option",{value:z.address,children:[z.name," (",z.address,")"]},z.address))}),f.jsx("button",{onClick:()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(z=>{A(z),z.length>0&&!S&&b(z[0])})},style:{fontSize:"9px",padding:"2px",background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",borderRadius:"5px"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-clockwise",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"}),f.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"})]})})]}),f.jsx("label",{style:{display:"flex",alignItems:"center",fontSize:"10px"},children:f.jsx("input",{type:"checkbox",checked:u,onChange:z=>h(z.target.checked),disabled:u,style:{height:"100%"}})})]}),f.jsx("div",{className:"dac-list",children:n.map(z=>f.jsxs("div",{className:"dac-group",draggable:!0,onDragStart:K=>te(K,z),children:[f.jsxs("div",{className:"dac-ip",children:[z.hostName||z.ip," (",z.ip,")"]}),f.jsx("div",{className:"dac-channels",children:z.channels&&z.channels.length>0?z.channels.map(K=>{const re=Q.some(V=>V.ip===z.ip&&V.channel===K.serviceID);return f.jsxs("div",{className:`dac-channel-item ${p&&(p.unitID===z.unitID||p.ip===z.ip)&&p.channel===K.serviceID?"selected":""}`,onClick:()=>I(z,K.serviceID),draggable:!0,onDragStart:V=>P(V,z,K.serviceID),style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("input",{type:"checkbox",className:"tl-checkbox",checked:re,onChange:V=>{V.stopPropagation(),oe(z,K.serviceID)},onClick:V=>V.stopPropagation()}),f.jsxs("span",{style:{flex:1},children:["Channel ",K.serviceID," (",K.name,")"]})]},`${z.unitID||z.ip}-${K.serviceID}`)}):f.jsx("div",{className:"dac-channel-item no-channels",children:"No channels found"})})]},z.unitID||z.ip))}),f.jsxs("div",{className:"dac-groups-section",style:{padding:"10px",borderTop:"1px solid #444",marginTop:"10px"},children:[f.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:"0.9rem",color:"#888"},children:"DAC Groups"}),f.jsxs("div",{className:"new-group-form",style:{display:"flex",gap:"5px",marginBottom:"10px"},children:[f.jsx("input",{type:"text",placeholder:"Group Name...",value:L,onChange:z=>B(z.target.value),style:{flex:1,background:"#111",border:"1px solid #444",color:"#fff",fontSize:"11px",padding:"2px 5px",borderRadius:"3px"}}),f.jsx("button",{onClick:W,disabled:!L.trim()||Q.length===0,style:{fontSize:"10px",padding:"2px 8px",background:"#333",color:"#fff",border:"1px solid #555",borderRadius:"3px",cursor:"pointer"},children:"Save"})]}),f.jsxs("div",{className:"groups-list",children:[Object.entries(M).map(([z,K])=>f.jsxs("div",{className:"group-item",draggable:!0,onDragStart:re=>{re.stopPropagation(),re.dataTransfer.setData("application/json",JSON.stringify({isGroup:!0,name:z,channels:K}))},style:{display:"flex",alignItems:"center",background:"#2a2a2a",padding:"4px 8px",borderRadius:"4px",marginBottom:"4px",fontSize:"11px",cursor:"grab"},children:[f.jsxs("span",{style:{flex:1},children:[z," (",K.length,")"]}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("button",{onClick:()=>$(K),style:{background:"var(--theme-color)",border:"none",color:"#000",padding:"2px 6px",borderRadius:"3px",cursor:"pointer",fontSize:"10px"},children:"Apply"}),f.jsx("button",{onClick:()=>O(z),style:{background:"#444",border:"none",color:"#ccc",padding:"2px 6px",borderRadius:"3px",cursor:"pointer",fontSize:"10px"},children:""})]})]},z)),Object.keys(M).length===0&&f.jsx("div",{style:{fontSize:"10px",color:"#666",fontStyle:"italic"},children:"No groups defined."})]})]}),n.length>0&&f.jsxs("div",{className:"dac-dimmers-section",children:[f.jsx("h4",{children:"Channel Dimmers"}),f.jsx("div",{className:"dac-dimmers-grid",children:n.flatMap(z=>(z.channels||[]).map(K=>({dac:z,ch:K}))).map(({dac:z,ch:K})=>{const re=`${z.ip}:${K.serviceID}`,V=s[re]||{},ee=V.dimmer!==void 0?V.dimmer:1;return f.jsx(Kt,{id:`dimmer_${re.replace(/\./g,"_")}`,children:f.jsx(wi,{label:`${z.hostName||z.ip} Ch${K.serviceID}`,value:ee,onChange:se=>{l&&l(re,{...V,dimmer:se})}})},`dimmer_${re}`)})})]})]})},Xm=({min:n,max:e,step:a,value:s,rangeValue:l,onChange:o,onRangeChange:u,showRange:h=!1,disabled:p=!1,animSettings:g,progressRef:v,workerId:A,clipDuration:S,bpm:b,getFftLevels:M})=>{const D=T.useRef(null),L=T.useRef(null),B=T.useRef(null),[Q,_]=T.useState(null),U=n!==void 0?n:0,I=e!==void 0?e:1,P=l&&l[0]!==void 0?l[0]:U,Y=l&&l[1]!==void 0?l[1]:I,te=s!==void 0?s:U,oe=O=>{const $=I-U;return $===0?0:(O-U)/$*100};T.useEffect(()=>{let O;const $=()=>{if(Q==="value"){O=requestAnimationFrame($);return}let z=te;if(g&&g.syncMode&&v&&v.current){const V={progress:A&&v.current[A]!==void 0?v.current[A]:0,time:performance.now(),clipDuration:S||1,bpm:b||120,fftLevels:M?M():{low:0,mid:0,high:0}};z=Nc(null,te,g,V,U,I)}const K=oe(z);L.current&&(L.current.style.left=`${K}%`),B.current&&(B.current.style.width=`${K}%`),O=requestAnimationFrame($)};return O=requestAnimationFrame($),()=>cancelAnimationFrame(O)},[g,v,A,te,Q,U,I,b,M,S]);const W=(O,$)=>{if(p)return;O.preventDefault(),O.stopPropagation(),_($);const z=re=>{if(!D.current)return;const V=D.current.getBoundingClientRect(),ee=re.clientX-V.left;let se=Math.max(0,Math.min(100,ee/V.width*100)),ge=U+se/100*(I-U);a&&(ge=Math.round(ge/a)*a,se=(ge-U)/(I-U)*100),$==="value"?(ge=Math.max(P,Math.min(Y,ge)),L.current&&(L.current.style.left=`${oe(ge)}%`),B.current&&!h&&(B.current.style.width=`${oe(ge)}%`),o&&o(ge)):$==="min"?(ge=Math.max(U,Math.min(Y,ge)),u&&u([ge,Y])):$==="max"&&(ge=Math.max(P,Math.min(I,ge)),u&&u([P,ge]))},K=()=>{_(null),window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",K)};window.addEventListener("mousemove",z),window.addEventListener("mouseup",K)};return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:D,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[h&&f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:`${oe(P)}%`,width:`${oe(Y)-oe(P)}%`}}),!h&&f.jsx("div",{className:"value-slider-fill",ref:B,style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:"0%",borderRadius:"2px"}}),h&&f.jsx("div",{className:"range-slider-handle min-handle",style:{left:`${oe(P)}%`},onMouseDown:O=>W(O,"min"),title:`Min: ${P.toFixed(2)}`}),h&&f.jsx("div",{className:"range-slider-handle max-handle",style:{left:`${oe(Y)}%`},onMouseDown:O=>W(O,"max"),title:`Max: ${Y.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle value-handle",ref:L,style:{position:"absolute",width:"6px",height:"16px",top:"-50%",transform:"translate(-50%, -25%)",cursor:"pointer",zIndex:20,boxShadow:"0 0 2px rgba(0,0,0,0.5)"},onMouseDown:O=>W(O,"value"),title:`Value: ${te.toFixed(2)}`})]})})},$m=({min:n=0,max:e=1,step:a=.01,value:s=[0,1],onChange:l,disabled:o=!1})=>{const u=T.useRef(null),[h,p]=T.useState(null),g=s[0]!==void 0?s[0]:n,v=s[1]!==void 0?s[1]:e,A=T.useCallback(b=>{const M=e-n;return M===0?0:(b-n)/M*100},[n,e]),S=(b,M)=>{if(o)return;b.preventDefault(),b.stopPropagation(),p(M);const D=B=>{if(!u.current)return;const Q=u.current.getBoundingClientRect(),_=B.clientX-Q.left;let U=Math.max(0,Math.min(100,_/Q.width*100)),I=n+U/100*(e-n);if(a&&(I=Math.round(I/a)*a),M==="low"){const P=Math.min(I,v-a);l&&l([P,v])}else{const P=Math.max(I,g+a);l&&l([g,P])}},L=()=>{p(null),window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",L)};window.addEventListener("mousemove",D),window.addEventListener("mouseup",L)};return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:u,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color)",left:`${A(g)}%`,width:`${A(v)-A(g)}%`}}),f.jsx("div",{className:"range-slider-handle",style:{left:`${A(g)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:b=>S(b,"low"),title:`Low: ${g.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle",style:{left:`${A(v)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:b=>S(b,"high"),title:`High: ${v.toFixed(2)}`})]})})},ia=({title:n,children:e,icon:a,defaultCollapsed:s=!1,headerActions:l,onToggle:o,isCollapsed:u,dragHandle:h})=>{const[p,g]=T.useState(s),v=o!==void 0?u:p,A=()=>{o?o(!v):g(!v)};return f.jsxs("div",{className:`settings-card ${v?"collapsed":""}`,children:[f.jsxs("div",{className:"settings-card-header",onClick:A,style:{userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer",flex:1,overflow:"hidden"},children:[h&&f.jsx("div",{onClick:S=>S.stopPropagation(),style:{display:"flex",alignItems:"center"},children:h}),f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",style:{transform:v?"rotate(0deg)":"rotate(90deg)",transition:"transform 0.2s",flexShrink:0},children:f.jsx("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})}),a&&f.jsx("span",{className:`bi ${a}`,style:{flexShrink:0}}),f.jsx("h4",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",margin:0},children:n})]}),l&&f.jsx("div",{onClick:S=>S.stopPropagation(),style:{flexShrink:0,marginLeft:"5px"},children:l})]}),!v&&f.jsx("div",{className:"settings-card-content",children:e})]})},Wm=({animSettings:n,onChange:e})=>{const{direction:a="forward",style:s="loop",syncMode:l=null,duration:o=1,beats:u=8,speedMultiplier:h=1}=n||{},p=(v,A)=>e({...n,[v]:A}),g=(v,A,S=!1)=>{let M=n?.[v]||(v==="beats"?8:1);S?M=A>1?M*2:M/2:M+=A,M<.01&&(M=.01),!S&&v!=="beats"&&(M=Math.round(M*100)/100),p(v,M)};return f.jsxs("div",{className:"anim-controls-container",children:[f.jsxs("div",{className:"anim-row controls-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"5px"},children:[f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${a==="backward"?"active":""}`,onClick:()=>p("direction","backward"),title:"Backward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",transform:"scale(-1 1)",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})}),f.jsx("button",{className:`speed-control-button ${a==="pause"?"active":""}`,onClick:()=>p("direction","pause"),title:"Pause",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"25",height:"20",viewBox:"0 0 16 16",className:"icon flat-color",children:f.jsx("path",{d:"M3 1h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m7 0h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m0 0"})})}),f.jsx("button",{className:`speed-control-button ${a==="forward"?"active":""}`,onClick:()=>p("direction","forward"),title:"Forward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${s==="once"?"active":""}`,onClick:()=>p("style","once"),title:"Once",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M43.8233 25.2305C43.7019 25.9889 43.5195 26.727 43.2814 27.4395 42.763 28.9914 41.9801 30.4222 40.9863 31.6785 38.4222 34.9201 34.454 37 30 37H16C9.39697 37 4 31.6785 4 25 4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19V31",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19 21 22 19.5 23.5",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="bounce"?"active":""}`,onClick:()=>p("style","bounce"),title:"Bounce",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M42 19H5.99998",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M30 7 42 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79897 29H42.799",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79895 29 18.799 41",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="loop"?"active":""}`,onClick:()=>p("style","loop"),title:"Loop",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M4 25C4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M44 23C44 29.6498 38.6038 35 32 35H4",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M10 41 4 35 10 29",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${l==="fps"?"active":""}`,onClick:()=>p("syncMode",l==="fps"?null:"fps"),style:{flex:1,padding:0,fontSize:"10px"},children:"F"}),f.jsx("button",{className:`speed-control-button ${l==="timeline"?"active":""}`,onClick:()=>p("syncMode",l==="timeline"?null:"timeline"),style:{flex:1,padding:0,fontSize:"10px"},children:"T"}),f.jsx("button",{className:`speed-control-button ${l==="bpm"?"active":""}`,onClick:()=>p("syncMode",l==="bpm"?null:"bpm"),style:{flex:1,padding:0,fontSize:"10px"},children:"B"}),f.jsx("button",{className:`speed-control-button ${l==="fft"?"active":""}`,onClick:()=>p("syncMode",l==="fft"?null:"fft"),style:{flex:1,padding:0,fontSize:"10px"},children:"FFT"})]})]}),l==="fft"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Range"}),f.jsxs("select",{value:n?.fftRange||"low",onChange:v=>p("fftRange",v.target.value),style:{fontSize:"10px",background:"#333",border:"1px solid #555",color:"white"},children:[f.jsx("option",{value:"low",children:"Low"}),f.jsx("option",{value:"mid",children:"Mid"}),f.jsx("option",{value:"high",children:"High"})]})]})}),l==="timeline"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:typeof o=="number"?o.toFixed(2):o,onChange:v=>p("duration",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",2,!0),children:"*2"})]})]})}),l==="bpm"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Beats"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:v=>p("beats",parseInt(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",2,!0),children:"*2"})]})]})}),(l==="timeline"||l==="bpm"||l==="fps")&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Speed"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:typeof h=="number"?h.toFixed(2):h,onChange:v=>p("speedMultiplier",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",.1),children:"+0.1"})]})]})})]})},ro=(n,e,a)=>{let s,l,o;const u=Math.floor(n*6),h=n*6-u,p=a*(1-e),g=a*(1-h*e),v=a*(1-(1-h)*e);switch(u%6){case 0:s=a,l=v,o=p;break;case 1:s=g,l=a,o=p;break;case 2:s=p,l=a,o=v;break;case 3:s=p,l=g,o=a;break;case 4:s=v,l=p,o=a;break;case 5:s=a,l=p,o=g;break}const A=S=>{const b=Math.round(S*255).toString(16);return b.length===1?"0"+b:b};return`#${A(s)}${A(l)}${A(o)}`},Y0=n=>{let e=parseInt(n.slice(1,3),16)/255,a=parseInt(n.slice(3,5),16)/255,s=parseInt(n.slice(5,7),16)/255,l=Math.max(e,a,s),o=Math.min(e,a,s),u,h,p=l,g=l-o;if(h=l===0?0:g/l,l===o)u=0;else{switch(l){case e:u=(a-s)/g+(a<s?6:0);break;case a:u=(s-e)/g+2;break;case s:u=(e-a)/g+4;break}u/=6}return{h:u,s:h,v:p}},V0=({color:n="#ffffff",onChange:e})=>{const a=T.useRef(null),[s,l]=T.useState(()=>Y0(n)),[o,u]=T.useState(!1);T.useEffect(()=>{const v=Y0(n);ro(v.h,v.s,v.v)!==ro(s.h,s.s,s.v)&&l(v)},[n]);const h=T.useCallback(()=>{const v=a.current;if(!v)return;const A=v.getContext("2d"),S=v.width,b=v.height;A.fillStyle=ro(s.h,1,1),A.fillRect(0,0,S,b);const M=A.createLinearGradient(0,0,S,0);M.addColorStop(0,"rgba(255,255,255,1)"),M.addColorStop(1,"rgba(255,255,255,0)"),A.fillStyle=M,A.fillRect(0,0,S,b);const D=A.createLinearGradient(0,0,0,b);D.addColorStop(0,"rgba(0,0,0,0)"),D.addColorStop(1,"rgba(0,0,0,1)"),A.fillStyle=D,A.fillRect(0,0,S,b);const L=s.s*S,B=(1-s.v)*b;A.strokeStyle=s.v>.5?"#000":"#fff",A.lineWidth=2,A.beginPath(),A.arc(L,B,5,0,Math.PI*2),A.stroke()},[s]);T.useEffect(()=>{h()},[h]);const p=v=>{const S=a.current.getBoundingClientRect(),b=Math.max(0,Math.min(1,(v.clientX-S.left)/S.width)),M=Math.max(0,Math.min(1,(v.clientY-S.top)/S.height)),D={...s,s:b,v:1-M};l(D),e&&e(ro(D.h,D.s,D.v))},g=v=>{u(!0),p(v)};return T.useEffect(()=>{if(!o)return;const v=S=>p(S),A=()=>u(!1);return window.addEventListener("mousemove",v),window.addEventListener("mouseup",A),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",A)}},[o,s]),f.jsxs("div",{className:"custom-color-picker",style:{padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("canvas",{ref:a,width:150,height:100,style:{width:"100%",height:"100px",cursor:"crosshair",borderRadius:"2px"},onMouseDown:g}),f.jsx("div",{className:"hue-slider-container",style:{marginTop:"8px"},children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:s.h,onChange:v=>{const A={...s,h:parseFloat(v.target.value)};l(A),e&&e(ro(A.h,A.s,A.v))},style:{width:"100%",height:"10px",appearance:"none",background:"linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)",borderRadius:"5px"}})})]})},Zm=({control:n,value:e,onChange:a,animSettings:s,onAnimChange:l,effectId:o,context:u,progressRef:h,workerId:p,clipDuration:g,bpm:v,getFftLevels:A,uiState:S,onUpdateUiState:b,paramKey:M})=>{const[D,L]=T.useState(!1),B=!!S?.expandedParams?.[M],Q=Y=>{b&&b({expandedParams:{...S?.expandedParams||{},[M]:Y}})},_=Y=>{Y.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,effectId:o,min:n.min,max:n.max,step:n.step,...u}))},U=s?.range||[n.min,n.max],I=Y=>{l({...s,range:Y})},P=Y=>{l({range:U,...Y})};return f.jsxs("div",{className:`param-editor ${B?"expanded":""}`,onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),style:{marginBottom:"8px",display:"grid",gridTemplateColumns:"1fr",gap:"2px"},children:[f.jsx("div",{className:"param-row-label",style:{width:"100%"},children:f.jsx("label",{className:"param-label",draggable:!0,onDragStart:_,style:{fontSize:"11px",color:"#aaa"},children:n.label})}),f.jsxs("div",{className:"param-row-control",style:{display:"grid",gridTemplateColumns:"20px 1fr 60px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${B?"active":""}`,style:{visibility:D||B||s?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>Q(!B),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",style:{display:"flex",alignItems:"center",height:"100%"},children:n.type==="range"?n.isRange?f.jsx($m,{min:n.min,max:n.max,step:n.step,value:e,onChange:a}):f.jsx(Kt,{id:`${o}_${n.id}`,style:{width:"100%"},children:f.jsx(Xm,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:U,onChange:a,onRangeChange:I,showRange:B,animSettings:s,progressRef:h,workerId:p,clipDuration:g,bpm:v,getFftLevels:A})}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:Y=>a(Y.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx(Kt,{id:`${o}_${n.id}`,children:f.jsx("input",{type:"checkbox",checked:e,onChange:Y=>a(Y.target.checked),className:"param-checkbox"})}):n.type==="select"?f.jsx(Kt,{id:`${o}_${n.id}`,children:f.jsx("select",{value:e,onChange:Y=>a(Y.target.value),className:"param-select",children:n.options.map(Y=>f.jsx("option",{value:Y,children:Y},Y))})}):null}),n.type==="range"&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:Y=>a(parseFloat(Y.target.value)||0),className:"param-number-input",step:n.step,style:{fontSize:"10px"}})]}),B&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Wm,{animSettings:s,onChange:P})})]})},vv=({customOrder:n=[],assignedDacs:e=[],onChange:a})=>{const[s,l]=T.useState(null),o=n&&n.length>0?n:e.map((p,g)=>({ip:p.ip,channel:p.channel,label:`Ch ${p.channel} (${p.hostName||p.ip})`,originalIndex:g})),u=(p,g)=>{l(o[g])},h=(p,g)=>{p.preventDefault();const v=o[g];if(s===v)return;const A=o.filter(S=>S!==s);A.splice(g,0,s),a(A)};return f.jsxs("div",{className:"custom-order-editor",style:{marginBottom:"10px",padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("label",{style:{fontSize:"10px",color:"#888"},children:"Channel Order (Drag to Sort)"}),f.jsx("ul",{style:{listStyle:"none",padding:0,margin:"5px 0"},children:o.map((p,g)=>f.jsxs("li",{draggable:!0,onDragStart:v=>u(v,g),onDragOver:v=>h(v,g),style:{background:"#333",border:"1px solid #444",padding:"4px",marginBottom:"2px",fontSize:"10px",cursor:"grab",display:"flex",alignItems:"center"},children:[f.jsx("span",{style:{marginRight:"5px",color:"#666"},children:""}),p.label||`Ch ${p.channel} ${p.ip?`(${p.ip})`:""}`]},g))})]})},bv=({effect:n,onParamChange:e,syncSettings:a,onSetParamSync:s,context:l,progressRef:o,workerId:u,clipDuration:h,bpm:p,getFftLevels:g,uiState:v,onUpdateUiState:A})=>{const{mode:S,color:b,paletteColors:M=[],paletteSize:D=4}=n.params,[L,B]=T.useState(0),Q=!!v?.showHsv?.[n.instanceId],_=W=>{A&&A({showHsv:{...v?.showHsv||{},[n.instanceId]:W}})},U=W=>{const O=[...M];for(;O.length<16;)O.push("#ffffff");O[L]=W,e("paletteColors",O)},I=dl.find(W=>W.id==="color"),P=W=>{if(!W)return{h:0,s:0,v:1};const O=parseInt(W.slice(1,3),16)/255,$=parseInt(W.slice(3,5),16)/255,z=parseInt(W.slice(5,7),16)/255,K=Math.max(O,$,z),re=Math.min(O,$,z);let V,ee,se=K;const ge=K-re;if(ee=K===0?0:ge/K,K===re)V=0;else{switch(K){case O:V=($-z)/ge+($<z?6:0);break;case $:V=(z-O)/ge+2;break;case z:V=(O-$)/ge+4;break}V/=6}return{h:V,s:ee,v:se}},Y=W=>{e("color",W);const O=P(W);e("hue",O.h),e("saturation",O.s),e("brightness",O.v)},te=[{name:"RGBY",colors:["#ff0000","#00ff00","#0000ff","#ffff00"]},{name:"CYBER",colors:["#ff00ff","#00ffff","#ffffff","#0000ff"]},{name:"FIRE",colors:["#ff8800","#ff0000","#ffff00","#880000"]},{name:"ICE",colors:["#0000ff","#0088ff","#00ffff","#ffffff"]}],oe=W=>{const O=I.paramControls.find(z=>z.id===W);if(!O)return null;const $=`${n.instanceId||n.id}.${O.id}`;return f.jsx(Zm,{control:O,value:n.params[W],onChange:z=>e(W,z),animSettings:a[$],onAnimChange:z=>s($,z),effectId:n.id,context:l,progressRef:o,workerId:u,clipDuration:h,bpm:p,getFftLevels:g,uiState:v,onUpdateUiState:A,paramKey:$},W)};return f.jsxs("div",{className:"color-effect-editor",children:[oe("mode"),S==="solid"&&f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("label",{style:{fontSize:"11px",color:"#aaa"},children:"Pick Color"}),f.jsx("button",{className:`anim-toggle-btn ${Q?"active":""}`,style:{background:"none",border:"none",color:Q?"var(--theme-color)":"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>_(!Q),title:"Advanced HSV Controls",children:""})]}),!Q&&f.jsx(V0,{color:b||"#ffffff",onChange:Y}),Q&&f.jsxs("div",{className:"hsv-sliders",style:{padding:"5px",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[oe("hue"),oe("saturation"),oe("brightness"),f.jsx("div",{style:{marginTop:"5px",height:"10px",borderRadius:"2px",background:b||"#ffffff",border:"1px solid #444"}})]})]}),S==="palette"&&f.jsxs("div",{style:{marginTop:"10px"},children:[oe("paletteSize"),oe("paletteSpread"),oe("cycleSpeed"),oe("rainbowOffset"),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Presets"}),f.jsx("div",{className:"preset-row",style:{display:"flex",gap:"4px",marginBottom:"10px"},children:te.map(W=>f.jsx("button",{onClick:()=>e("paletteColors",W.colors),style:{fontSize:"9px",padding:"2px 5px",background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:"3px",cursor:"pointer"},children:W.name},W.name))}),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Palette Colors"}),f.jsx("div",{className:"palette-grid",style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"10px"},children:Array.from({length:D}).map((W,O)=>f.jsx("div",{onClick:()=>B(O),style:{width:"20px",height:"20px",background:M[O]||"#ffffff",border:L===O?"2px solid white":"1px solid #444",borderRadius:"3px",cursor:"pointer",boxSizing:"border-box"}},O))}),f.jsx(V0,{color:M[L]||"#ffffff",onChange:U})]}),S==="rainbow"&&f.jsxs("div",{style:{marginTop:"10px"},children:[oe("cycleSpeed"),oe("rainbowSpread"),oe("rainbowOffset"),oe("rainbowPalette")]})]})},Qm=({effect:n,assignedDacs:e=[],onParamChange:a,onRemove:s,syncSettings:l={},onSetParamSync:o,context:u={},progressRef:h,clipDuration:p,bpm:g,getFftLevels:v,uiState:A,onUpdateUiState:S,dragHandle:b})=>{if(!n)return null;const M=dl.find(P=>P.id===n.id);if(!M)return null;const D=n.id==="delay";n.id;const L=n.id==="color",B=n.params.enabled!==!1;n.params.mode;const Q=A?.collapsedEffects||{},_=!!Q[n.instanceId],U=P=>{S&&S({collapsedEffects:{...Q,[n.instanceId]:P}})},I=P=>{P.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"enabled",label:`${n.name} ON`,...u}))};return f.jsx(ia,{title:n.name,isCollapsed:_,onToggle:U,dragHandle:b,headerActions:f.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[f.jsx(Kt,{id:`${n.id}_blackout`,children:f.jsx("button",{className:`layer-control-button ${B?"":"active"}`,onClick:()=>a("enabled",!B),draggable:!0,onDragStart:I,style:{padding:"2px",background:B?"none":"red",border:"none",color:"white",cursor:"pointer",display:"flex"},title:"Toggle Effect",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx("button",{className:"remove-effect-btn",onClick:s,children:""})]}),children:L?f.jsx(bv,{effect:n,onParamChange:a,syncSettings:l,onSetParamSync:o,context:u,progressRef:h,workerId:u.workerId,clipDuration:p,bpm:g,getFftLevels:v,uiState:A,onUpdateUiState:S}):f.jsxs(f.Fragment,{children:[D&&f.jsx(f.Fragment,{children:n.params.useCustomOrder&&f.jsx(vv,{customOrder:n.params.customOrder,assignedDacs:e,onChange:P=>a("customOrder",P)})}),M.paramControls.map(P=>{if(D&&["customOrder"].includes(P.id)||P.showIf&&!Object.entries(P.showIf).every(([W,O])=>Array.isArray(O)?O.includes(n.params[W]):n.params[W]===O))return null;const Y=`${n.instanceId||n.id}.${P.id}`,te=typeof l[Y]=="object"?l[Y]:{syncMode:l[Y]};return f.jsx(Zm,{control:P,value:n.params[P.id],onChange:oe=>a(P.id,oe),animSettings:te,onAnimChange:oe=>o(Y,oe),effectId:n.id,context:u,progressRef:h,workerId:u.workerId,clipDuration:p,bpm:g,getFftLevels:v,uiState:A,onUpdateUiState:S,paramKey:Y},P.id)})]})})},xv=({control:n,value:e,onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,generatorId:g,clipDuration:v,uiState:A,onUpdateUiState:S})=>{const[b,M]=T.useState(!1),D=`${g}.${n.id}`,L=!!A?.expandedParams?.[D],B=P=>{S&&S({expandedParams:{...A?.expandedParams||{},[D]:P}})},Q=P=>{P.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,targetType:"generator",layerIndex:o,colIndex:u,min:n.min,max:n.max,step:n.step}))},_=typeof s[D]=="object"?s[D]:{syncMode:s[D]},U=_?.range||[n.min,n.max],I=P=>{l(D,{..._,range:P})};return f.jsxs("div",{className:`param-editor ${L?"expanded":""}`,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),style:{marginBottom:"8px"},children:[f.jsx("div",{className:"param-label-row",style:{display:"flex",alignItems:"center"},children:f.jsx("label",{draggable:!0,onDragStart:Q,className:"param-label",style:{fontSize:"11px",color:"#aaa",cursor:"grab"},children:n.label})}),f.jsxs("div",{className:"control-row",style:{display:"grid",gridTemplateColumns:"20px 1fr 50px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${L?"active":""}`,style:{visibility:b||L||_?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>B(!L),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",children:n.type==="range"?n.isRange?f.jsx($m,{min:n.min,max:n.max,step:n.step,value:e,onChange:P=>a(n.id,P)}):f.jsx(Xm,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:U,onChange:P=>a(n.id,P),onRangeChange:I,showRange:L,animSettings:_,progressRef:h,workerId:p,clipDuration:v}):n.type==="number"?f.jsx("input",{type:"number",value:e,onChange:P=>a(n.id,parseFloat(P.target.value)||0),className:"param-number-input",step:n.step}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:P=>a(n.id,P.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx("input",{type:"checkbox",checked:e,onChange:P=>a(n.id,P.target.checked),className:"param-checkbox"}):n.type==="select"?f.jsx("select",{value:e,onChange:P=>a(n.id,P.target.value),className:"param-select",style:{width:"100%",fontSize:"11px",background:"#333",color:"#fff",border:"1px solid #555"},children:n.options.map(P=>f.jsx("option",{value:P.value,children:P.label},P.value))}):null}),n.type==="range"&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:P=>a(n.id,parseFloat(P.target.value)||0),className:"param-number-input",step:n.step,style:{width:"100%",fontSize:"10px"}})]}),L&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Wm,{animSettings:_,onChange:P=>l(D,P)})})]})},Sv=({selectedGeneratorId:n,selectedGeneratorParams:e,onParameterChange:a,syncSettings:s={},onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,clipDuration:g,uiState:v,onUpdateUiState:A})=>{const[S,b]=T.useState([]),[M,D]=T.useState([]),[L,B]=T.useState(!1);if(!n)return f.jsx("div",{className:"generator-settings-panel",children:"No generator selected."});const Q=$f.find(P=>P.id===n);if(!Q)return f.jsxs("div",{className:"generator-settings-panel",children:["Generator definition not found for ID: ",n]});const _=v?.collapsedPanels||{},U=P=>{A&&A({collapsedPanels:{..._,generator:P}})};T.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getProjectFonts)try{const Y=await window.electronAPI.getProjectFonts();D(Y)}catch(Y){console.error("Failed to load project fonts:",Y)}})()},[]);const I=async P=>{const Y=P.target.value;if(Y==="browse")if(window.electronAPI&&window.electronAPI.showFontFileDialog){const te=await window.electronAPI.showFontFileDialog();te&&a("fontUrl",te)}else console.error("Font file dialog API not available.");else if(Y==="load-system"){B(!0);try{const oe=(await window.electronAPI.getSystemFonts()).map(W=>({name:W.split(/[\\/]/).pop(),path:W})).sort((W,O)=>W.name.localeCompare(O.name));b(oe)}catch(te){console.error("Failed to load system fonts:",te)}B(!1)}else a("fontUrl",Y)};return f.jsx(ia,{title:`${Q.name} Settings`,isCollapsed:!!_.generator,onToggle:U,children:Q.paramControls.filter(P=>P.condition&&!P.condition(e)?!1:P.showIf?Object.entries(P.showIf).every(([Y,te])=>Array.isArray(te)?te.includes(e[Y]):e[Y]===te):!0).map(P=>{if(P.id==="fontUrl"){const Y=e[P.id]||"src/fonts/Geometr415 Blk BT Black.ttf";return f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{className:"param-label",children:P.label}),f.jsxs("div",{className:"font-selector-container",children:[f.jsxs("select",{className:"param-select",onChange:I,value:Y,children:[M.length>0?f.jsx("optgroup",{label:"Project Fonts",children:M.map(te=>f.jsx("option",{value:te.path,children:te.name},te.path))}):f.jsx("optgroup",{label:"Default Fonts",children:f.jsx("option",{value:"src/fonts/Geometr415 Blk BT Black.ttf",children:"Geometr415"})}),S.length>0?f.jsx("optgroup",{label:"System Fonts",children:S.map(te=>f.jsx("option",{value:te.path,children:te.name},te.path))}):f.jsx("option",{value:"load-system",children:L?"Loading...":"Load System Fonts..."}),f.jsx("optgroup",{label:"Actions",children:f.jsx("option",{value:"browse",children:"Browse File..."})})]}),f.jsx("span",{className:"font-path-tiny",title:Y,children:Y.split(/[\\/]/).pop()})]})]},P.id)}return f.jsx(xv,{control:P,value:e[P.id],onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,generatorId:n,clipDuration:g,uiState:v,onUpdateUiState:A},P.id)})})},wv=({settings:n,onUpdate:e,uiState:a,onUpdateUiState:s})=>{const{mode:l="fps",duration:o=1,beats:u=8,speedMultiplier:h=1,fps:p=60}=n||{},g=a?.collapsedPanels||{},v=b=>{s&&s({collapsedPanels:{...g,playback:b}})},A=b=>{e({mode:b})},S=(b,M,D=!1)=>{let L=n[b]||(b==="beats"?8:b==="fps"?60:1);D?L=M>1?L*2:L/2:L+=M,L<.01&&(L=.01),e({[b]:L})};return f.jsxs(ia,{title:"Clip Playback",isCollapsed:!!g.playback,onToggle:v,children:[f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:l==="fps"?"active":"button_inactive",onClick:()=>A("fps"),children:"FPS"}),f.jsx("button",{className:l==="timeline"?"active":"button_inactive",onClick:()=>A("timeline"),children:"Timeline"}),f.jsx("button",{className:l==="bpm"?"active":"button_inactive",onClick:()=>A("bpm"),children:"BPM Sync"})]}),f.jsxs("div",{className:"playback-controls",children:[l==="fps"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed (FPS)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>S("fps",-1),children:"-1"}),f.jsx("input",{type:"number",value:p,onChange:b=>e({fps:parseInt(b.target.value)||60})}),f.jsx("button",{onClick:()=>S("fps",1),children:"+1"}),f.jsx("button",{onClick:()=>S("fps",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>S("fps",2,!0),children:"*2"})]})]}),f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s) (for effects)"}),f.jsx("div",{className:"value-adjuster",children:f.jsx("input",{type:"number",value:o.toFixed(2),onChange:b=>e({duration:parseFloat(b.target.value)||1})})})]})]}),l==="timeline"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>S("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:o.toFixed(2),onChange:b=>e({duration:parseFloat(b.target.value)||1})}),f.jsx("button",{onClick:()=>S("duration",1),children:"+1"}),f.jsx("button",{onClick:()=>S("duration",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>S("duration",2,!0),children:"*2"})]})]}),l==="bpm"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Beats"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>S("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:b=>e({beats:parseInt(b.target.value)||1})}),f.jsx("button",{onClick:()=>S("beats",1),children:"+1"}),f.jsx("button",{onClick:()=>S("beats",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>S("beats",2,!0),children:"*2"})]})]}),(l==="timeline"||l==="bpm")&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed Multiplier"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>S("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:h.toFixed(2),onChange:b=>e({speedMultiplier:parseFloat(b.target.value)||1})}),f.jsx("button",{onClick:()=>S("speedMultiplier",.1),children:"+0.1"})]})]})]})]})},Km=T.createContext(),go=()=>T.useContext(Km),Ev=({children:n})=>{const[e,a]=T.useState(null),[s,l]=T.useState(null),[o,u]=T.useState(null),[h,p]=T.useState({source:"external",lowRange:[20,250],midRange:[250,4e3],highRange:[4e3,2e4],gain:1,holdTime:100,fallTime:500,calculationMode:"average",smoothingTimeConstant:.8}),[g,v]=T.useState({low:0,mid:0,high:0}),[A,S]=T.useState([]),[b,M]=T.useState([]),[D,L]=T.useState("default"),[B,Q]=T.useState("default"),[_,U]=T.useState(1),I=T.useRef(new Uint8Array(0)),P=T.useRef(new Uint8Array(0)),Y=T.useRef({low:0,mid:0,high:0}),te=T.useRef({low:0,mid:0,high:0,lastUpdateTime:Date.now(),peakTimes:{low:0,mid:0,high:0}}),oe=T.useRef({}),W=T.useRef({}),O=T.useRef({});T.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const qe=await window.electronAPI.getAllSettings();qe.fftSettings&&Object.keys(qe.fftSettings).length>0&&p(lt=>({...lt,...qe.fftSettings})),qe.selectedAudioInputDeviceId&&Q(qe.selectedAudioInputDeviceId)}})()},[]),T.useEffect(()=>{window.electronAPI&&window.electronAPI.setFftSettings&&window.electronAPI.setFftSettings(h)},[h]),T.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedAudioInput&&window.electronAPI.setSelectedAudioInput(B)},[B]);const $=T.useCallback(async()=>{try{const De=await navigator.mediaDevices.enumerateDevices(),qe=De.filter(wt=>wt.kind==="audiooutput"),lt=De.filter(wt=>wt.kind==="audioinput");if(S(qe),M(lt),window.electronAPI&&window.electronAPI.setAudioDevices){const wt=qe.map(gt=>({deviceId:gt.deviceId,label:gt.label,groupId:gt.groupId}));window.electronAPI.setAudioDevices(wt)}}catch(De){console.error("Error enumerating audio devices:",De)}},[]);T.useEffect(()=>{$();let De;return window.electronAPI&&window.electronAPI.onUpdateAudioDeviceId&&(De=window.electronAPI.onUpdateAudioDeviceId(qe=>{L(qe)})),navigator.mediaDevices.addEventListener("devicechange",$),()=>{navigator.mediaDevices.removeEventListener("devicechange",$),De&&De()}},[$]);const z=T.useCallback(De=>{if(!e||!s)return null;try{const qe=e.createMediaElementSource(De);return qe.connect(s),qe.connect(e.destination),qe}catch(qe){return console.warn("MediaElementSource already connected?",qe),null}},[e,s]),K=T.useCallback(async(De,qe,lt=1,wt=!0)=>{if(oe.current[De]&&(oe.current[De].pause(),oe.current[De].src=""),O.current[De]=lt,!qe)return;if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(qe))throw new Error(`Audio file not found: ${qe}`);const gt=new Audio(`file:///${qe}`);if(gt.volume=lt*_,D&&gt.setSinkId)try{await gt.setSinkId(D)}catch(Bt){console.error("Error setting audio sink ID:",Bt)}if(oe.current[De]=gt,e){e.state==="suspended"&&await e.resume();const Bt=z(gt);Bt&&(W.current[De]=Bt)}if(wt)try{await gt.play()}catch(Bt){throw console.error("Error playing audio:",Bt),Bt}return gt},[D,z,_,e]),re=T.useCallback(De=>{U(De),Object.keys(oe.current).forEach(qe=>{const lt=oe.current[qe],wt=O.current[qe]??1;lt&&(lt.volume=De*wt)})},[]),V=T.useCallback((De,qe)=>{O.current[De]=qe;const lt=oe.current[De];lt&&(lt.volume=qe*_)},[_]),ee=T.useCallback(De=>{if(oe.current[De]&&(oe.current[De].pause(),oe.current[De].src="",delete oe.current[De],W.current[De])){try{W.current[De].disconnect()}catch{}delete W.current[De]}},[]),se=T.useCallback(De=>{oe.current[De]&&oe.current[De].pause()},[]),ge=T.useCallback(async De=>{if(oe.current[De]&&oe.current[De].paused)try{await oe.current[De].play()}catch(qe){console.error("Error resuming:",qe)}},[]),Z=T.useCallback(De=>{const qe=Math.max(.0625,Math.min(De,16));Object.values(oe.current).forEach(lt=>{try{lt.playbackRate=qe}catch(wt){console.warn("Failed to set playbackRate:",wt)}})},[]),J=T.useCallback(De=>{oe.current[De]&&(oe.current[De].currentTime=0)},[]),Se=T.useCallback((De,qe)=>{oe.current[De]&&(oe.current[De].currentTime=qe)},[]),Ae=T.useCallback(()=>Object.keys(oe.current).forEach(ee),[ee]),Le=T.useCallback(()=>Object.keys(oe.current).forEach(se),[se]),Ye=T.useCallback(()=>Object.keys(oe.current).forEach(ge),[ge]),Ue=T.useCallback(()=>Object.keys(oe.current).forEach(J),[J]),pt=T.useCallback(De=>{const qe=oe.current[De];return qe?{currentTime:qe.currentTime,duration:qe.duration,paused:qe.paused}:null},[]),it=T.useCallback(async()=>{if(e)return;const De=new(window.AudioContext||window.webkitAudioContext),qe=De.createAnalyser();qe.fftSize=2048,qe.smoothingTimeConstant=h.smoothingTimeConstant,I.current=new Uint8Array(qe.frequencyBinCount),P.current=new Uint8Array(qe.frequencyBinCount),De.state==="suspended"&&await De.resume(),a(De),l(qe)},[e,h.smoothingTimeConstant]);return T.useEffect(()=>{const De=()=>{it(),window.removeEventListener("mousedown",De),window.removeEventListener("keydown",De)};return window.addEventListener("mousedown",De),window.addEventListener("keydown",De),()=>{window.removeEventListener("mousedown",De),window.removeEventListener("keydown",De)}},[it]),T.useEffect(()=>{s&&(s.smoothingTimeConstant=h.smoothingTimeConstant)},[s,h.smoothingTimeConstant]),T.useEffect(()=>{if(!e||!s||h.source!=="external"&&h.source!=="system"){o&&(o.disconnect(),u(null));return}let De=null;return(async()=>{try{e.state==="suspended"&&await e.resume();let lt;if(h.source==="system")if(window.electronAPI&&window.electronAPI.getDesktopAudioSourceId){const gt=await window.electronAPI.getDesktopAudioSourceId();if(gt)lt={audio:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:gt}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:gt}}};else throw new Error("No desktop audio source found")}else throw new Error("System audio capture is not supported in this environment");else lt={audio:B==="default"?!0:{deviceId:{exact:B}}};De=await navigator.mediaDevices.getUserMedia(lt),h.source==="system"&&De.getVideoTracks().forEach(gt=>gt.stop());const wt=e.createMediaStreamSource(De);wt.connect(s),u(wt)}catch(lt){console.error("Failed to get external audio stream:",lt)}})(),()=>{De&&De.getTracks().forEach(lt=>lt.stop())}},[e,s,h.source,B]),T.useEffect(()=>{if(!s)return;let De;const qe=()=>{s.getByteFrequencyData(I.current),s.getByteTimeDomainData(P.current);const lt=e.sampleRate,wt=s.frequencyBinCount,gt=lt/s.fftSize,Bt=zn=>{const Pe=Math.floor(zn[0]/gt),we=Math.floor(zn[1]/gt);if(h.calculationMode==="peak"){let rn=0;for(let Ot=Pe;Ot<=we&&Ot<wt;Ot++)I.current[Ot]>rn&&(rn=I.current[Ot]);return rn/255}else{let rn=0,Ot=0;for(let It=Pe;It<=we&&It<wt;It++)rn+=I.current[It],Ot++;return Ot>0?rn/Ot/255:0}},ze=Bt(h.lowRange),nt=Bt(h.midRange),Fe=Bt(h.highRange),at=Date.now(),In=Math.max(0,at-te.current.lastUpdateTime);te.current.lastUpdateTime=at;const Tn=(zn,Pe)=>{let we=zn*h.gain;const rn=te.current[Pe],Ot=te.current.peakTimes[Pe]||0;if(we>=rn)return te.current.peakTimes[Pe]=at,we;{if(at-Ot<h.holdTime)return rn;if(h.fallTime<=0)return 0;const Lt=In/h.fallTime,et=rn-Lt;return Math.max(0,isNaN(et)?0:et)}},mt={low:Tn(ze,"low"),mid:Tn(nt,"mid"),high:Tn(Fe,"high")};Y.current=mt,te.current={...mt,lastUpdateTime:at,peakTimes:te.current.peakTimes},De=requestAnimationFrame(qe)};return qe(),()=>cancelAnimationFrame(De)},[e,s,h]),f.jsx(Km.Provider,{value:{audioCtx:e,analyser:s,fftSettings:h,setFftSettings:p,fftLevels:Y.current,fftLevelsRef:Y,fftDataRef:I,timeDataRef:P,getFftLevels:()=>Y.current,connectMediaElement:z,initAudio:it,devices:A,selectedDeviceId:D,setSelectedDeviceId:L,inputDevices:b,selectedInputDeviceId:B,setSelectedInputDeviceId:Q,globalVolume:_,setVolume:re,setClipVolume:V,playAudio:K,stopAudio:ee,pauseAudio:se,resumeAudio:ge,setPlaybackRate:Z,resetAudio:J,seekAudio:Se,stopAllAudio:Ae,pauseAllAudio:Le,resumeAllAudio:Ye,resetAllAudio:Ue,getAudioInfo:pt},children:n})},Av=({audioFile:n,layerIndex:e,onSeek:a,onLoadError:s})=>{const l=T.useRef(null),o=T.useRef(null),{audioCtx:u,getAudioInfo:h}=go(),[p,g]=T.useState(null),[v,A]=T.useState("rgb(255, 94, 0)"),S=T.useRef(null),b=T.useRef(!1),M=T.useRef([]),D=T.useRef(null),L=T.useCallback(()=>{const I=document.createElement("div");I.style.display="none",I.style.color="var(--theme-color)",document.body.appendChild(I);const P=getComputedStyle(I).color;document.body.removeChild(I),P&&P!=="rgba(0, 0, 0, 0)"&&A(P)},[]);T.useEffect(()=>{L();const I=new MutationObserver(L);return I.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class"]}),()=>I.disconnect()},[L]),T.useEffect(()=>{if(!n?.path||!u)return;let I=!0;const P=async()=>{try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(n.path))throw new Error(`File not found: ${n.path}`);const Y=await fetch(`file:///${n.path}`);if(!Y.ok)throw new Error(`HTTP error! status: ${Y.status}`);const te=await Y.arrayBuffer();if(!I)return;const oe=await u.decodeAudioData(te);if(I){const W=oe.getChannelData(0),O=[],$=Math.max(1,Math.floor(W.length/500));for(let z=0;z<W.length;z+=$){let K=1,re=-1;for(let V=0;V<$&&z+V<W.length;V++){const ee=W[z+V];ee<K&&(K=ee),ee>re&&(re=ee)}O.push({min:K,max:re})}M.current=O,D.current=null,g(oe)}}catch(Y){if(!I)return;console.error("Failed to load/decode audio for waveform:",Y),s&&s(Y)}};return g(null),P(),()=>{I=!1}},[n,u,s]);const B=T.useCallback((I,P,Y,te)=>{const oe=M.current;if(!oe||oe.length===0)return;const W=Y/2,O=2,z=O+1;if(!D.current||D.current.width!==P||D.current.height!==Y){const re=document.createElement("canvas");re.width=P,re.height=Y;const V=re.getContext("2d");let ee=v;v.startsWith("rgb(")&&(ee=v.replace("rgb","rgba").replace(")",", 0.2)")),V.fillStyle=ee;const se=Math.ceil(P/z);for(let ge=0;ge<se;ge++){const Z=Math.floor(ge/se*oe.length),J=oe[Z],Se=(1+J.min)*W,Ae=Math.max(1,(J.max-J.min)*W);V.fillRect(ge*z,Se,O,Ae)}D.current=re}I.clearRect(0,0,P,Y),I.drawImage(D.current,0,0);const K=P*te;if(K>0){I.save(),I.beginPath(),I.rect(0,0,K,Y),I.clip(),I.fillStyle=v;const re=Math.ceil(P/z);for(let V=0;V<re;V++){const ee=V*z;if(ee>K)break;const se=Math.floor(V/re*oe.length),ge=oe[se],Z=(1+ge.min)*W,J=Math.max(1,(ge.max-ge.min)*W);I.fillRect(ee,Z,O,J)}I.restore()}I.fillStyle="#ffffff",I.fillRect(K,0,1,Y)},[v]);T.useEffect(()=>{const I=l.current;if(!I||!p)return;const P=I.getContext("2d"),Y=()=>{const te=I.getBoundingClientRect();(I.width!==te.width||I.height!==te.height)&&(I.width=te.width,I.height=te.height,D.current=null);const oe=I.width,W=I.height;let O=0;if(e!=null){const $=h(e);$&&$.duration>0&&(O=$.currentTime/$.duration)}B(P,oe,W,Math.max(0,Math.min(1,O))),S.current=requestAnimationFrame(Y)};return Y(),()=>{S.current&&cancelAnimationFrame(S.current)}},[p,e,h,B]);const Q=I=>{b.current=!0,U(I),window.addEventListener("mouseup",_),window.addEventListener("mousemove",U)},_=()=>{b.current=!1,window.removeEventListener("mouseup",_),window.removeEventListener("mousemove",U)},U=I=>{if(!l.current||!p)return;const P=l.current.getBoundingClientRect(),Y=I.clientX-P.left,te=P.width,W=Math.max(0,Math.min(1,Y/te))*p.duration;a&&a(W)};return f.jsx("div",{ref:o,className:"wave-player-container",style:{width:"100%",height:"35px",marginBottom:"10px",background:"transparent",borderRadius:"4px",overflow:"hidden"},onMouseDown:Q,children:f.jsx("canvas",{ref:l,style:{width:"100%",height:"100%",display:"block",cursor:"pointer"}})})},Tv=({selectedLayerIndex:n,selectedColIndex:e,clip:a,audioInfo:s,bpm:l,getFftLevels:o,onAssignAudio:u,onRemoveAudio:h,onUpdateAudioVolume:p,onUpdatePlaybackSettings:g,onSetParamSync:v,onToggleDacMirror:A,onRemoveDac:S,onRemoveEffect:b,onReorderEffects:M,onAddEffect:D,onParameterChange:L,onGeneratorParameterChange:B,onUpdateClipUiState:Q,progressRef:_,onAudioError:U})=>{const[I,P]=T.useState({}),[Y,te]=T.useState(null),{seekAudio:oe}=go(),W=T.useRef(0),O=a?.uiState||{},$=O.collapsedPanels||{},z=(ze,nt)=>{Q&&Q(n,e,{collapsedPanels:{...$,[ze]:nt}})},K=vn.useCallback(ze=>{U&&U(n,e)},[U,n,e]);if(T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(nt=>{P(Fe=>({...Fe,[nt.ip]:nt.status}))})},[]),n===null||e===null)return f.jsx("div",{className:"clip-settings-panel settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a clip to view settings."})});const re=ze=>{ze.preventDefault(),ze.stopPropagation();try{const nt=ze.dataTransfer.getData("application/json");if(!nt)return;const Fe=JSON.parse(nt);Fe&&Fe.type&&D&&D(Fe)}catch(nt){console.error("Failed to drop effect in ClipSettingsPanel:",nt)}},V=ze=>{ze.preventDefault(),ze.dataTransfer.dropEffect="copy"},ee=ze=>{te(ze)},se=(ze,nt)=>{if(ze.preventDefault(),Y===null||Y===nt)return;const Fe=Date.now();Fe-W.current<200||(W.current=Fe,M&&(M(n,e,Y,nt),te(nt)))},ge=ze=>{te(null)},{effects:Z=[],assignedDacs:J=[],playbackSettings:Se={},syncSettings:Ae={},audioFile:Le=null,audioVolume:Ye=1,type:Ue=null,generatorDefinition:pt=null,currentParams:it={},workerId:De=null}=a||{},qe=Z.length>0,lt=Ue==="generator"&&!!pt,wt=J.length>0;let gt=1;if(Se.mode==="timeline")gt=Se.duration||1;else if(Se.mode==="bpm"){const ze=l||120;gt=(Se.beats||8)*60/ze}else{const ze=Se.fps||a?.fps||30;gt=(a?.totalFrames||30)/ze}const Bt=De||(Ue==="ilda"?`ilda-${n}-${e}`:Ue==="generator"?`generator-${n}-${e}`:null);return s&&s.duration&&s.currentTime/s.duration*100,f.jsxs("div",{className:"clip-settings-panel settings-panel-base",onDrop:re,onDragOver:V,children:[f.jsx(ia,{title:"Audio",isCollapsed:!!$.audio,onToggle:ze=>z("audio",ze),children:Le?f.jsxs("div",{className:"assigned-audio-info",style:{position:"relative"},children:[f.jsx("button",{className:"remove-effect-btn",onClick:h,style:{position:"absolute",top:"-5px",right:"-5px",fontSize:"14px"},children:""}),f.jsx("div",{className:"audio-file-name",title:Le.path,style:{paddingRight:"15px",marginBottom:"8px",fontSize:"11px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:Le.name}),f.jsx(Av,{audioFile:Le,audioInfo:s,layerIndex:n,onSeek:ze=>oe(n,ze),onLoadError:K}),f.jsxs("div",{className:"audio-volume-control",style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"10px",display:"block",marginBottom:"2px"},children:["Volume: ",Math.round(Ye*100),"%"]}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ye,onChange:ze=>p(n,e,parseFloat(ze.target.value)),className:"slider_hor",style:{width:"100%",height:"4px"}})]})]}):f.jsx("button",{className:"assign-audio-btn",onClick:u,children:"Assign Audio File"})}),f.jsx(wv,{settings:Se,onUpdate:ze=>g(n,e,ze),uiState:O,onUpdateUiState:ze=>Q(n,e,ze)}),wt&&f.jsx(ia,{title:"Assigned DACs",isCollapsed:!!$.dacs,onToggle:ze=>z("dacs",ze),children:f.jsx("ul",{className:"assigned-dacs-list",children:J.map((ze,nt)=>{const Fe=I[ze.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[ze.hostName||ze.ip," - Ch ",ze.channel]}),Fe&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",Fe.playback_state===2?"PLAYING":Fe.playback_state===1?"PREPARED":"IDLE"," | Buf: ",Fe.buffer_fullness,Fe.buffer_capacity?`/${Fe.buffer_capacity}`:""," | PPS: ",Fe.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${ze.mirrorX?"active":""}`,onClick:()=>A(n,e,nt,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${ze.mirrorY?"active":""}`,onClick:()=>A(n,e,nt,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>S(nt),children:""})]},`${ze.unitID||ze.ip}-${ze.channel}-${nt}`)})})}),lt&&f.jsx(Sv,{selectedGeneratorId:pt.id,selectedGeneratorParams:it,onParameterChange:B,syncSettings:Ae,onSetParamSync:v,layerIndex:n,colIndex:e,progressRef:_,workerId:Bt,clipDuration:gt,bpm:l,getFftLevels:o,uiState:O,onUpdateUiState:ze=>Q(n,e,ze)}),f.jsx(ia,{title:"Clip Effects",isCollapsed:!!$.effects,onToggle:ze=>z("effects",ze),children:f.jsx("div",{className:"clip-effects-list",style:{minHeight:"50px"},onDrop:ge,children:qe?Z.map((ze,nt)=>f.jsx("div",{onDragOver:Fe=>se(Fe,nt),style:{marginBottom:"4px"},children:f.jsx(Qm,{effect:ze,assignedDacs:J,syncSettings:Ae,onSetParamSync:v,context:{layerIndex:n,colIndex:e,effectIndex:nt,targetType:"effect",workerId:Bt},onParamChange:(Fe,at)=>L(n,e,nt,Fe,at),onRemove:()=>b(n,e,nt),progressRef:_,clipDuration:gt,bpm:l,getFftLevels:o,uiState:O,onUpdateUiState:Fe=>Q(n,e,Fe),dragHandle:f.jsx("div",{draggable:!0,onDragStart:()=>ee(nt),style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},ze.instanceId||ze.id+nt)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Cv=({selectedLayerIndex:n,autopilotMode:e,onAutopilotChange:a,layerEffects:s,assignedDacs:l=[],onToggleDacMirror:o,onRemoveDac:u,onAddEffect:h,onRemoveEffect:p,onParamChange:g,uiState:v,onUpdateUiState:A})=>{const[S,b]=T.useState({}),M=v?.collapsedPanels||{},D=(Q,_)=>{A&&A({collapsedPanels:{...M,[Q]:_}})};if(T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(_=>{b(U=>({...U,[_.ip]:_.status}))})},[]),n===null)return f.jsx("div",{className:"settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a layer to edit settings"})});const L=Q=>{Q.preventDefault(),Q.stopPropagation();try{const _=JSON.parse(Q.dataTransfer.getData("application/json"));_&&_.id&&h(_)}catch(_){console.error("Failed to drop effect:",_)}},B=Q=>{Q.preventDefault(),Q.dataTransfer.dropEffect="copy"};return f.jsxs("div",{className:"settings-panel-base",onDrop:L,onDragOver:B,children:[l&&l.length>0&&f.jsx(ia,{title:"Assigned DACs",isCollapsed:!!M.dacs,onToggle:Q=>D("dacs",Q),children:f.jsx("ul",{className:"assigned-dacs-list",children:l.map((Q,_)=>{const U=S[Q.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[Q.hostName||Q.ip," - Ch ",Q.channel]}),U&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",U.playback_state===2?"PLAYING":U.playback_state===1?"PREPARED":"IDLE"," | Buf: ",U.buffer_fullness,U.buffer_capacity?`/${U.buffer_capacity}`:""," | PPS: ",U.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${Q.mirrorX?"active":""}`,onClick:()=>o(n,_,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${Q.mirrorY?"active":""}`,onClick:()=>o(n,_,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>u(n,_),children:""})]},`${Q.unitID||Q.ip}-${Q.channel}-${_}`)})})}),f.jsx(ia,{title:`Layer ${n+1} Autopilot`,isCollapsed:!!M.autopilot,onToggle:Q=>D("autopilot",Q),children:f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{children:"Mode"}),f.jsx("div",{className:"clip-playback-settings",children:f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:e==="off"?"active":"",onClick:()=>a("off"),children:"OFF"}),f.jsx("button",{className:e==="forward"?"active":"",onClick:()=>a("forward"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-forward-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m9.77 12.11 4.012-2.953a.647.647 0 0 0 0-1.114L9.771 5.09a.644.644 0 0 0-.971.557V6.65H2v3.9h6.8v1.003c0 .505.545.808.97.557"})})}),f.jsx("button",{className:e==="random"?"active":"",onClick:()=>a("random"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),f.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})})]})})]})}),f.jsx(ia,{title:"Layer Effects",isCollapsed:!!M.effects,onToggle:Q=>D("effects",Q),children:f.jsx("div",{className:"layer-effects-list",style:{minHeight:"50px"},children:s&&s.length>0?s.map((Q,_)=>f.jsx("div",{style:{marginBottom:"4px"},children:f.jsx(Qm,{effect:Q,onRemove:()=>p(_),onParamChange:(U,I)=>g(_,U,I),syncSettings:{},onSetParamSync:()=>{},context:{layerIndex:n,colIndex:null,effectIndex:_,targetType:"layerEffect"},uiState:v,onUpdateUiState:A,dragHandle:f.jsx("div",{draggable:!0,onDragStart:U=>{U.dataTransfer.setData("application/json",JSON.stringify({type:"effect-reorder",index:_,layerIndex:n}))},style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},Q.instanceId||_)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Mv=({message:n,visible:e})=>e?f.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#333",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:1e3,opacity:e?1:0,transition:"opacity 0.5s ease-in-out"},children:n}):null,Jm=T.createContext(null),eg=()=>T.useContext(Jm),kv=({children:n,onWorkerMessage:e})=>{const a=T.useRef(null);return a.current===null&&(a.current=new Worker(new URL(""+new URL("rendering.worker-DNKCDvdt.js",import.meta.url).href,import.meta.url),{type:"module"})),T.useEffect(()=>{const s=a.current;return e&&(s.onmessage=e),()=>{s.terminate(),e&&(s.onmessage=null)}},[e]),f.jsx(Jm.Provider,{value:a.current,children:n})},Nv=({frame:n,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p={},bpm:g=120,clipDuration:v=1,progress:A=0,previewTime:S=0,fftLevels:b={low:0,mid:0,high:0},effectStates:M=null,optimizationEnabled:D=!0,onToggleBeamEffect:L,onCycleDisplayMode:B})=>{const Q=T.useRef(null),_=eg(),U=T.useRef(`ilda-player-${Math.random()}`);return T.useEffect(()=>{const I=Q.current;if(!I||!_)return;const P=I.transferControlToOffscreen();return _.postMessage({action:"register",payload:{id:U.current,canvas:P,type:"single",data:{showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p,bpm:g,clipDuration:v,progress:A,previewTime:S,fftLevels:b,effectStates:M,optimizationEnabled:D}}},[P]),()=>{_.postMessage({action:"deregister",payload:{id:U.current}})}},[]),T.useEffect(()=>{if(!_)return;const I=n?[n]:[];_.postMessage({action:"update",payload:{id:U.current,data:{ildaFrames:I,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p,bpm:g,clipDuration:v,progress:A,previewTime:S,fftLevels:b,effectStates:M,optimizationEnabled:D}}})},[_,n,e,a,s,l,o,u,h,p,g,v,A,S,b,M,D]),f.jsxs("div",{className:"ilda-player",children:[f.jsx("h3",{children:"Selected Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:L,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:B,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:Q,width:"300",height:"300",style:{backgroundColor:"black"}})]})},Rv=vn.memo(Nv),Dv=({activeFrames:n,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:h,dacSettings:p,previewTime:g=0,fftLevels:v={low:0,mid:0,high:0},optimizationEnabled:A=!0,onToggleBeamEffect:S,onCycleDisplayMode:b})=>{const M=T.useRef(null),D=eg(),L=T.useRef(`world-preview-${Math.random()}`);return T.useEffect(()=>{const B=M.current;if(!B||!D)return;const Q=B.transferControlToOffscreen();return D.postMessage({action:"register",payload:{id:L.current,canvas:Q,type:"world",data:{showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,previewTime:g,fftLevels:v,optimizationEnabled:A}}},[Q]),()=>{D.postMessage({action:"deregister",payload:{id:L.current}})}},[]),T.useEffect(()=>{if(!D)return;const B=Object.entries(n).map(([Q,{frame:_,effects:U,layerIndex:I,syncSettings:P,bpm:Y,clipDuration:te,progress:oe,effectStates:W}])=>({frames:[_],effects:U,workerId:Q,layerIndex:I,syncSettings:P,bpm:Y,clipDuration:te,progress:oe,effectStates:W}));D.postMessage({action:"update",payload:{id:L.current,data:{worldData:B,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:h,dacSettings:p,previewTime:g,fftLevels:v,optimizationEnabled:A}}})},[D,n,e,a,s,l,o,u,h,p,g,v,A]),f.jsxs("div",{className:"world-preview",children:[f.jsx("h3",{children:"World Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:S,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:b,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:M,width:"300",height:"300",style:{backgroundColor:"black"}})]})},_v=({bpm:n,onBpmChange:e})=>{const[a,s]=T.useState([]),[l,o]=T.useState(n);T.useEffect(()=>{o(n)},[n]);const u=()=>{const p=Date.now(),g=[...a,p].slice(-4);if(s(g),g.length>=2){const v=[];for(let b=1;b<g.length;b++)v.push(g[b]-g[b-1]);const A=v.reduce((b,M)=>b+M)/v.length,S=Math.round(6e4/A);e(S)}},h=p=>{const g=parseFloat(p.target.value);o(p.target.value),!isNaN(g)&&g>0&&g<999&&e(g)};return f.jsx("div",{className:"bpm-controls",children:f.jsxs("div",{className:"bpm-display",children:[f.jsx(Kt,{id:"bpm_tap",children:f.jsx("button",{className:"bpm-tap-btn",onClick:u,children:"TAP"})}),f.jsxs("div",{className:"bpm-fine-controls",children:[f.jsx(Kt,{id:"bpm_fine_down",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.max(1,n-.1)),children:"-"})}),f.jsx(Kt,{id:"bpm_value",children:f.jsx("input",{type:"number",className:"bpm-input",value:l,onChange:h,min:"1",max:"999",step:"0.1"})}),f.jsx(Kt,{id:"bpm_fine_up",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.min(999,n+.1)),children:"+"})})]}),f.jsx("span",{className:"bpm-label",children:"BPM"})]})})},Ov=({onPlay:n,onPause:e,onStop:a,isPlaying:s,isStopped:l})=>{const o=(u,h)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"transport",label:h.toUpperCase()}))};return f.jsxs("div",{className:"transport-controls",children:[f.jsx(Kt,{id:"transport_play",children:f.jsx("button",{className:`speed-control-button ${s?"active":""}`,onClick:n,draggable:!0,onDragStart:u=>o(u,"play"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-play-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"})})})}),f.jsx(Kt,{id:"transport_pause",children:f.jsx("button",{className:`speed-control-button ${!s&&!l?"active":""}`,onClick:e,draggable:!0,onDragStart:u=>o(u,"pause"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pause-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"})})})}),f.jsx(Kt,{id:"transport_stop",children:f.jsx("button",{className:`speed-control-button ${l?"active":""}`,onClick:a,draggable:!0,onDragStart:u=>o(u,"stop"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-stop-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5"})})})})]})},Iv=({value:n,onToggle:e,label:a,onDrop:s,isAssigned:l,onContextMenu:o,className:u,...h})=>{const p=v=>{v.preventDefault(),v.dataTransfer.dropEffect="link"},g=v=>{v.preventDefault();try{const A=v.dataTransfer.getData("application/x-truelazer-param");console.log("[QuickButton] Dropped Data Raw:",A);const S=JSON.parse(A);console.log("[QuickButton] Dropped Data Parsed:",S),S&&(S.type==="toggle"||S.type==="checkbox")?s(S):console.warn("[QuickButton] Invalid data type for button:",S?.type)}catch(A){console.error("[QuickButton] Drop Error:",A)}};return f.jsx("div",{className:`quick-assign-button ${n?"active":""} ${l?"":"unassigned"} ${u||""}`.trim(),style:{cursor:l?"pointer":"default",userSelect:"none",width:"90%",opacity:l?1:.5},onDragOver:p,onDrop:g,onContextMenu:o,...h,onClick:l?e:v=>v.preventDefault(),children:f.jsx("div",{className:"button-label",title:a||"Empty",children:a||"Assign"})})},Lv=({assigns:n,onUpdateKnob:e,onToggleButton:a,onAssign:s})=>{const l=(o,u,h)=>{o.preventDefault(),window.electronAPI&&window.electronAPI.showQuickAssignContextMenu&&window.electronAPI.showQuickAssignContextMenu(u,h)};return f.jsxs("div",{className:"global-quick-assigns-panel",children:[f.jsx("div",{className:"quick-assigns-row knobs-row",children:Array.from({length:8}).map((o,u)=>{const h=!!n.knobs[u].link;return f.jsx(Kt,{id:`quick_knob_${u}`,children:f.jsx(wi,{value:n.knobs[u]?.value||0,label:n.knobs[u]?.label,isAssigned:h,onChange:p=>h&&e(u,p),onContextMenu:p=>l(p,"knob",u),onDrop:p=>{console.log(`[GlobalQuickAssigns] Knob ${u} Drop Data:`,p),s("knob",u,p)}})},`knob-${u}`)})}),f.jsx("div",{className:"quick-assigns-row buttons-row",children:Array.from({length:8}).map((o,u)=>{const h=!!n.buttons[u].link;return f.jsx(Kt,{id:`quick_btn_${u}`,children:f.jsx(Iv,{value:n.buttons[u]?.value||!1,label:n.buttons[u]?.label,isAssigned:h,onToggle:()=>a(u),onContextMenu:p=>l(p,"button",u),onDrop:p=>{console.log(`[GlobalQuickAssigns] Button ${u} Drop Data:`,p),s("button",u,p)}})},`btn-${u}`)})})]})},jv=({enabledShortcuts:n={},onOpenOutputSettings:e,quickAssigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o,renderSettings:u={},onSetRenderSetting:h})=>{const{midiInitialized:p,midiInputs:g,selectedMidiInputId:v,setSelectedMidiInputId:A,isMapping:S,startMapping:b,stopMapping:M,learningId:D,lastMidiEvent:L,setMappings:B,saveMappings:Q,exportMappings:_,importMappings:U}=jc(),I=u.settingsPanelCollapsed||{},P=(mt,zn)=>{h&&h("settingsPanelCollapsed",{...I,[mt]:zn})},{artnetInitialized:Y,isMapping:te,startMapping:oe,stopMapping:W,setMappings:O,saveMappings:$,exportMappings:z,importMappings:K,lastDmxEvent:re}=id()||{},{isMapping:V,startMapping:ee,stopMapping:se,setMappings:ge,saveMappings:Z,exportMappings:J,importMappings:Se}=ld()||{},[Ae,Le]=T.useState([]),[Ye,Ue]=T.useState(""),[pt,it]=T.useState(!1),[De,qe]=T.useState(57121),[lt,wt]=T.useState("127.0.0.1"),[gt,Bt]=T.useState(57120),[ze,nt]=T.useState(null);T.useEffect(()=>{const mt=async()=>{if(n.artnet)try{const we=await window.electronAPI.getArtnetUniverses();Le(we),we.length>0&&Ue(we[0].id)}catch(we){console.error("Failed to fetch Art-Net universes:",we)}},zn=async()=>{if(n.osc)try{if((await window.electronAPI.initializeOsc({localPort:De,remoteAddress:lt,remotePort:gt})).success)return it(!0),window.electronAPI.onOscMessageReceived(({oscMessage:Ot})=>{nt(Ot)})}catch(we){console.error("Failed to initialize OSC:",we)}};let Pe=()=>{};return mt(),zn().then(we=>{typeof we=="function"&&(Pe=we)}),()=>{typeof Pe=="function"&&Pe()}},[n]);const Fe=mt=>A(mt.target.value),at=()=>S?M():b(),In=()=>te?W():oe(),Tn=()=>V?se():ee();return f.jsxs("div",{className:"settings-panel settings-panel-base",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"Global Settings"})}),a&&f.jsx(ia,{title:"Quick Assigns",isCollapsed:!!I.quickAssigns,onToggle:mt=>P("quickAssigns",mt),children:f.jsx(Lv,{assigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o})}),f.jsxs(ia,{title:"Channel/DAC Settings",isCollapsed:!!I.dacSettings,onToggle:mt=>P("dacSettings",mt),children:[f.jsx("p",{className:"info-text",children:"Output routing and safety zones configuration."}),f.jsx("button",{className:"small-btn",style:{width:"100%",marginTop:"5px"},onClick:e,children:"Open Output Settings"})]}),f.jsxs(ia,{title:"Processing",isCollapsed:!!I.processing,onToggle:mt=>P("processing",mt),children:[f.jsxs("div",{className:"param-editor",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("label",{className:"param-label",style:{fontSize:"11px"},children:"Point Optimization"}),f.jsx("input",{type:"checkbox",checked:u.optimizationEnabled,onChange:mt=>h("optimizationEnabled",mt.target.checked)})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:"Optimizes geometry (interpolation/dwell) before applying effects. Fixes lines in Delay effect but increases point count."})]}),(n.midi||n.artnet||n.osc||n.keyboard)&&f.jsxs("div",{className:"shortcuts-settings-panel",children:[n.keyboard&&f.jsx(ia,{title:"Keyboard Shortcuts",isCollapsed:!!I.keyboard,onToggle:mt=>P("keyboard",mt),children:f.jsxs("div",{className:"keyboard-config",children:[f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${V?"active":""}`,onClick:Tn,style:{backgroundColor:V?"var(--theme-color)":"",gridColumn:"span 2"},children:V?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:Z,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:J,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:Se,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>ge({}),children:"Clear"})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:'Assign keys to buttons/sliders by activating "Start Mapping" and clicking a control.'})]})}),n.midi&&f.jsx(ia,{title:"MIDI Shortcuts",isCollapsed:!!I.midi,onToggle:mt=>P("midi",mt),children:p?f.jsxs("div",{className:"midi-config",children:[f.jsx("select",{className:"param-select",value:v,onChange:Fe,style:{marginBottom:"8px",width:"100%"},children:g.map(mt=>f.jsx("option",{value:mt.id,children:mt.name},mt.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${S?"active":""}`,onClick:at,style:{backgroundColor:S?"var(--theme-color)":"",gridColumn:"span 2"},children:S?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:Q,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:_,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:U,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>B({}),children:"Clear"})]}),L&&f.jsxs("div",{className:"last-event-status",children:[L.type," ",L.note||L.controller," (CH",L.channel,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing MIDI..."})}),n.artnet&&f.jsx(ia,{title:"ArtNet Shortcuts",isCollapsed:!!I.artnet,onToggle:mt=>P("artnet",mt),children:Y?f.jsxs("div",{className:"artnet-config",children:[f.jsx("select",{className:"param-select",value:Ye,onChange:mt=>{Ue(mt.target.value);const zn=parseInt(mt.target.value.replace("universe-",""));window.electronAPI&&window.electronAPI.listenArtnetUniverse&&window.electronAPI.listenArtnetUniverse(zn)},style:{marginBottom:"8px",width:"100%"},children:Ae.map(mt=>f.jsx("option",{value:mt.id,children:mt.name},mt.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${te?"active":""}`,onClick:In,style:{backgroundColor:te?"var(--theme-color)":"",gridColumn:"span 2"},children:te?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:$,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:z,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:K,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>O({}),children:"Clear"})]}),re&&f.jsxs("div",{className:"last-event-status",children:["UNIV ",re.universe," CH ",re.channel+1," (Val: ",re.value,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing Art-Net..."})}),n.osc&&f.jsx(ia,{title:"OSC Shortcuts",isCollapsed:!!I.osc,onToggle:mt=>P("osc",mt),children:f.jsx("div",{className:"osc-config",children:f.jsxs("p",{className:"info-text",children:["Listening on port: ",De]})})})]})]})},Uv=({show:n,title:e,initialValue:a,onSave:s,onClose:l})=>{const[o,u]=T.useState(a||"");if(T.useEffect(()=>{n&&u(a||"")},[n,a]),!n)return null;const h=()=>{s(o),l()},p=g=>{g.key==="Enter"&&h(),g.key==="Escape"&&l()};return f.jsx("div",{className:"shortcuts-modal-overlay",style:{pointerEvents:"auto"},children:f.jsxs("div",{className:"shortcuts-modal-content",style:{maxWidth:"400px"},children:[f.jsx("h3",{children:e||"Rename"}),f.jsxs("div",{className:"settings-section",style:{border:"none"},children:[f.jsx("input",{type:"text",value:o,onChange:g=>u(g.target.value),onKeyDown:p,autoFocus:!0,style:{width:"100%",padding:"8px",backgroundColor:"#1a1a1a",color:"white",border:"1px solid var(--theme-color)",borderRadius:"4px",marginBottom:"15px"}}),f.jsxs("div",{className:"button-row",style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[f.jsx("button",{onClick:l,children:"Cancel"}),f.jsx("button",{onClick:h,style:{backgroundColor:"var(--theme-color)",color:"black"},children:"Save"})]})]})]})})},Bv=({safetyZones:n,outputArea:e,testLineY:a,testLineEnabled:s,transformationEnabled:l,transformationMode:o,flipX:u,flipY:h,onUpdateSafetyZones:p,onUpdateOutputArea:g,selectedZoneIndex:v,onSelectZone:A,gridSize:S=20,snapToGrid:b=!1})=>{const M=T.useRef(null),[D,L]=T.useState(null),B=(O,$,z)=>{O.strokeStyle="#333",O.lineWidth=1,O.beginPath();for(let K=0;K<=S;K++){const re=K/S,V=re*$,ee=re*z;O.moveTo(V,0),O.lineTo(V,z),O.moveTo(0,ee),O.lineTo($,ee)}O.stroke(),O.strokeStyle="#666",O.lineWidth=2,O.beginPath(),O.moveTo($/2,0),O.lineTo($/2,z),O.moveTo(0,z/2),O.lineTo($,z/2),O.stroke(),O.fillStyle="#aaa",O.font="10px monospace",O.fillText("0,0",5,12),O.fillText("1,0",$-25,12),O.fillText("0,1",5,z-5),O.fillText("1,1",$-25,z-5)},Q=(O,$,z,K=!1,re=!1)=>{const{x:V,y:ee,w:se,h:ge}=$;if(O.fillStyle=z,O.fillRect(V,ee,se,ge),O.strokeStyle=K?"#fff":re?"#0089ff":"#ff0000",O.lineWidth=K?2:1,O.strokeRect(V,ee,se,ge),K||re){O.fillStyle="#fff";const J=(Le,Ye)=>O.fillRect(Le-6/2,Ye-6/2,6,6);J(V,ee),J(V+se,ee),J(V,ee+ge),J(V+se,ee+ge);const Se=4;O.fillStyle="#ccc";const Ae=(Le,Ye)=>O.fillRect(Le-Se/2,Ye-Se/2,Se,Se);Ae(V+se/2,ee),Ae(V+se/2,ee+ge),Ae(V,ee+ge/2),Ae(V+se,ee+ge/2)}},_=()=>{const O=M.current;if(!O)return;const $=O.getContext("2d"),{width:z,height:K}=O;if($.clearRect(0,0,z,K),B($,z,K),l&&e&&Q($,{x:e.x*z,y:e.y*K,w:e.w*z,h:e.h*K},"rgba(0, 137, 255, 0.2)",!1,!0),n.forEach((re,V)=>{Q($,{x:re.x*z,y:re.y*K,w:re.w*z,h:re.h*K},"rgba(255, 0, 0, 0.3)",V===v)}),s){let re=a,V=0,ee=1;if(l&&e){if(o==="scale")V=e.x,ee=e.x+e.w,re=e.y+re*e.h;else if(o==="crop"){if(re<e.y||re>e.y+e.h)return;V=Math.max(0,e.x),ee=Math.min(1,e.x+e.w)}}const se=re*K,ge=V*z,Z=ee*z;let J=[[ge,Z]];n&&n.length>0&&n.forEach(Se=>{const Ae=Se.y*K,Le=Se.h*K,Ye=Se.x*z,Ue=Se.w*z;if(se>=Ae&&se<=Ae+Le){const pt=[];J.forEach(it=>{const[De,qe]=it,lt=Ye,wt=Ye+Ue;wt<=De||lt>=qe?pt.push(it):(lt>De&&pt.push([De,lt]),wt<qe&&pt.push([wt,qe]))}),J=pt}}),$.strokeStyle="#00ff00",$.lineWidth=2,$.beginPath(),J.forEach(Se=>{$.moveTo(Se[0],se),$.lineTo(Se[1],se)}),$.stroke()}};T.useEffect(()=>{_()},[n,e,a,s,l,v,S,u,h]);const U=O=>{const $=M.current.getBoundingClientRect();return{x:(O.clientX-$.left)/$.width,y:(O.clientY-$.top)/$.height}},I=(O,$,z)=>{if(!z)return null;const K=.03;return Math.abs(O-z.x)<K&&Math.abs($-z.y)<K?"nw":Math.abs(O-(z.x+z.w))<K&&Math.abs($-z.y)<K?"ne":Math.abs(O-z.x)<K&&Math.abs($-(z.y+z.h))<K?"sw":Math.abs(O-(z.x+z.w))<K&&Math.abs($-(z.y+z.h))<K?"se":Math.abs($-z.y)<K&&O>=z.x&&O<=z.x+z.w?"n":Math.abs($-(z.y+z.h))<K&&O>=z.x&&O<=z.x+z.w?"s":Math.abs(O-z.x)<K&&$>=z.y&&$<=z.y+z.h?"w":Math.abs(O-(z.x+z.w))<K&&$>=z.y&&$<=z.y+z.h?"e":null},P=(O,$,z)=>z?O>=z.x&&O<=z.x+z.w&&$>=z.y&&$<=z.y+z.h:!1,Y=O=>{const{x:$,y:z}=U(O);if(v!==null&&n[v]){const K=n[v],re=I($,z,K);if(re){L({type:"zone",index:v,handle:re,startX:$,startY:z,originalRect:{...K}});return}}for(let K=n.length-1;K>=0;K--){const re=n[K];if(re&&P($,z,re)){A(K);const V=I($,z,re);L({type:"zone",index:K,handle:V||"move",startX:$,startY:z,originalRect:{...re}});return}}if(l&&e){const K=I($,z,e);if(K){L({type:"output",handle:K,startX:$,startY:z,originalRect:{...e}}),A(null);return}if(P($,z,e)){L({type:"output",handle:"move",startX:$,startY:z,originalRect:{...e}}),A(null);return}}A(null)},te=O=>{if(!b)return O;const $=1/S;return Math.round(O/$)*$},oe=O=>{if(!D)return;const{x:$,y:z}=U(O),K=$-D.startX,re=z-D.startY,V=(ee,se,ge,Z)=>{let J={...ee};if(se==="move")J.x=te(ee.x+ge),J.y=te(ee.y+Z);else{if(se.includes("w")){const Se=te(ee.x+ge);J.w=ee.x+ee.w-Se,J.x=Se}if(se.includes("e")){const Se=te(ee.x+ee.w+ge);J.w=Se-J.x}if(se.includes("n")){const Se=te(ee.y+Z);J.h=ee.y+ee.h-Se,J.y=Se}if(se.includes("s")){const Se=te(ee.y+ee.h+Z);J.h=Se-J.y}}return J.w<.01&&(J.w=.01),J.h<.01&&(J.h=.01),J};if(D.type==="zone"){const ee=V(D.originalRect,D.handle,K,re);p(D.index,ee)}else if(D.type==="output"){const ee=V(D.originalRect,D.handle,K,re);g(ee)}},W=()=>{L(null)};return f.jsx("div",{className:"output-canvas-container",style:{width:"100%",height:"100%"},children:f.jsx("canvas",{ref:M,width:600,height:600,style:{width:"100%",height:"100%",display:"block"},className:"output-canvas",onMouseDown:Y,onMouseMove:oe,onMouseUp:W,onMouseLeave:W})})},Fv=({show:n,onClose:e,dacs:a=[],dacSettings:s={},onUpdateDacSettings:l})=>{const[o,u]=T.useState(null),[h,p]=T.useState(null),[g,v]=T.useState(20),[A,S]=T.useState(!1),b=T.useMemo(()=>{const _=[];return a.forEach(U=>{U.channels&&U.channels.length>0?U.channels.forEach(I=>{_.push({id:`${U.ip}:${I.serviceID}`,displayName:`${U.hostName||U.unitID||"DAC"} : ${I.name||`CH ${I.serviceID}`}`,ip:U.ip,channel:I.serviceID,dacName:U.hostName||U.unitID})}):_.push({id:`${U.ip}:0`,displayName:U.hostName||U.unitID||`DAC ${U.ip}`,ip:U.ip,channel:0,dacName:U.hostName||U.unitID})}),_},[a]);if(T.useEffect(()=>{b.length>0&&!o&&u(b[0].id)},[b,o]),!n)return null;const M=s[o]||{safetyZones:[],outputArea:{x:.1,y:.1,w:.8,h:.8},transformationEnabled:!1,transformationMode:"crop",testLineEnabled:!1,testLineY:.5,flipX:!1,flipY:!1},D=_=>{o&&l(o,{...M,..._})},L=()=>{const _={x:.4,y:.4,w:.2,h:.2};D({safetyZones:[...M.safetyZones,_]}),p(M.safetyZones.length)},B=()=>{D({safetyZones:[]}),p(null)},Q=(_,U)=>{const I=[...M.safetyZones];I[_]=U,D({safetyZones:I})};return f.jsx("div",{className:"output-settings-modal-overlay",children:f.jsxs("div",{className:"output-settings-modal-content",children:[f.jsxs("div",{className:"output-settings-header",children:[f.jsx("h2",{children:"Output Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:"Close"})]}),f.jsxs("div",{className:"output-settings-body",children:[f.jsx("div",{className:"output-settings-col",children:f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Available Outputs"}),f.jsxs("ul",{className:"dac-list",children:[b.length===0?f.jsx("li",{style:{color:"#666",fontStyle:"italic"},children:"No Outputs detected"}):null,b.map((_,U)=>f.jsxs("li",{className:`dac-list-item ${o===_.id?"selected":""}`,onClick:()=>u(_.id),children:[f.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9em"},children:_.displayName}),f.jsx("span",{style:{fontSize:"0.7em",color:"#888"},children:_.ip})]},_.id))]})]})}),f.jsxs("div",{className:"output-settings-col canvas-col",children:[f.jsxs("div",{className:"canvas-toolbar",children:[f.jsx("button",{className:"tool-btn",onClick:L,title:"Add Safety Zone",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),f.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})]})}),f.jsx("button",{className:`tool-btn ${M.transformationEnabled?"active":""}`,onClick:()=>D({transformationEnabled:!M.transformationEnabled}),title:"Toggle Output Transformation",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-border-outer",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M7.5 1.906v.938h1v-.938zm0 1.875v.938h1V3.78h-1zm0 1.875v.938h1v-.938zM1.906 8.5h.938v-1h-.938zm1.875 0h.938v-1H3.78v1zm1.875 0h.938v-1h-.938zm2.813 0v-.031H8.5V7.53h-.031V7.5H7.53v.031H7.5v.938h.031V8.5zm.937 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zM7.5 9.406v.938h1v-.938zm0 1.875v.938h1v-.938zm0 1.875v.938h1v-.938z"}),f.jsx("path",{d:"M0 0v16h16V0zm1 1h14v14H1z"})]})}),f.jsx("button",{className:`tool-btn ${M.testLineEnabled?"active":""}`,onClick:()=>D({testLineEnabled:!M.testLineEnabled}),title:"Toggle Test Line",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),f.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})]})}),f.jsx("span",{style:{width:1,background:"#555",margin:"0 5px"}}),f.jsx("button",{className:`tool-btn ${A?"active":""}`,onClick:()=>S(!A),title:"Snap to Grid",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-magnet-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M15 12h-4v3h4zM5 12H1v3h4zM0 8a8 8 0 1 1 16 0v8h-6V8a2 2 0 1 0-4 0v8H0z"})})}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:5},children:[f.jsx("span",{style:{fontSize:10,color:"#aaa"},children:"Grid:"}),f.jsx("input",{type:"number",min:"5",max:"100",value:g,onChange:_=>v(parseInt(_.target.value)),className:"param-number-input",style:{width:40}})]})]}),f.jsx(Bv,{safetyZones:M.safetyZones,outputArea:M.outputArea,testLineY:M.testLineY,testLineEnabled:M.testLineEnabled,transformationEnabled:M.transformationEnabled,transformationMode:M.transformationMode,flipX:M.flipX,flipY:M.flipY,onUpdateSafetyZones:Q,onUpdateOutputArea:_=>D({outputArea:_}),selectedZoneIndex:h,onSelectZone:p,gridSize:g,snapToGrid:A})]}),f.jsx("div",{className:"output-settings-col",children:o?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Output Transformation"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Editing"}),f.jsx("input",{type:"checkbox",checked:M.transformationEnabled,onChange:_=>D({transformationEnabled:_.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip X"}),f.jsx("input",{type:"checkbox",checked:M.flipX||!1,onChange:_=>D({flipX:_.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip Y"}),f.jsx("input",{type:"checkbox",checked:M.flipY||!1,onChange:_=>D({flipY:_.target.checked})})]}),M.transformationEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{style:{flex:1},children:"Mode"}),f.jsxs("select",{className:"param-select",value:M.transformationMode,onChange:_=>D({transformationMode:_.target.value}),children:[f.jsx("option",{value:"crop",children:"Crop"}),f.jsx("option",{value:"scale",children:"Scale"})]})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Safety Zones"}),f.jsxs("div",{className:"control-row",style:{justifyContent:"space-between",marginBottom:5},children:[f.jsx("button",{className:"small-btn",onClick:L,children:"Add New"}),f.jsx("button",{className:"small-btn clear",onClick:B,children:"Clear All"})]}),f.jsx("div",{className:"zone-list",children:M.safetyZones.map((_,U)=>f.jsxs("div",{className:`zone-item ${h===U?"selected":""}`,onClick:()=>p(U),children:[f.jsxs("span",{children:["Zone ",U+1]}),f.jsx("button",{className:"delete-zone-btn",onClick:I=>{I.stopPropagation(),h===U&&p(null);const P=M.safetyZones.filter((Y,te)=>te!==U);D({safetyZones:P})},children:""})]},U))}),h!==null&&f.jsxs("div",{style:{marginTop:10,borderTop:"1px solid #333",paddingTop:5},children:[f.jsx("label",{children:"Selected Zone Properties"}),f.jsx("div",{style:{fontSize:"0.8em",color:"#aaa"},children:"Select and drag zone on canvas to resize."})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Test Output"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Test Line"}),f.jsx("input",{type:"checkbox",checked:M.testLineEnabled,onChange:_=>D({testLineEnabled:_.target.checked})})]}),M.testLineEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{children:"Y Position"}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:M.testLineY,onChange:_=>D({testLineY:parseFloat(_.target.value)}),className:"param-slider"})]})]})]}):f.jsx("div",{style:{padding:20,textAlign:"center",color:"#666"},children:"Select an Output to configure settings"})})]})]})})},tg=()=>{const n=go();return n||{}},Pv=({show:n,onClose:e,initialTab:a="output"})=>{const s=go(),{fftSettings:l,setFftSettings:o,inputDevices:u,selectedInputDeviceId:h,setSelectedInputDeviceId:p}=s||{},{devices:g,selectedDeviceId:v,setSelectedDeviceId:A,globalVolume:S,setVolume:b}=tg(),[M,D]=T.useState(a);if(vn.useEffect(()=>{n&&D(a)},[n,a]),!n)return null;if(!l)return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{padding:"20px",color:"red",border:"1px solid red",background:"#222"},children:[f.jsx("h3",{children:"Error"}),f.jsx("p",{children:"Audio Context is not available."}),f.jsx("p",{children:"Please restart the application or report this bug."}),f.jsx("button",{onClick:e,style:{marginTop:"10px",padding:"5px 10px"},children:"Close"})]}),f.jsx("style",{children:`
                    .modal-overlay {
                        position: fixed;
                        top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 10000;
                    }
                `})]});const L=(B,Q,_)=>{const U={...l},I=`${B}Range`;U[I][Q]=parseFloat(_),o(U)};return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Audio Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsxs("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"},children:[f.jsx("button",{className:`tab-btn ${M==="output"?"active":""}`,onClick:()=>D("output"),style:{padding:"8px 15px",background:"none",border:"none",color:M==="output"?"var(--theme-color)":"#888",borderBottom:M==="output"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"Audio Output"}),f.jsx("button",{className:`tab-btn ${M==="fft"?"active":""}`,onClick:()=>D("fft"),style:{padding:"8px 15px",background:"none",border:"none",color:M==="fft"?"var(--theme-color)":"#888",borderBottom:M==="fft"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"FFT Settings"})]}),f.jsxs("div",{className:"modal-body",children:[M==="output"&&f.jsxs("div",{className:"audio-output-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Device"}),f.jsx("select",{className:"param-select",value:v,onChange:B=>A(B.target.value),style:{width:"100%",padding:"5px"},children:g.map(B=>f.jsx("option",{value:B.deviceId,children:B.label||`Device ${B.deviceId.slice(0,5)}`},B.deviceId))})]}),f.jsxs("div",{className:"settings-row",style:{textAlign:"center"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Volume"}),f.jsx("div",{style:{display:"flex",justifyContent:"center"},children:f.jsx(wi,{value:S,onChange:b,label:"MASTER",isAssigned:!0,size:60})})]})]}),M==="fft"&&f.jsxs("div",{className:"fft-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Source"}),f.jsxs("select",{className:"param-select",value:l.source,onChange:B=>o({...l,source:B.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"external",children:"External (Microphone/Loopback)"}),f.jsx("option",{value:"system",children:"System Audio (Loopback)"}),f.jsx("option",{value:"clip",children:"Clip FFT (Audio from active clips)"})]})]}),l.source==="external"&&f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Input Device"}),f.jsxs("select",{className:"param-select",value:h,onChange:B=>p(B.target.value),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"default",children:"Default Input"}),u.map(B=>f.jsx("option",{value:B.deviceId,children:B.label||`Input ${B.deviceId.slice(0,5)}`},B.deviceId))]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Calculation Mode"}),f.jsxs("select",{className:"param-select",value:l.calculationMode||"average",onChange:B=>o({...l,calculationMode:B.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"average",children:"Average (Smooth)"}),f.jsx("option",{value:"peak",children:"Peak (Transient/Punchy)"})]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Ranges (Hz)"}),f.jsxs("div",{className:"range-controls",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"10px",alignItems:"center"},children:[f.jsx("span",{children:"Low:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.lowRange[0],onChange:B=>L("low",0,B.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.lowRange[1],onChange:B=>L("low",1,B.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"Mid:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.midRange[0],onChange:B=>L("mid",0,B.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.midRange[1],onChange:B=>L("mid",1,B.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"High:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.highRange[0],onChange:B=>L("high",0,B.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.highRange[1],onChange:B=>L("high",1,B.target.value),style:{width:"60px"}})]})]})]}),f.jsxs("div",{className:"settings-row",style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"GAIN"}),f.jsx(wi,{value:l.gain/5,onChange:B=>o({...l,gain:B*5}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"SMOOTH"}),f.jsx(wi,{value:l.smoothingTimeConstant||.8,onChange:B=>o({...l,smoothingTimeConstant:B}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"HOLD"}),f.jsx(wi,{value:l.holdTime/1e3,onChange:B=>o({...l,holdTime:B*1e3}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"FALL"}),f.jsx(wi,{value:l.fallTime/2e3,onChange:B=>o({...l,fallTime:B*2e3}),isAssigned:!0,size:40})]})]})]})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]})},zv=({missingFiles:n,onRelocate:e,onClose:a})=>!n||n.length===0?null:f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{width:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Missing Files"}),f.jsx("button",{className:"close-btn",onClick:a,children:""})]}),f.jsxs("div",{className:"modal-body",style:{overflowY:"auto",flex:1},children:[f.jsx("p",{style:{marginBottom:"15px",color:"#ccc",fontSize:"0.9em"},children:"The following files could not be found. Please locate one of them to update the path for all matching files in the same directory."}),f.jsx("ul",{style:{listStyle:"none",padding:0},children:n.map((s,l)=>f.jsxs("li",{style:{background:"#333",padding:"10px",marginBottom:"5px",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{overflow:"hidden"},children:[f.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9em"},children:s.fileName}),f.jsx("div",{style:{fontSize:"0.8em",color:"#888",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"350px"},children:s.filePath})]}),f.jsx("button",{className:"small-btn",onClick:()=>e(s),style:{marginLeft:"10px",whiteSpace:"nowrap"},children:"Locate"})]},l))})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex; justify-content: center; align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .small-btn {
                    background: var(--theme-color);
                    color: black;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: bold;
                }
                .small-btn:hover {
                    opacity: 0.9;
                }
            `})]});class Gv extends vn.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,a){console.error("Uncaught error:",e,a)}render(){return this.state.hasError?f.jsx("h1",{children:"Something went wrong."}):this.props.children}}const Of=32,q0=8;function ll(n,e,a,s){for(let l=0;l<s;l++)n.setUint8(e+l,l<a.length?a.charCodeAt(l):0)}function ng(n){let e=Of;n.forEach(o=>{e+=Of;const u=o.points?o.points.length:0;e+=u*q0});const a=new ArrayBuffer(e),s=new DataView(a);let l=0;return n.forEach((o,u)=>{const h=o.points||[],p=h.length;ll(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),ll(s,l+8,o.frameName||"TrueLazr",8),ll(s,l+16,o.companyName||"Gemini",8),s.setUint16(l+24,p,!1),s.setUint16(l+26,u,!1),s.setUint16(l+28,n.length,!1),s.setUint8(l+30,o.scannerHead||0),s.setUint8(l+31,0),l+=Of;for(let g=0;g<p;g++){const v=h[g];let A=Math.max(-32768,Math.min(32767,Math.round((v.x||0)*32767))),S=Math.max(-32768,Math.min(32767,Math.round((v.y||0)*32767)));s.setInt16(l,A,!1),s.setInt16(l+2,S,!1);let b=0;v.blanking&&(b|=64),g===p-1&&(b|=128),s.setUint8(l+4,b);let M=0,D=0,L=0;if(!v.blanking){const B=v.r??0,Q=v.g??0,_=v.b??0;B<=1&&Q<=1&&_<=1&&(B>0||Q>0||_>0)?(M=Math.round(B*255),D=Math.round(Q*255),L=Math.round(_*255)):(M=Math.round(B),D=Math.round(Q),L=Math.round(_))}s.setUint8(l+5,Math.max(0,Math.min(255,L))),s.setUint8(l+6,Math.max(0,Math.min(255,D))),s.setUint8(l+7,Math.max(0,Math.min(255,M))),l+=q0}}),ll(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),ll(s,l+8,"EOF",8),ll(s,l+16,"TrueLazr",8),s.setUint16(l+24,0,!1),s.setUint16(l+26,0,!1),s.setUint16(l+28,0,!1),s.setUint8(l+30,0),s.setUint8(l+31,0),a}const X0=Object.freeze(Object.defineProperty({__proto__:null,framesToIlda:ng},Symbol.toStringTag,{value:"Module"})),If=[{r:255,g:0,b:0},{r:255,g:17,b:0},{r:255,g:34,b:0},{r:255,g:51,b:0},{r:255,g:68,b:0},{r:255,g:85,b:0},{r:255,g:102,b:0},{r:255,g:119,b:0},{r:255,g:136,b:0},{r:255,g:153,b:0},{r:255,g:170,b:0},{r:255,g:187,b:0},{r:255,g:204,b:0},{r:255,g:221,b:0},{r:255,g:238,b:0},{r:255,g:255,b:0},{r:255,g:255,b:0},{r:238,g:255,b:0},{r:204,g:255,b:0},{r:170,g:255,b:0},{r:136,g:255,b:0},{r:102,g:255,b:0},{r:68,g:255,b:0},{r:34,g:255,b:0},{r:0,g:255,b:0},{r:0,g:255,b:34},{r:0,g:255,b:68},{r:0,g:255,b:102},{r:0,g:255,b:136},{r:0,g:255,b:170},{r:0,g:255,b:204},{r:0,g:255,b:238},{r:0,g:136,b:255},{r:0,g:119,b:255},{r:0,g:102,b:255},{r:0,g:102,b:255},{r:0,g:85,b:255},{r:0,g:68,b:255},{r:0,g:68,b:255},{r:0,g:34,b:255},{r:0,g:0,b:255},{r:34,g:0,b:255},{r:68,g:0,b:255},{r:102,g:0,b:255},{r:136,g:0,b:255},{r:170,g:0,b:255},{r:204,g:0,b:255},{r:238,g:0,b:255},{r:255,g:0,b:255},{r:255,g:34,b:255},{r:255,g:68,b:255},{r:255,g:102,b:255},{r:255,g:136,b:255},{r:255,g:170,b:255},{r:255,g:204,b:255},{r:255,g:238,b:255},{r:255,g:255,b:255},{r:255,g:238,b:238},{r:255,g:204,b:204},{r:255,g:170,b:170},{r:255,g:136,b:136},{r:255,g:102,b:102},{r:255,g:68,b:68},{r:0,g:34,b:34}];function Hv(n,e,a,s,l=If){const o=[],u=new DataView(n);let h=0;try{for(let p=0;p<s;p++){if(e===2){h+=a;continue}let g,v,A=0,S,b,M,D;e===0||e===4?(g=u.getInt16(h,!1)/32768,v=u.getInt16(h+2,!1)/32768,A=u.getInt16(h+4,!1)/32768,D=u.getUint8(h+6)):(g=u.getInt16(h,!1)/32768,v=u.getInt16(h+2,!1)/32768,D=u.getUint8(h+4));const L=(D&64)!==0,B=(D&128)!==0;if(e===0||e===1){const Q=u.getUint8(h+(e===0?7:5)),_=l||If,U=_[Q%_.length]||If[0];S=U.r,b=U.g,M=U.b}else(e===4||e===5)&&(M=u.getUint8(h+(e===4?7:5)),b=u.getUint8(h+(e===4?8:6)),S=u.getUint8(h+(e===4?9:7)));if(o.push({x:g,y:v,z:A,r:S===void 0?255:S,g:b===void 0?255:b,b:M===void 0?255:M,blanking:L,lastPoint:B}),h+=a,B)break}}catch(p){console.warn("Parser: Error reading points:",p)}return o}const Yv=n=>{const e=[],a=new DataView(n);let s=0,l=null,o=null;for(;s+32<=a.byteLength;){if(String.fromCharCode(a.getUint8(s),a.getUint8(s+1),a.getUint8(s+2),a.getUint8(s+3))!=="ILDA"){s++;continue}const h=a.getUint8(s+7);o===null&&(o=h);const p=String.fromCharCode(...new Uint8Array(n,s+8,8)).trim(),g=String.fromCharCode(...new Uint8Array(n,s+16,8)).trim();let v=a.getUint16(s+24,!1);const A=a.getUint16(s+26,!1),S=a.getUint16(s+28,!1),b=a.getUint8(s+30);let M;switch(h){case 0:M=8;break;case 1:M=6;break;case 2:M=3;break;case 4:M=10;break;case 5:M=8;break;default:s+=32;continue}if(h===2){l=[];const B=s+32;for(let Q=0;Q<v;Q++){const _=a.getUint8(B+Q*3),U=a.getUint8(B+Q*3+1),I=a.getUint8(B+Q*3+2);l.push({r:_,g:U,b:I})}}let D=v*M,L=32+D;if(s+L>n.byteLength)break;if(v>0&&h!==2){const B=n.slice(s+32,s+32+D),Q=Hv(B,h,M,v,l);e.push({frameName:p,companyName:g,frameNumber:A,totalFrames:S,scannerHead:b,points:Q,formatCode:h})}s+=L}return{frames:e,firstFormatCode:o,colorPalette:l}};function ol(n,e=!1,a=.5){if(!n||n.length<2)return n||[];const s=[],l=n.length,o=h=>e?n[(h+l)%l]:n[Math.max(0,Math.min(l-1,h))],u=e?l:l-1;for(let h=0;h<u;h++){const p=o(h-1),g=o(h),v=o(h+1),A=o(h+2);let S,b;!e&&l===2?(S={x:g.x+(v.x-g.x)/3,y:g.y+(v.y-g.y)/3},b={x:v.x-(v.x-g.x)/3,y:v.y-(v.y-g.y)/3}):(S={x:g.x+(v.x-p.x)*a/3,y:g.y+(v.y-p.y)*a/3},b={x:v.x-(A.x-g.x)*a/3,y:v.y-(A.y-g.y)*a/3}),h===0&&s.push({...g}),s.push(S),s.push(b),s.push({...v})}return s}const Vv=({onBack:n})=>{const[e,a]=T.useState("select"),[s,l]=T.useState("#00ff00"),[o,u]=T.useState("simple"),[h,p]=T.useState(!1),[g,v]=T.useState(1),[A,S]=T.useState(1),[b,M]=T.useState(0),[D,L]=T.useState(!1),[B,Q]=T.useState(!0),[_,U]=T.useState([[]]),[I,P]=T.useState(null),[Y,te]=T.useState([[[]]]),[oe,W]=T.useState(0),[O,$]=T.useState([]),[z,K]=T.useState([]),[re,V]=T.useState([]),[ee,se]=T.useState(null),[ge,Z]=T.useState(null),[J,Se]=T.useState(.6),[Ae,Le]=T.useState({x:0,y:0}),[Ye,Ue]=T.useState(!0),[pt,it]=T.useState(!1),[De,qe]=T.useState(25),[lt,wt]=T.useState(!1),[gt,Bt]=T.useState(!1),[ze,nt]=T.useState(!1),[Fe,at]=T.useState({visible:!1,x:0,y:0,target:null}),[In,Tn]=T.useState(0),[mt,zn]=T.useState(-1),[Pe,we]=T.useState(0),[rn,Ot]=T.useState(0),[It,Lt]=T.useState(!0),[et,$r]=T.useState(!0),[la,qa]=T.useState(0),[Cn,cr]=T.useState("fps"),[Gn,ka]=T.useState(1),[Mn,Wr]=T.useState(120),[Zn,$e]=T.useState(2),[ct,Tr]=T.useState(30),[ha,oa]=T.useState(8),Mi=T.useRef(Cn),Na=T.useRef(Gn),Cr=T.useRef(Mn),Ra=T.useRef(Zn),Xa=T.useRef(ct),kn=T.useRef(ha),Ut=T.useRef(g),Wt=T.useRef(la);T.useEffect(()=>{Mi.current=Cn},[Cn]),T.useEffect(()=>{Na.current=Gn},[Gn]),T.useEffect(()=>{Cr.current=Mn},[Mn]),T.useEffect(()=>{Ra.current=Zn},[Zn]),T.useEffect(()=>{Xa.current=ct},[ct]),T.useEffect(()=>{kn.current=ha},[ha]),T.useEffect(()=>{Ut.current=g},[g]),T.useEffect(()=>{Wt.current=la},[la]);const sn=T.useRef(null),Zr=T.useRef(null),kt=T.useRef({x:0,y:0}),ca=T.useRef(!1),Jt=T.useRef(!1),Hn=T.useRef(!1),Qn=T.useRef(!1),ur=T.useRef(!1),Da=T.useRef(!1),ln=T.useRef(null);T.useRef(null);const ma=T.useRef(performance.now()),At=T.useRef(0),Dt=1e3,Ge=_[b]||[],Ve=y=>{const k=Y.slice(0,oe+1);k.push(JSON.parse(JSON.stringify(y))),k.length>30&&k.shift(),te(k),W(k.length-1)},Nn=(y,k=!0)=>{const X=Yn(y,k);if(X.length===0)return{x:0,y:0,w:0,h:0};const G=Math.min(...X.map(R=>R.x)),H=Math.max(...X.map(R=>R.x)),x=Math.min(...X.map(R=>R.y)),w=Math.max(...X.map(R=>R.y));return{x:G,y:x,w:H-G,h:w-x}},ga=()=>{if(O.length<2)return;const y=[..._],k=[...y[b]],X=O.sort((x,w)=>w-x).map(x=>k.splice(x,1)[0]),G={type:"group",shapes:X.reverse(),color:X[0].color,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0},H=ta(G);G.pivotX=H.x,G.pivotY=H.y,k.push(G),y[b]=k,U(y),Ve(y),$([k.length-1])},Qr=()=>{if(O.length!==1)return;const y=Ge[O[0]];if(y.type!=="group")return;const k=[..._],X=[...k[b]];X.splice(O[0],1);const G=y.shapes.map(H=>{const x=_a(qt(H),y);return{...H,points:x,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}});X.push(...G),k[b]=X,U(k),Ve(k),$([])},en=(y,k)=>Math.sqrt(Math.pow(k.x-y.x,2)+Math.pow(k.y-y.y,2)),Kn=y=>{if(y.startsWith("rgb")){const X=y.match(/\d+/g);return{r:parseInt(X[0]),g:parseInt(X[1]),b:parseInt(X[2])}}const k=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return k?{r:parseInt(k[1],16),g:parseInt(k[2],16),b:parseInt(k[3],16)}:{r:0,g:0,b:0}},Ln=y=>{if(!y)return"#ffffff";if(y.startsWith("#"))return y;if(y.startsWith("rgb")){const k=Kn(y),X=k.r.toString(16).padStart(2,"0"),G=k.g.toString(16).padStart(2,"0"),H=k.b.toString(16).padStart(2,"0");return`#${X}${G}${H}`}return"#ffffff"},Jn=y=>{const{r:k,g:X,b:G}=Kn(Ln(y));return`rgb(${255-k}, ${255-X}, ${255-G})`},ea=(y,k,X)=>{const G=Math.pow(en(k,X),2);if(G===0)return en(y,k);let H=((y.x-k.x)*(X.x-k.x)+(y.y-k.y)*(X.y-k.y))/G;return H=Math.max(0,Math.min(1,H)),en(y,{x:k.x+H*(X.x-k.x),y:k.y+H*(X.y-k.y)})},ta=(y,k=!1)=>{if(!y)return{x:500,y:500};if(y.type==="rect"&&!k)return{x:y.start.x+y.width/2,y:y.start.y+y.height/2};if((y.type==="circle"||y.type==="star"||y.type==="triangle")&&!k)return y.start;if(y.type==="line"&&!k)return{x:(y.start.x+y.end.x)/2,y:(y.start.y+y.end.y)/2};const X=Yn(y,k);if(X.length===0)return{x:500,y:500};const G=X.reduce((H,x)=>({x:H.x+(x.x||0),y:H.y+(x.y||0)}),{x:0,y:0});return{x:G.x/X.length,y:G.y/X.length}},Kr=(y,k)=>{if(!k||!y)return null;const X=Array.isArray(k)?k:[k];if(y.type==="group")return Kr(y.shapes[X[0]],X.slice(1));const G=X[0];return y.type==="line"?G===0?y.start:y.end:y.type==="rect"?[y.start,{x:y.start.x+y.width,y:y.start.y},{x:y.start.x+y.width,y:y.start.y+y.height},{x:y.start.x,y:y.start.y+y.height}][G]:y.type==="circle"||y.type==="star"||y.type==="triangle"?[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}][G]:y.points?y.points[G]:null},Rn=y=>y?y.pivotX!==void 0&&y.pivotY!==void 0?{x:y.pivotX,y:y.pivotY}:ta(y):{x:500,y:500},_a=T.useCallback((y,k)=>{if(!y||y.length===0||!k)return y;k.type==="group"&&k.shapes;const X=Rn(k),G=k.scaleX??1,H=k.scaleY??1,x=k.rotationX||0,w=k.rotationY||0,R=k.rotationZ||k.rotation||0;return G===1&&H===1&&x===0&&w===0&&R===0?y:y.map(E=>{let N=E.x-X.x,j=E.y-X.y,q=E.z||0;if(N*=G,j*=H,R!==0){const ie=N*Math.cos(R)-j*Math.sin(R),ce=N*Math.sin(R)+j*Math.cos(R);N=ie,j=ce}if(x!==0){const ie=j*Math.cos(x)-q*Math.sin(x),ce=j*Math.sin(x)+q*Math.cos(x);j=ie,q=ce}if(w!==0){const ie=N*Math.cos(w)+q*Math.sin(w),ce=-N*Math.sin(w)+q*Math.cos(w);N=ie,q=ce}return{...E,x:X.x+N,y:X.y+j,z:q}})},[]),qt=T.useCallback(y=>{if(!y)return[];let k=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline")k=y.points||[];else if(y.type==="bezier"){const X=(y.points||[]).filter(G=>!!G);if(X.length>=4)for(let G=0;G<=X.length-4;G+=3){const H=X[G],x=X[G+1],w=X[G+2],R=X[G+3];if(H&&x&&w&&R){const E=G===0?0:1;for(let N=E;N<=20;N++){const j=N/20,q=1-j;k.push({x:Math.pow(q,3)*H.x+3*Math.pow(q,2)*j*x.x+3*q*Math.pow(j,2)*w.x+Math.pow(j,3)*R.x,y:Math.pow(q,3)*H.y+3*Math.pow(q,2)*j*x.y+3*q*Math.pow(j,2)*w.y+Math.pow(j,3)*R.y,color:H.color})}}}else k=X}else if(y.type==="line")k=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const X=y.color,G=y.cornerColors||[X,X,X,X];k=[{x:y.start.x,y:y.start.y,color:G[0]},{x:y.start.x+y.width,y:y.start.y,color:G[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:G[2]},{x:y.start.x,y:y.start.y+y.height,color:G[3]}]}else if(y.type==="circle"){const X=Math.abs(y.end.x-y.start.x),G=Math.abs(y.end.y-y.start.y),H=y.color;for(let x=0;x<32;x++){const w=x/32*Math.PI*2;k.push({x:y.start.x+Math.cos(w)*X,y:y.start.y+Math.sin(w)*G,color:H})}}else if(y.type==="star"){const X=Math.abs(y.end.x-y.start.x),G=Math.abs(y.end.y-y.start.y),H=y.color,x=5,w=X,R=X/2.5;let E=Math.PI/2*3;const N=Math.PI/x;for(let j=0;j<x;j++)k.push({x:y.start.x+Math.cos(E)*w,y:y.start.y+Math.sin(E)*G,color:H}),E+=N,k.push({x:y.start.x+Math.cos(E)*R,y:y.start.y+Math.sin(E)*(G/2.5),color:H}),E+=N}else if(y.type==="triangle"){const X=Math.abs(y.end.x-y.start.x),G=Math.abs(y.end.y-y.start.y),H=y.color;k=[{x:y.start.x-X,y:y.start.y+G,color:H},{x:y.start.x+X,y:y.start.y+G,color:H},{x:y.start.x,y:y.start.y-G,color:H}]}else y.type==="group"&&y.shapes.forEach(X=>k.push(...qt(X)));return _a(k,y)},[_a]),Yn=T.useCallback((y,k=!0)=>{if(!y)return[];let X=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline"||y.type==="bezier")X=y.points||[];else if(y.type==="line")X=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const G=y.color,H=y.cornerColors||[G,G,G,G];X=[{x:y.start.x,y:y.start.y,color:H[0]},{x:y.start.x+y.width,y:y.start.y,color:H[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:H[2]},{x:y.start.x,y:y.start.y+y.height,color:H[3]}]}else y.type==="circle"||y.type==="star"||y.type==="triangle"?X=[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}]:y.type==="group"&&y.shapes.forEach(G=>X.push(...Yn(G,!0)));return k?_a(X,y):X},[_a]),$a=(y,k,X,G=[],H=[])=>{if(y.hidden||y.locked)return null;const x=15/J,w=Yn(y);if(y.type!=="group"){const q=[];for(let ie=0;ie<w.length;ie++)en(w[ie],k)<x&&q.push({type:"point",index:ie,path:[...H,ie]});if(q.length>0)return q.find(ce=>!G.some(de=>JSON.stringify(de)===JSON.stringify(ce.path)))||q[0]}const R=ta(y),E=Rn(y);if(X&&en(E,k)<15/J)return{type:"pivot"};if(X&&en(R,k)<20/J)return{type:"shape"};if(y.type==="group")for(let q=y.shapes.length-1;q>=0;q--){const ie=$a(y.shapes[q],k,!0,G,[...H,q]);if(ie&&ie.type==="point")return ie}const N=qt(y),j=["rect","circle","star","polygon"].includes(y.type);for(let q=0;q<N.length-1;q++)if(ea(k,N[q],N[q+1])<x)return{type:"segment",index:q,path:[...H,q]};return j&&N.length>2&&ea(k,N[N.length-1],N[0])<x?{type:"segment",index:N.length-1,path:[...H,N.length-1]}:null},hn=T.useCallback((y,k)=>{if(!sn.current)return{x:500,y:500};const X=sn.current.getBoundingClientRect(),G=y-X.left,H=k-X.top;return{x:(G-X.width/2)/J+Dt/2-Ae.x,y:(H-X.height/2)/J+Dt/2-Ae.y}},[J,Ae]),ya=T.useCallback((y,k,X=[])=>{if(!pt)return{x:y,y:k};const G=10/J;let H=null,x=G;return Ge.forEach((w,R)=>{if(w.hidden)return;Yn(w).forEach((N,j)=>{const q=[R,j];if(X.some(de=>JSON.stringify(de)===JSON.stringify(q)))return;const ce=en({x:y,y:k},N);ce<x&&(x=ce,H={x:N.x,y:N.y})})}),H||{x:Math.round(y/De)*De,y:Math.round(k/De)*De}},[pt,De,Ge,J,Yn]),Js=y=>{y.preventDefault();const k=Math.pow(1.1,-y.deltaY/100);Se(X=>Math.max(.1,Math.min(10,X*k)))},Mr=y=>{if(y.preventDefault(),h&&I){Es();return}const k=hn(y.clientX,y.clientY);for(let X=Ge.length-1;X>=0;X--){const G=$a(Ge[X],k,O.includes(X),z);if(G){at({visible:!0,x:y.clientX,y:y.clientY,target:{...G,shapeIndex:X,pos:k}}),O.includes(X)||$([X]);return}}at({visible:!0,x:y.clientX,y:y.clientY,target:{type:"canvas"}})},fr=()=>{if(O.length!==1||z.length===0)return;const y=O[0],k=[..._],X=[...k[b]],G=X[y];if(!G.points){alert("Only point-based shapes can be split. Convert to points first.");return}const H=z.map(E=>Array.isArray(E)?E[0]:E).sort((E,N)=>E-N),x=H.map(E=>({...G.points[E]})),w=G.points.filter((E,N)=>!H.includes(N));if(x.length===0)return;w.length<2?X.splice(y,1):X[y]={...G,points:w};const R={...G,type:"polyline",points:x,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};X.push(R),k[b]=X,U(k),Ve(k),$([X.length-1]),K([]),at({visible:!1,x:0,y:0,target:null})},dr=()=>{const y=z.length>0?z:Fe.target?.type==="point"?[Fe.target.path||[Fe.target.index]]:[];if(y.length===0)return;const k=[..._],X=[...k[b]],G={};y.forEach(w=>{const R=Array.isArray(w)?w:[w];if(O.length===1){const E=O[0];G[E]||(G[E]=[]),G[E].push(R)}else if(Fe.target?.shapeIndex!==void 0){const E=Fe.target.shapeIndex;G[E]||(G[E]=[]),G[E].push(R)}});const H=(w,R)=>{if(w.type==="group")return w.shapes=w.shapes.map((E,N)=>{const j=R.filter(q=>q[0]===N).map(q=>q.slice(1));return j.length>0?H({...E},j):E}).filter(E=>!!E),w.shapes.length>0?w:null;{if(!w.points)return null;const E=R.map(j=>j[0]),N=w.points.filter((j,q)=>!E.includes(q));return N.length<2?null:{...w,points:N}}};let x=!1;Object.keys(G).forEach(w=>{const R=parseInt(w),E=H(X[R],G[w]);E?X[R]=E:X.splice(R,1),x=!0}),x&&(k[b]=X,U(k),Ve(k),K([])),at({visible:!1,x:0,y:0,target:null})},ki=()=>{if(!Fe.target||Fe.target.type!=="segment")return;const{shapeIndex:y,index:k}=Fe.target,X=[..._],G=[...X[b]],H={...G[y]};if(H.type==="line"||H.type==="rect"||H.type==="circle"||H.type==="star")G.splice(y,1),$([]);else if(H.points){if(H.type==="polygon"){const x=[];for(let w=0;w<H.points.length;w++)x.push(H.points[(k+1+w)%H.points.length]);H.points=x,H.type="polyline",G[y]=H}else if(H.type==="polyline"||H.type==="pen"){const x=H.points.slice(0,k+1),w=H.points.slice(k+1);G.splice(y,1),x.length>1&&G.push({...H,points:x}),w.length>1&&G.push({...H,points:w}),$([])}else if(H.type==="bezier"){const x=[...H.points];x.splice(k,2),x.length<3?G.splice(y,1):(H.points=x,G[y]=H),$([])}}X[b]=G,U(X),Ve(X),at({visible:!1,x:0,y:0,target:null})},jn=()=>{if(!Fe.target||Fe.target.type!=="segment")return;const{shapeIndex:y,index:k,pos:X}=Fe.target,G=[..._],H=[...G[b]],x={...H[y]};if(x.points){const w=[...x.points];w.splice(k+1,0,{...X,color:s}),H[y]={...x,points:w}}else x.type==="line"&&(H[y]={type:"polyline",color:x.color,renderMode:x.renderMode||"simple",points:[{x:x.start.x,y:x.start.y,color:x.startColor||x.color},{x:X.x,y:X.y,color:s},{x:x.end.x,y:x.end.y,color:x.endColor||x.color}],rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1});G[b]=H,U(G),Ve(G),at({visible:!1,x:0,y:0,target:null})},Oa=()=>{if(!Fe.target||Fe.target.shapeIndex===void 0)return;const{shapeIndex:y}=Fe.target,k=[..._],X=[...k[b]],G=X[y];if(["rect","circle","star","line"].includes(G.type)){const H=qt(G),x={type:G.type==="line"?"polyline":"polygon",color:G.color,renderMode:G.renderMode||"simple",points:H,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};X[y]=x,k[b]=X,U(k),Ve(k)}at({visible:!1,x:0,y:0,target:null})},ei=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]];O.forEach(X=>{const G={...k[X]};delete G.pivotX,delete G.pivotY,k[X]=G}),y[b]=k,U(y),Ve(y),at({visible:!1,x:0,y:0,target:null})},va=T.useCallback(y=>cr(y),[]),Wa=T.useCallback(y=>Wr(y),[]),Ni=T.useCallback(y=>Tr(y),[]),ti=T.useCallback(y=>$e(y),[]),ba=T.useCallback(y=>oa(y),[]),kr=T.useCallback(y=>ka(y),[]),pr=(y,k,X=1)=>{y.preventDefault();const G=y.deltaY<0?X:-X;k(H=>Math.max(0,H+G))},Jr=y=>pr(y,Wr),Nr=y=>pr(y,oa),hr=y=>pr(y,$e,.1),Ia=y=>{y.preventDefault();const k=y.deltaY<0?1:-1;we(X=>Math.max(0,X+k))},es=y=>{y.preventDefault();const k=y.deltaY<0?1:-1;Ot(X=>Math.max(0,X+k))},Rr=y=>{y.preventDefault();const k=y.deltaY<0?1:-1;qa(X=>Math.max(0,Math.min(g-1,X+k)))},Dr=()=>{if(Pe>=rn){alert("Start frame must be before end frame");return}const y=[..._],k=_[Pe],X=_[rn];if(!k||!X||k.length===0||X.length===0){alert("Both start and end frames must contain shapes");return}const G=rn-Pe;for(let H=1;H<G;H++){const x=H/G,w=Pe+H,R=[];k.forEach((E,N)=>{const j=X[N];if(!j||E.type!==j.type){R.push(x<.5?JSON.parse(JSON.stringify(E)):JSON.parse(JSON.stringify(j)));return}const q=JSON.parse(JSON.stringify(E));if(It&&(E.start&&j.start&&(q.start.x=E.start.x+(j.start.x-E.start.x)*x,q.start.y=E.start.y+(j.start.y-E.start.y)*x),E.end&&j.end&&(q.end.x=E.end.x+(j.end.x-E.end.x)*x,q.end.y=E.end.y+(j.end.y-E.end.y)*x),E.width!==void 0&&j.width!==void 0&&(q.width=E.width+(j.width-E.width)*x),E.height!==void 0&&j.height!==void 0&&(q.height=E.height+(j.height-E.height)*x),q.scaleX=(E.scaleX??1)+((j.scaleX??1)-(E.scaleX??1))*x,q.scaleY=(E.scaleY??1)+((j.scaleY??1)-(E.scaleY??1))*x,q.rotationX=(E.rotationX??0)+((j.rotationX??0)-(E.rotationX??0))*x,q.rotationY=(E.rotationY??0)+((j.rotationY??0)-(E.rotationY??0))*x,q.rotationZ=(E.rotationZ??0)+((j.rotationZ??0)-(E.rotationZ??0))*x,E.rotation!==void 0&&j.rotation!==void 0&&(q.rotation=E.rotation+(j.rotation-E.rotation)*x)),et){const ie=Kn(E.color),ce=Kn(j.color),de=Math.round(ie.r+(ce.r-ie.r)*x),ae=Math.round(ie.g+(ce.g-ie.g)*x),xe=Math.round(ie.b+(ce.b-ie.b)*x);q.color=`rgb(${de},${ae},${xe})`}E.points&&j.points&&E.points.length===j.points.length&&(q.points=E.points.map((ie,ce)=>{const de=j.points[ce];let ae=ie.x,xe=ie.y,fe=ie.z||0,me=ie.color||E.color;if(It&&(ae=ie.x+(de.x-ie.x)*x,xe=ie.y+(de.y-ie.y)*x,fe=(ie.z||0)+((de.z||0)-(ie.z||0))*x),et){const ke=Kn(ie.color||E.color),Ne=Kn(de.color||j.color),Te=Math.round(ke.r+(Ne.r-ke.r)*x),je=Math.round(ke.g+(Ne.g-ke.g)*x),Oe=Math.round(ke.b+(Ne.b-ke.b)*x);me=`rgb(${Te},${je},${Oe})`}return{x:ae,y:xe,z:fe,color:me}})),R.push(q)}),y[w]=R}U(y),Ve(y),alert("Interpolation complete!")},_r=()=>{if(O.length!==1)return;const y=Ge[O[0]];if(!y||!y.points)return;const k=[];for(let X=1;X<y.points.length;X+=2)k.push(X);K(k)},mr=()=>{if(O.length!==1)return;const y=Ge[O[0]];if(!y||!y.points)return;const k=[];for(let X=0;X<y.points.length;X+=2)k.push(X);K(k)},ni=()=>{if(O.length!==1)return;const y=Ge[O[0]];if(!y||!y.points)return;const k=[];for(let X=0;X<y.points.length;X++)z.includes(X)||k.push(X);K(k)},tn=()=>{if(O.length!==1||z.length===0)return;const y=Ge[O[0]];if(!y||!y.points)return;const k=new Set(z);z.forEach(X=>{X>0&&k.add(X-1),X<y.points.length-1&&k.add(X+1),(y.type==="polygon"||y.type==="rect"||y.type==="circle"||y.type==="star")&&(X===0&&k.add(y.points.length-1),X===y.points.length-1&&k.add(0))}),K(Array.from(k).sort((X,G)=>X-G))},ai=()=>{if(O.length!==1||z.length===0)return;const y=Ge[O[0]];if(!y||!y.points)return;const k=z.filter(X=>{const G=X===0&&(y.type==="polygon"||y.type==="rect")?y.points.length-1:X-1,H=X===y.points.length-1&&(y.type==="polygon"||y.type==="rect")?0:X+1;return z.includes(G)&&z.includes(H)});K(k)},xa=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Select Background Image",filters:[{name:"Images",extensions:["jpg","png","png","webp","bmp"]}],properties:["openFile"]});if(!y)return;const k=new Image;k.onload=()=>{se(k)},k.src=`file://${y}`},Sa=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]],X=15/J,G=H=>{let x=[];return H.points?x=[...H.points]:x=qt(H),{...H,type:"polyline",points:x,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}};if(O.length===1){const H=O[0],x={...k[H]};if(x.points||(x.points=qt(x),x.rotationX=0,x.rotationY=0,x.rotationZ=0,x.scaleX=1,x.scaleY=1),z.length===2){const[w,R]=[...z].sort((j,q)=>j-q),E=[],N=x.points.length;for(let j=0;j<N;j++)E.push(x.points[(w+j)%N]);x.points=E,x.type="polygon"}else x.type="polygon";k[H]=x}else{const x=[...O].sort((w,R)=>R-w).map(w=>G(k.splice(w,1)[0]));if(x.length>0){let w=x.pop();for(;x.length>0;){let R=1/0,E=-1,N="end-end",j=!1,q=!1,ie=-1;const ce=w.points[0],de=w.points[w.points.length-1];if(x.forEach((xe,fe)=>{const me=xe.points[0],ke=xe.points[xe.points.length-1],Ne=en(de,me),Te=en(de,ke),je=en(ce,me),Oe=en(ce,ke);if(Ne<R&&(R=Ne,E=fe,N="end-end",j=!1,q=!1),Te<R&&(R=Te,E=fe,N="end-end",j=!1,q=!0),je<R&&(R=je,E=fe,N="end-end",j=!0,q=!1),Oe<R&&(R=Oe,E=fe,N="end-end",j=!0,q=!0),R>X)for(let Ie=0;Ie<w.points.length;Ie++){const Je=w.points[Ie],rt=en(Je,me),Ke=en(Je,ke);rt<R&&(R=rt,E=fe,N="mid-insert",ie=Ie,q=!1),Ke<R&&(R=Ke,E=fe,N="mid-insert",ie=Ie,q=!0)}}),E===-1)break;const ae=x.splice(E,1)[0];if(N==="end-end")j&&w.points.reverse(),q&&ae.points.reverse(),w.points=[...w.points,...ae.points];else{q&&ae.points.reverse();const xe=[...ae.points].reverse();xe.shift();const fe=[...ae.points,...xe],me=w.points.slice(0,ie+1),ke=w.points.slice(ie+1);w.points=[...me,...fe,...ke]}}k.push(w)}}y[b]=k,U(y),Ve(y),$([k.length-1]),K([])},xs=(y,k=!1,X=!1)=>{if(!y||y.length<2)return y;const G=[],H=x=>X?y[(x+y.length)%y.length]:y[Math.max(0,Math.min(y.length-1,x))];for(let x=0;x<y.length;x++){if(!X&&x===y.length-1){G.push(y[x]);break}const w=H(x-1),R=H(x),E=H(x+1),N=H(x+2);if(G.push(R),k){const de=-.0625*w.x+.5625*R.x+.5625*E.x+-.0625*N.x,ae=-.0625*w.y+.5625*R.y+.5625*E.y+-.0625*N.y,xe=Kn(R.color||"#ffffff"),fe=Kn(E.color||"#ffffff");Math.round((xe.r+fe.r)/2),Math.round((xe.g+fe.g)/2),Math.round((xe.b+fe.b)/2),G.push({x:de,y:ae,color:R.color})}else{const j=(R.x+E.x)/2,q=(R.y+E.y)/2;G.push({x:j,y:q,color:R.color})}}return G},ts=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]];let X=!1;O.forEach(G=>{const H={...k[G]};H.type==="polyline"?(H.type="polygon",k[G]=H,X=!0):H.type==="polygon"&&(H.type="polyline",k[G]=H,X=!0)}),X&&(y[b]=k,U(y),Ve(y)),at({visible:!1,x:0,y:0,target:null})},ua=(y=!1)=>{if(O.length===0)return;const k=[..._],X=[...k[b]];let G=!1;const H=(x,w,R,E)=>{if(R.length===0&&E.length===0||E.includes(x))return!0;const N=x,j=(x+1)%w;return R.includes(N)&&R.includes(j)};O.forEach(x=>{const w={...X[x]};let R=[];z.forEach(N=>{const j=Array.isArray(N)?N:[N];j.length===1&&R.push(j[0])});let E=[];if(re.forEach(N=>{const j=Array.isArray(N)?N:[N];j.length===1&&E.push(j[0])}),w.type==="pen"||w.type==="polyline"||w.type==="polygon")if(R.length>0||E.length>0){const j=w.points,q=[],ie=w.type==="polygon",ce=j.length;for(let de=0;de<ce;de++){if(!ie&&de===ce-1){q.push(j[de]);break}if(q.push(j[de]),H(de,ce,R,E)){const ae=j[de],xe=j[(de+1)%ce];if(y){const fe=rt=>j[(rt+ce)%ce],me=ie?fe(de-1):de>0?j[de-1]:ae,ke=ie?fe(de+2):de<ce-2?j[de+2]:xe,Ne=-.0625,Te=.5625,je=.5625,Oe=-.0625,Ie=Ne*me.x+Te*ae.x+je*xe.x+Oe*ke.x,Je=Ne*me.y+Te*ae.y+je*xe.y+Oe*ke.y;q.push({x:Ie,y:Je,color:ae.color})}else{const fe=(ae.x+xe.x)/2,me=(ae.y+xe.y)/2;q.push({x:fe,y:me,color:ae.color})}}}w.points=q,X[x]=w,G=!0}else{const j=w.type==="polygon";w.points=xs(w.points,y,j),X[x]=w,G=!0}else if(w.type==="circle"||w.type==="star"||w.type==="rect"){const N=R.length>0||E.length>0,j=qt(w);if(N){const q=[],ie=j.length;for(let ce=0;ce<ie;ce++)if(q.push(j[ce]),H(ce,ie,R,E)){const de=j[ce],ae=j[(ce+1)%ie];if(y){const xe=Te=>j[(Te+ie)%ie],fe=xe(ce-1),me=xe(ce+2),ke=-.0625*fe.x+.5625*de.x+.5625*ae.x-.0625*me.x,Ne=-.0625*fe.y+.5625*de.y+.5625*ae.y-.0625*me.y;q.push({x:ke,y:Ne,color:de.color})}else q.push({x:(de.x+ae.x)/2,y:(de.y+ae.y)/2,color:de.color})}X[x]={...w,type:"polygon",points:q,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else X[x]={...w,type:"polygon",points:xs(j,y,!0),rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};G=!0}}),G&&(k[b]=X,U(k),Ve(k))},fa=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]];let X=!1;O.forEach(G=>{const H={...k[G]};let x=[];z.forEach(R=>{const E=Array.isArray(R)?R:[R];E.length===1&&x.push(E[0])});let w=[];if(re.forEach(R=>{const E=Array.isArray(R)?R:[R];E.length===1&&w.push(E[0])}),w.length>0){const R=H.type==="polyline"||H.type==="polygon"||H.type==="pen"?H.points:qt(H);w.forEach(E=>{x.push(E),x.push((E+1)%R.length)}),x=Array.from(new Set(x))}if(H.type==="pen"||H.type==="polyline"||H.type==="polygon")if(x.length>0){x.sort((E,N)=>E-N);const R=x.filter((E,N)=>N%2===1);H.points.length-R.length>=2&&(H.points=H.points.filter((E,N)=>!R.includes(N)),k[G]=H,X=!0)}else H.points.length>2&&(H.points=H.points.filter((R,E)=>E%2===0),k[G]=H,X=!0);else if(H.type==="circle"||H.type==="star"||H.type==="rect"){const R=qt(H);let E=[];if(x.length>0){x.sort((j,q)=>j-q);const N=x.filter((j,q)=>q%2===1);E=R.filter((j,q)=>!N.includes(q))}else E=R.filter((N,j)=>j%2===0);if(E.length>=2){const N={type:"polygon",color:H.color,renderMode:H.renderMode,points:E,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};k[G]=N,X=!0}}}),X&&(y[b]=k,U(y),Ve(y),z.length>0&&K([]),re.length>0&&V([]))},na=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]];let X=!1;const G=.5;O.forEach(H=>{const x={...k[H]};let w=[];x.type==="pen"||x.type==="polyline"||x.type==="polygon"?w=x.points:(x.type==="circle"||x.type==="star"||x.type==="rect")&&(w=qt(x),x.type="polygon",x.rotationX=0,x.rotationY=0,x.rotationZ=0,x.scaleX=1,x.scaleY=1);let R=[];if(z.length>0&&z.forEach(E=>{const N=Array.isArray(E)?E:[E];N.length===1&&R.push(N[0])}),w.length>1){const E=[w[0]];for(let N=1;N<w.length;N++)R.length===0||R.includes(N)?en(w[N],E[E.length-1])>G&&E.push(w[N]):E.push(w[N]);x.type==="polygon"&&E.length>2&&(R.length===0||R.includes(w.length-1),en(E[E.length-1],E[0])<G&&(R.length,E.pop())),E.length!==w.length&&(x.points=E,k[H]=x,X=!0)}}),X&&(y[b]=k,U(y),Ve(y),z.length>0&&K([]))},Or=()=>{if(O.length===0)return;const y=[..._],k=[...y[b]];let X=!1;const G=150*(Math.PI/180),H=(x,w,R)=>{const E=Math.atan2(x.y-w.y,x.x-w.x),N=Math.atan2(R.y-w.y,R.x-w.x);let j=Math.abs(E-N);return j>Math.PI&&(j=2*Math.PI-j),j};O.forEach(x=>{const w={...k[x]};let R=[];w.type==="pen"||w.type==="polyline"||w.type==="polygon"?R=w.points:(w.type==="circle"||w.type==="star"||w.type==="rect")&&(R=qt(w),w.type="polygon",w.rotationX=0,w.rotationY=0,w.rotationZ=0,w.scaleX=1,w.scaleY=1);let E=[];if(z.length>0&&z.forEach(N=>{const j=Array.isArray(N)?N:[N];j.length===1&&E.push(j[0])}),R.length>2){const N=[],j=w.type==="polygon"||w.type==="rect"||w.type==="circle"||w.type==="star";for(let q=0;q<R.length;q++){if(N.push(R[q]),E.length>0&&!E.includes(q))continue;let ie,ce;if(q===0)if(j)ie=R[R.length-1];else continue;else ie=R[q-1];if(q===R.length-1)if(j)ce=R[0];else continue;else ce=R[q+1];H(ie,R[q],ce)<G&&N.push({...R[q]})}N.length!==R.length&&(w.points=N,k[x]=w,X=!0)}}),X&&(y[b]=k,U(y),Ve(y)),at({visible:!1,x:0,y:0,target:null})},Za=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import ILDA",filters:[{name:"ILDA Files",extensions:["ild"]}],properties:["openFile"]});if(y){nt(!0);try{const k=await window.electronAPI.readFileAsBinary(y),{frames:X}=Yv(k);if(X&&X.length>0){const G=X.map(H=>{const x=[];let w=[];if(H.points.forEach(R=>{const E=R.x*500+500,N=(1-R.y)*500,j=`rgb(${R.r},${R.g},${R.b})`;if(R.blanking){if(w.length>1){const q=w[0];Math.sqrt(Math.pow(q.x-E,2)+Math.pow(q.y-N,2))<2?x.push({type:"polygon",points:w,color:w[0].color,renderMode:"simple",rotation:0}):x.push({type:"polyline",points:w,color:w[0].color,renderMode:"simple",rotation:0})}w=[]}else w.push({x:E,y:N,color:j})}),w.length>1){const R=w[0],E=w[w.length-1];Math.sqrt(Math.pow(R.x-E.x,2)+Math.pow(R.y-E.y,2))<2?x.push({type:"polygon",points:w,color:w[0].color,renderMode:"simple",rotation:0}):x.push({type:"polyline",points:w,color:w[0].color,renderMode:"simple",rotation:0})}return x});U(G),Ve(G),v(G.length),M(0)}}catch(k){console.error(k)}finally{nt(!1)}}},Qa=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import SVG",filters:[{name:"SVG Files",extensions:["svg"]}],properties:["openFile"]});if(y){nt(!0);try{const k=await window.electronAPI.readFileContent(y),X=new DOMParser,G=new TextDecoder().decode(k),x=X.parseFromString(G,"image/svg+xml").querySelector("svg");if(!x)throw new Error("Invalid SVG");let w=x.getAttribute("viewBox")?.split(/[\s,]+/).map(parseFloat);if(!w||w.length!==4){const me=parseFloat(x.getAttribute("width"))||1e3,ke=parseFloat(x.getAttribute("height"))||1e3;w=[0,0,me,ke]}const[R,E,N,j]=w,q=Math.min(Dt/N,Dt/j)*.8,ie=(Dt-N*q)/2-R*q,ce=(Dt-j*q)/2-E*q,de=[],ae=document.createElement("div");ae.style.display="none",ae.innerHTML=G,document.body.appendChild(ae);const xe=ae.querySelector("svg"),fe=(me,ke=new DOMMatrix)=>{let Ne="";const Te=me.tagName.toLowerCase();let je=new DOMMatrix(me.getAttribute("transform")||"");const Oe=ke.multiply(je);if(Te==="g"){Array.from(me.children).forEach(rt=>fe(rt,Oe));return}if(Te==="path")Ne=me.getAttribute("d");else if(Te==="rect"){const rt=parseFloat(me.getAttribute("x"))||0,Ke=parseFloat(me.getAttribute("y"))||0,st=parseFloat(me.getAttribute("width"))||0,Tt=parseFloat(me.getAttribute("height"))||0;Ne=`M${rt},${Ke} h${st} v${Tt} h${-st} z`}else if(Te==="circle"||Te==="ellipse"){const rt=parseFloat(me.getAttribute("cx"))||0,Ke=parseFloat(me.getAttribute("cy"))||0,st=parseFloat(me.getAttribute("rx"))||parseFloat(me.getAttribute("r"))||0,Tt=parseFloat(me.getAttribute("ry"))||parseFloat(me.getAttribute("r"))||0;Ne=`M${rt-st},${Ke} a${st},${Tt} 0 1,0 ${st*2},0 a${st},${Tt} 0 1,0 ${-st*2},0 z`}else Te==="line"?Ne=`M${me.getAttribute("x1")},${me.getAttribute("y1")} L${me.getAttribute("x2")},${me.getAttribute("y2")}`:(Te==="polyline"||Te==="polygon")&&(Ne=`M${me.getAttribute("points")}${Te==="polygon"?" z":""}`);if(!Ne)return;const Ie=document.createElementNS("http://www.w3.org/2000/svg","path");Ie.setAttribute("d",Ne),xe.appendChild(Ie);const Je=Ie.getTotalLength();if(Je>0){const rt=[],Ke=Je*q*Math.max(Oe.a,Oe.d),st=Math.min(1e3,Math.max(10,Math.floor(Ke/5)));for(let Tt=0;Tt<=st;Tt++){const yt=Ie.getPointAtLength(Tt/st*Je),Ur=new DOMPoint(yt.x,yt.y).matrixTransform(Oe);rt.push({x:Ur.x*q+ie,y:Ur.y*q+ce,color:s})}de.push({type:"polyline",points:rt,color:s,renderMode:"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1})}};if(Array.from(x.children).forEach(me=>fe(me)),document.body.removeChild(ae),de.length>0){const me=[..._];me[b]=[...me[b]||[],...de],U(me),Ve(me)}}catch(k){console.error("SVG Import Error:",k),alert("Error importing SVG: "+k.message)}finally{nt(!1)}}},Ir=()=>{if(confirm("Press OK to clear ALL frames in the animation, or CANCEL to clear only the CURRENT frame.")){const k=_.map(()=>[]);U(k),Ve(k)}else{const k=[..._];k[b]=[],U(k),Ve(k)}$([]),K([])},cn=()=>{if(O.length===0)return;let y;if(z.length>0&&O.length===1){const k=Ge[O[0]],X=Yn(k);y={type:"polyline",points:z.map(H=>({...X[H]})),color:k.color,renderMode:k.renderMode||"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else y=O.map(k=>JSON.parse(JSON.stringify(Ge[k])));Z({data:y,sourceFrameIndex:b}),at({visible:!1})},Vn=()=>{if(!ge)return;const{data:y}=ge,k=Array.isArray(y)?JSON.parse(JSON.stringify(y)):[JSON.parse(JSON.stringify(y))],X=[..._],G=[...X[b]||[]];k.forEach(H=>{G.push(H)}),X[b]=G,U(X),Ve(X),$(k.map((H,x)=>G.length-k.length+x)),K([]),at({visible:!1})},Ss=()=>{const y=[..._];y.splice(b+1,0,JSON.parse(JSON.stringify(_[b]))),U(y),Ve(y),v(k=>k+1),M(k=>k+1)},wa=()=>{if(oe>0&&Y[oe-1]){const y=oe-1;W(y),U(JSON.parse(JSON.stringify(Y[y])))}},Ri=()=>{if(oe<Y.length-1&&Y[oe+1]){const y=oe+1;W(y),U(JSON.parse(JSON.stringify(Y[y])))}};T.useEffect(()=>{},[_]);const bn=y=>{if(O.length===0)return;const k=(X,G)=>{let H={...X,...G};return G.color&&(H.points&&(H.points=H.points.map(x=>({...x,color:G.color}))),H.startColor&&(H.startColor=G.color),H.endColor&&(H.endColor=G.color),H.cornerColors&&(H.cornerColors=H.cornerColors.map(()=>G.color)),H.centerColor&&(H.centerColor=G.color),H.outerColor&&(H.outerColor=G.color)),H.type==="group"&&H.shapes&&(H.shapes=H.shapes.map(x=>k(x,G))),H};U(X=>{const G=[...X],H=[...G[b]];return O.forEach(x=>{H[x]&&(H[x]=k(H[x],y))}),G[b]=H,Ve(G),G})},ws=y=>{O.length!==1||z.length===0||U(k=>{const X=[...k],G=[...X[b]],H=O[0];if(!G[H])return k;let x={...G[H]};return z.forEach(w=>{const R=Array.isArray(w)?w:[w],E=(N,j,q)=>{if(j.length===1){const ie=j[0],ce={...N};return ce.points?(ce.points=[...ce.points],ce.points[ie]={...ce.points[ie],color:q}):ce.type==="line"?ie===0?ce.startColor=q:ce.endColor=q:ce.type==="rect"?(ce.cornerColors=[...ce.cornerColors||[ce.color,ce.color,ce.color,ce.color]],ce.cornerColors[ie]=q):(ce.type==="circle"||ce.type==="star")&&(ie===0?ce.centerColor=q:ce.outerColor=q),ce}else{const[ie,...ce]=j,de={...N};return de.shapes=[...de.shapes],de.shapes[ie]=E(de.shapes[ie],ce,q),de}};x=E(x,R,y)}),G[H]=x,X[b]=G,Ve(X),X})},ns=async()=>{if(!_.every(y=>y.length===0)){Bt(!0);try{const k=_.slice(la).map(G=>{const H=[];return G.forEach((x,w)=>{const R=x.renderMode||"simple",E=qt(x),N=ie=>({...ie,x:(ie.x-500)/500,y:1-ie.y/500}),j=E.map(N);if(j.length<2)return;const q=[];for(let ie=0;ie<j.length-1;ie++){let ce=R;R==="dashed"&&ie%2===1&&(ce="blanked");const de=as(j[ie],j[ie+1],ce);ie<j.length-2?q.push(...de.slice(0,-1)):q.push(...de)}if(x.type==="polygon"||x.type==="rect"||x.type==="circle"||x.type==="star"||x.type==="triangle"){const ie=j[0],ce=j[j.length-1];if(Math.sqrt(Math.pow(ie.x-ce.x,2)+Math.pow(ie.y-ce.y,2))>.001){let ae=R;R==="dashed"&&(j.length-1)%2===1&&(ae="blanked");const xe=as(j[j.length-1],j[0],ae);xe.length>1&&q.push(...xe.slice(1))}}q.length>0&&(H.push({...q[0],blanking:!0}),H.push(...q))}),{points:H,frameName:"SHAPE"}}),X=ng(k);await window.electronAPI.saveIldaFile(X,"built_shape.ild")}catch(y){console.error(y)}finally{Bt(!1)}}},as=(y,k,X)=>{const G=Kn(y.color||s),H=Kn(k.color||s);if(X==="dotted")return[{x:y.x,y:y.y,r:G.r,g:G.g,b:G.b,blanking:!1},{x:y.x,y:y.y,r:G.r,g:G.g,b:G.b,blanking:!1}];const x=X==="blanked";return[{x:y.x,y:y.y,r:G.r,g:G.g,b:G.b,blanking:x},{x:k.x,y:k.y,r:H.r,g:H.g,b:H.b,blanking:x}]},Es=()=>{if(I&&(I.type==="polygon"||I.type==="polyline"||I.type==="bezier")){let y={...I};if(I.type==="polygon"||I.type==="polyline"?y.points=I.points.slice(0,-1):I.type==="bezier"&&lt&&(y.anchors=I.anchors.slice(0,-1),y.points=ol(y.anchors,!1)),y.type==="bezier"&&y.anchors.length>1||y.points.length>1){const k=[..._];k[b]=[...k[b]||[],y],U(k),Ve(k),$([k[b].length-1])}}p(!1),P(null)},ri=y=>{if(y.button===1||y.button===0&&y.altKey){ur.current=!0,kt.current={x:y.clientX,y:y.clientY};return}if(y.button!==0)return;const k=hn(y.clientX,y.clientY),X=ya(k.x,k.y),G=X.x,H=X.y;if(at({visible:!1}),e==="select"){const x=[];for(let w=Ge.length-1;w>=0;w--){const R=$a(Ge[w],k,O.includes(w),z);R&&x.push({...R,shapeIndex:w})}if(x.length>0){let w=x[0];const R=O[0];if(x.length>1&&x[0].shapeIndex===R)if(x[0].type==="point"){const j=x[0].path||[x[0].index];z.some(ie=>JSON.stringify(ie)===JSON.stringify(j))&&(w=x[1])}else w=x[1];const E=w.shapeIndex,N=w;if(N.type==="point"){const j=N.path||[N.index];y.shiftKey?O.includes(E)?K(q=>q.some(ce=>JSON.stringify(ce)===JSON.stringify(j))?q.filter(ce=>JSON.stringify(ce)!==JSON.stringify(j)):[...q,j]):($([E]),K([j])):(K([j]),$([E])),ca.current=!0}else if(N.type==="segment"){const j=N.path||[N.index];y.shiftKey?O.includes(E)?V(q=>q.some(ce=>JSON.stringify(ce)===JSON.stringify(j))?q.filter(ce=>JSON.stringify(ce)!==JSON.stringify(j)):[...q,j]):($([E]),V([j])):(V([j]),$([E]),K([])),Jt.current=!0}else N.type==="pivot"?Hn.current=!0:(!y.shiftKey&&!O.includes(E)?$([E]):y.shiftKey&&$(j=>j.includes(E)?j.filter(q=>q!==E):[...j,E]),Jt.current=!0);kt.current=k}else Da.current=!0,kt.current=k,ln.current={x:k.x,y:k.y,w:0,h:0};return}if(p(!0),kt.current=k,e==="polygon"||e==="polyline"||(e==="line"||e==="bezier")&&lt)if(!I)e==="bezier"?(P({type:"bezier",color:s,renderMode:o,isSmooth:!0,anchors:[{x:G,y:H,color:s},{x:G,y:H,color:s}],points:[{x:G,y:H,color:s},{x:G,y:H,color:s},{x:G,y:H,color:s},{x:G,y:H,color:s}],rotation:0}),zn(-1)):P({type:e==="polygon"?"polygon":"polyline",color:s,renderMode:o,points:[{x:G,y:H,color:s},{x:G,y:H,color:s}],rotation:0});else{const x=I.type==="bezier"?I.anchors[0]:I.points[0];if(en({x:G,y:H},x)<15/J&&(I.type==="bezier"&&I.anchors.length>2||I.points.length>3)){let R={...I};I.type==="bezier"?(R.anchors=I.anchors.slice(0,-1),R.closed=!0,R.points=ol(R.anchors,!0)):(R.points=I.points.slice(0,-1),R.type="polygon");const E=[..._];E[b]=[...E[b]||[],R],U(E),Ve(E),$([E[b].length-1]),p(!1),P(null);return}if(e==="bezier"){const R=[...I.anchors,{x:G,y:H,color:s}],E=ol(R,!1);P(N=>({...N,anchors:R,points:E}))}else P(R=>({...R,points:[...R.points,{x:G,y:H,color:s}]}))}else{const x={type:e,color:s,renderMode:o,start:{x:G,y:H},end:{x:G,y:H},width:0,height:0,rotation:0,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0};if(e==="pen")x.points=[{x:G,y:H,color:s},{x:G,y:H,color:s}];else if(e==="bezier"){const w=[{x:G,y:H,color:s},{x:G,y:H,color:s}],R=ol(w,!1);x.isSmooth=!0,x.anchors=w,x.points=R}P(x)}},Lr=T.useCallback((y,k,X)=>{const G={...y};return y.type==="group"?G.shapes=y.shapes.map(H=>Lr(H,k,X)):(y.points&&(G.points=y.points.map(H=>({...H,x:H.x+k,y:H.y+X}))),y.anchors&&(G.anchors=y.anchors.map(H=>({...H,x:H.x+k,y:H.y+X}))),y.start&&(G.start={...y.start,x:y.start.x+k,y:y.start.y+X}),y.end&&(G.end={...y.end,x:y.end.x+k,y:y.end.y+X})),y.pivotX!==void 0&&(G.pivotX=y.pivotX+k),y.pivotY!==void 0&&(G.pivotY=y.pivotY+X),G},[]),As=T.useCallback((y,k,X,G)=>{if(k.length===1){const H=k[0],x={...y};if(x.type==="line")H===0?x.start={...x.start,x:x.start.x+X,y:x.start.y+G}:x.end={...x.end,x:x.end.x+X,y:x.end.y+G};else if(x.type==="rect")H===0?(x.start={...x.start,x:x.start.x+X,y:x.start.y+G},x.width-=X,x.height-=G):H===1?(x.start={...x.start,y:x.start.y+G},x.width+=X,x.height-=G):H===2?(x.width+=X,x.height+=G):H===3&&(x.start={...x.start,x:x.start.x+X},x.width-=X,x.height+=G);else if(x.type==="circle"||x.type==="star"||x.type==="triangle")H===0?x.start={...x.start,x:x.start.x+X,y:x.start.y+G}:H===1?x.end={...x.end,x:x.end.x+X}:H===2&&(x.end={...x.end,y:x.end.y+G});else if(x.points&&(x.points=[...x.points],x.points[H]&&(x.points[H]={...x.points[H],x:x.points[H].x+X,y:x.points[H].y+G},x.type==="bezier"&&x.isSmooth)))if(H%3!==0)x.manualIndices||(x.manualIndices=[]),x.manualIndices.includes(H)||x.manualIndices.push(H);else{const R=H/3;x.anchors&&x.anchors[R]&&(x.anchors[R].x+=X,x.anchors[R].y+=G,ol(x.anchors,x.closed).forEach((N,j)=>{x.manualIndices&&x.manualIndices.includes(j)||(x.points[j].x=N.x,x.points[j].y=N.y)}))}return x}else{const[H,...x]=k,w={...y};return w.shapes=[...w.shapes],w.shapes[H]=As(w.shapes[H],x,X,G),w}},[]),si=y=>{const k=hn(y.clientX,y.clientY);if(ur.current){const x=(y.clientX-kt.current.x)/J,w=(y.clientY-kt.current.y)/J;Le(R=>({x:R.x+x,y:R.y+w})),kt.current={x:y.clientX,y:y.clientY};return}if(Qn.current&&O.length>0){const x=Rn(Ge[O[0]]);bn({rotationZ:Math.atan2(k.y-x.y,k.x-x.x)+Math.PI/2});return}if(Da.current){ln.current={x:Math.min(kt.current.x,k.x),y:Math.min(kt.current.y,k.y),w:Math.abs(k.x-kt.current.x),h:Math.abs(k.y-kt.current.y)},Tn(x=>x+1);return}if(Jt.current){const x=k.x-kt.current.x,w=k.y-kt.current.y,R=Ge[O[0]],E=ta(R),N=ya(E.x+x,E.y+w),j=N.x-E.x,q=N.y-E.y;(j!==0||q!==0)&&(U(ie=>{const ce=[...ie],de=[...ce[b]];return O.forEach(ae=>{de[ae]=Lr({...de[ae]},j,q)}),ce[b]=de,ce}),kt.current.x+=j,kt.current.y+=q);return}if(Hn.current&&O.length===1){const x=ya(k.x,k.y);U(w=>{const R=[...w],E=[...R[b]];return E[O[0]]={...E[O[0]],pivotX:x.x,pivotY:x.y},R[b]=E,R});return}if(ca.current&&O.length===1){const x=k.x-kt.current.x,w=k.y-kt.current.y,R=Ge[O[0]],E=z[0],N=Kr(R,E);if(N){const j=ya(N.x+x,N.y+w,z),q=j.x-N.x,ie=j.y-N.y;(q!==0||ie!==0)&&(U(ce=>{const de=[...ce],ae=[...de[b]];let xe={...ae[O[0]]};return z.forEach(fe=>{const me=Array.isArray(fe)?fe:[fe];xe=As(xe,me,q,ie)}),ae[O[0]]=xe,de[b]=ae,de}),kt.current.x+=q,kt.current.y+=ie)}return}if(!h)return;const X=ya(k.x,k.y),G=X.x,H=X.y;P(x=>{if(!x)return null;const w={...x},R=y.shiftKey;if(e==="pen")w.points=[...x.points,{x:G,y:H,color:s}];else if(e==="bezier"){const E=[...w.anchors],N=E.length-1;E[N]={x:G,y:H,color:s},w.anchors=E,w.points=ol(E,!1)}else if(w.type==="polyline"||w.type==="polygon"){const E=[...w.points];let N=G,j=H;if(R){const q=E[E.length-2];Math.abs(G-q.x)>Math.abs(H-q.y)?j=q.y:N=q.x}E[E.length-1]={x:N,y:j,color:s},w.points=E}else if(e==="line"){let E=G,N=H;R&&(Math.abs(G-kt.current.x)>Math.abs(H-kt.current.y)?N=kt.current.y:E=kt.current.x),w.end={x:E,y:N}}else if(e==="circle"||e==="star"||e==="triangle"){let E=G,N=H;if(R){const j=Math.max(Math.abs(G-kt.current.x),Math.abs(H-kt.current.y));E=kt.current.x+(G>=kt.current.x?j:-j),N=kt.current.y+(H>=kt.current.y?j:-j)}w.end={x:E,y:N}}else if(e==="rect"){let E=G-kt.current.x,N=H-kt.current.y;if(R){const j=Math.max(Math.abs(E),Math.abs(N));E=E>0?j:-j,N=N>0?j:-j}w.width=E,w.height=N}return w})},yl=y=>{if(Da.current&&ln.current){const G=ln.current,H=y.shiftKey;if(G.w<5/J&&G.h<5/J)H||($([]),K([]),V([]));else if(O.length===1){const x=O[0],w=Ge[x],R=Yn(w),E=[];if(R.forEach((N,j)=>{N.x>=G.x&&N.x<=G.x+G.w&&N.y>=G.y&&N.y<=G.y+G.h&&E.push(j)}),E.length>0)K(H?N=>Array.from(new Set([...N,...E])).sort((j,q)=>j-q):E);else{const N=[];Ge.forEach((j,q)=>{if(j.hidden||j.locked)return;const ie=Nn(j);ie.x<G.x+G.w&&ie.x+ie.w>G.x&&ie.y<G.y+G.h&&ie.y+ie.h>G.y&&N.push(q)}),H?$(j=>Array.from(new Set([...j,...N]))):($(N),K([]))}}else{const x=[];Ge.forEach((w,R)=>{if(w.hidden||w.locked)return;const E=Nn(w);E.x<G.x+G.w&&E.x+E.w>G.x&&E.y<G.y+G.h&&E.y+E.h>G.y&&x.push(R)}),H?$(w=>Array.from(new Set([...w,...x]))):($(x),K([]))}}if((ca.current||Jt.current||Hn.current)&&Ve(_),ca.current=!1,Jt.current=!1,Hn.current=!1,Qn.current=!1,Da.current=!1,ur.current=!1,ln.current=null,!h)return;const k=I.type==="polygon"||I.type==="polyline",X=I.type==="bezier"&&lt;if(I&&!k&&!X){const G=[..._];G[b]=[...G[b]||[],I],U(G),Ve(G),$([G[b].length-1]),p(!1),P(null)}},Ea=(y,k,X,G=!1,H=[])=>{if(!k||k.hidden)return;if(y.save(),k.type==="group"){if(k.shapes.forEach((N,j)=>Ea(y,N,!1,G,[...H,j])),y.restore(),X&&!G){y.save();const N=ta(k),j=Rn(k);y.fillStyle="#0089ff",y.beginPath(),y.arc(N.x,N.y,6/J,0,Math.PI*2),y.fill(),y.strokeStyle="white",y.lineWidth=1/J,y.stroke();const q=Nn(k);y.beginPath(),y.moveTo(N.x,q.y),y.lineTo(N.x,q.y-30/J),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(N.x,q.y-30/J,6/J,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke(),y.strokeStyle="var(--theme-color)",y.lineWidth=2/J,y.beginPath(),y.moveTo(j.x-10/J,j.y),y.lineTo(j.x+10/J,j.y),y.moveTo(j.x,j.y-10/J),y.lineTo(j.x,j.y+10/J),y.stroke(),y.beginPath(),y.arc(j.x,j.y,5/J,0,Math.PI*2),y.stroke(),y.restore()}return}const x=ta(k);y.lineWidth=(X?2.5:1.5)/J;const w=(N,j,q="simple",ie=[])=>{if(!N||N.length<2)return;if(re.length>0){y.save(),y.lineWidth=6/J,y.globalAlpha=.6,y.lineCap="round";for(let de=0;de<N.length-1;de++){const ae=[...ie,de];re.some(fe=>JSON.stringify(fe)===JSON.stringify(ae))&&(y.strokeStyle=Jn(N[de].color||k.color),y.beginPath(),y.moveTo(N[de].x,N[de].y),y.lineTo(N[de+1].x,N[de+1].y),y.stroke())}if(j&&N.length>2){const de=N.length-1,ae=[...ie,de];re.some(fe=>JSON.stringify(fe)===JSON.stringify(ae))&&(y.strokeStyle=Jn(N[de].color||k.color),y.beginPath(),y.moveTo(N[de].x,N[de].y),y.lineTo(N[0].x,N[0].y),y.stroke())}y.restore()}let ce=!1;y.beginPath(),N[0]&&y.moveTo(N[0].x,N[0].y);for(let de=0;de<N.length-1;de++){if(q==="dashed"&&de%2===1){ce&&(y.stroke(),ce=!1),y.moveTo(N[de+1].x,N[de+1].y);continue}const ae=N[de],xe=N[de+1];if(!ae||!xe)continue;const fe=G?"#444":ae.color||k.color,me=G?"#444":xe.color||k.color;if(fe!==me){ce&&(y.stroke(),ce=!1);const ke=y.createLinearGradient(ae.x,ae.y,xe.x,xe.y);ke.addColorStop(0,fe),ke.addColorStop(1,me),y.strokeStyle=ke,y.beginPath(),y.moveTo(ae.x,ae.y),y.lineTo(xe.x,xe.y),y.stroke(),y.beginPath(),y.moveTo(xe.x,xe.y)}else y.strokeStyle!==fe&&(ce&&(y.stroke(),y.beginPath(),y.moveTo(ae.x,ae.y)),y.strokeStyle=fe),y.lineTo(xe.x,xe.y),ce=!0}if(j&&N.length>2){const de=N.length-1;if(q==="dashed"&&de%2===1)ce&&y.stroke();else{const ae=N[de],xe=N[0],fe=G?"#444":ae.color||k.color,me=G?"#444":xe.color||k.color;if(fe!==me){ce&&y.stroke();const ke=y.createLinearGradient(ae.x,ae.y,xe.x,xe.y);ke.addColorStop(0,fe),ke.addColorStop(1,me),y.strokeStyle=ke,y.beginPath(),y.moveTo(ae.x,ae.y),y.lineTo(xe.x,xe.y),y.stroke()}else y.strokeStyle!==fe&&ce&&(y.stroke(),y.beginPath(),y.moveTo(ae.x,ae.y),y.strokeStyle=fe),y.lineTo(xe.x,xe.y),y.stroke(),ce=!1}}else ce&&y.stroke();q==="dotted"&&N.forEach(de=>{y.fillStyle=G?"#444":de.color||k.color,y.beginPath(),y.arc(de.x,de.y,3/J,0,Math.PI*2),y.fill()})},R=(N,j,q="simple",ie=[])=>{if(!N||!j)return;const ce=[...ie,0];if(re.some(fe=>JSON.stringify(fe)===JSON.stringify(ce))&&(y.save(),y.strokeStyle=Jn(N.color||k.color),y.lineWidth=6/J,y.globalAlpha=.6,y.lineCap="round",y.beginPath(),y.moveTo(N.x,N.y),y.lineTo(j.x,j.y),y.stroke(),y.restore()),q==="dotted"){[N,j].forEach(fe=>{y.fillStyle=G?"#444":fe.color||k.color,y.beginPath(),y.arc(fe.x,fe.y,3/J,0,Math.PI*2),y.fill()});return}const ae=G?"#444":N.color||k.color,xe=G?"#444":j.color||k.color;if(ae===xe)y.strokeStyle=ae;else{const fe=y.createLinearGradient(N.x,N.y,j.x,j.y);fe.addColorStop(0,ae),fe.addColorStop(1,xe),y.strokeStyle=fe}y.beginPath(),y.moveTo(N.x,N.y),y.lineTo(j.x,j.y),y.stroke()};if(k.renderMode==="points"){qt({...k,rotation:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}).forEach(N=>{y.fillStyle=G?"#444":N.color||k.color,y.beginPath(),y.arc(N.x,N.y,3/J,0,Math.PI*2),y.fill()}),y.restore();return}const E=k.renderMode||"simple";switch(k.type){case"pen":case"polyline":case"bezier":{const N=qt(k);w(N,!1,E,H);break}case"polygon":{const N=qt(k);w(N,!0,E,H);break}case"line":{const N=qt(k);R(N[0],N[1],E,H);break}case"rect":{const N=qt(k);w(N,!0,E,H);break}case"circle":{const N=qt(k);w(N,!0,E,H);break}case"star":{const N=qt(k);w(N,!0,E,H);break}}if(X&&!G){const N=Yn(k);if(k.type==="bezier"){y.save(),y.setLineDash([5/J,5/J]),y.strokeStyle="rgba(255,255,255,0.3)",y.lineWidth=1/J;for(let ie=0;ie<=N.length-4;ie+=3)y.beginPath(),y.moveTo(N[ie].x,N[ie].y),y.lineTo(N[ie+1].x,N[ie+1].y),y.stroke(),y.beginPath(),y.moveTo(N[ie+2].x,N[ie+2].y),y.lineTo(N[ie+3].x,N[ie+3].y),y.stroke();y.restore()}N.forEach((ie,ce)=>{const de=[...H,ce],ae=z.some(fe=>{const me=Array.isArray(fe)?fe:[fe];return JSON.stringify(me)===JSON.stringify(de)});let xe=!1;if(k.type==="bezier"&&(xe=ce%3!==0),y.fillStyle=ae?"var(--theme-color)":xe?"#888":"white",y.beginPath(),xe){const fe=4/J;y.rect(ie.x-fe,ie.y-fe,fe*2,fe*2)}else y.arc(ie.x,ie.y,5/J,0,Math.PI*2);y.fill(),y.strokeStyle=ae?"white":"black",y.lineWidth=1/J,y.stroke()});const j=Math.min(...N.map(ie=>ie.y));y.beginPath(),y.moveTo(x.x,j),y.lineTo(x.x,j-30/J),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(x.x,j-30/J,6/J,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke();const q=Rn(k);y.strokeStyle="var(--theme-color)",y.lineWidth=2/J,y.beginPath(),y.moveTo(q.x-10/J,q.y),y.lineTo(q.x+10/J,q.y),y.moveTo(q.x,q.y-10/J),y.lineTo(q.x,q.y+10/J),y.stroke(),y.beginPath(),y.arc(q.x,q.y,5/J,0,Math.PI*2),y.stroke()}y.restore()};T.useEffect(()=>{const y=sn.current;if(!y)return;const k=y.getContext("2d");let X;const G=()=>{if(sn.current){if(k.save(),k.clearRect(0,0,y.width,y.height),k.translate(y.width/2,y.height/2),k.scale(J,J),k.translate(-Dt/2+Ae.x,-Dt/2+Ae.y),k.fillStyle="#000",k.fillRect(0,0,Dt,Dt),Ye){k.beginPath(),k.strokeStyle="#222",k.lineWidth=.5/J;for(let H=0;H<=Dt;H+=De)k.moveTo(H,0),k.lineTo(H,Dt);for(let H=0;H<=Dt;H+=De)k.moveTo(0,H),k.lineTo(Dt,H);k.stroke(),k.beginPath(),k.strokeStyle="#444",k.lineWidth=1/J,k.moveTo(Dt/2,0),k.lineTo(Dt/2,Dt),k.moveTo(0,Dt/2),k.lineTo(Dt,Dt/2),k.stroke()}ee&&(k.globalAlpha=.3,k.drawImage(ee,0,0,Dt,Dt),k.globalAlpha=1),B&&b>0&&!D&&_[b-1]&&(k.globalAlpha=.15,_[b-1].forEach(H=>Ea(k,H,!1,!0)),k.globalAlpha=1),Ge.length>0&&Ge.forEach((H,x)=>Ea(k,H,O.includes(x))),h&&I&&Ea(k,I,!1),Da.current&&ln.current&&(k.fillStyle="rgba(0, 137, 255, 0.3)",k.fillRect(ln.current.x,ln.current.y,ln.current.w,ln.current.h),k.strokeStyle="#0089ff",k.lineWidth=2/J,k.setLineDash([]),k.strokeRect(ln.current.x,ln.current.y,ln.current.w,ln.current.h)),k.restore(),X=requestAnimationFrame(G)}};return X=requestAnimationFrame(G),()=>cancelAnimationFrame(X)},[_,b,I,h,ee,Ye,De,O,z,re,B,D,J,Ae,In]),T.useEffect(()=>{if(!D||g<=1){At.current=0;return}let y;ma.current=performance.now();const k=X=>{const G=X-ma.current;if(ma.current=X,G>500||G<=0){y=requestAnimationFrame(k);return}At.current+=G;const H=Mi.current,x=Math.max(.01,Na.current),w=Math.max(1,Ut.current),R=Wt.current,E=Math.max(1,w-R);let N=33.33;if(H==="fps"?N=1e3/(Math.max(1,Xa.current)*x):H==="bpm"?N=6e4/Math.max(1,Cr.current)*Math.max(1,kn.current)/E/x:H==="time"&&(N=Math.max(.1,Ra.current)*1e3/E/x),N=Math.max(1,N),At.current>=N){const j=Math.floor(At.current/N);j>0&&(M(q=>{const ie=q+j;return ie>=w?R+(ie-R)%E:ie}),At.current-=j*N)}y=requestAnimationFrame(k)};return y=requestAnimationFrame(k),()=>{y&&cancelAnimationFrame(y)}},[D,g]),T.useEffect(()=>{const y=Zr.current;if(y)return y.addEventListener("wheel",Js,{passive:!1}),()=>y.removeEventListener("wheel",Js)},[J]),T.useEffect(()=>{S(g)},[g]),T.useEffect(()=>{U(y=>{const k=[...y];if(g>y.length)for(let X=y.length;X<g;X++)k.push([]);else if(g<y.length)return k.slice(0,g);return k})},[g]),T.useEffect(()=>{const y=k=>{at({visible:!1,x:0,y:0,target:null}),h&&I&&k.target!==sn.current&&Es()};return window.addEventListener("click",y),()=>window.removeEventListener("click",y)},[h,I]),T.useEffect(()=>{D||($([]),K([]),V([]))},[b,D]),T.useEffect(()=>{const y=k=>{const X=["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)||document.activeElement.isContentEditable;if((k.ctrlKey||k.metaKey)&&k.key==="z")X||(k.preventDefault(),wa());else if((k.ctrlKey||k.metaKey)&&k.key==="y")X||(k.preventDefault(),Ri());else if((k.ctrlKey||k.metaKey)&&k.key==="c")X||(k.preventDefault(),cn());else if((k.ctrlKey||k.metaKey)&&k.key==="v")X||(k.preventDefault(),Vn());else if(k.key===" "||k.code==="Space")X||(k.preventDefault(),L(G=>!G));else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(k.key)){if(!X){const G=O.length>0||z.length>0;if(!G&&(k.key==="ArrowLeft"||k.key==="ArrowRight"))k.preventDefault(),k.key==="ArrowLeft"?M(H=>Math.max(0,H-1)):M(H=>Math.min(g-1,H+1));else if(G){k.preventDefault();const H=k.shiftKey?10:1;let x=0,w=0;k.key==="ArrowLeft"?x=-H:k.key==="ArrowRight"?x=H:k.key==="ArrowUp"?w=-H:k.key==="ArrowDown"&&(w=H),U(R=>{const E=[...R],N=[...E[b]];if(z.length>0&&O.length===1){const j=O[0];let q={...N[j]};z.forEach(ie=>{const ce=Array.isArray(ie)?ie:[ie];q=As(q,ce,x,w)}),N[j]=q}else O.forEach(j=>{N[j]&&(N[j]=Lr({...N[j]},x,w))});return E[b]=N,Ve(E),E})}}}else if((k.key==="Delete"||k.key==="Backspace")&&!X&&O.length>0){const G=[..._];G[b]=G[b].filter((H,x)=>!O.includes(x)),U(G),Ve(G),$([]),K([])}};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[_,b,O,z,ge,Y,oe,D,g,Lr,As]);const Di=({currentFrame:y,frameCount:k,syncMode:X,bpm:G,beats:H,duration:x,fps:w,onSeek:R,snapToGrid:E})=>{const N=T.useRef(null),j=de=>{if(X==="bpm"){const ae=6e4/(G||120),xe=ae*(H||8),fe=de/k*xe,me=Math.floor(fe/ae)+1,ke=Math.floor(fe%ae/ae*4)+1;return`B${me}.${ke}`}else if(X==="time"){const ae=(x||2)*1e3,xe=de/k*ae,fe=Math.floor(xe/1e3),me=Math.floor(xe%1e3);return`${fe}:${me.toString().padStart(3,"0")}`}return`F${de+1}`},q=de=>{if(!N.current)return;const ae=N.current.getBoundingClientRect();let fe=(de.clientX-ae.left)/ae.width,me=Math.round(fe*(k-1));if(E){if(X==="bpm"){const ke=k/H;me=Math.round(me/ke)*ke}else if(X==="time"){const ke=k/x;me=Math.round(me/ke)*ke}}R(Math.max(0,Math.min(k-1,Math.round(me))))},ie=[],ce=X==="bpm"?H||8:10;for(let de=0;de<=ce;de++){const ae=de/ce*100;let xe="";X==="bpm"?xe=`B${de+1}`:X==="time"?xe=`${(de/ce*(x||2)).toFixed(1)}s`:xe=Math.round(de/ce*k),ie.push(f.jsx("div",{style:{position:"absolute",left:`${ae}%`,top:0,bottom:0,borderLeft:"1px solid #444",pointerEvents:"none"},children:f.jsx("span",{style:{fontSize:"0.6rem",color:"#666",marginLeft:"2px"},children:xe})},de))}return f.jsxs("div",{ref:N,onMouseDown:q,style:{position:"relative",height:"35px",background:"#111",borderRadius:"4px",border:"1px solid #333",cursor:"pointer",overflow:"hidden"},children:[ie,f.jsx("div",{style:{position:"absolute",left:`${y/(k-1)*100}%`,top:0,bottom:0,width:"2px",background:"var(--theme-color)",boxShadow:"0 0 5px var(--theme-color)",zIndex:10}}),f.jsx("div",{style:{position:"absolute",right:"5px",bottom:"2px",fontSize:"0.7rem",color:"var(--theme-color)",fontWeight:"bold"},children:j(y)})]})},Aa=vn.memo(({active:y,onClick:k,icon:X})=>f.jsx("button",{onClick:k,style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:y?"var(--theme-color)":"#222",color:y?"black":"#888",border:"none",borderRadius:"4px",fontSize:"1.2rem",padding:0},children:f.jsx("i",{className:`bi ${X}`})})),jr=vn.memo(({active:y,onClick:k,children:X})=>f.jsx("button",{onClick:k,style:{background:y?"#444":"#222",color:y?"var(--theme-color)":"#888",border:y?"1px solid var(--theme-color)":"1px solid #333",fontSize:"0.7rem",padding:"5px"},children:X})),_i=O.length===1&&Ge[O[0]]&&z.length>0?Yn(Ge[O[0]])[z[0]]?.color||Ge[O[0]].color:"#000000";return f.jsxs("div",{className:"shape-builder",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column",userSelect:"none"},children:[ze&&f.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e4,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsx("h3",{children:"WORKING..."})}),f.jsxs("header",{style:{height:"50px",padding:"0 20px",background:"#1a1a1a",borderBottom:"1px solid #333",display:"flex",alignItems:"center",gap:"15px"},children:[f.jsx("h2",{style:{margin:0,fontSize:"1rem",color:"var(--theme-color)",width:"180px"},children:"SHAPE BUILDER"}),f.jsxs("div",{className:"action-group",style:{display:"flex",gap:"8px"},children:[f.jsx("button",{onClick:wa,title:"Undo",children:f.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),f.jsx("button",{onClick:Ri,title:"Redo",children:f.jsx("i",{className:"bi bi-arrow-clockwise"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:cn,title:"Copy",children:f.jsx("i",{className:"bi bi-clipboard"})}),f.jsx("button",{onClick:Vn,title:"Paste",children:f.jsx("i",{className:"bi bi-clipboard-check"})}),f.jsx("button",{onClick:Sa,title:"Join Points / Shapes",children:f.jsx("i",{className:"bi bi-share"})}),f.jsx("button",{onClick:ga,title:"Group",disabled:O.length<2,children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:Qr,title:"Ungroup",disabled:O.length!==1||Ge[O[0]]?.type!=="group",children:f.jsx("i",{className:"bi bi-exclude"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:()=>ua(!1),title:"Subdivide (Linear)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-grid-3x3"})}),f.jsx("button",{onClick:()=>ua(!0),title:"Subdivide (Smooth)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-bezier"})}),f.jsx("button",{onClick:fa,title:"Decimate (Reduce Points)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-filter-left"})}),f.jsx("button",{onClick:na,title:"Merge Overlapping Points",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-node-plus"})}),f.jsx("button",{onClick:Qa,title:"Import SVG",children:f.jsx("i",{className:"bi bi-vector-pen"})}),f.jsx("button",{onClick:Za,title:"Import ILDA",children:f.jsx("i",{className:"bi bi-folder2-open"})}),f.jsx("button",{onClick:xa,title:"Import Background Image",children:f.jsx("i",{className:"bi bi-image"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:Ir,title:"Clear All",children:f.jsx("i",{className:"bi bi-trash"})}),f.jsx("button",{onClick:()=>{Se(.6),Le({x:0,y:0})},title:"Recenter",children:f.jsx("i",{className:"bi bi-aspect-ratio"})})]}),f.jsxs("div",{className:"grid-controls",style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.8rem",marginLeft:"15px"},children:[f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:Ye,onChange:y=>Ue(y.target.checked)})," Grid"]}),f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:pt,onChange:y=>it(y.target.checked)})," Snap"]}),(e==="line"||e==="bezier")&&f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:lt,onChange:y=>wt(y.target.checked)})," Continuous"]}),f.jsxs("select",{value:De,onChange:y=>qe(parseInt(y.target.value)),style:{background:"#222",color:"white",border:"1px solid #444",borderRadius:"3px"},children:[f.jsx("option",{value:"10",children:"10px"}),f.jsx("option",{value:"25",children:"25px"}),f.jsx("option",{value:"50",children:"50px"}),f.jsx("option",{value:"100",children:"100px"})]})]}),f.jsx("button",{onClick:n,style:{marginLeft:"auto"},children:"Back to Show Control"})]}),f.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[f.jsxs("aside",{style:{width:"60px",background:"#1a1a1a",borderRight:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 0",gap:"10px"},children:[f.jsx(Aa,{active:e==="select",onClick:()=>{a("select"),p(!1),P(null)},icon:"bi-cursor"}),e==="select"&&f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",background:"#222",padding:"4px",borderRadius:"4px",border:"1px solid #333"},children:[f.jsx("button",{onClick:_r,title:"Select Odd Points",style:{padding:"4px",fontSize:"0.7rem"},children:"ODD"}),f.jsx("button",{onClick:mr,title:"Select Even Points",style:{padding:"4px",fontSize:"0.7rem"},children:"EVN"}),f.jsx("button",{onClick:ni,title:"Invert Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-arrow-left-right"})}),f.jsx("button",{onClick:tn,title:"Expand Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-plus-lg"})}),f.jsx("button",{onClick:ai,title:"Shrink Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-dash-lg"})})]}),f.jsx(Aa,{active:e==="pen",onClick:()=>{a("pen"),p(!1),P(null)},icon:"bi-pencil"}),f.jsx(Aa,{active:e==="bezier",onClick:()=>{a("bezier"),p(!1),P(null)},icon:"bi-bezier2"}),f.jsx(Aa,{active:e==="line",onClick:()=>{a("line"),p(!1),P(null)},icon:"bi-slash-lg"}),f.jsx(Aa,{active:e==="rect",onClick:()=>{a("rect"),p(!1),P(null)},icon:"bi-square"}),f.jsx(Aa,{active:e==="circle",onClick:()=>{a("circle"),p(!1),P(null)},icon:"bi-circle"}),f.jsx(Aa,{active:e==="polygon",onClick:()=>{a("polygon"),p(!1),P(null)},icon:"bi-pentagon"}),f.jsx(Aa,{active:e==="star",onClick:()=>{a("star"),p(!1),P(null)},icon:"bi-star"}),f.jsx(Aa,{active:e==="triangle",onClick:()=>{a("triangle"),p(!1),P(null)},icon:"bi-triangle"}),f.jsxs("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",paddingBottom:"10px"},children:[f.jsx("input",{type:"color",value:Ln(s),onChange:y=>{l(y.target.value),O.length>0&&bn({color:y.target.value})},title:"Custom Color",style:{width:"35px",height:"35px",border:"2px solid #333",background:"none",cursor:"pointer",marginBottom:"5px"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:[{name:"Red",hex:"#ff0000"},{name:"Orange",hex:"#ff6400"},{name:"Yellow",hex:"#ffff00"},{name:"Green",hex:"#00ff00"},{name:"Cyan",hex:"#00ffff"},{name:"Blue",hex:"#0000ff"},{name:"Violette",hex:"#8000ff"},{name:"Pink",hex:"#ff6496"},{name:"Magenta",hex:"#ff00ff"},{name:"White",hex:"#ffffff"}].map(y=>f.jsx("button",{onClick:()=>{l(y.hex),O.length>0&&bn({color:y.hex})},title:y.name,style:{width:"18px",height:"18px",background:y.hex,border:s===y.hex?"2px solid white":"1px solid #444",borderRadius:"2px",padding:0,cursor:"pointer"}},y.hex))})]})]}),f.jsxs("main",{style:{flex:1,background:"#050505",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[f.jsxs("div",{ref:Zr,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[f.jsx("canvas",{ref:sn,width:window.innerWidth-300,height:window.innerHeight-130,onMouseDown:ri,onMouseMove:si,onMouseUp:yl,onContextMenu:Mr,onDoubleClick:Es,style:{background:"transparent"}}),Fe.visible&&f.jsxs("div",{className:"context-menu",style:{position:"fixed",top:Fe.y,left:Fe.x,background:"#222",border:"1px solid #444",borderRadius:"4px",padding:"5px 0",zIndex:1e4},children:[(Fe.target?.type==="point"||z.length>0)&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"menu-item",onClick:dr,children:["Delete ",z.length>1?"Points":"Point"]}),f.jsx("div",{className:"menu-item",onClick:fr,children:"Split to New Shape"})]}),Fe.target?.type==="segment"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"menu-item",onClick:ki,children:"Delete Line"}),f.jsx("div",{className:"menu-item",onClick:jn,children:"Split Line"})]}),(Fe.target?.type==="shape"||O.length>0)&&f.jsxs(f.Fragment,{children:[O.some(y=>Ge[y]?.type==="polyline"||Ge[y]?.type==="polygon")&&f.jsx("div",{className:"menu-item",onClick:ts,children:O.every(y=>Ge[y]?.type==="polygon")?"Open Shape":"Close Shape"}),f.jsx("div",{className:"menu-item",onClick:()=>ua(!1),children:"Subdivide (Linear)"}),f.jsx("div",{className:"menu-item",onClick:()=>ua(!0),children:"Subdivide (Smooth)"}),f.jsx("div",{className:"menu-item",onClick:fa,children:"Decimate"}),f.jsx("div",{className:"menu-item",onClick:na,children:"Merge Points"}),f.jsx("div",{className:"menu-item",onClick:Or,children:"Add Corner Points"}),f.jsx("div",{className:"menu-item",onClick:ei,children:"Reset Anchor Point"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),O.length===1&&["rect","circle","star","line"].includes(Ge[O[0]]?.type)&&f.jsx("div",{className:"menu-item",onClick:Oa,children:"Convert to Points"}),f.jsx("div",{className:"menu-item",onClick:()=>{const y=[..._],k=O.length>0?O:[Fe.target.shapeIndex];y[b]=y[b].filter((X,G)=>!k.includes(G)),U(y),$([]),K([]),at({visible:!1})},children:"Delete Shape(s)"})]}),ee&&f.jsx("div",{className:"menu-item",onClick:()=>{se(null),at({visible:!1})},children:"Clear Background"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),f.jsx("div",{className:"menu-item",onClick:cn,children:"Copy"}),f.jsx("div",{className:"menu-item",onClick:Vn,children:"Paste"})]})]}),f.jsxs("div",{className:"timeline-bar",style:{height:"80px",background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",alignItems:"center",padding:"0 20px",gap:"20px"},children:[f.jsxs("div",{className:"playback-controls",style:{display:"flex",gap:"10px"},children:[f.jsx("button",{onClick:()=>L(!D),style:{width:"40px",height:"40px",borderRadius:"50%",background:D?"var(--theme-color)":"#333",color:D?"black":"white"},children:f.jsx("i",{className:`bi ${D?"bi-pause-fill":"bi-play-fill"}`})}),f.jsx("button",{onClick:()=>M(y=>Math.max(0,y-1)),children:f.jsx("i",{className:"bi bi-chevron-left"})}),f.jsx("button",{onClick:()=>M(y=>Math.min(g-1,y+1)),children:f.jsx("i",{className:"bi bi-chevron-right"})}),f.jsx("button",{onClick:Ss,title:"Duplicate Frame",children:f.jsx("i",{className:"bi bi-layers-half"})})]}),f.jsxs("div",{className:"frame-slider-container",style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#666"},children:[f.jsxs("span",{children:["FRAME ",b+1," / ",g]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",checked:B,onChange:y=>Q(y.target.checked)})," Onion Skin"]})]}),f.jsx(Di,{currentFrame:b,frameCount:g,syncMode:Cn,bpm:Mn,beats:ha,duration:Zn,fps:ct,snapToGrid:pt,onSeek:M})]}),f.jsxs("div",{className:"timeline-settings",style:{display:"flex",alignItems:"center",gap:"15px"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"START:"}),f.jsx("input",{type:"number",min:"1",max:g,value:la+1,onChange:y=>qa(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:Rr,style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"LENGTH:"}),f.jsx("input",{type:"number",min:"1",max:"999",value:A,onChange:y=>S(y.target.value),onBlur:()=>v(Math.max(1,parseInt(A)||1)),onKeyDown:y=>{y.key==="Enter"&&v(Math.max(1,parseInt(A)||1))},onWheel:y=>pr(y,v),style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]})]})]})]}),f.jsxs("aside",{style:{width:"260px",background:"#1a1a1a",borderLeft:"1px solid #333",display:"flex",flexDirection:"column",overflow:"hidden"},children:[f.jsxs("div",{className:"layers-panel",style:{display:"flex",flexDirection:"column",height:"220px",flexShrink:0,overflowY:"auto",borderBottom:"1px solid #333",padding:"15px"},children:[f.jsxs("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["LAYERS",f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("button",{onClick:ga,title:"Group",disabled:O.length<2,style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:Qr,title:"Ungroup",disabled:O.length!==1||Ge[O[0]]?.type!=="group",style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-exclude"})})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:Ge.map((y,k)=>({s:y,i:k})).reverse().map(({s:y,i:k})=>f.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"5px",background:O.includes(k)?"#333":"transparent",borderRadius:"3px",cursor:"pointer",border:O.includes(k)?"1px solid var(--theme-color)":"1px solid transparent"},onClick:X=>{y.locked&&!y.hidden||(X.shiftKey?$(G=>G.includes(k)?G.filter(H=>H!==k):[...G,k]):$([k]))},children:[f.jsx("div",{style:{width:"10px",height:"10px",background:y.color,marginRight:"8px",borderRadius:"2px"}}),f.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[y.type.toUpperCase()," ",k]}),f.jsx("button",{onClick:X=>{X.stopPropagation();const G=[..._];G[b][k]={...y,hidden:!y.hidden},U(G),Ve(G)},style:{background:"none",border:"none",padding:"2px",color:y.hidden?"#555":"#ccc"},title:y.hidden?"Show":"Hide",children:f.jsx("i",{className:`bi ${y.hidden?"bi-eye-slash":"bi-eye"}`})}),f.jsx("button",{onClick:X=>{X.stopPropagation();const G=[..._];G[b][k]={...y,locked:!y.locked},U(G),Ve(G)},style:{background:"none",border:"none",padding:"2px",color:y.locked?"var(--theme-color)":"#555"},title:y.locked?"Unlock":"Lock",children:f.jsx("i",{className:`bi ${y.locked?"bi-lock-fill":"bi-unlock"}`})})]},k))})]}),f.jsxs("div",{className:"properties-scroll-container",style:{flex:1,overflowY:"auto",padding:"15px",display:"flex",flexDirection:"column",gap:"20px"},children:[f.jsx("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",borderBottom:"1px solid #333",paddingBottom:"5px"},children:"PROPERTIES"}),f.jsxs("div",{className:"animation-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"TWEENING TOOL"}),f.jsxs("div",{style:{display:"flex",gap:"5px",marginBottom:"8px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"START FRAME"}),f.jsx("input",{type:"number",value:Pe+1,onChange:y=>we(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:Ia,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"END FRAME"}),f.jsx("input",{type:"number",value:rn+1,onChange:y=>Ot(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:es,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]})]}),f.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"8px",fontSize:"0.7rem",color:"#ccc"},children:[f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:It,onChange:y=>Lt(y.target.checked)})," POS"]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:et,onChange:y=>$r(y.target.checked)})," COLOR"]})]}),"                                              ",f.jsx("button",{onClick:Dr,className:"primary-btn",style:{width:"100%",padding:"5px"},children:"INTERPOLATE"})]}),f.jsxs("div",{className:"sync-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"PLAYBACK SYNC"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"10px"},children:[f.jsx(jr,{active:Cn==="fps",onClick:()=>va("fps"),children:"FPS"}),f.jsx(jr,{active:Cn==="bpm",onClick:()=>va("bpm"),children:"BPM"}),f.jsx(jr,{active:Cn==="time",onClick:()=>va("time"),children:"TIME"})]}),Cn==="fps"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["FPS: ",ct]}),f.jsx("input",{type:"range",min:"1",max:"60",value:ct,onChange:y=>Ni(parseInt(y.target.value))})]}),Cn==="bpm"&&f.jsxs("div",{style:{marginBottom:"8px",display:"flex",gap:"5px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BPM: ",Mn]}),f.jsx("input",{type:"number",value:Mn,onChange:y=>Wa(parseInt(y.target.value)||0),onWheel:Jr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BEATS: ",ha]}),f.jsx("input",{type:"number",value:ha,onChange:y=>ba(parseInt(y.target.value)||1),onWheel:Nr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]})]}),Cn==="time"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["DURATION (S): ",Zn]}),f.jsx("input",{type:"number",step:"0.1",value:Zn,onChange:y=>ti(parseFloat(y.target.value)||0),onWheel:hr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888",display:"flex",justifyContent:"space-between"},children:["SPEED: ",f.jsxs("span",{children:[Gn.toFixed(1),"x"]})]}),f.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:Gn,onChange:y=>kr(parseFloat(y.target.value))}),f.jsxs("div",{style:{display:"flex",gap:"4px",marginTop:"4px"},children:[f.jsx("button",{onClick:()=>kr(.5),style:{flex:1,fontSize:"0.6rem"},children:"0.5x"}),f.jsx("button",{onClick:()=>kr(1),style:{flex:1,fontSize:"0.6rem"},children:"1.0x"}),f.jsx("button",{onClick:()=>kr(2),style:{flex:1,fontSize:"0.6rem"},children:"2.0x"})]})]})]}),O.length>0?f.jsxs("div",{className:"shape-properties",style:{display:"flex",flexDirection:"column",gap:"15px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#666",display:"block"},children:O.length===1?`TYPE: ${Ge[O[0]]?.type?.toUpperCase()}`:`${O.length} SHAPES SELECTED`}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"COLOR"}),f.jsx("input",{type:"color",value:Ln(Ge[O[0]]?.color||"#ffffff"),onChange:y=>bn({color:y.target.value}),style:{width:"100%",height:"30px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>bn({color:y}),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]}),O.length===1&&Ge[O[0]]&&["rect","circle","star","line"].includes(Ge[O[0]].type)&&f.jsxs("div",{className:"primitive-properties",style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",background:"#222",borderRadius:"4px"},children:[f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"POSITION (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Ge[O[0]].start?.x||0),onChange:y=>{const k=Ge[O[0]];if(!k||!k.start)return;const X=(parseInt(y.target.value)||0)-k.start.x;U(G=>{const H=[...G],x=[...H[b]];return x[O[0]]=Lr({...x[O[0]]},X,0),H[b]=x,H})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Ge[O[0]].start?.y||0),onChange:y=>{const k=Ge[O[0]];if(!k||!k.start)return;const X=(parseInt(y.target.value)||0)-k.start.y;U(G=>{const H=[...G],x=[...H[b]];return x[O[0]]=Lr({...x[O[0]]},0,X),H[b]=x,H})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),Ge[O[0]].type==="rect"&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"SIZE (W / H)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Ge[O[0]].width||0),onChange:y=>bn({width:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Ge[O[0]].height||0),onChange:y=>bn({height:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),(Ge[O[0]].type==="circle"||Ge[O[0]].type==="star")&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"RADIUS (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Math.abs((Ge[O[0]].end?.x||0)-(Ge[O[0]].start?.x||0))),onChange:y=>{const k=parseInt(y.target.value)||0,X=Ge[O[0]];!X||!X.start||!X.end||bn({end:{...X.end,x:X.start.x+k}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Math.abs((Ge[O[0]].end?.y||0)-(Ge[O[0]].start?.y||0))),onChange:y=>{const k=parseInt(y.target.value)||0,X=Ge[O[0]];!X||!X.start||!X.end||bn({end:{...X.end,y:X.start.y+k}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"SCALE X / Y"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",step:"0.1",value:Ge[O[0]]?.scaleX||1,onChange:y=>bn({scaleX:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}}),f.jsx("input",{type:"number",step:"0.1",value:Ge[O[0]]?.scaleY||1,onChange:y=>bn({scaleY:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"ROTATION X / Y / Z (DEG)"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:["rotationX","rotationY","rotationZ"].map(y=>{const k=Ge[O[0]]?.[y]||0,X=Math.round(k*180/Math.PI*100)/100;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("span",{style:{fontSize:"0.7rem",color:"#555",width:"10px"},children:y.slice(-1)}),f.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:X,onChange:G=>bn({[y]:parseFloat(G.target.value)*Math.PI/180}),style:{flex:1}}),f.jsx("input",{type:"number",value:X,onChange:G=>bn({[y]:(parseFloat(G.target.value)||0)*Math.PI/180}),style:{width:"50px",background:"#111",border:"1px solid #444",color:"white",padding:"2px",fontSize:"0.7rem"}})]},y)})})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"RENDER MODE"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:["simple","dotted","dashed","points"].map(y=>f.jsx(jr,{active:Ge[O[0]]?.renderMode===y,onClick:()=>bn({renderMode:y}),children:y},y))})]})]}):f.jsx("p",{style:{fontSize:"0.8rem",color:"#555",textAlign:"center",marginTop:"20px"},children:"Select shapes or drag a box to begin."}),z.length>0&&O.length===1&&f.jsxs("div",{className:"point-properties",style:{background:"#222",padding:"10px",borderRadius:"4px",border:"1px solid var(--theme-color)",flexShrink:0},children:[f.jsxs("label",{style:{fontSize:"0.8rem",color:"var(--theme-color)",display:"block",marginBottom:"5px"},children:[z.length," POINTS SELECTED"]}),f.jsx("input",{type:"color",value:Ln(_i),onChange:y=>ws(y.target.value),style:{width:"100%",height:"40px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>ws(y),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]})]}),f.jsx("div",{className:"save-container",style:{padding:"15px",borderTop:"1px solid #333",background:"#1a1a1a"},children:f.jsx("button",{className:"primary-btn",style:{width:"100%",padding:"12px"},onClick:ns,disabled:_.every(y=>y.length===0)||gt,children:gt?"EXPORTING...":"SAVE AS CLIP"})})]})]}),f.jsx("style",{children:`
        button { padding: 4px 10px; background: #333; border: 1px solid #444; color: #ccc; border-radius: 3px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; }
        button:hover:not(:disabled) { background: #444; color: white; }
        .primary-btn { background: var(--theme-color) !important; color: black !important; font-weight: bold; border: none !important; }
        .context-menu { background: #222; border: 1px solid #444; border-radius: 4px; padding: 5px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-width: 120px; }
        .context-menu .menu-item { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; color: #ccc; }
        .context-menu .menu-item:hover { background: var(--theme-color); color: black; }
        input[type="range"] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--theme-color); border-radius: 50%; cursor: pointer; }
        
        .sb-checkbox {
            appearance: none !important;
            -webkit-appearance: none !important;
            width: 14px !important;
            height: 14px !important;
            min-width: 14px !important;
            min-height: 14px !important;
            background: #111 !important;
            border: 1px solid #444 !important;
            border-radius: 2px !important;
            cursor: pointer;
            position: relative;
            margin: 0 4px 0 0 !important;
            display: inline-block;
            vertical-align: middle;
        }
        /* Crucial: Kill the global "OFF/ON" toggle styling */
        .sb-checkbox:before {
            content: none !important;
            display: none !important;
        }
        .sb-checkbox:checked {
            background: var(--theme-color) !important;
            border-color: var(--theme-color) !important;
        }
        .sb-checkbox:checked::after {
            content: '\\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 10px;
            font-weight: bold;
            display: block !important;
        }
      `})]})},qv=({onBack:n})=>f.jsxs("div",{className:"timeline-editor-page",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column"},children:[f.jsxs("header",{style:{padding:"10px 20px",borderBottom:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("h2",{children:"Timeline Editor (Coming Soon)"}),f.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#ff5e00",border:"none",color:"white",borderRadius:"4px",cursor:"pointer"},children:"Back to Show Control"})]}),f.jsx("main",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("p",{children:"This is the Timeline Editor placeholder."}),f.jsx("p",{children:"Goal: Arrange clips on a timeline for synchronized playback."})]})})]}),Xv=({show:n,onClose:e,initialTab:a="output"})=>{const[s,l]=T.useState(a);return vn.useEffect(()=>{n&&l(a)},[n,a]),n?f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"About"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsx("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"}}),f.jsx("div",{className:"modal-body",children:f.jsx("div",{className:"audio-output-settings"})})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]}):null},ag=T.createContext(null),$v=()=>T.useContext(ag),Wv=({children:n})=>{const[e,a]=T.useState(null);return T.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(ag.Provider,{value:e,children:n})},rg=T.createContext(null),Zv=({children:n})=>{const e=T.useMemo(()=>{try{const a=new Worker(new URL(""+new URL("generators.worker-BSqwlXiT.js",import.meta.url).href,import.meta.url),{type:"module"});return a.onerror=s=>{console.error("Generator Worker instantiation or internal error:",s)},a}catch(a){return console.error("Failed to create Generator Worker:",a),null}},[]);return T.useEffect(()=>{if(e)return()=>{e.terminate()}},[e]),f.jsx(rg.Provider,{value:e,children:n})},Qv=()=>{const n=T.useContext(rg);if(n===void 0)throw new Error("useGeneratorWorker must be used within a GeneratorWorkerProvider");return n};var Kv=Fm();const Jv=rd(Kv),eb=()=>{const{isMapping:n,mappings:e,learningId:a,setLearningId:s,removeAssignment:l,setMappings:o,midiInputs:u,selectedMidiInputId:h}=jc(),{isMapping:p,mappings:g,learningId:v}=id()||{},{isMapping:A,mappings:S,learningId:b}=ld()||{},M=n||p||A,[D,L]=T.useState([]),B=T.useMemo(()=>{if(!a)return[];const U=[];return Object.entries(e).forEach(([I,P])=>{P.forEach(Y=>{Y.controlId===a&&U.push({key:I,...Y})})}),U},[a,e]),Q=(U,I,P,Y)=>{o(te=>{const oe={...te};return oe[U]?(oe[U]=oe[U].map(W=>W.controlId===I?{...W,[P]:Y}:W),oe):te})},_=T.useCallback(()=>{if(!M)return;const U=document.querySelectorAll("[data-mappable-id]"),I=Array.from(U).map(P=>{const Y=P.getBoundingClientRect();return{id:P.getAttribute("data-mappable-id"),rect:{top:Y.top,left:Y.left,width:Y.width,height:Y.height}}});L(I)},[M]);return T.useEffect(()=>{if(M){_(),window.addEventListener("resize",_);const U=setTimeout(_,100);return()=>{window.removeEventListener("resize",_),clearTimeout(U)}}else L([])},[M,_]),M?Jv.createPortal(f.jsx("div",{className:"midi-mapping-global-overlay-container",children:D.map(U=>{let I=null;const P=n,Y=p,te=A;if(P){const W=Object.entries(e).filter(([O,$])=>$.some(z=>z.controlId===U.id));W.length>0&&(I=W[0][1].find($=>$.controlId===U.id).label,W.length>1&&(I+=` (+${W.length-1})`))}else if(Y){const W=g?g[U.id]:null;I=W?W.label:null}else if(te){const W=S?S[U.id]:null;I=W?W.label:null}const oe=P&&a===U.id||Y&&v===U.id||te&&b===U.id;return f.jsxs(vn.Fragment,{children:[f.jsx("div",{className:`midi-mapping-label-box ${oe?"learning":""} ${I?"mapped":""} ${Y?"artnet-mapping":""} ${te?"keyboard-mapping":""}`,style:{position:"fixed",top:U.rect.top,left:U.rect.left,width:U.rect.width,height:U.rect.height,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:f.jsx("div",{className:"mapping-label",children:I||"+"})}),oe&&P&&f.jsxs("div",{className:"assignment-editor-popup",style:{position:"fixed",top:U.rect.top+U.rect.height+10,left:U.rect.left,background:"#1a1a1a",border:"1px solid #444",borderRadius:"5px",padding:"10px",zIndex:10001,minWidth:"250px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",pointerEvents:"auto"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[f.jsx("h4",{style:{margin:0,fontSize:"0.9rem"},children:"MIDI Assignments"}),f.jsx("button",{onClick:()=>s(null),style:{background:"none",border:"none",color:"#888",cursor:"pointer"},children:""})]}),B.length>0?B.map((W,O)=>f.jsxs("div",{className:"assignment-item",style:{background:"#222",padding:"8px",borderRadius:"4px",marginBottom:"8px",borderLeft:"3px solid var(--theme-color)"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[f.jsx("span",{style:{fontWeight:"bold",fontSize:"0.8rem"},children:W.label}),f.jsx("button",{onClick:()=>l(W.key,W.controlId),style:{background:"none",border:"none",color:"#ff4444",cursor:"pointer",fontSize:"12px"},children:"Remove"})]}),f.jsxs("div",{className:"setting-group",style:{marginBottom:"5px"},children:[f.jsx("label",{style:{fontSize:"10px",color:"#888",display:"block"},children:"Target"}),f.jsxs("select",{value:W.targetType||"position",onChange:$=>Q(W.key,W.controlId,"targetType",$.target.value),style:{width:"100%",background:"#111",color:"#fff",border:"1px solid #333",fontSize:"10px"},children:[f.jsx("option",{value:"position",children:"By Position (Static)"}),f.jsx("option",{value:"thisClip",children:"This Clip (Contextual)"}),f.jsx("option",{value:"selectedLayer",children:"Selected Layer (Dynamic)"})]})]}),f.jsxs("div",{className:"setting-group",children:[f.jsx("label",{style:{fontSize:"10px",color:"#888",display:"block"},children:"Input Device"}),f.jsxs("select",{value:W.inputDeviceId||"any",onChange:$=>Q(W.key,W.controlId,"inputDeviceId",$.target.value),style:{width:"100%",background:"#111",color:"#fff",border:"1px solid #333",fontSize:"10px"},children:[f.jsx("option",{value:"any",children:"Any Device"}),u.map($=>f.jsx("option",{value:$.id,children:$.name},$.id))]})]}),f.jsxs("div",{className:"feedback-settings",style:{marginTop:"10px",padding:"5px",background:"#111",borderRadius:"3px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("span",{style:{fontSize:"9px",color:"var(--theme-color)",fontWeight:"bold"},children:"CONTROL MODE"}),f.jsxs("select",{value:W.controlMode||"absolute",onChange:$=>Q(W.key,W.controlId,"controlMode",$.target.value),style:{background:"#000",color:"#fff",border:"1px solid #444",fontSize:"9px"},children:[f.jsx("option",{value:"absolute",children:"Absolute"}),f.jsx("option",{value:"relative",children:"Relative (Encoder)"}),f.jsx("option",{value:"fake_relative",children:"Fake Relative (Knob)"})]})]}),f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("span",{style:{fontSize:"9px",color:"var(--theme-color)",fontWeight:"bold"},children:"FEEDBACK (MIDI OUT)"}),f.jsxs("select",{value:W.feedbackMode||"toggle",onChange:$=>Q(W.key,W.controlId,"feedbackMode",$.target.value),style:{background:"#000",color:"#fff",border:"1px solid #444",fontSize:"9px"},children:[f.jsx("option",{value:"toggle",children:"Toggle"}),f.jsx("option",{value:"clip",children:"Clip"}),f.jsx("option",{value:"slider",children:"Slider"}),f.jsx("option",{value:"dropdown",children:"Dropdown"})]})]}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:[(!W.feedbackMode||W.feedbackMode==="toggle"||W.feedbackMode==="dropdown")&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"On Vel"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.onVelocity??127,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,onVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]}),f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"Off Vel"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.offVelocity??0,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,offVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]})]}),W.feedbackMode==="clip"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"Active"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.activeVelocity??127,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,activeVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]}),f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"Preview"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.previewVelocity??64,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,previewVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]}),f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"Inactive"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.inactiveVelocity??1,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,inactiveVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]}),f.jsxs("div",{className:"vel-input",children:[f.jsx("label",{style:{fontSize:"8px",color:"#666"},children:"Empty"}),f.jsx("input",{type:"number",min:"0",max:"127",value:W.feedbackConfig?.emptyVelocity??0,onChange:$=>Q(W.key,W.controlId,"feedbackConfig",{...W.feedbackConfig,emptyVelocity:parseInt($.target.value)}),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"}})]})]})]})]})]},`${W.key}_${O}`)):f.jsx("div",{style:{textAlign:"center",padding:"10px",color:"#666",fontSize:"0.8rem"},children:"Press a button or move a fader on your MIDI controller to add an assignment."}),B.length>0&&f.jsx("div",{style:{fontSize:"9px",color:"#555",marginTop:"5px",textAlign:"center"},children:"Press another MIDI control to add more links."})]})]},U.id)})}),document.body):null};String.prototype.codePointAt||(function(){var n=(function(){try{var a={},s=Object.defineProperty,l=s(a,a,a)&&s}catch{}return l})(),e=function(a){if(this==null)throw TypeError();var s=String(this),l=s.length,o=a?Number(a):0;if(o!=o&&(o=0),!(o<0||o>=l)){var u=s.charCodeAt(o),h;return u>=55296&&u<=56319&&l>o+1&&(h=s.charCodeAt(o+1),h>=56320&&h<=57343)?(u-55296)*1024+h-56320+65536:u}};n?n(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var ud=0,sg=-3;function fo(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function tb(n,e){this.source=n,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new fo,this.dtree=new fo}var ig=new fo,lg=new fo,fd=new Uint8Array(30),dd=new Uint16Array(30),og=new Uint8Array(30),cg=new Uint16Array(30),nb=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$0=new fo,Yr=new Uint8Array(320);function ug(n,e,a,s){var l,o;for(l=0;l<a;++l)n[l]=0;for(l=0;l<30-a;++l)n[l+a]=l/a|0;for(o=s,l=0;l<30;++l)e[l]=o,o+=1<<n[l]}function ab(n,e){var a;for(a=0;a<7;++a)n.table[a]=0;for(n.table[7]=24,n.table[8]=152,n.table[9]=112,a=0;a<24;++a)n.trans[a]=256+a;for(a=0;a<144;++a)n.trans[24+a]=a;for(a=0;a<8;++a)n.trans[168+a]=280+a;for(a=0;a<112;++a)n.trans[176+a]=144+a;for(a=0;a<5;++a)e.table[a]=0;for(e.table[5]=32,a=0;a<32;++a)e.trans[a]=a}var W0=new Uint16Array(16);function Lf(n,e,a,s){var l,o;for(l=0;l<16;++l)n.table[l]=0;for(l=0;l<s;++l)n.table[e[a+l]]++;for(n.table[0]=0,o=0,l=0;l<16;++l)W0[l]=o,o+=n.table[l];for(l=0;l<s;++l)e[a+l]&&(n.trans[W0[e[a+l]]++]=l)}function rb(n){n.bitcount--||(n.tag=n.source[n.sourceIndex++],n.bitcount=7);var e=n.tag&1;return n.tag>>>=1,e}function Vr(n,e,a){if(!e)return a;for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var s=n.tag&65535>>>16-e;return n.tag>>>=e,n.bitcount-=e,s+a}function Wf(n,e){for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var a=0,s=0,l=0,o=n.tag;do s=2*s+(o&1),o>>>=1,++l,a+=e.table[l],s-=e.table[l];while(s>=0);return n.tag=o,n.bitcount-=l,e.trans[a+s]}function sb(n,e,a){var s,l,o,u,h,p;for(s=Vr(n,5,257),l=Vr(n,5,1),o=Vr(n,4,4),u=0;u<19;++u)Yr[u]=0;for(u=0;u<o;++u){var g=Vr(n,3,0);Yr[nb[u]]=g}for(Lf($0,Yr,0,19),h=0;h<s+l;){var v=Wf(n,$0);switch(v){case 16:var A=Yr[h-1];for(p=Vr(n,2,3);p;--p)Yr[h++]=A;break;case 17:for(p=Vr(n,3,3);p;--p)Yr[h++]=0;break;case 18:for(p=Vr(n,7,11);p;--p)Yr[h++]=0;break;default:Yr[h++]=v;break}}Lf(e,Yr,0,s),Lf(a,Yr,s,l)}function Z0(n,e,a){for(;;){var s=Wf(n,e);if(s===256)return ud;if(s<256)n.dest[n.destLen++]=s;else{var l,o,u,h;for(s-=257,l=Vr(n,fd[s],dd[s]),o=Wf(n,a),u=n.destLen-Vr(n,og[o],cg[o]),h=u;h<u+l;++h)n.dest[n.destLen++]=n.dest[h]}}}function ib(n){for(var e,a,s;n.bitcount>8;)n.sourceIndex--,n.bitcount-=8;if(e=n.source[n.sourceIndex+1],e=256*e+n.source[n.sourceIndex],a=n.source[n.sourceIndex+3],a=256*a+n.source[n.sourceIndex+2],e!==(~a&65535))return sg;for(n.sourceIndex+=4,s=e;s;--s)n.dest[n.destLen++]=n.source[n.sourceIndex++];return n.bitcount=0,ud}function lb(n,e){var a=new tb(n,e),s,l,o;do{switch(s=rb(a),l=Vr(a,2,0),l){case 0:o=ib(a);break;case 1:o=Z0(a,ig,lg);break;case 2:sb(a,a.ltree,a.dtree),o=Z0(a,a.ltree,a.dtree);break;default:o=sg}if(o!==ud)throw new Error("Data error")}while(!s);return a.destLen<a.dest.length?typeof a.dest.slice=="function"?a.dest.slice(0,a.destLen):a.dest.subarray(0,a.destLen):a.dest}ab(ig,lg);ug(fd,dd,4,3);ug(og,cg,2,1);fd[28]=0;dd[28]=258;var ob=lb;function cl(n,e,a,s,l){return Math.pow(1-l,3)*n+3*Math.pow(1-l,2)*l*e+3*(1-l)*Math.pow(l,2)*a+Math.pow(l,3)*s}function bs(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}bs.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};bs.prototype.addPoint=function(n,e){typeof n=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=n,this.x2=n),n<this.x1&&(this.x1=n),n>this.x2&&(this.x2=n)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};bs.prototype.addX=function(n){this.addPoint(n,null)};bs.prototype.addY=function(n){this.addPoint(null,n)};bs.prototype.addBezier=function(n,e,a,s,l,o,u,h){var p=[n,e],g=[a,s],v=[l,o],A=[u,h];this.addPoint(n,e),this.addPoint(u,h);for(var S=0;S<=1;S++){var b=6*p[S]-12*g[S]+6*v[S],M=-3*p[S]+9*g[S]-9*v[S]+3*A[S],D=3*g[S]-3*p[S];if(M===0){if(b===0)continue;var L=-D/b;0<L&&L<1&&(S===0&&this.addX(cl(p[S],g[S],v[S],A[S],L)),S===1&&this.addY(cl(p[S],g[S],v[S],A[S],L)));continue}var B=Math.pow(b,2)-4*D*M;if(!(B<0)){var Q=(-b+Math.sqrt(B))/(2*M);0<Q&&Q<1&&(S===0&&this.addX(cl(p[S],g[S],v[S],A[S],Q)),S===1&&this.addY(cl(p[S],g[S],v[S],A[S],Q)));var _=(-b-Math.sqrt(B))/(2*M);0<_&&_<1&&(S===0&&this.addX(cl(p[S],g[S],v[S],A[S],_)),S===1&&this.addY(cl(p[S],g[S],v[S],A[S],_)))}}};bs.prototype.addQuad=function(n,e,a,s,l,o){var u=n+.6666666666666666*(a-n),h=e+2/3*(s-e),p=u+1/3*(l-n),g=h+1/3*(o-e);this.addBezier(n,e,u,h,p,g,l,o)};function An(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}An.prototype.moveTo=function(n,e){this.commands.push({type:"M",x:n,y:e})};An.prototype.lineTo=function(n,e){this.commands.push({type:"L",x:n,y:e})};An.prototype.curveTo=An.prototype.bezierCurveTo=function(n,e,a,s,l,o){this.commands.push({type:"C",x1:n,y1:e,x2:a,y2:s,x:l,y:o})};An.prototype.quadTo=An.prototype.quadraticCurveTo=function(n,e,a,s){this.commands.push({type:"Q",x1:n,y1:e,x:a,y:s})};An.prototype.close=An.prototype.closePath=function(){this.commands.push({type:"Z"})};An.prototype.extend=function(n){if(n.commands)n=n.commands;else if(n instanceof bs){var e=n;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,n)};An.prototype.getBoundingBox=function(){for(var n=new bs,e=0,a=0,s=0,l=0,o=0;o<this.commands.length;o++){var u=this.commands[o];switch(u.type){case"M":n.addPoint(u.x,u.y),e=s=u.x,a=l=u.y;break;case"L":n.addPoint(u.x,u.y),s=u.x,l=u.y;break;case"Q":n.addQuad(s,l,u.x1,u.y1,u.x,u.y),s=u.x,l=u.y;break;case"C":n.addBezier(s,l,u.x1,u.y1,u.x2,u.y2,u.x,u.y),s=u.x,l=u.y;break;case"Z":s=e,l=a;break;default:throw new Error("Unexpected path command "+u.type)}}return n.isEmpty()&&n.addPoint(0,0),n};An.prototype.draw=function(n){n.beginPath();for(var e=0;e<this.commands.length;e+=1){var a=this.commands[e];a.type==="M"?n.moveTo(a.x,a.y):a.type==="L"?n.lineTo(a.x,a.y):a.type==="C"?n.bezierCurveTo(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n.quadraticCurveTo(a.x1,a.y1,a.x,a.y):a.type==="Z"&&n.closePath()}this.fill&&(n.fillStyle=this.fill,n.fill()),this.stroke&&(n.strokeStyle=this.stroke,n.lineWidth=this.strokeWidth,n.stroke())};An.prototype.toPathData=function(n){n=n!==void 0?n:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(n)}function a(){for(var u=arguments,h="",p=0;p<arguments.length;p+=1){var g=u[p];g>=0&&p>0&&(h+=" "),h+=e(g)}return h}for(var s="",l=0;l<this.commands.length;l+=1){var o=this.commands[l];o.type==="M"?s+="M"+a(o.x,o.y):o.type==="L"?s+="L"+a(o.x,o.y):o.type==="C"?s+="C"+a(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?s+="Q"+a(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(s+="Z")}return s};An.prototype.toSVG=function(n){var e='<path d="';return e+=this.toPathData(n),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};An.prototype.toDOMElement=function(n){var e=this.toPathData(n),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",e),a};function fg(n){throw new Error(n)}function Q0(n,e){n||fg(e)}var ft={fail:fg,argument:Q0,assert:Q0},K0=32768,J0=2147483648,pl={},He={},ht={};function Er(n){return function(){return n}}He.BYTE=function(n){return ft.argument(n>=0&&n<=255,"Byte value should be between 0 and 255."),[n]};ht.BYTE=Er(1);He.CHAR=function(n){return[n.charCodeAt(0)]};ht.CHAR=Er(1);He.CHARARRAY=function(n){typeof n>"u"&&(n="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],a=0;a<n.length;a+=1)e[a]=n.charCodeAt(a);return e};ht.CHARARRAY=function(n){return typeof n>"u"?0:n.length};He.USHORT=function(n){return[n>>8&255,n&255]};ht.USHORT=Er(2);He.SHORT=function(n){return n>=K0&&(n=-(2*K0-n)),[n>>8&255,n&255]};ht.SHORT=Er(2);He.UINT24=function(n){return[n>>16&255,n>>8&255,n&255]};ht.UINT24=Er(3);He.ULONG=function(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]};ht.ULONG=Er(4);He.LONG=function(n){return n>=J0&&(n=-(2*J0-n)),[n>>24&255,n>>16&255,n>>8&255,n&255]};ht.LONG=Er(4);He.FIXED=He.ULONG;ht.FIXED=ht.ULONG;He.FWORD=He.SHORT;ht.FWORD=ht.SHORT;He.UFWORD=He.USHORT;ht.UFWORD=ht.USHORT;He.LONGDATETIME=function(n){return[0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255]};ht.LONGDATETIME=Er(8);He.TAG=function(n){return ft.argument(n.length===4,"Tag should be exactly 4 ASCII characters."),[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]};ht.TAG=Er(4);He.Card8=He.BYTE;ht.Card8=ht.BYTE;He.Card16=He.USHORT;ht.Card16=ht.USHORT;He.OffSize=He.BYTE;ht.OffSize=ht.BYTE;He.SID=He.USHORT;ht.SID=ht.USHORT;He.NUMBER=function(n){return n>=-107&&n<=107?[n+139]:n>=108&&n<=1131?(n=n-108,[(n>>8)+247,n&255]):n>=-1131&&n<=-108?(n=-n-108,[(n>>8)+251,n&255]):n>=-32768&&n<=32767?He.NUMBER16(n):He.NUMBER32(n)};ht.NUMBER=function(n){return He.NUMBER(n).length};He.NUMBER16=function(n){return[28,n>>8&255,n&255]};ht.NUMBER16=Er(3);He.NUMBER32=function(n){return[29,n>>24&255,n>>16&255,n>>8&255,n&255]};ht.NUMBER32=Er(5);He.REAL=function(n){var e=n.toString(),a=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(a){var s=parseFloat("1e"+((a[2]?+a[2]:0)+a[1].length));e=(Math.round(n*s)/s).toString()}for(var l="",o=0,u=e.length;o<u;o+=1){var h=e[o];h==="e"?l+=e[++o]==="-"?"c":"b":h==="."?l+="a":h==="-"?l+="e":l+=h}l+=l.length&1?"f":"ff";for(var p=[30],g=0,v=l.length;g<v;g+=2)p.push(parseInt(l.substr(g,2),16));return p};ht.REAL=function(n){return He.REAL(n).length};He.NAME=He.CHARARRAY;ht.NAME=ht.CHARARRAY;He.STRING=He.CHARARRAY;ht.STRING=ht.CHARARRAY;pl.UTF8=function(n,e,a){for(var s=[],l=a,o=0;o<l;o++,e+=1)s[o]=n.getUint8(e);return String.fromCharCode.apply(null,s)};pl.UTF16=function(n,e,a){for(var s=[],l=a/2,o=0;o<l;o++,e+=2)s[o]=n.getUint16(e);return String.fromCharCode.apply(null,s)};He.UTF16=function(n){for(var e=[],a=0;a<n.length;a+=1){var s=n.charCodeAt(a);e[e.length]=s>>8&255,e[e.length]=s&255}return e};ht.UTF16=function(n){return n.length*2};var Zf={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};pl.MACSTRING=function(n,e,a,s){var l=Zf[s];if(l!==void 0){for(var o="",u=0;u<a;u++){var h=n.getUint8(e+u);h<=127?o+=String.fromCharCode(h):o+=l[h&127]}return o}};var wc=typeof WeakMap=="function"&&new WeakMap,Ec,cb=function(n){if(!Ec){Ec={};for(var e in Zf)Ec[e]=new String(e)}var a=Ec[n];if(a!==void 0){if(wc){var s=wc.get(a);if(s!==void 0)return s}var l=Zf[n];if(l!==void 0){for(var o={},u=0;u<l.length;u++)o[l.charCodeAt(u)]=u+128;return wc&&wc.set(a,o),o}}};He.MACSTRING=function(n,e){var a=cb(e);if(a!==void 0){for(var s=[],l=0;l<n.length;l++){var o=n.charCodeAt(l);if(o>=128&&(o=a[o],o===void 0))return;s[l]=o}return s}};ht.MACSTRING=function(n,e){var a=He.MACSTRING(n,e);return a!==void 0?a.length:0};function Qf(n){return n>=-128&&n<=127}function ub(n,e,a){for(var s=0,l=n.length;e<l&&s<64&&n[e]===0;)++e,++s;return a.push(128|s-1),e}function fb(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(!Qf(u)||u===0&&o+1<l&&n[o+1]===0)break;++o,++s}a.push(s-1);for(var h=e;h<o;++h)a.push(n[h]+256&255);return o}function db(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(u===0||Qf(u)&&o+1<l&&Qf(n[o+1]))break;++o,++s}a.push(64|s-1);for(var h=e;h<o;++h){var p=n[h];a.push(p+65536>>8&255,p+256&255)}return o}He.VARDELTAS=function(n){for(var e=0,a=[];e<n.length;){var s=n[e];s===0?e=ub(n,e,a):s>=-128&&s<=127?e=fb(n,e,a):e=db(n,e,a)}return a};He.INDEX=function(n){for(var e=1,a=[e],s=[],l=0;l<n.length;l+=1){var o=He.OBJECT(n[l]);Array.prototype.push.apply(s,o),e+=o.length,a.push(e)}if(s.length===0)return[0,0];for(var u=[],h=1+Math.floor(Math.log(e)/Math.log(2))/8|0,p=[void 0,He.BYTE,He.USHORT,He.UINT24,He.ULONG][h],g=0;g<a.length;g+=1){var v=p(a[g]);Array.prototype.push.apply(u,v)}return Array.prototype.concat(He.Card16(n.length),He.OffSize(h),u,s)};ht.INDEX=function(n){return He.INDEX(n).length};He.DICT=function(n){for(var e=[],a=Object.keys(n),s=a.length,l=0;l<s;l+=1){var o=parseInt(a[l],0),u=n[o];e=e.concat(He.OPERAND(u.value,u.type)),e=e.concat(He.OPERATOR(o))}return e};ht.DICT=function(n){return He.DICT(n).length};He.OPERATOR=function(n){return n<1200?[n]:[12,n-1200]};He.OPERAND=function(n,e){var a=[];if(Array.isArray(e))for(var s=0;s<e.length;s+=1)ft.argument(n.length===e.length,"Not enough arguments given for type"+e),a=a.concat(He.OPERAND(n[s],e[s]));else if(e==="SID")a=a.concat(He.NUMBER(n));else if(e==="offset")a=a.concat(He.NUMBER32(n));else if(e==="number")a=a.concat(He.NUMBER(n));else if(e==="real")a=a.concat(He.REAL(n));else throw new Error("Unknown operand type "+e);return a};He.OP=He.BYTE;ht.OP=ht.BYTE;var Ac=typeof WeakMap=="function"&&new WeakMap;He.CHARSTRING=function(n){if(Ac){var e=Ac.get(n);if(e!==void 0)return e}for(var a=[],s=n.length,l=0;l<s;l+=1){var o=n[l];a=a.concat(He[o.type](o.value))}return Ac&&Ac.set(n,a),a};ht.CHARSTRING=function(n){return He.CHARSTRING(n).length};He.OBJECT=function(n){var e=He[n.type];return ft.argument(e!==void 0,"No encoding function for type "+n.type),e(n.value)};ht.OBJECT=function(n){var e=ht[n.type];return ft.argument(e!==void 0,"No sizeOf function for type "+n.type),e(n.value)};He.TABLE=function(n){for(var e=[],a=n.fields.length,s=[],l=[],o=0;o<a;o+=1){var u=n.fields[o],h=He[u.type];ft.argument(h!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var p=n[u.name];p===void 0&&(p=u.value);var g=h(p);u.type==="TABLE"?(l.push(e.length),e=e.concat([0,0]),s.push(g)):e=e.concat(g)}for(var v=0;v<s.length;v+=1){var A=l[v],S=e.length;ft.argument(S<65536,"Table "+n.tableName+" too big."),e[A]=S>>8,e[A+1]=S&255,e=e.concat(s[v])}return e};ht.TABLE=function(n){for(var e=0,a=n.fields.length,s=0;s<a;s+=1){var l=n.fields[s],o=ht[l.type];ft.argument(o!==void 0,"No sizeOf function for field type "+l.type+" ("+l.name+")");var u=n[l.name];u===void 0&&(u=l.value),e+=o(u),l.type==="TABLE"&&(e+=2)}return e};He.RECORD=He.TABLE;ht.RECORD=ht.TABLE;He.LITERAL=function(n){return n};ht.LITERAL=function(n){return n.length};function Pn(n,e,a){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var s=0;s<e.length;s+=1){var l=e[s];this[l.name]=l.value}if(this.tableName=n,this.fields=e,a)for(var o=Object.keys(a),u=0;u<o.length;u+=1){var h=o[u],p=a[h];this[h]!==void 0&&(this[h]=p)}}Pn.prototype.encode=function(){return He.TABLE(this)};Pn.prototype.sizeOf=function(){return ht.TABLE(this)};function po(n,e,a){a===void 0&&(a=e.length);var s=new Array(e.length+1);s[0]={name:n+"Count",type:"USHORT",value:a};for(var l=0;l<e.length;l++)s[l+1]={name:n+l,type:"USHORT",value:e[l]};return s}function Kf(n,e,a){var s=e.length,l=new Array(s+1);l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l[o+1]={name:n+o,type:"TABLE",value:a(e[o],o)};return l}function ho(n,e,a){var s=e.length,l=[];l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l=l.concat(a(e[o],o));return l}function Rc(n){n.format===1?Pn.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(po("glyph",n.glyphs))):n.format===2?Pn.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(ho("rangeRecord",n.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):ft.assert(!1,"Coverage format must be 1 or 2.")}Rc.prototype=Object.create(Pn.prototype);Rc.prototype.constructor=Rc;function Dc(n){Pn.call(this,"scriptListTable",ho("scriptRecord",n,function(e,a){var s=e.script,l=s.defaultLangSys;return ft.assert(!!l,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+a,type:"TAG",value:e.tag},{name:"script"+a,type:"TABLE",value:new Pn("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Pn("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(po("featureIndex",l.featureIndexes)))}].concat(ho("langSys",s.langSysRecords,function(o,u){var h=o.langSys;return[{name:"langSysTag"+u,type:"TAG",value:o.tag},{name:"langSys"+u,type:"TABLE",value:new Pn("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:h.reqFeatureIndex}].concat(po("featureIndex",h.featureIndexes)))}]})))}]}))}Dc.prototype=Object.create(Pn.prototype);Dc.prototype.constructor=Dc;function _c(n){Pn.call(this,"featureListTable",ho("featureRecord",n,function(e,a){var s=e.feature;return[{name:"featureTag"+a,type:"TAG",value:e.tag},{name:"feature"+a,type:"TABLE",value:new Pn("featureTable",[{name:"featureParams",type:"USHORT",value:s.featureParams}].concat(po("lookupListIndex",s.lookupListIndexes)))}]}))}_c.prototype=Object.create(Pn.prototype);_c.prototype.constructor=_c;function Oc(n,e){Pn.call(this,"lookupListTable",Kf("lookup",n,function(a){var s=e[a.lookupType];return ft.assert(!!s,"Unable to write GSUB lookup type "+a.lookupType+" tables."),new Pn("lookupTable",[{name:"lookupType",type:"USHORT",value:a.lookupType},{name:"lookupFlag",type:"USHORT",value:a.lookupFlag}].concat(Kf("subtable",a.subtables,s)))}))}Oc.prototype=Object.create(Pn.prototype);Oc.prototype.constructor=Oc;var Xe={Table:Pn,Record:Pn,Coverage:Rc,ScriptList:Dc,FeatureList:_c,LookupList:Oc,ushortList:po,tableList:Kf,recordList:ho};function em(n,e){return n.getUint8(e)}function Ic(n,e){return n.getUint16(e,!1)}function pb(n,e){return n.getInt16(e,!1)}function pd(n,e){return n.getUint32(e,!1)}function dg(n,e){var a=n.getInt16(e,!1),s=n.getUint16(e+2,!1);return a+s/65535}function hb(n,e){for(var a="",s=e;s<e+4;s+=1)a+=String.fromCharCode(n.getInt8(s));return a}function mb(n,e,a){for(var s=0,l=0;l<a;l+=1)s<<=8,s+=n.getUint8(e+l);return s}function gb(n,e,a){for(var s=[],l=e;l<a;l+=1)s.push(n.getUint8(l));return s}function yb(n){for(var e="",a=0;a<n.length;a+=1)e+=String.fromCharCode(n[a]);return e}var vb={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function be(n,e){this.data=n,this.offset=e,this.relativeOffset=0}be.prototype.parseByte=function(){var n=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};be.prototype.parseChar=function(){var n=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};be.prototype.parseCard8=be.prototype.parseByte;be.prototype.parseUShort=function(){var n=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};be.prototype.parseCard16=be.prototype.parseUShort;be.prototype.parseSID=be.prototype.parseUShort;be.prototype.parseOffset16=be.prototype.parseUShort;be.prototype.parseShort=function(){var n=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};be.prototype.parseF2Dot14=function(){var n=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,n};be.prototype.parseULong=function(){var n=pd(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};be.prototype.parseOffset32=be.prototype.parseULong;be.prototype.parseFixed=function(){var n=dg(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};be.prototype.parseString=function(n){var e=this.data,a=this.offset+this.relativeOffset,s="";this.relativeOffset+=n;for(var l=0;l<n;l++)s+=String.fromCharCode(e.getUint8(a+l));return s};be.prototype.parseTag=function(){return this.parseString(4)};be.prototype.parseLongDateTime=function(){var n=pd(this.data,this.offset+this.relativeOffset+4);return n-=2082844800,this.relativeOffset+=8,n};be.prototype.parseVersion=function(n){var e=Ic(this.data,this.offset+this.relativeOffset),a=Ic(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,n===void 0&&(n=4096),e+a/n/10};be.prototype.skip=function(n,e){e===void 0&&(e=1),this.relativeOffset+=vb[n]*e};be.prototype.parseULongList=function(n){n===void 0&&(n=this.parseULong());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint32(s),s+=4;return this.relativeOffset+=n*4,e};be.prototype.parseOffset16List=be.prototype.parseUShortList=function(n){n===void 0&&(n=this.parseUShort());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint16(s),s+=2;return this.relativeOffset+=n*2,e};be.prototype.parseShortList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getInt16(s),s+=2;return this.relativeOffset+=n*2,e};be.prototype.parseByteList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint8(s++);return this.relativeOffset+=n,e};be.prototype.parseList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};be.prototype.parseList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};be.prototype.parseRecordList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var h=s[u],p=e[h];o[h]=p.call(this)}a[l]=o}return a};be.prototype.parseRecordList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var h=s[u],p=e[h];o[h]=p.call(this)}a[l]=o}return a};be.prototype.parseStruct=function(n){if(typeof n=="function")return n.call(this);for(var e=Object.keys(n),a={},s=0;s<e.length;s++){var l=e[s],o=n[l];a[l]=o.call(this)}return a};be.prototype.parseValueRecord=function(n){if(n===void 0&&(n=this.parseUShort()),n!==0){var e={};return n&1&&(e.xPlacement=this.parseShort()),n&2&&(e.yPlacement=this.parseShort()),n&4&&(e.xAdvance=this.parseShort()),n&8&&(e.yAdvance=this.parseShort()),n&16&&(e.xPlaDevice=void 0,this.parseShort()),n&32&&(e.yPlaDevice=void 0,this.parseShort()),n&64&&(e.xAdvDevice=void 0,this.parseShort()),n&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};be.prototype.parseValueRecordList=function(){for(var n=this.parseUShort(),e=this.parseUShort(),a=new Array(e),s=0;s<e;s++)a[s]=this.parseValueRecord(n);return a};be.prototype.parsePointer=function(n){var e=this.parseOffset16();if(e>0)return new be(this.data,this.offset+e).parseStruct(n)};be.prototype.parsePointer32=function(n){var e=this.parseOffset32();if(e>0)return new be(this.data,this.offset+e).parseStruct(n)};be.prototype.parseListOfLists=function(n){for(var e=this.parseOffset16List(),a=e.length,s=this.relativeOffset,l=new Array(a),o=0;o<a;o++){var u=e[o];if(u===0){l[o]=void 0;continue}if(this.relativeOffset=u,n){for(var h=this.parseOffset16List(),p=new Array(h.length),g=0;g<h.length;g++)this.relativeOffset=u+h[g],p[g]=n.call(this);l[o]=p}else l[o]=this.parseUShortList()}return this.relativeOffset=s,l};be.prototype.parseCoverage=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort(),a=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(a)};if(e===2){for(var s=new Array(a),l=0;l<a;l++)s[l]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:s}}throw new Error("0x"+n.toString(16)+": Coverage format must be 1 or 2.")};be.prototype.parseClassDef=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:be.uShort,end:be.uShort,classId:be.uShort})};throw new Error("0x"+n.toString(16)+": ClassDef format must be 1 or 2.")};be.list=function(n,e){return function(){return this.parseList(n,e)}};be.list32=function(n,e){return function(){return this.parseList32(n,e)}};be.recordList=function(n,e){return function(){return this.parseRecordList(n,e)}};be.recordList32=function(n,e){return function(){return this.parseRecordList32(n,e)}};be.pointer=function(n){return function(){return this.parsePointer(n)}};be.pointer32=function(n){return function(){return this.parsePointer32(n)}};be.tag=be.prototype.parseTag;be.byte=be.prototype.parseByte;be.uShort=be.offset16=be.prototype.parseUShort;be.uShortList=be.prototype.parseUShortList;be.uLong=be.offset32=be.prototype.parseULong;be.uLongList=be.prototype.parseULongList;be.struct=be.prototype.parseStruct;be.coverage=be.prototype.parseCoverage;be.classDef=be.prototype.parseClassDef;var tm={reserved:be.uShort,reqFeatureIndex:be.uShort,featureIndexes:be.uShortList};be.prototype.parseScriptList=function(){return this.parsePointer(be.recordList({tag:be.tag,script:be.pointer({defaultLangSys:be.pointer(tm),langSysRecords:be.recordList({tag:be.tag,langSys:be.pointer(tm)})})}))||[]};be.prototype.parseFeatureList=function(){return this.parsePointer(be.recordList({tag:be.tag,feature:be.pointer({featureParams:be.offset16,lookupListIndexes:be.uShortList})}))||[]};be.prototype.parseLookupList=function(n){return this.parsePointer(be.list(be.pointer(function(){var e=this.parseUShort();ft.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var a=this.parseUShort(),s=a&16;return{lookupType:e,lookupFlag:a,subtables:this.parseList(be.pointer(n[e])),markFilteringSet:s?this.parseUShort():void 0}})))||[]};be.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var n=this.parseUShort(),e=this.parseUShort();ft.argument(n===1&&e<1,"GPOS/GSUB feature variations table unknown.");var a=this.parseRecordList32({conditionSetOffset:be.offset32,featureTableSubstitutionOffset:be.offset32});return a})||[]};var Qe={getByte:em,getCard8:em,getUShort:Ic,getCard16:Ic,getShort:pb,getULong:pd,getFixed:dg,getTag:hb,getOffset:mb,getBytes:gb,bytesToString:yb,Parser:be};function bb(n,e){e.parseUShort(),n.length=e.parseULong(),n.language=e.parseULong();var a;n.groupCount=a=e.parseULong(),n.glyphIndexMap={};for(var s=0;s<a;s+=1)for(var l=e.parseULong(),o=e.parseULong(),u=e.parseULong(),h=l;h<=o;h+=1)n.glyphIndexMap[h]=u,u++}function xb(n,e,a,s,l){n.length=e.parseUShort(),n.language=e.parseUShort();var o;n.segCount=o=e.parseUShort()>>1,e.skip("uShort",3),n.glyphIndexMap={};for(var u=new Qe.Parser(a,s+l+14),h=new Qe.Parser(a,s+l+16+o*2),p=new Qe.Parser(a,s+l+16+o*4),g=new Qe.Parser(a,s+l+16+o*6),v=s+l+16+o*8,A=0;A<o-1;A+=1)for(var S=void 0,b=u.parseUShort(),M=h.parseUShort(),D=p.parseShort(),L=g.parseUShort(),B=M;B<=b;B+=1)L!==0?(v=g.offset+g.relativeOffset-2,v+=L,v+=(B-M)*2,S=Qe.getUShort(a,v),S!==0&&(S=S+D&65535)):S=B+D&65535,n.glyphIndexMap[B]=S}function Sb(n,e){var a={};a.version=Qe.getUShort(n,e),ft.argument(a.version===0,"cmap table version should be 0."),a.numTables=Qe.getUShort(n,e+2);for(var s=-1,l=a.numTables-1;l>=0;l-=1){var o=Qe.getUShort(n,e+4+l*8),u=Qe.getUShort(n,e+4+l*8+2);if(o===3&&(u===0||u===1||u===10)||o===0&&(u===0||u===1||u===2||u===3||u===4)){s=Qe.getULong(n,e+4+l*8+4);break}}if(s===-1)throw new Error("No valid cmap sub-tables found.");var h=new Qe.Parser(n,e+s);if(a.format=h.parseUShort(),a.format===12)bb(a,h);else if(a.format===4)xb(a,h,n,e,s);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+a.format+").");return a}function wb(n,e,a){n.segments.push({end:e,start:e,delta:-(e-a),offset:0,glyphIndex:a})}function Eb(n){n.segments.push({end:65535,start:65535,delta:1,offset:0})}function Ab(n){var e=!0,a;for(a=n.length-1;a>0;a-=1){var s=n.get(a);if(s.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var l=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(l=l.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),l=l.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new Xe.Table("cmap",l);for(o.segments=[],a=0;a<n.length;a+=1){for(var u=n.get(a),h=0;h<u.unicodes.length;h+=1)wb(o,u.unicodes[h],a);o.segments=o.segments.sort(function(Q,_){return Q.start-_.start})}Eb(o);var p=o.segments.length,g=0,v=[],A=[],S=[],b=[],M=[],D=[];for(a=0;a<p;a+=1){var L=o.segments[a];L.end<=65535&&L.start<=65535?(v=v.concat({name:"end_"+a,type:"USHORT",value:L.end}),A=A.concat({name:"start_"+a,type:"USHORT",value:L.start}),S=S.concat({name:"idDelta_"+a,type:"SHORT",value:L.delta}),b=b.concat({name:"idRangeOffset_"+a,type:"USHORT",value:L.offset}),L.glyphId!==void 0&&(M=M.concat({name:"glyph_"+a,type:"USHORT",value:L.glyphId}))):g+=1,!e&&L.glyphIndex!==void 0&&(D=D.concat({name:"cmap12Start_"+a,type:"ULONG",value:L.start}),D=D.concat({name:"cmap12End_"+a,type:"ULONG",value:L.end}),D=D.concat({name:"cmap12Glyph_"+a,type:"ULONG",value:L.glyphIndex}))}if(o.segCountX2=(p-g)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(p-g)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(v),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(A),o.fields=o.fields.concat(S),o.fields=o.fields.concat(b),o.fields=o.fields.concat(M),o.cmap4Length=14+v.length*2+2+A.length*2+S.length*2+b.length*2+M.length*2,!e){var B=16+D.length*4;o.cmap12Offset=20+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:B},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:D.length/3}]),o.fields=o.fields.concat(D)}return o}var pg={parse:Sb,make:Ab},Mc=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Tb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Cb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ei=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function hg(n){this.font=n}hg.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.font.glyphs;if(a){for(var s=0;s<a.length;s+=1)for(var l=a.get(s),o=0;o<l.unicodes.length;o+=1)if(l.unicodes[o]===e)return s}return null};function mg(n){this.cmap=n}mg.prototype.charToGlyphIndex=function(n){return this.cmap.glyphIndexMap[n.codePointAt(0)]||0};function Lc(n,e){this.encoding=n,this.charset=e}Lc.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.encoding[e];return this.charset.indexOf(a)};function hd(n){switch(n.version){case 1:this.names=Ei.slice();break;case 2:this.names=new Array(n.numberOfGlyphs);for(var e=0;e<n.numberOfGlyphs;e++)n.glyphNameIndex[e]<Ei.length?this.names[e]=Ei[n.glyphNameIndex[e]]:this.names[e]=n.names[n.glyphNameIndex[e]-Ei.length];break;case 2.5:this.names=new Array(n.numberOfGlyphs);for(var a=0;a<n.numberOfGlyphs;a++)this.names[a]=Ei[a+n.glyphNameIndex[a]];break;case 3:this.names=[];break;default:this.names=[];break}}hd.prototype.nameToGlyphIndex=function(n){return this.names.indexOf(n)};hd.prototype.glyphIndexToName=function(n){return this.names[n]};function Mb(n){for(var e,a=n.tables.cmap.glyphIndexMap,s=Object.keys(a),l=0;l<s.length;l+=1){var o=s[l],u=a[o];e=n.glyphs.get(u),e.addUnicode(parseInt(o))}for(var h=0;h<n.glyphs.length;h+=1)e=n.glyphs.get(h),n.cffEncoding?n.isCIDFont?e.name="gid"+h:e.name=n.cffEncoding.charset[h]:n.glyphNames.names&&(e.name=n.glyphNames.glyphIndexToName(h))}function kb(n){n._IndexToUnicodeMap={};for(var e=n.tables.cmap.glyphIndexMap,a=Object.keys(e),s=0;s<a.length;s+=1){var l=a[s],o=e[l];n._IndexToUnicodeMap[o]===void 0?n._IndexToUnicodeMap[o]={unicodes:[parseInt(l)]}:n._IndexToUnicodeMap[o].unicodes.push(parseInt(l))}}function Nb(n,e){e.lowMemory?kb(n):Mb(n)}function Rb(n,e,a,s,l){n.beginPath(),n.moveTo(e,a),n.lineTo(s,l),n.stroke()}var Si={line:Rb};function Db(n,e){var a=e||new An;return{configurable:!0,get:function(){return typeof a=="function"&&(a=a()),a},set:function(s){a=s}}}function Ha(n){this.bindConstructorValues(n)}Ha.prototype.bindConstructorValues=function(n){this.index=n.index||0,this.name=n.name||null,this.unicode=n.unicode||void 0,this.unicodes=n.unicodes||n.unicode!==void 0?[n.unicode]:[],"xMin"in n&&(this.xMin=n.xMin),"yMin"in n&&(this.yMin=n.yMin),"xMax"in n&&(this.xMax=n.xMax),"yMax"in n&&(this.yMax=n.yMax),"advanceWidth"in n&&(this.advanceWidth=n.advanceWidth),Object.defineProperty(this,"path",Db(this,n.path))};Ha.prototype.addUnicode=function(n){this.unicodes.length===0&&(this.unicode=n),this.unicodes.push(n)};Ha.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Ha.prototype.getPath=function(n,e,a,s,l){n=n!==void 0?n:0,e=e!==void 0?e:0,a=a!==void 0?a:72;var o,u;s||(s={});var h=s.xScale,p=s.yScale;if(s.hinting&&l&&l.hinting&&(u=this.path&&l.hinting.exec(this,a)),u)o=l.hinting.getCommands(u),n=Math.round(n),e=Math.round(e),h=p=1;else{o=this.path.commands;var g=1/(this.path.unitsPerEm||1e3)*a;h===void 0&&(h=g),p===void 0&&(p=g)}for(var v=new An,A=0;A<o.length;A+=1){var S=o[A];S.type==="M"?v.moveTo(n+S.x*h,e+-S.y*p):S.type==="L"?v.lineTo(n+S.x*h,e+-S.y*p):S.type==="Q"?v.quadraticCurveTo(n+S.x1*h,e+-S.y1*p,n+S.x*h,e+-S.y*p):S.type==="C"?v.curveTo(n+S.x1*h,e+-S.y1*p,n+S.x2*h,e+-S.y2*p,n+S.x*h,e+-S.y*p):S.type==="Z"&&v.closePath()}return v};Ha.prototype.getContours=function(){if(this.points===void 0)return[];for(var n=[],e=[],a=0;a<this.points.length;a+=1){var s=this.points[a];e.push(s),s.lastPointOfContour&&(n.push(e),e=[])}return ft.argument(e.length===0,"There are still points left in the current contour."),n};Ha.prototype.getMetrics=function(){for(var n=this.path.commands,e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];l.type!=="Z"&&(e.push(l.x),a.push(l.y)),(l.type==="Q"||l.type==="C")&&(e.push(l.x1),a.push(l.y1)),l.type==="C"&&(e.push(l.x2),a.push(l.y2))}var o={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,a),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o};Ha.prototype.draw=function(n,e,a,s,l){this.getPath(e,a,s,l).draw(n)};Ha.prototype.drawPoints=function(n,e,a,s){function l(A,S,b,M){n.beginPath();for(var D=0;D<A.length;D+=1)n.moveTo(S+A[D].x*M,b+A[D].y*M),n.arc(S+A[D].x*M,b+A[D].y*M,2,0,Math.PI*2,!1);n.closePath(),n.fill()}e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24;for(var o=1/this.path.unitsPerEm*s,u=[],h=[],p=this.path,g=0;g<p.commands.length;g+=1){var v=p.commands[g];v.x!==void 0&&u.push({x:v.x,y:-v.y}),v.x1!==void 0&&h.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&h.push({x:v.x2,y:-v.y2})}n.fillStyle="blue",l(u,e,a,o),n.fillStyle="red",l(h,e,a,o)};Ha.prototype.drawMetrics=function(n,e,a,s){var l;e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24,l=1/this.path.unitsPerEm*s,n.lineWidth=1,n.strokeStyle="black",Si.line(n,e,-1e4,e,1e4),Si.line(n,-1e4,a,1e4,a);var o=this.xMin||0,u=this.yMin||0,h=this.xMax||0,p=this.yMax||0,g=this.advanceWidth||0;n.strokeStyle="blue",Si.line(n,e+o*l,-1e4,e+o*l,1e4),Si.line(n,e+h*l,-1e4,e+h*l,1e4),Si.line(n,-1e4,a+-u*l,1e4,a+-u*l),Si.line(n,-1e4,a+-p*l,1e4,a+-p*l),n.strokeStyle="green",Si.line(n,e+g*l,-1e4,e+g*l,1e4)};function Tc(n,e,a){Object.defineProperty(n,e,{get:function(){return n.path,n[a]},set:function(s){n[a]=s},enumerable:!0,configurable:!0})}function md(n,e){if(this.font=n,this.glyphs={},Array.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];s.path.unitsPerEm=n.unitsPerEm,this.glyphs[a]=s}this.length=e&&e.length||0}md.prototype.get=function(n){if(this.glyphs[n]===void 0){this.font._push(n),typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());var e=this.glyphs[n],a=this.font._IndexToUnicodeMap[n];if(a)for(var s=0;s<a.unicodes.length;s++)e.addUnicode(a.unicodes[s]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+n:e.name=this.font.cffEncoding.charset[n]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(n)),this.glyphs[n].advanceWidth=this.font._hmtxTableData[n].advanceWidth,this.glyphs[n].leftSideBearing=this.font._hmtxTableData[n].leftSideBearing}else typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());return this.glyphs[n]};md.prototype.push=function(n,e){this.glyphs[n]=e,this.length++};function _b(n,e){return new Ha({index:e,font:n})}function Ob(n,e,a,s,l,o){return function(){var u=new Ha({index:e,font:n});return u.path=function(){a(u,s,l);var h=o(n.glyphs,u);return h.unitsPerEm=n.unitsPerEm,h},Tc(u,"xMin","_xMin"),Tc(u,"xMax","_xMax"),Tc(u,"yMin","_yMin"),Tc(u,"yMax","_yMax"),u}}function Ib(n,e,a,s){return function(){var l=new Ha({index:e,font:n});return l.path=function(){var o=a(n,l,s);return o.unitsPerEm=n.unitsPerEm,o},l}}var Xr={GlyphSet:md,glyphLoader:_b,ttfGlyphLoader:Ob,cffGlyphLoader:Ib};function gg(n,e){if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var a=0;a<n.length;a+=1)if(!gg(n[a],e[a]))return!1;return!0}else return!1}function Jf(n){var e;return n.length<1240?e=107:n.length<33900?e=1131:e=32768,e}function Ws(n,e,a){var s=[],l=[],o=Qe.getCard16(n,e),u,h;if(o!==0){var p=Qe.getByte(n,e+2);u=e+(o+1)*p+2;for(var g=e+3,v=0;v<o+1;v+=1)s.push(Qe.getOffset(n,g,p)),g+=p;h=u+s[o]}else h=e+2;for(var A=0;A<s.length-1;A+=1){var S=Qe.getBytes(n,u+s[A],u+s[A+1]);a&&(S=a(S)),l.push(S)}return{objects:l,startOffset:e,endOffset:h}}function Lb(n,e){var a=[],s=Qe.getCard16(n,e),l,o;if(s!==0){var u=Qe.getByte(n,e+2);l=e+(s+1)*u+2;for(var h=e+3,p=0;p<s+1;p+=1)a.push(Qe.getOffset(n,h,u)),h+=u;o=l+a[s]}else o=e+2;return{offsets:a,startOffset:e,endOffset:o}}function jb(n,e,a,s,l){var o=Qe.getCard16(a,s),u=0;if(o!==0){var h=Qe.getByte(a,s+2);u=s+(o+1)*h+2}var p=Qe.getBytes(a,u+e[n],u+e[n+1]);return p}function Ub(n){for(var e="",a=15,s=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var l=n.parseByte(),o=l>>4,u=l&15;if(o===a||(e+=s[o],u===a))break;e+=s[u]}return parseFloat(e)}function Bb(n,e){var a,s,l,o;if(e===28)return a=n.parseByte(),s=n.parseByte(),a<<8|s;if(e===29)return a=n.parseByte(),s=n.parseByte(),l=n.parseByte(),o=n.parseByte(),a<<24|s<<16|l<<8|o;if(e===30)return Ub(n);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return a=n.parseByte(),(e-247)*256+a+108;if(e>=251&&e<=254)return a=n.parseByte(),-(e-251)*256-a-108;throw new Error("Invalid b0 "+e)}function Fb(n){for(var e={},a=0;a<n.length;a+=1){var s=n[a][0],l=n[a][1],o=void 0;if(l.length===1?o=l[0]:o=l,e.hasOwnProperty(s)&&!isNaN(e[s]))throw new Error("Object "+e+" already has key "+s);e[s]=o}return e}function yg(n,e,a){e=e!==void 0?e:0;var s=new Qe.Parser(n,e),l=[],o=[];for(a=a!==void 0?a:n.length;s.relativeOffset<a;){var u=s.parseByte();u<=21?(u===12&&(u=1200+s.parseByte()),l.push([u,o]),o=[]):o.push(Bb(s,u))}return Fb(l)}function lo(n,e){return e<=390?e=Mc[e]:e=n[e-391],e}function vg(n,e,a){for(var s={},l,o=0;o<e.length;o+=1){var u=e[o];if(Array.isArray(u.type)){var h=[];h.length=u.type.length;for(var p=0;p<u.type.length;p++)l=n[u.op]!==void 0?n[u.op][p]:void 0,l===void 0&&(l=u.value!==void 0&&u.value[p]!==void 0?u.value[p]:null),u.type[p]==="SID"&&(l=lo(a,l)),h[p]=l;s[u.name]=h}else l=n[u.op],l===void 0&&(l=u.value!==void 0?u.value:null),u.type==="SID"&&(l=lo(a,l)),s[u.name]=l}return s}function Pb(n,e){var a={};return a.formatMajor=Qe.getCard8(n,e),a.formatMinor=Qe.getCard8(n,e+1),a.size=Qe.getCard8(n,e+2),a.offsetSize=Qe.getCard8(n,e+3),a.startOffset=e,a.endOffset=e+4,a}var bg=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],xg=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function zb(n,e){var a=yg(n,0,n.byteLength);return vg(a,bg,e)}function Sg(n,e,a,s){var l=yg(n,e,a);return vg(l,xg,s)}function nm(n,e,a,s){for(var l=[],o=0;o<a.length;o+=1){var u=new DataView(new Uint8Array(a[o]).buffer),h=zb(u,s);h._subrs=[],h._subrsBias=0,h._defaultWidthX=0,h._nominalWidthX=0;var p=h.private[0],g=h.private[1];if(p!==0&&g!==0){var v=Sg(n,g+e,p,s);if(h._defaultWidthX=v.defaultWidthX,h._nominalWidthX=v.nominalWidthX,v.subrs!==0){var A=g+v.subrs,S=Ws(n,A+e);h._subrs=S.objects,h._subrsBias=Jf(h._subrs)}h._privateDict=v}l.push(h)}return l}function Gb(n,e,a,s){var l,o,u=new Qe.Parser(n,e);a-=1;var h=[".notdef"],p=u.parseCard8();if(p===0)for(var g=0;g<a;g+=1)l=u.parseSID(),h.push(lo(s,l));else if(p===1)for(;h.length<=a;){l=u.parseSID(),o=u.parseCard8();for(var v=0;v<=o;v+=1)h.push(lo(s,l)),l+=1}else if(p===2)for(;h.length<=a;){l=u.parseSID(),o=u.parseCard16();for(var A=0;A<=o;A+=1)h.push(lo(s,l)),l+=1}else throw new Error("Unknown charset format "+p);return h}function Hb(n,e,a){var s,l={},o=new Qe.Parser(n,e),u=o.parseCard8();if(u===0)for(var h=o.parseCard8(),p=0;p<h;p+=1)s=o.parseCard8(),l[s]=p;else if(u===1){var g=o.parseCard8();s=1;for(var v=0;v<g;v+=1)for(var A=o.parseCard8(),S=o.parseCard8(),b=A;b<=A+S;b+=1)l[b]=s,s+=1}else throw new Error("Unknown encoding format "+u);return new Lc(l,a)}function am(n,e,a){var s,l,o,u,h=new An,p=[],g=0,v=!1,A=!1,S=0,b=0,M,D,L,B;if(n.isCIDFont){var Q=n.tables.cff.topDict._fdSelect[e.index],_=n.tables.cff.topDict._fdArray[Q];M=_._subrs,D=_._subrsBias,L=_._defaultWidthX,B=_._nominalWidthX}else M=n.tables.cff.topDict._subrs,D=n.tables.cff.topDict._subrsBias,L=n.tables.cff.topDict._defaultWidthX,B=n.tables.cff.topDict._nominalWidthX;var U=L;function I(te,oe){A&&h.closePath(),h.moveTo(te,oe),A=!0}function P(){var te;te=p.length%2!==0,te&&!v&&(U=p.shift()+B),g+=p.length>>1,p.length=0,v=!0}function Y(te){for(var oe,W,O,$,z,K,re,V,ee,se,ge,Z,J=0;J<te.length;){var Se=te[J];switch(J+=1,Se){case 1:P();break;case 3:P();break;case 4:p.length>1&&!v&&(U=p.shift()+B,v=!0),b+=p.pop(),I(S,b);break;case 5:for(;p.length>0;)S+=p.shift(),b+=p.shift(),h.lineTo(S,b);break;case 6:for(;p.length>0&&(S+=p.shift(),h.lineTo(S,b),p.length!==0);)b+=p.shift(),h.lineTo(S,b);break;case 7:for(;p.length>0&&(b+=p.shift(),h.lineTo(S,b),p.length!==0);)S+=p.shift(),h.lineTo(S,b);break;case 8:for(;p.length>0;)s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u+p.shift(),h.curveTo(s,l,o,u,S,b);break;case 10:z=p.pop()+D,K=M[z],K&&Y(K);break;case 11:return;case 12:switch(Se=te[J],J+=1,Se){case 35:s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),re=o+p.shift(),V=u+p.shift(),ee=re+p.shift(),se=V+p.shift(),ge=ee+p.shift(),Z=se+p.shift(),S=ge+p.shift(),b=Z+p.shift(),p.shift(),h.curveTo(s,l,o,u,re,V),h.curveTo(ee,se,ge,Z,S,b);break;case 34:s=S+p.shift(),l=b,o=s+p.shift(),u=l+p.shift(),re=o+p.shift(),V=u,ee=re+p.shift(),se=u,ge=ee+p.shift(),Z=b,S=ge+p.shift(),h.curveTo(s,l,o,u,re,V),h.curveTo(ee,se,ge,Z,S,b);break;case 36:s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),re=o+p.shift(),V=u,ee=re+p.shift(),se=u,ge=ee+p.shift(),Z=se+p.shift(),S=ge+p.shift(),h.curveTo(s,l,o,u,re,V),h.curveTo(ee,se,ge,Z,S,b);break;case 37:s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),re=o+p.shift(),V=u+p.shift(),ee=re+p.shift(),se=V+p.shift(),ge=ee+p.shift(),Z=se+p.shift(),Math.abs(ge-S)>Math.abs(Z-b)?S=ge+p.shift():b=Z+p.shift(),h.curveTo(s,l,o,u,re,V),h.curveTo(ee,se,ge,Z,S,b);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Se),p.length=0}break;case 14:p.length>0&&!v&&(U=p.shift()+B,v=!0),A&&(h.closePath(),A=!1);break;case 18:P();break;case 19:case 20:P(),J+=g+7>>3;break;case 21:p.length>2&&!v&&(U=p.shift()+B,v=!0),b+=p.pop(),S+=p.pop(),I(S,b);break;case 22:p.length>1&&!v&&(U=p.shift()+B,v=!0),S+=p.pop(),I(S,b);break;case 23:P();break;case 24:for(;p.length>2;)s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u+p.shift(),h.curveTo(s,l,o,u,S,b);S+=p.shift(),b+=p.shift(),h.lineTo(S,b);break;case 25:for(;p.length>6;)S+=p.shift(),b+=p.shift(),h.lineTo(S,b);s=S+p.shift(),l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u+p.shift(),h.curveTo(s,l,o,u,S,b);break;case 26:for(p.length%2&&(S+=p.shift());p.length>0;)s=S,l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o,b=u+p.shift(),h.curveTo(s,l,o,u,S,b);break;case 27:for(p.length%2&&(b+=p.shift());p.length>0;)s=S+p.shift(),l=b,o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u,h.curveTo(s,l,o,u,S,b);break;case 28:oe=te[J],W=te[J+1],p.push((oe<<24|W<<16)>>16),J+=2;break;case 29:z=p.pop()+n.gsubrsBias,K=n.gsubrs[z],K&&Y(K);break;case 30:for(;p.length>0&&(s=S,l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,S,b),p.length!==0);)s=S+p.shift(),l=b,o=s+p.shift(),u=l+p.shift(),b=u+p.shift(),S=o+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,S,b);break;case 31:for(;p.length>0&&(s=S+p.shift(),l=b,o=s+p.shift(),u=l+p.shift(),b=u+p.shift(),S=o+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,S,b),p.length!==0);)s=S,l=b+p.shift(),o=s+p.shift(),u=l+p.shift(),S=o+p.shift(),b=u+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,S,b);break;default:Se<32?console.log("Glyph "+e.index+": unknown operator "+Se):Se<247?p.push(Se-139):Se<251?(oe=te[J],J+=1,p.push((Se-247)*256+oe+108)):Se<255?(oe=te[J],J+=1,p.push(-(Se-251)*256-oe-108)):(oe=te[J],W=te[J+1],O=te[J+2],$=te[J+3],J+=4,p.push((oe<<24|W<<16|O<<8|$)/65536))}}}return Y(a),e.advanceWidth=U,h}function Yb(n,e,a,s){var l=[],o,u=new Qe.Parser(n,e),h=u.parseCard8();if(h===0)for(var p=0;p<a;p++){if(o=u.parseCard8(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");l.push(o)}else if(h===3){var g=u.parseCard16(),v=u.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var A,S=0;S<g;S++){if(o=u.parseCard8(),A=u.parseCard16(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");if(A>a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+A);for(;v<A;v++)l.push(o);v=A}if(A!==a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+A)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+h);return l}function Vb(n,e,a,s){a.tables.cff={};var l=Pb(n,e),o=Ws(n,l.endOffset,Qe.bytesToString),u=Ws(n,o.endOffset),h=Ws(n,u.endOffset,Qe.bytesToString),p=Ws(n,h.endOffset);a.gsubrs=p.objects,a.gsubrsBias=Jf(a.gsubrs);var g=nm(n,e,u.objects,h.objects);if(g.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+g.length);var v=g[0];if(a.tables.cff.topDict=v,v._privateDict&&(a.defaultWidthX=v._privateDict.defaultWidthX,a.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(a.isCIDFont=!0),a.isCIDFont){var A=v.fdArray,S=v.fdSelect;if(A===0||S===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");A+=e;var b=Ws(n,A),M=nm(n,e,b.objects,h.objects);v._fdArray=M,S+=e,v._fdSelect=Yb(n,S,a.numGlyphs,M.length)}var D=e+v.private[1],L=Sg(n,D,v.private[0],h.objects);if(a.defaultWidthX=L.defaultWidthX,a.nominalWidthX=L.nominalWidthX,L.subrs!==0){var B=D+L.subrs,Q=Ws(n,B);a.subrs=Q.objects,a.subrsBias=Jf(a.subrs)}else a.subrs=[],a.subrsBias=0;var _;s.lowMemory?(_=Lb(n,e+v.charStrings),a.nGlyphs=_.offsets.length):(_=Ws(n,e+v.charStrings),a.nGlyphs=_.objects.length);var U=Gb(n,e+v.charset,a.nGlyphs,h.objects);if(v.encoding===0?a.cffEncoding=new Lc(Tb,U):v.encoding===1?a.cffEncoding=new Lc(Cb,U):a.cffEncoding=Hb(n,e+v.encoding,U),a.encoding=a.encoding||a.cffEncoding,a.glyphs=new Xr.GlyphSet(a),s.lowMemory)a._push=function(Y){var te=jb(Y,_.offsets,n,e+v.charStrings);a.glyphs.push(Y,Xr.cffGlyphLoader(a,Y,am,te))};else for(var I=0;I<a.nGlyphs;I+=1){var P=_.objects[I];a.glyphs.push(I,Xr.cffGlyphLoader(a,I,am,P))}}function wg(n,e){var a,s=Mc.indexOf(n);return s>=0&&(a=s),s=e.indexOf(n),s>=0?a=s+Mc.length:(a=Mc.length+e.length,e.push(n)),a}function qb(){return new Xe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Xb(n){var e=new Xe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var a=0;a<n.length;a+=1)e.names.push({name:"name_"+a,type:"NAME",value:n[a]});return e}function Eg(n,e,a){for(var s={},l=0;l<n.length;l+=1){var o=n[l],u=e[o.name];u!==void 0&&!gg(u,o.value)&&(o.type==="SID"&&(u=wg(u,a)),s[o.op]={name:o.name,type:o.type,value:u})}return s}function rm(n,e){var a=new Xe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=Eg(bg,n,e),a}function sm(n){var e=new Xe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:n}],e}function $b(n){var e=new Xe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var a=0;a<n.length;a+=1)e.strings.push({name:"string_"+a,type:"STRING",value:n[a]});return e}function Wb(){return new Xe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Zb(n,e){for(var a=new Xe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),s=0;s<n.length;s+=1){var l=n[s],o=wg(l,e);a.fields.push({name:"glyph_"+s,type:"SID",value:o})}return a}function Qb(n){var e=[],a=n.path;e.push({name:"width",type:"NUMBER",value:n.advanceWidth});for(var s=0,l=0,o=0;o<a.commands.length;o+=1){var u=void 0,h=void 0,p=a.commands[o];if(p.type==="Q"){var g=.3333333333333333,v=2/3;p={type:"C",x:p.x,y:p.y,x1:Math.round(g*s+v*p.x1),y1:Math.round(g*l+v*p.y1),x2:Math.round(g*p.x+v*p.x1),y2:Math.round(g*p.y+v*p.y1)}}if(p.type==="M")u=Math.round(p.x-s),h=Math.round(p.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rmoveto",type:"OP",value:21}),s=Math.round(p.x),l=Math.round(p.y);else if(p.type==="L")u=Math.round(p.x-s),h=Math.round(p.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rlineto",type:"OP",value:5}),s=Math.round(p.x),l=Math.round(p.y);else if(p.type==="C"){var A=Math.round(p.x1-s),S=Math.round(p.y1-l),b=Math.round(p.x2-p.x1),M=Math.round(p.y2-p.y1);u=Math.round(p.x-p.x2),h=Math.round(p.y-p.y2),e.push({name:"dx1",type:"NUMBER",value:A}),e.push({name:"dy1",type:"NUMBER",value:S}),e.push({name:"dx2",type:"NUMBER",value:b}),e.push({name:"dy2",type:"NUMBER",value:M}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rrcurveto",type:"OP",value:8}),s=Math.round(p.x),l=Math.round(p.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Kb(n){for(var e=new Xe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),a=0;a<n.length;a+=1){var s=n.get(a),l=Qb(s);e.charStrings.push({name:s.name,type:"CHARSTRING",value:l})}return e}function Jb(n,e){var a=new Xe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=Eg(xg,n,e),a}function ex(n,e){for(var a=new Xe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),s=1/e.unitsPerEm,l={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[s,0,0,s,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},u=[],h,p=1;p<n.length;p+=1)h=n.get(p),u.push(h.name);var g=[];a.header=qb(),a.nameIndex=Xb([e.postScriptName]);var v=rm(l,g);a.topDictIndex=sm(v),a.globalSubrIndex=Wb(),a.charsets=Zb(u,g),a.charStringsIndex=Kb(n),a.privateDict=Jb(o,g),a.stringIndex=$b(g);var A=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return l.charset=A,l.encoding=0,l.charStrings=l.charset+a.charsets.sizeOf(),l.private[1]=l.charStrings+a.charStringsIndex.sizeOf(),v=rm(l,g),a.topDictIndex=sm(v),a}var Ag={parse:Vb,make:ex};function tx(n,e){var a={},s=new Qe.Parser(n,e);return a.version=s.parseVersion(),a.fontRevision=Math.round(s.parseFixed()*1e3)/1e3,a.checkSumAdjustment=s.parseULong(),a.magicNumber=s.parseULong(),ft.argument(a.magicNumber===1594834165,"Font header has wrong magic number."),a.flags=s.parseUShort(),a.unitsPerEm=s.parseUShort(),a.created=s.parseLongDateTime(),a.modified=s.parseLongDateTime(),a.xMin=s.parseShort(),a.yMin=s.parseShort(),a.xMax=s.parseShort(),a.yMax=s.parseShort(),a.macStyle=s.parseUShort(),a.lowestRecPPEM=s.parseUShort(),a.fontDirectionHint=s.parseShort(),a.indexToLocFormat=s.parseShort(),a.glyphDataFormat=s.parseShort(),a}function nx(n){var e=Math.round(new Date().getTime()/1e3)+2082844800,a=e;return n.createdTimestamp&&(a=n.createdTimestamp+2082844800),new Xe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:a},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],n)}var Tg={parse:tx,make:nx};function ax(n,e){var a={},s=new Qe.Parser(n,e);return a.version=s.parseVersion(),a.ascender=s.parseShort(),a.descender=s.parseShort(),a.lineGap=s.parseShort(),a.advanceWidthMax=s.parseUShort(),a.minLeftSideBearing=s.parseShort(),a.minRightSideBearing=s.parseShort(),a.xMaxExtent=s.parseShort(),a.caretSlopeRise=s.parseShort(),a.caretSlopeRun=s.parseShort(),a.caretOffset=s.parseShort(),s.relativeOffset+=8,a.metricDataFormat=s.parseShort(),a.numberOfHMetrics=s.parseUShort(),a}function rx(n){return new Xe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],n)}var Cg={parse:ax,make:rx};function sx(n,e,a,s,l){for(var o,u,h=new Qe.Parser(n,e),p=0;p<s;p+=1){p<a&&(o=h.parseUShort(),u=h.parseShort());var g=l.get(p);g.advanceWidth=o,g.leftSideBearing=u}}function ix(n,e,a,s,l){n._hmtxTableData={};for(var o,u,h=new Qe.Parser(e,a),p=0;p<l;p+=1)p<s&&(o=h.parseUShort(),u=h.parseShort()),n._hmtxTableData[p]={advanceWidth:o,leftSideBearing:u}}function lx(n,e,a,s,l,o,u){u.lowMemory?ix(n,e,a,s,l):sx(e,a,s,l,o)}function ox(n){for(var e=new Xe.Table("hmtx",[]),a=0;a<n.length;a+=1){var s=n.get(a),l=s.advanceWidth||0,o=s.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+a,type:"USHORT",value:l}),e.fields.push({name:"leftSideBearing_"+a,type:"SHORT",value:o})}return e}var Mg={parse:lx,make:ox};function cx(n){for(var e=new Xe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:n.length}]),a="",s=12+n.length*4,l=0;l<n.length;++l){var o=a.indexOf(n[l]);o<0&&(o=a.length,a+=n[l]),e.fields.push({name:"offset "+l,type:"USHORT",value:s+o}),e.fields.push({name:"length "+l,type:"USHORT",value:n[l].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),e}function ux(n,e){var a=new Qe.Parser(n,e),s=a.parseULong();ft.argument(s===1,"Unsupported ltag table version."),a.skip("uLong",1);for(var l=a.parseULong(),o=[],u=0;u<l;u++){for(var h="",p=e+a.parseUShort(),g=a.parseUShort(),v=p;v<p+g;++v)h+=String.fromCharCode(n.getInt8(v));o.push(h)}return o}var kg={make:cx,parse:ux};function fx(n,e){var a={},s=new Qe.Parser(n,e);return a.version=s.parseVersion(),a.numGlyphs=s.parseUShort(),a.version===1&&(a.maxPoints=s.parseUShort(),a.maxContours=s.parseUShort(),a.maxCompositePoints=s.parseUShort(),a.maxCompositeContours=s.parseUShort(),a.maxZones=s.parseUShort(),a.maxTwilightPoints=s.parseUShort(),a.maxStorage=s.parseUShort(),a.maxFunctionDefs=s.parseUShort(),a.maxInstructionDefs=s.parseUShort(),a.maxStackElements=s.parseUShort(),a.maxSizeOfInstructions=s.parseUShort(),a.maxComponentElements=s.parseUShort(),a.maxComponentDepth=s.parseUShort()),a}function dx(n){return new Xe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:n}])}var Ng={parse:fx,make:dx},Rg=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Dg={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},px={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},_g={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function hx(n,e,a){switch(n){case 0:if(e===65535)return"und";if(a)return a[e];break;case 1:return Dg[e];case 3:return _g[e]}}var ed="utf-16",mx={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},gx={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Og(n,e,a){switch(n){case 0:return ed;case 1:return gx[a]||mx[e];case 3:if(e===1||e===10)return ed;break}}function yx(n,e,a){for(var s={},l=new Qe.Parser(n,e),o=l.parseUShort(),u=l.parseUShort(),h=l.offset+l.parseUShort(),p=0;p<u;p++){var g=l.parseUShort(),v=l.parseUShort(),A=l.parseUShort(),S=l.parseUShort(),b=Rg[S]||S,M=l.parseUShort(),D=l.parseUShort(),L=hx(g,A,a),B=Og(g,v,A);if(B!==void 0&&L!==void 0){var Q=void 0;if(B===ed?Q=pl.UTF16(n,h+D,M):Q=pl.MACSTRING(n,h+D,M,B),Q){var _=s[b];_===void 0&&(_=s[b]={}),_[L]=Q}}}return o===1&&l.parseUShort(),s}function jf(n){var e={};for(var a in n)e[n[a]]=parseInt(a);return e}function im(n,e,a,s,l,o){return new Xe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:n},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:a},{name:"nameID",type:"USHORT",value:s},{name:"length",type:"USHORT",value:l},{name:"offset",type:"USHORT",value:o}])}function vx(n,e){var a=n.length,s=e.length-a+1;e:for(var l=0;l<s;l++)for(;l<s;l++){for(var o=0;o<a;o++)if(e[l+o]!==n[o])continue e;return l}return-1}function lm(n,e){var a=vx(n,e);if(a<0){a=e.length;for(var s=0,l=n.length;s<l;++s)e.push(n[s])}return a}function bx(n,e){var a,s=[],l={},o=jf(Rg);for(var u in n){var h=o[u];if(h===void 0&&(h=u),a=parseInt(h),isNaN(a))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');l[a]=n[u],s.push(a)}for(var p=jf(Dg),g=jf(_g),v=[],A=[],S=0;S<s.length;S++){a=s[S];var b=l[a];for(var M in b){var D=b[M],L=1,B=p[M],Q=px[B],_=Og(L,Q,B),U=He.MACSTRING(D,_);U===void 0&&(L=0,B=e.indexOf(M),B<0&&(B=e.length,e.push(M)),Q=4,U=He.UTF16(D));var I=lm(U,A);v.push(im(L,Q,B,a,U.length,I));var P=g[M];if(P!==void 0){var Y=He.UTF16(D),te=lm(Y,A);v.push(im(3,1,P,a,Y.length,te))}}}v.sort(function(O,$){return O.platformID-$.platformID||O.encodingID-$.encodingID||O.languageID-$.languageID||O.nameID-$.nameID});for(var oe=new Xe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),W=0;W<v.length;W++)oe.fields.push({name:"record_"+W,type:"RECORD",value:v[W]});return oe.fields.push({name:"strings",type:"LITERAL",value:A}),oe}var Ig={parse:yx,make:bx},td=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function xx(n){for(var e=0;e<td.length;e+=1){var a=td[e];if(n>=a.begin&&n<a.end)return e}return-1}function Sx(n,e){var a={},s=new Qe.Parser(n,e);a.version=s.parseUShort(),a.xAvgCharWidth=s.parseShort(),a.usWeightClass=s.parseUShort(),a.usWidthClass=s.parseUShort(),a.fsType=s.parseUShort(),a.ySubscriptXSize=s.parseShort(),a.ySubscriptYSize=s.parseShort(),a.ySubscriptXOffset=s.parseShort(),a.ySubscriptYOffset=s.parseShort(),a.ySuperscriptXSize=s.parseShort(),a.ySuperscriptYSize=s.parseShort(),a.ySuperscriptXOffset=s.parseShort(),a.ySuperscriptYOffset=s.parseShort(),a.yStrikeoutSize=s.parseShort(),a.yStrikeoutPosition=s.parseShort(),a.sFamilyClass=s.parseShort(),a.panose=[];for(var l=0;l<10;l++)a.panose[l]=s.parseByte();return a.ulUnicodeRange1=s.parseULong(),a.ulUnicodeRange2=s.parseULong(),a.ulUnicodeRange3=s.parseULong(),a.ulUnicodeRange4=s.parseULong(),a.achVendID=String.fromCharCode(s.parseByte(),s.parseByte(),s.parseByte(),s.parseByte()),a.fsSelection=s.parseUShort(),a.usFirstCharIndex=s.parseUShort(),a.usLastCharIndex=s.parseUShort(),a.sTypoAscender=s.parseShort(),a.sTypoDescender=s.parseShort(),a.sTypoLineGap=s.parseShort(),a.usWinAscent=s.parseUShort(),a.usWinDescent=s.parseUShort(),a.version>=1&&(a.ulCodePageRange1=s.parseULong(),a.ulCodePageRange2=s.parseULong()),a.version>=2&&(a.sxHeight=s.parseShort(),a.sCapHeight=s.parseShort(),a.usDefaultChar=s.parseUShort(),a.usBreakChar=s.parseUShort(),a.usMaxContent=s.parseUShort()),a}function wx(n){return new Xe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],n)}var nd={parse:Sx,make:wx,unicodeRanges:td,getUnicodeRange:xx};function Ex(n,e){var a={},s=new Qe.Parser(n,e);switch(a.version=s.parseVersion(),a.italicAngle=s.parseFixed(),a.underlinePosition=s.parseShort(),a.underlineThickness=s.parseShort(),a.isFixedPitch=s.parseULong(),a.minMemType42=s.parseULong(),a.maxMemType42=s.parseULong(),a.minMemType1=s.parseULong(),a.maxMemType1=s.parseULong(),a.version){case 1:a.names=Ei.slice();break;case 2:a.numberOfGlyphs=s.parseUShort(),a.glyphNameIndex=new Array(a.numberOfGlyphs);for(var l=0;l<a.numberOfGlyphs;l++)a.glyphNameIndex[l]=s.parseUShort();a.names=[];for(var o=0;o<a.numberOfGlyphs;o++)if(a.glyphNameIndex[o]>=Ei.length){var u=s.parseChar();a.names.push(s.parseString(u))}break;case 2.5:a.numberOfGlyphs=s.parseUShort(),a.offset=new Array(a.numberOfGlyphs);for(var h=0;h<a.numberOfGlyphs;h++)a.offset[h]=s.parseChar();break}return a}function Ax(){return new Xe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Lg={parse:Ex,make:Ax},xr=new Array(9);xr[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(be.coverage),deltaGlyphId:this.parseUShort()};if(a===2)return{substFormat:2,coverage:this.parsePointer(be.coverage),substitute:this.parseOffset16List()};ft.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};xr[2]=function(){var e=this.parseUShort();return ft.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(be.coverage),sequences:this.parseListOfLists()}};xr[3]=function(){var e=this.parseUShort();return ft.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(be.coverage),alternateSets:this.parseListOfLists()}};xr[4]=function(){var e=this.parseUShort();return ft.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(be.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var fl={sequenceIndex:be.uShort,lookupListIndex:be.uShort};xr[5]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:a,coverage:this.parsePointer(be.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,fl)}})};if(a===2)return{substFormat:a,coverage:this.parsePointer(be.coverage),classDef:this.parsePointer(be.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,fl)}})};if(a===3){var s=this.parseUShort(),l=this.parseUShort();return{substFormat:a,coverages:this.parseList(s,be.pointer(be.coverage)),lookupRecords:this.parseRecordList(l,fl)}}ft.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};xr[6]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(be.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(fl)}})};if(a===2)return{substFormat:2,coverage:this.parsePointer(be.coverage),backtrackClassDef:this.parsePointer(be.classDef),inputClassDef:this.parsePointer(be.classDef),lookaheadClassDef:this.parsePointer(be.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(fl)}})};if(a===3)return{substFormat:3,backtrackCoverage:this.parseList(be.pointer(be.coverage)),inputCoverage:this.parseList(be.pointer(be.coverage)),lookaheadCoverage:this.parseList(be.pointer(be.coverage)),lookupRecords:this.parseRecordList(fl)};ft.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};xr[7]=function(){var e=this.parseUShort();ft.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var a=this.parseUShort(),s=new be(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:a,extension:xr[a].call(s)}};xr[8]=function(){var e=this.parseUShort();return ft.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(be.coverage),backtrackCoverage:this.parseList(be.pointer(be.coverage)),lookaheadCoverage:this.parseList(be.pointer(be.coverage)),substitutes:this.parseUShortList()}};function Tx(n,e){e=e||0;var a=new be(n,e),s=a.parseVersion(1);return ft.argument(s===1||s===1.1,"Unsupported GSUB table version."),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(xr)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(xr),variations:a.parseFeatureVariationsList()}}var hl=new Array(9);hl[1]=function(e){return e.substFormat===1?new Xe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Xe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)}].concat(Xe.ushortList("substitute",e.substitute)))};hl[2]=function(e){return ft.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Xe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)}].concat(Xe.tableList("seqSet",e.sequences,function(a){return new Xe.Table("sequenceSetTable",Xe.ushortList("sequence",a))})))};hl[3]=function(e){return ft.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Xe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)}].concat(Xe.tableList("altSet",e.alternateSets,function(a){return new Xe.Table("alternateSetTable",Xe.ushortList("alternate",a))})))};hl[4]=function(e){return ft.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Xe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)}].concat(Xe.tableList("ligSet",e.ligatureSets,function(a){return new Xe.Table("ligatureSetTable",Xe.tableList("ligature",a,function(s){return new Xe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:s.ligGlyph}].concat(Xe.ushortList("component",s.components,s.components.length+1)))}))})))};hl[6]=function(e){if(e.substFormat===1){var a=new Xe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Xe.Coverage(e.coverage)}].concat(Xe.tableList("chainRuleSet",e.chainRuleSets,function(o){return new Xe.Table("chainRuleSetTable",Xe.tableList("chainRule",o,function(u){var h=Xe.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(Xe.ushortList("inputGlyph",u.input,u.input.length+1)).concat(Xe.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(Xe.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(p,g){h=h.concat({name:"sequenceIndex"+g,type:"USHORT",value:p.sequenceIndex}).concat({name:"lookupListIndex"+g,type:"USHORT",value:p.lookupListIndex})}),new Xe.Table("chainRuleTable",h)}))})));return a}else if(e.substFormat===2)ft.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var s=[{name:"substFormat",type:"USHORT",value:e.substFormat}];s.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(o,u){s.push({name:"backtrackCoverage"+u,type:"TABLE",value:new Xe.Coverage(o)})}),s.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(o,u){s.push({name:"inputCoverage"+u,type:"TABLE",value:new Xe.Coverage(o)})}),s.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(o,u){s.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new Xe.Coverage(o)})}),s.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(o,u){s=s.concat({name:"sequenceIndex"+u,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:o.lookupListIndex})});var l=new Xe.Table("chainContextTable",s);return l}ft.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Cx(n){return new Xe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Xe.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new Xe.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new Xe.LookupList(n.lookups,hl)}])}var jg={parse:Tx,make:Cx};function Mx(n,e){var a=new Qe.Parser(n,e),s=a.parseULong();ft.argument(s===1,"Unsupported META table version."),a.parseULong(),a.parseULong();for(var l=a.parseULong(),o={},u=0;u<l;u++){var h=a.parseTag(),p=a.parseULong(),g=a.parseULong(),v=pl.UTF8(n,e+p,g);o[h]=v}return o}function kx(n){var e=Object.keys(n).length,a="",s=16+e*12,l=new Xe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:s},{name:"numTags",type:"ULONG",value:e}]);for(var o in n){var u=a.length;a+=n[o],l.fields.push({name:"tag "+o,type:"TAG",value:o}),l.fields.push({name:"offset "+o,type:"ULONG",value:s+u}),l.fields.push({name:"length "+o,type:"ULONG",value:n[o].length})}return l.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),l}var Ug={parse:Mx,make:kx};function om(n){return Math.log(n)/Math.log(2)|0}function gd(n){for(;n.length%4!==0;)n.push(0);for(var e=0,a=0;a<n.length;a+=4)e+=(n[a]<<24)+(n[a+1]<<16)+(n[a+2]<<8)+n[a+3];return e%=Math.pow(2,32),e}function cm(n,e,a,s){return new Xe.Record("Table Record",[{name:"tag",type:"TAG",value:n!==void 0?n:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:a!==void 0?a:0},{name:"length",type:"ULONG",value:s!==void 0?s:0}])}function Bg(n){var e=new Xe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=n,e.numTables=n.length;var a=Math.pow(2,om(e.numTables));e.searchRange=16*a,e.entrySelector=om(a),e.rangeShift=e.numTables*16-e.searchRange;for(var s=[],l=[],o=e.sizeOf()+cm().sizeOf()*e.numTables;o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<n.length;u+=1){var h=n[u];ft.argument(h.tableName.length===4,"Table name"+h.tableName+" is invalid.");var p=h.sizeOf(),g=cm(h.tableName,gd(h.encode()),o,p);for(s.push({name:g.tag+" Table Record",type:"RECORD",value:g}),l.push({name:h.tableName+" table",type:"RECORD",value:h}),o+=p,ft.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(v,A){return v.value.tag>A.value.tag?1:-1}),e.fields=e.fields.concat(s),e.fields=e.fields.concat(l),e}function um(n,e,a){for(var s=0;s<e.length;s+=1){var l=n.charToGlyphIndex(e[s]);if(l>0){var o=n.glyphs.get(l);return o.getMetrics()}}return a}function Nx(n){for(var e=0,a=0;a<n.length;a+=1)e+=n[a];return e/n.length}function Rx(n){for(var e=[],a=[],s=[],l=[],o=[],u=[],h=[],p,g=0,v=0,A=0,S=0,b=0,M=0;M<n.glyphs.length;M+=1){var D=n.glyphs.get(M),L=D.unicode|0;if(isNaN(D.advanceWidth))throw new Error("Glyph "+D.name+" ("+M+"): advanceWidth is not a number.");(p>L||p===void 0)&&L>0&&(p=L),g<L&&(g=L);var B=nd.getUnicodeRange(L);if(B<32)v|=1<<B;else if(B<64)A|=1<<B-32;else if(B<96)S|=1<<B-64;else if(B<123)b|=1<<B-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(D.name!==".notdef"){var Q=D.getMetrics();e.push(Q.xMin),a.push(Q.yMin),s.push(Q.xMax),l.push(Q.yMax),u.push(Q.leftSideBearing),h.push(Q.rightSideBearing),o.push(D.advanceWidth)}}var _={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,l),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:Nx(o),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,h)};_.ascender=n.ascender,_.descender=n.descender;var U=Tg.make({flags:3,unitsPerEm:n.unitsPerEm,xMin:_.xMin,yMin:_.yMin,xMax:_.xMax,yMax:_.yMax,lowestRecPPEM:3,createdTimestamp:n.createdTimestamp}),I=Cg.make({ascender:_.ascender,descender:_.descender,advanceWidthMax:_.advanceWidthMax,minLeftSideBearing:_.minLeftSideBearing,minRightSideBearing:_.minRightSideBearing,xMaxExtent:_.maxLeftSideBearing+(_.xMax-_.xMin),numberOfHMetrics:n.glyphs.length}),P=Ng.make(n.glyphs.length),Y=nd.make(Object.assign({xAvgCharWidth:Math.round(_.advanceWidthAvg),usFirstCharIndex:p,usLastCharIndex:g,ulUnicodeRange1:v,ulUnicodeRange2:A,ulUnicodeRange3:S,ulUnicodeRange4:b,sTypoAscender:_.ascender,sTypoDescender:_.descender,sTypoLineGap:0,usWinAscent:_.yMax,usWinDescent:Math.abs(_.yMin),ulCodePageRange1:1,sxHeight:um(n,"xyvw",{yMax:Math.round(_.ascender/2)}).yMax,sCapHeight:um(n,"HIKLEFJMNTZBDPRAGOQSUVWXY",_).yMax,usDefaultChar:n.hasChar(" ")?32:0,usBreakChar:n.hasChar(" ")?32:0},n.tables.os2)),te=Mg.make(n.glyphs),oe=pg.make(n.glyphs),W=n.getEnglishName("fontFamily"),O=n.getEnglishName("fontSubfamily"),$=W+" "+O,z=n.getEnglishName("postScriptName");z||(z=W.replace(/\s/g,"")+"-"+O);var K={};for(var re in n.names)K[re]=n.names[re];K.uniqueID||(K.uniqueID={en:n.getEnglishName("manufacturer")+":"+$}),K.postScriptName||(K.postScriptName={en:z}),K.preferredFamily||(K.preferredFamily=n.names.fontFamily),K.preferredSubfamily||(K.preferredSubfamily=n.names.fontSubfamily);var V=[],ee=Ig.make(K,V),se=V.length>0?kg.make(V):void 0,ge=Lg.make(),Z=Ag.make(n.glyphs,{version:n.getEnglishName("version"),fullName:$,familyName:W,weightName:O,postScriptName:z,unitsPerEm:n.unitsPerEm,fontBBox:[0,_.yMin,_.ascender,_.advanceWidthMax]}),J=n.metas&&Object.keys(n.metas).length>0?Ug.make(n.metas):void 0,Se=[U,I,P,Y,ee,oe,ge,Z,te];se&&Se.push(se),n.tables.gsub&&Se.push(jg.make(n.tables.gsub)),J&&Se.push(J);for(var Ae=Bg(Se),Le=Ae.encode(),Ye=gd(Le),Ue=Ae.fields,pt=!1,it=0;it<Ue.length;it+=1)if(Ue[it].name==="head table"){Ue[it].value.checkSumAdjustment=2981146554-Ye,pt=!0;break}if(!pt)throw new Error("Could not find head table with checkSum to adjust.");return Ae}var Dx={make:Bg,fontToTable:Rx,computeCheckSum:gd};function Uf(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l].tag;if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function fm(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l];if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function dm(n,e){for(var a,s=0,l=n.length-1;s<=l;){var o=s+l>>>1;a=n[o];var u=a.start;if(u===e)return a;u<e?s=o+1:l=o-1}if(s>0)return a=n[s-1],e>a.end?0:a}function yo(n,e){this.font=n,this.tableName=e}yo.prototype={searchTag:Uf,binSearch:fm,getTable:function(n){var e=this.font.tables[this.tableName];return!e&&n&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var n=this.getTable();return n?n.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var n=this.getTable();if(n){for(var e=!1,a=0;a<n.scripts.length;a++){var s=n.scripts[a].tag;if(s==="DFLT")return s;s==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(n,e){var a=this.getTable(e);if(a){n=n||"DFLT";var s=a.scripts,l=Uf(a.scripts,n);if(l>=0)return s[l].script;if(e){var o={tag:n,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return s.splice(-1-l,0,o),o.script}}},getLangSysTable:function(n,e,a){var s=this.getScriptTable(n,a);if(s){if(!e||e==="dflt"||e==="DFLT")return s.defaultLangSys;var l=Uf(s.langSysRecords,e);if(l>=0)return s.langSysRecords[l].langSys;if(a){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return s.langSysRecords.splice(-1-l,0,o),o.langSys}}},getFeatureTable:function(n,e,a,s){var l=this.getLangSysTable(n,e,s);if(l){for(var o,u=l.featureIndexes,h=this.font.tables[this.tableName].features,p=0;p<u.length;p++)if(o=h[u[p]],o.tag===a)return o.feature;if(s){var g=h.length;return ft.assert(g===0||a>=h[g-1].tag,"Features must be added in alphabetical order."),o={tag:a,feature:{params:0,lookupListIndexes:[]}},h.push(o),u.push(g),o.feature}}},getLookupTables:function(n,e,a,s,l){var o=this.getFeatureTable(n,e,a,l),u=[];if(o){for(var h,p=o.lookupListIndexes,g=this.font.tables[this.tableName].lookups,v=0;v<p.length;v++)h=g[p[v]],h.lookupType===s&&u.push(h);if(u.length===0&&l){h={lookupType:s,lookupFlag:0,subtables:[],markFilteringSet:void 0};var A=g.length;return g.push(h),p.push(A),[h]}}return u},getGlyphClass:function(n,e){switch(n.format){case 1:return n.startGlyph<=e&&e<n.startGlyph+n.classes.length?n.classes[e-n.startGlyph]:0;case 2:var a=dm(n.ranges,e);return a?a.classId:0}},getCoverageIndex:function(n,e){switch(n.format){case 1:var a=fm(n.glyphs,e);return a>=0?a:-1;case 2:var s=dm(n.ranges,e);return s?s.index+e-s.start:-1}},expandCoverage:function(n){if(n.format===1)return n.glyphs;for(var e=[],a=n.ranges,s=0;s<a.length;s++)for(var l=a[s],o=l.start,u=l.end,h=o;h<=u;h++)e.push(h);return e}};function vo(n){yo.call(this,n,"gpos")}vo.prototype=yo.prototype;vo.prototype.init=function(){var n=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(n)};vo.prototype.getKerningValue=function(n,e,a){for(var s=0;s<n.length;s++)for(var l=n[s].subtables,o=0;o<l.length;o++){var u=l[o],h=this.getCoverageIndex(u.coverage,e);if(!(h<0))switch(u.posFormat){case 1:for(var p=u.pairSets[h],g=0;g<p.length;g++){var v=p[g];if(v.secondGlyph===a)return v.value1&&v.value1.xAdvance||0}break;case 2:var A=this.getGlyphClass(u.classDef1,e),S=this.getGlyphClass(u.classDef2,a),b=u.classRecords[A][S];return b.value1&&b.value1.xAdvance||0}}return 0};vo.prototype.getKerningTables=function(n,e){if(this.font.tables.gpos)return this.getLookupTables(n,e,"kern",2)};function Ya(n){yo.call(this,n,"gsub")}function _x(n,e){var a=n.length;if(a!==e.length)return!1;for(var s=0;s<a;s++)if(n[s]!==e[s])return!1;return!0}function yd(n,e,a){for(var s=n.subtables,l=0;l<s.length;l++){var o=s[l];if(o.substFormat===e)return o}if(a)return s.push(a),a}Ya.prototype=yo.prototype;Ya.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};Ya.prototype.getSingle=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,1),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++){var p=u[h],g=this.expandCoverage(p.coverage),v=void 0;if(p.substFormat===1){var A=p.deltaGlyphId;for(v=0;v<g.length;v++){var S=g[v];s.push({sub:S,by:S+A})}}else{var b=p.substitute;for(v=0;v<g.length;v++)s.push({sub:g[v],by:b[v]})}}return s};Ya.prototype.getMultiple=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,2),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++){var p=u[h],g=this.expandCoverage(p.coverage),v=void 0;for(v=0;v<g.length;v++){var A=g[v],S=p.sequences[v];s.push({sub:A,by:S})}}return s};Ya.prototype.getAlternates=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,3),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++)for(var p=u[h],g=this.expandCoverage(p.coverage),v=p.alternateSets,A=0;A<g.length;A++)s.push({sub:g[A],by:v[A]});return s};Ya.prototype.getLigatures=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,4),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++)for(var p=u[h],g=this.expandCoverage(p.coverage),v=p.ligatureSets,A=0;A<g.length;A++)for(var S=g[A],b=v[A],M=0;M<b.length;M++){var D=b[M];s.push({sub:[S].concat(D.components),by:D.ligGlyph})}return s};Ya.prototype.addSingle=function(n,e,a,s){var l=this.getLookupTables(a,s,n,1,!0)[0],o=yd(l,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ft.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.substitute.splice(h,0,0)),o.substitute[h]=e.by};Ya.prototype.addMultiple=function(n,e,a,s){ft.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var l=this.getLookupTables(a,s,n,2,!0)[0],o=yd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ft.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.sequences.splice(h,0,0)),o.sequences[h]=e.by};Ya.prototype.addAlternate=function(n,e,a,s){var l=this.getLookupTables(a,s,n,3,!0)[0],o=yd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ft.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.alternateSets.splice(h,0,0)),o.alternateSets[h]=e.by};Ya.prototype.addLigature=function(n,e,a,s){var l=this.getLookupTables(a,s,n,4,!0)[0],o=l.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},l.subtables[0]=o),ft.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var u=e.sub[0],h=e.sub.slice(1),p={ligGlyph:e.by,components:h},g=this.binSearch(o.coverage.glyphs,u);if(g>=0){for(var v=o.ligatureSets[g],A=0;A<v.length;A++)if(_x(v[A].components,h))return;v.push(p)}else g=-1-g,o.coverage.glyphs.splice(g,0,u),o.ligatureSets.splice(g,0,[p])};Ya.prototype.getFeature=function(n,e,a){if(/ss\d\d/.test(n))return this.getSingle(n,e,a);switch(n){case"aalt":case"salt":return this.getSingle(n,e,a).concat(this.getAlternates(n,e,a));case"dlig":case"liga":case"rlig":return this.getLigatures(n,e,a);case"ccmp":return this.getMultiple(n,e,a).concat(this.getLigatures(n,e,a));case"stch":return this.getMultiple(n,e,a)}};Ya.prototype.add=function(n,e,a,s){if(/ss\d\d/.test(n))return this.addSingle(n,e,a,s);switch(n){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(n,e,a,s):this.addAlternate(n,e,a,s);case"dlig":case"liga":case"rlig":return this.addLigature(n,e,a,s);case"ccmp":return e.by instanceof Array?this.addMultiple(n,e,a,s):this.addLigature(n,e,a,s)}};function Ox(){return typeof window<"u"}function Fg(n){for(var e=new ArrayBuffer(n.length),a=new Uint8Array(e),s=0;s<n.length;++s)a[s]=n[s];return e}function Ix(n){for(var e=new Buffer(n.byteLength),a=new Uint8Array(n),s=0;s<e.length;++s)e[s]=a[s];return e}function so(n,e){if(!n)throw e}function pm(n,e,a,s,l){var o;return(e&s)>0?(o=n.parseByte(),(e&l)===0&&(o=-o),o=a+o):(e&l)>0?o=a:o=a+n.parseShort(),o}function Pg(n,e,a){var s=new Qe.Parser(e,a);n.numberOfContours=s.parseShort(),n._xMin=s.parseShort(),n._yMin=s.parseShort(),n._xMax=s.parseShort(),n._yMax=s.parseShort();var l,o;if(n.numberOfContours>0){for(var u=n.endPointIndices=[],h=0;h<n.numberOfContours;h+=1)u.push(s.parseUShort());n.instructionLength=s.parseUShort(),n.instructions=[];for(var p=0;p<n.instructionLength;p+=1)n.instructions.push(s.parseByte());var g=u[u.length-1]+1;l=[];for(var v=0;v<g;v+=1)if(o=s.parseByte(),l.push(o),(o&8)>0)for(var A=s.parseByte(),S=0;S<A;S+=1)l.push(o),v+=1;if(ft.argument(l.length===g,"Bad flags."),u.length>0){var b=[],M;if(g>0){for(var D=0;D<g;D+=1)o=l[D],M={},M.onCurve=!!(o&1),M.lastPointOfContour=u.indexOf(D)>=0,b.push(M);for(var L=0,B=0;B<g;B+=1)o=l[B],M=b[B],M.x=pm(s,o,L,2,16),L=M.x;for(var Q=0,_=0;_<g;_+=1)o=l[_],M=b[_],M.y=pm(s,o,Q,4,32),Q=M.y}n.points=b}else n.points=[]}else if(n.numberOfContours===0)n.points=[];else{n.isComposite=!0,n.points=[],n.components=[];for(var U=!0;U;){l=s.parseUShort();var I={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(l&1)>0?(l&2)>0?(I.dx=s.parseShort(),I.dy=s.parseShort()):I.matchedPoints=[s.parseUShort(),s.parseUShort()]:(l&2)>0?(I.dx=s.parseChar(),I.dy=s.parseChar()):I.matchedPoints=[s.parseByte(),s.parseByte()],(l&8)>0?I.xScale=I.yScale=s.parseF2Dot14():(l&64)>0?(I.xScale=s.parseF2Dot14(),I.yScale=s.parseF2Dot14()):(l&128)>0&&(I.xScale=s.parseF2Dot14(),I.scale01=s.parseF2Dot14(),I.scale10=s.parseF2Dot14(),I.yScale=s.parseF2Dot14()),n.components.push(I),U=!!(l&32)}if(l&256){n.instructionLength=s.parseUShort(),n.instructions=[];for(var P=0;P<n.instructionLength;P+=1)n.instructions.push(s.parseByte())}}}function Bf(n,e){for(var a=[],s=0;s<n.length;s+=1){var l=n[s],o={x:e.xScale*l.x+e.scale01*l.y+e.dx,y:e.scale10*l.x+e.yScale*l.y+e.dy,onCurve:l.onCurve,lastPointOfContour:l.lastPointOfContour};a.push(o)}return a}function Lx(n){for(var e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];a.push(l),l.lastPointOfContour&&(e.push(a),a=[])}return ft.argument(a.length===0,"There are still points left in the current contour."),e}function zg(n){var e=new An;if(!n)return e;for(var a=Lx(n),s=0;s<a.length;++s){var l=a[s],o=null,u=l[l.length-1],h=l[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(h.onCurve)e.moveTo(h.x,h.y);else{var p={x:(u.x+h.x)*.5,y:(u.y+h.y)*.5};e.moveTo(p.x,p.y)}for(var g=0;g<l.length;++g)if(o=u,u=h,h=l[(g+1)%l.length],u.onCurve)e.lineTo(u.x,u.y);else{var v=h;o.onCurve||((u.x+o.x)*.5,(u.y+o.y)*.5),h.onCurve||(v={x:(u.x+h.x)*.5,y:(u.y+h.y)*.5}),e.quadraticCurveTo(u.x,u.y,v.x,v.y)}e.closePath()}return e}function Gg(n,e){if(e.isComposite)for(var a=0;a<e.components.length;a+=1){var s=e.components[a],l=n.get(s.glyphIndex);if(l.getPath(),l.points){var o=void 0;if(s.matchedPoints===void 0)o=Bf(l.points,s);else{if(s.matchedPoints[0]>e.points.length-1||s.matchedPoints[1]>l.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[s.matchedPoints[0]],h=l.points[s.matchedPoints[1]],p={xScale:s.xScale,scale01:s.scale01,scale10:s.scale10,yScale:s.yScale,dx:0,dy:0};h=Bf([h],p)[0],p.dx=u.x-h.x,p.dy=u.y-h.y,o=Bf(l.points,p)}e.points=e.points.concat(o)}}return zg(e.points)}function jx(n,e,a,s){for(var l=new Xr.GlyphSet(s),o=0;o<a.length-1;o+=1){var u=a[o],h=a[o+1];u!==h?l.push(o,Xr.ttfGlyphLoader(s,o,Pg,n,e+u,Gg)):l.push(o,Xr.glyphLoader(s,o))}return l}function Ux(n,e,a,s){var l=new Xr.GlyphSet(s);return s._push=function(o){var u=a[o],h=a[o+1];u!==h?l.push(o,Xr.ttfGlyphLoader(s,o,Pg,n,e+u,Gg)):l.push(o,Xr.glyphLoader(s,o))},l}function Bx(n,e,a,s,l){return l.lowMemory?Ux(n,e,a,s):jx(n,e,a,s)}var Hg={getPath:zg,parse:Bx},Yg,Ti,Vg,ad;function qg(n){this.font=n,this.getCommands=function(e){return Hg.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Fx(n){return n}function Xg(n){return Math.sign(n)*Math.round(Math.abs(n))}function Px(n){return Math.sign(n)*Math.round(Math.abs(n*2))/2}function zx(n){return Math.sign(n)*(Math.round(Math.abs(n)+.5)-.5)}function Gx(n){return Math.sign(n)*Math.ceil(Math.abs(n))}function Hx(n){return Math.sign(n)*Math.floor(Math.abs(n))}var $g=function(n){var e=this.srPeriod,a=this.srPhase,s=this.srThreshold,l=1;return n<0&&(n=-n,l=-1),n+=s-a,n=Math.trunc(n/e)*e,n+=a,n<0?a*l:n*l},qr={x:1,y:0,axis:"x",distance:function(n,e,a,s){return(a?n.xo:n.x)-(s?e.xo:e.x)},interpolate:function(n,e,a,s){var l,o,u,h,p,g,v;if(!s||s===this){if(l=n.xo-e.xo,o=n.xo-a.xo,p=e.x-e.xo,g=a.x-a.xo,u=Math.abs(l),h=Math.abs(o),v=u+h,v===0){n.x=n.xo+(p+g)/2;return}n.x=n.xo+(p*h+g*u)/v;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),p=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),h=Math.abs(o),v=u+h,v===0){qr.setRelative(n,n,(p+g)/2,s,!0);return}qr.setRelative(n,n,(p*h+g*u)/v,s,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(n,e,a,s,l){if(!s||s===this){n.x=(l?e.xo:e.x)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y;n.x=h+(n.y-p)/s.normalSlope},slope:0,touch:function(n){n.xTouched=!0},touched:function(n){return n.xTouched},untouch:function(n){n.xTouched=!1}},ys={x:0,y:1,axis:"y",distance:function(n,e,a,s){return(a?n.yo:n.y)-(s?e.yo:e.y)},interpolate:function(n,e,a,s){var l,o,u,h,p,g,v;if(!s||s===this){if(l=n.yo-e.yo,o=n.yo-a.yo,p=e.y-e.yo,g=a.y-a.yo,u=Math.abs(l),h=Math.abs(o),v=u+h,v===0){n.y=n.yo+(p+g)/2;return}n.y=n.yo+(p*h+g*u)/v;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),p=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),h=Math.abs(o),v=u+h,v===0){ys.setRelative(n,n,(p+g)/2,s,!0);return}ys.setRelative(n,n,(p*h+g*u)/v,s,!0)},normalSlope:0,setRelative:function(n,e,a,s,l){if(!s||s===this){n.y=(l?e.yo:e.y)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y;n.y=p+s.normalSlope*(n.x-h)},slope:Number.POSITIVE_INFINITY,touch:function(n){n.yTouched=!0},touched:function(n){return n.yTouched},untouch:function(n){n.yTouched=!1}};Object.freeze(qr);Object.freeze(ys);function bo(n,e){this.x=n,this.y=e,this.axis=void 0,this.slope=e/n,this.normalSlope=-n/e,Object.freeze(this)}bo.prototype.distance=function(n,e,a,s){return this.x*qr.distance(n,e,a,s)+this.y*ys.distance(n,e,a,s)};bo.prototype.interpolate=function(n,e,a,s){var l,o,u,h,p,g,v;if(u=s.distance(n,e,!0,!0),h=s.distance(n,a,!0,!0),l=s.distance(e,e,!1,!0),o=s.distance(a,a,!1,!0),p=Math.abs(u),g=Math.abs(h),v=p+g,v===0){this.setRelative(n,n,(l+o)/2,s,!0);return}this.setRelative(n,n,(l*g+o*p)/v,s,!0)};bo.prototype.setRelative=function(n,e,a,s,l){s=s||this;var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y,g=s.normalSlope,v=this.slope,A=n.x,S=n.y;n.x=(v*A-g*h+p-S)/(v-g),n.y=v*(n.x-A)+S};bo.prototype.touch=function(n){n.xTouched=!0,n.yTouched=!0};function xo(n,e){var a=Math.sqrt(n*n+e*e);return n/=a,e/=a,n===1&&e===0?qr:n===0&&e===1?ys:new bo(n,e)}function vs(n,e,a,s){this.x=this.xo=Math.round(n*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=a,this.onCurve=s,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}vs.prototype.nextTouched=function(n){for(var e=this.nextPointOnContour;!n.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};vs.prototype.prevTouched=function(n){for(var e=this.prevPointOnContour;!n.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var mo=Object.freeze(new vs(0,0)),Yx={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Zs(n,e){switch(this.env=n,this.stack=[],this.prog=e,n){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=qr,this.round=Xg}}qg.prototype.exec=function(n,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var a=this.font,s=this._prepState;if(!s||s.ppem!==e){var l=this._fpgmState;if(!l){Zs.prototype=Yx,l=this._fpgmState=new Zs("fpgm",a.tables.fpgm),l.funcs=[],l.font=a,exports.DEBUG&&(console.log("---EXEC FPGM---"),l.step=-1);try{Ti(l)}catch(g){console.log("Hinting error in FPGM:"+g),this._errorState=3;return}}Zs.prototype=l,s=this._prepState=new Zs("prep",a.tables.prep),s.ppem=e;var o=a.tables.cvt;if(o)for(var u=s.cvt=new Array(o.length),h=e/a.unitsPerEm,p=0;p<o.length;p++)u[p]=o[p]*h;else s.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),s.step=-1);try{Ti(s)}catch(g){this._errorState<2&&console.log("Hinting error in PREP:"+g),this._errorState=2}}if(!(this._errorState>1))try{return Vg(n,s)}catch(g){this._errorState<1&&(console.log("Hinting error:"+g),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Vg=function(n,e){var a=e.ppem/e.font.unitsPerEm,s=a,l=n.components,o,u,h;if(Zs.prototype=e,!l)h=new Zs("glyf",n.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),h.step=-1),ad(n,h,a,s),u=h.gZone;else{var p=e.font;u=[],o=[];for(var g=0;g<l.length;g++){var v=l[g],A=p.glyphs.get(v.glyphIndex);h=new Zs("glyf",A.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+g+"---"),h.step=-1),ad(A,h,a,s);for(var S=Math.round(v.dx*a),b=Math.round(v.dy*s),M=h.gZone,D=h.contours,L=0;L<M.length;L++){var B=M[L];B.xTouched=B.yTouched=!1,B.xo=B.x=B.x+S,B.yo=B.y=B.y+b}var Q=u.length;u.push.apply(u,M);for(var _=0;_<D.length;_++)o.push(D[_]+Q)}n.instructions&&!h.inhibitGridFit&&(h=new Zs("glyf",n.instructions),h.gZone=h.z0=h.z1=h.z2=u,h.contours=o,u.push(new vs(0,0),new vs(Math.round(n.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),h.step=-1),Ti(h),u.length-=2)}return u};ad=function(n,e,a,s){for(var l=n.points||[],o=l.length,u=e.gZone=e.z0=e.z1=e.z2=[],h=e.contours=[],p,g=0;g<o;g++)p=l[g],u[g]=new vs(p.x*a,p.y*s,p.lastPointOfContour,p.onCurve);for(var v,A,S=0;S<o;S++)p=u[S],v||(v=p,h.push(S)),p.lastPointOfContour?(p.nextPointOnContour=v,v.prevPointOnContour=p,v=void 0):(A=u[S+1],p.nextPointOnContour=A,A.prevPointOnContour=p);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var b=0;b<o;b++)console.log(b,u[b].x,u[b].y)}if(u.push(new vs(0,0),new vs(Math.round(n.advanceWidth*a),0)),Ti(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var M=0;M<o;M++)console.log(M,u[M].x,u[M].y)}}};Ti=function(n){var e=n.prog;if(e){var a=e.length,s;for(n.ip=0;n.ip<a;n.ip++){if(exports.DEBUG&&n.step++,s=Yg[e[n.ip]],!s)throw new Error("unknown instruction: 0x"+Number(e[n.ip]).toString(16));s(n)}}};function Uc(n){for(var e=n.tZone=new Array(n.gZone.length),a=0;a<e.length;a++)e[a]=new vs(0,0)}function Wg(n,e){var a=n.prog,s=n.ip,l=1,o;do if(o=a[++s],o===88)l++;else if(o===89)l--;else if(o===64)s+=a[s+1]+1;else if(o===65)s+=2*a[s+1]+1;else if(o>=176&&o<=183)s+=o-176+1;else if(o>=184&&o<=191)s+=(o-184+1)*2;else if(e&&l===1&&o===27)break;while(l>0);n.ip=s}function hm(n,e){exports.DEBUG&&console.log(e.step,"SVTCA["+n.axis+"]"),e.fv=e.pv=e.dpv=n}function mm(n,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+n.axis+"]"),e.pv=e.dpv=n}function gm(n,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+n.axis+"]"),e.fv=n}function ym(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SPVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.pv=e.dpv=xo(h,p)}function vm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SFVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.fv=xo(h,p)}function Vx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.pv=n.dpv=xo(s,a)}function qx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.fv=xo(s,a)}function Xx(n){var e=n.stack,a=n.pv;exports.DEBUG&&console.log(n.step,"GPV[]"),e.push(a.x*16384),e.push(a.y*16384)}function $x(n){var e=n.stack,a=n.fv;exports.DEBUG&&console.log(n.step,"GFV[]"),e.push(a.x*16384),e.push(a.y*16384)}function Wx(n){n.fv=n.pv,exports.DEBUG&&console.log(n.step,"SFVTPV[]")}function Zx(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop(),o=e.pop(),u=e.pop(),h=n.z0,p=n.z1,g=h[a],v=h[s],A=p[l],S=p[o],b=n.z2[u];exports.DEBUG&&console.log("ISECT[], ",a,s,l,o,u);var M=g.x,D=g.y,L=v.x,B=v.y,Q=A.x,_=A.y,U=S.x,I=S.y,P=(M-L)*(_-I)-(D-B)*(Q-U),Y=M*B-D*L,te=Q*I-_*U;b.x=(Y*(Q-U)-te*(M-L))/P,b.y=(Y*(_-I)-te*(D-B))/P}function Qx(n){n.rp0=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP0[]",n.rp0)}function Kx(n){n.rp1=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP1[]",n.rp1)}function Jx(n){n.rp2=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP2[]",n.rp2)}function eS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP0[]",e),n.zp0=e,e){case 0:n.tZone||Uc(n),n.z0=n.tZone;break;case 1:n.z0=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function tS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP1[]",e),n.zp1=e,e){case 0:n.tZone||Uc(n),n.z1=n.tZone;break;case 1:n.z1=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function nS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP2[]",e),n.zp2=e,e){case 0:n.tZone||Uc(n),n.z2=n.tZone;break;case 1:n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function aS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZPS[]",e),n.zp0=n.zp1=n.zp2=e,e){case 0:n.tZone||Uc(n),n.z0=n.z1=n.z2=n.tZone;break;case 1:n.z0=n.z1=n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function rS(n){n.loop=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SLOOP[]",n.loop)}function sS(n){exports.DEBUG&&console.log(n.step,"RTG[]"),n.round=Xg}function iS(n){exports.DEBUG&&console.log(n.step,"RTHG[]"),n.round=zx}function lS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SMD[]",e),n.minDis=e/64}function oS(n){exports.DEBUG&&console.log(n.step,"ELSE[]"),Wg(n,!1)}function cS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"JMPR[]",e),n.ip+=e-1}function uS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCVTCI[]",e),n.cvCutIn=e/64}function fS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DUP[]"),e.push(e[e.length-1])}function Ff(n){exports.DEBUG&&console.log(n.step,"POP[]"),n.stack.pop()}function dS(n){exports.DEBUG&&console.log(n.step,"CLEAR[]"),n.stack.length=0}function pS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SWAP[]"),e.push(a),e.push(s)}function hS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DEPTH[]"),e.push(e.length)}function mS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LOOPCALL[]",a,s);var l=n.ip,o=n.prog;n.prog=n.funcs[a];for(var u=0;u<s;u++)Ti(n),exports.DEBUG&&console.log(++n.step,u+1<s?"next loopcall":"done loopcall",u);n.ip=l,n.prog=o}function gS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"CALL[]",e);var a=n.ip,s=n.prog;n.prog=n.funcs[e],Ti(n),n.ip=a,n.prog=s,exports.DEBUG&&console.log(++n.step,"returning from",e)}function yS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CINDEX[]",a),e.push(e[e.length-a])}function vS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"MINDEX[]",a),e.push(e.splice(e.length-a,1)[0])}function bS(n){if(n.env!=="fpgm")throw new Error("FDEF not allowed here");var e=n.stack,a=n.prog,s=n.ip,l=e.pop(),o=s;for(exports.DEBUG&&console.log(n.step,"FDEF[]",l);a[++s]!==45;);n.ip=s,n.funcs[l]=a.slice(o+1,s)}function bm(n,e){var a=e.stack.pop(),s=e.z0[a],l=e.fv,o=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+n+"]",a);var u=o.distance(s,mo);n&&(u=e.round(u)),l.setRelative(s,mo,u,o),l.touch(s),e.rp0=e.rp1=a}function xm(n,e){var a=e.z2,s=a.length-2,l,o,u;exports.DEBUG&&console.log(e.step,"IUP["+n.axis+"]");for(var h=0;h<s;h++)l=a[h],!n.touched(l)&&(o=l.prevTouched(n),o!==l&&(u=l.nextTouched(n),o===u&&n.setRelative(l,l,n.distance(o,o,!1,!0),n,!0),n.interpolate(l,o,u,n)))}function Sm(n,e){for(var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=e.loop,p=e.z2;h--;){var g=a.pop(),v=p[g],A=u.distance(l,l,!1,!0);o.setRelative(v,v,A,u),o.touch(v),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-h)+": ":"")+"SHP["+(n?"rp1":"rp2")+"]",g)}e.loop=1}function wm(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=a.pop(),p=e.z2[e.contours[h]],g=p;exports.DEBUG&&console.log(e.step,"SHC["+n+"]",h);var v=u.distance(l,l,!1,!0);do g!==l&&o.setRelative(g,g,v,u),g=g.nextPointOnContour;while(g!==p)}function Em(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=a.pop();exports.DEBUG&&console.log(e.step,"SHZ["+n+"]",h);var p;switch(h){case 0:p=e.tZone;break;case 1:p=e.gZone;break;default:throw new Error("Invalid zone")}for(var g,v=u.distance(l,l,!1,!0),A=p.length-2,S=0;S<A;S++)g=p[S],o.setRelative(g,g,v,u)}function xS(n){for(var e=n.stack,a=n.loop,s=n.fv,l=e.pop()/64,o=n.z2;a--;){var u=e.pop(),h=o[u];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-a)+": ":"")+"SHPIX[]",u,l),s.setRelative(h,h,l),s.touch(h)}n.loop=1}function SS(n){for(var e=n.stack,a=n.rp1,s=n.rp2,l=n.loop,o=n.z0[a],u=n.z1[s],h=n.fv,p=n.dpv,g=n.z2;l--;){var v=e.pop(),A=g[v];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"IP[]",v,a,"<->",s),h.interpolate(A,o,u,p),h.touch(A)}n.loop=1}function Am(n,e){var a=e.stack,s=a.pop()/64,l=a.pop(),o=e.z1[l],u=e.z0[e.rp0],h=e.fv,p=e.pv;h.setRelative(o,u,s,p),h.touch(o),exports.DEBUG&&console.log(e.step,"MSIRP["+n+"]",s,l),e.rp1=e.rp0,e.rp2=l,n&&(e.rp0=l)}function wS(n){for(var e=n.stack,a=n.rp0,s=n.z0[a],l=n.loop,o=n.fv,u=n.pv,h=n.z1;l--;){var p=e.pop(),g=h[p];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"ALIGNRP[]",p),o.setRelative(g,s,0,u),o.touch(g)}n.loop=1}function ES(n){exports.DEBUG&&console.log(n.step,"RTDG[]"),n.round=Px}function Tm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z0[l],u=e.fv,h=e.pv,p=e.cvt[s];exports.DEBUG&&console.log(e.step,"MIAP["+n+"]",s,"(",p,")",l);var g=h.distance(o,mo);n&&(Math.abs(g-p)<e.cvCutIn&&(g=p),g=e.round(g)),u.setRelative(o,mo,g,h),e.zp0===0&&(o.xo=o.x,o.yo=o.y),u.touch(o),e.rp0=e.rp1=l}function AS(n){var e=n.prog,a=n.ip,s=n.stack,l=e[++a];exports.DEBUG&&console.log(n.step,"NPUSHB[]",l);for(var o=0;o<l;o++)s.push(e[++a]);n.ip=a}function TS(n){var e=n.ip,a=n.prog,s=n.stack,l=a[++e];exports.DEBUG&&console.log(n.step,"NPUSHW[]",l);for(var o=0;o<l;o++){var u=a[++e]<<8|a[++e];u&32768&&(u=-((u^65535)+1)),s.push(u)}n.ip=e}function CS(n){var e=n.stack,a=n.store;a||(a=n.store=[]);var s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"WS",s,l),a[l]=s}function MS(n){var e=n.stack,a=n.store,s=e.pop();exports.DEBUG&&console.log(n.step,"RS",s);var l=a&&a[s]||0;e.push(l)}function kS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTP",a,s),n.cvt[s]=a/64}function NS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"RCVT",a),e.push(n.cvt[a]*64)}function Cm(n,e){var a=e.stack,s=a.pop(),l=e.z2[s];exports.DEBUG&&console.log(e.step,"GC["+n+"]",s),a.push(e.dpv.distance(l,mo,n,!1)*64)}function Mm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z1[s],u=e.z0[l],h=e.dpv.distance(u,o,n,n);exports.DEBUG&&console.log(e.step,"MD["+n+"]",s,l,"->",h),e.stack.push(Math.round(h*64))}function RS(n){exports.DEBUG&&console.log(n.step,"MPPEM[]"),n.stack.push(n.ppem)}function DS(n){exports.DEBUG&&console.log(n.step,"FLIPON[]"),n.autoFlip=!0}function _S(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LT[]",a,s),e.push(s<a?1:0)}function OS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LTEQ[]",a,s),e.push(s<=a?1:0)}function IS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GT[]",a,s),e.push(s>a?1:0)}function LS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GTEQ[]",a,s),e.push(s>=a?1:0)}function jS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"EQ[]",a,s),e.push(a===s?1:0)}function US(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"NEQ[]",a,s),e.push(a!==s?1:0)}function BS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ODD[]",a),e.push(Math.trunc(a)%2?1:0)}function FS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"EVEN[]",a),e.push(Math.trunc(a)%2?0:1)}function PS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"IF[]",e),e||(Wg(n,!0),exports.DEBUG&&console.log(n.step,"EIF[]"))}function zS(n){exports.DEBUG&&console.log(n.step,"EIF[]")}function GS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"AND[]",a,s),e.push(a&&s?1:0)}function HS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"OR[]",a,s),e.push(a||s?1:0)}function YS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NOT[]",a),e.push(a?0:1)}function Pf(n,e){var a=e.stack,s=a.pop(),l=e.fv,o=e.pv,u=e.ppem,h=e.deltaBase+(n-1)*16,p=e.deltaShift,g=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+n+"]",s,a);for(var v=0;v<s;v++){var A=a.pop(),S=a.pop(),b=h+((S&240)>>4);if(b===u){var M=(S&15)-8;M>=0&&M++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",A,"by",M*p);var D=g[A];l.setRelative(D,D,M*p,o)}}}function VS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDB[]",a),n.deltaBase=a}function qS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDS[]",a),n.deltaShift=Math.pow(.5,a)}function XS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"ADD[]",a,s),e.push(s+a)}function $S(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SUB[]",a,s),e.push(s-a)}function WS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"DIV[]",a,s),e.push(s*64/a)}function ZS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MUL[]",a,s),e.push(s*a/64)}function QS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ABS[]",a),e.push(Math.abs(a))}function KS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NEG[]",a),e.push(-a)}function JS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"FLOOR[]",a),e.push(Math.floor(a/64)*64)}function e2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CEILING[]",a),e.push(Math.ceil(a/64)*64)}function Cc(n,e){var a=e.stack,s=a.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),a.push(e.round(s/64)*64)}function t2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTF[]",a,s),n.cvt[s]=a*n.ppem/n.font.unitsPerEm}function zf(n,e){var a=e.stack,s=a.pop(),l=e.ppem,o=e.deltaBase+(n-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+n+"]",s,a);for(var h=0;h<s;h++){var p=a.pop(),g=a.pop(),v=o+((g&240)>>4);if(v===l){var A=(g&15)-8;A>=0&&A++;var S=A*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",p,"by",S),e.cvt[p]+=S}}}function n2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SROUND[]",e),n.round=$g;var a;switch(e&192){case 0:a=.5;break;case 64:a=1;break;case 128:a=2;break;default:throw new Error("invalid SROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function a2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"S45ROUND[]",e),n.round=$g;var a;switch(e&192){case 0:a=Math.sqrt(2)/2;break;case 64:a=Math.sqrt(2);break;case 128:a=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function r2(n){exports.DEBUG&&console.log(n.step,"ROFF[]"),n.round=Fx}function s2(n){exports.DEBUG&&console.log(n.step,"RUTG[]"),n.round=Gx}function i2(n){exports.DEBUG&&console.log(n.step,"RDTG[]"),n.round=Hx}function l2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANCTRL[]",e)}function km(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log(e.step,"SDPVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.dpv=xo(h,p)}function o2(n){var e=n.stack,a=e.pop(),s=0;exports.DEBUG&&console.log(n.step,"GETINFO[]",a),a&1&&(s=35),a&32&&(s|=4096),e.push(s)}function c2(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"ROLL[]"),e.push(s),e.push(a),e.push(l)}function u2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MAX[]",a,s),e.push(Math.max(s,a))}function f2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MIN[]",a,s),e.push(Math.min(s,a))}function d2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANTYPE[]",e)}function p2(n){var e=n.stack.pop(),a=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"INSTCTRL[]",e,a),e){case 1:n.inhibitGridFit=!!a;return;case 2:n.ignoreCvt=!!a;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Xs(n,e){var a=e.stack,s=e.prog,l=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+n+"]");for(var o=0;o<n;o++)a.push(s[++l]);e.ip=l}function $s(n,e){var a=e.ip,s=e.prog,l=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+n+"]");for(var o=0;o<n;o++){var u=s[++a]<<8|s[++a];u&32768&&(u=-((u^65535)+1)),l.push(u)}e.ip=a}function Ze(n,e,a,s,l,o){var u=o.stack,h=n&&u.pop(),p=u.pop(),g=o.rp0,v=o.z0[g],A=o.z1[p],S=o.minDis,b=o.fv,M=o.dpv,D,L,B,Q;L=D=M.distance(A,v,!0,!0),B=L>=0?1:-1,L=Math.abs(L),n&&(Q=o.cvt[h],s&&Math.abs(L-Q)<o.cvCutIn&&(L=Q)),a&&L<S&&(L=S),s&&(L=o.round(L)),b.setRelative(A,v,B*L,M),b.touch(A),exports.DEBUG&&console.log(o.step,(n?"MIRP[":"MDRP[")+(e?"M":"m")+(a?">":"_")+(s?"R":"_")+(l===0?"Gr":l===1?"Bl":l===2?"Wh":"")+"]",n?h+"("+o.cvt[h]+","+Q+")":"",p,"(d =",D,"->",B*L,")"),o.rp1=o.rp0,o.rp2=p,e&&(o.rp0=p)}Yg=[hm.bind(void 0,ys),hm.bind(void 0,qr),mm.bind(void 0,ys),mm.bind(void 0,qr),gm.bind(void 0,ys),gm.bind(void 0,qr),ym.bind(void 0,0),ym.bind(void 0,1),vm.bind(void 0,0),vm.bind(void 0,1),Vx,qx,Xx,$x,Wx,Zx,Qx,Kx,Jx,eS,tS,nS,aS,rS,sS,iS,lS,oS,cS,uS,void 0,void 0,fS,Ff,dS,pS,hS,yS,vS,void 0,void 0,void 0,mS,gS,bS,void 0,bm.bind(void 0,0),bm.bind(void 0,1),xm.bind(void 0,ys),xm.bind(void 0,qr),Sm.bind(void 0,0),Sm.bind(void 0,1),wm.bind(void 0,0),wm.bind(void 0,1),Em.bind(void 0,0),Em.bind(void 0,1),xS,SS,Am.bind(void 0,0),Am.bind(void 0,1),wS,ES,Tm.bind(void 0,0),Tm.bind(void 0,1),AS,TS,CS,MS,kS,NS,Cm.bind(void 0,0),Cm.bind(void 0,1),void 0,Mm.bind(void 0,0),Mm.bind(void 0,1),RS,void 0,DS,void 0,void 0,_S,OS,IS,LS,jS,US,BS,FS,PS,zS,GS,HS,YS,Pf.bind(void 0,1),VS,qS,XS,$S,WS,ZS,QS,KS,JS,e2,Cc.bind(void 0,0),Cc.bind(void 0,1),Cc.bind(void 0,2),Cc.bind(void 0,3),void 0,void 0,void 0,void 0,t2,Pf.bind(void 0,2),Pf.bind(void 0,3),zf.bind(void 0,1),zf.bind(void 0,2),zf.bind(void 0,3),n2,a2,void 0,void 0,r2,void 0,s2,i2,Ff,Ff,void 0,void 0,void 0,void 0,void 0,l2,km.bind(void 0,0),km.bind(void 0,1),o2,void 0,c2,u2,f2,d2,p2,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Xs.bind(void 0,1),Xs.bind(void 0,2),Xs.bind(void 0,3),Xs.bind(void 0,4),Xs.bind(void 0,5),Xs.bind(void 0,6),Xs.bind(void 0,7),Xs.bind(void 0,8),$s.bind(void 0,1),$s.bind(void 0,2),$s.bind(void 0,3),$s.bind(void 0,4),$s.bind(void 0,5),$s.bind(void 0,6),$s.bind(void 0,7),$s.bind(void 0,8),Ze.bind(void 0,0,0,0,0,0),Ze.bind(void 0,0,0,0,0,1),Ze.bind(void 0,0,0,0,0,2),Ze.bind(void 0,0,0,0,0,3),Ze.bind(void 0,0,0,0,1,0),Ze.bind(void 0,0,0,0,1,1),Ze.bind(void 0,0,0,0,1,2),Ze.bind(void 0,0,0,0,1,3),Ze.bind(void 0,0,0,1,0,0),Ze.bind(void 0,0,0,1,0,1),Ze.bind(void 0,0,0,1,0,2),Ze.bind(void 0,0,0,1,0,3),Ze.bind(void 0,0,0,1,1,0),Ze.bind(void 0,0,0,1,1,1),Ze.bind(void 0,0,0,1,1,2),Ze.bind(void 0,0,0,1,1,3),Ze.bind(void 0,0,1,0,0,0),Ze.bind(void 0,0,1,0,0,1),Ze.bind(void 0,0,1,0,0,2),Ze.bind(void 0,0,1,0,0,3),Ze.bind(void 0,0,1,0,1,0),Ze.bind(void 0,0,1,0,1,1),Ze.bind(void 0,0,1,0,1,2),Ze.bind(void 0,0,1,0,1,3),Ze.bind(void 0,0,1,1,0,0),Ze.bind(void 0,0,1,1,0,1),Ze.bind(void 0,0,1,1,0,2),Ze.bind(void 0,0,1,1,0,3),Ze.bind(void 0,0,1,1,1,0),Ze.bind(void 0,0,1,1,1,1),Ze.bind(void 0,0,1,1,1,2),Ze.bind(void 0,0,1,1,1,3),Ze.bind(void 0,1,0,0,0,0),Ze.bind(void 0,1,0,0,0,1),Ze.bind(void 0,1,0,0,0,2),Ze.bind(void 0,1,0,0,0,3),Ze.bind(void 0,1,0,0,1,0),Ze.bind(void 0,1,0,0,1,1),Ze.bind(void 0,1,0,0,1,2),Ze.bind(void 0,1,0,0,1,3),Ze.bind(void 0,1,0,1,0,0),Ze.bind(void 0,1,0,1,0,1),Ze.bind(void 0,1,0,1,0,2),Ze.bind(void 0,1,0,1,0,3),Ze.bind(void 0,1,0,1,1,0),Ze.bind(void 0,1,0,1,1,1),Ze.bind(void 0,1,0,1,1,2),Ze.bind(void 0,1,0,1,1,3),Ze.bind(void 0,1,1,0,0,0),Ze.bind(void 0,1,1,0,0,1),Ze.bind(void 0,1,1,0,0,2),Ze.bind(void 0,1,1,0,0,3),Ze.bind(void 0,1,1,0,1,0),Ze.bind(void 0,1,1,0,1,1),Ze.bind(void 0,1,1,0,1,2),Ze.bind(void 0,1,1,0,1,3),Ze.bind(void 0,1,1,1,0,0),Ze.bind(void 0,1,1,1,0,1),Ze.bind(void 0,1,1,1,0,2),Ze.bind(void 0,1,1,1,0,3),Ze.bind(void 0,1,1,1,1,0),Ze.bind(void 0,1,1,1,1,1),Ze.bind(void 0,1,1,1,1,2),Ze.bind(void 0,1,1,1,1,3)];function ml(n){this.char=n,this.state={},this.activeState=null}function vd(n,e,a){this.contextName=a,this.startIndex=n,this.endOffset=e}function h2(n,e,a){this.contextName=n,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=a}function Sr(n,e){this.context=n,this.index=e,this.length=n.length,this.current=n[e],this.backtrack=n.slice(0,e),this.lookahead=n.slice(e+1)}function Bc(n){this.eventId=n,this.subscribers=[]}function m2(n){var e=this,a=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];a.forEach(function(l){Object.defineProperty(e.events,l,{value:new Bc(l)})}),n&&a.forEach(function(l){var o=n[l];typeof o=="function"&&e.events[l].subscribe(o)});var s=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];s.forEach(function(l){e.events[l].subscribe(e.updateContextsRanges)})}function pn(n){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],m2.call(this,n)}ml.prototype.setState=function(n,e){return this.state[n]=e,this.activeState={key:n,value:this.state[n]},this.activeState};ml.prototype.getState=function(n){return this.state[n]||null};pn.prototype.inboundIndex=function(n){return n>=0&&n<this.tokens.length};pn.prototype.composeRUD=function(n){var e=this,a=!0,s=n.map(function(o){return e[o[0]].apply(e,o.slice(1).concat(a))}),l=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(s.every(l))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:s.filter(l)};this.dispatch("composeRUD",[s.filter(function(o){return!l(o)})])};pn.prototype.replaceRange=function(n,e,a,s){e=e!==null?e:this.tokens.length;var l=a.every(function(u){return u instanceof ml});if(!isNaN(n)&&this.inboundIndex(n)&&l){var o=this.tokens.splice.apply(this.tokens,[n,e].concat(a));return s||this.dispatch("replaceToken",[n,e,a]),[o,a]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};pn.prototype.replaceToken=function(n,e,a){if(!isNaN(n)&&this.inboundIndex(n)&&e instanceof ml){var s=this.tokens.splice(n,1,e);return a||this.dispatch("replaceToken",[n,e]),[s[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};pn.prototype.removeRange=function(n,e,a){e=isNaN(e)?this.tokens.length:e;var s=this.tokens.splice(n,e);return a||this.dispatch("removeRange",[s,n,e]),s};pn.prototype.removeToken=function(n,e){if(!isNaN(n)&&this.inboundIndex(n)){var a=this.tokens.splice(n,1);return e||this.dispatch("removeToken",[a,n]),a}else return{FAIL:"removeToken: invalid token index."}};pn.prototype.insertToken=function(n,e,a){var s=n.every(function(l){return l instanceof ml});return s?(this.tokens.splice.apply(this.tokens,[e,0].concat(n)),a||this.dispatch("insertToken",[n,e]),n):{FAIL:"insertToken: invalid token(s)."}};pn.prototype.registerModifier=function(n,e,a){this.events.newToken.subscribe(function(s,l){var o=[s,l],u=e===null||e.apply(this,o)===!0,h=[s,l];if(u){var p=a.apply(this,h);s.setState(n,p)}}),this.registeredModifiers.push(n)};Bc.prototype.subscribe=function(n){return typeof n=="function"?this.subscribers.push(n)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Bc.prototype.unsubscribe=function(n){this.subscribers.splice(n,1)};Sr.prototype.setCurrentIndex=function(n){this.index=n,this.current=this.context[n],this.backtrack=this.context.slice(0,n),this.lookahead=this.context.slice(n+1)};Sr.prototype.get=function(n){switch(!0){case n===0:return this.current;case(n<0&&Math.abs(n)<=this.backtrack.length):return this.backtrack.slice(n)[0];case(n>0&&n<=this.lookahead.length):return this.lookahead[n-1];default:return null}};pn.prototype.rangeToText=function(n){if(n instanceof vd)return this.getRangeTokens(n).map(function(e){return e.char}).join("")};pn.prototype.getText=function(){return this.tokens.map(function(n){return n.char}).join("")};pn.prototype.getContext=function(n){var e=this.registeredContexts[n];return e||null};pn.prototype.on=function(n,e){var a=this.events[n];return a?a.subscribe(e):null};pn.prototype.dispatch=function(n,e){var a=this,s=this.events[n];s instanceof Bc&&s.subscribers.forEach(function(l){l.apply(a,e||[])})};pn.prototype.registerContextChecker=function(n,e,a){if(this.getContext(n))return{FAIL:"context name '"+n+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof a!="function")return{FAIL:"missing context end check."};var s=new h2(n,e,a);return this.registeredContexts[n]=s,this.contextCheckers.push(s),s};pn.prototype.getRangeTokens=function(n){var e=n.startIndex+n.endOffset;return[].concat(this.tokens.slice(n.startIndex,e))};pn.prototype.getContextRanges=function(n){var e=this.getContext(n);return e?e.ranges:{FAIL:"context checker '"+n+"' is not registered."}};pn.prototype.resetContextsRanges=function(){var n=this.registeredContexts;for(var e in n)if(n.hasOwnProperty(e)){var a=n[e];a.ranges=[]}};pn.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var n=this.tokens.map(function(s){return s.char}),e=0;e<n.length;e++){var a=new Sr(n,e);this.runContextCheck(a)}this.dispatch("updateContextsRanges",[this.registeredContexts])};pn.prototype.setEndOffset=function(n,e){var a=this.getContext(e).openRange.startIndex,s=new vd(a,n,e),l=this.getContext(e).ranges;return s.rangeId=e+"."+l.length,l.push(s),this.getContext(e).openRange=null,s};pn.prototype.runContextCheck=function(n){var e=this,a=n.index;this.contextCheckers.forEach(function(s){var l=s.contextName,o=e.getContext(l).openRange;if(!o&&s.checkStart(n)&&(o=new vd(a,null,l),e.getContext(l).openRange=o,e.dispatch("contextStart",[l,a])),o&&s.checkEnd(n)){var u=a-o.startIndex+1,h=e.setEndOffset(u,l);e.dispatch("contextEnd",[l,h])}})};pn.prototype.tokenize=function(n){this.tokens=[],this.resetContextsRanges();var e=Array.from(n);this.dispatch("start");for(var a=0;a<e.length;a++){var s=e[a],l=new Sr(e,a);this.dispatch("next",[l]),this.runContextCheck(l);var o=new ml(s);this.tokens.push(o),this.dispatch("newToken",[o,l])}return this.dispatch("end",[this.tokens]),this.tokens};function Qs(n){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(n)}function Zg(n){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(n)}function Ks(n){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(n)}function kc(n){return/[A-z]/.test(n)}function g2(n){return/\s/.test(n)}function Va(n){this.font=n,this.features={}}function Ai(n){this.id=n.id,this.tag=n.tag,this.substitution=n.substitution}function So(n,e){if(!n)return-1;switch(e.format){case 1:return e.glyphs.indexOf(n);case 2:for(var a=e.ranges,s=0;s<a.length;s++){var l=a[s];if(n>=l.start&&n<=l.end){var o=n-l.start;return l.index+o}}break;default:return-1}return-1}function y2(n,e){var a=So(n,e.coverage);return a===-1?null:n+e.deltaGlyphId}function v2(n,e){var a=So(n,e.coverage);return a===-1?null:e.substitute[a]}function Gf(n,e){for(var a=[],s=0;s<n.length;s++){var l=n[s],o=e.current;o=Array.isArray(o)?o[0]:o;var u=So(o,l);u!==-1&&a.push(u)}return a.length!==n.length?-1:a}function b2(n,e){var a=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(n.context.length<a)return[];var s=Gf(e.inputCoverage,n);if(s===-1)return[];var l=e.inputCoverage.length-1;if(n.lookahead.length<e.lookaheadCoverage.length)return[];for(var o=n.lookahead.slice(l);o.length&&Ks(o[0].char);)o.shift();var u=new Sr(o,0),h=Gf(e.lookaheadCoverage,u),p=[].concat(n.backtrack);for(p.reverse();p.length&&Ks(p[0].char);)p.shift();if(p.length<e.backtrackCoverage.length)return[];var g=new Sr(p,0),v=Gf(e.backtrackCoverage,g),A=s.length===e.inputCoverage.length&&h.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,S=[];if(A)for(var b=0;b<e.lookupRecords.length;b++)for(var M=e.lookupRecords[b],D=M.lookupListIndex,L=this.getLookupByIndex(D),B=0;B<L.subtables.length;B++){var Q=L.subtables[B],_=this.getLookupMethod(L,Q),U=this.getSubstitutionType(L,Q);if(U==="12")for(var I=0;I<s.length;I++){var P=n.get(I),Y=_(P);Y&&S.push(Y)}}return S}function x2(n,e){var a=n.current,s=So(a,e.coverage);if(s===-1)return null;for(var l,o=e.ligatureSets[s],u=0;u<o.length;u++){l=o[u];for(var h=0;h<l.components.length;h++){var p=n.lookahead[h],g=l.components[h];if(p!==g)break;if(h===l.components.length-1)return l}}return null}function S2(n,e){var a=So(n,e.coverage);return a===-1?null:e.sequences[a]}Va.prototype.getDefaultScriptFeaturesIndexes=function(){for(var n=this.font.tables.gsub.scripts,e=0;e<n.length;e++){var a=n[e];if(a.tag==="DFLT")return a.script.defaultLangSys.featureIndexes}return[]};Va.prototype.getScriptFeaturesIndexes=function(n){var e=this.font.tables;if(!e.gsub)return[];if(!n)return this.getDefaultScriptFeaturesIndexes();for(var a=this.font.tables.gsub.scripts,s=0;s<a.length;s++){var l=a[s];if(l.tag===n&&l.script.defaultLangSys)return l.script.defaultLangSys.featureIndexes;var o=l.langSysRecords;if(o)for(var u=0;u<o.length;u++){var h=o[u];if(h.tag===n){var p=h.langSys;return p.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};Va.prototype.mapTagsToFeatures=function(n,e){for(var a={},s=0;s<n.length;s++){var l=n[s].tag,o=n[s].feature;a[l]=o}this.features[e].tags=a};Va.prototype.getScriptFeatures=function(n){var e=this.features[n];if(this.features.hasOwnProperty(n))return e;var a=this.getScriptFeaturesIndexes(n);if(!a)return null;var s=this.font.tables.gsub;return e=a.map(function(l){return s.features[l]}),this.features[n]=e,this.mapTagsToFeatures(e,n),e};Va.prototype.getSubstitutionType=function(n,e){var a=n.lookupType.toString(),s=e.substFormat.toString();return a+s};Va.prototype.getLookupMethod=function(n,e){var a=this,s=this.getSubstitutionType(n,e);switch(s){case"11":return function(l){return y2.apply(a,[l,e])};case"12":return function(l){return v2.apply(a,[l,e])};case"63":return function(l){return b2.apply(a,[l,e])};case"41":return function(l){return x2.apply(a,[l,e])};case"21":return function(l){return S2.apply(a,[l,e])};default:throw new Error("lookupType: "+n.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};Va.prototype.lookupFeature=function(n){var e=n.contextParams,a=e.index,s=this.getFeature({tag:n.tag,script:n.script});if(!s)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+n.tag+"' for script '"+n.script+"'.");for(var l=this.getFeatureLookups(s),o=[].concat(e.context),u=0;u<l.length;u++)for(var h=l[u],p=this.getLookupSubtables(h),g=0;g<p.length;g++){var v=p[g],A=this.getSubstitutionType(h,v),S=this.getLookupMethod(h,v),b=void 0;switch(A){case"11":b=S(e.current),b&&o.splice(a,1,new Ai({id:11,tag:n.tag,substitution:b}));break;case"12":b=S(e.current),b&&o.splice(a,1,new Ai({id:12,tag:n.tag,substitution:b}));break;case"63":b=S(e),Array.isArray(b)&&b.length&&o.splice(a,1,new Ai({id:63,tag:n.tag,substitution:b}));break;case"41":b=S(e),b&&o.splice(a,1,new Ai({id:41,tag:n.tag,substitution:b}));break;case"21":b=S(e.current),b&&o.splice(a,1,new Ai({id:21,tag:n.tag,substitution:b}));break}e=new Sr(o,a),!(Array.isArray(b)&&!b.length)&&(b=null)}return o.length?o:null};Va.prototype.supports=function(n){if(!n.script)return!1;this.getScriptFeatures(n.script);var e=this.features.hasOwnProperty(n.script);if(!n.tag)return e;var a=this.features[n.script].some(function(s){return s.tag===n.tag});return e&&a};Va.prototype.getLookupSubtables=function(n){return n.subtables||null};Va.prototype.getLookupByIndex=function(n){var e=this.font.tables.gsub.lookups;return e[n]||null};Va.prototype.getFeatureLookups=function(n){return n.lookupListIndexes.map(this.getLookupByIndex.bind(this))};Va.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var a=this.features[e.script];return a?a.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function w2(n){var e=n.current,a=n.get(-1);return a===null&&Qs(e)||!Qs(a)&&Qs(e)}function E2(n){var e=n.get(1);return e===null||!Qs(e)}var A2={startCheck:w2,endCheck:E2};function T2(n){var e=n.current,a=n.get(-1);return(Qs(e)||Ks(e))&&!Qs(a)}function C2(n){var e=n.get(1);switch(!0){case e===null:return!0;case(!Qs(e)&&!Ks(e)):var a=g2(e);if(!a)return!0;if(a){var s=!1;if(s=n.lookahead.some(function(l){return Qs(l)||Ks(l)}),!s)return!0}break;default:return!1}}var M2={startCheck:T2,endCheck:C2};function k2(n,e,a){e[a].setState(n.tag,n.substitution)}function N2(n,e,a){e[a].setState(n.tag,n.substitution)}function R2(n,e,a){n.substitution.forEach(function(s,l){var o=e[a+l];o.setState(n.tag,s)})}function D2(n,e,a){var s=e[a];s.setState(n.tag,n.substitution.ligGlyph);for(var l=n.substitution.components.length,o=0;o<l;o++)s=e[a+o+1],s.setState("deleted",!0)}var Nm={11:k2,12:N2,63:R2,41:D2};function bd(n,e,a){n instanceof Ai&&Nm[n.id]&&Nm[n.id](n,e,a)}function _2(n){for(var e=[].concat(n.backtrack),a=e.length-1;a>=0;a--){var s=e[a],l=Zg(s),o=Ks(s);if(!l&&!o)return!0;if(l)return!1}return!1}function O2(n){if(Zg(n.current))return!1;for(var e=0;e<n.lookahead.length;e++){var a=n.lookahead[e],s=Ks(a);if(!s)return!0}return!1}function I2(n){var e=this,a="arab",s=this.featuresTags[a],l=this.tokenizer.getRangeTokens(n);if(l.length!==1){var o=new Sr(l.map(function(h){return h.getState("glyphIndex")}),0),u=new Sr(l.map(function(h){return h.char}),0);l.forEach(function(h,p){if(!Ks(h.char)){o.setCurrentIndex(p),u.setCurrentIndex(p);var g=0;_2(u)&&(g|=1),O2(u)&&(g|=2);var v;switch(g){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(s.indexOf(v)!==-1){var A=e.query.lookupFeature({tag:v,script:a,contextParams:o});if(A instanceof Error)return console.info(A.message);A.forEach(function(S,b){S instanceof Ai&&(bd(S,l,b),o.context[b]=S.substitution)})}}})}}function Rm(n,e){var a=n.map(function(s){return s.activeState.value});return new Sr(a,0)}function L2(n){var e=this,a="arab",s=this.tokenizer.getRangeTokens(n),l=Rm(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var h=e.query.lookupFeature({tag:"rlig",script:a,contextParams:l});h.length&&(h.forEach(function(p){return bd(p,s,u)}),l=Rm(s))})}function j2(n){var e=n.current,a=n.get(-1);return a===null&&kc(e)||!kc(a)&&kc(e)}function U2(n){var e=n.get(1);return e===null||!kc(e)}var B2={startCheck:j2,endCheck:U2};function Dm(n,e){var a=n.map(function(s){return s.activeState.value});return new Sr(a,0)}function F2(n){var e=this,a="latn",s=this.tokenizer.getRangeTokens(n),l=Dm(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var h=e.query.lookupFeature({tag:"liga",script:a,contextParams:l});h.length&&(h.forEach(function(p){return bd(p,s,u)}),l=Dm(s))})}function Ar(n){this.baseDir=n||"ltr",this.tokenizer=new pn,this.featuresTags={}}Ar.prototype.setText=function(n){this.text=n};Ar.prototype.contextChecks={latinWordCheck:B2,arabicWordCheck:A2,arabicSentenceCheck:M2};function Hf(n){var e=this.contextChecks[n+"Check"];return this.tokenizer.registerContextChecker(n,e.startCheck,e.endCheck)}function P2(){return Hf.call(this,"latinWord"),Hf.call(this,"arabicWord"),Hf.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function z2(){var n=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(a){var s=n.tokenizer.getRangeTokens(a);n.tokenizer.replaceRange(a.startIndex,a.endOffset,s.reverse())})}Ar.prototype.registerFeatures=function(n,e){var a=this,s=e.filter(function(l){return a.query.supports({script:n,tag:l})});this.featuresTags.hasOwnProperty(n)?this.featuresTags[n]=this.featuresTags[n].concat(s):this.featuresTags[n]=s};Ar.prototype.applyFeatures=function(n,e){if(!n)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Va(n));for(var a=0;a<e.length;a++){var s=e[a];this.query.supports({script:s.script})&&this.registerFeatures(s.script,s.tags)}};Ar.prototype.registerModifier=function(n,e,a){this.tokenizer.registerModifier(n,e,a)};function xd(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function G2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){xd.call(this);var a=this.tokenizer.getContextRanges("arabicWord");a.forEach(function(s){I2.call(n,s)})}}function H2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("rlig")!==-1){xd.call(this);var s=this.tokenizer.getContextRanges("arabicWord");s.forEach(function(l){L2.call(n,l)})}}}function Y2(){var n=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("liga")!==-1){xd.call(this);var s=this.tokenizer.getContextRanges("latinWord");s.forEach(function(l){F2.call(n,l)})}}}Ar.prototype.checkContextReady=function(n){return!!this.tokenizer.getContext(n)};Ar.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(G2.call(this),H2.call(this)),this.checkContextReady("latinWord")&&Y2.call(this),this.checkContextReady("arabicSentence")&&z2.call(this)};Ar.prototype.processText=function(n){(!this.text||this.text!==n)&&(this.setText(n),P2.call(this),this.applyFeaturesToContexts())};Ar.prototype.getBidiText=function(n){return this.processText(n),this.tokenizer.getText()};Ar.prototype.getTextGlyphs=function(n){this.processText(n);for(var e=[],a=0;a<this.tokenizer.tokens.length;a++){var s=this.tokenizer.tokens[a];if(!s.state.deleted){var l=s.activeState.value;e.push(Array.isArray(l)?l[0]:l)}}return e};function Vt(n){n=n||{},n.tables=n.tables||{},n.empty||(so(n.familyName,"When creating a new Font object, familyName is required."),so(n.styleName,"When creating a new Font object, styleName is required."),so(n.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),so(n.ascender,"When creating a new Font object, ascender is required."),so(n.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:n.familyName||" "},fontSubfamily:{en:n.styleName||" "},fullName:{en:n.fullName||n.familyName+" "+n.styleName},postScriptName:{en:n.postScriptName||(n.familyName+n.styleName).replace(/\s/g,"")},designer:{en:n.designer||" "},designerURL:{en:n.designerURL||" "},manufacturer:{en:n.manufacturer||" "},manufacturerURL:{en:n.manufacturerURL||" "},license:{en:n.license||" "},licenseURL:{en:n.licenseURL||" "},version:{en:n.version||"Version 0.1"},description:{en:n.description||" "},copyright:{en:n.copyright||" "},trademark:{en:n.trademark||" "}},this.unitsPerEm=n.unitsPerEm||1e3,this.ascender=n.ascender,this.descender=n.descender,this.createdTimestamp=n.createdTimestamp,this.tables=Object.assign(n.tables,{os2:Object.assign({usWeightClass:n.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:n.widthClass||this.usWidthClasses.MEDIUM,fsSelection:n.fsSelection||this.fsSelectionValues.REGULAR},n.tables.os2)})),this.supported=!0,this.glyphs=new Xr.GlyphSet(this,n.glyphs||[]),this.encoding=new hg(this),this.position=new vo(this),this.substitution=new Ya(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new qg(this)}})}Vt.prototype.hasChar=function(n){return this.encoding.charToGlyphIndex(n)!==null};Vt.prototype.charToGlyphIndex=function(n){return this.encoding.charToGlyphIndex(n)};Vt.prototype.charToGlyph=function(n){var e=this.charToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};Vt.prototype.updateFeatures=function(n){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(a){return n[a]})}:e})};Vt.prototype.stringToGlyphs=function(n,e){var a=this,s=new Ar,l=function(A){return a.charToGlyphIndex(A.char)};s.registerModifier("glyphIndex",null,l);var o=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;s.applyFeatures(this,o);for(var u=s.getTextGlyphs(n),h=u.length,p=new Array(h),g=this.glyphs.get(0),v=0;v<h;v+=1)p[v]=this.glyphs.get(u[v])||g;return p};Vt.prototype.nameToGlyphIndex=function(n){return this.glyphNames.nameToGlyphIndex(n)};Vt.prototype.nameToGlyph=function(n){var e=this.nameToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};Vt.prototype.glyphIndexToName=function(n){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(n):""};Vt.prototype.getKerningValue=function(n,e){n=n.index||n,e=e.index||e;var a=this.position.defaultKerningTables;return a?this.position.getKerningValue(a,n,e):this.kerningPairs[n+","+e]||0};Vt.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Vt.prototype.forEachGlyph=function(n,e,a,s,l,o){e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:72,l=Object.assign({},this.defaultRenderOptions,l);var u=1/this.unitsPerEm*s,h=this.stringToGlyphs(n,l),p;if(l.kerning){var g=l.script||this.position.getDefaultScriptName();p=this.position.getKerningTables(g,l.language)}for(var v=0;v<h.length;v+=1){var A=h[v];if(o.call(this,A,e,a,s,l),A.advanceWidth&&(e+=A.advanceWidth*u),l.kerning&&v<h.length-1){var S=p?this.position.getKerningValue(p,A.index,h[v+1].index):this.getKerningValue(A,h[v+1]);e+=S*u}l.letterSpacing?e+=l.letterSpacing*s:l.tracking&&(e+=l.tracking/1e3*s)}return e};Vt.prototype.getPath=function(n,e,a,s,l){var o=new An;return this.forEachGlyph(n,e,a,s,l,function(u,h,p,g){var v=u.getPath(h,p,g,l,this);o.extend(v)}),o};Vt.prototype.getPaths=function(n,e,a,s,l){var o=[];return this.forEachGlyph(n,e,a,s,l,function(u,h,p,g){var v=u.getPath(h,p,g,l,this);o.push(v)}),o};Vt.prototype.getAdvanceWidth=function(n,e,a){return this.forEachGlyph(n,0,0,e,a,function(){})};Vt.prototype.draw=function(n,e,a,s,l,o){this.getPath(e,a,s,l,o).draw(n)};Vt.prototype.drawPoints=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,h,p,g){u.drawPoints(n,h,p,g)})};Vt.prototype.drawMetrics=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,h,p,g){u.drawMetrics(n,h,p,g)})};Vt.prototype.getEnglishName=function(n){var e=this.names[n];if(e)return e.en};Vt.prototype.validate=function(){var n=this;function e(s,l){}function a(s){var l=n.getEnglishName(s);l&&l.trim().length>0}a("fontFamily"),a("weightName"),a("manufacturer"),a("copyright"),a("version"),this.unitsPerEm>0};Vt.prototype.toTables=function(){return Dx.fontToTable(this)};Vt.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Vt.prototype.toArrayBuffer=function(){for(var n=this.toTables(),e=n.encode(),a=new ArrayBuffer(e.length),s=new Uint8Array(a),l=0;l<e.length;l++)s[l]=e[l];return a};Vt.prototype.download=function(n){var e=this.getEnglishName("fontFamily"),a=this.getEnglishName("fontSubfamily");n=n||e.replace(/\s/g,"")+"-"+a+".otf";var s=this.toArrayBuffer();if(Ox())if(window.URL=window.URL||window.webkitURL,window.URL){var l=new DataView(s),o=new Blob([l],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(o),u.download=n;var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!1),u.dispatchEvent(h)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var p=require("fs"),g=Ix(s);p.writeFileSync(n,g)}};Vt.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Vt.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Vt.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function Qg(n,e){var a=JSON.stringify(n),s=256;for(var l in e){var o=parseInt(l);if(!(!o||o<256)){if(JSON.stringify(e[l])===a)return o;s<=o&&(s=o+1)}}return e[s]=n,s}function V2(n,e,a){var s=Qg(e.name,a);return[{name:"tag_"+n,type:"TAG",value:e.tag},{name:"minValue_"+n,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+n,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+n,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+n,type:"USHORT",value:0},{name:"nameID_"+n,type:"USHORT",value:s}]}function q2(n,e,a){var s={},l=new Qe.Parser(n,e);return s.tag=l.parseTag(),s.minValue=l.parseFixed(),s.defaultValue=l.parseFixed(),s.maxValue=l.parseFixed(),l.skip("uShort",1),s.name=a[l.parseUShort()]||{},s}function X2(n,e,a,s){for(var l=Qg(e.name,s),o=[{name:"nameID_"+n,type:"USHORT",value:l},{name:"flags_"+n,type:"USHORT",value:0}],u=0;u<a.length;++u){var h=a[u].tag;o.push({name:"axis_"+n+" "+h,type:"FIXED",value:e.coordinates[h]<<16})}return o}function $2(n,e,a,s){var l={},o=new Qe.Parser(n,e);l.name=s[o.parseUShort()]||{},o.skip("uShort",1),l.coordinates={};for(var u=0;u<a.length;++u)l.coordinates[a[u].tag]=o.parseFixed();return l}function W2(n,e){var a=new Xe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:n.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:n.instances.length},{name:"instanceSize",type:"USHORT",value:4+n.axes.length*4}]);a.offsetToData=a.sizeOf();for(var s=0;s<n.axes.length;s++)a.fields=a.fields.concat(V2(s,n.axes[s],e));for(var l=0;l<n.instances.length;l++)a.fields=a.fields.concat(X2(l,n.instances[l],n.axes,e));return a}function Z2(n,e,a){var s=new Qe.Parser(n,e),l=s.parseULong();ft.argument(l===65536,"Unsupported fvar table version.");var o=s.parseOffset16();s.skip("uShort",1);for(var u=s.parseUShort(),h=s.parseUShort(),p=s.parseUShort(),g=s.parseUShort(),v=[],A=0;A<u;A++)v.push(q2(n,e+o+A*h,a));for(var S=[],b=e+o+u*h,M=0;M<p;M++)S.push($2(n,b+M*g,v,a));return{axes:v,instances:S}}var Q2={make:W2,parse:Z2},K2=function(){return{coverage:this.parsePointer(be.coverage),attachPoints:this.parseList(be.pointer(be.uShortList))}},J2=function(){var n=this.parseUShort();if(ft.argument(n===1||n===2||n===3,"Unsupported CaretValue table version."),n===1)return{coordinate:this.parseShort()};if(n===2)return{pointindex:this.parseShort()};if(n===3)return{coordinate:this.parseShort()}},ew=function(){return this.parseList(be.pointer(J2))},tw=function(){return{coverage:this.parsePointer(be.coverage),ligGlyphs:this.parseList(be.pointer(ew))}},nw=function(){return this.parseUShort(),this.parseList(be.pointer(be.coverage))};function aw(n,e){e=e||0;var a=new be(n,e),s=a.parseVersion(1);ft.argument(s===1||s===1.2||s===1.3,"Unsupported GDEF table version.");var l={version:s,classDef:a.parsePointer(be.classDef),attachList:a.parsePointer(K2),ligCaretList:a.parsePointer(tw),markAttachClassDef:a.parsePointer(be.classDef)};return s>=1.2&&(l.markGlyphSets=a.parsePointer(nw)),l}var rw={parse:aw},wr=new Array(10);wr[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{posFormat:1,coverage:this.parsePointer(be.coverage),value:this.parseValueRecord()};if(a===2)return{posFormat:2,coverage:this.parsePointer(be.coverage),values:this.parseValueRecordList()};ft.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};wr[2]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();ft.assert(a===1||a===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var s=this.parsePointer(be.coverage),l=this.parseUShort(),o=this.parseUShort();if(a===1)return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,pairSets:this.parseList(be.pointer(be.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}})))};if(a===2){var u=this.parsePointer(be.classDef),h=this.parsePointer(be.classDef),p=this.parseUShort(),g=this.parseUShort();return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,classDef1:u,classDef2:h,class1Count:p,class2Count:g,classRecords:this.parseList(p,be.list(g,function(){return{value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}}))}}};wr[3]=function(){return{error:"GPOS Lookup 3 not supported"}};wr[4]=function(){return{error:"GPOS Lookup 4 not supported"}};wr[5]=function(){return{error:"GPOS Lookup 5 not supported"}};wr[6]=function(){return{error:"GPOS Lookup 6 not supported"}};wr[7]=function(){return{error:"GPOS Lookup 7 not supported"}};wr[8]=function(){return{error:"GPOS Lookup 8 not supported"}};wr[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function sw(n,e){e=e||0;var a=new be(n,e),s=a.parseVersion(1);return ft.argument(s===1||s===1.1,"Unsupported GPOS table version "+s),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(wr)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(wr),variations:a.parseFeatureVariationsList()}}var iw=new Array(10);function lw(n){return new Xe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Xe.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new Xe.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new Xe.LookupList(n.lookups,iw)}])}var ow={parse:sw,make:lw};function cw(n){var e={};n.skip("uShort");var a=n.parseUShort();ft.argument(a===0,"Unsupported kern sub-table version."),n.skip("uShort",2);var s=n.parseUShort();n.skip("uShort",3);for(var l=0;l<s;l+=1){var o=n.parseUShort(),u=n.parseUShort(),h=n.parseShort();e[o+","+u]=h}return e}function uw(n){var e={};n.skip("uShort");var a=n.parseULong();a>1&&console.warn("Only the first kern subtable is supported."),n.skip("uLong");var s=n.parseUShort(),l=s&255;if(n.skip("uShort"),l===0){var o=n.parseUShort();n.skip("uShort",3);for(var u=0;u<o;u+=1){var h=n.parseUShort(),p=n.parseUShort(),g=n.parseShort();e[h+","+p]=g}}return e}function fw(n,e){var a=new Qe.Parser(n,e),s=a.parseUShort();if(s===0)return cw(a);if(s===1)return uw(a);throw new Error("Unsupported kern table version ("+s+").")}var dw={parse:fw};function pw(n,e,a,s){for(var l=new Qe.Parser(n,e),o=s?l.parseUShort:l.parseULong,u=[],h=0;h<a+1;h+=1){var p=o.call(l);s&&(p*=2),u.push(p)}return u}var hw={parse:pw};function mw(n,e){var a=require("fs");a.readFile(n,function(s,l){if(s)return e(s.message);e(null,Fg(l))})}function gw(n,e){var a=new XMLHttpRequest;a.open("get",n,!0),a.responseType="arraybuffer",a.onload=function(){return a.response?e(null,a.response):e("Font could not be loaded: "+a.statusText)},a.onerror=function(){e("Font could not be loaded")},a.send()}function _m(n,e){for(var a=[],s=12,l=0;l<e;l+=1){var o=Qe.getTag(n,s),u=Qe.getULong(n,s+4),h=Qe.getULong(n,s+8),p=Qe.getULong(n,s+12);a.push({tag:o,checksum:u,offset:h,length:p,compression:!1}),s+=16}return a}function yw(n,e){for(var a=[],s=44,l=0;l<e;l+=1){var o=Qe.getTag(n,s),u=Qe.getULong(n,s+4),h=Qe.getULong(n,s+8),p=Qe.getULong(n,s+12),g=void 0;h<p?g="WOFF":g=!1,a.push({tag:o,offset:u,compression:g,compressedLength:h,length:p}),s+=20}return a}function yn(n,e){if(e.compression==="WOFF"){var a=new Uint8Array(n.buffer,e.offset+2,e.compressedLength-2),s=new Uint8Array(e.length);if(ob(a,s),s.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var l=new DataView(s.buffer,0);return{data:l,offset:0}}else return{data:n,offset:e.offset}}function Sd(n,e){e=e??{};var a,s,l=new Vt({empty:!0}),o=new DataView(n,0),u,h=[],p=Qe.getTag(o,0);if(p==="\0\0\0"||p==="true"||p==="typ1")l.outlinesFormat="truetype",u=Qe.getUShort(o,4),h=_m(o,u);else if(p==="OTTO")l.outlinesFormat="cff",u=Qe.getUShort(o,4),h=_m(o,u);else if(p==="wOFF"){var g=Qe.getTag(o,4);if(g==="\0\0\0")l.outlinesFormat="truetype";else if(g==="OTTO")l.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+p);u=Qe.getUShort(o,12),h=yw(o,u)}else throw new Error("Unsupported OpenType signature "+p);for(var v,A,S,b,M,D,L,B,Q,_,U,I,P=0;P<u;P+=1){var Y=h[P],te=void 0;switch(Y.tag){case"cmap":te=yn(o,Y),l.tables.cmap=pg.parse(te.data,te.offset),l.encoding=new mg(l.tables.cmap);break;case"cvt ":te=yn(o,Y),I=new Qe.Parser(te.data,te.offset),l.tables.cvt=I.parseShortList(Y.length/2);break;case"fvar":A=Y;break;case"fpgm":te=yn(o,Y),I=new Qe.Parser(te.data,te.offset),l.tables.fpgm=I.parseByteList(Y.length);break;case"head":te=yn(o,Y),l.tables.head=Tg.parse(te.data,te.offset),l.unitsPerEm=l.tables.head.unitsPerEm,a=l.tables.head.indexToLocFormat;break;case"hhea":te=yn(o,Y),l.tables.hhea=Cg.parse(te.data,te.offset),l.ascender=l.tables.hhea.ascender,l.descender=l.tables.hhea.descender,l.numberOfHMetrics=l.tables.hhea.numberOfHMetrics;break;case"hmtx":L=Y;break;case"ltag":te=yn(o,Y),s=kg.parse(te.data,te.offset);break;case"maxp":te=yn(o,Y),l.tables.maxp=Ng.parse(te.data,te.offset),l.numGlyphs=l.tables.maxp.numGlyphs;break;case"name":_=Y;break;case"OS/2":te=yn(o,Y),l.tables.os2=nd.parse(te.data,te.offset);break;case"post":te=yn(o,Y),l.tables.post=Lg.parse(te.data,te.offset),l.glyphNames=new hd(l.tables.post);break;case"prep":te=yn(o,Y),I=new Qe.Parser(te.data,te.offset),l.tables.prep=I.parseByteList(Y.length);break;case"glyf":S=Y;break;case"loca":Q=Y;break;case"CFF ":v=Y;break;case"kern":B=Y;break;case"GDEF":b=Y;break;case"GPOS":M=Y;break;case"GSUB":D=Y;break;case"meta":U=Y;break}}var oe=yn(o,_);if(l.tables.name=Ig.parse(oe.data,oe.offset,s),l.names=l.tables.name,S&&Q){var W=a===0,O=yn(o,Q),$=hw.parse(O.data,O.offset,l.numGlyphs,W),z=yn(o,S);l.glyphs=Hg.parse(z.data,z.offset,$,l,e)}else if(v){var K=yn(o,v);Ag.parse(K.data,K.offset,l,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var re=yn(o,L);if(Mg.parse(l,re.data,re.offset,l.numberOfHMetrics,l.numGlyphs,l.glyphs,e),Nb(l,e),B){var V=yn(o,B);l.kerningPairs=dw.parse(V.data,V.offset)}else l.kerningPairs={};if(b){var ee=yn(o,b);l.tables.gdef=rw.parse(ee.data,ee.offset)}if(M){var se=yn(o,M);l.tables.gpos=ow.parse(se.data,se.offset),l.position.init()}if(D){var ge=yn(o,D);l.tables.gsub=jg.parse(ge.data,ge.offset)}if(A){var Z=yn(o,A);l.tables.fvar=Q2.parse(Z.data,Z.offset,l.names)}if(U){var J=yn(o,U);l.tables.meta=Ug.parse(J.data,J.offset),l.metas=l.tables.meta}return l}function vw(n,e,a){a=a??{};var s=typeof window>"u",l=s&&!a.isUrl?mw:gw;return new Promise(function(o,u){l(n,function(h,p){if(h){if(e)return e(h);u(h)}var g;try{g=Sd(p,a)}catch(v){if(e)return e(v,null);u(v)}if(e)return e(null,g);o(g)})})}function bw(n,e){var a=require("fs"),s=a.readFileSync(n);return Sd(Fg(s),e)}var xw=Object.freeze({__proto__:null,Font:Vt,Glyph:Ha,Path:An,BoundingBox:bs,_parse:Qe,parse:Sd,load:vw,loadSync:bw});const Ci=(n,e)=>({...e,...n}),io=new Map;function gl(n,e){const{renderingStyle:a,thickness:s,blankingSize:l}=Ci(e,{renderingStyle:"normal",thickness:1,blankingSize:3});if(a==="normal"||!n||n.length===0)return n;const o=[];if(a==="dotted")for(const u of n)for(let h=0;h<s;h++)o.push({...u});else if(a==="blanked"){const u=Math.max(1,Math.floor(l));for(let h=0;h<n.length;h++){const p=n[h];p.blanking?o.push({...p}):Math.floor(h/u)%2===0?o.push({...p}):o.push({...p,r:0,g:0,b:0,blanking:!0})}}else if(a==="dots")for(const u of n)o.push({...u,r:0,g:0,b:0,blanking:!0}),o.push({...u,blanking:!1}),o.push({...u,blanking:!1});return o}async function Om(n,e){try{const{text:a,x:s,y:l,r:o,g:u,b:h,fontSize:p,numPoints:g,fontUrl:v}=Ci(n,{text:"TrueLazer",x:0,y:.3,r:255,g:255,b:255,fontSize:72,numPoints:100}),A=v||(e?`${e.byteLength}_${new Uint8Array(e.slice(0,100)).join("")}`:null);if(!A)throw new Error("A font buffer or URL is required to generate text.");let S=io.get(A);if(!S){if(!e)throw new Error(`Font buffer missing for ${v} and not in cache.`);if(S=xw.parse(e),io.set(A,S),io.size>10){const W=io.keys().next().value;io.delete(W)}}const b=S.getPath(a,0,0,p),M=b.commands,D=b.getBoundingBox(),L=(D.x1+D.x2)/2,B=(D.y1+D.y2)/2;let Q=0,_=0,U=0;M.forEach(W=>{if(W.type==="M")_=W.x,U=W.y;else if(W.type==="L"||W.type==="Q"||W.type==="C"){const O=W.x-_,$=W.y-U;Q+=Math.sqrt(O*O+$*$),_=W.x,U=W.y}});const I=g/(Q||1),P=[];_=0,U=0;let Y=0,te=0;const oe=200;if(M.forEach(W=>{if(W.type==="M"){if(P.length>0){const z=P[P.length-1];P.push({...z,r:0,g:0,b:0,blanking:!0})}Y=W.x,te=W.y;const O=(W.x-L)/oe+s,$=-(W.y-B)/oe+l;P.push({x:O,y:$,r:0,g:0,b:0,blanking:!0}),P.push({x:O,y:$,r:o,g:u,b:h,blanking:!1}),_=W.x,U=W.y}else if(W.type==="L"){const O=W.x-_,$=W.y-U,z=Math.sqrt(O*O+$*$),K=Math.max(1,Math.floor(z*I));for(let re=1;re<=K;re++){const V=re/K;P.push({x:(_+O*V-L)/oe+s,y:-(U+$*V-B)/oe+l,r:o,g:u,b:h})}_=W.x,U=W.y}else if(W.type==="Q"){const O=W.x-_,$=W.y-U,z=Math.sqrt(O*O+$*$),K=Math.max(2,Math.floor(z*I));for(let re=1;re<=K;re++){const V=re/K,ee=Math.pow(1-V,2)*_+2*(1-V)*V*W.x1+Math.pow(V,2)*W.x,se=Math.pow(1-V,2)*U+2*(1-V)*V*W.y1+Math.pow(V,2)*W.y;P.push({x:(ee-L)/oe+s,y:-(se-B)/oe+l,r:o,g:u,b:h})}_=W.x,U=W.y}else if(W.type==="C"){const O=W.x-_,$=W.y-U,z=Math.sqrt(O*O+$*$),K=Math.max(3,Math.floor(z*I));for(let re=1;re<=K;re++){const V=re/K,ee=Math.pow(1-V,3)*_+3*Math.pow(1-V,2)*V*W.x1+3*(1-V)*Math.pow(V,2)*W.x2+Math.pow(V,3)*W.x,se=Math.pow(1-V,3)*U+3*Math.pow(1-V,2)*V*W.y1+3*(1-V)*Math.pow(V,2)*W.y2+Math.pow(V,3)*W.y;P.push({x:(ee-L)/oe+s,y:-(se-B)/oe+l,r:o,g:u,b:h})}_=W.x,U=W.y}else W.type==="Z"&&(P.push({x:(Y-L)/oe+s,y:-(te-B)/oe+l,r:o,g:u,b:h}),_=Y,U=te)}),P.length>0){const W=P[P.length-1];P.push({...W,r:0,g:0,b:0,blanking:!0})}return{points:gl(P,n)}}catch(a){throw console.error("Error in generateText:",a),a}}function Im(n){try{const{radius:e,numPoints:a,x:s,y:l,r:o,g:u,b:h}=Ci(n,{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255}),p=[];for(let g=0;g<=a;g++){const v=g/a*2*Math.PI;p.push({x:e*Math.cos(v)+s,y:e*Math.sin(v)+l,r:o,g:u,b:h})}return{points:gl(p,n)}}catch(e){throw console.error("Error in generateCircle:",e),e}}function Lm(n){try{const{width:e,height:a,pointDensity:s,x:l,y:o,r:u,g:h,b:p}=Ci(n,{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255}),g=[{x:-e/2+l,y:-a/2+o},{x:e/2+l,y:-a/2+o},{x:e/2+l,y:a/2+o},{x:-e/2+l,y:a/2+o},{x:-e/2+l,y:-a/2+o}],v=[];for(let A=0;A<g.length-1;A++){const S=g[A],b=g[A+1];for(let M=0;M<s;M++){const D=M/s;v.push({x:S.x+(b.x-S.x)*D,y:S.y+(b.y-S.y)*D,r:u,g:h,b:p})}}return v.push({...g[g.length-1],r:u,g:h,b:p}),{points:gl(v,n)}}catch(e){throw console.error("Error in generateSquare:",e),e}}function jm(n){try{const{x1:e,y1:a,x2:s,y2:l,pointDensity:o,r:u,g:h,b:p}=Ci(n,{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255}),g=[];for(let v=0;v<=o;v++){const A=v/o;g.push({x:e+(s-e)*A,y:a+(l-a)*A,r:u,g:h,b:p})}return{points:gl(g,n)}}catch(e){throw console.error("Error in generateLine:",e),e}}function Um(n){try{const{outerRadius:e,innerRadius:a,numSpikes:s,pointDensity:l,x:o,y:u,r:h,g:p,b:g}=Ci(n,{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255}),v=[];for(let S=0;S<s*2;S++){const b=S%2===0?e:a,M=S/(s*2)*2*Math.PI-Math.PI/2;v.push({x:b*Math.cos(M)+o,y:b*Math.sin(M)+u})}v.push({...v[0]});const A=[];for(let S=0;S<v.length-1;S++){const b=v[S],M=v[S+1];for(let D=0;D<l;D++){const L=D/l;A.push({x:b.x+(M.x-b.x)*L,y:b.y+(M.y-b.y)*L,r:h,g:p,b:g})}}return A.push({...v[v.length-1],r:h,g:p,b:g}),{points:gl(A,n)}}catch(e){throw console.error("Error in generateStar:",e),e}}function Sw(n){try{const{amplitude:e,frequency:a,phase:s,width:l,numPoints:o,x:u,y:h,r:p,g,b:v}=Ci(n,{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255}),A=[],S=-l/2;for(let b=0;b<=o;b++){const M=b/o,D=S+M*l,L=e*Math.sin(a*(D*Math.PI)+s);A.push({x:D+u,y:L+h,r:p,g,b:v})}return{points:gl(A,n)}}catch(e){throw console.error("Error in generateSinewave:",e),e}}const oo=()=>Math.random().toString(36).substr(2,9),ww=vn.memo(({playbackFps:n,onSpeedChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_speed",targetType:"global",label:"SPEED",min:1,max:120,step:1}))};return f.jsxs("div",{className:"master-speed-slider",children:[f.jsxs("label",{htmlFor:"masterSpeedRange",draggable:!0,onDragStart:a,children:[n," FPS"]}),f.jsx(Kt,{id:"master_speed",children:f.jsx("input",{type:"range",min:"1",max:"120",value:n,className:"slider_hor",id:"masterSpeedRange",onChange:s=>e(parseInt(s.target.value))})})]})}),Ew=vn.memo(({isWorldOutputActive:n,onToggleWorldOutput:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"laser_output",targetType:"global",label:"LASER"}))};return f.jsx("div",{className:"container",draggable:!0,onDragStart:a,children:f.jsx(Kt,{id:"laser_output",children:f.jsx("input",{type:"checkbox",className:"laser-toggle",checked:n,onChange:e})})})}),co=(n,e,a,s)=>!Array.isArray(n)||n.length!==e?Array(e).fill(null).map((l,o)=>Array(a).fill(null).map((u,h)=>s(o,h))):n.map((l,o)=>!Array.isArray(l)||l.length!==a?Array(a).fill(null).map((u,h)=>s(o,h)):l),Kg=n=>({columns:Array.from({length:8},(e,a)=>`Col ${a+1}`),layers:Array.from({length:5},(e,a)=>`Layer ${a+1}`),clipContents:co(n?.clipContents,5,8,()=>({parsing:!1})),clipNames:co(n?.clipNames,5,8,(e,a)=>`Clip ${e+1}-${a+1}`),thumbnailFrameIndexes:Array(5).fill(null).map(()=>Array(8).fill(0)),layerEffects:Array.from({length:5},()=>[]),layerAssignedDacs:n?.layerAssignedDacs??Array(5).fill([]),layerIntensities:Array(5).fill(1),layerAutopilots:Array(5).fill("off"),layerBlackouts:Array(5).fill(!1),layerSolos:Array(5).fill(!1),masterIntensity:1,globalBlackout:!1,selectedLayerIndex:null,selectedColIndex:null,notification:{message:"",visible:!1},dacs:[],selectedDac:n?.dacAssignment?.selectedDac??n?.selectedDac??null,fileBrowserViewMode:"list",fileBrowserPath:"",layerUiStates:Array(6).fill({}),ildaFrames:[],selectedIldaWorkerId:null,selectedIldaTotalFrames:0,bpm:n?.bpm??120,showBeamEffect:n?.renderSettings?.showBeamEffect??!0,beamAlpha:n?.renderSettings?.beamAlpha??.1,fadeAlpha:n?.renderSettings?.fadeAlpha??.13,playbackFps:n?.renderSettings?.playbackFps??60,previewScanRate:n?.renderSettings?.previewScanRate??1,beamRenderMode:n?.renderSettings?.beamRenderMode??"both",worldShowBeamEffect:n?.renderSettings?.worldShowBeamEffect??!0,worldBeamRenderMode:n?.renderSettings?.worldBeamRenderMode??"both",optimizationEnabled:n?.renderSettings?.optimizationEnabled??!0,activeClipIndexes:Array(5).fill(null),isPlaying:!1,isStopped:!0,isWorldOutputActive:!1,thumbnailRenderMode:n?.thumbnailRenderMode??"still",theme:n?.theme??"orange",projectLoadTimestamp:null,clipClipboard:null,dacOutputSettings:n?.dacOutputSettings??{},quickAssigns:{knobs:Array(8).fill(null).map(()=>({value:0,label:null,link:null})),buttons:Array(8).fill(null).map(()=>({value:!1,label:null,link:null}))}});function Aw(n,e){switch(e.type){case"SET_DAC_OUTPUT_SETTINGS":return{...n,dacOutputSettings:{...n.dacOutputSettings,[e.payload.id]:e.payload.settings}};case"SET_COLUMNS":return{...n,columns:e.payload};case"SET_COLUMN_NAME":{const a=[...n.columns];return a[e.payload.index]=e.payload.name,{...n,columns:a}}case"DUPLICATE_COLUMN":{const a=e.payload.index,s=[...n.columns];s.splice(a+1,0,`${s[a]} (Copy)`);const l=n.clipContents.map(h=>{const p=[...h],g=p[a];let v=null;if(g&&(v=JSON.parse(JSON.stringify(g)),v.type==="ilda"&&(v.workerId=null),v.effects)){const A=v.syncSettings||{};v.effects=v.effects.map(S=>{const b=S.instanceId,M=oo();return Object.keys(A).forEach(D=>{b&&D.startsWith(`${b}.`)&&(A[`${M}.${D.split(".")[1]}`]=A[D],delete A[D])}),{...S,instanceId:M}}),v.syncSettings=A}return p.splice(a+1,0,v),p}),o=n.clipNames.map(h=>{const p=[...h];return p.splice(a+1,0,`${p[a]} (Copy)`),p}),u=n.thumbnailFrameIndexes.map(h=>{const p=[...h];return p.splice(a+1,0,p[a]),p});return{...n,columns:s,clipContents:l,clipNames:o,thumbnailFrameIndexes:u}}case"SET_LAYERS":return{...n,layers:e.payload};case"SET_LAYER_NAME":{const a=[...n.layers];return a[e.payload.index]=e.payload.name,{...n,layers:a}}case"SET_CLIP_CONTENT":{const{layerIndex:a,colIndex:s,content:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipContents];if(!o[a])return console.error(`Reducer Error: Layer array at index ${a} is undefined. Action:`,e),n;o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,...l},{...n,clipContents:o}}case"SET_CLIP_NAME":{const{layerIndex:a,colIndex:s,name:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipNames];return o[a]&&(o[a]=[...o[a]],o[a][s]=l),{...n,clipNames:o}}case"SET_THUMBNAIL_FRAME_INDEX":{const a=[...n.thumbnailFrameIndexes];return a[e.payload.layerIndex][e.payload.colIndex]=e.payload.index,{...n,thumbnailFrameIndexes:a}}case"ADD_LAYER_EFFECT":{const a=[...n.layerEffects],s={...e.payload.effect,instanceId:oo(),params:{...e.payload.effect.defaultParams}};return a[e.payload.layerIndex].push(s),{...n,layerEffects:a}}case"ADD_CLIP_EFFECT":{const a=[...n.clipContents];if(!a[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),n;a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=a[e.payload.layerIndex][e.payload.colIndex]||{},l={...e.payload.effect,instanceId:oo(),params:{...e.payload.effect.defaultParams}},o={...s,effects:[...s.effects||[],l]};return a[e.payload.layerIndex][e.payload.colIndex]=o,{...n,clipContents:a}}case"SET_SELECTED_CLIP":return{...n,selectedLayerIndex:e.payload.layerIndex,selectedColIndex:e.payload.colIndex};case"SET_NOTIFICATION":return{...n,notification:e.payload};case"SET_ILDA_FRAMES":return{...n,ildaFrames:e.payload};case"SET_SELECTED_ILDA_DATA":return{...n,selectedIldaWorkerId:e.payload.workerId,selectedIldaTotalFrames:e.payload.totalFrames,selectedGeneratorId:e.payload.generatorId,selectedGeneratorParams:e.payload.generatorParams};case"SET_ACTIVE_CLIP":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]=e.payload.colIndex,{...n,activeClipIndexes:a}}case"CLEAR_CLIP":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]],a[e.payload.layerIndex][e.payload.colIndex]=null;const s=[...n.clipNames];s[e.payload.layerIndex][e.payload.colIndex]=`Clip ${e.payload.layerIndex+1}-${e.payload.colIndex+1}`;const l=[...n.thumbnailFrameIndexes];l[e.payload.layerIndex][e.payload.colIndex]=0;const o=[...n.activeClipIndexes];return o[e.payload.layerIndex]===e.payload.colIndex&&(o[e.payload.layerIndex]=null),n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex?{...n,clipContents:a,clipNames:s,thumbnailFrameIndexes:l,activeClipIndexes:o,selectedLayerIndex:null,selectedColIndex:null,selectedIldaWorkerId:null,selectedIldaTotalFrames:0,selectedGeneratorId:null,selectedGeneratorParams:{}}:{...n,clipContents:a,clipNames:s,thumbnailFrameIndexes:l,activeClipIndexes:o}}case"DEACTIVATE_LAYER_CLIPS":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]=null,{...n,activeClipIndexes:a}}case"CLEAR_ALL_ACTIVE_CLIPS":return{...n,activeClipIndexes:Array(n.layers.length).fill(null)};case"SET_LAYER_INTENSITY":{const a=[...n.layerIntensities];return a[e.payload.layerIndex]=e.payload.intensity,{...n,layerIntensities:a}}case"SET_LAYER_AUTOPILOT":{const a=[...n.layerAutopilots];return a[e.payload.layerIndex]=e.payload.mode,{...n,layerAutopilots:a}}case"TOGGLE_LAYER_BLACKOUT":{const a=[...n.layerBlackouts];return a[e.payload.layerIndex]=!a[e.payload.layerIndex],{...n,layerBlackouts:a}}case"TOGGLE_LAYER_SOLO":{const a=[...n.layerSolos],s=a[e.payload.layerIndex];return a.fill(!1),s||(a[e.payload.layerIndex]=!0),{...n,layerSolos:a}}case"SET_MASTER_INTENSITY":return{...n,masterIntensity:e.payload};case"TOGGLE_GLOBAL_BLACKOUT":return{...n,globalBlackout:!n.globalBlackout};case"SET_RENDER_SETTING":return{...n,[e.payload.setting]:e.payload.value};case"SET_FILE_BROWSER_VIEW_MODE":return{...n,fileBrowserViewMode:e.payload};case"SET_FILE_BROWSER_PATH":return{...n,fileBrowserPath:e.payload};case"UPDATE_CLIP_UI_STATE":{const{layerIndex:a,colIndex:s,uiState:l}=e.payload,o=[...n.clipContents];o[a]=[...o[a]];const u={...o[a][s]};return u&&(u.uiState={...u.uiState||{},...l},o[a][s]=u),{...n,clipContents:o}}case"UPDATE_LAYER_UI_STATE":{const{layerIndex:a,uiState:s}=e.payload,l=[...n.layerUiStates];return l[a]={...l[a],...s},{...n,layerUiStates:l}}case"REMOVE_CLIP_EFFECT":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};if(s&&s.effects){const l=[...s.effects];l.splice(e.payload.effectIndex,1),s.effects=l,a[e.payload.layerIndex][e.payload.colIndex]=s}return{...n,clipContents:a}}case"REORDER_CLIP_EFFECTS":{const{layerIndex:a,colIndex:s,oldIndex:l,newIndex:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h&&h.effects){const p=[...h.effects],[g]=p.splice(l,1);p.splice(o,0,g),h.effects=p,u[a][s]=h}return{...n,clipContents:u}}case"REMOVE_LAYER_EFFECT":{const a=[...n.layerEffects];return a[e.payload.layerIndex]&&(a[e.payload.layerIndex]=[...a[e.payload.layerIndex]],a[e.payload.layerIndex].splice(e.payload.effectIndex,1)),{...n,layerEffects:a}}case"UPDATE_LAYER_EFFECT_PARAMETER":{const a=[...n.layerEffects];if(a[e.payload.layerIndex]){a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=e.payload.effectIndex;if(a[e.payload.layerIndex][s]){const l={...a[e.payload.layerIndex][s]};l.params={...l.params,[e.payload.paramName]:e.payload.newValue},a[e.payload.layerIndex][s]=l}}return{...n,layerEffects:a}}case"UPDATE_EFFECT_PARAMETER":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};if(s&&s.effects){const l=[...s.effects],o={...l[e.payload.effectIndex]};o.params={...o.params,[e.payload.paramName]:e.payload.newValue},l[e.payload.effectIndex]=o,s.effects=l,a[e.payload.layerIndex][e.payload.colIndex]=s}return{...n,clipContents:a}}case"UPDATE_CLIP_PLAYBACK_SETTINGS":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};return s&&(s.playbackSettings={...s.playbackSettings||{mode:"fps",duration:1,beats:8,speedMultiplier:1},...e.payload.settings},a[e.payload.layerIndex][e.payload.colIndex]=s),{...n,clipContents:a}}case"SET_CLIP_PARAM_SYNC":{const{layerIndex:a,colIndex:s,paramId:l,syncMode:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h){const p=h.syncSettings||{},g=p[l]===o?null:o;h.syncSettings={...p,[l]:g},u[a][s]=h}return{...n,clipContents:u}}case"UPDATE_GENERATOR_PARAM":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};return s&&s.type==="generator"&&s.currentParams&&(s.currentParams={...s.currentParams,[e.payload.paramName]:e.payload.newValue},a[e.payload.layerIndex][e.payload.colIndex]=s,n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex)?{...n,clipContents:a,selectedGeneratorParams:s.currentParams}:{...n,clipContents:a}}case"SET_DACS":return{...n,dacs:e.payload};case"SET_BPM":return{...n,bpm:e.payload};case"SET_SELECTED_DAC":return{...n,selectedDac:e.payload};case"SET_IS_PLAYING":return{...n,isPlaying:e.payload};case"SET_IS_STOPPED":return{...n,isStopped:e.payload};case"SET_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:e.payload};case"SET_OPTIMIZATION_ENABLED":return{...n,optimizationEnabled:e.payload};case"TOGGLE_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:!n.isWorldOutputActive};case"SET_CLIPBOARD":return{...n,clipClipboard:e.payload};case"SET_CLIP_DAC":{const a=[...n.clipContents];if(!a[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),n;a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=a[e.payload.layerIndex][e.payload.colIndex]||{};let l=s.assignedDacs||[];const o=[],u=p=>{const{channels:g,allChannels:v,...A}=p;return A};if(e.payload.dac.allChannels&&e.payload.dac.channels)e.payload.dac.channels.forEach(p=>{l.some(g=>g.ip===e.payload.dac.ip&&g.channel===p.serviceID)||o.push({...u(e.payload.dac),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=e.payload.dac.channel;p!==void 0&&!l.some(g=>g.ip===e.payload.dac.ip&&g.channel===p)&&o.push({...u(e.payload.dac),channel:p,mirrorX:!1,mirrorY:!1})}if(o.length===0)return n;const h={...s,assignedDacs:[...l,...o]};return a[e.payload.layerIndex][e.payload.colIndex]=h,{...n,clipContents:a}}case"SET_CLIP_DAC_GROUP":{const{layerIndex:a,colIndex:s,groupDacs:l}=e.payload,o=[...n.clipContents];o[a]=[...o[a]];const u=o[a][s]||{},h=u.assignedDacs||[],p=l.filter(g=>!h.some(v=>v.ip===g.ip&&v.channel===g.channel)).map(g=>({...g,mirrorX:!1,mirrorY:!1}));return p.length===0?n:(o[a][s]={...u,assignedDacs:[...h,...p]},{...n,clipContents:o})}case"SET_LAYER_DAC":{const{layerIndex:a,dac:s}=e.payload,l=[...n.layerAssignedDacs],o=l[a]||[];let u=[];const h=p=>{const{channels:g,allChannels:v,...A}=p;return A};if(s.allChannels&&s.channels)s.channels.forEach(p=>{o.some(g=>g.ip===s.ip&&g.channel===p.serviceID)||u.push({...h(s),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=s.channel;p!==void 0&&!o.some(g=>g.ip===s.ip&&g.channel===p)&&u.push({...h(s),channel:p,mirrorX:!1,mirrorY:!1})}return u.length===0?n:(l[a]=[...o,...u],{...n,layerAssignedDacs:l})}case"SET_LAYER_DAC_GROUP":{const{layerIndex:a,groupDacs:s}=e.payload,l=[...n.layerAssignedDacs],o=l[a]||[],u=s.filter(h=>!o.some(p=>p.ip===h.ip&&p.channel===h.channel)).map(h=>({...h,mirrorX:!1,mirrorY:!1}));return u.length===0?n:(l[a]=[...o,...u],{...n,layerAssignedDacs:l})}case"TOGGLE_CLIP_DAC_MIRROR":{const{layerIndex:a,colIndex:s,dacIndex:l,axis:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h&&h.assignedDacs){const p=[...h.assignedDacs],g={...p[l]};return o==="x"&&(g.mirrorX=!g.mirrorX),o==="y"&&(g.mirrorY=!g.mirrorY),p[l]=g,h.assignedDacs=p,u[a][s]=h,{...n,clipContents:u}}return n}case"REMOVE_CLIP_DAC":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const{layerIndex:s,colIndex:l,dacIndex:o}=e.payload,u=a[s][l];if(u&&u.assignedDacs){const h=[...u.assignedDacs];return h.splice(o,1),a[e.payload.layerIndex][e.payload.colIndex]={...u,assignedDacs:h},{...n,clipContents:a}}return n}case"TOGGLE_LAYER_DAC_MIRROR":{const{layerIndex:a,dacIndex:s,axis:l}=e.payload,o=[...n.layerAssignedDacs],u=o[a]?[...o[a]]:[];if(u[s]){const h={...u[s]};return l==="x"&&(h.mirrorX=!h.mirrorX),l==="y"&&(h.mirrorY=!h.mirrorY),u[s]=h,o[a]=u,{...n,layerAssignedDacs:o}}return n}case"REMOVE_LAYER_DAC":{const{layerIndex:a,dacIndex:s}=e.payload,l=[...n.layerAssignedDacs];if(l[a]){const o=[...l[a]];return o.splice(s,1),l[a]=o,{...n,layerAssignedDacs:l}}return n}case"SET_CLIP_AUDIO":{const a=[...n.clipContents],{layerIndex:s,colIndex:l,audioFile:o}=e.payload;a[s]=[...a[s]];const u=a[s][l];return u?(a[s][l]={...u,audioFile:o,audioVolume:u.audioVolume!==void 0?u.audioVolume:1},{...n,clipContents:a}):n}case"SET_CLIP_AUDIO_VOLUME":{const a=[...n.clipContents],{layerIndex:s,colIndex:l,volume:o}=e.payload;a[s]=[...a[s]];const u=a[s][l];return u?(a[s][l]={...u,audioVolume:o},{...n,clipContents:a}):n}case"REMOVE_CLIP_AUDIO":{const a=[...n.clipContents],{layerIndex:s,colIndex:l}=e.payload;a[s]=[...a[s]];const o=a[s][l];return o?(a[s][l]={...o,audioFile:null},{...n,clipContents:a}):n}case"SET_CLIP_PARSING_STATUS":{const{layerIndex:a,colIndex:s,status:l}=e.payload,o=[...n.clipContents];if(o[a]){o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,parsing:l},{...n,clipContents:o}}return n}case"SET_BULK_PARSING_STATUS":{const a=[...n.clipContents];return new Set(e.payload.map(l=>l.layerIndex)).forEach(l=>{a[l]&&(a[l]=[...a[l]])}),e.payload.forEach(({layerIndex:l,colIndex:o,status:u})=>{if(a[l]){const h=a[l][o]||{};a[l][o]={...h,parsing:u}}}),{...n,clipContents:a}}case"SET_THUMBNAIL_RENDER_MODE":return{...n,thumbnailRenderMode:e.payload};case"SET_CLIP_TRIGGER_STYLE":{const{layerIndex:a,colIndex:s,style:l}=e.payload,o=[...n.clipContents];o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,triggerStyle:l},{...n,clipContents:o}}case"SET_THEME":return{...n,theme:e.payload};case"UPDATE_THUMBNAIL":{const{layerIndex:a,colIndex:s,frameIndex:l}=e.payload,o=[...n.thumbnailFrameIndexes];return o[a]=[...o[a]],o[a][s]=l,{...n,thumbnailFrameIndexes:o}}case"RESET_STATE":return Kg({});case"LOAD_PROJECT":{const a={...n,...e.payload};return a.clipContents=co(a.clipContents,5,8,()=>({parsing:!1})),a.clipNames=co(a.clipNames,5,8,(s,l)=>`Clip ${s+1}-${l+1}`),a.clipContents=a.clipContents.map(s=>s.map(l=>l&&l.type==="ilda"?{...l,workerId:null,parsing:!1}:l)),a.activeClipIndexes=Array(n.layers.length).fill(null),a.selectedLayerIndex=null,a.selectedColIndex=null,a.selectedIldaWorkerId=null,a.selectedIldaTotalFrames=0,a.selectedGeneratorId=null,a.selectedGeneratorParams={},a.projectLoadTimestamp=Date.now(),a}case"LOAD_SETTINGS":return{...n,showBeamEffect:e.payload.renderSettings?.showBeamEffect??n.showBeamEffect,beamAlpha:e.payload.renderSettings?.beamAlpha??n.beamAlpha,fadeAlpha:e.payload.renderSettings?.fadeAlpha??n.fadeAlpha,playbackFps:e.payload.renderSettings?.playbackFps??n.playbackFps,previewScanRate:e.payload.renderSettings?.previewScanRate??n.previewScanRate,beamRenderMode:e.payload.renderSettings?.beamRenderMode??n.beamRenderMode,theme:e.payload.theme??n.theme,thumbnailRenderMode:e.payload.thumbnailRenderMode??n.thumbnailRenderMode,selectedDac:e.payload.selectedDac??n.selectedDac,clipNames:e.payload.clipNames?co(e.payload.clipNames,5,8,(a,s)=>`Clip ${a+1}-${s+1}`):n.clipNames,dacOutputSettings:e.payload.dacOutputSettings??n.dacOutputSettings};case"ASSIGN_QUICK_CONTROL":{const{type:a,index:s,link:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons";return o[u][s]={...o[u][s],label:l.paramName||l.paramId,link:l,min:l.min,max:l.max,step:l.step},{...n,quickAssigns:o}}case"CLEAR_QUICK_CONTROL":{const{type:a,index:s}=e.payload,l={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},o=a==="knob"?"knobs":"buttons";return l[o][s]={value:a==="knob"?0:!1,label:null,link:null},{...n,quickAssigns:l}}case"UPDATE_QUICK_CONTROL":{const{type:a,index:s,value:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons",h=o[u][s];o[u][s]={...h,value:l};let p={...n,quickAssigns:o};if(h.link){const{layerIndex:g,colIndex:v,effectIndex:A,targetType:S}=h.link,b=h.link.paramName||h.link.paramId;let M=l;if(a==="knob"&&h.min!==void 0&&h.max!==void 0&&(M=h.min+l*(h.max-h.min),h.step&&(M=Math.round(M/h.step)*h.step),M=parseFloat(M.toFixed(5))),console.log(`Updating ${S} param ${b} to ${M} (Link: L${g} C${v} E${A})`),S==="layerEffect"){const D=[...p.layerEffects];if(D[g]&&(D[g]=[...D[g]],D[g][A])){const L={...D[g][A]};L.params={...L.params,[b]:M},D[g][A]=L,p={...p,layerEffects:D}}}else if(S==="global")b==="master_intensity"?p={...p,masterIntensity:M}:b==="master_speed"&&(p={...p,playbackFps:M});else{const D=[...p.clipContents];if(D[g]){D[g]=[...D[g]];const L=D[g][v];if(L)if(S==="effect"&&L.effects&&L.effects[A]){const B=[...L.effects],Q={...B[A]};Q.params={...Q.params,[b]:M},B[A]=Q,D[g][v]={...L,effects:B}}else S==="generator"&&(D[g][v]={...L,currentParams:{...L.currentParams,[b]:M}});p.clipContents=D}}}return p}case"TOGGLE_QUICK_BUTTON":{const{index:a}=e.payload,l=!n.quickAssigns.buttons[a].value,o={...n.quickAssigns,buttons:[...n.quickAssigns.buttons]};o.buttons[a]={...o.buttons[a],value:l};let u={...n,quickAssigns:o};const h=o.buttons[a];if(h.link){const{layerIndex:p,colIndex:g,effectIndex:v,targetType:A}=h.link,S=h.link.paramName||h.link.paramId;if(A==="global")S==="blackout"?u.globalBlackout=l:S==="laser_output"&&(u.isWorldOutputActive=l);else if(A==="layer"){if(S==="blackout"){const b=[...u.layerBlackouts];b[p]=l,u={...u,layerBlackouts:b}}else if(S==="solo"){const b=[...u.layerSolos];l?(b.fill(!1),b[p]=!0):b[p]=!1,u={...u,layerSolos:b}}else if(S==="clear"){if(l){const b=[...u.activeClipIndexes];b[p]=null,u={...u,activeClipIndexes:b},o.buttons[a].value=!1,u.quickAssigns=o}}else if(S==="autopilot"){const b=[...u.layerAutopilots];b[p]=l?"forward":"off",u={...u,layerAutopilots:b}}}else if(A==="layerEffect"){const b=[...u.layerEffects];if(b[p]&&(b[p]=[...b[p]],b[p][v])){const M={...b[p][v]};M.params={...M.params,[S]:l},b[p][v]=M,u={...u,layerEffects:b}}}else{const b=[...u.clipContents];if(b[p]){b[p]=[...b[p]];const M=b[p][g];if(M)if(A==="effect"&&M.effects&&M.effects[v]){const D=[...M.effects],L={...D[v]};L.params={...L.params,[S]:l},D[v]=L,b[p][g]={...M,effects:D}}else A==="generator"&&(b[p][g]={...M,currentParams:{...M.currentParams,[S]:l}});u.clipContents=b}}}return u}case"UPDATE_CLIP_FILE_PATH":{const{oldPath:a,newPath:s}=e.payload;console.log(`Reducer: Updating clip path from ${a} to ${s}`);const l=n.clipContents.map(o=>o.map(u=>{let h=u;return u&&u.filePath===a&&(h={...h,filePath:s,parsingFailed:!1}),u&&u.audioFile&&u.audioFile.path===a&&(h={...h,audioFile:{...u.audioFile,path:s}}),h}));return{...n,clipContents:l}}case"SET_CLIP_PARSING_FAILED":{const{layerIndex:a,colIndex:s,failed:l}=e.payload,o=[...n.clipContents];if(o[a]){o[a]=[...o[a]];const u=o[a][s];u&&(o[a][s]={...u,parsingFailed:l})}return{...n,clipContents:o}}default:return n}}const Yf=async(n,e,a,s,l=!0)=>{if(!n||!n.points)return null;let o=n;if(l)try{const B=od(n.points);o={...n,points:B,isTypedArray:!0}}catch(B){console.warn("Failed to optimize points for thumbnail:",B)}let u=o;try{e&&e.length>0&&(u=uo(o,e,{progress:0,time:0,effectStates:{},assignedDacs:[]}))}catch(B){console.warn("Failed to apply effects for thumbnail:",B)}const h=128,p=128,g=document.createElement("canvas");g.width=h,g.height=p;const v=g.getContext("2d");v.fillStyle="#000000",v.fillRect(0,0,h,p);const A=u.points,S=u.isTypedArray||A instanceof Float32Array,b=S?A.length/8:A.length;v.lineWidth=1.5,v.lineCap="round";let M=null,D=null,L=!0;for(let B=0;B<b;B++){let Q,_,U,I,P,Y;if(S){const W=B*8;Q=A[W],_=A[W+1],U=A[W+3],I=A[W+4],P=A[W+5],Y=A[W+6]>.5}else{const W=A[B];Q=W.x,_=W.y,U=W.r,I=W.g,P=W.b,Y=!!W.blanking}const te=(Q+1)*.5*h,oe=(1-(_+1)*.5)*p;if(!Y&&!L&&M!==null){v.beginPath(),v.moveTo(M,D),v.lineTo(te,oe);const W=Math.floor(Math.max(0,Math.min(255,U))),O=Math.floor(Math.max(0,Math.min(255,I))),$=Math.floor(Math.max(0,Math.min(255,P)));v.strokeStyle=`rgb(${W},${O},${$})`,v.stroke()}M=te,D=oe,L=Y}try{const Q=await(await new Promise(_=>g.toBlob(_,"image/png"))).arrayBuffer();if(window.electronAPI&&window.electronAPI.saveThumbnail){const _=`thumb_L${a}_C${s}.png`;return await window.electronAPI.saveThumbnail(Q,_)}}catch(B){console.error("Error generating/saving thumbnail:",B)}return null},Bm=vn.memo(({type:n,previewFrameCountRef:e,totalPointsSentRef:a,activeChannelsCountRef:s,lastStatUpdateTimeRef:l})=>{const[o,u]=T.useState({cpu:"0.0",ram:"0",fps:0,pps:0,avgPps:0});return T.useEffect(()=>{const h=window.electronAPI?.onSystemStats(g=>{u(v=>({...v,...g}))});let p;return n==="performance"&&l&&e&&a&&s&&(p=setInterval(()=>{const g=performance.now(),v=(g-(l.current||0))/1e3;if(v>0){const A=Math.round((e.current||0)/v),S=Math.round((a.current||0)/v),b=(s.current||0)>0?Math.round(S/s.current):0;u(M=>({...M,fps:A,pps:S,avgPps:b})),e.current=0,a.current=0,l.current=g}},1e3)),()=>{h&&h(),p&&clearInterval(p)}},[n,e,a,s,l]),n==="system"?f.jsxs("div",{className:"systemStats",children:[f.jsxs("p",{className:"sysStats",children:["CPU: ",o.cpu,"%"]}),f.jsxs("p",{className:"sysStats",children:["RAM: ",o.ram,"MB"]})]}):f.jsxs("div",{className:"performanceStats",children:[f.jsxs("p",{className:"perfStats",children:["FPS: ",o.fps]}),f.jsxs("p",{className:"perfStats",children:["AnimPPS: ",o.avgPps," (Avg)"]})]})}),Tw=vn.memo(({playbackFps:n,previewScanRate:e,previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})=>f.jsxs("div",{className:"system-monitor-grid",children:[f.jsx(Bm,{type:"performance",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o}),f.jsx(Bm,{type:"system",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})]})),Cw=vn.memo(({clipContents:n,activeClipIndexes:e,layerEffects:a,bpm:s,playbackFps:l,selectedLayerIndex:o,selectedColIndex:u,liveFramesRef:h,progressRef:p,selectedDac:g,liveDacOutputSettingsRef:v,dacOutputSettings:A,getAudioInfo:S,fftLevels:b,getFftLevels:M,effectStatesRef:D,clipActivationTimesRef:L,showBeamEffect:B,beamAlpha:Q,fadeAlpha:_,previewScanRate:U,beamRenderMode:I,worldShowBeamEffect:P,worldBeamRenderMode:Y,masterIntensity:te,layerIntensities:oe,globalBlackout:W,layerSolos:O,layerBlackouts:$,handleToggleBeamEffect:z,handleCycleDisplayMode:K,previewFrameCountRef:re,totalPointsSentRef:V,activeChannelsCountRef:ee,lastStatUpdateTimeRef:se,liveClipContentsRef:ge,optimizationEnabled:Z})=>{const[J,Se]=T.useState(0),Ae=T.useRef(0),Le=T.useRef(performance.now()),Ye=1e3/70;T.useEffect(()=>{let ze;const nt=Fe=>{Fe-Ae.current>Ye&&(re.current++,Le.current=performance.now(),Se(at=>at+1),Ae.current=Fe),ze=requestAnimationFrame(nt)};return ze=requestAnimationFrame(nt),()=>cancelAnimationFrame(ze)},[Ye,re]);const Ue=ge?.current||n,pt=o!==null&&u!==null?Ue[o][u]:null,it=u!==null?pt?.type==="ilda"?pt?.workerId:`generator-${o}-${u}`:o!==null&&e[o]!==null?Ue[o][e[o]]?.type==="ilda"?Ue[o][e[o]]?.workerId:`generator-${o}-${e[o]}`:null,De=it?h.current[it]:null,qe=it&&p.current[it]||0;let lt=[],wt=1;if(o!==null){const ze=a[o]||[];if(u!==null)lt=[...pt?.effects||[],...ze];else{const at=e[o];at!==null?lt=[...Ue[o][at]?.effects||[],...ze]:lt=ze}const nt=O.some(at=>at);let Fe=oe[o];W?Fe=0:nt?Fe=O[o]?$[o]?0:Fe:0:$[o]&&(Fe=0),wt=Fe*te}const gt=T.useMemo(()=>{const ze={};return e.forEach((nt,Fe)=>{if(nt!==null){const at=Ue[Fe][nt];if(at){let In=at.type==="ilda"?at.workerId:`generator-${Fe}-${nt}`;In&&h.current[In]&&(ze[In]={frame:h.current[In],effects:[...at.effects||[],...a[Fe]||[]],layerIndex:Fe,syncSettings:at.syncSettings||{},bpm:s,clipDuration:(()=>{const Tn=at.playbackSettings||{};return Tn.mode==="timeline"?Tn.duration||1:Tn.mode==="bpm"?(Tn.beats||8)*60/(s||120):(at.totalFrames||30)/(at.fps||l||30)})(),progress:p.current[In]||0,effectStates:D.current,clipActivationTime:L.current[Fe]||0})}}}),ze},[e,Ue,J,s,a,l,h,p,D,L]),Bt=T.useMemo(()=>{const ze=O.some(nt=>nt);return oe.map((nt,Fe)=>W?0:ze?O[Fe]?$[Fe]?0:nt:0:$[Fe]?0:nt)},[oe,$,O,W]);return f.jsxs("div",{className:"side-panel",children:[f.jsx(Rv,{frame:De,effects:lt,showBeamEffect:B,beamAlpha:Q,fadeAlpha:_,previewScanRate:U,beamRenderMode:I,intensity:wt,syncSettings:pt?.syncSettings,bpm:s,clipDuration:(()=>{const ze=pt?.playbackSettings||{};return ze.mode==="timeline"?ze.duration||1:ze.mode==="bpm"?(ze.beats||8)*60/(s||120):(pt?.totalFrames||30)/(pt?.fps||l||30)})(),progress:qe,previewTime:Le.current,fftLevels:M?M():b,effectStates:D.current,clipActivationTime:o!==null&&L.current[o]||0,optimizationEnabled:Z,onToggleBeamEffect:()=>z("clip"),onCycleDisplayMode:()=>K("clip")}),f.jsx(Dv,{activeFrames:gt,showBeamEffect:P,beamAlpha:Q,fadeAlpha:_,previewScanRate:U,beamRenderMode:Y,layerIntensities:Bt,masterIntensity:te,dacSettings:g?v.current?v.current[`${g.ip}:${g.channel}`]:A[`${g.ip}:${g.channel}`]:null,previewTime:Le.current,fftLevels:M?M():b,optimizationEnabled:Z,onToggleBeamEffect:()=>z("world"),onCycleDisplayMode:()=>K("world")})]})});function Mw(){const n=$v(),e=qm(),a=Qv(),{fftLevels:s,getFftLevels:l,fftDataRef:o,timeDataRef:u}=go()||{},{devices:h,selectedDeviceId:p,setSelectedDeviceId:g,playAudio:v,stopAudio:A,pauseAllAudio:S,resumeAllAudio:b,setPlaybackRate:M,resetAllAudio:D,stopAllAudio:L,getAudioInfo:B,setClipVolume:Q}=tg();T.useRef(new Set),T.useRef(0);const _=T.useRef({}),U=T.useRef(new Map),I=T.useRef({}),P=T.useRef({}),Y=T.useRef({}),te=T.useRef({}),oe=T.useRef(new Set),W=T.useRef({}),[O,$]=T.useState(null),[z,K]=T.useState(!1),[re,V]=T.useState("main"),[ee,se]=T.useState(!1),[ge,Z]=T.useState(!1),[J,Se]=T.useState({midi:!1,artnet:!1,osc:!1,keyboard:!1}),[Ae,Le]=T.useState(!1),[Ye,Ue]=T.useState(!1),[pt,it]=T.useState(!1),[De,qe]=T.useState(!1),[lt,wt]=T.useState({title:"",initialValue:"",onSave:()=>{}}),[gt,Bt]=T.useState("files"),[ze,nt]=T.useState("clip"),[Fe,at]=T.useState([]),In=T.useRef(0),Tn=T.useRef(0),mt=T.useRef(0),zn=T.useRef(performance.now()),[Pe,we]=T.useReducer(Aw,Kg(z?O:{})),rn=T.useRef(new Map),Ot=T.useCallback((x,w,R=30)=>{rn.current.has(x)&&clearTimeout(rn.current.get(x));const E=setTimeout(()=>{we(w),rn.current.delete(x)},R);rn.current.set(x,E)},[]),{columns:It,layers:Lt,clipContents:et,clipNames:$r,thumbnailFrameIndexes:la,layerEffects:qa,layerAssignedDacs:Cn,layerIntensities:cr,layerAutopilots:Gn,layerBlackouts:ka,layerSolos:Mn,masterIntensity:Wr,globalBlackout:Zn,selectedLayerIndex:$e,selectedColIndex:ct,notification:Tr,dacs:ha,selectedDac:oa,ildaFrames:Mi,selectedIldaWorkerId:Na,selectedIldaTotalFrames:Cr,showBeamEffect:Ra,beamAlpha:Xa,fadeAlpha:kn,playbackFps:Ut,previewScanRate:Wt,beamRenderMode:sn,worldShowBeamEffect:Zr,worldBeamRenderMode:kt,optimizationEnabled:ca,activeClipIndexes:Jt,isPlaying:Hn,isWorldOutputActive:Qn,selectedGeneratorId:ur,selectedGeneratorParams:Da,thumbnailRenderMode:ln,theme:ma,dacOutputSettings:At}=Pe,Dt=T.useMemo(()=>Lt.map((x,w)=>{const R=Jt[w];if(R!==null){const E=et[w][R];if(E){let N,j=null;if(E.type==="ilda"&&E.workerId&&E.totalFrames)return N=E.workerId,j=E.stillFrame,{type:"ilda",workerId:N,totalFrames:E.totalFrames,effects:E.effects||[],dac:E.dac||null,assignedDacs:E.assignedDacs||[],ildaFormat:E.ildaFormat||0,stillFrame:j,layerIndex:w,syncSettings:E.syncSettings||{},fps:E.fps||null};if(E.type==="generator"&&E.frames&&E.generatorDefinition)return N=`generator-${w}-${R}`,j=E.stillFrame||E.frames?.[0]||null,{type:"generator",workerId:N,totalFrames:E.frames.length,effects:E.effects||[],dac:E.dac||null,assignedDacs:E.assignedDacs||[],ildaFormat:0,stillFrame:j,layerIndex:w,syncSettings:E.syncSettings||{},fps:E.fps||null}}}return null}).filter(Boolean),[Lt,Jt,et]),Ge=T.useRef(et),Ve=T.useRef(null),Nn=T.useRef(!1),ga=T.useRef(null),Qr=T.useRef(!1);T.useEffect(()=>{et&&(Ve.current=structuredClone(et))},[]),T.useEffect(()=>{At&&(ga.current=structuredClone(At))},[]);const en=T.useRef(cr),Kn=T.useRef(Gn),Ln=T.useRef(qa),Jn=T.useRef(Wr),ea=T.useRef(ka),ta=T.useRef(Mn),Kr=T.useRef(Zn),Rn=T.useRef(Hn),_a=T.useRef(Qn),qt=T.useRef(oa),Yn=T.useRef(Pe.bpm),$a=T.useRef($e),hn=T.useRef(ct),ya=T.useRef(null),Js=T.useRef(B),Mr=T.useRef(ca);T.useEffect(()=>{Rn.current=Hn},[Hn]),T.useEffect(()=>{_a.current=Qn},[Qn]),T.useEffect(()=>{qt.current=oa},[oa]),T.useEffect(()=>{Yn.current=Pe.bpm},[Pe.bpm]),T.useEffect(()=>{$a.current=$e},[$e]),T.useEffect(()=>{hn.current=ct},[ct]),T.useEffect(()=>{Js.current=B},[B]),T.useEffect(()=>{Mr.current=ca},[ca]);const fr=T.useRef(Ut);T.useEffect(()=>{fr.current=Ut},[Ut]);const dr=T.useRef(At),ki=T.useRef(ha),jn=T.useRef([]),Oa=T.useRef(Jt),ei=T.useRef(Cn),va=T.useRef($r),Wa=T.useRef(Na),Ni=T.useRef(Cr),ti=T.useRef({}),ba=T.useRef(new Map),kr=T.useRef(new Map),pr=T.useRef(new Map),Jr=T.useRef(null),Nr=T.useRef({}),hr=T.useRef(null),Ia=T.useRef(0),es=T.useRef(new Map),Rr=T.useRef(new Map),Dr=T.useRef(new Map);T.useRef(performance.now()),T.useEffect(()=>{if(Nn.current){Nn.current=!1;return}et&&(Ve.current=structuredClone(et))},[et]),T.useEffect(()=>{if(Qr.current){Qr.current=!1;return}At&&(ga.current=structuredClone(At))},[At]),T.useEffect(()=>{en.current=cr,Kn.current=Gn,Ln.current=qa,Jn.current=Wr,ea.current=ka,ta.current=Mn,Kr.current=Zn,fr.current=Ut,ki.current=ha,jn.current=Dt,Ge.current=et,Oa.current=Jt,ei.current=Cn,va.current=$r,Wa.current=Na,Ni.current=Cr},[cr,Cn,Gn,qa,Wr,ka,Mn,Zn,At,ha,Dt,et,Jt,$r,Na,Cr]);const _r=T.useCallback(x=>{const w=1-x*2,R=[],E=100;for(let N=0;N<E;N++){const j=N/(E-1)*2-1;R.push({x:j,y:w,r:0,g:255,b:0,blanking:!1})}return{points:R,isTypedArray:!1}},[]),mr=T.useCallback((x,w)=>{ga.current&&(ga.current[x]=w,Qr.current=!0),we({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:x,settings:w}})},[]),ni=T.useCallback(x=>{we({type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:x}})},[]);T.useEffect(()=>{const x=Ut/60;M(x)},[Ut,M]);const tn=x=>{we({type:"SET_NOTIFICATION",payload:{message:x,visible:!0}}),setTimeout(()=>{we({type:"SET_NOTIFICATION",payload:{message:"",visible:!1}})},3e3)};T.useEffect(()=>{const x={orange:"#ff5e00",yellow:"#ffd400",cyan:"#00fff3","light-blue":"#0089ff",blue:"#005aff",magenta:"#fb00ff",red:"#ff0000",green:"#00ff00",white:"#ffffff"},w=x[ma]||x.orange;document.documentElement.style.setProperty("--theme-color",w);const R=parseInt(w.slice(1,3),16),E=parseInt(w.slice(3,5),16),N=parseInt(w.slice(5,7),16);document.documentElement.style.setProperty("--theme-color-transparent",`rgba(${R}, ${E}, ${N}, 0.3)`),window.electronAPI&&window.electronAPI.setTheme&&window.electronAPI.setTheme(ma)},[ma]),T.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedDac&&window.electronAPI.setSelectedDac(oa)},[oa]),T.useMemo(()=>{const x=new Set;return Na&&x.add(Na),Dt.forEach(w=>{w&&w.type==="ilda"&&w.workerId&&x.add(w.workerId)}),Array.from(x)},[Na,Dt]),T.useEffect(()=>{if(!n)return;const x=async ae=>{if(!ae.data.browserFile){if(ae.data.type==="get-frame"&&ae.data.success)if(ae.data.isStillFrame){const{workerId:xe,frame:fe,layerIndex:me,colIndex:ke}=ae.data;if(me===void 0||ke===void 0)return;let Ne=null;const je=(Ve.current?Ve.current:Ge.current)?.[me]?.[ke],Oe=je?.effects||[];let Ie=null;const Je=je?.assignedDacs||[];if(Je.length>0){const Ke=Je[0],st=`${Ke.ip}:${Ke.channel}`;Ie=dr.current[st]}else if(oa){const Ke=`${oa.ip}:${oa.channel}`;Ie=dr.current[Ke]}let rt=fe;Ie&&(rt=Xf(fe,Ie)),Ne=await Yf(rt,Oe,me,ke,ca),we({type:"SET_CLIP_CONTENT",payload:{layerIndex:me,colIndex:ke,content:{stillFrame:fe,parsing:!1,thumbnailPath:Ne,thumbnailVersion:Date.now()}}})}else _.current[ae.data.workerId]=ae.data.frame;else if(ae.data.type==="parse-ilda"&&ae.data.success){const{workerId:xe,totalFrames:fe,ildaFormat:me,fileName:ke,filePath:Ne,layerIndex:Te,colIndex:je}=ae.data;if(Te===void 0||je===void 0)return;const Oe={type:"ilda",workerId:xe,totalFrames:fe,ildaFormat:me,fileName:ke,filePath:Ne,parsing:!0,playbackSettings:{mode:"fps",duration:fe/60,beats:8,speedMultiplier:1}};we({type:"SET_CLIP_CONTENT",payload:{layerIndex:Te,colIndex:je,content:Oe}});const Ie=va.current[Te][je],Je=`Clip ${Te+1}-${je+1}`;Ie===Je&&we({type:"SET_CLIP_NAME",payload:{layerIndex:Te,colIndex:je,name:ke}})}else if(ae.data.type==="get-all-frames"&&ae.data.success){console.log("Received get-all-frames response:",ae.data);const{frames:xe,workerId:fe,layerIndex:me,colIndex:ke}=ae.data;if(me===void 0||ke===void 0)return;I0(async()=>{const{framesToIlda:Ne}=await Promise.resolve().then(()=>X0);return{framesToIlda:Ne}},void 0,import.meta.url).then(({framesToIlda:Ne})=>{const Te=Ne(xe),Oe=Ge.current[me][ke].fileName||"export.ild";window.electronAPI&&window.electronAPI.saveIldaFile&&window.electronAPI.saveIldaFile(Te,Oe).then(Ie=>{Ie.success?tn(`Exported to ${Ie.filePath}`):Ie.error&&tn(`Export failed: ${Ie.error}`)})}).catch(Ne=>console.error("Failed to load ilda-writer in response:",Ne))}else if(ae.data.success===!1){tn(`Worker error: ${ae.data.error}`);const{layerIndex:xe,colIndex:fe}=ae.data;xe!==void 0&&fe!==void 0&&we({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:xe,colIndex:fe,status:!1}})}}};n.addEventListener("message",x);let w,R,E=0;const N=60,j=1e3/N,q=ae=>{if(ae.length===0)return null;if(ae.length===1){const ke=ae[0],Ne=ke.points instanceof Float32Array||ke.isTypedArray;return{...ke,points:Ne?new Float32Array(ke.points):ke.points.map(Te=>({...Te})),isTypedArray:Ne}}let xe=0;ae.forEach((ke,Ne)=>{const je=ke.points instanceof Float32Array||ke.isTypedArray?ke.points.length/8:ke.points.length;xe+=je,Ne<ae.length-1&&(xe+=2)});const fe=new Float32Array(xe*8);let me=0;return ae.forEach((ke,Ne)=>{const Te=ke.points instanceof Float32Array||ke.isTypedArray,je=Te?ke.points.length/8:ke.points.length;for(let Oe=0;Oe<je;Oe++){const Ie=(me+Oe)*8;if(Te){const Je=Oe*8;fe.set(ke.points.subarray(Je,Je+8),Ie)}else{const Je=ke.points[Oe];fe[Ie]=Je.x,fe[Ie+1]=Je.y,fe[Ie+2]=Je.z||0,fe[Ie+3]=Je.r,fe[Ie+4]=Je.g,fe[Ie+5]=Je.b,fe[Ie+6]=Je.blanking?1:0,fe[Ie+7]=Je.lastPoint?1:0}fe[Ie+7]=0}if(me+=je,Ne<ae.length-1){const Oe=ae[Ne+1],Ie=Oe.points instanceof Float32Array||Oe.isTypedArray,Je=fe[(me-1)*8],rt=fe[(me-1)*8+1];let Ke,st;Ie?(Ke=Oe.points[0],st=Oe.points[1]):(Ke=Oe.points[0].x,st=Oe.points[0].y);let Tt=me*8;fe[Tt]=Je,fe[Tt+1]=rt,fe[Tt+6]=1,fe[Tt+3]=0,fe[Tt+4]=0,fe[Tt+5]=0;let yt=(me+1)*8;fe[yt]=Ke,fe[yt+1]=st,fe[yt+6]=1,fe[yt+3]=0,fe[yt+4]=0,fe[yt+5]=0,me+=2}}),fe[(xe-1)*8+7]=1,{points:fe,isTypedArray:!0}},ie=ae=>{if(!_a.current){cancelAnimationFrame(R);return}if(ae-E>j){if(window.electronAPI&&_a.current){const xe=new Map;jn.current.forEach(me=>{if(me&&_.current[me.workerId]){const ke=ei.current[me.layerIndex]||[],Ne=me.assignedDacs||[];let Te=[...ke,...Ne];Te.length===0&&qt.current&&(Te=[qt.current]);const je=[],Oe=new Set;if(Te.forEach(bt=>{const Ja=bt.channel!==void 0?bt.channel:bt.channels&&bt.channels.length>0?bt.channels[0].serviceID:0,da=`${bt.ip}:${Ja}`;Oe.has(da)||(Oe.add(da),je.push({...bt,channel:Ja}))}),je.length===0)return;const Je=(Ve.current||Ge.current)[me.layerIndex][Oa.current[me.layerIndex]],rt=Je?Je.effects||[]:me.effects||[],Ke=me.layerIndex,st=Ln.current[Ke]||[],Tt=[...rt,...st],yt=_.current[me.workerId],Ur=en.current[me.layerIndex],Dn=Kr.current,nn=ea.current[me.layerIndex],Xt=ta.current[me.layerIndex],Nt=ta.current.some(bt=>bt);let xn=Ur;Dn?xn=0:Nt?Xt?nn&&(xn=0):xn=0:nn&&(xn=0);const Zt=xn*Jn.current;if(Zt<=0)return;const vt=I.current[me.workerId]||0;me.syncSettings;const zt={...yt,points:ce(yt.points)?yt.points:yt.points.map(bt=>({...bt,r:Math.round(bt.r*Zt),g:Math.round(bt.g*Zt),b:Math.round(bt.b*Zt)}))};if(ce(zt.points)){const bt=zt.points,Ja=bt.length/8,da=new Float32Array(bt);for(let La=0;La<Ja;La++)da[La*8+3]*=Zt,da[La*8+4]*=Zt,da[La*8+5]*=Zt;zt.points=da}const un=Je?Je.playbackSettings:me.playbackSettings||{};let Ka=1;if(un.mode==="timeline")Ka=un.duration||1;else if(un.mode==="bpm"){const bt=Yn.current||120;Ka=(un.beats||8)*60/bt}else{const bt=un.fps||me.fps||fr.current||30;Ka=(me.totalFrames||30)/bt}const Br=un.speedMultiplier||1;Br!==0&&(Ka/=Br);const Sn=uo(zt,Tt,{progress:vt,time:ae,effectStates:U.current,assignedDacs:je,syncSettings:me.syncSettings||{},bpm:Yn.current,clipDuration:Ka,fftLevels:l?l():s});if(Mr.current){const bt=od(Sn.points);Sn.points=bt,Sn.isTypedArray=!0}je.forEach((bt,Ja)=>{const da=bt.ip,La=bt.channel||(bt.channels&&bt.channels.length>0?bt.channels[0].serviceID:0);if(La!==void 0){const qn=`${da}:${La}`;xe.has(qn)||xe.set(qn,{ip:da,channel:La,type:bt.type,frames:[]});let ja=Sn;if(Sn.points&&Sn.points._channelDistributions){const er=Sn.points._channelDistributions.get(Ja);if(er){const Ts=Sn.points.subarray(er.start,er.start+er.length);ja={...Sn,points:Ts}}else ja={...Sn,points:new Float32Array(0)}}if(bt.mirrorX||bt.mirrorY){const er=ja.points,Ts=ja.isTypedArray,wo=Ts?er.length/8:er.length,tr=Ts?new Float32Array(er):er.map(aa=>({...aa}));for(let aa=0;aa<wo;aa++)Ts?(bt.mirrorX&&(tr[aa*8]=-tr[aa*8]),bt.mirrorY&&(tr[aa*8+1]=-tr[aa*8+1])):(bt.mirrorX&&(tr[aa].x=-tr[aa].x),bt.mirrorY&&(tr[aa].y=-tr[aa].y));ja={...ja,points:tr}}xe.get(qn).frames.push(ja)}})}}),ki.current.forEach(me=>{(me.channels&&me.channels.length>0?me.channels.map(Ne=>Ne.serviceID):[0]).forEach(Ne=>{const Te=`${me.ip}:${Ne}`,je=ga.current?ga.current[Te]:dr.current[Te];if(je){xe.has(Te)||xe.set(Te,{ip:me.ip,channel:Ne,type:me.type,frames:[]});const Oe=xe.get(Te);if(je.testLineEnabled){const Ie=_r(je.testLineY!==void 0?je.testLineY:.5);Oe.frames=[Ie]}}})});let fe=0;xe.forEach(me=>{let ke=q(me.frames);const Ne=`${me.ip}:${me.channel}`,Te=ga.current?ga.current[Ne]:dr.current[Ne];if(ke&&Te){if(Te.dimmer!==void 0&&Te.dimmer<1){const je=Te.dimmer,Oe=ke.points,Ie=ke.isTypedArray,Je=Ie?Oe.length/8:Oe.length;for(let rt=0;rt<Je;rt++)Ie?(Oe[rt*8+3]*=je,Oe[rt*8+4]*=je,Oe[rt*8+5]*=je):(Oe[rt].r*=je,Oe[rt].g*=je,Oe[rt].b*=je)}ke=Xf(ke,Te,!1)}if(ke){fe++;const je=ce(ke.points)?ke.points.length/8:ke.points.length;Tn.current+=je,window.electronAPI.sendFrame(me.ip,me.channel,ke.points,N,me.type,{skipOptimization:!Mr.current})}}),mt.current=fe}E=ae}R=requestAnimationFrame(ie)};function ce(ae){return!!ae&&(ae instanceof Float32Array||ae.buffer instanceof ArrayBuffer)}const de=ae=>{const xe=1e3/fr.current,fe=Yn.current||120,me=(Ne,Te,je,Oe)=>{Y.current[Oe]||(Y.current[Oe]=ae);let Ie=ae-Y.current[Oe];Ie>1e3&&(Ie=xe),Rn.current&&(Nr.current[Oe]===void 0&&(Nr.current[Oe]=0),Nr.current[Oe]+=Ie);const Je=Nr.current[Oe]||0,rt=Oa.current[Te]!==null?Js.current(Te):null;let Ke=te.current[Oe]||0,st=0;const Tt=Ne.totalFrames||1,yt=Ne.playbackSettings||{mode:"fps",duration:Tt/60,beats:8,speedMultiplier:1};if(rt&&Rn.current&&!rt.paused)st=rt.duration>0?rt.currentTime/rt.duration:0,Ke=Math.floor(st*Tt);else if(yt.mode==="timeline"){const Xt=yt.duration*1e3/(yt.speedMultiplier||1);Xt>0&&(st=Je/Xt%1,Ke=Math.floor(st*Tt))}else if(yt.mode==="bpm"){const Xt=6e4/fe,Nt=yt.beats*Xt/(yt.speedMultiplier||1);Nt>0&&(st=Je/Nt%1,Ke=Math.floor(st*Tt))}else{const Nt=1e3/((yt.fps||60)*(yt.speedMultiplier||1));if(Ie>=Nt){const xn=Math.floor(Ie/Nt);Rn.current?(Y.current[Oe]=ae-Ie%Nt,Ke=Ke+xn):Y.current[Oe]=ae,st=Tt>0?Ke%Tt/Tt:0}else return}yt.mode!=="fps"&&(Y.current[Oe]=ae),isNaN(Ke)&&(Ke=0),isNaN(st)&&(st=0);const Dn=(ti.current[Oe]||0)>.9&&st<.1;if(ti.current[Oe]=st,I.current[Oe]=st,Tt>0&&(Ke=Ke%Tt,Ke<0&&(Ke+=Tt)),Dn&&Rn.current){const Xt=Kn.current[Te];if(Xt&&Xt!=="off"){const Nt=Ge.current[Te],xn=Oa.current[Te];let Zt=-1;if(Xt==="forward")for(let vt=1;vt<Nt.length;vt++){const zt=(xn+vt)%Nt.length,un=Nt[zt];if(un&&(un.type==="ilda"||un.type==="generator")){Zt=zt;break}}else if(Xt==="random"){const vt=Nt.map((zt,un)=>zt&&(zt.type==="ilda"||zt.type==="generator")?un:-1).filter(zt=>zt!==-1);if(vt.length>0){const zt=Math.floor(Math.random()*vt.length);Zt=vt[zt],Zt===xn&&vt.length>1&&(Zt=vt[(zt+1)%vt.length])}}Zt!==-1&&Zt!==xn&&setTimeout(()=>{wa(Te,Zt)},0)}}let nn=1;if(yt.mode==="timeline"?nn=yt.duration||1:yt.mode==="bpm"?nn=(yt.beats||8)*60/fe:Ne.type==="generator"&&(!Ne.frames||Ne.frames.length<=1)?nn=yt.duration||1:nn=Tt/(yt.fps||60),Ne.type==="generator"){const Xt=Ne.syncSettings||{},Nt=Ne.generatorDefinition?.id,xn=Ne.generatorDefinition,Zt=Object.keys(Xt).filter(vt=>vt.startsWith(`${Nt}.`));if(Zt.length>0){const vt=Ne.currentParams||{},zt={...vt};let un=!1;const Ka={time:ae,progress:st,bpm:fe,clipDuration:nn,fftLevels:l?l():s,activationTime:P.current[Te]||0};for(const Br of Zt){const Sn=Br.split(".")[1],bt=xn?.paramControls?.find(La=>La.id===Sn),Ja=vt[Sn]!==void 0?vt[Sn]:Ne.generatorDefinition.defaultParams[Sn],da=Nc(Sn,Ja,Xt[Br],Ka,bt?.min,bt?.max);da!==zt[Sn]&&(zt[Sn]=da,un=!0)}if(un){const Br=++Ia.current;fa(Te,je,Ne.generatorDefinition,zt,Br,!0)}}if(Nt==="waveform"){const vt=Ne.currentParams||{},zt=vt.mode==="waveform"?u.current:o.current,un=++Ia.current,Ka={time:ae,activationTime:P.current[Te]||0};fa(Te,je,Ne.generatorDefinition,vt,un,!1,!0,zt,Ka)}else if(Nt==="timer"){const vt=Ne.currentParams||{},zt=++Ia.current,un={time:ae,activationTime:P.current[Te]||0};fa(Te,je,Ne.generatorDefinition,vt,zt,!1,!0,null,un)}}(te.current[Oe]!==Ke||!_.current[Oe])&&(te.current[Oe]=Ke,Ne.type==="ilda"?n.postMessage({type:"get-frame",workerId:Oe,frameIndex:Ke}):Ne.type==="generator"&&(Ne.frames&&Ne.frames.length>1?Ne.frames[Ke%Ne.frames.length]&&(_.current[Oe]=Ne.frames[Ke%Ne.frames.length]):!_.current[Oe]&&Ne.frames&&Ne.frames.length>0&&(_.current[Oe]=Ne.frames[0])))};Lt.forEach((Ne,Te)=>{const je=Oa.current[Te];if(je===null)return;const Ie=(Ve.current||Ge.current)[Te][je];if(!Ie)return;let Je=Ie.type==="ilda"?Ie.workerId:Ie.type==="generator"?`generator-${Te}-${je}`:null;Je&&me(Ie,Te,je,Je)});const ke=Wa.current;if(ke&&!jn.current.some(Ne=>Ne.workerId===ke)){const Ne=$a.current,Te=hn.current;if(Ne!==null&&Te!==null){const Oe=(Ve.current||Ge.current)[Ne][Te];Oe&&me(Oe,Ne,Te,ke)}}if(hr.current){const{layerIndex:Ne,colIndex:Te}=hr.current,je=Oa.current[Ne]===Te;$a.current===Ne&&hn.current;const Oe=Wa.current;if(!je){const Je=(Ve.current||Ge.current)[Ne]?.[Te];if(Je){let rt=Je.type==="ilda"?Je.workerId:Je.type==="generator"?`generator-${Ne}-${Te}`:null;rt&&rt!==Oe&&me(Je,Ne,Te,rt)}}}w=requestAnimationFrame(de)};return w=requestAnimationFrame(de),Qn?R=requestAnimationFrame(ie):cancelAnimationFrame(R),()=>{n.removeEventListener("message",x),cancelAnimationFrame(w),cancelAnimationFrame(R)}},[n,Qn]),T.useEffect(()=>{let x,w,R;return window.electronAPI&&(x=window.electronAPI.onClipContextMenuCommand((E,N,j)=>{if(console.log(`Clip context menu command received: ${E} for ${N}-${j}`),E==="export-ilda"){const q=Ge.current[N][j];console.log("Exporting clip:",q),q&&(q.type==="ilda"&&q.workerId&&n?(tn("Preparing ILDA export..."),console.log("Requesting frames from worker:",q.workerId),n.postMessage({type:"get-all-frames",workerId:q.workerId,layerIndex:N,colIndex:j})):q.type==="generator"?(console.log("Exporting generator frames with parameter animation..."),(async()=>{const{framesToIlda:ce}=await I0(async()=>{const{framesToIlda:Ie}=await Promise.resolve().then(()=>X0);return{framesToIlda:Ie}},void 0,import.meta.url),de=Ut||60;let ae=2;const xe=q.playbackSettings||{};xe.mode==="timeline"?ae=xe.duration||2:xe.mode==="bpm"?ae=(xe.beats||8)*60/(Pe.bpm||120):q.frames?.length>1&&(ae=q.frames.length/de);const fe=Math.ceil(ae*de),me=[],ke=new Map,Ne=q.generatorDefinition?.id;let Te=null;if(["text","spout-receiver"].includes(Ne)){const Ie=q.currentParams?.fontUrl||"src/fonts/Geometr415 Blk BT Black.ttf";try{Ie.startsWith("http")?Te=await window.electronAPI.fetchUrlAsArrayBuffer(Ie):Te=await window.electronAPI.readFileForWorker(Ie)}catch(Je){console.error("Failed to load font for export:",Je)}}for(let Ie=0;Ie<fe;Ie++){const Je=Ie*(1e3/de),rt=Ie/fe,Ke=q.syncSettings||{},st=q.generatorDefinition,Tt=q.currentParams||{},yt={...Tt},Ur={time:Je,progress:rt,bpm:Pe.bpm,clipDuration:ae,fftLevels:{low:0,mid:0,high:0},activationTime:0};for(const nn in Ke)if(nn.startsWith(`${Ne}.`)){const Xt=nn.split(".")[1],Nt=st?.paramControls?.find(Zt=>Zt.id===Xt),xn=Tt[Xt]!==void 0?Tt[Xt]:st.defaultParams[Xt];yt[Xt]=Nc(Xt,xn,Ke[nn],Ur,Nt?.min,Nt?.max)}let Dn=null;try{if(Ne==="circle")Dn=Im(yt);else if(Ne==="square")Dn=Lm(yt);else if(Ne==="line")Dn=jm(yt);else if(Ne==="star")Dn=Um(yt);else if(Ne==="text")Dn=await Om(yt,Te);else if(Ne==="spout-receiver")Dn=await Om({...yt,text:yt.sourceName},Te);else if(q.frames){const nn=Math.floor(rt*q.frames.length)%q.frames.length;Dn=q.frames[nn]}}catch(nn){console.error("Generation failed during export:",nn)}if(Dn){const nn=(q.effects||[]).filter(vt=>!((vt.id==="delay"||vt.id==="chase")&&vt.params?.mode==="channel")),Xt=uo(Dn,nn,{time:Je,progress:rt,effectStates:ke,syncSettings:q.syncSettings||{},bpm:Pe.bpm,clipDuration:ae,assignedDacs:q.assignedDacs||[]}),Nt=Xt.points,xn=Nt.length/8,Zt=[];for(let vt=0;vt<xn;vt++)Zt.push({x:Nt[vt*8],y:Nt[vt*8+1],z:Nt[vt*8+2],r:Nt[vt*8+3],g:Nt[vt*8+4],b:Nt[vt*8+5],blanking:Nt[vt*8+6]>.5,lastPoint:Nt[vt*8+7]>.5});me.push({...Xt,points:Zt,frameName:`Frame ${Ie}`,companyName:"TrueLazer"})}}const je=ce(me),Oe=`${q.generatorDefinition?.name||"generator"}_export.ild`;if(window.electronAPI&&window.electronAPI.saveIldaFile){const Ie=await window.electronAPI.saveIldaFile(je,Oe);Ie.success?tn(`Exported to ${Ie.filePath}`):Ie.error&&tn(`Export failed: ${Ie.error}`)}})().catch(ce=>console.error("Failed to export generator:",ce))):(console.warn("Clip type not supported for export or missing data:",q.type,q),q.type==="ilda"&&!q.workerId?tn("Clip data not loaded. Please play the clip to load it."):q.type==="generator"&&!q.frames&&tn("Generator not rendered yet.")))}else if(E==="update-thumbnail"){const q=et[N][j];if(q){if(q.type==="ilda"&&q.workerId&&n){const ie=te.current[q.workerId]||0;n.postMessage({type:"get-frame",workerId:q.workerId,frameIndex:ie,isStillFrame:!0,layerIndex:N,colIndex:j})}else if(q.type==="generator"&&q.generatorDefinition){const ie=te.current[`generator-${N}-${j}`]||0,ce=q.frames?.[ie%q.frames.length];if(ce){const de=q.effects||[];Yf(ce,de,N,j,ca).then(ae=>{we({type:"SET_CLIP_CONTENT",payload:{layerIndex:N,colIndex:j,content:{stillFrame:ce,thumbnailPath:ae,thumbnailVersion:Date.now()}}})})}}}}else if(E==="clear-clip")we({type:"CLEAR_CLIP",payload:{layerIndex:N,colIndex:j}});else if(E==="rename-clip"){const q=va.current[N][j];wt({title:"Rename Clip",initialValue:q,onSave:ie=>we({type:"SET_CLIP_NAME",payload:{layerIndex:N,colIndex:j,name:ie}})}),Le(!0)}else if(E==="copy-clip"){const q={content:Ge.current[N][j],name:va.current[N][j]};we({type:"SET_CLIPBOARD",payload:q}),tn("Clip copied.")}else if(E==="cut-clip"){const q={content:Ge.current[N][j],name:va.current[N][j]};we({type:"SET_CLIPBOARD",payload:q}),we({type:"CLEAR_CLIP",payload:{layerIndex:N,colIndex:j}}),tn("Clip cut.")}else if(E==="paste-clip")if(Pe.clipClipboard){const{content:q,name:ie}=Pe.clipClipboard;let ce=JSON.parse(JSON.stringify(q));if(ce.type==="ilda"&&(ce.workerId=null),ce.effects&&ce.effects.length>0){const ae={...ce.syncSettings||{}};ce.effects=ce.effects.map(xe=>{const fe=xe.instanceId,me=oo();return Object.keys(ae).forEach(ke=>{if(fe&&ke.startsWith(`${fe}.`)){const Ne=ke.substring(fe.length);ae[`${me}${Ne}`]=ae[ke],delete ae[ke]}}),{...xe,instanceId:me}}),ce.syncSettings=ae}we({type:"SET_CLIP_CONTENT",payload:{layerIndex:N,colIndex:j,content:ce}}),we({type:"SET_CLIP_NAME",payload:{layerIndex:N,colIndex:j,name:ie}}),tn("Clip pasted."),setTimeout(()=>{const de=ce;if(de.type==="generator"&&de.generatorDefinition){const ae=`${N}-${j}`,xe={...de.generatorDefinition.defaultParams,...de.currentParams};ba.current.set(ae,JSON.stringify(xe));const fe=++Ia.current;fa(N,j,de.generatorDefinition,de.currentParams,fe)}},100)}else tn("Clipboard is empty.");else E==="set-trigger-style-normal"?we({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:N,colIndex:j,style:"normal"}}):E==="set-trigger-style-toggle"?we({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:N,colIndex:j,style:"toggle"}}):E==="set-trigger-style-flash"&&we({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:N,colIndex:j,style:"flash"}})}),w=window.electronAPI.onLayerFullContextMenuCommand((E,N)=>{if(console.log(`Layer context menu command received: ${E} for ${N}`),E==="layer-rename"){const j=Lt[N];wt({title:"Rename Layer",initialValue:j,onSave:q=>we({type:"SET_LAYER_NAME",payload:{index:N,name:q}})}),Le(!0)}else E==="layer-clear-clips"&&we({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:N}})}),R=window.electronAPI.onContextMenuActionFromMain(E=>{if(console.log("General context menu action received:",E),E.type==="rename-column"){const N=It[E.index];wt({title:"Rename Column",initialValue:N,onSave:j=>we({type:"SET_COLUMN_NAME",payload:{index:E.index,name:j}})}),Le(!0)}else if(E.type==="rename-layer"){const N=Lt[E.index];wt({title:"Rename Layer",initialValue:N,onSave:j=>we({type:"SET_LAYER_NAME",payload:{index:E.index,name:j}})}),Le(!0)}else if(E.type==="reset-quick-assign"){const N=E.controlType==="knob"?0:!1;we({type:"UPDATE_QUICK_CONTROL",payload:{type:E.controlType,index:E.index,value:N}})}else E.type==="clear-quick-assign"&&we({type:"CLEAR_QUICK_CONTROL",payload:{type:E.controlType,index:E.index}})})),()=>{x&&x(),w&&w(),R&&R()}},[et,$r,Lt,It,n,a,Pe.clipClipboard]);const ai=T.useRef(la);T.useEffect(()=>{for(let x=0;x<Lt.length;x++)for(let w=0;w<It.length;w++){const R=la[x][w],E=ai.current[x][w],N=et[x][w],j=N?.workerId,q=kr.current.get(`${x}-${w}`),ie=R!==E;(ie||j&&!q)&&N&&N.type==="ilda"&&j&&(console.log(`[App.jsx] Fetching still frame for ${x}-${w} at index ${R}. Reason: ${ie?"index change":"worker ready"}`),n.postMessage({type:"get-frame",workerId:j,frameIndex:R,isStillFrame:!0,layerIndex:x,colIndex:w})),j?kr.current.set(`${x}-${w}`,j):kr.current.delete(`${x}-${w}`)}ai.current=la},[la,et,Lt.length,It.length,n]),T.useEffect(()=>{a&&et.forEach((x,w)=>{x.forEach((R,E)=>{if(R&&R.type==="generator"&&R.generatorDefinition){if(R.generatorDefinition.id==="ndi-source")return;const N=`${w}-${E}`,j={...R.generatorDefinition.defaultParams,...R.currentParams||{}},q=JSON.stringify(j);if(ba.current.get(N)!==q){console.log(`[App.jsx] Generator ${N} params changed, regenerating...`);const ie=++Ia.current;fa(w,E,R.generatorDefinition,R.currentParams,ie),ba.current.set(N,q)}}})})},[et,a]),T.useEffect(()=>{if(!Pe.projectLoadTimestamp||!n||!a)return;console.log("Project loaded, regenerating content...");const x=[];et.forEach((w,R)=>{w.forEach((E,N)=>{if(E){if(E.type==="ilda"&&E.filePath&&!E.workerId)console.log(`Reparsing ILDA file for clip ${R}-${N}: ${E.filePath}`),n.postMessage({type:"load-and-parse-ilda",fileName:E.fileName,filePath:E.filePath,layerIndex:R,colIndex:N});else if(E.type==="generator"&&E.generatorDefinition){console.log(`Regenerating generator clip ${R}-${N} on project load`);const j=++Ia.current;fa(R,N,E.generatorDefinition,E.currentParams,j)}E.audioFile&&E.audioFile.path&&window.electronAPI&&window.electronAPI.checkFileExists&&x.push(window.electronAPI.checkFileExists(E.audioFile.path).then(j=>{j||at(q=>{const ie=`audio-${R}-${N}`;return q.some(ce=>ce.requestId===ie)?q:[...q,{filePath:E.audioFile.path,fileName:E.audioFile.name||E.audioFile.path.split(/[/\\]/).pop(),requestId:ie,type:"audio"}]})}))}})})},[Pe.projectLoadTimestamp,n,a]),T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onUpdateThumbnailRenderMode){const x=window.electronAPI.onUpdateThumbnailRenderMode(w=>{console.log("App.jsx: Received thumbnail mode update:",w),we({type:"SET_THUMBNAIL_RENDER_MODE",payload:w})});return()=>x()}},[]);const xa=T.useRef(Pe);T.useEffect(()=>{xa.current=Pe},[Pe]),T.useEffect(()=>{let x,w,R,E,N;return window.electronAPI&&(x=window.electronAPI.on("new-project",()=>we({type:"RESET_STATE"})),w=window.electronAPI.on("open-project",()=>{}),R=window.electronAPI.on("save-project",()=>{console.log("Saving project with state:",xa.current),window.electronAPI.send("save-project",xa.current)}),E=window.electronAPI.on("save-project-as",()=>{console.log("Saving project AS with state:",xa.current),window.electronAPI.send("save-project-as",xa.current)}),N=window.electronAPI.on("load-project-data",j=>{we({type:"LOAD_PROJECT",payload:j})})),()=>{x&&x(),w&&w(),R&&R(),E&&E(),N&&N()}},[]),T.useEffect(()=>{let x,w;return(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const E=await window.electronAPI.getAllSettings();E&&(E.shortcutsState&&Se(E.shortcutsState),we({type:"LOAD_SETTINGS",payload:E}))}})(),window.electronAPI&&(x=window.electronAPI.onMenuAction(E=>{if(console.log("Menu action received:",E),E==="output-settings")Ue(!0);else if(E==="shapeBuilder")V("shapeBuilder"),we({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(E==="timeline")V("timeline"),we({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(E==="about")se(!0);else if(E==="settings-audio-output")it(!0);else if(E==="settings-audio-fft")qe(!0);else if(E.startsWith("set-theme-")){const N=E.split("set-theme-")[1];we({type:"SET_THEME",payload:N})}else if(E==="shortcuts-window"||E.startsWith("open-")&&E.endsWith("-settings"))Z(!0);else if(E==="column-duplicate")ct!==null&&(we({type:"DUPLICATE_COLUMN",payload:{index:ct}}),tn("Column duplicated."));else if(E==="column-clear-clips")ct!==null&&Lt.forEach((N,j)=>{we({type:"CLEAR_CLIP",payload:{layerIndex:j,colIndex:ct}})});else if(E.startsWith("toggle-")){const N=E.split("-");if(N.length===3){const j=N[1],q=N[2]==="true";Se(ie=>({...ie,[j]:q}))}}}),w=window.electronAPI.onRenderSettingsCommand(E=>{console.log("Render settings command received:",E),we({type:"SET_RENDER_SETTING",payload:{setting:E.setting,value:E.value}})})),()=>{x&&x(),w&&w()}},[]),T.useEffect(()=>{if(!n)return;const x=async w=>{if(w.data.type==="request-file-content"){const{filePath:R,requestId:E,maxBytes:N}=w.data;try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(R))throw new Error(`File not found: ${R}`);const j=await window.electronAPI.readFileForWorker(R,N);n.postMessage({type:"file-content-response",requestId:E,arrayBuffer:j},[j])}catch(j){console.warn(`File missing or read error: ${R}`,j.message);const q=R.split(/[/\\]/).pop();at(ie=>ie.some(ce=>ce.requestId===E)?ie:[...ie,{filePath:R,fileName:q,requestId:E}])}}else if(w.data.type==="parsing-status"){const{layerIndex:R,colIndex:E,status:N}=w.data;R!==void 0&&E!==void 0&&(we({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:R,colIndex:E,status:N}}),N||we({type:"SET_CLIP_PARSING_FAILED",payload:{layerIndex:R,colIndex:E,failed:!0}}))}};return n.addEventListener("message",x),()=>{n.removeEventListener("message",x)}},[n]),T.useEffect(()=>{if(!e)return;const x=async w=>{if(w.data.type==="request-file-content"){const{filePath:R,requestId:E,maxBytes:N}=w.data;try{const j=await window.electronAPI.readFileForWorker(R,N);e.postMessage({type:"file-content-response",requestId:E,arrayBuffer:j},[j])}catch(j){console.error(`Thumbnail Worker: Error reading file: ${R}`,j),e.postMessage({type:"file-content-response",requestId:E,error:j.message})}}};return e.addEventListener("message",x),()=>{e.removeEventListener("message",x)}},[e]),T.useEffect(()=>{if(!n)return;const x=[];et.forEach((w,R)=>{w.forEach((E,N)=>{E&&E.type==="ilda"&&E.filePath&&!E.workerId&&!E.parsing&&!E.parsingFailed&&x.push({layerIndex:R,colIndex:N,fileName:E.fileName,filePath:E.filePath})})}),x.length>0&&(console.log(`Triggering re-parse for ${x.length} clips.`),we({type:"SET_BULK_PARSING_STATUS",payload:x.map(w=>({layerIndex:w.layerIndex,colIndex:w.colIndex,status:!0}))}),x.forEach(w=>{n.postMessage({type:"load-and-parse-ilda",fileName:w.fileName,filePath:w.filePath,layerIndex:w.layerIndex,colIndex:w.colIndex})}))},[et,n]);const Sa=Ve.current||et;if($e!==null){const x=qa[$e]||[];if(ct!==null)[...Sa[$e][ct]?.effects||[],...x];else{const w=Jt[$e];w!==null&&[...Sa[$e][w]?.effects||[],...x]}}const xs=T.useCallback((x,w,R,E,N)=>{if(Ve.current&&Ve.current[x]&&Ve.current[x][w]){const j=Ve.current[x][w];j&&j.effects&&j.effects[R]&&(j.effects[R].params[E]=N,Nn.current=!0)}Ot(`effect-${x}-${w}-${R}-${E}`,{type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:x,colIndex:w,effectIndex:R,paramName:E,newValue:N}})},[Ot]);T.useEffect(()=>{if(!a)return;const x=w=>{if(!w.data.browserFile){if(w.data.layerIndex!==void 0&&w.data.colIndex!==void 0){const R=`${w.data.layerIndex}-${w.data.colIndex}`;if(Rr.current.set(R,!1),Dr.current.has(R)){const{message:E,transferables:N}=Dr.current.get(R);Dr.current.delete(R),Rr.current.set(R,!0),a.postMessage(E,N)}}if(w.data.success){const{layerIndex:R,colIndex:E,frames:N,generatorDefinition:j,currentParams:q,isLive:ie,isAutoUpdate:ce,seq:de}=w.data;if(R===void 0||E===void 0)return;if(de!==void 0){const xe=`${R}-${E}`,fe=es.current.get(xe)||0;if(de<fe)return;es.current.set(xe,de)}const ae=`generator-${R}-${E}`;if(_.current[ae]=N[0],!ie&&!ce&&de===Ia.current){const xe=Ge.current[R][E]||{},fe={...xe,type:"generator",generatorDefinition:j,frames:N,stillFrame:N[0],currentParams:q,playbackSettings:xe.playbackSettings||{mode:"fps",duration:N.length/60,beats:8,speedMultiplier:1}};we({type:"SET_CLIP_CONTENT",payload:{layerIndex:R,colIndex:E,content:fe}});const me=va.current[R][E],ke=`Clip ${R+1}-${E+1}`;me===ke&&we({type:"SET_CLIP_NAME",payload:{layerIndex:R,colIndex:E,name:j.name}})}else w.data.isNdi&&window.electronAPI&&window.electronAPI.ndiRendererReady&&window.electronAPI.ndiRendererReady()}else tn(`Error generating frames: ${w.data.error}`)}};return a.addEventListener("message",x),()=>{a.removeEventListener("message",x)}},[a]);const ts=T.useCallback((x,w,R)=>{if(a){const E=`${x}-${w}`,N={...R.defaultParams};ba.current.set(E,JSON.stringify(N));const j=++Ia.current;fa(x,w,R,R.defaultParams,j)}},[a]),ua=(x,w)=>{try{switch(x){case"circle":return Im(w);case"square":return Lm(w);case"line":return jm(w);case"star":return Um(w);case"sinewave":return Sw(w);default:return null}}catch(R){return console.error(`Error in synchronous live generation for ${x}:`,R),null}},fa=async(x,w,R,E,N,j=!1,q=!1,ie=null,ce=null)=>{const de={...R.defaultParams,...E},ae=`${x}-${w}`;let xe=null,fe=null;if(["text","ndi-source","spout-receiver","timer"].includes(R.id)){const Ne="src/fonts/Geometr415 Blk BT Black.ttf";if(fe=de.fontUrl||Ne,["https://raw.githubusercontent.com/google/fonts/main/ofl/roboto/Roboto-Regular.ttf","https://raw.githubusercontent.com/googlefonts/roboto-2/main/src/hinted/Roboto-Regular.ttf"].includes(fe)&&(fe=Ne),pr.current.has(fe))xe=pr.current.get(fe);else try{if(fe.startsWith("http"))if(window.electronAPI&&window.electronAPI.fetchUrlAsArrayBuffer)xe=await window.electronAPI.fetchUrlAsArrayBuffer(fe);else throw new Error("URL fetching API is not available.");else if(window.electronAPI&&window.electronAPI.readFileForWorker)xe=await window.electronAPI.readFileForWorker(fe);else throw new Error("File reading API is not available.");xe&&pr.current.set(fe,xe)}catch(je){console.error(`Failed to load font for text generator at ${x}-${w}:`,je),tn(`Font error: ${je.message}`);return}}const me={type:"generate",layerIndex:x,colIndex:w,generator:R,params:de,fontBuffer:fe&&!oe.current.has(fe)?xe:null,audioData:ie,context:ce,seq:N,isAutoUpdate:j,isLive:q};fe&&xe&&oe.current.add(fe);const ke=[];Rr.current.get(ae)?Dr.current.set(ae,{message:me,transferables:ke}):(Rr.current.set(ae,!0),a&&a.postMessage(me,ke))},na=T.useCallback(x=>{A(x),we({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:x}})},[A]),Or=T.useCallback(()=>{L(),we({type:"CLEAR_ALL_ACTIVE_CLIPS"})},[L]),Za=T.useCallback(()=>{b(),Lt.forEach((x,w)=>{const R=Jt[w];if(R!==null){const E=et[w][R];E&&E.audioFile&&!B(w)&&v(w,E.audioFile.path,E.audioVolume??1,!0)}}),we({type:"SET_IS_PLAYING",payload:!0}),we({type:"SET_IS_STOPPED",payload:!1})},[b,Lt,Jt,et,B,v]),Qa=T.useCallback(()=>{S(),we({type:"SET_IS_PLAYING",payload:!1}),we({type:"SET_IS_STOPPED",payload:!1})},[S]),Ir=T.useCallback(()=>{D(),S(),we({type:"SET_IS_PLAYING",payload:!1}),we({type:"SET_IS_STOPPED",payload:!0}),te.current={}},[D,S]),cn=T.useCallback(()=>{const x=!Qn;we({type:"SET_WORLD_OUTPUT_ACTIVE",payload:x}),window.electronAPI&&(x?Pe.dacs.forEach(w=>{window.electronAPI.startDacOutput(w.ip,w.type)}):Pe.dacs.forEach(w=>{window.electronAPI.stopDacOutput(w.ip,w.type)}))},[Qn,Pe.dacs]),Vn=T.useCallback((x,w)=>{we({type:"SET_SELECTED_CLIP",payload:{layerIndex:x,colIndex:w}});const R=et[x][w];if(R&&R.type==="ilda")we({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:R.workerId,totalFrames:R.totalFrames,generatorId:null,generatorParams:{}}});else if(R&&R.type==="generator"){const E=`generator-${x}-${w}`;we({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:E,generatorId:R.generatorDefinition.id,generatorParams:R.currentParams,totalFrames:R.frames.length}})}else we({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:null,totalFrames:0,generatorId:null,generatorParams:{}}})},[et]),Ss=T.useCallback((x,w,R)=>{R?hr.current={layerIndex:x,colIndex:w}:hr.current&&hr.current.layerIndex===x&&hr.current.colIndex===w&&(hr.current=null)},[]),wa=T.useCallback((x,w,R=!0)=>{const E=et[x][w];if(!E){R&&(Vn(x,w),na(x));return}const N=E.triggerStyle||"normal",j=Jt[x];if(N==="normal"){if(!R)return}else if(N==="toggle"){if(!R)return;if(j===w){na(x);return}}else if(N==="flash"&&!R){j===w&&na(x);return}if(E&&E.type==="generator"&&E.frames&&E.frames.length>0){const q=`generator-${x}-${w}`;_.current[q]=E.frames[0],Y.current[q]=performance.now(),te.current[q]=0}else E&&E.type==="ilda"&&E.workerId&&(Y.current[E.workerId]=performance.now(),te.current[E.workerId]=0);if(E&&E.audioFile?v(x,E.audioFile.path,E.audioVolume??1,Rn.current).catch(q=>{console.warn(`Failed to play audio for clip ${x}-${w}:`,q),at(ie=>{const ce=`audio-${x}-${w}`;return ie.some(de=>de.requestId===ce)?ie:[...ie,{filePath:E.audioFile.path,fileName:E.audioFile.name||E.audioFile.path.split(/[/\\]/).pop(),requestId:ce,type:"audio"}]})}):A(x),P.current[x]=performance.now(),we({type:"SET_ACTIVE_CLIP",payload:{layerIndex:x,colIndex:w}}),E){if(E.type==="ilda"&&E.workerId){const q=te.current[E.workerId]||0;we({type:"UPDATE_THUMBNAIL",payload:{layerIndex:x,colIndex:w,frameIndex:q}})}else if(E.type==="generator"&&E.frames){const q=te.current[`generator-${x}-${w}`]||0,ie=E.frames[q%E.frames.length];ie&&we({type:"SET_CLIP_CONTENT",payload:{layerIndex:x,colIndex:w,content:{stillFrame:ie}}})}}},[et,Jt,na,v,Hn,A,Vn]),Ri=T.useCallback((x,w,R)=>{if(Ve.current&&Ve.current[x]&&Ve.current[x][w]){const E=Ve.current[x][w];if(E){const N={...R,instanceId:oo(),params:{...R.defaultParams}};E.effects=[...E.effects||[],N],Nn.current=!0}}we({type:"ADD_CLIP_EFFECT",payload:{layerIndex:x,colIndex:w,effect:R}})},[]),bn=T.useCallback((x,w)=>{const R=dl.find(E=>(E.id||E.name)===w);R&&we({type:"ADD_LAYER_EFFECT",payload:{layerIndex:x,effect:R}})},[]),ws=T.useCallback((x,w,R)=>{Nn.current=!0,R.isGroup?we({type:"SET_CLIP_DAC_GROUP",payload:{layerIndex:x,colIndex:w,groupDacs:R.channels}}):we({type:"SET_CLIP_DAC",payload:{layerIndex:x,colIndex:w,dac:R}})},[]),ns=T.useCallback((x,w)=>{w.isGroup?we({type:"SET_LAYER_DAC_GROUP",payload:{layerIndex:x,groupDacs:w.channels}}):we({type:"SET_LAYER_DAC",payload:{layerIndex:x,dac:w}})},[]),as=x=>{window.electronAPI&&window.electronAPI.showLayerFullContextMenu&&window.electronAPI.showLayerFullContextMenu(x)},Es=x=>{window.electronAPI&&window.electronAPI.showColumnContextMenu&&window.electronAPI.showColumnContextMenu(x)},ri=x=>{Lt.forEach((w,R)=>{const E=et[R][x];E&&(E.type==="ilda"||E.type==="generator")?wa(R,x):na(R)})},Lr=T.useCallback(x=>{we({type:"SET_SELECTED_DAC",payload:x})},[]),As=T.useCallback(x=>{we({type:"SET_DACS",payload:x})},[]),si=T.useCallback(x=>{$e!==null&&ct!==null?we({type:"SET_CLIP_DAC_GROUP",payload:{layerIndex:$e,colIndex:ct,groupDacs:x}}):$e!==null?we({type:"SET_LAYER_DAC_GROUP",payload:{layerIndex:$e,groupDacs:x}}):tn("Please select a layer or clip first to apply a DAC group.")},[$e,ct]),yl=(x,w)=>{if($e!==null&&ct!==null){let R=null,E={};if(Ve.current&&Ve.current[$e]&&Ve.current[$e][ct]){const ae=Ve.current[$e][ct];ae&&ae.currentParams&&(ae.currentParams[x]=w,Nn.current=!0,R=ae,E=ae.currentParams)}if(R||(R=et[$e][ct],R&&R.currentParams&&(E={...R.currentParams,[x]:w})),!R||!R.generatorDefinition)return;const N=R.generatorDefinition.id,j=`generator-${$e}-${ct}`,q=ua(N,E);q&&(_.current[j]=q),Ot(`generator-${$e}-${ct}-${x}`,{type:"UPDATE_GENERATOR_PARAM",payload:{layerIndex:$e,colIndex:ct,paramName:x,newValue:w}});const ie=`${$e}-${ct}`,ce={...R.generatorDefinition.defaultParams,...E};ba.current.set(ie,JSON.stringify(ce));const de=++Ia.current;fa($e,ct,R.generatorDefinition,E,de,!1,!0)}},Ea=$e!==null&&ct!==null?et[$e][ct]:null;T.useEffect(()=>{if(!window.electronAPI||!a)return;(async()=>{let w=null;Lt.forEach((E,N)=>{const j=Jt[N];if(j!==null){const q=et[N][j];q&&q.type==="generator"&&q.generatorDefinition?.id==="ndi-source"&&(w=q)}}),!w&&Ea?.type==="generator"&&Ea?.generatorDefinition?.id==="ndi-source"&&(w=Ea);const R=w?.currentParams?.sourceName;R&&R!=="No Source"?R!==Jr.current&&(console.log(`[NDI] Switching to source: ${R}`),await window.electronAPI.ndiCreateReceiver(R),Jr.current=R):Jr.current&&(console.log("[NDI] Destroying receiver"),await window.electronAPI.ndiDestroyReceiver(),Jr.current=null)})()},[Jt,et,Ea,Lt]),T.useEffect(()=>{const x=[...Dt,Ea].find(w=>w?.type==="generator"&&w?.generatorDefinition?.id==="ndi-source");if(x&&window.electronAPI?.ndiUpdateSettings){const{captureWidth:w,captureHeight:R}=x.currentParams||{};w&&R&&window.electronAPI.ndiUpdateSettings({width:w,height:R})}},[Dt,Ea]),T.useEffect(()=>{if(!window.electronAPI||!a)return;const x=R=>{let E=!1;Oa.current.forEach((N,j)=>{if(N===null)return;const q=Ge.current[j][N];q&&q.type==="generator"&&q.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:j,colIndex:N,generator:q.generatorDefinition,params:{...q.generatorDefinition.defaultParams,...q.currentParams},ndiFrame:R,isLive:!0,isNdi:!0}),E=!0)}),ya.current?.type==="generator"&&ya.current?.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:$a.current,colIndex:hn.current,generator:ya.current.generatorDefinition,params:{...ya.current.generatorDefinition.defaultParams,...ya.current.currentParams},ndiFrame:R,isLive:!0,isNdi:!0}),E=!0),E||window.electronAPI.ndiRendererReady()},w=window.electronAPI.onNdiFrame(x);return()=>w()},[a]);const Di=T.useCallback((x,w,R)=>{const E=x==="knob"?"knobs":"buttons",N=Pe.quickAssigns[E][w];if(N.link){const{layerIndex:j,colIndex:q,effectIndex:ie,targetType:ce}=N.link,de=N.link.paramName||N.link.paramId;let ae=R;if(x==="knob"&&N.min!==void 0&&N.max!==void 0&&(ae=N.min+R*(N.max-N.min),N.step&&(ae=Math.round(ae/N.step)*N.step),ae=parseFloat(ae.toFixed(5))),ce==="global")de==="master_intensity"?Jn.current=ae:de==="master_speed"&&(fr.current=ae);else if(ce==="layerEffect")Ln.current[j]&&Ln.current[j][ie]&&(Ln.current[j][ie].params[de]=ae);else if((ce==="effect"||ce==="generator")&&Ve.current&&Ve.current[j]&&Ve.current[j][q]){const xe=Ve.current[j][q];ce==="effect"&&xe.effects&&xe.effects[ie]?xe.effects[ie].params[de]=ae:ce==="generator"&&xe.currentParams&&(xe.currentParams[de]=ae),Nn.current=!0}}Ot(`quick-${x}-${w}`,{type:"UPDATE_QUICK_CONTROL",payload:{type:x,index:w,value:R}})},[Pe.quickAssigns,Ot]),Aa=T.useCallback(x=>{const w=Pe.quickAssigns.buttons[x],R=w.link,E=!w.value;if(R){const{layerIndex:N,colIndex:j,effectIndex:q,targetType:ie}=R,ce=R.paramName||R.paramId;if(ie==="transport"){ce==="play"?Za():ce==="pause"?Qa():ce==="stop"&&Ir();return}if(ie==="global"){if(ce==="blackout")Kr.current=E;else if(ce==="laser_output"){cn();return}else if(ce==="clear"){Or();return}}else if(ie==="layer")ce==="blackout"?ea.current[N]=E:ce==="solo"?(ta.current.fill(!1),ta.current[N]=E):ce==="autopilot"&&(Kn.current[N]=E?"forward":"off");else if(ie==="layerEffect")Ln.current[N]&&Ln.current[N][q]&&(Ln.current[N][q].params[ce]=E);else if((ie==="effect"||ie==="generator")&&Ve.current&&Ve.current[N]&&Ve.current[N][j]){const de=Ve.current[N][j];ie==="effect"&&de.effects&&de.effects[q]?de.effects[q].params[ce]=E:ie==="generator"&&de.currentParams&&(de.currentParams[ce]=E),Nn.current=!0}}we({type:"TOGGLE_QUICK_BUTTON",payload:{index:x}})},[Pe.quickAssigns,Za,Qa,Ir,cn,Or]),jr=T.useCallback((x,w,R=127,E="noteon",N=null)=>{if(w===0&&!x.endsWith("_intensity")&&x!=="master_intensity"&&x!=="master_speed"&&!x.startsWith("clip_")&&x!=="bpm_value"&&x!=="bpm_fine_up"&&x!=="bpm_fine_down"&&!x.startsWith("quick_")&&!x.startsWith("dimmer_")&&!x.includes("_item_"))return;let j=w/R;const q=N?.controlMode||"absolute";if(E==="controlchange"){if(q==="relative"){let ae=0;w<=10?ae=w*.01:w>=118&&(ae=(w-128)*.01),j=ae}else if(q==="fake_relative"){const ae=N?.key||x,xe=W.current[ae]??w;W.current[ae]=w,j=(w-xe)/R}}const ie=N?.targetType||"position",de=(()=>{if(ie==="selectedLayer")return{layerIndex:$a.current,colIndex:null};if(ie==="thisClip"){const ae=x.split("_");if(ae[0]==="clip"&&ae.length>=3)return{layerIndex:parseInt(ae[1]),colIndex:parseInt(ae[2])}}return null})();switch(x){case"transport_play":w>0&&Za();break;case"transport_pause":w>0&&Qa();break;case"transport_stop":w>0&&Ir();break;case"comp_blackout":w>0&&we({type:"TOGGLE_GLOBAL_BLACKOUT"});break;case"comp_clear":w>0&&Or();break;case"master_intensity":q==="absolute"?Jn.current=j:Jn.current=Math.max(0,Math.min(1,Jn.current+j)),Ot("master_intensity",{type:"SET_MASTER_INTENSITY",payload:Jn.current});break;case"master_speed":const ae=(fr.current-1)/119;let xe=j;q!=="absolute"&&(xe=Math.max(0,Math.min(1,ae+j)));const fe=Math.max(1,Math.round(xe*119+1));Ot("master_speed",{type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:fe}});break;case"laser_output":w>0&&we({type:"TOGGLE_WORLD_OUTPUT_ACTIVE"});break;case"bpm_value":if(E==="controlchange"){let Te=0;q==="absolute"?w<=10?Te=w:w>=118&&(Te=w-128):Te=Math.round(j*100),Te!==0&&we({type:"SET_BPM",payload:Math.max(1,Math.min(999,(Pe.bpm||120)+Te))})}break;case"bpm_fine_up":w>0&&we({type:"SET_BPM",payload:Math.min(999,(Pe.bpm||120)+.1)});break;case"bpm_fine_down":w>0&&we({type:"SET_BPM",payload:Math.max(1,(Pe.bpm||120)-.1)});break;case"bpm_tap":break;default:let me=x,ke=null,Ne=null;if(de&&(ke=de.layerIndex,Ne=de.colIndex,x.startsWith("layer_")||x.startsWith("clip_"))){const Te=x.split("_"),je=Te[Te.length-1];Ne!==null?me=`clip_${ke}_${Ne}_${je}`:me=`layer_${ke}_${je}`}if(me.includes("_item_")){if(w===0)return;const[Te,je]=me.split("_item_"),Oe=Te.split("_");if(Oe.length>=2&&$e!==null&&ct!==null){const Ie=Oe[0],Je=Oe.slice(1).join("_"),Ke=et[$e][ct]?.effects?.findIndex(st=>st.id===Ie);Ke!==-1&&we({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:$e,colIndex:ct,effectIndex:Ke,paramName:Je,newValue:je}})}return}if(me.startsWith("layer_")){const Te=me.split("_"),je=parseInt(Te[1]),Oe=Te[2];if(Oe==="blackout"&&w>0)we({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:je}});else if(Oe==="solo"&&w>0)we({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:je}});else if(Oe==="intensity"){let Ie=j;q!=="absolute"&&(Ie=Math.max(0,Math.min(1,(en.current[je]||0)+j))),en.current[je]=Ie,Ot(`layer_${je}_intensity`,{type:"SET_LAYER_INTENSITY",payload:{layerIndex:je,intensity:Ie}})}else Oe==="clear"&&w>0&&na(je)}else if(me.startsWith("clip_")){const Te=me.split("_"),je=parseInt(Te[1]),Oe=parseInt(Te[2]),Ie=Te[3];Ie==="preview"?w>0&&Vn(je,Oe):Ie==="intensity"?we({type:"SET_CLIP_INTENSITY",payload:{layerIndex:je,colIndex:Oe,intensity:j}}):wa(je,Oe,w>0)}else if(me.startsWith("column_")){const Te=me.split("_"),je=parseInt(Te[1]);w>0&&ri(je)}else if(me.startsWith("quick_knob_")){const Te=parseInt(me.split("_")[2]);Di("knob",Te,j)}else if(me.startsWith("quick_btn_")){const Te=parseInt(me.split("_")[2]);w>0&&Aa(Te)}else if(me.startsWith("dimmer_")){const Te=me.replace("dimmer_","").replace(/_/g,"."),je=At[Te]||{};we({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:Te,settings:{...je,dimmer:j}}})}else{const Te=me.split("_");if(Te.length>=2&&$e!==null&&ct!==null){const je=et[$e][ct];if(je&&je.effects){const Oe=Te[0],Ie=Te.slice(1).join("_"),Je=je.effects.findIndex(rt=>rt.id===Oe);if(Je!==-1){const Ke=dl.find(st=>st.id===Oe)?.paramControls.find(st=>st.id===Ie);if(Ke){let st=j;if(Ke.type==="range"||Ke.type==="number"){const Tt=je.effects[Je].params[Ie]??Ke.min;if(q==="absolute")st=Ke.min+j*(Ke.max-Ke.min);else{const yt=j*(Ke.max-Ke.min);st=Tt+yt}st=Math.max(Ke.min,Math.min(Ke.max,st)),Ke.step&&(st=Math.round(st/Ke.step)*Ke.step)}else Ke.type==="checkbox"&&(st=j>.5);we({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:$e,colIndex:ct,effectIndex:Je,paramName:Ie,newValue:st}})}}}}}}},[Za,Qa,Ir,Or,na,ni,Pe.bpm,Vn,wa,ri,et,$e,ct,At]),_i=T.useCallback(x=>{if(x==="world"){const R=!(Pe.worldShowBeamEffect??!0);if(we({type:"SET_RENDER_SETTING",payload:{setting:"worldShowBeamEffect",value:R}}),window.electronAPI&&window.electronAPI.setRenderSettings){const E={...Pe.renderSettings,showBeamEffect:Pe.showBeamEffect,beamRenderMode:Pe.beamRenderMode,previewScanRate:Pe.previewScanRate,beamAlpha:Pe.beamAlpha,fadeAlpha:Pe.fadeAlpha,worldShowBeamEffect:R,worldBeamRenderMode:Pe.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(E)}}else{const w=!Ra;if(we({type:"SET_RENDER_SETTING",payload:{setting:"showBeamEffect",value:w}}),window.electronAPI&&window.electronAPI.setRenderSettings){const R={showBeamEffect:w,beamRenderMode:sn,previewScanRate:Wt,beamAlpha:Xa,fadeAlpha:kn,worldShowBeamEffect:Pe.worldShowBeamEffect??!0,worldBeamRenderMode:Pe.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(R)}}},[Ra,sn,Wt,Xa,kn,Pe.worldShowBeamEffect,Pe.worldBeamRenderMode]),y=T.useCallback(x=>{if(x==="world"){const w=Pe.worldBeamRenderMode??"both";let R="points";if(w==="both"?R="points":w==="points"?R="lines":w==="lines"&&(R="both"),we({type:"SET_RENDER_SETTING",payload:{setting:"worldBeamRenderMode",value:R}}),window.electronAPI&&window.electronAPI.setRenderSettings){const E={showBeamEffect:Ra,beamRenderMode:sn,previewScanRate:Wt,beamAlpha:Xa,fadeAlpha:kn,worldShowBeamEffect:Pe.worldShowBeamEffect??!0,worldBeamRenderMode:R};window.electronAPI.setRenderSettings(E)}}else{let w="points";if(sn==="both"?w="points":sn==="points"?w="lines":sn==="lines"&&(w="both"),we({type:"SET_RENDER_SETTING",payload:{setting:"beamRenderMode",value:w}}),window.electronAPI&&window.electronAPI.setRenderSettings){const R={showBeamEffect:Ra,beamRenderMode:w,previewScanRate:Wt,beamAlpha:Xa,fadeAlpha:kn,worldShowBeamEffect:Pe.worldShowBeamEffect??!0,worldBeamRenderMode:Pe.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(R)}}},[Ra,sn,Wt,Xa,kn,Pe.worldShowBeamEffect,Pe.worldBeamRenderMode]),k=async x=>{if(!(!window.electronAPI||!window.electronAPI.showOpenDialog))try{const w=await window.electronAPI.showOpenDialog({title:`Locate missing file: ${x.fileName}`,defaultPath:x.filePath,filters:[{name:"ILDA Files",extensions:["ild"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(w){const R=w,E=window.electronAPI.pathSeparator||(R.includes("/")?"/":"\\");if(we({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:x.filePath,newPath:R}}),x.type!=="audio"){const ae=await window.electronAPI.readFileForWorker(R);n&&n.postMessage({type:"file-content-response",requestId:x.requestId,arrayBuffer:ae},[ae])}at(ae=>ae.filter(xe=>xe.requestId!==x.requestId));const N=ae=>ae.substring(0,ae.lastIndexOf(E)),j=ae=>ae.substring(ae.lastIndexOf(E)+1),q=N(x.filePath),ie=N(R);console.log(`[Relocate] Scanning for other files moving from [${q}] to [${ie}]`);const ce=xa.current.clipContents.flat().filter(ae=>ae),de=new Set([x.filePath]);for(const ae of ce){if(ae.type==="ilda"&&ae.filePath&&!de.has(ae.filePath)&&N(ae.filePath)===q){const xe=j(ae.filePath),fe=`${ie}${E}${xe}`;ae.filePath!==fe&&await window.electronAPI.checkFileExists(fe)&&(console.log(`[Relocate] Auto-resolving ILDA: ${xe}`),we({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:ae.filePath,newPath:fe}}),de.add(ae.filePath),n&&at(ke=>ke.filter(Ne=>Ne.filePath!==ae.filePath)))}if(ae.audioFile&&ae.audioFile.path&&!de.has(ae.audioFile.path)&&N(ae.audioFile.path)===q){const xe=j(ae.audioFile.path),fe=`${ie}${E}${xe}`;ae.audioFile.path!==fe&&await window.electronAPI.checkFileExists(fe)&&(console.log(`[Relocate] Auto-resolving Audio: ${xe}`),we({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:ae.audioFile.path,newPath:fe}}),de.add(ae.audioFile.path),at(ke=>ke.filter(Ne=>Ne.filePath!==ae.audioFile.path)))}}}}catch(w){console.error("Relocation failed:",w),tn(`Relocation failed: ${w.message}`)}},X=T.useCallback((x,w)=>{console.log(`Thumbnail load error for ${x}-${w}, requesting regeneration...`);const R=Ge.current[x][w];if(R)if(R.type==="ilda"&&R.workerId&&n){const E=la[x][w]||0;n.postMessage({type:"get-frame",workerId:R.workerId,frameIndex:E,isStillFrame:!0,layerIndex:x,colIndex:w})}else R.type==="generator"&&R.stillFrame&&Yf(R.stillFrame,R.effects,x,w,ca).then(E=>{E&&we({type:"SET_CLIP_CONTENT",payload:{layerIndex:x,colIndex:w,content:{thumbnailPath:E,thumbnailVersion:Date.now()}}})})},[Ge,la,n,ca]),G=T.useCallback((x,w)=>{const R=Ge.current[x][w];R&&R.audioFile&&at(E=>{const N=`audio-${x}-${w}`;return E.some(j=>j.requestId===N)?E:[...E,{filePath:R.audioFile.path,fileName:R.audioFile.name||R.audioFile.path.split(/[/\\]/).pop(),requestId:N,type:"audio"}]})},[Ge]),H=vn.memo(({isPlaying:x,globalBlackout:w,layerBlackouts:R,layerSolos:E,isWorldOutputActive:N,clipContents:j,activeClipIndexes:q,selectedLayerIndex:ie,selectedColIndex:ce,quickAssigns:de})=>{const{sendFeedback:ae}=jc();return T.useEffect(()=>{ae&&(Lt.forEach((xe,fe)=>{It.forEach((me,ke)=>{const Ne=`clip_${fe}_${ke}`,Te=q[fe]===ke,je=ie===fe&&ce===ke,Oe=!!j[fe][ke];let Ie="empty";Te?Ie="active":je?Ie="previewing":Oe&&(Ie="inactive"),ae(Ne,Te,Ie)})}),ae("transport_play",x),ae("transport_stop",!x),ae("blackout",w),ae("laser_output",N),Lt.forEach((xe,fe)=>{ae(`layer_${fe}_blackout`,R[fe]),ae(`layer_${fe}_solo`,E[fe])}),de&&de.buttons&&de.buttons.forEach((xe,fe)=>{ae(`quick_btn_${fe}`,xe.value)}))},[q,ie,ce,j,x,w,N,R,E,ae,de]),null});return f.jsx(F1,{onMidiCommand:jr,children:f.jsx(P1,{onArtnetCommand:(x,w)=>jr(x,w,255),children:f.jsxs(z1,{onCommand:jr,enabled:J.keyboard,children:[f.jsx(H,{isPlaying:Hn,globalBlackout:Zn,layerBlackouts:ka,layerSolos:Mn,isWorldOutputActive:Qn,clipContents:et,activeClipIndexes:Jt,selectedLayerIndex:$e,selectedColIndex:ct,quickAssigns:Pe.quickAssigns}),f.jsx(eb,{}),re==="main"?f.jsx("div",{className:"app",children:f.jsxs(Gv,{children:[f.jsx(Mv,{message:Tr.message,visible:Tr.visible}),f.jsx(Xv,{show:ee,onClose:()=>se(!1)}),f.jsx(Fv,{show:Ye,onClose:()=>Ue(!1),dacs:ha,dacSettings:At,onUpdateDacSettings:mr}),f.jsx(Pv,{show:pt||De,onClose:()=>{it(!1),qe(!1)},initialTab:De?"fft":"output"}),f.jsx(Uv,{show:Ae,title:lt.title,initialValue:lt.initialValue,onSave:lt.onSave,onClose:()=>Z(!1)||Le(!1)}),f.jsx(zv,{missingFiles:Fe,onRelocate:k,onClose:()=>at([])}),f.jsxs("div",{className:"main-content",children:[f.jsxs("div",{className:"top-bar-left-area",children:[f.jsx(H1,{masterIntensity:Pe.masterIntensity,onMasterIntensityChange:x=>we({type:"SET_MASTER_INTENSITY",payload:x}),onClearAllActive:Or,isGlobalBlackout:Zn,onToggleGlobalBlackout:()=>we({type:"TOGGLE_GLOBAL_BLACKOUT"})}),f.jsx(Ew,{isWorldOutputActive:Qn,onToggleWorldOutput:cn})]}),f.jsxs("div",{className:"layer-controls-container",children:[Lt.map((x,w)=>{const R=Dt.find(N=>{const j=Jt[w];if(j===null)return!1;const q=et[w][j];return q?q.type==="ilda"?N.workerId===q.workerId:q.type==="generator"?N.workerId===`generator-${w}-${j}`:!1:!1})||null,E=R?_.current[R.workerId]:null;return f.jsx(uv,{layerName:x,index:w,onDropEffect:N=>bn(w,N),onDropDac:(N,j)=>ns(N,j),layerEffects:qa[w],activeClipData:R,liveFrame:E,thumbnailRenderMode:ln,intensity:Pe.layerIntensities[w],onIntensityChange:N=>we({type:"SET_LAYER_INTENSITY",payload:{layerIndex:w,intensity:N}}),onDeactivateLayerClips:()=>na(w),onShowLayerFullContextMenu:()=>as(w),isBlackout:ka[w],isSolo:Mn[w],onToggleBlackout:()=>we({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:w}}),onToggleSolo:()=>we({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:w}}),onLayerSelect:N=>we({type:"SET_SELECTED_CLIP",payload:{layerIndex:N,colIndex:null}})},w)}),"          "]}),f.jsx("div",{className:"clip-deck-container",children:f.jsxs("div",{className:"clip-deck",children:[f.jsx("div",{className:"column-headers-container",children:It.map((x,w)=>f.jsx(Y1,{name:x,index:w,onTrigger:()=>ri(w),onShowColumnHeaderContextMenu:()=>Es(w)},w))}),Lt.map((x,w)=>f.jsx("div",{className:"layer-row",children:It.map((R,E)=>{const N=et?.[w]?.[E];let j=null;N&&N.type==="ilda"?j=N.workerId:N&&N.type==="generator"&&(j=`generator-${w}-${E}`);const q=j?_.current[j]:null,ie=N?.stillFrame||(N?.type==="generator"?N.frames?.[0]:null);return f.jsx(dv,{layerIndex:w,colIndex:E,clipName:$r?.[w]?.[E]||`Clip ${w+1}-${E+1}`,clipContent:N,thumbnailFrameIndex:la[w][E],thumbnailRenderMode:ln,liveFrame:q,stillFrame:ie,onActivateClick:ce=>wa(w,E,ce),isActive:Jt[w]===E,onUnsupportedFile:tn,onDropEffect:ce=>Ri(w,E,ce),onDropGenerator:ts,onDropDac:(ce,de,ae)=>{ws(ce,de,ae)},onLabelClick:()=>Vn(w,E),isSelected:$e===w&&ct===E,ildaParserWorker:n,onClipHover:Ss,onThumbnailError:X},E)})},w))]})}),f.jsx(Cw,{clipContents:et,activeClipIndexes:Jt,layerEffects:qa,bpm:Pe.bpm,playbackFps:Ut,selectedLayerIndex:$e,selectedColIndex:ct,liveFramesRef:_,progressRef:I,selectedDac:oa,liveDacOutputSettingsRef:ga,dacOutputSettings:At,getAudioInfo:B,fftLevels:s,getFftLevels:l,effectStatesRef:U,clipActivationTimesRef:P,showBeamEffect:Ra,beamAlpha:Xa,fadeAlpha:kn,previewScanRate:Wt,beamRenderMode:sn,worldShowBeamEffect:Zr,worldBeamRenderMode:kt,masterIntensity:Wr,layerIntensities:cr,globalBlackout:Zn,layerSolos:Mn,layerBlackouts:ka,handleToggleBeamEffect:_i,handleCycleDisplayMode:y,previewFrameCountRef:In,totalPointsSentRef:Tn,activeChannelsCountRef:mt,lastStatUpdateTimeRef:zn,liveClipContentsRef:Ve,optimizationEnabled:ca}),f.jsxs("div",{className:"middle-bar",children:[f.jsx("div",{className:"middle-bar-left-area",children:f.jsx(_v,{bpm:Pe.bpm,onBpmChange:x=>we({type:"SET_BPM",payload:x})})}),f.jsxs("div",{className:"middle-bar-mid-area",children:[f.jsx(Ov,{onPlay:Za,onPause:Qa,onStop:Ir,isPlaying:Hn,isStopped:Pe.isStopped}),f.jsx(ww,{playbackFps:Ut,onSpeedChange:ni})]}),f.jsx("div",{className:"middle-bar-right-area"})]}),f.jsxs("div",{className:"bottom-panel",children:[f.jsxs("div",{className:"bottom-panel-tabs-container-1",children:[f.jsxs("div",{className:"bottom-panel-tabs-1",children:[f.jsx("button",{className:`tab-button-1 ${gt==="files"?"active":""}`,onClick:()=>Bt("files"),children:"Files"}),f.jsx("button",{className:`tab-button-1 ${gt==="generators"?"active":""}`,onClick:()=>Bt("generators"),children:"Generators"}),f.jsx("button",{className:`tab-button-1 ${gt==="effects"?"active":""}`,onClick:()=>Bt("effects"),children:"Effects"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-1",children:[gt==="files"&&f.jsx(hv,{viewMode:Pe.fileBrowserViewMode,onViewModeChange:x=>we({type:"SET_FILE_BROWSER_VIEW_MODE",payload:x}),path:Pe.fileBrowserPath,onPathChange:x=>we({type:"SET_FILE_BROWSER_PATH",payload:x}),onDropIld:(x,w,R)=>n.postMessage({type:"parse-ilda",file:R,layerIndex:x,colIndex:w})}),gt==="generators"&&f.jsx(mv,{}),gt==="effects"&&f.jsx(gv,{})]})]}),f.jsxs("div",{className:"bottom-panel-tabs-container-2",children:[f.jsxs("div",{className:"bottom-panel-tabs-2",children:[f.jsx("button",{className:`tab-button-2 ${ze==="clip"?"active":""}`,onClick:()=>nt("clip"),children:"Clip-Settings"}),f.jsx("button",{className:`tab-button-2 ${ze==="layer"?"active":""}`,onClick:()=>nt("layer"),children:"Layer-Settings"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-2",children:[ze==="clip"&&f.jsx(Tv,{selectedLayerIndex:$e,selectedColIndex:ct,clip:Ea,audioInfo:B($e),bpm:Pe.bpm,getFftLevels:l,onAssignAudio:async()=>{const x=await window.electronAPI.showAudioFileDialog();if(x){const w=x.split(/[\\/]/).pop();we({type:"SET_CLIP_AUDIO",payload:{layerIndex:$e,colIndex:ct,audioFile:{path:x,name:w}}})}},onRemoveAudio:()=>{A($e),we({type:"REMOVE_CLIP_AUDIO",payload:{layerIndex:$e,colIndex:ct}})},onUpdateAudioVolume:(x,w,R)=>{we({type:"SET_CLIP_AUDIO_VOLUME",payload:{layerIndex:x,colIndex:w,volume:R}}),Q(x,R)},onUpdatePlaybackSettings:(x,w,R)=>we({type:"UPDATE_CLIP_PLAYBACK_SETTINGS",payload:{layerIndex:x,colIndex:w,settings:R}}),onSetParamSync:(x,w)=>we({type:"SET_CLIP_PARAM_SYNC",payload:{layerIndex:$e,colIndex:ct,paramId:x,syncMode:w}}),onToggleDacMirror:(x,w,R,E)=>we({type:"TOGGLE_CLIP_DAC_MIRROR",payload:{layerIndex:x,colIndex:w,dacIndex:R,axis:E}}),onRemoveDac:x=>we({type:"REMOVE_CLIP_DAC",payload:{layerIndex:$e,colIndex:ct,dacIndex:x}}),onRemoveEffect:(x,w,R)=>we({type:"REMOVE_CLIP_EFFECT",payload:{layerIndex:x,colIndex:w,effectIndex:R}}),onReorderEffects:(x,w,R,E)=>we({type:"REORDER_CLIP_EFFECTS",payload:{layerIndex:x,colIndex:w,oldIndex:R,newIndex:E}}),onAddEffect:x=>we({type:"ADD_CLIP_EFFECT",payload:{layerIndex:$e,colIndex:ct,effect:x}}),onUpdateClipUiState:(x,w,R)=>we({type:"UPDATE_CLIP_UI_STATE",payload:{layerIndex:x,colIndex:w,uiState:R}}),onParameterChange:xs,onGeneratorParameterChange:yl,progressRef:I,onAudioError:G}),ze==="layer"&&f.jsx(Cv,{selectedLayerIndex:$e,autopilotMode:$e!==null?Pe.layerAutopilots[$e]:"off",onAutopilotChange:x=>we({type:"SET_LAYER_AUTOPILOT",payload:{layerIndex:$e,mode:x}}),layerEffects:$e!==null?qa[$e]:[],assignedDacs:$e!==null&&Pe.layerAssignedDacs?Pe.layerAssignedDacs[$e]:[],onToggleDacMirror:(x,w,R)=>we({type:"TOGGLE_LAYER_DAC_MIRROR",payload:{layerIndex:x,dacIndex:w,axis:R}}),onRemoveDac:(x,w)=>we({type:"REMOVE_LAYER_DAC",payload:{layerIndex:x,dacIndex:w}}),onAddEffect:x=>$e!==null&&we({type:"ADD_LAYER_EFFECT",payload:{layerIndex:$e,effect:x}}),onRemoveEffect:x=>$e!==null&&we({type:"REMOVE_LAYER_EFFECT",payload:{layerIndex:$e,effectIndex:x}}),onParamChange:(x,w,R)=>$e!==null&&we({type:"UPDATE_LAYER_EFFECT_PARAMETER",payload:{layerIndex:$e,effectIndex:x,paramName:w,newValue:R}}),uiState:$e!==null?Pe.layerUiStates[$e]:{},onUpdateUiState:x=>we({type:"UPDATE_LAYER_UI_STATE",payload:{layerIndex:$e,uiState:x}})})]})]}),f.jsx(yv,{dacs:ha,onDacSelected:Lr,onDacsDiscovered:As,dacSettings:At,onUpdateDacSettings:mr,onApplyGroup:si}),f.jsx(jv,{enabledShortcuts:J,onOpenOutputSettings:()=>Ue(!0),onOpenShortcutsSettings:()=>Z(!0),quickAssigns:Pe.quickAssigns,renderSettings:{showBeamEffect:Ra,beamAlpha:Xa,fadeAlpha:kn,previewScanRate:Wt,beamRenderMode:sn,worldShowBeamEffect:Zr,worldBeamRenderMode:kt,settingsPanelCollapsed:Pe.settingsPanelCollapsed,optimizationEnabled:Pe.optimizationEnabled},onSetRenderSetting:(x,w)=>{we(x==="optimizationEnabled"?{type:"SET_OPTIMIZATION_ENABLED",payload:w}:{type:"SET_RENDER_SETTING",payload:{setting:x,value:w}})},onUpdateKnob:(x,w)=>{Di("knob",x,w)},onToggleButton:x=>{Aa(x)},onAssign:(x,w,R)=>we({type:"ASSIGN_QUICK_CONTROL",payload:{type:x,index:w,link:R}})})]}),f.jsx("div",{className:"SystemMonitor",children:f.jsx(Tw,{playbackFps:Ut,previewScanRate:Wt,previewFrameCountRef:In,totalPointsSentRef:Tn,activeChannelsCountRef:mt,lastStatUpdateTimeRef:zn})})]})]})}):re==="shapeBuilder"?f.jsx(Vv,{onBack:()=>V("main")}):f.jsx(qv,{onBack:()=>V("main")})]})})})}M1.createRoot(document.getElementById("root")).render(f.jsx(kv,{children:f.jsx(Wv,{children:f.jsxs(Zv,{children:[" ",f.jsx(pv,{children:f.jsx(Ev,{children:f.jsx(Mw,{})})})]})})}));

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(l){if(l.ep)return;l.ep=!0;const o=a(l);fetch(l.href,o)}})();function od(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Df={exports:{}},fo={};var T0;function w1(){if(T0)return fo;T0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function a(s,l,o){var u=null;if(o!==void 0&&(u=""+o),l.key!==void 0&&(u=""+l.key),"key"in l){o={};for(var p in l)p!=="key"&&(o[p]=l[p])}else o=l;return l=o.ref,{$$typeof:n,type:s,key:u,ref:l!==void 0?l:null,props:o}}return fo.Fragment=e,fo.jsx=a,fo.jsxs=a,fo}var C0;function E1(){return C0||(C0=1,Df.exports=w1()),Df.exports}var f=E1(),If={exports:{}},Nt={};var M0;function A1(){if(M0)return Nt;M0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),S=Symbol.iterator;function x(X){return X===null||typeof X!="object"?null:(X=S&&X[S]||X["@@iterator"],typeof X=="function"?X:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,M={};function R(X,$,he){this.props=X,this.context=$,this.refs=M,this.updater=he||b}R.prototype.isReactComponent={},R.prototype.setState=function(X,$){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,$,"setState")},R.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function I(){}I.prototype=R.prototype;function Q(X,$,he){this.props=X,this.context=$,this.refs=M,this.updater=he||b}var A=Q.prototype=new I;A.constructor=Q,T(A,R.prototype),A.isPureReactComponent=!0;var _=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function F(X,$,he,Ce,Pe,Ke){return he=Ke.ref,{$$typeof:n,type:X,key:$,ref:he!==void 0?he:null,props:Ke}}function K(X,$){return F(X.type,$,void 0,void 0,void 0,X.props)}function le(X){return typeof X=="object"&&X!==null&&X.$$typeof===n}function H(X){var $={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(he){return $[he]})}var N=/\/+/g;function V(X,$){return typeof X=="object"&&X!==null&&X.key!=null?H(""+X.key):$.toString(36)}function U(){}function q(X){switch(X.status){case"fulfilled":return X.value;case"rejected":throw X.reason;default:switch(typeof X.status=="string"?X.then(U,U):(X.status="pending",X.then(function($){X.status==="pending"&&(X.status="fulfilled",X.value=$)},function($){X.status==="pending"&&(X.status="rejected",X.reason=$)})),X.status){case"fulfilled":return X.value;case"rejected":throw X.reason}}throw X}function ie(X,$,he,Ce,Pe){var Ke=typeof X;(Ke==="undefined"||Ke==="boolean")&&(X=null);var Xe=!1;if(X===null)Xe=!0;else switch(Ke){case"bigint":case"string":case"number":Xe=!0;break;case"object":switch(X.$$typeof){case n:case e:Xe=!0;break;case v:return Xe=X._init,ie(Xe(X._payload),$,he,Ce,Pe)}}if(Xe)return Pe=Pe(X),Xe=Ce===""?"."+V(X,0):Ce,_(Pe)?(he="",Xe!=null&&(he=Xe.replace(N,"$&/")+"/"),ie(Pe,$,he,"",function(_e){return _e})):Pe!=null&&(le(Pe)&&(Pe=K(Pe,he+(Pe.key==null||X&&X.key===Pe.key?"":(""+Pe.key).replace(N,"$&/")+"/")+Xe)),$.push(Pe)),1;Xe=0;var wt=Ce===""?".":Ce+":";if(_(X))for(var dt=0;dt<X.length;dt++)Ce=X[dt],Ke=wt+V(Ce,dt),Xe+=ie(Ce,$,he,Ke,Pe);else if(dt=x(X),typeof dt=="function")for(X=dt.call(X),dt=0;!(Ce=X.next()).done;)Ce=Ce.value,Ke=wt+V(Ce,dt++),Xe+=ie(Ce,$,he,Ke,Pe);else if(Ke==="object"){if(typeof X.then=="function")return ie(q(X),$,he,Ce,Pe);throw $=String(X),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Xe}function z(X,$,he){if(X==null)return X;var Ce=[],Pe=0;return ie(X,Ce,"","",function(Ke){return $.call(he,Ke,Pe++)}),Ce}function J(X){if(X._status===-1){var $=X._result;$=$(),$.then(function(he){(X._status===0||X._status===-1)&&(X._status=1,X._result=he)},function(he){(X._status===0||X._status===-1)&&(X._status=2,X._result=he)}),X._status===-1&&(X._status=0,X._result=$)}if(X._status===1)return X._result.default;throw X._result}var pe=typeof reportError=="function"?reportError:function(X){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof X=="object"&&X!==null&&typeof X.message=="string"?String(X.message):String(X),error:X});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",X);return}console.error(X)};function me(){}return Nt.Children={map:z,forEach:function(X,$,he){z(X,function(){$.apply(this,arguments)},he)},count:function(X){var $=0;return z(X,function(){$++}),$},toArray:function(X){return z(X,function($){return $})||[]},only:function(X){if(!le(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},Nt.Component=R,Nt.Fragment=a,Nt.Profiler=l,Nt.PureComponent=Q,Nt.StrictMode=s,Nt.Suspense=h,Nt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Nt.__COMPILER_RUNTIME={__proto__:null,c:function(X){return k.H.useMemoCache(X)}},Nt.cache=function(X){return function(){return X.apply(null,arguments)}},Nt.cloneElement=function(X,$,he){if(X==null)throw Error("The argument must be a React element, but you passed "+X+".");var Ce=T({},X.props),Pe=X.key,Ke=void 0;if($!=null)for(Xe in $.ref!==void 0&&(Ke=void 0),$.key!==void 0&&(Pe=""+$.key),$)!G.call($,Xe)||Xe==="key"||Xe==="__self"||Xe==="__source"||Xe==="ref"&&$.ref===void 0||(Ce[Xe]=$[Xe]);var Xe=arguments.length-2;if(Xe===1)Ce.children=he;else if(1<Xe){for(var wt=Array(Xe),dt=0;dt<Xe;dt++)wt[dt]=arguments[dt+2];Ce.children=wt}return F(X.type,Pe,void 0,void 0,Ke,Ce)},Nt.createContext=function(X){return X={$$typeof:u,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null},X.Provider=X,X.Consumer={$$typeof:o,_context:X},X},Nt.createElement=function(X,$,he){var Ce,Pe={},Ke=null;if($!=null)for(Ce in $.key!==void 0&&(Ke=""+$.key),$)G.call($,Ce)&&Ce!=="key"&&Ce!=="__self"&&Ce!=="__source"&&(Pe[Ce]=$[Ce]);var Xe=arguments.length-2;if(Xe===1)Pe.children=he;else if(1<Xe){for(var wt=Array(Xe),dt=0;dt<Xe;dt++)wt[dt]=arguments[dt+2];Pe.children=wt}if(X&&X.defaultProps)for(Ce in Xe=X.defaultProps,Xe)Pe[Ce]===void 0&&(Pe[Ce]=Xe[Ce]);return F(X,Ke,void 0,void 0,null,Pe)},Nt.createRef=function(){return{current:null}},Nt.forwardRef=function(X){return{$$typeof:p,render:X}},Nt.isValidElement=le,Nt.lazy=function(X){return{$$typeof:v,_payload:{_status:-1,_result:X},_init:J}},Nt.memo=function(X,$){return{$$typeof:g,type:X,compare:$===void 0?null:$}},Nt.startTransition=function(X){var $=k.T,he={};k.T=he;try{var Ce=X(),Pe=k.S;Pe!==null&&Pe(he,Ce),typeof Ce=="object"&&Ce!==null&&typeof Ce.then=="function"&&Ce.then(me,pe)}catch(Ke){pe(Ke)}finally{k.T=$}},Nt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Nt.use=function(X){return k.H.use(X)},Nt.useActionState=function(X,$,he){return k.H.useActionState(X,$,he)},Nt.useCallback=function(X,$){return k.H.useCallback(X,$)},Nt.useContext=function(X){return k.H.useContext(X)},Nt.useDebugValue=function(){},Nt.useDeferredValue=function(X,$){return k.H.useDeferredValue(X,$)},Nt.useEffect=function(X,$,he){var Ce=k.H;if(typeof he=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ce.useEffect(X,$)},Nt.useId=function(){return k.H.useId()},Nt.useImperativeHandle=function(X,$,he){return k.H.useImperativeHandle(X,$,he)},Nt.useInsertionEffect=function(X,$){return k.H.useInsertionEffect(X,$)},Nt.useLayoutEffect=function(X,$){return k.H.useLayoutEffect(X,$)},Nt.useMemo=function(X,$){return k.H.useMemo(X,$)},Nt.useOptimistic=function(X,$){return k.H.useOptimistic(X,$)},Nt.useReducer=function(X,$,he){return k.H.useReducer(X,$,he)},Nt.useRef=function(X){return k.H.useRef(X)},Nt.useState=function(X){return k.H.useState(X)},Nt.useSyncExternalStore=function(X,$,he){return k.H.useSyncExternalStore(X,$,he)},Nt.useTransition=function(){return k.H.useTransition()},Nt.version="19.1.1",Nt}var k0;function cd(){return k0||(k0=1,If.exports=A1()),If.exports}var w=cd();const Bn=od(w);var _f={exports:{}},po={},Of={exports:{}},Lf={};var N0;function T1(){return N0||(N0=1,(function(n){function e(z,J){var pe=z.length;z.push(J);e:for(;0<pe;){var me=pe-1>>>1,X=z[me];if(0<l(X,J))z[me]=J,z[pe]=X,pe=me;else break e}}function a(z){return z.length===0?null:z[0]}function s(z){if(z.length===0)return null;var J=z[0],pe=z.pop();if(pe!==J){z[0]=pe;e:for(var me=0,X=z.length,$=X>>>1;me<$;){var he=2*(me+1)-1,Ce=z[he],Pe=he+1,Ke=z[Pe];if(0>l(Ce,pe))Pe<X&&0>l(Ke,Ce)?(z[me]=Ke,z[Pe]=pe,me=Pe):(z[me]=Ce,z[he]=pe,me=he);else if(Pe<X&&0>l(Ke,pe))z[me]=Ke,z[Pe]=pe,me=Pe;else break e}}return J}function l(z,J){var pe=z.sortIndex-J.sortIndex;return pe!==0?pe:z.id-J.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var u=Date,p=u.now();n.unstable_now=function(){return u.now()-p}}var h=[],g=[],v=1,S=null,x=3,b=!1,T=!1,M=!1,R=!1,I=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function _(z){for(var J=a(g);J!==null;){if(J.callback===null)s(g);else if(J.startTime<=z)s(g),J.sortIndex=J.expirationTime,e(h,J);else break;J=a(g)}}function k(z){if(M=!1,_(z),!T)if(a(h)!==null)T=!0,G||(G=!0,V());else{var J=a(g);J!==null&&ie(k,J.startTime-z)}}var G=!1,F=-1,K=5,le=-1;function H(){return R?!0:!(n.unstable_now()-le<K)}function N(){if(R=!1,G){var z=n.unstable_now();le=z;var J=!0;try{e:{T=!1,M&&(M=!1,Q(F),F=-1),b=!0;var pe=x;try{t:{for(_(z),S=a(h);S!==null&&!(S.expirationTime>z&&H());){var me=S.callback;if(typeof me=="function"){S.callback=null,x=S.priorityLevel;var X=me(S.expirationTime<=z);if(z=n.unstable_now(),typeof X=="function"){S.callback=X,_(z),J=!0;break t}S===a(h)&&s(h),_(z)}else s(h);S=a(h)}if(S!==null)J=!0;else{var $=a(g);$!==null&&ie(k,$.startTime-z),J=!1}}break e}finally{S=null,x=pe,b=!1}J=void 0}}finally{J?V():G=!1}}}var V;if(typeof A=="function")V=function(){A(N)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,q=U.port2;U.port1.onmessage=N,V=function(){q.postMessage(null)}}else V=function(){I(N,0)};function ie(z,J){F=I(function(){z(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(z){switch(x){case 1:case 2:case 3:var J=3;break;default:J=x}var pe=x;x=J;try{return z()}finally{x=pe}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(z,J){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var pe=x;x=z;try{return J()}finally{x=pe}},n.unstable_scheduleCallback=function(z,J,pe){var me=n.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?me+pe:me):pe=me,z){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=pe+X,z={id:v++,callback:J,priorityLevel:z,startTime:pe,expirationTime:X,sortIndex:-1},pe>me?(z.sortIndex=pe,e(g,z),a(h)===null&&z===a(g)&&(M?(Q(F),F=-1):M=!0,ie(k,pe-me))):(z.sortIndex=X,e(h,z),T||b||(T=!0,G||(G=!0,V()))),z},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(z){var J=x;return function(){var pe=x;x=J;try{return z.apply(this,arguments)}finally{x=pe}}}})(Lf)),Lf}var R0;function C1(){return R0||(R0=1,Of.exports=T1()),Of.exports}var jf={exports:{}},va={};var D0;function M1(){if(D0)return va;D0=1;var n=cd();function e(h){var g="https://react.dev/errors/"+h;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)g+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(e(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},l=Symbol.for("react.portal");function o(h,g,v){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:S==null?null:""+S,children:h,containerInfo:g,implementation:v}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(h,g){if(h==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return va.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,va.createPortal=function(h,g){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return o(h,g,null,v)},va.flushSync=function(h){var g=u.T,v=s.p;try{if(u.T=null,s.p=2,h)return h()}finally{u.T=g,s.p=v,s.d.f()}},va.preconnect=function(h,g){typeof h=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,s.d.C(h,g))},va.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},va.preinit=function(h,g){if(typeof h=="string"&&g&&typeof g.as=="string"){var v=g.as,S=p(v,g.crossOrigin),x=typeof g.integrity=="string"?g.integrity:void 0,b=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;v==="style"?s.d.S(h,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:S,integrity:x,fetchPriority:b}):v==="script"&&s.d.X(h,{crossOrigin:S,integrity:x,fetchPriority:b,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},va.preinitModule=function(h,g){if(typeof h=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var v=p(g.as,g.crossOrigin);s.d.M(h,{crossOrigin:v,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&s.d.M(h)},va.preload=function(h,g){if(typeof h=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var v=g.as,S=p(v,g.crossOrigin);s.d.L(h,v,{crossOrigin:S,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},va.preloadModule=function(h,g){if(typeof h=="string")if(g){var v=p(g.as,g.crossOrigin);s.d.m(h,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:v,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else s.d.m(h)},va.requestFormReset=function(h){s.d.r(h)},va.unstable_batchedUpdates=function(h,g){return h(g)},va.useFormState=function(h,g,v){return u.H.useFormState(h,g,v)},va.useFormStatus=function(){return u.H.useHostTransitionStatus()},va.version="19.1.1",va}var I0;function Hm(){if(I0)return jf.exports;I0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),jf.exports=M1(),jf.exports}var _0;function k1(){if(_0)return po;_0=1;var n=C1(),e=cd(),a=Hm();function s(t){var r="https://react.dev/errors/"+t;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)r+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function o(t){var r=t,i=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,(r.flags&4098)!==0&&(i=r.return),t=r.return;while(t)}return r.tag===3?i:null}function u(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function p(t){if(o(t)!==t)throw Error(s(188))}function h(t){var r=t.alternate;if(!r){if(r=o(t),r===null)throw Error(s(188));return r!==t?null:t}for(var i=t,c=r;;){var d=i.return;if(d===null)break;var m=d.alternate;if(m===null){if(c=d.return,c!==null){i=c;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===i)return p(d),t;if(m===c)return p(d),r;m=m.sibling}throw Error(s(188))}if(i.return!==c.return)i=d,c=m;else{for(var E=!1,j=d.child;j;){if(j===i){E=!0,i=d,c=m;break}if(j===c){E=!0,c=d,i=m;break}j=j.sibling}if(!E){for(j=m.child;j;){if(j===i){E=!0,i=m,c=d;break}if(j===c){E=!0,c=m,i=d;break}j=j.sibling}if(!E)throw Error(s(189))}}if(i.alternate!==c)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?t:r}function g(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t;for(t=t.child;t!==null;){if(r=g(t),r!==null)return r;t=t.sibling}return null}var v=Object.assign,S=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),Q=Symbol.for("react.consumer"),A=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),le=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),N=Symbol.iterator;function V(t){return t===null||typeof t!="object"?null:(t=N&&t[N]||t["@@iterator"],typeof t=="function"?t:null)}var U=Symbol.for("react.client.reference");function q(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===U?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case T:return"Fragment";case R:return"Profiler";case M:return"StrictMode";case k:return"Suspense";case G:return"SuspenseList";case le:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case b:return"Portal";case A:return(t.displayName||"Context")+".Provider";case Q:return(t._context.displayName||"Context")+".Consumer";case _:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case F:return r=t.displayName||null,r!==null?r:q(t.type)||"Memo";case K:r=t._payload,t=t._init;try{return q(t(r))}catch{}}return null}var ie=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pe={pending:!1,data:null,method:null,action:null},me=[],X=-1;function $(t){return{current:t}}function he(t){0>X||(t.current=me[X],me[X]=null,X--)}function Ce(t,r){X++,me[X]=t.current,t.current=r}var Pe=$(null),Ke=$(null),Xe=$(null),wt=$(null);function dt(t,r){switch(Ce(Xe,r),Ce(Ke,t),Ce(Pe,null),r.nodeType){case 9:case 11:t=(t=r.documentElement)&&(t=t.namespaceURI)?Jh(t):0;break;default:if(t=r.tagName,r=r.namespaceURI)r=Jh(r),t=e0(r,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}he(Pe),Ce(Pe,t)}function _e(){he(Pe),he(Ke),he(Xe)}function Ze(t){t.memoizedState!==null&&Ce(wt,t);var r=Pe.current,i=e0(r,t.type);r!==i&&(Ce(Ke,t),Ce(Pe,i))}function ft(t){Ke.current===t&&(he(Pe),he(Ke)),wt.current===t&&(he(wt),io._currentValue=pe)}var Rt=Object.prototype.hasOwnProperty,Dt=n.unstable_scheduleCallback,zt=n.unstable_cancelCallback,Xn=n.unstable_shouldYield,nt=n.unstable_requestPaint,tt=n.unstable_now,ut=n.unstable_getCurrentPriorityLevel,Yt=n.unstable_ImmediatePriority,Vt=n.unstable_UserBlockingPriority,rt=n.unstable_NormalPriority,Gt=n.unstable_LowPriority,ze=n.unstable_IdlePriority,xe=n.log,wn=n.unstable_setDisableYieldValue,qt=null,Xt=null;function $t(t){if(typeof xe=="function"&&wn(t),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(qt,t)}catch{}}var pt=Math.clz32?Math.clz32:ar,os=Math.log,xa=Math.LN2;function ar(t){return t>>>=0,t===0?32:31-(os(t)/xa|0)|0}var On=256,rr=4194304;function ea(t){var r=t&42;if(r!==0)return r;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function La(t,r,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,E=t.pingedLanes;t=t.warmLanes;var j=c&134217727;return j!==0?(c=j&~m,c!==0?d=ea(c):(E&=j,E!==0?d=ea(E):i||(i=j&~t,i!==0&&(d=ea(i))))):(j=c&~m,j!==0?d=ea(j):E!==0?d=ea(E):i||(i=c&~t,i!==0&&(d=ea(i)))),d===0?0:r!==0&&r!==d&&(r&m)===0&&(m=d&-d,i=r&-r,m>=i||m===32&&(i&4194048)!==0)?r:d}function $n(t,r){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&r)===0}function Hr(t,r){switch(t){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pa(){var t=On;return On<<=1,(On&4194048)===0&&(On=256),t}function at(){var t=rr;return rr<<=1,(rr&62914560)===0&&(rr=4194304),t}function gt(t){for(var r=[],i=0;31>i;i++)r.push(t);return r}function Yr(t,r){t.pendingLanes|=r,r!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Ma(t,r,i,c,d,m){var E=t.pendingLanes;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=i,t.entangledLanes&=i,t.errorRecoveryDisabledLanes&=i,t.shellSuspendCounter=0;var j=t.entanglements,se=t.expirationTimes,ve=t.hiddenUpdates;for(i=E&~i;0<i;){var Me=31-pt(i),Ie=1<<Me;j[Me]=0,se[Me]=-1;var be=ve[Me];if(be!==null)for(ve[Me]=null,Me=0;Me<be.length;Me++){var Se=be[Me];Se!==null&&(Se.lane&=-536870913)}i&=~Ie}c!==0&&Sa(t,c,0),m!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=m&~(E&~r))}function Sa(t,r,i){t.pendingLanes|=r,t.suspendedLanes&=~r;var c=31-pt(r);t.entangledLanes|=r,t.entanglements[c]=t.entanglements[c]|1073741824|i&4194090}function Pi(t,r){var i=t.entangledLanes|=r;for(t=t.entanglements;i;){var c=31-pt(i),d=1<<c;d&r|t[c]&r&&(t[c]|=r),i&=~d}}function ja(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Vr(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function cs(){var t=J.p;return t!==0?t:(t=window.event,t===void 0?32:b0(t.type))}function sr(t,r){var i=J.p;try{return J.p=t,r()}finally{J.p=i}}var Wn=Math.random().toString(36).slice(2),un="__reactFiber$"+Wn,tn="__reactProps$"+Wn,Cn="__reactContainer$"+Wn,ha="__reactEvents$"+Wn,Ft="__reactListeners$"+Wn,us="__reactHandles$"+Wn,ta="__reactResources$"+Wn,hn="__reactMarker$"+Wn;function Fa(t){delete t[un],delete t[tn],delete t[ha],delete t[Ft],delete t[us]}function ir(t){var r=t[un];if(r)return r;for(var i=t.parentNode;i;){if(r=i[Cn]||i[un]){if(i=r.alternate,r.child!==null||i!==null&&i.child!==null)for(t=r0(t);t!==null;){if(i=t[un])return i;t=r0(t)}return r}t=i,i=t.parentNode}return null}function Mn(t){if(t=t[un]||t[Cn]){var r=t.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return t}return null}function nn(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t.stateNode;throw Error(s(33))}function lr(t){var r=t[ta];return r||(r=t[ta]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function yn(t){t[hn]=!0}var mn=new Set,ot={};function Et(t,r){En(t,r),En(t+"Capture",r)}function En(t,r){for(ot[t]=r,t=0;t<r.length;t++)mn.add(r[t])}var Bi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),hi={},Ln={};function Ua(t){return Rt.call(Ln,t)?!0:Rt.call(hi,t)?!1:Bi.test(t)?Ln[t]=!0:(hi[t]=!0,!1)}function or(t,r,i){if(Ua(r))if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":t.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){t.removeAttribute(r);return}}t.setAttribute(r,""+i)}}function ma(t,r,i){if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(r);return}t.setAttribute(r,""+i)}}function Zt(t,r,i,c){if(c===null)t.removeAttribute(i);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttributeNS(r,i,""+c)}}var St,ka;function kn(t){if(St===void 0)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);St=r&&r[1]||"",ka=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+St+t+ka}var Pa=!1;function an(t,r){if(!t||Pa)return"";Pa=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Ie=function(){throw Error()};if(Object.defineProperty(Ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ie,[])}catch(Se){var be=Se}Reflect.construct(t,[],Ie)}else{try{Ie.call()}catch(Se){be=Se}t.call(Ie.prototype)}}else{try{throw Error()}catch(Se){be=Se}(Ie=t())&&typeof Ie.catch=="function"&&Ie.catch(function(){})}}catch(Se){if(Se&&be&&typeof Se.stack=="string")return[Se.stack,be.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=c.DetermineComponentFrameRoot(),E=m[0],j=m[1];if(E&&j){var se=E.split(`
`),ve=j.split(`
`);for(d=c=0;c<se.length&&!se[c].includes("DetermineComponentFrameRoot");)c++;for(;d<ve.length&&!ve[d].includes("DetermineComponentFrameRoot");)d++;if(c===se.length||d===ve.length)for(c=se.length-1,d=ve.length-1;1<=c&&0<=d&&se[c]!==ve[d];)d--;for(;1<=c&&0<=d;c--,d--)if(se[c]!==ve[d]){if(c!==1||d!==1)do if(c--,d--,0>d||se[c]!==ve[d]){var Me=`
`+se[c].replace(" at new "," at ");return t.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",t.displayName)),Me}while(1<=c&&0<=d);break}}}finally{Pa=!1,Error.prepareStackTrace=i}return(i=t?t.displayName||t.name:"")?kn(i):""}function ga(t){switch(t.tag){case 26:case 27:case 5:return kn(t.type);case 16:return kn("Lazy");case 13:return kn("Suspense");case 19:return kn("SuspenseList");case 0:case 15:return an(t.type,!1);case 11:return an(t.type.render,!1);case 1:return an(t.type,!0);case 31:return kn("Activity");default:return""}}function wa(t){try{var r="";do r+=ga(t),t=t.return;while(t);return r}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function bn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function cr(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function qr(t){var r=cr(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),c=""+t[r];if(!t.hasOwnProperty(r)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,m=i.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return d.call(this)},set:function(E){c=""+E,m.call(this,E)}}),Object.defineProperty(t,r,{enumerable:i.enumerable}),{getValue:function(){return c},setValue:function(E){c=""+E},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function Xr(t){t._valueTracker||(t._valueTracker=qr(t))}function Tr(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var i=r.getValue(),c="";return t&&(c=cr(t)?t.checked?"true":"false":t.value),t=c,t!==i?(r.setValue(t),!0):!1}function $r(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var mi=/[\n"\\]/g;function Zn(t){return t.replace(mi,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Cr(t,r,i,c,d,m,E,j){t.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?t.type=E:t.removeAttribute("type"),r!=null?E==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+bn(r)):t.value!==""+bn(r)&&(t.value=""+bn(r)):E!=="submit"&&E!=="reset"||t.removeAttribute("value"),r!=null?Ba(t,E,bn(r)):i!=null?Ba(t,E,bn(i)):c!=null&&t.removeAttribute("value"),d==null&&m!=null&&(t.defaultChecked=!!m),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?t.name=""+bn(j):t.removeAttribute("name")}function fs(t,r,i,c,d,m,E,j){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(t.type=m),r!=null||i!=null){if(!(m!=="submit"&&m!=="reset"||r!=null))return;i=i!=null?""+bn(i):"",r=r!=null?""+bn(r):i,j||r===t.value||(t.value=r),t.defaultValue=r}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,t.checked=j?t.checked:!!c,t.defaultChecked=!!c,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(t.name=E)}function Ba(t,r,i){r==="number"&&$r(t.ownerDocument)===t||t.defaultValue===""+i||(t.defaultValue=""+i)}function Mr(t,r,i,c){if(t=t.options,r){r={};for(var d=0;d<i.length;d++)r["$"+i[d]]=!0;for(i=0;i<t.length;i++)d=r.hasOwnProperty("$"+t[i].value),t[i].selected!==d&&(t[i].selected=d),d&&c&&(t[i].defaultSelected=!0)}else{for(i=""+bn(i),r=null,d=0;d<t.length;d++){if(t[d].value===i){t[d].selected=!0,c&&(t[d].defaultSelected=!0);return}r!==null||t[d].disabled||(r=t[d])}r!==null&&(r.selected=!0)}}function _s(t,r,i){if(r!=null&&(r=""+bn(r),r!==t.value&&(t.value=r),i==null)){t.defaultValue!==r&&(t.defaultValue=r);return}t.defaultValue=i!=null?""+bn(i):""}function kr(t,r,i,c){if(r==null){if(c!=null){if(i!=null)throw Error(s(92));if(ie(c)){if(1<c.length)throw Error(s(93));c=c[0]}i=c}i==null&&(i=""),r=i}i=bn(r),t.defaultValue=i,c=t.textContent,c===i&&c!==""&&c!==null&&(t.value=c)}function za(t,r){if(r){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=r;return}}t.textContent=r}var ds=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nr(t,r,i){var c=r.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?c?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="":c?t.setProperty(r,i):typeof i!="number"||i===0||ds.has(r)?r==="float"?t.cssFloat=i:t[r]=(""+i).trim():t[r]=i+"px"}function Rr(t,r,i){if(r!=null&&typeof r!="object")throw Error(s(62));if(t=t.style,i!=null){for(var c in i)!i.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?t.setProperty(c,""):c==="float"?t.cssFloat="":t[c]="");for(var d in r)c=r[d],r.hasOwnProperty(d)&&i[d]!==c&&Nr(t,d,c)}else for(var m in r)r.hasOwnProperty(m)&&Nr(t,m,r[m])}function Os(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gi=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ls(t){return gi.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var js=null;function Dr(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ur=null,fr=null;function ps(t){var r=Mn(t);if(r&&(t=r.stateNode)){var i=t[tn]||null;e:switch(t=r.stateNode,r.type){case"input":if(Cr(t,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),r=i.name,i.type==="radio"&&r!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+Zn(""+r)+'"][type="radio"]'),r=0;r<i.length;r++){var c=i[r];if(c!==t&&c.form===t.form){var d=c[tn]||null;if(!d)throw Error(s(90));Cr(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(r=0;r<i.length;r++)c=i[r],c.form===t.form&&Tr(c)}break e;case"textarea":_s(t,i.value,i.defaultValue);break e;case"select":r=i.value,r!=null&&Mr(t,!!i.multiple,r,!1)}}}var Zr=!1;function dr(t,r,i){if(Zr)return t(r,i);Zr=!0;try{var c=t(r);return c}finally{if(Zr=!1,(ur!==null||fr!==null)&&(oc(),ur&&(r=ur,t=fr,fr=ur=null,ps(r),t)))for(r=0;r<t.length;r++)ps(t[r])}}function oa(t,r){var i=t.stateNode;if(i===null)return null;var c=i[tn]||null;if(c===null)return null;i=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(s(231,r,typeof i));return i}var Na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ir=!1;if(Na)try{var pr={};Object.defineProperty(pr,"passive",{get:function(){Ir=!0}}),window.addEventListener("test",pr,pr),window.removeEventListener("test",pr,pr)}catch{Ir=!1}var Ea=null,hs=null,Qr=null;function An(){if(Qr)return Qr;var t,r=hs,i=r.length,c,d="value"in Ea?Ea.value:Ea.textContent,m=d.length;for(t=0;t<i&&r[t]===d[t];t++);var E=i-t;for(c=1;c<=E&&r[i-c]===d[m-c];c++);return Qr=d.slice(t,1<c?1-c:void 0)}function ms(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function rn(){return!0}function yi(){return!1}function zn(t){function r(i,c,d,m,E){this._reactName=i,this._targetInst=d,this.type=c,this.nativeEvent=m,this.target=E,this.currentTarget=null;for(var j in t)t.hasOwnProperty(j)&&(i=t[j],this[j]=i?i(m):m[j]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?rn:yi,this.isPropagationStopped=yi,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),r}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fs=zn(Ga),Kr=v({},Ga,{view:0,detail:0}),Ha=zn(Kr),fn,hr,Ya,Va=v({},Kr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:B,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ya&&(Ya&&t.type==="mousemove"?(fn=t.screenX-Ya.screenX,hr=t.screenY-Ya.screenY):hr=fn=0,Ya=t),fn)},movementY:function(t){return"movementY"in t?t.movementY:hr}}),mr=zn(Va),vi=v({},Va,{dataTransfer:0}),Ra=zn(vi),Us=v({},Kr,{relatedTarget:0}),_r=zn(Us),Tl=v({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),Ps=zn(Tl),Cl=v({},Ga,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),qa=zn(Cl),Bs=v({},Ga,{data:0}),zi=zn(Bs),y={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},C={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Y={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=Y[t])?!!r[t]:!1}function B(){return P}var O=v({},Kr,{key:function(t){if(t.key){var r=y[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=ms(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?C[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:B,charCode:function(t){return t.type==="keypress"?ms(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ms(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ne=zn(O),ue=v({},Va,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),te=zn(ue),ee=v({},Kr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:B}),ae=zn(ee),fe=v({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ae=zn(fe),De=v({},Va,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Oe=zn(De),Ye=v({},Ga,{newState:0,oldState:0}),L=zn(Ye),D=[9,13,27,32],W=Na&&"CompositionEvent"in window,Z=null;Na&&"documentMode"in document&&(Z=document.documentMode);var re=Na&&"TextEvent"in window&&!Z,ce=Na&&(!W||Z&&8<Z&&11>=Z),we=" ",Be=!1;function Ue(t,r){switch(t){case"keyup":return D.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ye=!1;function He(t,r){switch(t){case"compositionend":return qe(r);case"keypress":return r.which!==32?null:(Be=!0,we);case"textInput":return t=r.data,t===we&&Be?null:t;default:return null}}function Le(t,r){if(ye)return t==="compositionend"||!W&&Ue(t,r)?(t=An(),Qr=hs=Ea=null,ye=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return ce&&r.locale!=="ko"?null:r.data;default:return null}}var ke={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qe(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!ke[t.type]:r==="textarea"}function Fe(t,r,i,c){ur?fr?fr.push(c):fr=[c]:ur=c,r=hc(r,"onChange"),0<r.length&&(i=new Fs("onChange","change",null,i,c),t.push({event:i,listeners:r}))}var Te=null,$e=null;function Ge(t){$h(t,0)}function Je(t){var r=nn(t);if(Tr(r))return t}function ct(t,r){if(t==="change")return r}var Ct=!1;if(Na){var Ut;if(Na){var Mt="oninput"in document;if(!Mt){var kt=document.createElement("div");kt.setAttribute("oninput","return;"),Mt=typeof kt.oninput=="function"}Ut=Mt}else Ut=!1;Ct=Ut&&(!document.documentMode||9<document.documentMode)}function Tt(){Te&&(Te.detachEvent("onpropertychange",Nn),$e=Te=null)}function Nn(t){if(t.propertyName==="value"&&Je($e)){var r=[];Fe(r,$e,t,Dr(t)),dr(Ge,r)}}function vn(t,r,i){t==="focusin"?(Tt(),Te=r,$e=i,Te.attachEvent("onpropertychange",Nn)):t==="focusout"&&Tt()}function Qt(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Je($e)}function Da(t,r){if(t==="click")return Je(r)}function na(t,r){if(t==="input"||t==="change")return Je(r)}function ca(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var It=typeof Object.is=="function"?Object.is:ca;function Pt(t,r){if(It(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var i=Object.keys(t),c=Object.keys(r);if(i.length!==c.length)return!1;for(c=0;c<i.length;c++){var d=i[c];if(!Rt.call(r,d)||!It(t[d],r[d]))return!1}return!0}function Aa(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ta(t,r){var i=Aa(t);t=0;for(var c;i;){if(i.nodeType===3){if(c=t+i.textContent.length,t<=r&&c>=r)return{node:i,offset:r-t};t=c}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Aa(i)}}function xn(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?xn(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function jn(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var r=$r(t.document);r instanceof t.HTMLIFrameElement;){try{var i=typeof r.contentWindow.location.href=="string"}catch{i=!1}if(i)t=r.contentWindow;else break;r=$r(t.document)}return r}function Kt(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}var At=Na&&"documentMode"in document&&11>=document.documentMode,Gn=null,Rn=null,aa=null,gs=!1;function Xa(t,r,i){var c=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;gs||Gn==null||Gn!==$r(c)||(c=Gn,"selectionStart"in c&&Kt(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),aa&&Pt(aa,c)||(aa=c,c=hc(Rn,"onSelect"),0<c.length&&(r=new Fs("onSelect","select",null,r,i),t.push({event:r,listeners:c}),r.target=Gn)))}function Qn(t,r){var i={};return i[t.toLowerCase()]=r.toLowerCase(),i["Webkit"+t]="webkit"+r,i["Moz"+t]="moz"+r,i}var gr={animationend:Qn("Animation","AnimationEnd"),animationiteration:Qn("Animation","AnimationIteration"),animationstart:Qn("Animation","AnimationStart"),transitionrun:Qn("Transition","TransitionRun"),transitionstart:Qn("Transition","TransitionStart"),transitioncancel:Qn("Transition","TransitionCancel"),transitionend:Qn("Transition","TransitionEnd")},Ml={},yr={};Na&&(yr=document.createElement("div").style,"AnimationEvent"in window||(delete gr.animationend.animation,delete gr.animationiteration.animation,delete gr.animationstart.animation),"TransitionEvent"in window||delete gr.transitionend.transition);function Hn(t){if(Ml[t])return Ml[t];if(!gr[t])return t;var r=gr[t],i;for(i in r)if(r.hasOwnProperty(i)&&i in yr)return Ml[t]=r[i];return t}var Cd=Hn("animationend"),Md=Hn("animationiteration"),kd=Hn("animationstart"),ry=Hn("transitionrun"),sy=Hn("transitionstart"),iy=Hn("transitioncancel"),Nd=Hn("transitionend"),Rd=new Map,qc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");qc.push("scrollEnd");function Or(t,r){Rd.set(t,r),Et(r,[t])}var Dd=new WeakMap;function vr(t,r){if(typeof t=="object"&&t!==null){var i=Dd.get(t);return i!==void 0?i:(r={value:t,source:r,stack:wa(r)},Dd.set(t,r),r)}return{value:t,source:r,stack:wa(r)}}var br=[],Gi=0,Xc=0;function Ro(){for(var t=Gi,r=Xc=Gi=0;r<t;){var i=br[r];br[r++]=null;var c=br[r];br[r++]=null;var d=br[r];br[r++]=null;var m=br[r];if(br[r++]=null,c!==null&&d!==null){var E=c.pending;E===null?d.next=d:(d.next=E.next,E.next=d),c.pending=d}m!==0&&Id(i,d,m)}}function Do(t,r,i,c){br[Gi++]=t,br[Gi++]=r,br[Gi++]=i,br[Gi++]=c,Xc|=c,t.lanes|=c,t=t.alternate,t!==null&&(t.lanes|=c)}function $c(t,r,i,c){return Do(t,r,i,c),Io(t)}function Hi(t,r){return Do(t,null,null,r),Io(t)}function Id(t,r,i){t.lanes|=i;var c=t.alternate;c!==null&&(c.lanes|=i);for(var d=!1,m=t.return;m!==null;)m.childLanes|=i,c=m.alternate,c!==null&&(c.childLanes|=i),m.tag===22&&(t=m.stateNode,t===null||t._visibility&1||(d=!0)),t=m,m=m.return;return t.tag===3?(m=t.stateNode,d&&r!==null&&(d=31-pt(i),t=m.hiddenUpdates,c=t[d],c===null?t[d]=[r]:c.push(r),r.lane=i|536870912),m):null}function Io(t){if(50<Kl)throw Kl=0,ef=null,Error(s(185));for(var r=t.return;r!==null;)t=r,r=t.return;return t.tag===3?t.stateNode:null}var Yi={};function ly(t,r,i,c){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $a(t,r,i,c){return new ly(t,r,i,c)}function Wc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ys(t,r){var i=t.alternate;return i===null?(i=$a(t.tag,r,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=r,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&65011712,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,r=t.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i.refCleanup=t.refCleanup,i}function _d(t,r){t.flags&=65011714;var i=t.alternate;return i===null?(t.childLanes=0,t.lanes=r,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,t.type=i.type,r=i.dependencies,t.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t}function _o(t,r,i,c,d,m){var E=0;if(c=t,typeof t=="function")Wc(t)&&(E=1);else if(typeof t=="string")E=c1(t,i,Pe.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case le:return t=$a(31,i,r,d),t.elementType=le,t.lanes=m,t;case T:return bi(i.children,d,m,r);case M:E=8,d|=24;break;case R:return t=$a(12,i,r,d|2),t.elementType=R,t.lanes=m,t;case k:return t=$a(13,i,r,d),t.elementType=k,t.lanes=m,t;case G:return t=$a(19,i,r,d),t.elementType=G,t.lanes=m,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case I:case A:E=10;break e;case Q:E=9;break e;case _:E=11;break e;case F:E=14;break e;case K:E=16,c=null;break e}E=29,i=Error(s(130,t===null?"null":typeof t,"")),c=null}return r=$a(E,i,r,d),r.elementType=t,r.type=c,r.lanes=m,r}function bi(t,r,i,c){return t=$a(7,t,c,r),t.lanes=i,t}function Zc(t,r,i){return t=$a(6,t,null,r),t.lanes=i,t}function Qc(t,r,i){return r=$a(4,t.children!==null?t.children:[],t.key,r),r.lanes=i,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}var Vi=[],qi=0,Oo=null,Lo=0,xr=[],Sr=0,xi=null,vs=1,bs="";function Si(t,r){Vi[qi++]=Lo,Vi[qi++]=Oo,Oo=t,Lo=r}function Od(t,r,i){xr[Sr++]=vs,xr[Sr++]=bs,xr[Sr++]=xi,xi=t;var c=vs;t=bs;var d=32-pt(c)-1;c&=~(1<<d),i+=1;var m=32-pt(r)+d;if(30<m){var E=d-d%5;m=(c&(1<<E)-1).toString(32),c>>=E,d-=E,vs=1<<32-pt(r)+d|i<<d|c,bs=m+t}else vs=1<<m|i<<d|c,bs=t}function Kc(t){t.return!==null&&(Si(t,1),Od(t,1,0))}function Jc(t){for(;t===Oo;)Oo=Vi[--qi],Vi[qi]=null,Lo=Vi[--qi],Vi[qi]=null;for(;t===xi;)xi=xr[--Sr],xr[Sr]=null,bs=xr[--Sr],xr[Sr]=null,vs=xr[--Sr],xr[Sr]=null}var Ca=null,Dn=null,Wt=!1,wi=null,Jr=!1,eu=Error(s(519));function Ei(t){var r=Error(s(418,""));throw Rl(vr(r,t)),eu}function Ld(t){var r=t.stateNode,i=t.type,c=t.memoizedProps;switch(r[un]=t,r[tn]=c,i){case"dialog":jt("cancel",r),jt("close",r);break;case"iframe":case"object":case"embed":jt("load",r);break;case"video":case"audio":for(i=0;i<eo.length;i++)jt(eo[i],r);break;case"source":jt("error",r);break;case"img":case"image":case"link":jt("error",r),jt("load",r);break;case"details":jt("toggle",r);break;case"input":jt("invalid",r),fs(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),Xr(r);break;case"select":jt("invalid",r);break;case"textarea":jt("invalid",r),kr(r,c.value,c.defaultValue,c.children),Xr(r)}i=c.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||r.textContent===""+i||c.suppressHydrationWarning===!0||Kh(r.textContent,i)?(c.popover!=null&&(jt("beforetoggle",r),jt("toggle",r)),c.onScroll!=null&&jt("scroll",r),c.onScrollEnd!=null&&jt("scrollend",r),c.onClick!=null&&(r.onclick=mc),r=!0):r=!1,r||Ei(t)}function jd(t){for(Ca=t.return;Ca;)switch(Ca.tag){case 5:case 13:Jr=!1;return;case 27:case 3:Jr=!0;return;default:Ca=Ca.return}}function kl(t){if(t!==Ca)return!1;if(!Wt)return jd(t),Wt=!0,!1;var r=t.tag,i;if((i=r!==3&&r!==27)&&((i=r===5)&&(i=t.type,i=!(i!=="form"&&i!=="button")||yf(t.type,t.memoizedProps)),i=!i),i&&Dn&&Ei(t),jd(t),r===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8)if(i=t.data,i==="/$"){if(r===0){Dn=jr(t.nextSibling);break e}r--}else i!=="$"&&i!=="$!"&&i!=="$?"||r++;t=t.nextSibling}Dn=null}}else r===27?(r=Dn,ni(t.type)?(t=Sf,Sf=null,Dn=t):Dn=r):Dn=Ca?jr(t.stateNode.nextSibling):null;return!0}function Nl(){Dn=Ca=null,Wt=!1}function Fd(){var t=wi;return t!==null&&(Oa===null?Oa=t:Oa.push.apply(Oa,t),wi=null),t}function Rl(t){wi===null?wi=[t]:wi.push(t)}var tu=$(null),Ai=null,xs=null;function zs(t,r,i){Ce(tu,r._currentValue),r._currentValue=i}function Ss(t){t._currentValue=tu.current,he(tu)}function nu(t,r,i){for(;t!==null;){var c=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),t===i)break;t=t.return}}function au(t,r,i,c){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var m=d.dependencies;if(m!==null){var E=d.child;m=m.firstContext;e:for(;m!==null;){var j=m;m=d;for(var se=0;se<r.length;se++)if(j.context===r[se]){m.lanes|=i,j=m.alternate,j!==null&&(j.lanes|=i),nu(m.return,i,t),c||(E=null);break e}m=j.next}}else if(d.tag===18){if(E=d.return,E===null)throw Error(s(341));E.lanes|=i,m=E.alternate,m!==null&&(m.lanes|=i),nu(E,i,t),E=null}else E=d.child;if(E!==null)E.return=d;else for(E=d;E!==null;){if(E===t){E=null;break}if(d=E.sibling,d!==null){d.return=E.return,E=d;break}E=E.return}d=E}}function Dl(t,r,i,c){t=null;for(var d=r,m=!1;d!==null;){if(!m){if((d.flags&524288)!==0)m=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var E=d.alternate;if(E===null)throw Error(s(387));if(E=E.memoizedProps,E!==null){var j=d.type;It(d.pendingProps.value,E.value)||(t!==null?t.push(j):t=[j])}}else if(d===wt.current){if(E=d.alternate,E===null)throw Error(s(387));E.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push(io):t=[io])}d=d.return}t!==null&&au(r,t,i,c),r.flags|=262144}function jo(t){for(t=t.firstContext;t!==null;){if(!It(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Ti(t){Ai=t,xs=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ya(t){return Ud(Ai,t)}function Fo(t,r){return Ai===null&&Ti(t),Ud(t,r)}function Ud(t,r){var i=r._currentValue;if(r={context:r,memoizedValue:i,next:null},xs===null){if(t===null)throw Error(s(308));xs=r,t.dependencies={lanes:0,firstContext:r},t.flags|=524288}else xs=xs.next=r;return i}var oy=typeof AbortController<"u"?AbortController:function(){var t=[],r=this.signal={aborted:!1,addEventListener:function(i,c){t.push(c)}};this.abort=function(){r.aborted=!0,t.forEach(function(i){return i()})}},cy=n.unstable_scheduleCallback,uy=n.unstable_NormalPriority,Kn={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ru(){return{controller:new oy,data:new Map,refCount:0}}function Il(t){t.refCount--,t.refCount===0&&cy(uy,function(){t.controller.abort()})}var _l=null,su=0,Xi=0,$i=null;function fy(t,r){if(_l===null){var i=_l=[];su=0,Xi=of(),$i={status:"pending",value:void 0,then:function(c){i.push(c)}}}return su++,r.then(Pd,Pd),r}function Pd(){if(--su===0&&_l!==null){$i!==null&&($i.status="fulfilled");var t=_l;_l=null,Xi=0,$i=null;for(var r=0;r<t.length;r++)(0,t[r])()}}function dy(t,r){var i=[],c={status:"pending",value:null,reason:null,then:function(d){i.push(d)}};return t.then(function(){c.status="fulfilled",c.value=r;for(var d=0;d<i.length;d++)(0,i[d])(r)},function(d){for(c.status="rejected",c.reason=d,d=0;d<i.length;d++)(0,i[d])(void 0)}),c}var Bd=z.S;z.S=function(t,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&fy(t,r),Bd!==null&&Bd(t,r)};var Ci=$(null);function iu(){var t=Ci.current;return t!==null?t:gn.pooledCache}function Uo(t,r){r===null?Ce(Ci,Ci.current):Ce(Ci,r.pool)}function zd(){var t=iu();return t===null?null:{parent:Kn._currentValue,pool:t}}var Ol=Error(s(460)),Gd=Error(s(474)),Po=Error(s(542)),lu={then:function(){}};function Hd(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Bo(){}function Yd(t,r,i){switch(i=t[i],i===void 0?t.push(r):i!==r&&(r.then(Bo,Bo),r=i),r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,qd(t),t;default:if(typeof r.status=="string")r.then(Bo,Bo);else{if(t=gn,t!==null&&100<t.shellSuspendCounter)throw Error(s(482));t=r,t.status="pending",t.then(function(c){if(r.status==="pending"){var d=r;d.status="fulfilled",d.value=c}},function(c){if(r.status==="pending"){var d=r;d.status="rejected",d.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,qd(t),t}throw Ll=r,Ol}}var Ll=null;function Vd(){if(Ll===null)throw Error(s(459));var t=Ll;return Ll=null,t}function qd(t){if(t===Ol||t===Po)throw Error(s(483))}var Gs=!1;function ou(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function cu(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Hs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ys(t,r,i){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,(Jt&2)!==0){var d=c.pending;return d===null?r.next=r:(r.next=d.next,d.next=r),c.pending=r,r=Io(t),Id(t,null,i),r}return Do(t,c,r,i),Io(t)}function jl(t,r,i){if(r=r.updateQueue,r!==null&&(r=r.shared,(i&4194048)!==0)){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Pi(t,i)}}function uu(t,r){var i=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,i===c)){var d=null,m=null;if(i=i.firstBaseUpdate,i!==null){do{var E={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};m===null?d=m=E:m=m.next=E,i=i.next}while(i!==null);m===null?d=m=r:m=m.next=r}else d=m=r;i={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:c.shared,callbacks:c.callbacks},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=r:t.next=r,i.lastBaseUpdate=r}var fu=!1;function Fl(){if(fu){var t=$i;if(t!==null)throw t}}function Ul(t,r,i,c){fu=!1;var d=t.updateQueue;Gs=!1;var m=d.firstBaseUpdate,E=d.lastBaseUpdate,j=d.shared.pending;if(j!==null){d.shared.pending=null;var se=j,ve=se.next;se.next=null,E===null?m=ve:E.next=ve,E=se;var Me=t.alternate;Me!==null&&(Me=Me.updateQueue,j=Me.lastBaseUpdate,j!==E&&(j===null?Me.firstBaseUpdate=ve:j.next=ve,Me.lastBaseUpdate=se))}if(m!==null){var Ie=d.baseState;E=0,Me=ve=se=null,j=m;do{var be=j.lane&-536870913,Se=be!==j.lane;if(Se?(Bt&be)===be:(c&be)===be){be!==0&&be===Xi&&(fu=!0),Me!==null&&(Me=Me.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});e:{var bt=t,mt=j;be=r;var on=i;switch(mt.tag){case 1:if(bt=mt.payload,typeof bt=="function"){Ie=bt.call(on,Ie,be);break e}Ie=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=mt.payload,be=typeof bt=="function"?bt.call(on,Ie,be):bt,be==null)break e;Ie=v({},Ie,be);break e;case 2:Gs=!0}}be=j.callback,be!==null&&(t.flags|=64,Se&&(t.flags|=8192),Se=d.callbacks,Se===null?d.callbacks=[be]:Se.push(be))}else Se={lane:be,tag:j.tag,payload:j.payload,callback:j.callback,next:null},Me===null?(ve=Me=Se,se=Ie):Me=Me.next=Se,E|=be;if(j=j.next,j===null){if(j=d.shared.pending,j===null)break;Se=j,j=Se.next,Se.next=null,d.lastBaseUpdate=Se,d.shared.pending=null}}while(!0);Me===null&&(se=Ie),d.baseState=se,d.firstBaseUpdate=ve,d.lastBaseUpdate=Me,m===null&&(d.shared.lanes=0),Ks|=E,t.lanes=E,t.memoizedState=Ie}}function Xd(t,r){if(typeof t!="function")throw Error(s(191,t));t.call(r)}function $d(t,r){var i=t.callbacks;if(i!==null)for(t.callbacks=null,t=0;t<i.length;t++)Xd(i[t],r)}var Wi=$(null),zo=$(0);function Wd(t,r){t=ks,Ce(zo,t),Ce(Wi,r),ks=t|r.baseLanes}function du(){Ce(zo,ks),Ce(Wi,Wi.current)}function pu(){ks=zo.current,he(Wi),he(zo)}var Vs=0,_t=null,sn=null,Yn=null,Go=!1,Zi=!1,Mi=!1,Ho=0,Pl=0,Qi=null,py=0;function Fn(){throw Error(s(321))}function hu(t,r){if(r===null)return!1;for(var i=0;i<r.length&&i<t.length;i++)if(!It(t[i],r[i]))return!1;return!0}function mu(t,r,i,c,d,m){return Vs=m,_t=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,z.H=t===null||t.memoizedState===null?Ip:_p,Mi=!1,m=i(c,d),Mi=!1,Zi&&(m=Qd(r,i,c,d)),Zd(t),m}function Zd(t){z.H=Wo;var r=sn!==null&&sn.next!==null;if(Vs=0,Yn=sn=_t=null,Go=!1,Pl=0,Qi=null,r)throw Error(s(300));t===null||ra||(t=t.dependencies,t!==null&&jo(t)&&(ra=!0))}function Qd(t,r,i,c){_t=t;var d=0;do{if(Zi&&(Qi=null),Pl=0,Zi=!1,25<=d)throw Error(s(301));if(d+=1,Yn=sn=null,t.updateQueue!=null){var m=t.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}z.H=xy,m=r(i,c)}while(Zi);return m}function hy(){var t=z.H,r=t.useState()[0];return r=typeof r.then=="function"?Bl(r):r,t=t.useState()[0],(sn!==null?sn.memoizedState:null)!==t&&(_t.flags|=1024),r}function gu(){var t=Ho!==0;return Ho=0,t}function yu(t,r,i){r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~i}function vu(t){if(Go){for(t=t.memoizedState;t!==null;){var r=t.queue;r!==null&&(r.pending=null),t=t.next}Go=!1}Vs=0,Yn=sn=_t=null,Zi=!1,Pl=Ho=0,Qi=null}function Ia(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yn===null?_t.memoizedState=Yn=t:Yn=Yn.next=t,Yn}function Vn(){if(sn===null){var t=_t.alternate;t=t!==null?t.memoizedState:null}else t=sn.next;var r=Yn===null?_t.memoizedState:Yn.next;if(r!==null)Yn=r,sn=t;else{if(t===null)throw _t.alternate===null?Error(s(467)):Error(s(310));sn=t,t={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},Yn===null?_t.memoizedState=Yn=t:Yn=Yn.next=t}return Yn}function bu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bl(t){var r=Pl;return Pl+=1,Qi===null&&(Qi=[]),t=Yd(Qi,t,r),r=_t,(Yn===null?r.memoizedState:Yn.next)===null&&(r=r.alternate,z.H=r===null||r.memoizedState===null?Ip:_p),t}function Yo(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Bl(t);if(t.$$typeof===A)return ya(t)}throw Error(s(438,String(t)))}function xu(t){var r=null,i=_t.updateQueue;if(i!==null&&(r=i.memoCache),r==null){var c=_t.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(d){return d.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),i===null&&(i=bu(),_t.updateQueue=i),i.memoCache=r,i=r.data[r.index],i===void 0)for(i=r.data[r.index]=Array(t),c=0;c<t;c++)i[c]=H;return r.index++,i}function ws(t,r){return typeof r=="function"?r(t):r}function Vo(t){var r=Vn();return Su(r,sn,t)}function Su(t,r,i){var c=t.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=i;var d=t.baseQueue,m=c.pending;if(m!==null){if(d!==null){var E=d.next;d.next=m.next,m.next=E}r.baseQueue=d=m,c.pending=null}if(m=t.baseState,d===null)t.memoizedState=m;else{r=d.next;var j=E=null,se=null,ve=r,Me=!1;do{var Ie=ve.lane&-536870913;if(Ie!==ve.lane?(Bt&Ie)===Ie:(Vs&Ie)===Ie){var be=ve.revertLane;if(be===0)se!==null&&(se=se.next={lane:0,revertLane:0,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),Ie===Xi&&(Me=!0);else if((Vs&be)===be){ve=ve.next,be===Xi&&(Me=!0);continue}else Ie={lane:0,revertLane:ve.revertLane,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},se===null?(j=se=Ie,E=m):se=se.next=Ie,_t.lanes|=be,Ks|=be;Ie=ve.action,Mi&&i(m,Ie),m=ve.hasEagerState?ve.eagerState:i(m,Ie)}else be={lane:Ie,revertLane:ve.revertLane,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null},se===null?(j=se=be,E=m):se=se.next=be,_t.lanes|=Ie,Ks|=Ie;ve=ve.next}while(ve!==null&&ve!==r);if(se===null?E=m:se.next=j,!It(m,t.memoizedState)&&(ra=!0,Me&&(i=$i,i!==null)))throw i;t.memoizedState=m,t.baseState=E,t.baseQueue=se,c.lastRenderedState=m}return d===null&&(c.lanes=0),[t.memoizedState,c.dispatch]}function wu(t){var r=Vn(),i=r.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=t;var c=i.dispatch,d=i.pending,m=r.memoizedState;if(d!==null){i.pending=null;var E=d=d.next;do m=t(m,E.action),E=E.next;while(E!==d);It(m,r.memoizedState)||(ra=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),i.lastRenderedState=m}return[m,c]}function Kd(t,r,i){var c=_t,d=Vn(),m=Wt;if(m){if(i===void 0)throw Error(s(407));i=i()}else i=r();var E=!It((sn||d).memoizedState,i);E&&(d.memoizedState=i,ra=!0),d=d.queue;var j=tp.bind(null,c,d,t);if(zl(2048,8,j,[t]),d.getSnapshot!==r||E||Yn!==null&&Yn.memoizedState.tag&1){if(c.flags|=2048,Ki(9,qo(),ep.bind(null,c,d,i,r),null),gn===null)throw Error(s(349));m||(Vs&124)!==0||Jd(c,r,i)}return i}function Jd(t,r,i){t.flags|=16384,t={getSnapshot:r,value:i},r=_t.updateQueue,r===null?(r=bu(),_t.updateQueue=r,r.stores=[t]):(i=r.stores,i===null?r.stores=[t]:i.push(t))}function ep(t,r,i,c){r.value=i,r.getSnapshot=c,np(r)&&ap(t)}function tp(t,r,i){return i(function(){np(r)&&ap(t)})}function np(t){var r=t.getSnapshot;t=t.value;try{var i=r();return!It(t,i)}catch{return!0}}function ap(t){var r=Hi(t,2);r!==null&&Ja(r,t,2)}function Eu(t){var r=Ia();if(typeof t=="function"){var i=t;if(t=i(),Mi){$t(!0);try{i()}finally{$t(!1)}}}return r.memoizedState=r.baseState=t,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ws,lastRenderedState:t},r}function rp(t,r,i,c){return t.baseState=i,Su(t,sn,typeof c=="function"?c:ws)}function my(t,r,i,c,d){if($o(t))throw Error(s(485));if(t=r.action,t!==null){var m={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){m.listeners.push(E)}};z.T!==null?i(!0):m.isTransition=!1,c(m),i=r.pending,i===null?(m.next=r.pending=m,sp(r,m)):(m.next=i.next,r.pending=i.next=m)}}function sp(t,r){var i=r.action,c=r.payload,d=t.state;if(r.isTransition){var m=z.T,E={};z.T=E;try{var j=i(d,c),se=z.S;se!==null&&se(E,j),ip(t,r,j)}catch(ve){Au(t,r,ve)}finally{z.T=m}}else try{m=i(d,c),ip(t,r,m)}catch(ve){Au(t,r,ve)}}function ip(t,r,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(c){lp(t,r,c)},function(c){return Au(t,r,c)}):lp(t,r,i)}function lp(t,r,i){r.status="fulfilled",r.value=i,op(r),t.state=i,r=t.pending,r!==null&&(i=r.next,i===r?t.pending=null:(i=i.next,r.next=i,sp(t,i)))}function Au(t,r,i){var c=t.pending;if(t.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=i,op(r),r=r.next;while(r!==c)}t.action=null}function op(t){t=t.listeners;for(var r=0;r<t.length;r++)(0,t[r])()}function cp(t,r){return r}function up(t,r){if(Wt){var i=gn.formState;if(i!==null){e:{var c=_t;if(Wt){if(Dn){t:{for(var d=Dn,m=Jr;d.nodeType!==8;){if(!m){d=null;break t}if(d=jr(d.nextSibling),d===null){d=null;break t}}m=d.data,d=m==="F!"||m==="F"?d:null}if(d){Dn=jr(d.nextSibling),c=d.data==="F!";break e}}Ei(c)}c=!1}c&&(r=i[0])}}return i=Ia(),i.memoizedState=i.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cp,lastRenderedState:r},i.queue=c,i=Np.bind(null,_t,c),c.dispatch=i,c=Eu(!1),m=Nu.bind(null,_t,!1,c.queue),c=Ia(),d={state:r,dispatch:null,action:t,pending:null},c.queue=d,i=my.bind(null,_t,d,m,i),d.dispatch=i,c.memoizedState=t,[r,i,!1]}function fp(t){var r=Vn();return dp(r,sn,t)}function dp(t,r,i){if(r=Su(t,r,cp)[0],t=Vo(ws)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Bl(r)}catch(E){throw E===Ol?Po:E}else c=r;r=Vn();var d=r.queue,m=d.dispatch;return i!==r.memoizedState&&(_t.flags|=2048,Ki(9,qo(),gy.bind(null,d,i),null)),[c,m,t]}function gy(t,r){t.action=r}function pp(t){var r=Vn(),i=sn;if(i!==null)return dp(r,i,t);Vn(),r=r.memoizedState,i=Vn();var c=i.queue.dispatch;return i.memoizedState=t,[r,c,!1]}function Ki(t,r,i,c){return t={tag:t,create:i,deps:c,inst:r,next:null},r=_t.updateQueue,r===null&&(r=bu(),_t.updateQueue=r),i=r.lastEffect,i===null?r.lastEffect=t.next=t:(c=i.next,i.next=t,t.next=c,r.lastEffect=t),t}function qo(){return{destroy:void 0,resource:void 0}}function hp(){return Vn().memoizedState}function Xo(t,r,i,c){var d=Ia();c=c===void 0?null:c,_t.flags|=t,d.memoizedState=Ki(1|r,qo(),i,c)}function zl(t,r,i,c){var d=Vn();c=c===void 0?null:c;var m=d.memoizedState.inst;sn!==null&&c!==null&&hu(c,sn.memoizedState.deps)?d.memoizedState=Ki(r,m,i,c):(_t.flags|=t,d.memoizedState=Ki(1|r,m,i,c))}function mp(t,r){Xo(8390656,8,t,r)}function gp(t,r){zl(2048,8,t,r)}function yp(t,r){return zl(4,2,t,r)}function vp(t,r){return zl(4,4,t,r)}function bp(t,r){if(typeof r=="function"){t=t();var i=r(t);return function(){typeof i=="function"?i():r(null)}}if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function xp(t,r,i){i=i!=null?i.concat([t]):null,zl(4,4,bp.bind(null,r,t),i)}function Tu(){}function Sp(t,r){var i=Vn();r=r===void 0?null:r;var c=i.memoizedState;return r!==null&&hu(r,c[1])?c[0]:(i.memoizedState=[t,r],t)}function wp(t,r){var i=Vn();r=r===void 0?null:r;var c=i.memoizedState;if(r!==null&&hu(r,c[1]))return c[0];if(c=t(),Mi){$t(!0);try{t()}finally{$t(!1)}}return i.memoizedState=[c,r],c}function Cu(t,r,i){return i===void 0||(Vs&1073741824)!==0?t.memoizedState=r:(t.memoizedState=i,t=Th(),_t.lanes|=t,Ks|=t,i)}function Ep(t,r,i,c){return It(i,r)?i:Wi.current!==null?(t=Cu(t,i,c),It(t,r)||(ra=!0),t):(Vs&42)===0?(ra=!0,t.memoizedState=i):(t=Th(),_t.lanes|=t,Ks|=t,r)}function Ap(t,r,i,c,d){var m=J.p;J.p=m!==0&&8>m?m:8;var E=z.T,j={};z.T=j,Nu(t,!1,r,i);try{var se=d(),ve=z.S;if(ve!==null&&ve(j,se),se!==null&&typeof se=="object"&&typeof se.then=="function"){var Me=dy(se,c);Gl(t,r,Me,Ka(t))}else Gl(t,r,c,Ka(t))}catch(Ie){Gl(t,r,{then:function(){},status:"rejected",reason:Ie},Ka())}finally{J.p=m,z.T=E}}function yy(){}function Mu(t,r,i,c){if(t.tag!==5)throw Error(s(476));var d=Tp(t).queue;Ap(t,d,r,pe,i===null?yy:function(){return Cp(t),i(c)})}function Tp(t){var r=t.memoizedState;if(r!==null)return r;r={memoizedState:pe,baseState:pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ws,lastRenderedState:pe},next:null};var i={};return r.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ws,lastRenderedState:i},next:null},t.memoizedState=r,t=t.alternate,t!==null&&(t.memoizedState=r),r}function Cp(t){var r=Tp(t).next.queue;Gl(t,r,{},Ka())}function ku(){return ya(io)}function Mp(){return Vn().memoizedState}function kp(){return Vn().memoizedState}function vy(t){for(var r=t.return;r!==null;){switch(r.tag){case 24:case 3:var i=Ka();t=Hs(i);var c=Ys(r,t,i);c!==null&&(Ja(c,r,i),jl(c,r,i)),r={cache:ru()},t.payload=r;return}r=r.return}}function by(t,r,i){var c=Ka();i={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},$o(t)?Rp(r,i):(i=$c(t,r,i,c),i!==null&&(Ja(i,t,c),Dp(i,r,c)))}function Np(t,r,i){var c=Ka();Gl(t,r,i,c)}function Gl(t,r,i,c){var d={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if($o(t))Rp(r,d);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var E=r.lastRenderedState,j=m(E,i);if(d.hasEagerState=!0,d.eagerState=j,It(j,E))return Do(t,r,d,0),gn===null&&Ro(),!1}catch{}if(i=$c(t,r,d,c),i!==null)return Ja(i,t,c),Dp(i,r,c),!0}return!1}function Nu(t,r,i,c){if(c={lane:2,revertLane:of(),action:c,hasEagerState:!1,eagerState:null,next:null},$o(t)){if(r)throw Error(s(479))}else r=$c(t,i,c,2),r!==null&&Ja(r,t,2)}function $o(t){var r=t.alternate;return t===_t||r!==null&&r===_t}function Rp(t,r){Zi=Go=!0;var i=t.pending;i===null?r.next=r:(r.next=i.next,i.next=r),t.pending=r}function Dp(t,r,i){if((i&4194048)!==0){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Pi(t,i)}}var Wo={readContext:ya,use:Yo,useCallback:Fn,useContext:Fn,useEffect:Fn,useImperativeHandle:Fn,useLayoutEffect:Fn,useInsertionEffect:Fn,useMemo:Fn,useReducer:Fn,useRef:Fn,useState:Fn,useDebugValue:Fn,useDeferredValue:Fn,useTransition:Fn,useSyncExternalStore:Fn,useId:Fn,useHostTransitionStatus:Fn,useFormState:Fn,useActionState:Fn,useOptimistic:Fn,useMemoCache:Fn,useCacheRefresh:Fn},Ip={readContext:ya,use:Yo,useCallback:function(t,r){return Ia().memoizedState=[t,r===void 0?null:r],t},useContext:ya,useEffect:mp,useImperativeHandle:function(t,r,i){i=i!=null?i.concat([t]):null,Xo(4194308,4,bp.bind(null,r,t),i)},useLayoutEffect:function(t,r){return Xo(4194308,4,t,r)},useInsertionEffect:function(t,r){Xo(4,2,t,r)},useMemo:function(t,r){var i=Ia();r=r===void 0?null:r;var c=t();if(Mi){$t(!0);try{t()}finally{$t(!1)}}return i.memoizedState=[c,r],c},useReducer:function(t,r,i){var c=Ia();if(i!==void 0){var d=i(r);if(Mi){$t(!0);try{i(r)}finally{$t(!1)}}}else d=r;return c.memoizedState=c.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},c.queue=t,t=t.dispatch=by.bind(null,_t,t),[c.memoizedState,t]},useRef:function(t){var r=Ia();return t={current:t},r.memoizedState=t},useState:function(t){t=Eu(t);var r=t.queue,i=Np.bind(null,_t,r);return r.dispatch=i,[t.memoizedState,i]},useDebugValue:Tu,useDeferredValue:function(t,r){var i=Ia();return Cu(i,t,r)},useTransition:function(){var t=Eu(!1);return t=Ap.bind(null,_t,t.queue,!0,!1),Ia().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,r,i){var c=_t,d=Ia();if(Wt){if(i===void 0)throw Error(s(407));i=i()}else{if(i=r(),gn===null)throw Error(s(349));(Bt&124)!==0||Jd(c,r,i)}d.memoizedState=i;var m={value:i,getSnapshot:r};return d.queue=m,mp(tp.bind(null,c,m,t),[t]),c.flags|=2048,Ki(9,qo(),ep.bind(null,c,m,i,r),null),i},useId:function(){var t=Ia(),r=gn.identifierPrefix;if(Wt){var i=bs,c=vs;i=(c&~(1<<32-pt(c)-1)).toString(32)+i,r=""+r+"R"+i,i=Ho++,0<i&&(r+="H"+i.toString(32)),r+=""}else i=py++,r=""+r+"r"+i.toString(32)+"";return t.memoizedState=r},useHostTransitionStatus:ku,useFormState:up,useActionState:up,useOptimistic:function(t){var r=Ia();r.memoizedState=r.baseState=t;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=i,r=Nu.bind(null,_t,!0,i),i.dispatch=r,[t,r]},useMemoCache:xu,useCacheRefresh:function(){return Ia().memoizedState=vy.bind(null,_t)}},_p={readContext:ya,use:Yo,useCallback:Sp,useContext:ya,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:wp,useReducer:Vo,useRef:hp,useState:function(){return Vo(ws)},useDebugValue:Tu,useDeferredValue:function(t,r){var i=Vn();return Ep(i,sn.memoizedState,t,r)},useTransition:function(){var t=Vo(ws)[0],r=Vn().memoizedState;return[typeof t=="boolean"?t:Bl(t),r]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:ku,useFormState:fp,useActionState:fp,useOptimistic:function(t,r){var i=Vn();return rp(i,sn,t,r)},useMemoCache:xu,useCacheRefresh:kp},xy={readContext:ya,use:Yo,useCallback:Sp,useContext:ya,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:wp,useReducer:wu,useRef:hp,useState:function(){return wu(ws)},useDebugValue:Tu,useDeferredValue:function(t,r){var i=Vn();return sn===null?Cu(i,t,r):Ep(i,sn.memoizedState,t,r)},useTransition:function(){var t=wu(ws)[0],r=Vn().memoizedState;return[typeof t=="boolean"?t:Bl(t),r]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:ku,useFormState:pp,useActionState:pp,useOptimistic:function(t,r){var i=Vn();return sn!==null?rp(i,sn,t,r):(i.baseState=t,[t,i.queue.dispatch])},useMemoCache:xu,useCacheRefresh:kp},Ji=null,Hl=0;function Zo(t){var r=Hl;return Hl+=1,Ji===null&&(Ji=[]),Yd(Ji,t,r)}function Yl(t,r){r=r.props.ref,t.ref=r!==void 0?r:null}function Qo(t,r){throw r.$$typeof===S?Error(s(525)):(t=Object.prototype.toString.call(r),Error(s(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t)))}function Op(t){var r=t._init;return r(t._payload)}function Lp(t){function r(de,oe){if(t){var ge=de.deletions;ge===null?(de.deletions=[oe],de.flags|=16):ge.push(oe)}}function i(de,oe){if(!t)return null;for(;oe!==null;)r(de,oe),oe=oe.sibling;return null}function c(de){for(var oe=new Map;de!==null;)de.key!==null?oe.set(de.key,de):oe.set(de.index,de),de=de.sibling;return oe}function d(de,oe){return de=ys(de,oe),de.index=0,de.sibling=null,de}function m(de,oe,ge){return de.index=ge,t?(ge=de.alternate,ge!==null?(ge=ge.index,ge<oe?(de.flags|=67108866,oe):ge):(de.flags|=67108866,oe)):(de.flags|=1048576,oe)}function E(de){return t&&de.alternate===null&&(de.flags|=67108866),de}function j(de,oe,ge,Ne){return oe===null||oe.tag!==6?(oe=Zc(ge,de.mode,Ne),oe.return=de,oe):(oe=d(oe,ge),oe.return=de,oe)}function se(de,oe,ge,Ne){var st=ge.type;return st===T?Me(de,oe,ge.props.children,Ne,ge.key):oe!==null&&(oe.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===K&&Op(st)===oe.type)?(oe=d(oe,ge.props),Yl(oe,ge),oe.return=de,oe):(oe=_o(ge.type,ge.key,ge.props,null,de.mode,Ne),Yl(oe,ge),oe.return=de,oe)}function ve(de,oe,ge,Ne){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==ge.containerInfo||oe.stateNode.implementation!==ge.implementation?(oe=Qc(ge,de.mode,Ne),oe.return=de,oe):(oe=d(oe,ge.children||[]),oe.return=de,oe)}function Me(de,oe,ge,Ne,st){return oe===null||oe.tag!==7?(oe=bi(ge,de.mode,Ne,st),oe.return=de,oe):(oe=d(oe,ge),oe.return=de,oe)}function Ie(de,oe,ge){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return oe=Zc(""+oe,de.mode,ge),oe.return=de,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case x:return ge=_o(oe.type,oe.key,oe.props,null,de.mode,ge),Yl(ge,oe),ge.return=de,ge;case b:return oe=Qc(oe,de.mode,ge),oe.return=de,oe;case K:var Ne=oe._init;return oe=Ne(oe._payload),Ie(de,oe,ge)}if(ie(oe)||V(oe))return oe=bi(oe,de.mode,ge,null),oe.return=de,oe;if(typeof oe.then=="function")return Ie(de,Zo(oe),ge);if(oe.$$typeof===A)return Ie(de,Fo(de,oe),ge);Qo(de,oe)}return null}function be(de,oe,ge,Ne){var st=oe!==null?oe.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return st!==null?null:j(de,oe,""+ge,Ne);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case x:return ge.key===st?se(de,oe,ge,Ne):null;case b:return ge.key===st?ve(de,oe,ge,Ne):null;case K:return st=ge._init,ge=st(ge._payload),be(de,oe,ge,Ne)}if(ie(ge)||V(ge))return st!==null?null:Me(de,oe,ge,Ne,null);if(typeof ge.then=="function")return be(de,oe,Zo(ge),Ne);if(ge.$$typeof===A)return be(de,oe,Fo(de,ge),Ne);Qo(de,ge)}return null}function Se(de,oe,ge,Ne,st){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return de=de.get(ge)||null,j(oe,de,""+Ne,st);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case x:return de=de.get(Ne.key===null?ge:Ne.key)||null,se(oe,de,Ne,st);case b:return de=de.get(Ne.key===null?ge:Ne.key)||null,ve(oe,de,Ne,st);case K:var Ot=Ne._init;return Ne=Ot(Ne._payload),Se(de,oe,ge,Ne,st)}if(ie(Ne)||V(Ne))return de=de.get(ge)||null,Me(oe,de,Ne,st,null);if(typeof Ne.then=="function")return Se(de,oe,ge,Zo(Ne),st);if(Ne.$$typeof===A)return Se(de,oe,ge,Fo(oe,Ne),st);Qo(oe,Ne)}return null}function bt(de,oe,ge,Ne){for(var st=null,Ot=null,ht=oe,yt=oe=0,ia=null;ht!==null&&yt<ge.length;yt++){ht.index>yt?(ia=ht,ht=null):ia=ht.sibling;var Ht=be(de,ht,ge[yt],Ne);if(Ht===null){ht===null&&(ht=ia);break}t&&ht&&Ht.alternate===null&&r(de,ht),oe=m(Ht,oe,yt),Ot===null?st=Ht:Ot.sibling=Ht,Ot=Ht,ht=ia}if(yt===ge.length)return i(de,ht),Wt&&Si(de,yt),st;if(ht===null){for(;yt<ge.length;yt++)ht=Ie(de,ge[yt],Ne),ht!==null&&(oe=m(ht,oe,yt),Ot===null?st=ht:Ot.sibling=ht,Ot=ht);return Wt&&Si(de,yt),st}for(ht=c(ht);yt<ge.length;yt++)ia=Se(ht,de,yt,ge[yt],Ne),ia!==null&&(t&&ia.alternate!==null&&ht.delete(ia.key===null?yt:ia.key),oe=m(ia,oe,yt),Ot===null?st=ia:Ot.sibling=ia,Ot=ia);return t&&ht.forEach(function(li){return r(de,li)}),Wt&&Si(de,yt),st}function mt(de,oe,ge,Ne){if(ge==null)throw Error(s(151));for(var st=null,Ot=null,ht=oe,yt=oe=0,ia=null,Ht=ge.next();ht!==null&&!Ht.done;yt++,Ht=ge.next()){ht.index>yt?(ia=ht,ht=null):ia=ht.sibling;var li=be(de,ht,Ht.value,Ne);if(li===null){ht===null&&(ht=ia);break}t&&ht&&li.alternate===null&&r(de,ht),oe=m(li,oe,yt),Ot===null?st=li:Ot.sibling=li,Ot=li,ht=ia}if(Ht.done)return i(de,ht),Wt&&Si(de,yt),st;if(ht===null){for(;!Ht.done;yt++,Ht=ge.next())Ht=Ie(de,Ht.value,Ne),Ht!==null&&(oe=m(Ht,oe,yt),Ot===null?st=Ht:Ot.sibling=Ht,Ot=Ht);return Wt&&Si(de,yt),st}for(ht=c(ht);!Ht.done;yt++,Ht=ge.next())Ht=Se(ht,de,yt,Ht.value,Ne),Ht!==null&&(t&&Ht.alternate!==null&&ht.delete(Ht.key===null?yt:Ht.key),oe=m(Ht,oe,yt),Ot===null?st=Ht:Ot.sibling=Ht,Ot=Ht);return t&&ht.forEach(function(S1){return r(de,S1)}),Wt&&Si(de,yt),st}function on(de,oe,ge,Ne){if(typeof ge=="object"&&ge!==null&&ge.type===T&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case x:e:{for(var st=ge.key;oe!==null;){if(oe.key===st){if(st=ge.type,st===T){if(oe.tag===7){i(de,oe.sibling),Ne=d(oe,ge.props.children),Ne.return=de,de=Ne;break e}}else if(oe.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===K&&Op(st)===oe.type){i(de,oe.sibling),Ne=d(oe,ge.props),Yl(Ne,ge),Ne.return=de,de=Ne;break e}i(de,oe);break}else r(de,oe);oe=oe.sibling}ge.type===T?(Ne=bi(ge.props.children,de.mode,Ne,ge.key),Ne.return=de,de=Ne):(Ne=_o(ge.type,ge.key,ge.props,null,de.mode,Ne),Yl(Ne,ge),Ne.return=de,de=Ne)}return E(de);case b:e:{for(st=ge.key;oe!==null;){if(oe.key===st)if(oe.tag===4&&oe.stateNode.containerInfo===ge.containerInfo&&oe.stateNode.implementation===ge.implementation){i(de,oe.sibling),Ne=d(oe,ge.children||[]),Ne.return=de,de=Ne;break e}else{i(de,oe);break}else r(de,oe);oe=oe.sibling}Ne=Qc(ge,de.mode,Ne),Ne.return=de,de=Ne}return E(de);case K:return st=ge._init,ge=st(ge._payload),on(de,oe,ge,Ne)}if(ie(ge))return bt(de,oe,ge,Ne);if(V(ge)){if(st=V(ge),typeof st!="function")throw Error(s(150));return ge=st.call(ge),mt(de,oe,ge,Ne)}if(typeof ge.then=="function")return on(de,oe,Zo(ge),Ne);if(ge.$$typeof===A)return on(de,oe,Fo(de,ge),Ne);Qo(de,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint"?(ge=""+ge,oe!==null&&oe.tag===6?(i(de,oe.sibling),Ne=d(oe,ge),Ne.return=de,de=Ne):(i(de,oe),Ne=Zc(ge,de.mode,Ne),Ne.return=de,de=Ne),E(de)):i(de,oe)}return function(de,oe,ge,Ne){try{Hl=0;var st=on(de,oe,ge,Ne);return Ji=null,st}catch(ht){if(ht===Ol||ht===Po)throw ht;var Ot=$a(29,ht,null,de.mode);return Ot.lanes=Ne,Ot.return=de,Ot}}}var el=Lp(!0),jp=Lp(!1),wr=$(null),es=null;function qs(t){var r=t.alternate;Ce(Jn,Jn.current&1),Ce(wr,t),es===null&&(r===null||Wi.current!==null||r.memoizedState!==null)&&(es=t)}function Fp(t){if(t.tag===22){if(Ce(Jn,Jn.current),Ce(wr,t),es===null){var r=t.alternate;r!==null&&r.memoizedState!==null&&(es=t)}}else Xs()}function Xs(){Ce(Jn,Jn.current),Ce(wr,wr.current)}function Es(t){he(wr),es===t&&(es=null),he(Jn)}var Jn=$(0);function Ko(t){for(var r=t;r!==null;){if(r.tag===13){var i=r.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||xf(i)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function Ru(t,r,i,c){r=t.memoizedState,i=i(c,r),i=i==null?r:v({},r,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Du={enqueueSetState:function(t,r,i){t=t._reactInternals;var c=Ka(),d=Hs(c);d.payload=r,i!=null&&(d.callback=i),r=Ys(t,d,c),r!==null&&(Ja(r,t,c),jl(r,t,c))},enqueueReplaceState:function(t,r,i){t=t._reactInternals;var c=Ka(),d=Hs(c);d.tag=1,d.payload=r,i!=null&&(d.callback=i),r=Ys(t,d,c),r!==null&&(Ja(r,t,c),jl(r,t,c))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var i=Ka(),c=Hs(i);c.tag=2,r!=null&&(c.callback=r),r=Ys(t,c,i),r!==null&&(Ja(r,t,i),jl(r,t,i))}};function Up(t,r,i,c,d,m,E){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,m,E):r.prototype&&r.prototype.isPureReactComponent?!Pt(i,c)||!Pt(d,m):!0}function Pp(t,r,i,c){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(i,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(i,c),r.state!==t&&Du.enqueueReplaceState(r,r.state,null)}function ki(t,r){var i=r;if("ref"in r){i={};for(var c in r)c!=="ref"&&(i[c]=r[c])}if(t=t.defaultProps){i===r&&(i=v({},i));for(var d in t)i[d]===void 0&&(i[d]=t[d])}return i}var Jo=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Bp(t){Jo(t)}function zp(t){console.error(t)}function Gp(t){Jo(t)}function ec(t,r){try{var i=t.onUncaughtError;i(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function Hp(t,r,i){try{var c=t.onCaughtError;c(i.value,{componentStack:i.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Iu(t,r,i){return i=Hs(i),i.tag=3,i.payload={element:null},i.callback=function(){ec(t,r)},i}function Yp(t){return t=Hs(t),t.tag=3,t}function Vp(t,r,i,c){var d=i.type.getDerivedStateFromError;if(typeof d=="function"){var m=c.value;t.payload=function(){return d(m)},t.callback=function(){Hp(r,i,c)}}var E=i.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(t.callback=function(){Hp(r,i,c),typeof d!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var j=c.stack;this.componentDidCatch(c.value,{componentStack:j!==null?j:""})})}function Sy(t,r,i,c,d){if(i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=i.alternate,r!==null&&Dl(r,i,d,!0),i=wr.current,i!==null){switch(i.tag){case 13:return es===null?nf():i.alternate===null&&In===0&&(In=3),i.flags&=-257,i.flags|=65536,i.lanes=d,c===lu?i.flags|=16384:(r=i.updateQueue,r===null?i.updateQueue=new Set([c]):r.add(c),rf(t,c,d)),!1;case 22:return i.flags|=65536,c===lu?i.flags|=16384:(r=i.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},i.updateQueue=r):(i=r.retryQueue,i===null?r.retryQueue=new Set([c]):i.add(c)),rf(t,c,d)),!1}throw Error(s(435,i.tag))}return rf(t,c,d),nf(),!1}if(Wt)return r=wr.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=d,c!==eu&&(t=Error(s(422),{cause:c}),Rl(vr(t,i)))):(c!==eu&&(r=Error(s(423),{cause:c}),Rl(vr(r,i))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,c=vr(c,i),d=Iu(t.stateNode,c,d),uu(t,d),In!==4&&(In=2)),!1;var m=Error(s(520),{cause:c});if(m=vr(m,i),Ql===null?Ql=[m]:Ql.push(m),In!==4&&(In=2),r===null)return!0;c=vr(c,i),i=r;do{switch(i.tag){case 3:return i.flags|=65536,t=d&-d,i.lanes|=t,t=Iu(i.stateNode,c,t),uu(i,t),!1;case 1:if(r=i.type,m=i.stateNode,(i.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Js===null||!Js.has(m))))return i.flags|=65536,d&=-d,i.lanes|=d,d=Yp(d),Vp(d,t,i,c),uu(i,d),!1}i=i.return}while(i!==null);return!1}var qp=Error(s(461)),ra=!1;function ua(t,r,i,c){r.child=t===null?jp(r,null,i,c):el(r,t.child,i,c)}function Xp(t,r,i,c,d){i=i.render;var m=r.ref;if("ref"in c){var E={};for(var j in c)j!=="ref"&&(E[j]=c[j])}else E=c;return Ti(r),c=mu(t,r,i,E,m,d),j=gu(),t!==null&&!ra?(yu(t,r,d),As(t,r,d)):(Wt&&j&&Kc(r),r.flags|=1,ua(t,r,c,d),r.child)}function $p(t,r,i,c,d){if(t===null){var m=i.type;return typeof m=="function"&&!Wc(m)&&m.defaultProps===void 0&&i.compare===null?(r.tag=15,r.type=m,Wp(t,r,m,c,d)):(t=_o(i.type,null,c,r,r.mode,d),t.ref=r.ref,t.return=r,r.child=t)}if(m=t.child,!Bu(t,d)){var E=m.memoizedProps;if(i=i.compare,i=i!==null?i:Pt,i(E,c)&&t.ref===r.ref)return As(t,r,d)}return r.flags|=1,t=ys(m,c),t.ref=r.ref,t.return=r,r.child=t}function Wp(t,r,i,c,d){if(t!==null){var m=t.memoizedProps;if(Pt(m,c)&&t.ref===r.ref)if(ra=!1,r.pendingProps=c=m,Bu(t,d))(t.flags&131072)!==0&&(ra=!0);else return r.lanes=t.lanes,As(t,r,d)}return _u(t,r,i,c,d)}function Zp(t,r,i){var c=r.pendingProps,d=c.children,m=t!==null?t.memoizedState:null;if(c.mode==="hidden"){if((r.flags&128)!==0){if(c=m!==null?m.baseLanes|i:i,t!==null){for(d=r.child=t.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;r.childLanes=m&~c}else r.childLanes=0,r.child=null;return Qp(t,r,c,i)}if((i&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},t!==null&&Uo(r,m!==null?m.cachePool:null),m!==null?Wd(r,m):du(),Fp(r);else return r.lanes=r.childLanes=536870912,Qp(t,r,m!==null?m.baseLanes|i:i,i)}else m!==null?(Uo(r,m.cachePool),Wd(r,m),Xs(),r.memoizedState=null):(t!==null&&Uo(r,null),du(),Xs());return ua(t,r,d,i),r.child}function Qp(t,r,i,c){var d=iu();return d=d===null?null:{parent:Kn._currentValue,pool:d},r.memoizedState={baseLanes:i,cachePool:d},t!==null&&Uo(r,null),du(),Fp(r),t!==null&&Dl(t,r,c,!0),null}function tc(t,r){var i=r.ref;if(i===null)t!==null&&t.ref!==null&&(r.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(t===null||t.ref!==i)&&(r.flags|=4194816)}}function _u(t,r,i,c,d){return Ti(r),i=mu(t,r,i,c,void 0,d),c=gu(),t!==null&&!ra?(yu(t,r,d),As(t,r,d)):(Wt&&c&&Kc(r),r.flags|=1,ua(t,r,i,d),r.child)}function Kp(t,r,i,c,d,m){return Ti(r),r.updateQueue=null,i=Qd(r,c,i,d),Zd(t),c=gu(),t!==null&&!ra?(yu(t,r,m),As(t,r,m)):(Wt&&c&&Kc(r),r.flags|=1,ua(t,r,i,m),r.child)}function Jp(t,r,i,c,d){if(Ti(r),r.stateNode===null){var m=Yi,E=i.contextType;typeof E=="object"&&E!==null&&(m=ya(E)),m=new i(c,m),r.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Du,r.stateNode=m,m._reactInternals=r,m=r.stateNode,m.props=c,m.state=r.memoizedState,m.refs={},ou(r),E=i.contextType,m.context=typeof E=="object"&&E!==null?ya(E):Yi,m.state=r.memoizedState,E=i.getDerivedStateFromProps,typeof E=="function"&&(Ru(r,i,E,c),m.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(E=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),E!==m.state&&Du.enqueueReplaceState(m,m.state,null),Ul(r,c,m,d),Fl(),m.state=r.memoizedState),typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(t===null){m=r.stateNode;var j=r.memoizedProps,se=ki(i,j);m.props=se;var ve=m.context,Me=i.contextType;E=Yi,typeof Me=="object"&&Me!==null&&(E=ya(Me));var Ie=i.getDerivedStateFromProps;Me=typeof Ie=="function"||typeof m.getSnapshotBeforeUpdate=="function",j=r.pendingProps!==j,Me||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(j||ve!==E)&&Pp(r,m,c,E),Gs=!1;var be=r.memoizedState;m.state=be,Ul(r,c,m,d),Fl(),ve=r.memoizedState,j||be!==ve||Gs?(typeof Ie=="function"&&(Ru(r,i,Ie,c),ve=r.memoizedState),(se=Gs||Up(r,i,se,c,be,ve,E))?(Me||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(r.flags|=4194308)):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=ve),m.props=c,m.state=ve,m.context=E,c=se):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{m=r.stateNode,cu(t,r),E=r.memoizedProps,Me=ki(i,E),m.props=Me,Ie=r.pendingProps,be=m.context,ve=i.contextType,se=Yi,typeof ve=="object"&&ve!==null&&(se=ya(ve)),j=i.getDerivedStateFromProps,(ve=typeof j=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(E!==Ie||be!==se)&&Pp(r,m,c,se),Gs=!1,be=r.memoizedState,m.state=be,Ul(r,c,m,d),Fl();var Se=r.memoizedState;E!==Ie||be!==Se||Gs||t!==null&&t.dependencies!==null&&jo(t.dependencies)?(typeof j=="function"&&(Ru(r,i,j,c),Se=r.memoizedState),(Me=Gs||Up(r,i,Me,c,be,Se,se)||t!==null&&t.dependencies!==null&&jo(t.dependencies))?(ve||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(c,Se,se),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(c,Se,se)),typeof m.componentDidUpdate=="function"&&(r.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof m.componentDidUpdate!="function"||E===t.memoizedProps&&be===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||E===t.memoizedProps&&be===t.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=Se),m.props=c,m.state=Se,m.context=se,c=Me):(typeof m.componentDidUpdate!="function"||E===t.memoizedProps&&be===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||E===t.memoizedProps&&be===t.memoizedState||(r.flags|=1024),c=!1)}return m=c,tc(t,r),c=(r.flags&128)!==0,m||c?(m=r.stateNode,i=c&&typeof i.getDerivedStateFromError!="function"?null:m.render(),r.flags|=1,t!==null&&c?(r.child=el(r,t.child,null,d),r.child=el(r,null,i,d)):ua(t,r,i,d),r.memoizedState=m.state,t=r.child):t=As(t,r,d),t}function eh(t,r,i,c){return Nl(),r.flags|=256,ua(t,r,i,c),r.child}var Ou={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lu(t){return{baseLanes:t,cachePool:zd()}}function ju(t,r,i){return t=t!==null?t.childLanes&~i:0,r&&(t|=Er),t}function th(t,r,i){var c=r.pendingProps,d=!1,m=(r.flags&128)!==0,E;if((E=m)||(E=t!==null&&t.memoizedState===null?!1:(Jn.current&2)!==0),E&&(d=!0,r.flags&=-129),E=(r.flags&32)!==0,r.flags&=-33,t===null){if(Wt){if(d?qs(r):Xs(),Wt){var j=Dn,se;if(se=j){e:{for(se=j,j=Jr;se.nodeType!==8;){if(!j){j=null;break e}if(se=jr(se.nextSibling),se===null){j=null;break e}}j=se}j!==null?(r.memoizedState={dehydrated:j,treeContext:xi!==null?{id:vs,overflow:bs}:null,retryLane:536870912,hydrationErrors:null},se=$a(18,null,null,0),se.stateNode=j,se.return=r,r.child=se,Ca=r,Dn=null,se=!0):se=!1}se||Ei(r)}if(j=r.memoizedState,j!==null&&(j=j.dehydrated,j!==null))return xf(j)?r.lanes=32:r.lanes=536870912,null;Es(r)}return j=c.children,c=c.fallback,d?(Xs(),d=r.mode,j=nc({mode:"hidden",children:j},d),c=bi(c,d,i,null),j.return=r,c.return=r,j.sibling=c,r.child=j,d=r.child,d.memoizedState=Lu(i),d.childLanes=ju(t,E,i),r.memoizedState=Ou,c):(qs(r),Fu(r,j))}if(se=t.memoizedState,se!==null&&(j=se.dehydrated,j!==null)){if(m)r.flags&256?(qs(r),r.flags&=-257,r=Uu(t,r,i)):r.memoizedState!==null?(Xs(),r.child=t.child,r.flags|=128,r=null):(Xs(),d=c.fallback,j=r.mode,c=nc({mode:"visible",children:c.children},j),d=bi(d,j,i,null),d.flags|=2,c.return=r,d.return=r,c.sibling=d,r.child=c,el(r,t.child,null,i),c=r.child,c.memoizedState=Lu(i),c.childLanes=ju(t,E,i),r.memoizedState=Ou,r=d);else if(qs(r),xf(j)){if(E=j.nextSibling&&j.nextSibling.dataset,E)var ve=E.dgst;E=ve,c=Error(s(419)),c.stack="",c.digest=E,Rl({value:c,source:null,stack:null}),r=Uu(t,r,i)}else if(ra||Dl(t,r,i,!1),E=(i&t.childLanes)!==0,ra||E){if(E=gn,E!==null&&(c=i&-i,c=(c&42)!==0?1:ja(c),c=(c&(E.suspendedLanes|i))!==0?0:c,c!==0&&c!==se.retryLane))throw se.retryLane=c,Hi(t,c),Ja(E,t,c),qp;j.data==="$?"||nf(),r=Uu(t,r,i)}else j.data==="$?"?(r.flags|=192,r.child=t.child,r=null):(t=se.treeContext,Dn=jr(j.nextSibling),Ca=r,Wt=!0,wi=null,Jr=!1,t!==null&&(xr[Sr++]=vs,xr[Sr++]=bs,xr[Sr++]=xi,vs=t.id,bs=t.overflow,xi=r),r=Fu(r,c.children),r.flags|=4096);return r}return d?(Xs(),d=c.fallback,j=r.mode,se=t.child,ve=se.sibling,c=ys(se,{mode:"hidden",children:c.children}),c.subtreeFlags=se.subtreeFlags&65011712,ve!==null?d=ys(ve,d):(d=bi(d,j,i,null),d.flags|=2),d.return=r,c.return=r,c.sibling=d,r.child=c,c=d,d=r.child,j=t.child.memoizedState,j===null?j=Lu(i):(se=j.cachePool,se!==null?(ve=Kn._currentValue,se=se.parent!==ve?{parent:ve,pool:ve}:se):se=zd(),j={baseLanes:j.baseLanes|i,cachePool:se}),d.memoizedState=j,d.childLanes=ju(t,E,i),r.memoizedState=Ou,c):(qs(r),i=t.child,t=i.sibling,i=ys(i,{mode:"visible",children:c.children}),i.return=r,i.sibling=null,t!==null&&(E=r.deletions,E===null?(r.deletions=[t],r.flags|=16):E.push(t)),r.child=i,r.memoizedState=null,i)}function Fu(t,r){return r=nc({mode:"visible",children:r},t.mode),r.return=t,t.child=r}function nc(t,r){return t=$a(22,t,null,r),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Uu(t,r,i){return el(r,t.child,null,i),t=Fu(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function nh(t,r,i){t.lanes|=r;var c=t.alternate;c!==null&&(c.lanes|=r),nu(t.return,r,i)}function Pu(t,r,i,c,d){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:i,tailMode:d}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=i,m.tailMode=d)}function ah(t,r,i){var c=r.pendingProps,d=c.revealOrder,m=c.tail;if(ua(t,r,c.children,i),c=Jn.current,(c&2)!==0)c=c&1|2,r.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&nh(t,i,r);else if(t.tag===19)nh(t,i,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}switch(Ce(Jn,c),d){case"forwards":for(i=r.child,d=null;i!==null;)t=i.alternate,t!==null&&Ko(t)===null&&(d=i),i=i.sibling;i=d,i===null?(d=r.child,r.child=null):(d=i.sibling,i.sibling=null),Pu(r,!1,d,i,m);break;case"backwards":for(i=null,d=r.child,r.child=null;d!==null;){if(t=d.alternate,t!==null&&Ko(t)===null){r.child=d;break}t=d.sibling,d.sibling=i,i=d,d=t}Pu(r,!0,i,null,m);break;case"together":Pu(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function As(t,r,i){if(t!==null&&(r.dependencies=t.dependencies),Ks|=r.lanes,(i&r.childLanes)===0)if(t!==null){if(Dl(t,r,i,!1),(i&r.childLanes)===0)return null}else return null;if(t!==null&&r.child!==t.child)throw Error(s(153));if(r.child!==null){for(t=r.child,i=ys(t,t.pendingProps),r.child=i,i.return=r;t.sibling!==null;)t=t.sibling,i=i.sibling=ys(t,t.pendingProps),i.return=r;i.sibling=null}return r.child}function Bu(t,r){return(t.lanes&r)!==0?!0:(t=t.dependencies,!!(t!==null&&jo(t)))}function wy(t,r,i){switch(r.tag){case 3:dt(r,r.stateNode.containerInfo),zs(r,Kn,t.memoizedState.cache),Nl();break;case 27:case 5:Ze(r);break;case 4:dt(r,r.stateNode.containerInfo);break;case 10:zs(r,r.type,r.memoizedProps.value);break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(qs(r),r.flags|=128,null):(i&r.child.childLanes)!==0?th(t,r,i):(qs(r),t=As(t,r,i),t!==null?t.sibling:null);qs(r);break;case 19:var d=(t.flags&128)!==0;if(c=(i&r.childLanes)!==0,c||(Dl(t,r,i,!1),c=(i&r.childLanes)!==0),d){if(c)return ah(t,r,i);r.flags|=128}if(d=r.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Ce(Jn,Jn.current),c)break;return null;case 22:case 23:return r.lanes=0,Zp(t,r,i);case 24:zs(r,Kn,t.memoizedState.cache)}return As(t,r,i)}function rh(t,r,i){if(t!==null)if(t.memoizedProps!==r.pendingProps)ra=!0;else{if(!Bu(t,i)&&(r.flags&128)===0)return ra=!1,wy(t,r,i);ra=(t.flags&131072)!==0}else ra=!1,Wt&&(r.flags&1048576)!==0&&Od(r,Lo,r.index);switch(r.lanes=0,r.tag){case 16:e:{t=r.pendingProps;var c=r.elementType,d=c._init;if(c=d(c._payload),r.type=c,typeof c=="function")Wc(c)?(t=ki(c,t),r.tag=1,r=Jp(null,r,c,t,i)):(r.tag=0,r=_u(null,r,c,t,i));else{if(c!=null){if(d=c.$$typeof,d===_){r.tag=11,r=Xp(null,r,c,t,i);break e}else if(d===F){r.tag=14,r=$p(null,r,c,t,i);break e}}throw r=q(c)||c,Error(s(306,r,""))}}return r;case 0:return _u(t,r,r.type,r.pendingProps,i);case 1:return c=r.type,d=ki(c,r.pendingProps),Jp(t,r,c,d,i);case 3:e:{if(dt(r,r.stateNode.containerInfo),t===null)throw Error(s(387));c=r.pendingProps;var m=r.memoizedState;d=m.element,cu(t,r),Ul(r,c,null,i);var E=r.memoizedState;if(c=E.cache,zs(r,Kn,c),c!==m.cache&&au(r,[Kn],i,!0),Fl(),c=E.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:E.cache},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){r=eh(t,r,c,i);break e}else if(c!==d){d=vr(Error(s(424)),r),Rl(d),r=eh(t,r,c,i);break e}else for(t=r.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,Dn=jr(t.firstChild),Ca=r,Wt=!0,wi=null,Jr=!0,i=jp(r,null,c,i),r.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Nl(),c===d){r=As(t,r,i);break e}ua(t,r,c,i)}r=r.child}return r;case 26:return tc(t,r),t===null?(i=o0(r.type,null,r.pendingProps,null))?r.memoizedState=i:Wt||(i=r.type,t=r.pendingProps,c=gc(Xe.current).createElement(i),c[un]=r,c[tn]=t,da(c,i,t),yn(c),r.stateNode=c):r.memoizedState=o0(r.type,t.memoizedProps,r.pendingProps,t.memoizedState),null;case 27:return Ze(r),t===null&&Wt&&(c=r.stateNode=s0(r.type,r.pendingProps,Xe.current),Ca=r,Jr=!0,d=Dn,ni(r.type)?(Sf=d,Dn=jr(c.firstChild)):Dn=d),ua(t,r,r.pendingProps.children,i),tc(t,r),t===null&&(r.flags|=4194304),r.child;case 5:return t===null&&Wt&&((d=c=Dn)&&(c=Zy(c,r.type,r.pendingProps,Jr),c!==null?(r.stateNode=c,Ca=r,Dn=jr(c.firstChild),Jr=!1,d=!0):d=!1),d||Ei(r)),Ze(r),d=r.type,m=r.pendingProps,E=t!==null?t.memoizedProps:null,c=m.children,yf(d,m)?c=null:E!==null&&yf(d,E)&&(r.flags|=32),r.memoizedState!==null&&(d=mu(t,r,hy,null,null,i),io._currentValue=d),tc(t,r),ua(t,r,c,i),r.child;case 6:return t===null&&Wt&&((t=i=Dn)&&(i=Qy(i,r.pendingProps,Jr),i!==null?(r.stateNode=i,Ca=r,Dn=null,t=!0):t=!1),t||Ei(r)),null;case 13:return th(t,r,i);case 4:return dt(r,r.stateNode.containerInfo),c=r.pendingProps,t===null?r.child=el(r,null,c,i):ua(t,r,c,i),r.child;case 11:return Xp(t,r,r.type,r.pendingProps,i);case 7:return ua(t,r,r.pendingProps,i),r.child;case 8:return ua(t,r,r.pendingProps.children,i),r.child;case 12:return ua(t,r,r.pendingProps.children,i),r.child;case 10:return c=r.pendingProps,zs(r,r.type,c.value),ua(t,r,c.children,i),r.child;case 9:return d=r.type._context,c=r.pendingProps.children,Ti(r),d=ya(d),c=c(d),r.flags|=1,ua(t,r,c,i),r.child;case 14:return $p(t,r,r.type,r.pendingProps,i);case 15:return Wp(t,r,r.type,r.pendingProps,i);case 19:return ah(t,r,i);case 31:return c=r.pendingProps,i=r.mode,c={mode:c.mode,children:c.children},t===null?(i=nc(c,i),i.ref=r.ref,r.child=i,i.return=r,r=i):(i=ys(t.child,c),i.ref=r.ref,r.child=i,i.return=r,r=i),r;case 22:return Zp(t,r,i);case 24:return Ti(r),c=ya(Kn),t===null?(d=iu(),d===null&&(d=gn,m=ru(),d.pooledCache=m,m.refCount++,m!==null&&(d.pooledCacheLanes|=i),d=m),r.memoizedState={parent:c,cache:d},ou(r),zs(r,Kn,d)):((t.lanes&i)!==0&&(cu(t,r),Ul(r,null,null,i),Fl()),d=t.memoizedState,m=r.memoizedState,d.parent!==c?(d={parent:c,cache:c},r.memoizedState=d,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=d),zs(r,Kn,c)):(c=m.cache,zs(r,Kn,c),c!==d.cache&&au(r,[Kn],i,!0))),ua(t,r,r.pendingProps.children,i),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function Ts(t){t.flags|=4}function sh(t,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!p0(r)){if(r=wr.current,r!==null&&((Bt&4194048)===Bt?es!==null:(Bt&62914560)!==Bt&&(Bt&536870912)===0||r!==es))throw Ll=lu,Gd;t.flags|=8192}}function ac(t,r){r!==null&&(t.flags|=4),t.flags&16384&&(r=t.tag!==22?at():536870912,t.lanes|=r,rl|=r)}function Vl(t,r){if(!Wt)switch(t.tailMode){case"hidden":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function Tn(t){var r=t.alternate!==null&&t.alternate.child===t.child,i=0,c=0;if(r)for(var d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=c,t.childLanes=i,r}function Ey(t,r,i){var c=r.pendingProps;switch(Jc(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tn(r),null;case 1:return Tn(r),null;case 3:return i=r.stateNode,c=null,t!==null&&(c=t.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Ss(Kn),_e(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(kl(r)?Ts(r):t===null||t.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Fd())),Tn(r),null;case 26:return i=r.memoizedState,t===null?(Ts(r),i!==null?(Tn(r),sh(r,i)):(Tn(r),r.flags&=-16777217)):i?i!==t.memoizedState?(Ts(r),Tn(r),sh(r,i)):(Tn(r),r.flags&=-16777217):(t.memoizedProps!==c&&Ts(r),Tn(r),r.flags&=-16777217),null;case 27:ft(r),i=Xe.current;var d=r.type;if(t!==null&&r.stateNode!=null)t.memoizedProps!==c&&Ts(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return Tn(r),null}t=Pe.current,kl(r)?Ld(r):(t=s0(d,c,i),r.stateNode=t,Ts(r))}return Tn(r),null;case 5:if(ft(r),i=r.type,t!==null&&r.stateNode!=null)t.memoizedProps!==c&&Ts(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return Tn(r),null}if(t=Pe.current,kl(r))Ld(r);else{switch(d=gc(Xe.current),t){case 1:t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof c.is=="string"?d.createElement("select",{is:c.is}):d.createElement("select"),c.multiple?t.multiple=!0:c.size&&(t.size=c.size);break;default:t=typeof c.is=="string"?d.createElement(i,{is:c.is}):d.createElement(i)}}t[un]=r,t[tn]=c;e:for(d=r.child;d!==null;){if(d.tag===5||d.tag===6)t.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r.stateNode=t;e:switch(da(t,i,c),i){case"button":case"input":case"select":case"textarea":t=!!c.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&Ts(r)}}return Tn(r),r.flags&=-16777217,null;case 6:if(t&&r.stateNode!=null)t.memoizedProps!==c&&Ts(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(s(166));if(t=Xe.current,kl(r)){if(t=r.stateNode,i=r.memoizedProps,c=null,d=Ca,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}t[un]=r,t=!!(t.nodeValue===i||c!==null&&c.suppressHydrationWarning===!0||Kh(t.nodeValue,i)),t||Ei(r)}else t=gc(t).createTextNode(c),t[un]=r,r.stateNode=t}return Tn(r),null;case 13:if(c=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=kl(r),c!==null&&c.dehydrated!==null){if(t===null){if(!d)throw Error(s(318));if(d=r.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[un]=r}else Nl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Tn(r),d=!1}else d=Fd(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=d),d=!0;if(!d)return r.flags&256?(Es(r),r):(Es(r),null)}if(Es(r),(r.flags&128)!==0)return r.lanes=i,r;if(i=c!==null,t=t!==null&&t.memoizedState!==null,i){c=r.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool);var m=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==d&&(c.flags|=2048)}return i!==t&&i&&(r.child.flags|=8192),ac(r,r.updateQueue),Tn(r),null;case 4:return _e(),t===null&&df(r.stateNode.containerInfo),Tn(r),null;case 10:return Ss(r.type),Tn(r),null;case 19:if(he(Jn),d=r.memoizedState,d===null)return Tn(r),null;if(c=(r.flags&128)!==0,m=d.rendering,m===null)if(c)Vl(d,!1);else{if(In!==0||t!==null&&(t.flags&128)!==0)for(t=r.child;t!==null;){if(m=Ko(t),m!==null){for(r.flags|=128,Vl(d,!1),t=m.updateQueue,r.updateQueue=t,ac(r,t),r.subtreeFlags=0,t=i,i=r.child;i!==null;)_d(i,t),i=i.sibling;return Ce(Jn,Jn.current&1|2),r.child}t=t.sibling}d.tail!==null&&tt()>ic&&(r.flags|=128,c=!0,Vl(d,!1),r.lanes=4194304)}else{if(!c)if(t=Ko(m),t!==null){if(r.flags|=128,c=!0,t=t.updateQueue,r.updateQueue=t,ac(r,t),Vl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!Wt)return Tn(r),null}else 2*tt()-d.renderingStartTime>ic&&i!==536870912&&(r.flags|=128,c=!0,Vl(d,!1),r.lanes=4194304);d.isBackwards?(m.sibling=r.child,r.child=m):(t=d.last,t!==null?t.sibling=m:r.child=m,d.last=m)}return d.tail!==null?(r=d.tail,d.rendering=r,d.tail=r.sibling,d.renderingStartTime=tt(),r.sibling=null,t=Jn.current,Ce(Jn,c?t&1|2:t&1),r):(Tn(r),null);case 22:case 23:return Es(r),pu(),c=r.memoizedState!==null,t!==null?t.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(i&536870912)!==0&&(r.flags&128)===0&&(Tn(r),r.subtreeFlags&6&&(r.flags|=8192)):Tn(r),i=r.updateQueue,i!==null&&ac(r,i.retryQueue),i=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==i&&(r.flags|=2048),t!==null&&he(Ci),null;case 24:return i=null,t!==null&&(i=t.memoizedState.cache),r.memoizedState.cache!==i&&(r.flags|=2048),Ss(Kn),Tn(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function Ay(t,r){switch(Jc(r),r.tag){case 1:return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return Ss(Kn),_e(),t=r.flags,(t&65536)!==0&&(t&128)===0?(r.flags=t&-65537|128,r):null;case 26:case 27:case 5:return ft(r),null;case 13:if(Es(r),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(s(340));Nl()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return he(Jn),null;case 4:return _e(),null;case 10:return Ss(r.type),null;case 22:case 23:return Es(r),pu(),t!==null&&he(Ci),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 24:return Ss(Kn),null;case 25:return null;default:return null}}function ih(t,r){switch(Jc(r),r.tag){case 3:Ss(Kn),_e();break;case 26:case 27:case 5:ft(r);break;case 4:_e();break;case 13:Es(r);break;case 19:he(Jn);break;case 10:Ss(r.type);break;case 22:case 23:Es(r),pu(),t!==null&&he(Ci);break;case 24:Ss(Kn)}}function ql(t,r){try{var i=r.updateQueue,c=i!==null?i.lastEffect:null;if(c!==null){var d=c.next;i=d;do{if((i.tag&t)===t){c=void 0;var m=i.create,E=i.inst;c=m(),E.destroy=c}i=i.next}while(i!==d)}}catch(j){dn(r,r.return,j)}}function $s(t,r,i){try{var c=r.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var m=d.next;c=m;do{if((c.tag&t)===t){var E=c.inst,j=E.destroy;if(j!==void 0){E.destroy=void 0,d=r;var se=i,ve=j;try{ve()}catch(Me){dn(d,se,Me)}}}c=c.next}while(c!==m)}}catch(Me){dn(r,r.return,Me)}}function lh(t){var r=t.updateQueue;if(r!==null){var i=t.stateNode;try{$d(r,i)}catch(c){dn(t,t.return,c)}}}function oh(t,r,i){i.props=ki(t.type,t.memoizedProps),i.state=t.memoizedState;try{i.componentWillUnmount()}catch(c){dn(t,r,c)}}function Xl(t,r){try{var i=t.ref;if(i!==null){switch(t.tag){case 26:case 27:case 5:var c=t.stateNode;break;case 30:c=t.stateNode;break;default:c=t.stateNode}typeof i=="function"?t.refCleanup=i(c):i.current=c}}catch(d){dn(t,r,d)}}function ts(t,r){var i=t.ref,c=t.refCleanup;if(i!==null)if(typeof c=="function")try{c()}catch(d){dn(t,r,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(d){dn(t,r,d)}else i.current=null}function ch(t){var r=t.type,i=t.memoizedProps,c=t.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":i.autoFocus&&c.focus();break e;case"img":i.src?c.src=i.src:i.srcSet&&(c.srcset=i.srcSet)}}catch(d){dn(t,t.return,d)}}function zu(t,r,i){try{var c=t.stateNode;Vy(c,t.type,i,r),c[tn]=r}catch(d){dn(t,t.return,d)}}function uh(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&ni(t.type)||t.tag===4}function Gu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||uh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&ni(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Hu(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(t,r):(r=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,r.appendChild(t),i=i._reactRootContainer,i!=null||r.onclick!==null||(r.onclick=mc));else if(c!==4&&(c===27&&ni(t.type)&&(i=t.stateNode,r=null),t=t.child,t!==null))for(Hu(t,r,i),t=t.sibling;t!==null;)Hu(t,r,i),t=t.sibling}function rc(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?i.insertBefore(t,r):i.appendChild(t);else if(c!==4&&(c===27&&ni(t.type)&&(i=t.stateNode),t=t.child,t!==null))for(rc(t,r,i),t=t.sibling;t!==null;)rc(t,r,i),t=t.sibling}function fh(t){var r=t.stateNode,i=t.memoizedProps;try{for(var c=t.type,d=r.attributes;d.length;)r.removeAttributeNode(d[0]);da(r,c,i),r[un]=t,r[tn]=i}catch(m){dn(t,t.return,m)}}var Cs=!1,Un=!1,Yu=!1,dh=typeof WeakSet=="function"?WeakSet:Set,sa=null;function Ty(t,r){if(t=t.containerInfo,mf=wc,t=jn(t),Kt(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var c=i.getSelection&&i.getSelection();if(c&&c.rangeCount!==0){i=c.anchorNode;var d=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{i.nodeType,m.nodeType}catch{i=null;break e}var E=0,j=-1,se=-1,ve=0,Me=0,Ie=t,be=null;t:for(;;){for(var Se;Ie!==i||d!==0&&Ie.nodeType!==3||(j=E+d),Ie!==m||c!==0&&Ie.nodeType!==3||(se=E+c),Ie.nodeType===3&&(E+=Ie.nodeValue.length),(Se=Ie.firstChild)!==null;)be=Ie,Ie=Se;for(;;){if(Ie===t)break t;if(be===i&&++ve===d&&(j=E),be===m&&++Me===c&&(se=E),(Se=Ie.nextSibling)!==null)break;Ie=be,be=Ie.parentNode}Ie=Se}i=j===-1||se===-1?null:{start:j,end:se}}else i=null}i=i||{start:0,end:0}}else i=null;for(gf={focusedElem:t,selectionRange:i},wc=!1,sa=r;sa!==null;)if(r=sa,t=r.child,(r.subtreeFlags&1024)!==0&&t!==null)t.return=r,sa=t;else for(;sa!==null;){switch(r=sa,m=r.alternate,t=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&m!==null){t=void 0,i=r,d=m.memoizedProps,m=m.memoizedState,c=i.stateNode;try{var bt=ki(i.type,d,i.elementType===i.type);t=c.getSnapshotBeforeUpdate(bt,m),c.__reactInternalSnapshotBeforeUpdate=t}catch(mt){dn(i,i.return,mt)}}break;case 3:if((t&1024)!==0){if(t=r.stateNode.containerInfo,i=t.nodeType,i===9)bf(t);else if(i===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":bf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(s(163))}if(t=r.sibling,t!==null){t.return=r.return,sa=t;break}sa=r.return}}function ph(t,r,i){var c=i.flags;switch(i.tag){case 0:case 11:case 15:Ws(t,i),c&4&&ql(5,i);break;case 1:if(Ws(t,i),c&4)if(t=i.stateNode,r===null)try{t.componentDidMount()}catch(E){dn(i,i.return,E)}else{var d=ki(i.type,r.memoizedProps);r=r.memoizedState;try{t.componentDidUpdate(d,r,t.__reactInternalSnapshotBeforeUpdate)}catch(E){dn(i,i.return,E)}}c&64&&lh(i),c&512&&Xl(i,i.return);break;case 3:if(Ws(t,i),c&64&&(t=i.updateQueue,t!==null)){if(r=null,i.child!==null)switch(i.child.tag){case 27:case 5:r=i.child.stateNode;break;case 1:r=i.child.stateNode}try{$d(t,r)}catch(E){dn(i,i.return,E)}}break;case 27:r===null&&c&4&&fh(i);case 26:case 5:Ws(t,i),r===null&&c&4&&ch(i),c&512&&Xl(i,i.return);break;case 12:Ws(t,i);break;case 13:Ws(t,i),c&4&&gh(t,i),c&64&&(t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(i=Oy.bind(null,i),Ky(t,i))));break;case 22:if(c=i.memoizedState!==null||Cs,!c){r=r!==null&&r.memoizedState!==null||Un,d=Cs;var m=Un;Cs=c,(Un=r)&&!m?Zs(t,i,(i.subtreeFlags&8772)!==0):Ws(t,i),Cs=d,Un=m}break;case 30:break;default:Ws(t,i)}}function hh(t){var r=t.alternate;r!==null&&(t.alternate=null,hh(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&Fa(r)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Sn=null,_a=!1;function Ms(t,r,i){for(i=i.child;i!==null;)mh(t,r,i),i=i.sibling}function mh(t,r,i){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(qt,i)}catch{}switch(i.tag){case 26:Un||ts(i,r),Ms(t,r,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:Un||ts(i,r);var c=Sn,d=_a;ni(i.type)&&(Sn=i.stateNode,_a=!1),Ms(t,r,i),no(i.stateNode),Sn=c,_a=d;break;case 5:Un||ts(i,r);case 6:if(c=Sn,d=_a,Sn=null,Ms(t,r,i),Sn=c,_a=d,Sn!==null)if(_a)try{(Sn.nodeType===9?Sn.body:Sn.nodeName==="HTML"?Sn.ownerDocument.body:Sn).removeChild(i.stateNode)}catch(m){dn(i,r,m)}else try{Sn.removeChild(i.stateNode)}catch(m){dn(i,r,m)}break;case 18:Sn!==null&&(_a?(t=Sn,a0(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,i.stateNode),uo(t)):a0(Sn,i.stateNode));break;case 4:c=Sn,d=_a,Sn=i.stateNode.containerInfo,_a=!0,Ms(t,r,i),Sn=c,_a=d;break;case 0:case 11:case 14:case 15:Un||$s(2,i,r),Un||$s(4,i,r),Ms(t,r,i);break;case 1:Un||(ts(i,r),c=i.stateNode,typeof c.componentWillUnmount=="function"&&oh(i,r,c)),Ms(t,r,i);break;case 21:Ms(t,r,i);break;case 22:Un=(c=Un)||i.memoizedState!==null,Ms(t,r,i),Un=c;break;default:Ms(t,r,i)}}function gh(t,r){if(r.memoizedState===null&&(t=r.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{uo(t)}catch(i){dn(r,r.return,i)}}function Cy(t){switch(t.tag){case 13:case 19:var r=t.stateNode;return r===null&&(r=t.stateNode=new dh),r;case 22:return t=t.stateNode,r=t._retryCache,r===null&&(r=t._retryCache=new dh),r;default:throw Error(s(435,t.tag))}}function Vu(t,r){var i=Cy(t);r.forEach(function(c){var d=Ly.bind(null,t,c);i.has(c)||(i.add(c),c.then(d,d))})}function Wa(t,r){var i=r.deletions;if(i!==null)for(var c=0;c<i.length;c++){var d=i[c],m=t,E=r,j=E;e:for(;j!==null;){switch(j.tag){case 27:if(ni(j.type)){Sn=j.stateNode,_a=!1;break e}break;case 5:Sn=j.stateNode,_a=!1;break e;case 3:case 4:Sn=j.stateNode.containerInfo,_a=!0;break e}j=j.return}if(Sn===null)throw Error(s(160));mh(m,E,d),Sn=null,_a=!1,m=d.alternate,m!==null&&(m.return=null),d.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)yh(r,t),r=r.sibling}var Lr=null;function yh(t,r){var i=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Wa(r,t),Za(t),c&4&&($s(3,t,t.return),ql(3,t),$s(5,t,t.return));break;case 1:Wa(r,t),Za(t),c&512&&(Un||i===null||ts(i,i.return)),c&64&&Cs&&(t=t.updateQueue,t!==null&&(c=t.callbacks,c!==null&&(i=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=i===null?c:i.concat(c))));break;case 26:var d=Lr;if(Wa(r,t),Za(t),c&512&&(Un||i===null||ts(i,i.return)),c&4){var m=i!==null?i.memoizedState:null;if(c=t.memoizedState,i===null)if(c===null)if(t.stateNode===null){e:{c=t.type,i=t.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":m=d.getElementsByTagName("title")[0],(!m||m[hn]||m[un]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=d.createElement(c),d.head.insertBefore(m,d.querySelector("head > title"))),da(m,c,i),m[un]=t,yn(m),c=m;break e;case"link":var E=f0("link","href",d).get(c+(i.href||""));if(E){for(var j=0;j<E.length;j++)if(m=E[j],m.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&m.getAttribute("rel")===(i.rel==null?null:i.rel)&&m.getAttribute("title")===(i.title==null?null:i.title)&&m.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){E.splice(j,1);break t}}m=d.createElement(c),da(m,c,i),d.head.appendChild(m);break;case"meta":if(E=f0("meta","content",d).get(c+(i.content||""))){for(j=0;j<E.length;j++)if(m=E[j],m.getAttribute("content")===(i.content==null?null:""+i.content)&&m.getAttribute("name")===(i.name==null?null:i.name)&&m.getAttribute("property")===(i.property==null?null:i.property)&&m.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&m.getAttribute("charset")===(i.charSet==null?null:i.charSet)){E.splice(j,1);break t}}m=d.createElement(c),da(m,c,i),d.head.appendChild(m);break;default:throw Error(s(468,c))}m[un]=t,yn(m),c=m}t.stateNode=c}else d0(d,t.type,t.stateNode);else t.stateNode=u0(d,c,t.memoizedProps);else m!==c?(m===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):m.count--,c===null?d0(d,t.type,t.stateNode):u0(d,c,t.memoizedProps)):c===null&&t.stateNode!==null&&zu(t,t.memoizedProps,i.memoizedProps)}break;case 27:Wa(r,t),Za(t),c&512&&(Un||i===null||ts(i,i.return)),i!==null&&c&4&&zu(t,t.memoizedProps,i.memoizedProps);break;case 5:if(Wa(r,t),Za(t),c&512&&(Un||i===null||ts(i,i.return)),t.flags&32){d=t.stateNode;try{za(d,"")}catch(Se){dn(t,t.return,Se)}}c&4&&t.stateNode!=null&&(d=t.memoizedProps,zu(t,d,i!==null?i.memoizedProps:d)),c&1024&&(Yu=!0);break;case 6:if(Wa(r,t),Za(t),c&4){if(t.stateNode===null)throw Error(s(162));c=t.memoizedProps,i=t.stateNode;try{i.nodeValue=c}catch(Se){dn(t,t.return,Se)}}break;case 3:if(bc=null,d=Lr,Lr=yc(r.containerInfo),Wa(r,t),Lr=d,Za(t),c&4&&i!==null&&i.memoizedState.isDehydrated)try{uo(r.containerInfo)}catch(Se){dn(t,t.return,Se)}Yu&&(Yu=!1,vh(t));break;case 4:c=Lr,Lr=yc(t.stateNode.containerInfo),Wa(r,t),Za(t),Lr=c;break;case 12:Wa(r,t),Za(t);break;case 13:Wa(r,t),Za(t),t.child.flags&8192&&t.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Qu=tt()),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Vu(t,c)));break;case 22:d=t.memoizedState!==null;var se=i!==null&&i.memoizedState!==null,ve=Cs,Me=Un;if(Cs=ve||d,Un=Me||se,Wa(r,t),Un=Me,Cs=ve,Za(t),c&8192)e:for(r=t.stateNode,r._visibility=d?r._visibility&-2:r._visibility|1,d&&(i===null||se||Cs||Un||Ni(t)),i=null,r=t;;){if(r.tag===5||r.tag===26){if(i===null){se=i=r;try{if(m=se.stateNode,d)E=m.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{j=se.stateNode;var Ie=se.memoizedProps.style,be=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null;j.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(Se){dn(se,se.return,Se)}}}else if(r.tag===6){if(i===null){se=r;try{se.stateNode.nodeValue=d?"":se.memoizedProps}catch(Se){dn(se,se.return,Se)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;i===r&&(i=null),r=r.return}i===r&&(i=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=t.updateQueue,c!==null&&(i=c.retryQueue,i!==null&&(c.retryQueue=null,Vu(t,i))));break;case 19:Wa(r,t),Za(t),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Vu(t,c)));break;case 30:break;case 21:break;default:Wa(r,t),Za(t)}}function Za(t){var r=t.flags;if(r&2){try{for(var i,c=t.return;c!==null;){if(uh(c)){i=c;break}c=c.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var d=i.stateNode,m=Gu(t);rc(t,m,d);break;case 5:var E=i.stateNode;i.flags&32&&(za(E,""),i.flags&=-33);var j=Gu(t);rc(t,j,E);break;case 3:case 4:var se=i.stateNode.containerInfo,ve=Gu(t);Hu(t,ve,se);break;default:throw Error(s(161))}}catch(Me){dn(t,t.return,Me)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function vh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var r=t;vh(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),t=t.sibling}}function Ws(t,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)ph(t,r.alternate,r),r=r.sibling}function Ni(t){for(t=t.child;t!==null;){var r=t;switch(r.tag){case 0:case 11:case 14:case 15:$s(4,r,r.return),Ni(r);break;case 1:ts(r,r.return);var i=r.stateNode;typeof i.componentWillUnmount=="function"&&oh(r,r.return,i),Ni(r);break;case 27:no(r.stateNode);case 26:case 5:ts(r,r.return),Ni(r);break;case 22:r.memoizedState===null&&Ni(r);break;case 30:Ni(r);break;default:Ni(r)}t=t.sibling}}function Zs(t,r,i){for(i=i&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,d=t,m=r,E=m.flags;switch(m.tag){case 0:case 11:case 15:Zs(d,m,i),ql(4,m);break;case 1:if(Zs(d,m,i),c=m,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(ve){dn(c,c.return,ve)}if(c=m,d=c.updateQueue,d!==null){var j=c.stateNode;try{var se=d.shared.hiddenCallbacks;if(se!==null)for(d.shared.hiddenCallbacks=null,d=0;d<se.length;d++)Xd(se[d],j)}catch(ve){dn(c,c.return,ve)}}i&&E&64&&lh(m),Xl(m,m.return);break;case 27:fh(m);case 26:case 5:Zs(d,m,i),i&&c===null&&E&4&&ch(m),Xl(m,m.return);break;case 12:Zs(d,m,i);break;case 13:Zs(d,m,i),i&&E&4&&gh(d,m);break;case 22:m.memoizedState===null&&Zs(d,m,i),Xl(m,m.return);break;case 30:break;default:Zs(d,m,i)}r=r.sibling}}function qu(t,r){var i=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),t=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(t=r.memoizedState.cachePool.pool),t!==i&&(t!=null&&t.refCount++,i!=null&&Il(i))}function Xu(t,r){t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&Il(t))}function ns(t,r,i,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)bh(t,r,i,c),r=r.sibling}function bh(t,r,i,c){var d=r.flags;switch(r.tag){case 0:case 11:case 15:ns(t,r,i,c),d&2048&&ql(9,r);break;case 1:ns(t,r,i,c);break;case 3:ns(t,r,i,c),d&2048&&(t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&Il(t)));break;case 12:if(d&2048){ns(t,r,i,c),t=r.stateNode;try{var m=r.memoizedProps,E=m.id,j=m.onPostCommit;typeof j=="function"&&j(E,r.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(se){dn(r,r.return,se)}}else ns(t,r,i,c);break;case 13:ns(t,r,i,c);break;case 23:break;case 22:m=r.stateNode,E=r.alternate,r.memoizedState!==null?m._visibility&2?ns(t,r,i,c):$l(t,r):m._visibility&2?ns(t,r,i,c):(m._visibility|=2,tl(t,r,i,c,(r.subtreeFlags&10256)!==0)),d&2048&&qu(E,r);break;case 24:ns(t,r,i,c),d&2048&&Xu(r.alternate,r);break;default:ns(t,r,i,c)}}function tl(t,r,i,c,d){for(d=d&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var m=t,E=r,j=i,se=c,ve=E.flags;switch(E.tag){case 0:case 11:case 15:tl(m,E,j,se,d),ql(8,E);break;case 23:break;case 22:var Me=E.stateNode;E.memoizedState!==null?Me._visibility&2?tl(m,E,j,se,d):$l(m,E):(Me._visibility|=2,tl(m,E,j,se,d)),d&&ve&2048&&qu(E.alternate,E);break;case 24:tl(m,E,j,se,d),d&&ve&2048&&Xu(E.alternate,E);break;default:tl(m,E,j,se,d)}r=r.sibling}}function $l(t,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var i=t,c=r,d=c.flags;switch(c.tag){case 22:$l(i,c),d&2048&&qu(c.alternate,c);break;case 24:$l(i,c),d&2048&&Xu(c.alternate,c);break;default:$l(i,c)}r=r.sibling}}var Wl=8192;function nl(t){if(t.subtreeFlags&Wl)for(t=t.child;t!==null;)xh(t),t=t.sibling}function xh(t){switch(t.tag){case 26:nl(t),t.flags&Wl&&t.memoizedState!==null&&f1(Lr,t.memoizedState,t.memoizedProps);break;case 5:nl(t);break;case 3:case 4:var r=Lr;Lr=yc(t.stateNode.containerInfo),nl(t),Lr=r;break;case 22:t.memoizedState===null&&(r=t.alternate,r!==null&&r.memoizedState!==null?(r=Wl,Wl=16777216,nl(t),Wl=r):nl(t));break;default:nl(t)}}function Sh(t){var r=t.alternate;if(r!==null&&(t=r.child,t!==null)){r.child=null;do r=t.sibling,t.sibling=null,t=r;while(t!==null)}}function Zl(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];sa=c,Eh(c,t)}Sh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)wh(t),t=t.sibling}function wh(t){switch(t.tag){case 0:case 11:case 15:Zl(t),t.flags&2048&&$s(9,t,t.return);break;case 3:Zl(t);break;case 12:Zl(t);break;case 22:var r=t.stateNode;t.memoizedState!==null&&r._visibility&2&&(t.return===null||t.return.tag!==13)?(r._visibility&=-3,sc(t)):Zl(t);break;default:Zl(t)}}function sc(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];sa=c,Eh(c,t)}Sh(t)}for(t=t.child;t!==null;){switch(r=t,r.tag){case 0:case 11:case 15:$s(8,r,r.return),sc(r);break;case 22:i=r.stateNode,i._visibility&2&&(i._visibility&=-3,sc(r));break;default:sc(r)}t=t.sibling}}function Eh(t,r){for(;sa!==null;){var i=sa;switch(i.tag){case 0:case 11:case 15:$s(8,i,r);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var c=i.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Il(i.memoizedState.cache)}if(c=i.child,c!==null)c.return=i,sa=c;else e:for(i=t;sa!==null;){c=sa;var d=c.sibling,m=c.return;if(hh(c),c===i){sa=null;break e}if(d!==null){d.return=m,sa=d;break e}sa=m}}}var My={getCacheForType:function(t){var r=ya(Kn),i=r.data.get(t);return i===void 0&&(i=t(),r.data.set(t,i)),i}},ky=typeof WeakMap=="function"?WeakMap:Map,Jt=0,gn=null,Lt=null,Bt=0,en=0,Qa=null,Qs=!1,al=!1,$u=!1,ks=0,In=0,Ks=0,Ri=0,Wu=0,Er=0,rl=0,Ql=null,Oa=null,Zu=!1,Qu=0,ic=1/0,lc=null,Js=null,fa=0,ei=null,sl=null,il=0,Ku=0,Ju=null,Ah=null,Kl=0,ef=null;function Ka(){if((Jt&2)!==0&&Bt!==0)return Bt&-Bt;if(z.T!==null){var t=Xi;return t!==0?t:of()}return cs()}function Th(){Er===0&&(Er=(Bt&536870912)===0||Wt?pa():536870912);var t=wr.current;return t!==null&&(t.flags|=32),Er}function Ja(t,r,i){(t===gn&&(en===2||en===9)||t.cancelPendingCommit!==null)&&(ll(t,0),ti(t,Bt,Er,!1)),Yr(t,i),((Jt&2)===0||t!==gn)&&(t===gn&&((Jt&2)===0&&(Ri|=i),In===4&&ti(t,Bt,Er,!1)),as(t))}function Ch(t,r,i){if((Jt&6)!==0)throw Error(s(327));var c=!i&&(r&124)===0&&(r&t.expiredLanes)===0||$n(t,r),d=c?Dy(t,r):af(t,r,!0),m=c;do{if(d===0){al&&!c&&ti(t,r,0,!1);break}else{if(i=t.current.alternate,m&&!Ny(i)){d=af(t,r,!1),m=!1;continue}if(d===2){if(m=r,t.errorRecoveryDisabledLanes&m)var E=0;else E=t.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){r=E;e:{var j=t;d=Ql;var se=j.current.memoizedState.isDehydrated;if(se&&(ll(j,E).flags|=256),E=af(j,E,!1),E!==2){if($u&&!se){j.errorRecoveryDisabledLanes|=m,Ri|=m,d=4;break e}m=Oa,Oa=d,m!==null&&(Oa===null?Oa=m:Oa.push.apply(Oa,m))}d=E}if(m=!1,d!==2)continue}}if(d===1){ll(t,0),ti(t,r,0,!0);break}e:{switch(c=t,m=d,m){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:ti(c,r,Er,!Qs);break e;case 2:Oa=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(d=Qu+300-tt(),10<d)){if(ti(c,r,Er,!Qs),La(c,0,!0)!==0)break e;c.timeoutHandle=t0(Mh.bind(null,c,i,Oa,lc,Zu,r,Er,Ri,rl,Qs,m,2,-0,0),d);break e}Mh(c,i,Oa,lc,Zu,r,Er,Ri,rl,Qs,m,0,-0,0)}}break}while(!0);as(t)}function Mh(t,r,i,c,d,m,E,j,se,ve,Me,Ie,be,Se){if(t.timeoutHandle=-1,Ie=r.subtreeFlags,(Ie&8192||(Ie&16785408)===16785408)&&(so={stylesheets:null,count:0,unsuspend:u1},xh(r),Ie=d1(),Ie!==null)){t.cancelPendingCommit=Ie(Oh.bind(null,t,r,m,i,c,d,E,j,se,Me,1,be,Se)),ti(t,m,E,!ve);return}Oh(t,r,m,i,c,d,E,j,se)}function Ny(t){for(var r=t;;){var i=r.tag;if((i===0||i===11||i===15)&&r.flags&16384&&(i=r.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var c=0;c<i.length;c++){var d=i[c],m=d.getSnapshot;d=d.value;try{if(!It(m(),d))return!1}catch{return!1}}if(i=r.child,r.subtreeFlags&16384&&i!==null)i.return=r,r=i;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ti(t,r,i,c){r&=~Wu,r&=~Ri,t.suspendedLanes|=r,t.pingedLanes&=~r,c&&(t.warmLanes|=r),c=t.expirationTimes;for(var d=r;0<d;){var m=31-pt(d),E=1<<m;c[m]=-1,d&=~E}i!==0&&Sa(t,i,r)}function oc(){return(Jt&6)===0?(Jl(0),!1):!0}function tf(){if(Lt!==null){if(en===0)var t=Lt.return;else t=Lt,xs=Ai=null,vu(t),Ji=null,Hl=0,t=Lt;for(;t!==null;)ih(t.alternate,t),t=t.return;Lt=null}}function ll(t,r){var i=t.timeoutHandle;i!==-1&&(t.timeoutHandle=-1,Xy(i)),i=t.cancelPendingCommit,i!==null&&(t.cancelPendingCommit=null,i()),tf(),gn=t,Lt=i=ys(t.current,null),Bt=r,en=0,Qa=null,Qs=!1,al=$n(t,r),$u=!1,rl=Er=Wu=Ri=Ks=In=0,Oa=Ql=null,Zu=!1,(r&8)!==0&&(r|=r&32);var c=t.entangledLanes;if(c!==0)for(t=t.entanglements,c&=r;0<c;){var d=31-pt(c),m=1<<d;r|=t[d],c&=~m}return ks=r,Ro(),i}function kh(t,r){_t=null,z.H=Wo,r===Ol||r===Po?(r=Vd(),en=3):r===Gd?(r=Vd(),en=4):en=r===qp?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Qa=r,Lt===null&&(In=1,ec(t,vr(r,t.current)))}function Nh(){var t=z.H;return z.H=Wo,t===null?Wo:t}function Rh(){var t=z.A;return z.A=My,t}function nf(){In=4,Qs||(Bt&4194048)!==Bt&&wr.current!==null||(al=!0),(Ks&134217727)===0&&(Ri&134217727)===0||gn===null||ti(gn,Bt,Er,!1)}function af(t,r,i){var c=Jt;Jt|=2;var d=Nh(),m=Rh();(gn!==t||Bt!==r)&&(lc=null,ll(t,r)),r=!1;var E=In;e:do try{if(en!==0&&Lt!==null){var j=Lt,se=Qa;switch(en){case 8:tf(),E=6;break e;case 3:case 2:case 9:case 6:wr.current===null&&(r=!0);var ve=en;if(en=0,Qa=null,ol(t,j,se,ve),i&&al){E=0;break e}break;default:ve=en,en=0,Qa=null,ol(t,j,se,ve)}}Ry(),E=In;break}catch(Me){kh(t,Me)}while(!0);return r&&t.shellSuspendCounter++,xs=Ai=null,Jt=c,z.H=d,z.A=m,Lt===null&&(gn=null,Bt=0,Ro()),E}function Ry(){for(;Lt!==null;)Dh(Lt)}function Dy(t,r){var i=Jt;Jt|=2;var c=Nh(),d=Rh();gn!==t||Bt!==r?(lc=null,ic=tt()+500,ll(t,r)):al=$n(t,r);e:do try{if(en!==0&&Lt!==null){r=Lt;var m=Qa;t:switch(en){case 1:en=0,Qa=null,ol(t,r,m,1);break;case 2:case 9:if(Hd(m)){en=0,Qa=null,Ih(r);break}r=function(){en!==2&&en!==9||gn!==t||(en=7),as(t)},m.then(r,r);break e;case 3:en=7;break e;case 4:en=5;break e;case 7:Hd(m)?(en=0,Qa=null,Ih(r)):(en=0,Qa=null,ol(t,r,m,7));break;case 5:var E=null;switch(Lt.tag){case 26:E=Lt.memoizedState;case 5:case 27:var j=Lt;if(!E||p0(E)){en=0,Qa=null;var se=j.sibling;if(se!==null)Lt=se;else{var ve=j.return;ve!==null?(Lt=ve,cc(ve)):Lt=null}break t}}en=0,Qa=null,ol(t,r,m,5);break;case 6:en=0,Qa=null,ol(t,r,m,6);break;case 8:tf(),In=6;break e;default:throw Error(s(462))}}Iy();break}catch(Me){kh(t,Me)}while(!0);return xs=Ai=null,z.H=c,z.A=d,Jt=i,Lt!==null?0:(gn=null,Bt=0,Ro(),In)}function Iy(){for(;Lt!==null&&!Xn();)Dh(Lt)}function Dh(t){var r=rh(t.alternate,t,ks);t.memoizedProps=t.pendingProps,r===null?cc(t):Lt=r}function Ih(t){var r=t,i=r.alternate;switch(r.tag){case 15:case 0:r=Kp(i,r,r.pendingProps,r.type,void 0,Bt);break;case 11:r=Kp(i,r,r.pendingProps,r.type.render,r.ref,Bt);break;case 5:vu(r);default:ih(i,r),r=Lt=_d(r,ks),r=rh(i,r,ks)}t.memoizedProps=t.pendingProps,r===null?cc(t):Lt=r}function ol(t,r,i,c){xs=Ai=null,vu(r),Ji=null,Hl=0;var d=r.return;try{if(Sy(t,d,r,i,Bt)){In=1,ec(t,vr(i,t.current)),Lt=null;return}}catch(m){if(d!==null)throw Lt=d,m;In=1,ec(t,vr(i,t.current)),Lt=null;return}r.flags&32768?(Wt||c===1?t=!0:al||(Bt&536870912)!==0?t=!1:(Qs=t=!0,(c===2||c===9||c===3||c===6)&&(c=wr.current,c!==null&&c.tag===13&&(c.flags|=16384))),_h(r,t)):cc(r)}function cc(t){var r=t;do{if((r.flags&32768)!==0){_h(r,Qs);return}t=r.return;var i=Ey(r.alternate,r,ks);if(i!==null){Lt=i;return}if(r=r.sibling,r!==null){Lt=r;return}Lt=r=t}while(r!==null);In===0&&(In=5)}function _h(t,r){do{var i=Ay(t.alternate,t);if(i!==null){i.flags&=32767,Lt=i;return}if(i=t.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!r&&(t=t.sibling,t!==null)){Lt=t;return}Lt=t=i}while(t!==null);In=6,Lt=null}function Oh(t,r,i,c,d,m,E,j,se){t.cancelPendingCommit=null;do uc();while(fa!==0);if((Jt&6)!==0)throw Error(s(327));if(r!==null){if(r===t.current)throw Error(s(177));if(m=r.lanes|r.childLanes,m|=Xc,Ma(t,i,m,E,j,se),t===gn&&(Lt=gn=null,Bt=0),sl=r,ei=t,il=i,Ku=m,Ju=d,Ah=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,jy(rt,function(){return Ph(),null})):(t.callbackNode=null,t.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=z.T,z.T=null,d=J.p,J.p=2,E=Jt,Jt|=4;try{Ty(t,r,i)}finally{Jt=E,J.p=d,z.T=c}}fa=1,Lh(),jh(),Fh()}}function Lh(){if(fa===1){fa=0;var t=ei,r=sl,i=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||i){i=z.T,z.T=null;var c=J.p;J.p=2;var d=Jt;Jt|=4;try{yh(r,t);var m=gf,E=jn(t.containerInfo),j=m.focusedElem,se=m.selectionRange;if(E!==j&&j&&j.ownerDocument&&xn(j.ownerDocument.documentElement,j)){if(se!==null&&Kt(j)){var ve=se.start,Me=se.end;if(Me===void 0&&(Me=ve),"selectionStart"in j)j.selectionStart=ve,j.selectionEnd=Math.min(Me,j.value.length);else{var Ie=j.ownerDocument||document,be=Ie&&Ie.defaultView||window;if(be.getSelection){var Se=be.getSelection(),bt=j.textContent.length,mt=Math.min(se.start,bt),on=se.end===void 0?mt:Math.min(se.end,bt);!Se.extend&&mt>on&&(E=on,on=mt,mt=E);var de=Ta(j,mt),oe=Ta(j,on);if(de&&oe&&(Se.rangeCount!==1||Se.anchorNode!==de.node||Se.anchorOffset!==de.offset||Se.focusNode!==oe.node||Se.focusOffset!==oe.offset)){var ge=Ie.createRange();ge.setStart(de.node,de.offset),Se.removeAllRanges(),mt>on?(Se.addRange(ge),Se.extend(oe.node,oe.offset)):(ge.setEnd(oe.node,oe.offset),Se.addRange(ge))}}}}for(Ie=[],Se=j;Se=Se.parentNode;)Se.nodeType===1&&Ie.push({element:Se,left:Se.scrollLeft,top:Se.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<Ie.length;j++){var Ne=Ie[j];Ne.element.scrollLeft=Ne.left,Ne.element.scrollTop=Ne.top}}wc=!!mf,gf=mf=null}finally{Jt=d,J.p=c,z.T=i}}t.current=r,fa=2}}function jh(){if(fa===2){fa=0;var t=ei,r=sl,i=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||i){i=z.T,z.T=null;var c=J.p;J.p=2;var d=Jt;Jt|=4;try{ph(t,r.alternate,r)}finally{Jt=d,J.p=c,z.T=i}}fa=3}}function Fh(){if(fa===4||fa===3){fa=0,nt();var t=ei,r=sl,i=il,c=Ah;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?fa=5:(fa=0,sl=ei=null,Uh(t,t.pendingLanes));var d=t.pendingLanes;if(d===0&&(Js=null),Vr(i),r=r.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(qt,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=z.T,d=J.p,J.p=2,z.T=null;try{for(var m=t.onRecoverableError,E=0;E<c.length;E++){var j=c[E];m(j.value,{componentStack:j.stack})}}finally{z.T=r,J.p=d}}(il&3)!==0&&uc(),as(t),d=t.pendingLanes,(i&4194090)!==0&&(d&42)!==0?t===ef?Kl++:(Kl=0,ef=t):Kl=0,Jl(0)}}function Uh(t,r){(t.pooledCacheLanes&=r)===0&&(r=t.pooledCache,r!=null&&(t.pooledCache=null,Il(r)))}function uc(t){return Lh(),jh(),Fh(),Ph()}function Ph(){if(fa!==5)return!1;var t=ei,r=Ku;Ku=0;var i=Vr(il),c=z.T,d=J.p;try{J.p=32>i?32:i,z.T=null,i=Ju,Ju=null;var m=ei,E=il;if(fa=0,sl=ei=null,il=0,(Jt&6)!==0)throw Error(s(331));var j=Jt;if(Jt|=4,wh(m.current),bh(m,m.current,E,i),Jt=j,Jl(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(qt,m)}catch{}return!0}finally{J.p=d,z.T=c,Uh(t,r)}}function Bh(t,r,i){r=vr(i,r),r=Iu(t.stateNode,r,2),t=Ys(t,r,2),t!==null&&(Yr(t,2),as(t))}function dn(t,r,i){if(t.tag===3)Bh(t,t,i);else for(;r!==null;){if(r.tag===3){Bh(r,t,i);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Js===null||!Js.has(c))){t=vr(i,t),i=Yp(2),c=Ys(r,i,2),c!==null&&(Vp(i,c,r,t),Yr(c,2),as(c));break}}r=r.return}}function rf(t,r,i){var c=t.pingCache;if(c===null){c=t.pingCache=new ky;var d=new Set;c.set(r,d)}else d=c.get(r),d===void 0&&(d=new Set,c.set(r,d));d.has(i)||($u=!0,d.add(i),t=_y.bind(null,t,r,i),r.then(t,t))}function _y(t,r,i){var c=t.pingCache;c!==null&&c.delete(r),t.pingedLanes|=t.suspendedLanes&i,t.warmLanes&=~i,gn===t&&(Bt&i)===i&&(In===4||In===3&&(Bt&62914560)===Bt&&300>tt()-Qu?(Jt&2)===0&&ll(t,0):Wu|=i,rl===Bt&&(rl=0)),as(t)}function zh(t,r){r===0&&(r=at()),t=Hi(t,r),t!==null&&(Yr(t,r),as(t))}function Oy(t){var r=t.memoizedState,i=0;r!==null&&(i=r.retryLane),zh(t,i)}function Ly(t,r){var i=0;switch(t.tag){case 13:var c=t.stateNode,d=t.memoizedState;d!==null&&(i=d.retryLane);break;case 19:c=t.stateNode;break;case 22:c=t.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(r),zh(t,i)}function jy(t,r){return Dt(t,r)}var fc=null,cl=null,sf=!1,dc=!1,lf=!1,Di=0;function as(t){t!==cl&&t.next===null&&(cl===null?fc=cl=t:cl=cl.next=t),dc=!0,sf||(sf=!0,Uy())}function Jl(t,r){if(!lf&&dc){lf=!0;do for(var i=!1,c=fc;c!==null;){if(t!==0){var d=c.pendingLanes;if(d===0)var m=0;else{var E=c.suspendedLanes,j=c.pingedLanes;m=(1<<31-pt(42|t)+1)-1,m&=d&~(E&~j),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(i=!0,Vh(c,m))}else m=Bt,m=La(c,c===gn?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(m&3)===0||$n(c,m)||(i=!0,Vh(c,m));c=c.next}while(i);lf=!1}}function Fy(){Gh()}function Gh(){dc=sf=!1;var t=0;Di!==0&&(qy()&&(t=Di),Di=0);for(var r=tt(),i=null,c=fc;c!==null;){var d=c.next,m=Hh(c,r);m===0?(c.next=null,i===null?fc=d:i.next=d,d===null&&(cl=i)):(i=c,(t!==0||(m&3)!==0)&&(dc=!0)),c=d}Jl(t)}function Hh(t,r){for(var i=t.suspendedLanes,c=t.pingedLanes,d=t.expirationTimes,m=t.pendingLanes&-62914561;0<m;){var E=31-pt(m),j=1<<E,se=d[E];se===-1?((j&i)===0||(j&c)!==0)&&(d[E]=Hr(j,r)):se<=r&&(t.expiredLanes|=j),m&=~j}if(r=gn,i=Bt,i=La(t,t===r?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c=t.callbackNode,i===0||t===r&&(en===2||en===9)||t.cancelPendingCommit!==null)return c!==null&&c!==null&&zt(c),t.callbackNode=null,t.callbackPriority=0;if((i&3)===0||$n(t,i)){if(r=i&-i,r===t.callbackPriority)return r;switch(c!==null&&zt(c),Vr(i)){case 2:case 8:i=Vt;break;case 32:i=rt;break;case 268435456:i=ze;break;default:i=rt}return c=Yh.bind(null,t),i=Dt(i,c),t.callbackPriority=r,t.callbackNode=i,r}return c!==null&&c!==null&&zt(c),t.callbackPriority=2,t.callbackNode=null,2}function Yh(t,r){if(fa!==0&&fa!==5)return t.callbackNode=null,t.callbackPriority=0,null;var i=t.callbackNode;if(uc()&&t.callbackNode!==i)return null;var c=Bt;return c=La(t,t===gn?c:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c===0?null:(Ch(t,c,r),Hh(t,tt()),t.callbackNode!=null&&t.callbackNode===i?Yh.bind(null,t):null)}function Vh(t,r){if(uc())return null;Ch(t,r,!0)}function Uy(){$y(function(){(Jt&6)!==0?Dt(Yt,Fy):Gh()})}function of(){return Di===0&&(Di=pa()),Di}function qh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Ls(""+t)}function Xh(t,r){var i=r.ownerDocument.createElement("input");return i.name=r.name,i.value=r.value,t.id&&i.setAttribute("form",t.id),r.parentNode.insertBefore(i,r),t=new FormData(t),i.parentNode.removeChild(i),t}function Py(t,r,i,c,d){if(r==="submit"&&i&&i.stateNode===d){var m=qh((d[tn]||null).action),E=c.submitter;E&&(r=(r=E[tn]||null)?qh(r.formAction):E.getAttribute("formAction"),r!==null&&(m=r,E=null));var j=new Fs("action","action",null,c,d);t.push({event:j,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Di!==0){var se=E?Xh(d,E):new FormData(d);Mu(i,{pending:!0,data:se,method:d.method,action:m},null,se)}}else typeof m=="function"&&(j.preventDefault(),se=E?Xh(d,E):new FormData(d),Mu(i,{pending:!0,data:se,method:d.method,action:m},m,se))},currentTarget:d}]})}}for(var cf=0;cf<qc.length;cf++){var uf=qc[cf],By=uf.toLowerCase(),zy=uf[0].toUpperCase()+uf.slice(1);Or(By,"on"+zy)}Or(Cd,"onAnimationEnd"),Or(Md,"onAnimationIteration"),Or(kd,"onAnimationStart"),Or("dblclick","onDoubleClick"),Or("focusin","onFocus"),Or("focusout","onBlur"),Or(ry,"onTransitionRun"),Or(sy,"onTransitionStart"),Or(iy,"onTransitionCancel"),Or(Nd,"onTransitionEnd"),En("onMouseEnter",["mouseout","mouseover"]),En("onMouseLeave",["mouseout","mouseover"]),En("onPointerEnter",["pointerout","pointerover"]),En("onPointerLeave",["pointerout","pointerover"]),Et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Et("onBeforeInput",["compositionend","keypress","textInput","paste"]),Et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(eo));function $h(t,r){r=(r&4)!==0;for(var i=0;i<t.length;i++){var c=t[i],d=c.event;c=c.listeners;e:{var m=void 0;if(r)for(var E=c.length-1;0<=E;E--){var j=c[E],se=j.instance,ve=j.currentTarget;if(j=j.listener,se!==m&&d.isPropagationStopped())break e;m=j,d.currentTarget=ve;try{m(d)}catch(Me){Jo(Me)}d.currentTarget=null,m=se}else for(E=0;E<c.length;E++){if(j=c[E],se=j.instance,ve=j.currentTarget,j=j.listener,se!==m&&d.isPropagationStopped())break e;m=j,d.currentTarget=ve;try{m(d)}catch(Me){Jo(Me)}d.currentTarget=null,m=se}}}}function jt(t,r){var i=r[ha];i===void 0&&(i=r[ha]=new Set);var c=t+"__bubble";i.has(c)||(Wh(r,t,2,!1),i.add(c))}function ff(t,r,i){var c=0;r&&(c|=4),Wh(i,t,c,r)}var pc="_reactListening"+Math.random().toString(36).slice(2);function df(t){if(!t[pc]){t[pc]=!0,mn.forEach(function(i){i!=="selectionchange"&&(Gy.has(i)||ff(i,!1,t),ff(i,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[pc]||(r[pc]=!0,ff("selectionchange",!1,r))}}function Wh(t,r,i,c){switch(b0(r)){case 2:var d=m1;break;case 8:d=g1;break;default:d=Cf}i=d.bind(null,r,i,t),d=void 0,!Ir||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(d=!0),c?d!==void 0?t.addEventListener(r,i,{capture:!0,passive:d}):t.addEventListener(r,i,!0):d!==void 0?t.addEventListener(r,i,{passive:d}):t.addEventListener(r,i,!1)}function pf(t,r,i,c,d){var m=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var E=c.tag;if(E===3||E===4){var j=c.stateNode.containerInfo;if(j===d)break;if(E===4)for(E=c.return;E!==null;){var se=E.tag;if((se===3||se===4)&&E.stateNode.containerInfo===d)return;E=E.return}for(;j!==null;){if(E=ir(j),E===null)return;if(se=E.tag,se===5||se===6||se===26||se===27){c=m=E;continue e}j=j.parentNode}}c=c.return}dr(function(){var ve=m,Me=Dr(i),Ie=[];e:{var be=Rd.get(t);if(be!==void 0){var Se=Fs,bt=t;switch(t){case"keypress":if(ms(i)===0)break e;case"keydown":case"keyup":Se=ne;break;case"focusin":bt="focus",Se=_r;break;case"focusout":bt="blur",Se=_r;break;case"beforeblur":case"afterblur":Se=_r;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=mr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=Ra;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=ae;break;case Cd:case Md:case kd:Se=Ps;break;case Nd:Se=Ae;break;case"scroll":case"scrollend":Se=Ha;break;case"wheel":Se=Oe;break;case"copy":case"cut":case"paste":Se=qa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=te;break;case"toggle":case"beforetoggle":Se=L}var mt=(r&4)!==0,on=!mt&&(t==="scroll"||t==="scrollend"),de=mt?be!==null?be+"Capture":null:be;mt=[];for(var oe=ve,ge;oe!==null;){var Ne=oe;if(ge=Ne.stateNode,Ne=Ne.tag,Ne!==5&&Ne!==26&&Ne!==27||ge===null||de===null||(Ne=oa(oe,de),Ne!=null&&mt.push(to(oe,Ne,ge))),on)break;oe=oe.return}0<mt.length&&(be=new Se(be,bt,null,i,Me),Ie.push({event:be,listeners:mt}))}}if((r&7)===0){e:{if(be=t==="mouseover"||t==="pointerover",Se=t==="mouseout"||t==="pointerout",be&&i!==js&&(bt=i.relatedTarget||i.fromElement)&&(ir(bt)||bt[Cn]))break e;if((Se||be)&&(be=Me.window===Me?Me:(be=Me.ownerDocument)?be.defaultView||be.parentWindow:window,Se?(bt=i.relatedTarget||i.toElement,Se=ve,bt=bt?ir(bt):null,bt!==null&&(on=o(bt),mt=bt.tag,bt!==on||mt!==5&&mt!==27&&mt!==6)&&(bt=null)):(Se=null,bt=ve),Se!==bt)){if(mt=mr,Ne="onMouseLeave",de="onMouseEnter",oe="mouse",(t==="pointerout"||t==="pointerover")&&(mt=te,Ne="onPointerLeave",de="onPointerEnter",oe="pointer"),on=Se==null?be:nn(Se),ge=bt==null?be:nn(bt),be=new mt(Ne,oe+"leave",Se,i,Me),be.target=on,be.relatedTarget=ge,Ne=null,ir(Me)===ve&&(mt=new mt(de,oe+"enter",bt,i,Me),mt.target=ge,mt.relatedTarget=on,Ne=mt),on=Ne,Se&&bt)t:{for(mt=Se,de=bt,oe=0,ge=mt;ge;ge=ul(ge))oe++;for(ge=0,Ne=de;Ne;Ne=ul(Ne))ge++;for(;0<oe-ge;)mt=ul(mt),oe--;for(;0<ge-oe;)de=ul(de),ge--;for(;oe--;){if(mt===de||de!==null&&mt===de.alternate)break t;mt=ul(mt),de=ul(de)}mt=null}else mt=null;Se!==null&&Zh(Ie,be,Se,mt,!1),bt!==null&&on!==null&&Zh(Ie,on,bt,mt,!0)}}e:{if(be=ve?nn(ve):window,Se=be.nodeName&&be.nodeName.toLowerCase(),Se==="select"||Se==="input"&&be.type==="file")var st=ct;else if(Qe(be))if(Ct)st=na;else{st=Qt;var Ot=vn}else Se=be.nodeName,!Se||Se.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?ve&&Os(ve.elementType)&&(st=ct):st=Da;if(st&&(st=st(t,ve))){Fe(Ie,st,i,Me);break e}Ot&&Ot(t,be,ve),t==="focusout"&&ve&&be.type==="number"&&ve.memoizedProps.value!=null&&Ba(be,"number",be.value)}switch(Ot=ve?nn(ve):window,t){case"focusin":(Qe(Ot)||Ot.contentEditable==="true")&&(Gn=Ot,Rn=ve,aa=null);break;case"focusout":aa=Rn=Gn=null;break;case"mousedown":gs=!0;break;case"contextmenu":case"mouseup":case"dragend":gs=!1,Xa(Ie,i,Me);break;case"selectionchange":if(At)break;case"keydown":case"keyup":Xa(Ie,i,Me)}var ht;if(W)e:{switch(t){case"compositionstart":var yt="onCompositionStart";break e;case"compositionend":yt="onCompositionEnd";break e;case"compositionupdate":yt="onCompositionUpdate";break e}yt=void 0}else ye?Ue(t,i)&&(yt="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(yt="onCompositionStart");yt&&(ce&&i.locale!=="ko"&&(ye||yt!=="onCompositionStart"?yt==="onCompositionEnd"&&ye&&(ht=An()):(Ea=Me,hs="value"in Ea?Ea.value:Ea.textContent,ye=!0)),Ot=hc(ve,yt),0<Ot.length&&(yt=new zi(yt,t,null,i,Me),Ie.push({event:yt,listeners:Ot}),ht?yt.data=ht:(ht=qe(i),ht!==null&&(yt.data=ht)))),(ht=re?He(t,i):Le(t,i))&&(yt=hc(ve,"onBeforeInput"),0<yt.length&&(Ot=new zi("onBeforeInput","beforeinput",null,i,Me),Ie.push({event:Ot,listeners:yt}),Ot.data=ht)),Py(Ie,t,ve,i,Me)}$h(Ie,r)})}function to(t,r,i){return{instance:t,listener:r,currentTarget:i}}function hc(t,r){for(var i=r+"Capture",c=[];t!==null;){var d=t,m=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||m===null||(d=oa(t,i),d!=null&&c.unshift(to(t,d,m)),d=oa(t,r),d!=null&&c.push(to(t,d,m))),t.tag===3)return c;t=t.return}return[]}function ul(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Zh(t,r,i,c,d){for(var m=r._reactName,E=[];i!==null&&i!==c;){var j=i,se=j.alternate,ve=j.stateNode;if(j=j.tag,se!==null&&se===c)break;j!==5&&j!==26&&j!==27||ve===null||(se=ve,d?(ve=oa(i,m),ve!=null&&E.unshift(to(i,ve,se))):d||(ve=oa(i,m),ve!=null&&E.push(to(i,ve,se)))),i=i.return}E.length!==0&&t.push({event:r,listeners:E})}var Hy=/\r\n?/g,Yy=/\u0000|\uFFFD/g;function Qh(t){return(typeof t=="string"?t:""+t).replace(Hy,`
`).replace(Yy,"")}function Kh(t,r){return r=Qh(r),Qh(t)===r}function mc(){}function ln(t,r,i,c,d,m){switch(i){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||za(t,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&za(t,""+c);break;case"className":ma(t,"class",c);break;case"tabIndex":ma(t,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":ma(t,i,c);break;case"style":Rr(t,c,m);break;case"data":if(r!=="object"){ma(t,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||i!=="href")){t.removeAttribute(i);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=Ls(""+c),t.setAttribute(i,c);break;case"action":case"formAction":if(typeof c=="function"){t.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(i==="formAction"?(r!=="input"&&ln(t,r,"name",d.name,d,null),ln(t,r,"formEncType",d.formEncType,d,null),ln(t,r,"formMethod",d.formMethod,d,null),ln(t,r,"formTarget",d.formTarget,d,null)):(ln(t,r,"encType",d.encType,d,null),ln(t,r,"method",d.method,d,null),ln(t,r,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=Ls(""+c),t.setAttribute(i,c);break;case"onClick":c!=null&&(t.onclick=mc);break;case"onScroll":c!=null&&jt("scroll",t);break;case"onScrollEnd":c!=null&&jt("scrollend",t);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"multiple":t.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":t.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){t.removeAttribute("xlink:href");break}i=Ls(""+c),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""+c):t.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""):t.removeAttribute(i);break;case"capture":case"download":c===!0?t.setAttribute(i,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,c):t.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?t.setAttribute(i,c):t.removeAttribute(i);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?t.removeAttribute(i):t.setAttribute(i,c);break;case"popover":jt("beforetoggle",t),jt("toggle",t),or(t,"popover",c);break;case"xlinkActuate":Zt(t,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Zt(t,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Zt(t,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Zt(t,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Zt(t,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Zt(t,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Zt(t,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Zt(t,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Zt(t,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":or(t,"is",c);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Wr.get(i)||i,or(t,i,c))}}function hf(t,r,i,c,d,m){switch(i){case"style":Rr(t,c,m);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"children":typeof c=="string"?za(t,c):(typeof c=="number"||typeof c=="bigint")&&za(t,""+c);break;case"onScroll":c!=null&&jt("scroll",t);break;case"onScrollEnd":c!=null&&jt("scrollend",t);break;case"onClick":c!=null&&(t.onclick=mc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ot.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(d=i.endsWith("Capture"),r=i.slice(2,d?i.length-7:void 0),m=t[tn]||null,m=m!=null?m[i]:null,typeof m=="function"&&t.removeEventListener(r,m,d),typeof c=="function")){typeof m!="function"&&m!==null&&(i in t?t[i]=null:t.hasAttribute(i)&&t.removeAttribute(i)),t.addEventListener(r,c,d);break e}i in t?t[i]=c:c===!0?t.setAttribute(i,""):or(t,i,c)}}}function da(t,r,i){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jt("error",t),jt("load",t);var c=!1,d=!1,m;for(m in i)if(i.hasOwnProperty(m)){var E=i[m];if(E!=null)switch(m){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:ln(t,r,m,E,i,null)}}d&&ln(t,r,"srcSet",i.srcSet,i,null),c&&ln(t,r,"src",i.src,i,null);return;case"input":jt("invalid",t);var j=m=E=d=null,se=null,ve=null;for(c in i)if(i.hasOwnProperty(c)){var Me=i[c];if(Me!=null)switch(c){case"name":d=Me;break;case"type":E=Me;break;case"checked":se=Me;break;case"defaultChecked":ve=Me;break;case"value":m=Me;break;case"defaultValue":j=Me;break;case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(s(137,r));break;default:ln(t,r,c,Me,i,null)}}fs(t,m,j,se,ve,E,d,!1),Xr(t);return;case"select":jt("invalid",t),c=E=m=null;for(d in i)if(i.hasOwnProperty(d)&&(j=i[d],j!=null))switch(d){case"value":m=j;break;case"defaultValue":E=j;break;case"multiple":c=j;default:ln(t,r,d,j,i,null)}r=m,i=E,t.multiple=!!c,r!=null?Mr(t,!!c,r,!1):i!=null&&Mr(t,!!c,i,!0);return;case"textarea":jt("invalid",t),m=d=c=null;for(E in i)if(i.hasOwnProperty(E)&&(j=i[E],j!=null))switch(E){case"value":c=j;break;case"defaultValue":d=j;break;case"children":m=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(s(91));break;default:ln(t,r,E,j,i,null)}kr(t,c,d,m),Xr(t);return;case"option":for(se in i)i.hasOwnProperty(se)&&(c=i[se],c!=null)&&(se==="selected"?t.selected=c&&typeof c!="function"&&typeof c!="symbol":ln(t,r,se,c,i,null));return;case"dialog":jt("beforetoggle",t),jt("toggle",t),jt("cancel",t),jt("close",t);break;case"iframe":case"object":jt("load",t);break;case"video":case"audio":for(c=0;c<eo.length;c++)jt(eo[c],t);break;case"image":jt("error",t),jt("load",t);break;case"details":jt("toggle",t);break;case"embed":case"source":case"link":jt("error",t),jt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ve in i)if(i.hasOwnProperty(ve)&&(c=i[ve],c!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:ln(t,r,ve,c,i,null)}return;default:if(Os(r)){for(Me in i)i.hasOwnProperty(Me)&&(c=i[Me],c!==void 0&&hf(t,r,Me,c,i,void 0));return}}for(j in i)i.hasOwnProperty(j)&&(c=i[j],c!=null&&ln(t,r,j,c,i,null))}function Vy(t,r,i,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,m=null,E=null,j=null,se=null,ve=null,Me=null;for(Se in i){var Ie=i[Se];if(i.hasOwnProperty(Se)&&Ie!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":se=Ie;default:c.hasOwnProperty(Se)||ln(t,r,Se,null,c,Ie)}}for(var be in c){var Se=c[be];if(Ie=i[be],c.hasOwnProperty(be)&&(Se!=null||Ie!=null))switch(be){case"type":m=Se;break;case"name":d=Se;break;case"checked":ve=Se;break;case"defaultChecked":Me=Se;break;case"value":E=Se;break;case"defaultValue":j=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(s(137,r));break;default:Se!==Ie&&ln(t,r,be,Se,c,Ie)}}Cr(t,E,j,se,ve,Me,m,d);return;case"select":Se=E=j=be=null;for(m in i)if(se=i[m],i.hasOwnProperty(m)&&se!=null)switch(m){case"value":break;case"multiple":Se=se;default:c.hasOwnProperty(m)||ln(t,r,m,null,c,se)}for(d in c)if(m=c[d],se=i[d],c.hasOwnProperty(d)&&(m!=null||se!=null))switch(d){case"value":be=m;break;case"defaultValue":j=m;break;case"multiple":E=m;default:m!==se&&ln(t,r,d,m,c,se)}r=j,i=E,c=Se,be!=null?Mr(t,!!i,be,!1):!!c!=!!i&&(r!=null?Mr(t,!!i,r,!0):Mr(t,!!i,i?[]:"",!1));return;case"textarea":Se=be=null;for(j in i)if(d=i[j],i.hasOwnProperty(j)&&d!=null&&!c.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:ln(t,r,j,null,c,d)}for(E in c)if(d=c[E],m=i[E],c.hasOwnProperty(E)&&(d!=null||m!=null))switch(E){case"value":be=d;break;case"defaultValue":Se=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==m&&ln(t,r,E,d,c,m)}_s(t,be,Se);return;case"option":for(var bt in i)be=i[bt],i.hasOwnProperty(bt)&&be!=null&&!c.hasOwnProperty(bt)&&(bt==="selected"?t.selected=!1:ln(t,r,bt,null,c,be));for(se in c)be=c[se],Se=i[se],c.hasOwnProperty(se)&&be!==Se&&(be!=null||Se!=null)&&(se==="selected"?t.selected=be&&typeof be!="function"&&typeof be!="symbol":ln(t,r,se,be,c,Se));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var mt in i)be=i[mt],i.hasOwnProperty(mt)&&be!=null&&!c.hasOwnProperty(mt)&&ln(t,r,mt,null,c,be);for(ve in c)if(be=c[ve],Se=i[ve],c.hasOwnProperty(ve)&&be!==Se&&(be!=null||Se!=null))switch(ve){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(s(137,r));break;default:ln(t,r,ve,be,c,Se)}return;default:if(Os(r)){for(var on in i)be=i[on],i.hasOwnProperty(on)&&be!==void 0&&!c.hasOwnProperty(on)&&hf(t,r,on,void 0,c,be);for(Me in c)be=c[Me],Se=i[Me],!c.hasOwnProperty(Me)||be===Se||be===void 0&&Se===void 0||hf(t,r,Me,be,c,Se);return}}for(var de in i)be=i[de],i.hasOwnProperty(de)&&be!=null&&!c.hasOwnProperty(de)&&ln(t,r,de,null,c,be);for(Ie in c)be=c[Ie],Se=i[Ie],!c.hasOwnProperty(Ie)||be===Se||be==null&&Se==null||ln(t,r,Ie,be,c,Se)}var mf=null,gf=null;function gc(t){return t.nodeType===9?t:t.ownerDocument}function Jh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function e0(t,r){if(t===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&r==="foreignObject"?0:t}function yf(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var vf=null;function qy(){var t=window.event;return t&&t.type==="popstate"?t===vf?!1:(vf=t,!0):(vf=null,!1)}var t0=typeof setTimeout=="function"?setTimeout:void 0,Xy=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,$y=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(t){return n0.resolve(null).then(t).catch(Wy)}:t0;function Wy(t){setTimeout(function(){throw t})}function ni(t){return t==="head"}function a0(t,r){var i=r,c=0,d=0;do{var m=i.nextSibling;if(t.removeChild(i),m&&m.nodeType===8)if(i=m.data,i==="/$"){if(0<c&&8>c){i=c;var E=t.ownerDocument;if(i&1&&no(E.documentElement),i&2&&no(E.body),i&4)for(i=E.head,no(i),E=i.firstChild;E;){var j=E.nextSibling,se=E.nodeName;E[hn]||se==="SCRIPT"||se==="STYLE"||se==="LINK"&&E.rel.toLowerCase()==="stylesheet"||i.removeChild(E),E=j}}if(d===0){t.removeChild(m),uo(r);return}d--}else i==="$"||i==="$?"||i==="$!"?d++:c=i.charCodeAt(0)-48;else c=0;i=m}while(i);uo(r)}function bf(t){var r=t.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var i=r;switch(r=r.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":bf(i),Fa(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}t.removeChild(i)}}function Zy(t,r,i,c){for(;t.nodeType===1;){var d=i;if(t.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(c){if(!t[hn])switch(r){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(m=t.getAttribute("rel"),m==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(m!==d.rel||t.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(m=t.getAttribute("src"),(m!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&m&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(r==="input"&&t.type==="hidden"){var m=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===m)return t}else return t;if(t=jr(t.nextSibling),t===null)break}return null}function Qy(t,r,i){if(r==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=jr(t.nextSibling),t===null))return null;return t}function xf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function Ky(t,r){var i=t.ownerDocument;if(t.data!=="$?"||i.readyState==="complete")r();else{var c=function(){r(),i.removeEventListener("DOMContentLoaded",c)};i.addEventListener("DOMContentLoaded",c),t._reactRetry=c}}function jr(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return t}var Sf=null;function r0(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(r===0)return t;r--}else i==="/$"&&r++}t=t.previousSibling}return null}function s0(t,r,i){switch(r=gc(i),t){case"html":if(t=r.documentElement,!t)throw Error(s(452));return t;case"head":if(t=r.head,!t)throw Error(s(453));return t;case"body":if(t=r.body,!t)throw Error(s(454));return t;default:throw Error(s(451))}}function no(t){for(var r=t.attributes;r.length;)t.removeAttributeNode(r[0]);Fa(t)}var Ar=new Map,i0=new Set;function yc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ns=J.d;J.d={f:Jy,r:e1,D:t1,C:n1,L:a1,m:r1,X:i1,S:s1,M:l1};function Jy(){var t=Ns.f(),r=oc();return t||r}function e1(t){var r=Mn(t);r!==null&&r.tag===5&&r.type==="form"?Cp(r):Ns.r(t)}var fl=typeof document>"u"?null:document;function l0(t,r,i){var c=fl;if(c&&typeof r=="string"&&r){var d=Zn(r);d='link[rel="'+t+'"][href="'+d+'"]',typeof i=="string"&&(d+='[crossorigin="'+i+'"]'),i0.has(d)||(i0.add(d),t={rel:t,crossOrigin:i,href:r},c.querySelector(d)===null&&(r=c.createElement("link"),da(r,"link",t),yn(r),c.head.appendChild(r)))}}function t1(t){Ns.D(t),l0("dns-prefetch",t,null)}function n1(t,r){Ns.C(t,r),l0("preconnect",t,r)}function a1(t,r,i){Ns.L(t,r,i);var c=fl;if(c&&t&&r){var d='link[rel="preload"][as="'+Zn(r)+'"]';r==="image"&&i&&i.imageSrcSet?(d+='[imagesrcset="'+Zn(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(d+='[imagesizes="'+Zn(i.imageSizes)+'"]')):d+='[href="'+Zn(t)+'"]';var m=d;switch(r){case"style":m=dl(t);break;case"script":m=pl(t)}Ar.has(m)||(t=v({rel:"preload",href:r==="image"&&i&&i.imageSrcSet?void 0:t,as:r},i),Ar.set(m,t),c.querySelector(d)!==null||r==="style"&&c.querySelector(ao(m))||r==="script"&&c.querySelector(ro(m))||(r=c.createElement("link"),da(r,"link",t),yn(r),c.head.appendChild(r)))}}function r1(t,r){Ns.m(t,r);var i=fl;if(i&&t){var c=r&&typeof r.as=="string"?r.as:"script",d='link[rel="modulepreload"][as="'+Zn(c)+'"][href="'+Zn(t)+'"]',m=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=pl(t)}if(!Ar.has(m)&&(t=v({rel:"modulepreload",href:t},r),Ar.set(m,t),i.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(ro(m)))return}c=i.createElement("link"),da(c,"link",t),yn(c),i.head.appendChild(c)}}}function s1(t,r,i){Ns.S(t,r,i);var c=fl;if(c&&t){var d=lr(c).hoistableStyles,m=dl(t);r=r||"default";var E=d.get(m);if(!E){var j={loading:0,preload:null};if(E=c.querySelector(ao(m)))j.loading=5;else{t=v({rel:"stylesheet",href:t,"data-precedence":r},i),(i=Ar.get(m))&&wf(t,i);var se=E=c.createElement("link");yn(se),da(se,"link",t),se._p=new Promise(function(ve,Me){se.onload=ve,se.onerror=Me}),se.addEventListener("load",function(){j.loading|=1}),se.addEventListener("error",function(){j.loading|=2}),j.loading|=4,vc(E,r,c)}E={type:"stylesheet",instance:E,count:1,state:j},d.set(m,E)}}}function i1(t,r){Ns.X(t,r);var i=fl;if(i&&t){var c=lr(i).hoistableScripts,d=pl(t),m=c.get(d);m||(m=i.querySelector(ro(d)),m||(t=v({src:t,async:!0},r),(r=Ar.get(d))&&Ef(t,r),m=i.createElement("script"),yn(m),da(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function l1(t,r){Ns.M(t,r);var i=fl;if(i&&t){var c=lr(i).hoistableScripts,d=pl(t),m=c.get(d);m||(m=i.querySelector(ro(d)),m||(t=v({src:t,async:!0,type:"module"},r),(r=Ar.get(d))&&Ef(t,r),m=i.createElement("script"),yn(m),da(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function o0(t,r,i,c){var d=(d=Xe.current)?yc(d):null;if(!d)throw Error(s(446));switch(t){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(r=dl(i.href),i=lr(d).hoistableStyles,c=i.get(r),c||(c={type:"style",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){t=dl(i.href);var m=lr(d).hoistableStyles,E=m.get(t);if(E||(d=d.ownerDocument||d,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(t,E),(m=d.querySelector(ao(t)))&&!m._p&&(E.instance=m,E.state.loading=5),Ar.has(t)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},Ar.set(t,i),m||o1(d,t,i,E.state))),r&&c===null)throw Error(s(528,""));return E}if(r&&c!==null)throw Error(s(529,""));return null;case"script":return r=i.async,i=i.src,typeof i=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=pl(i),i=lr(d).hoistableScripts,c=i.get(r),c||(c={type:"script",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,t))}}function dl(t){return'href="'+Zn(t)+'"'}function ao(t){return'link[rel="stylesheet"]['+t+"]"}function c0(t){return v({},t,{"data-precedence":t.precedence,precedence:null})}function o1(t,r,i,c){t.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=t.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),da(r,"link",i),yn(r),t.head.appendChild(r))}function pl(t){return'[src="'+Zn(t)+'"]'}function ro(t){return"script[async]"+t}function u0(t,r,i){if(r.count++,r.instance===null)switch(r.type){case"style":var c=t.querySelector('style[data-href~="'+Zn(i.href)+'"]');if(c)return r.instance=c,yn(c),c;var d=v({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return c=(t.ownerDocument||t).createElement("style"),yn(c),da(c,"style",d),vc(c,i.precedence,t),r.instance=c;case"stylesheet":d=dl(i.href);var m=t.querySelector(ao(d));if(m)return r.state.loading|=4,r.instance=m,yn(m),m;c=c0(i),(d=Ar.get(d))&&wf(c,d),m=(t.ownerDocument||t).createElement("link"),yn(m);var E=m;return E._p=new Promise(function(j,se){E.onload=j,E.onerror=se}),da(m,"link",c),r.state.loading|=4,vc(m,i.precedence,t),r.instance=m;case"script":return m=pl(i.src),(d=t.querySelector(ro(m)))?(r.instance=d,yn(d),d):(c=i,(d=Ar.get(m))&&(c=v({},i),Ef(c,d)),t=t.ownerDocument||t,d=t.createElement("script"),yn(d),da(d,"link",c),t.head.appendChild(d),r.instance=d);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,vc(c,i.precedence,t));return r.instance}function vc(t,r,i){for(var c=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,m=d,E=0;E<c.length;E++){var j=c[E];if(j.dataset.precedence===r)m=j;else if(m!==d)break}m?m.parentNode.insertBefore(t,m.nextSibling):(r=i.nodeType===9?i.head:i,r.insertBefore(t,r.firstChild))}function wf(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.title==null&&(t.title=r.title)}function Ef(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.integrity==null&&(t.integrity=r.integrity)}var bc=null;function f0(t,r,i){if(bc===null){var c=new Map,d=bc=new Map;d.set(i,c)}else d=bc,c=d.get(i),c||(c=new Map,d.set(i,c));if(c.has(t))return c;for(c.set(t,null),i=i.getElementsByTagName(t),d=0;d<i.length;d++){var m=i[d];if(!(m[hn]||m[un]||t==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var E=m.getAttribute(r)||"";E=t+E;var j=c.get(E);j?j.push(m):c.set(E,[m])}}return c}function d0(t,r,i){t=t.ownerDocument||t,t.head.insertBefore(i,r==="title"?t.querySelector("head > title"):null)}function c1(t,r,i){if(i===1||r.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(t=r.disabled,typeof r.precedence=="string"&&t==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function p0(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var so=null;function u1(){}function f1(t,r,i){if(so===null)throw Error(s(475));var c=so;if(r.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var d=dl(i.href),m=t.querySelector(ao(d));if(m){t=m._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(c.count++,c=xc.bind(c),t.then(c,c)),r.state.loading|=4,r.instance=m,yn(m);return}m=t.ownerDocument||t,i=c0(i),(d=Ar.get(d))&&wf(i,d),m=m.createElement("link"),yn(m);var E=m;E._p=new Promise(function(j,se){E.onload=j,E.onerror=se}),da(m,"link",i),r.instance=m}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(r,t),(t=r.state.preload)&&(r.state.loading&3)===0&&(c.count++,r=xc.bind(c),t.addEventListener("load",r),t.addEventListener("error",r))}}function d1(){if(so===null)throw Error(s(475));var t=so;return t.stylesheets&&t.count===0&&Af(t,t.stylesheets),0<t.count?function(r){var i=setTimeout(function(){if(t.stylesheets&&Af(t,t.stylesheets),t.unsuspend){var c=t.unsuspend;t.unsuspend=null,c()}},6e4);return t.unsuspend=r,function(){t.unsuspend=null,clearTimeout(i)}}:null}function xc(){if(this.count--,this.count===0){if(this.stylesheets)Af(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Sc=null;function Af(t,r){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Sc=new Map,r.forEach(p1,t),Sc=null,xc.call(t))}function p1(t,r){if(!(r.state.loading&4)){var i=Sc.get(t);if(i)var c=i.get(null);else{i=new Map,Sc.set(t,i);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<d.length;m++){var E=d[m];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(i.set(E.dataset.precedence,E),c=E)}c&&i.set(null,c)}d=r.instance,E=d.getAttribute("data-precedence"),m=i.get(E)||c,m===c&&i.set(null,d),i.set(E,d),this.count++,c=xc.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),m?m.parentNode.insertBefore(d,m.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),r.state.loading|=4}}var io={$$typeof:A,Provider:null,Consumer:null,_currentValue:pe,_currentValue2:pe,_threadCount:0};function h1(t,r,i,c,d,m,E,j){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.hiddenUpdates=gt(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=m,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function h0(t,r,i,c,d,m,E,j,se,ve,Me,Ie){return t=new h1(t,r,i,E,j,se,ve,Ie),r=1,m===!0&&(r|=24),m=$a(3,null,null,r),t.current=m,m.stateNode=t,r=ru(),r.refCount++,t.pooledCache=r,r.refCount++,m.memoizedState={element:c,isDehydrated:i,cache:r},ou(m),t}function m0(t){return t?(t=Yi,t):Yi}function g0(t,r,i,c,d,m){d=m0(d),c.context===null?c.context=d:c.pendingContext=d,c=Hs(r),c.payload={element:i},m=m===void 0?null:m,m!==null&&(c.callback=m),i=Ys(t,c,r),i!==null&&(Ja(i,t,r),jl(i,t,r))}function y0(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<r?i:r}}function Tf(t,r){y0(t,r),(t=t.alternate)&&y0(t,r)}function v0(t){if(t.tag===13){var r=Hi(t,67108864);r!==null&&Ja(r,t,67108864),Tf(t,67108864)}}var wc=!0;function m1(t,r,i,c){var d=z.T;z.T=null;var m=J.p;try{J.p=2,Cf(t,r,i,c)}finally{J.p=m,z.T=d}}function g1(t,r,i,c){var d=z.T;z.T=null;var m=J.p;try{J.p=8,Cf(t,r,i,c)}finally{J.p=m,z.T=d}}function Cf(t,r,i,c){if(wc){var d=Mf(c);if(d===null)pf(t,r,c,Ec,i),x0(t,c);else if(v1(d,t,r,i,c))c.stopPropagation();else if(x0(t,c),r&4&&-1<y1.indexOf(t)){for(;d!==null;){var m=Mn(d);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var E=ea(m.pendingLanes);if(E!==0){var j=m;for(j.pendingLanes|=2,j.entangledLanes|=2;E;){var se=1<<31-pt(E);j.entanglements[1]|=se,E&=~se}as(m),(Jt&6)===0&&(ic=tt()+500,Jl(0))}}break;case 13:j=Hi(m,2),j!==null&&Ja(j,m,2),oc(),Tf(m,2)}if(m=Mf(c),m===null&&pf(t,r,c,Ec,i),m===d)break;d=m}d!==null&&c.stopPropagation()}else pf(t,r,c,null,i)}}function Mf(t){return t=Dr(t),kf(t)}var Ec=null;function kf(t){if(Ec=null,t=ir(t),t!==null){var r=o(t);if(r===null)t=null;else{var i=r.tag;if(i===13){if(t=u(r),t!==null)return t;t=null}else if(i===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null)}}return Ec=t,null}function b0(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ut()){case Yt:return 2;case Vt:return 8;case rt:case Gt:return 32;case ze:return 268435456;default:return 32}default:return 32}}var Nf=!1,ai=null,ri=null,si=null,lo=new Map,oo=new Map,ii=[],y1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x0(t,r){switch(t){case"focusin":case"focusout":ai=null;break;case"dragenter":case"dragleave":ri=null;break;case"mouseover":case"mouseout":si=null;break;case"pointerover":case"pointerout":lo.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":oo.delete(r.pointerId)}}function co(t,r,i,c,d,m){return t===null||t.nativeEvent!==m?(t={blockedOn:r,domEventName:i,eventSystemFlags:c,nativeEvent:m,targetContainers:[d]},r!==null&&(r=Mn(r),r!==null&&v0(r)),t):(t.eventSystemFlags|=c,r=t.targetContainers,d!==null&&r.indexOf(d)===-1&&r.push(d),t)}function v1(t,r,i,c,d){switch(r){case"focusin":return ai=co(ai,t,r,i,c,d),!0;case"dragenter":return ri=co(ri,t,r,i,c,d),!0;case"mouseover":return si=co(si,t,r,i,c,d),!0;case"pointerover":var m=d.pointerId;return lo.set(m,co(lo.get(m)||null,t,r,i,c,d)),!0;case"gotpointercapture":return m=d.pointerId,oo.set(m,co(oo.get(m)||null,t,r,i,c,d)),!0}return!1}function S0(t){var r=ir(t.target);if(r!==null){var i=o(r);if(i!==null){if(r=i.tag,r===13){if(r=u(i),r!==null){t.blockedOn=r,sr(t.priority,function(){if(i.tag===13){var c=Ka();c=ja(c);var d=Hi(i,c);d!==null&&Ja(d,i,c),Tf(i,c)}});return}}else if(r===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ac(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var i=Mf(t.nativeEvent);if(i===null){i=t.nativeEvent;var c=new i.constructor(i.type,i);js=c,i.target.dispatchEvent(c),js=null}else return r=Mn(i),r!==null&&v0(r),t.blockedOn=i,!1;r.shift()}return!0}function w0(t,r,i){Ac(t)&&i.delete(r)}function b1(){Nf=!1,ai!==null&&Ac(ai)&&(ai=null),ri!==null&&Ac(ri)&&(ri=null),si!==null&&Ac(si)&&(si=null),lo.forEach(w0),oo.forEach(w0)}function Tc(t,r){t.blockedOn===r&&(t.blockedOn=null,Nf||(Nf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,b1)))}var Cc=null;function E0(t){Cc!==t&&(Cc=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Cc===t&&(Cc=null);for(var r=0;r<t.length;r+=3){var i=t[r],c=t[r+1],d=t[r+2];if(typeof c!="function"){if(kf(c||i)===null)continue;break}var m=Mn(i);m!==null&&(t.splice(r,3),r-=3,Mu(m,{pending:!0,data:d,method:i.method,action:c},c,d))}}))}function uo(t){function r(se){return Tc(se,t)}ai!==null&&Tc(ai,t),ri!==null&&Tc(ri,t),si!==null&&Tc(si,t),lo.forEach(r),oo.forEach(r);for(var i=0;i<ii.length;i++){var c=ii[i];c.blockedOn===t&&(c.blockedOn=null)}for(;0<ii.length&&(i=ii[0],i.blockedOn===null);)S0(i),i.blockedOn===null&&ii.shift();if(i=(t.ownerDocument||t).$$reactFormReplay,i!=null)for(c=0;c<i.length;c+=3){var d=i[c],m=i[c+1],E=d[tn]||null;if(typeof m=="function")E||E0(i);else if(E){var j=null;if(m&&m.hasAttribute("formAction")){if(d=m,E=m[tn]||null)j=E.formAction;else if(kf(d)!==null)continue}else j=E.action;typeof j=="function"?i[c+1]=j:(i.splice(c,3),c-=3),E0(i)}}}function Rf(t){this._internalRoot=t}Mc.prototype.render=Rf.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(s(409));var i=r.current,c=Ka();g0(i,c,t,r,null,null)},Mc.prototype.unmount=Rf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;g0(t.current,2,null,t,null,null),oc(),r[Cn]=null}};function Mc(t){this._internalRoot=t}Mc.prototype.unstable_scheduleHydration=function(t){if(t){var r=cs();t={blockedOn:null,target:t,priority:r};for(var i=0;i<ii.length&&r!==0&&r<ii[i].priority;i++);ii.splice(i,0,t),i===0&&S0(t)}};var A0=e.version;if(A0!=="19.1.1")throw Error(s(527,A0,"19.1.1"));J.findDOMNode=function(t){var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(s(188)):(t=Object.keys(t).join(","),Error(s(268,t)));return t=h(r),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var x1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kc.isDisabled&&kc.supportsFiber)try{qt=kc.inject(x1),Xt=kc}catch{}}return po.createRoot=function(t,r){if(!l(t))throw Error(s(299));var i=!1,c="",d=Bp,m=zp,E=Gp,j=null;return r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(d=r.onUncaughtError),r.onCaughtError!==void 0&&(m=r.onCaughtError),r.onRecoverableError!==void 0&&(E=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(j=r.unstable_transitionCallbacks)),r=h0(t,1,!1,null,null,i,c,d,m,E,j,null),t[Cn]=r.current,df(t),new Rf(r)},po.hydrateRoot=function(t,r,i){if(!l(t))throw Error(s(299));var c=!1,d="",m=Bp,E=zp,j=Gp,se=null,ve=null;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(m=i.onUncaughtError),i.onCaughtError!==void 0&&(E=i.onCaughtError),i.onRecoverableError!==void 0&&(j=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(se=i.unstable_transitionCallbacks),i.formState!==void 0&&(ve=i.formState)),r=h0(t,1,!0,r,i??null,c,d,m,E,j,se,ve),r.context=m0(null),i=r.current,c=Ka(),c=ja(c),d=Hs(c),d.callback=null,Ys(i,d,c),i=c,r.current.lanes=i,Yr(r,i),as(r),t[Cn]=r.current,df(t),new Mc(r)},po.version="19.1.1",po}var O0;function N1(){if(O0)return _f.exports;O0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),_f.exports=k1(),_f.exports}var R1=N1();const D1=od(R1),I1="modulepreload",_1=function(n,e){return new URL(n,e).href},L0={},j0=function(e,a,s){let l=Promise.resolve();if(a&&a.length>0){let g=function(v){return Promise.all(v.map(S=>Promise.resolve(S).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};const u=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),h=p?.nonce||p?.getAttribute("nonce");l=g(a.map(v=>{if(v=_1(v,s),v in L0)return;L0[v]=!0;const S=v.endsWith(".css"),x=S?'[rel="stylesheet"]':"";if(s)for(let T=u.length-1;T>=0;T--){const M=u[T];if(M.href===v&&(!S||M.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${x}`))return;const b=document.createElement("link");if(b.rel=S?"stylesheet":I1,S||(b.as="script"),b.crossOrigin="",b.href=v,h&&b.setAttribute("nonce",h),document.head.appendChild(b),S)return new Promise((T,M)=>{b.addEventListener("load",T),b.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(u){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=u,window.dispatchEvent(p),!p.defaultPrevented)throw u}return l.then(u=>{for(const p of u||[])p.status==="rejected"&&o(p.reason);return e().catch(o)})};class Fr{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,a,s={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==Fr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof a!="function")throw new TypeError("The callback must be a function.");const l=new F0(e,this,a,s);return this.eventMap[e]||(this.eventMap[e]=[]),s.prepend?this.eventMap[e].unshift(l):this.eventMap[e].push(l),l}addOneTimeListener(e,a,s={}){s.remaining=1,this.addListener(e,a,s)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,a){return e===void 0?this.eventMap[Fr.ANY_EVENT]&&this.eventMap[Fr.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,s])=>s.length>0):this.eventMap[e]&&this.eventMap[e].length>0?a instanceof F0?this.eventMap[e].filter(l=>l===a).length>0:typeof a=="function"?this.eventMap[e].filter(l=>l.callback===a).length>0:a==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...a){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let s=[],l=this.eventMap[Fr.ANY_EVENT]||[];return this.eventMap[e]&&(l=l.concat(this.eventMap[e])),l.forEach(o=>{if(o.suspended)return;let u=[...a];Array.isArray(o.arguments)&&(u=u.concat(o.arguments)),o.remaining>0&&(s.push(o.callback.apply(o.context,u)),o.count++),--o.remaining<1&&o.remove()}),s}removeListener(e,a,s={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let l=this.eventMap[e].filter(o=>a&&o.callback!==a||s.remaining&&s.remaining!==o.remaining||s.context&&s.context!==o.context);l.length?this.eventMap[e]=l:delete this.eventMap[e]}async waitFor(e,a={}){return a.duration=parseInt(a.duration),(isNaN(a.duration)||a.duration<=0)&&(a.duration=1/0),new Promise((s,l)=>{let o,u=this.addListener(e,()=>{clearTimeout(o),s()},{remaining:1});a.duration!==1/0&&(o=setTimeout(()=>{u.remove(),l("The duration expired before the event was emitted.")},a.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class F0{constructor(e,a,s,l={}){if(typeof e!="string"&&!(e instanceof String)&&e!==Fr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!a)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof s!="function")throw new TypeError("The 'callback' must be a function.");l.arguments!==void 0&&!Array.isArray(l.arguments)&&(l.arguments=[l.arguments]),l=Object.assign({context:a,remaining:1/0,arguments:void 0,duration:1/0},l),l.duration!==1/0&&setTimeout(()=>this.remove(),l.duration),this.arguments=l.arguments,this.callback=s,this.context=l.context,this.count=0,this.event=e,this.remaining=parseInt(l.remaining)>=1?parseInt(l.remaining):1/0,this.suspended=!1,this.target=a}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class Re{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Re.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Re.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Re.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Re.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class vl{constructor(e,a={}){this.duration=je.defaults.note.duration,this.attack=je.defaults.note.attack,this.release=je.defaults.note.release,a.duration!=null&&(this.duration=a.duration),a.attack!=null&&(this.attack=a.attack),a.rawAttack!=null&&(this.attack=Ve.from7bitToFloat(a.rawAttack)),a.release!=null&&(this.release=a.release),a.rawRelease!=null&&(this.release=Ve.from7bitToFloat(a.rawRelease)),Number.isInteger(e)?this.identifier=Ve.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const a=Ve.getNoteDetails(e);if(je.validation&&!e)throw new Error("Invalid note identifier");this._name=a.name,this._accidental=a.accidental,this._octave=a.octave}get name(){return this._name}set name(e){if(je.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(je.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(je.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(je.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(je.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(je.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Ve.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Ve.from7bitToFloat(e)}get rawRelease(){return Ve.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Ve.from7bitToFloat(e)}get number(){return Ve.toNoteNumber(this.identifier)}getOffsetNumber(e=0,a=0){return je.validation&&(e=parseInt(e)||0,a=parseInt(a)||0),Math.min(Math.max(this.number+e*12+a,0),127)}}class Ve{static toNoteNumber(e,a=0){if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const s=this.getNoteDetails(e);if(!s)throw new TypeError("Invalid note identifier");const l={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let o=(s.octave+1+a)*12;if(o+=l[s.name],s.accidental&&(s.accidental.startsWith("b")?o-=s.accidental.length:o+=s.accidental.length),o<0||o>127)throw new RangeError("Invalid octaveOffset value");return o}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const a=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!a)throw new TypeError("Invalid note identifier");const s=a[1].toUpperCase(),l=parseInt(a[3]);let o=a[2].toLowerCase();return o=o===""?void 0:o,{accidental:o,identifier:s+(o||"")+l,name:s,octave:l}}static sanitizeChannels(e){let a;if(je.validation){if(e==="all")a=["all"];else if(e==="none")return[]}return Array.isArray(e)?a=e:a=[e],a.indexOf("all")>-1&&(a=Re.MIDI_CHANNEL_NUMBERS),a.map(function(s){return parseInt(s)}).filter(function(s){return s>=1&&s<=16})}static toTimestamp(e){let a=!1;const s=parseFloat(e);return isNaN(s)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?s>=0&&(a=je.time+s):s>=0&&(a=s),a)}static guessNoteNumber(e,a){a=parseInt(a)||0;let s=!1;if(Number.isInteger(e)&&e>=0&&e<=127)s=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)s=parseInt(e);else if(typeof e=="string"||e instanceof String)try{s=this.toNoteNumber(e.trim(),a)}catch{return!1}return s}static toNoteIdentifier(e,a){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid octaveOffset value");const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=Math.floor(e/12-1)+a;return s[e%12]+l.toString()}static buildNote(e,a={}){if(a.octaveOffset=parseInt(a.octaveOffset)||0,e instanceof vl)return e;let s=this.guessNoteNumber(e,a.octaveOffset);if(s===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return a.octaveOffset=void 0,new vl(s,a)}static buildNoteArray(e,a={}){let s=[];return Array.isArray(e)||(e=[e]),e.forEach(l=>{s.push(this.buildNote(l,a))}),s}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,a=0){je.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),a=Math.min(Math.max(parseInt(a)||0,0),127));const s=((e<<7)+a)/16383;return Math.min(Math.max(s,0),1)}static fromFloatToMsbLsb(e){je.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const a=Math.round(e*16383);return{msb:a>>7,lsb:a&127}}static offsetNumber(e,a=0,s=0){if(je.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");a=parseInt(a)||0,s=parseInt(s)||0}return Math.min(Math.max(e+a*12+s,0),127)}static getPropertyByValue(e,a){return Object.keys(e).find(s=>e[s]===a)}static getCcNameByNumber(e){if(!(je.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return Re.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let a=Re.CONTROL_CHANGE_MESSAGES.find(s=>s.name===e);return a?a.number:Re.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let a in Re.CHANNEL_MODE_MESSAGES)if(Re.CHANNEL_MODE_MESSAGES.hasOwnProperty(a)&&e===Re.CHANNEL_MODE_MESSAGES[a])return a;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}class O1 extends Fr{constructor(e,a){super(),this._output=e,this._number=a,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,a={time:0}){return this.output.send(e,a),this}sendKeyAftertouch(e,a,s={}){if(je.validation){if(s.useRawValue&&(s.rawValue=s.useRawValue),isNaN(parseFloat(a)))throw new RangeError("Invalid key aftertouch value.");if(s.rawValue){if(!(a>=0&&a<=127&&Number.isInteger(a)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(a>=0&&a<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}s.rawValue||(a=Ve.fromFloatTo7Bit(a));const l=je.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Ve.buildNoteArray(e).forEach(o=>{this.send([(Re.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),o.getOffsetNumber(l),a],{time:Ve.toTimestamp(s.time)})}),this}sendControlChange(e,a,s={}){if(typeof e=="string"&&(e=Ve.getCcNumberByName(e)),Array.isArray(a)||(a=[a]),je.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(a=a.map(l=>{const o=Math.min(Math.max(parseInt(l),0),127);if(isNaN(o))throw new TypeError("Values must be integers between 0 and 127");return o}),a.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return a.forEach((l,o)=>{this.send([(Re.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+o*32,a[o]],{time:Ve.toTimestamp(s.time)})}),this}_selectNonRegisteredParameter(e,a={}){return this.sendControlChange(99,e[0],a),this.sendControlChange(98,e[1],a),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,a={}){return this.sendControlChange(101,e[0],a),this.sendControlChange(100,e[1],a),this}_setCurrentParameter(e,a={}){return e=[].concat(e),this.sendControlChange(6,e[0],a),e.length<2?this:(this.sendControlChange(38,e[1],a),this)}sendRpnDecrement(e,a={}){if(Array.isArray(e)||(e=Re.REGISTERED_PARAMETERS[e]),je.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Re.REGISTERED_PARAMETERS).forEach(l=>{Re.REGISTERED_PARAMETERS[l][0]===e[0]&&Re.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(97,0,a),this._deselectRegisteredParameter(a),this}sendRpnIncrement(e,a={}){if(Array.isArray(e)||(e=Re.REGISTERED_PARAMETERS[e]),je.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Re.REGISTERED_PARAMETERS).forEach(l=>{Re.REGISTERED_PARAMETERS[l][0]===e[0]&&Re.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(96,0,a),this._deselectRegisteredParameter(a),this}playNote(e,a={}){this.sendNoteOn(e,a);const s=Array.isArray(e)?e:[e];for(let l of s)if(parseInt(l.duration)>0){const o={time:(Ve.toTimestamp(a.time)||je.time)+parseInt(l.duration),release:l.release,rawRelease:l.rawRelease};this.sendNoteOff(l,o)}else if(parseInt(a.duration)>0){const o={time:(Ve.toTimestamp(a.time)||je.time)+parseInt(a.duration),release:a.release,rawRelease:a.rawRelease};this.sendNoteOff(l,o)}return this}sendNoteOff(e,a={}){if(je.validation){if(a.rawRelease!=null&&!(a.rawRelease>=0&&a.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(a.release!=null&&!(a.release>=0&&a.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");a.rawVelocity&&(a.rawRelease=a.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),a.velocity&&(a.release=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawRelease!=null?s=a.rawRelease:isNaN(a.release)||(s=Math.round(a.release*127));const l=je.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Ve.buildNoteArray(e,{rawRelease:parseInt(s)}).forEach(o=>{this.send([(Re.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),o.getOffsetNumber(l),o.rawRelease],{time:Ve.toTimestamp(a.time)})}),this}stopNote(e,a={}){return this.sendNoteOff(e,a)}sendNoteOn(e,a={}){if(je.validation){if(a.rawAttack!=null&&!(a.rawAttack>=0&&a.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(a.attack!=null&&!(a.attack>=0&&a.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");a.rawVelocity&&(a.rawAttack=a.velocity,a.rawRelease=a.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),a.velocity&&(a.attack=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawAttack!=null?s=a.rawAttack:isNaN(a.attack)||(s=Math.round(a.attack*127));const l=je.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Ve.buildNoteArray(e,{rawAttack:s}).forEach(o=>{this.send([(Re.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),o.getOffsetNumber(l),o.rawAttack],{time:Ve.toTimestamp(a.time)})}),this}sendChannelMode(e,a=0,s={}){if(typeof e=="string"&&(e=Re.CHANNEL_MODE_MESSAGES[e]),je.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(a))||a<0||a>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Re.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,a],{time:Ve.toTimestamp(s.time)}),this}sendOmniMode(e,a={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,a):this.sendChannelMode("omnimodeoff",0,a),this}sendChannelAftertouch(e,a={}){if(je.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(a.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return a.rawValue||(e=Ve.fromFloatTo7Bit(e)),this.send([(Re.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:Ve.toTimestamp(a.time)}),this}sendMasterTuning(e,a={}){if(e=parseFloat(e)||0,je.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let s=Math.floor(e)+64,l=e-Math.floor(e);l=Math.round((l+1)/2*16383);let o=l>>7&127,u=l&127;return this.sendRpnValue("channelcoarsetuning",s,a),this.sendRpnValue("channelfinetuning",[o,u],a),this}sendModulationRange(e,a,s={}){if(je.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(a!=null&&(!Number.isInteger(a)||!(a>=0&&a<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return a>=0&&a<=127||(a=0),this.sendRpnValue("modulationrange",[e,a],s),this}sendNrpnValue(e,a,s={}){if(a=[].concat(a),je.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");a.forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectNonRegisteredParameter(s),this}sendPitchBend(e,a={}){if(je.validation)if(a.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(a.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let s=0,l=0;if(a.rawValue&&Array.isArray(e))s=e[0],l=e[1];else if(a.rawValue&&!Array.isArray(e))s=e;else{const o=Ve.fromFloatToMsbLsb((e+1)/2);s=o.msb,l=o.lsb}return this.send([(Re.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),l,s],{time:Ve.toTimestamp(a.time)}),this}sendPitchBendRange(e,a,s={}){if(je.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(a)||!(a>=0&&a<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,a],s),this}sendProgramChange(e,a={}){if(e=parseInt(e)||0,je.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Re.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Ve.toTimestamp(a.time)}),this}sendRpnValue(e,a,s={}){if(Array.isArray(e)||(e=Re.REGISTERED_PARAMETERS[e]),je.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(a).forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectRegisteredParameter(s),this}sendTuningBank(e,a={}){if(je.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,a),this}sendTuningProgram(e,a={}){if(je.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,a),this}sendLocalControl(e,a={}){return e?this.sendChannelMode("localcontrol",127,a):this.sendChannelMode("localcontrol",0,a)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,a={}){return e==="mono"?this.sendChannelMode("monomodeon",0,a):this.sendChannelMode("polymodeon",0,a)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class Wf extends Fr{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new O1(this,a);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let a={timestamp:je.time};e.port.connection==="open"?(a.type="opened",a.target=this,a.port=a.target,this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",a.target=this,a.port=a.target,this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,a={time:0},s=0){if(e instanceof Ym&&(e=Ve.isNode?e.data:e.rawData),e instanceof Uint8Array&&Ve.isNode&&(e=Array.from(e)),je.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(a)&&(e=e.concat(a)),a=isNaN(s)?{time:0}:{time:s}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(l=>{if(l=parseInt(l),!(l>=0&&l<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),a||(a={time:0})}return this._midiOutput.send(e,Ve.toTimestamp(a.time)),this}sendSysex(e,a=[],s={}){if(e=[].concat(e),a instanceof Uint8Array){const l=new Uint8Array(1+e.length+a.length+1);l[0]=Re.SYSTEM_MESSAGES.sysex,l.set(Uint8Array.from(e),1),l.set(a,1+e.length),l[l.length-1]=Re.SYSTEM_MESSAGES.sysexend,this.send(l,{time:s.time})}else{const l=e.concat(a,Re.SYSTEM_MESSAGES.sysexend);this.send([Re.SYSTEM_MESSAGES.sysex].concat(l),{time:s.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():je.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,a={}){if(je.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Re.SYSTEM_MESSAGES.timecode,e],{time:a.time}),this}sendSongPosition(e=0,a={}){e=Math.floor(e)||0;var s=e>>7&127,l=e&127;return this.send([Re.SYSTEM_MESSAGES.songposition,s,l],{time:a.time}),this}sendSongSelect(e=0,a={}){if(je.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Re.SYSTEM_MESSAGES.songselect,e],{time:a.time}),this}sendTuneRequest(e={}){return this.send([Re.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Re.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Re.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Re.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Re.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Re.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Re.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return je.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,a,s={}){return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendKeyAftertouch(e,a,s)}),this}sendControlChange(e,a,s={},l={}){if(je.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendControlChange(e,a,s)}),this}sendPitchBendRange(e=0,a=0,s={}){return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendPitchBendRange(e,a,s)}),this}setPitchBendRange(e=0,a=0,s="all",l={}){return je.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,a,l)}sendRpnValue(e,a,s={}){return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendRpnValue(e,a,s)}),this}setRegisteredParameter(e,a=[],s="all",l={}){return je.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,a,l)}sendChannelAftertouch(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendChannelAftertouch(e,a)}),this}sendPitchBend(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPitchBend(e,a)}),this}sendProgramChange(e=0,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendProgramChange(e,a)}),this}sendModulationRange(e,a,s={}){return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendModulationRange(e,a,s)}),this}setModulationRange(e=0,a=0,s="all",l={}){return je.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,a,l)}sendMasterTuning(e,a={}){return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendMasterTuning(e,a)}),this}setMasterTuning(e,a={},s={}){return je.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),s.channels=a,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,s)}sendTuningProgram(e,a={}){return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningProgram(e,a)}),this}setTuningProgram(e,a="all",s={}){return je.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),s.channels=a,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,s)}sendTuningBank(e=0,a={}){return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningBank(e,a)}),this}setTuningBank(e,a="all",s={}){return je.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),s.channels=a,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,s)}sendChannelMode(e,a=0,s={},l={}){if(je.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendChannelMode(e,a,s)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},a={}){if(je.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const s=e;e=a,e.channels=s,e.channels==="all"&&(e.channels=Re.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(e.channels).forEach(s=>{this.channels[s].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPolyphonicMode(e,a)}),this}sendLocalControl(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendLocalControl(e,a)}),this}sendOmniMode(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendOmniMode(e,a)}),this}sendNrpnValue(e,a,s={}){return s.channels==null&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendNrpnValue(e,a,s)}),this}setNonRegisteredParameter(e,a=[],s="all",l={}){return je.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,a,l)}sendRpnIncrement(e,a={}){return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnIncrement(e,a)}),this}incrementRegisteredParameter(e,a="all",s={}){return je.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,s)}sendRpnDecrement(e,a={}){return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnDecrement(e,a)}),this}decrementRegisteredParameter(e,a="all",s={}){return je.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Re.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,s)}sendNoteOff(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOff(e,a)}),this}stopNote(e,a){return this.sendNoteOff(e,a)}playNote(e,a={},s={}){if(je.validation&&(a.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),a.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].playNote(e,a)}),this}sendNoteOn(e,a={},s={}){if(je.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Re.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOn(e,a)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class U0{constructor(e=[],a={}){this.destinations=[],this.types=[...Object.keys(Re.SYSTEM_MESSAGES),...Object.keys(Re.CHANNEL_MESSAGES)],this.channels=Re.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),a.types&&!Array.isArray(a.types)&&(a.types=[a.types]),a.channels&&!Array.isArray(a.channels)&&(a.channels=[a.channels]),je.validation&&(e.forEach(s=>{if(!(s instanceof Wf))throw new TypeError("Destinations must be of type 'Output'.")}),a.types!==void 0&&a.types.forEach(s=>{if(!Re.SYSTEM_MESSAGES.hasOwnProperty(s)&&!Re.CHANNEL_MESSAGES.hasOwnProperty(s))throw new TypeError("Type must be a valid message type.")}),a.channels!==void 0&&a.channels.forEach(s=>{if(!Re.MIDI_CHANNEL_NUMBERS.includes(s))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,a.types&&(this.types=a.types),a.channels&&(this.channels=a.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(a=>{je.validation&&!(a instanceof Wf)||a.send(e)}))}}class L1 extends Fr{constructor(e,a){super(),this._input=e,this._number=a,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const a=Object.assign({},e);a.port=this.input,a.target=this,a.type="midimessage",this.emit(a.type,a),this._parseEventForStandardMessages(a)}_parseEventForStandardMessages(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmessage";const s=e.message.dataBytes[0],l=e.message.dataBytes[1];if(a.type==="noteoff"||a.type==="noteon"&&l===0)this.notesState[s]=!1,a.type="noteoff",a.note=new vl(Ve.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+je.octaveOffset),{rawAttack:0,rawRelease:l}),a.value=Ve.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.release,a.rawVelocity=a.note.rawRelease;else if(a.type==="noteon")this.notesState[s]=!0,a.note=new vl(Ve.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+je.octaveOffset),{rawAttack:l}),a.value=Ve.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.attack,a.rawVelocity=a.note.rawAttack;else if(a.type==="keyaftertouch")a.note=new vl(Ve.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+je.octaveOffset)),a.value=Ve.from7bitToFloat(l),a.rawValue=l,a.identifier=a.note.identifier,a.key=a.note.number,a.rawKey=s;else if(a.type==="controlchange"){a.controller={number:s,name:Re.CONTROL_CHANGE_MESSAGES[s].name,description:Re.CONTROL_CHANGE_MESSAGES[s].description,position:Re.CONTROL_CHANGE_MESSAGES[s].position},a.subtype=a.controller.name||"controller"+s,a.value=Ve.from7bitToFloat(l),a.rawValue=l;const o=Object.assign({},a);o.type=`${a.type}-controller${s}`,delete o.subtype,this.emit(o.type,o);const u=Object.assign({},a);u.type=`${a.type}-`+Re.CONTROL_CHANGE_MESSAGES[s].name,delete u.subtype,u.type.indexOf("controller")!==0&&this.emit(u.type,u),a.message.dataBytes[0]>=120&&this._parseChannelModeMessage(a),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(a.message.dataBytes[0])&&this._parseEventForParameterNumber(a)}else a.type==="programchange"?(a.value=s,a.rawValue=a.value):a.type==="channelaftertouch"?(a.value=Ve.from7bitToFloat(s),a.rawValue=s):a.type==="pitchbend"?(a.value=((l<<7)+s-8192)/8192,a.rawValue=(l<<7)+s):a.type="unknownmessage";this.emit(a.type,a)}_parseChannelModeMessage(e){const a=Object.assign({},e);a.type=a.controller.name,a.type==="localcontrol"&&(a.value=a.message.data[2]===127,a.rawValue=a.message.data[2]),a.type==="omnimodeon"?(a.type="omnimode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="omnimodeoff"&&(a.type="omnimode",a.value=!1,a.rawValue=a.message.data[2]),a.type==="monomodeon"?(a.type="monomode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="polymodeon"&&(a.type="monomode",a.value=!1,a.rawValue=a.message.data[2]),this.emit(a.type,a)}_parseEventForParameterNumber(e){const a=e.message.dataBytes[0],s=e.message.dataBytes[1];a===99||a===101?(this._nrpnBuffer=[],this._rpnBuffer=[],a===99?this._nrpnBuffer=[e.message]:s!==127&&(this._rpnBuffer=[e.message])):a===98||a===100?a===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&s!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(a===6||a===38||a===96||a===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,a,s,l){e=e==="nrpn"?"nrpn":"rpn";const o={target:l.target,timestamp:l.timestamp,message:l.message,parameterMsb:a,parameterLsb:s,value:Ve.from7bitToFloat(l.message.dataBytes[1]),rawValue:l.message.dataBytes[1]};e==="rpn"?o.parameter=Object.keys(Re.REGISTERED_PARAMETERS).find(h=>Re.REGISTERED_PARAMETERS[h][0]===a&&Re.REGISTERED_PARAMETERS[h][1]===s):o.parameter=(a<<7)+s;const u=Re.CONTROL_CHANGE_MESSAGES[l.message.dataBytes[0]].name;o.type=`${e}-${u}`,this.emit(o.type,o);const p=Object.assign({},o);p.type==="nrpn-dataincrement"?p.type="nrpn-databuttonincrement":p.type==="nrpn-datadecrement"?p.type="nrpn-databuttondecrement":p.type==="rpn-dataincrement"?p.type="rpn-databuttonincrement":p.type==="rpn-datadecrement"&&(p.type="rpn-databuttondecrement"),this.emit(p.type,p),o.type=e,o.subtype=u,this.emit(o.type,o)}getChannelModeByNumber(e){return je.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Ve.getChannelModeByNumber(e)}getCcNameByNumber(e){if(je.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Ve.getCcNameByNumber(e)}getNoteState(e){e instanceof vl&&(e=e.identifier);const a=Ve.guessNoteNumber(e,je.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[a]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class Ym{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Ve.getPropertyByValue(Re.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Ve.getPropertyByValue(Re.SYSTEM_MESSAGES,this.command)),this.statusByte===Re.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class j1 extends Fr{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new L1(this,a);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let a={timestamp:je.time,target:this,port:this};e.port.connection==="open"?(a.type="opened",this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const a=new Ym(e.data),s={port:this,target:this,message:a,timestamp:e.timeStamp,type:"midimessage",data:a.data,rawData:a.data,statusByte:a.data[0],dataBytes:a.dataBytes};this.emit("midimessage",s),a.isSystemMessage?this._parseEvent(s):a.isChannelMessage&&this.channels[a.channel]._processMidiMessageEvent(s),this._forwarders.forEach(l=>l.forward(a))}_parseEvent(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmidimessage",a.type==="songselect"&&(a.song=e.data[1]+1,a.value=e.data[1],a.rawValue=a.value),this.emit(a.type,a)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){je.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,a,s={}){if(je.validation&&typeof s=="function"){let l=a!=null?[].concat(a):void 0;a=s,s={channels:l}}if(Re.CHANNEL_EVENTS.includes(e)){s.channels===void 0&&(s.channels=Re.MIDI_CHANNEL_NUMBERS);let l=[];return Ve.sanitizeChannels(s.channels).forEach(o=>{l.push(this.channels[o].addListener(e,a,s))}),l}else return super.addListener(e,a,s)}addOneTimeListener(e,a,s={}){return s.remaining=1,this.addListener(e,a,s)}on(e,a,s,l){return this.addListener(e,a,s,l)}hasListener(e,a,s={}){if(je.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}return Re.CHANNEL_EVENTS.includes(e)?(s.channels===void 0&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),Ve.sanitizeChannels(s.channels).every(l=>this.channels[l].hasListener(e,a))):super.hasListener(e,a)}removeListener(e,a,s={}){if(je.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}if(s.channels===void 0&&(s.channels=Re.MIDI_CHANNEL_NUMBERS),e==null)return Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l]&&this.channels[l].removeListener()}),super.removeListener();Re.CHANNEL_EVENTS.includes(e)?Ve.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].removeListener(e,a,s)}):super.removeListener(e,a,s)}addForwarder(e,a={}){let s;return e instanceof U0?s=e:s=new U0(e,a),this._forwarders.push(s),s}removeForwarder(e){this._forwarders=this._forwarders.filter(a=>a!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return je.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class F1 extends Fr{constructor(){super(),this.defaults={note:{attack:Ve.from7bitToFloat(64),release:Ve.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},a=!1){if(Ve.isNode)try{window.navigator}catch{let p=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,p)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:a}),a&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const s={timestamp:this.time,target:this,type:"error",error:void 0},l={timestamp:this.time,target:this,type:"midiaccessgranted"},o={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}this.emit("midiaccessgranted",l),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}return this.emit("enabled",o),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(this._disconnectedInputs[s]._midiInput&&this._disconnectedInputs[s].id===e.toString())return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(this.inputs[s]._midiInput&&this.inputs[s].id===e.toString())return this.inputs[s]}getInputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(~this._disconnectedInputs[s].name.indexOf(e))return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(~this.inputs[s].name.indexOf(e))return this.inputs[s]}getOutputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(~this._disconnectedOutputs[s].name.indexOf(e))return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(~this.outputs[s].name.indexOf(e))return this.outputs[s]}getOutputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(this._disconnectedOutputs[s]._midiOutput&&this._disconnectedOutputs[s].id===e.toString())return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(this.outputs[s]._midiOutput&&this.outputs[s].id===e.toString())return this.outputs[s]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Ve.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?Ve.getNoteDetails(Ve.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Ve.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Ve.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Ve.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,a={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Ve.buildNoteArray(e,a)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Ve.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(a=>e.push(a.destroy())),this.outputs.forEach(a=>e.push(a.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let a={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?a.port=this.getOutputById(e.port.id):e.port.type==="input"&&(a.port=this.getInputById(e.port.id)),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?a.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(a.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let a=this._inputs.length-1;a>=0;a--){const s=this._inputs[a];Array.from(this.interface.inputs.values()).find(o=>o===s._midiInput)||(this._disconnectedInputs.push(s),this._inputs.splice(a,1))}let e=[];return this.interface.inputs.forEach(a=>{if(!this._inputs.find(s=>s._midiInput===a)){let s=this._disconnectedInputs.find(l=>l._midiInput===a);s||(s=new j1(a)),this._inputs.push(s),e.push(s.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let a=this._outputs.length-1;a>=0;a--){const s=this._outputs[a];Array.from(this.interface.outputs.values()).find(o=>o===s._midiOutput)||(this._disconnectedOutputs.push(s),this._outputs.splice(a,1))}let e=[];return this.interface.outputs.forEach(a=>{if(!this._outputs.find(s=>s._midiOutput===a)){let s=this._disconnectedOutputs.find(l=>l._midiOutput===a);s||(s=new Wf(a)),this._outputs.push(s),e.push(s.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Ve.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Ve.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Re.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Re.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Re.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Re.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Re.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const je=new F1;je.constructor=null;const U1=async(n=3)=>{for(let e=0;e<n;e++)try{return je.enabled&&await je.disable(),await je.enable({sysex:!0}),console.log("WebMidi is enabled with SysEx support!"),je}catch(a){if(console.warn(`MIDI initialization attempt ${e+1} failed:`,a),e===n-1)throw console.error("WebMidi could not be enabled after all retries.",a),a;await new Promise(s=>setTimeout(s,500))}},P0=()=>je.enabled?je.inputs.map(n=>({id:n.id,name:n.name})):[],P1=(n,e)=>{if(je.enabled){const a=je.getInputById(n);if(a){const s=u=>{e({type:"noteon",note:u.note.identifier,velocity:u.velocity,controller:null,channel:u.message.channel})},l=u=>{e({type:"noteoff",note:u.note.identifier,velocity:0,controller:null,channel:u.message.channel})},o=u=>{e({type:"controlchange",controller:u.controller.number,value:u.rawValue,note:null,channel:u.message.channel})};return a.addListener("noteon",s),a.addListener("noteoff",l),a.addListener("controlchange",o),()=>{a.removeListener("noteon",s),a.removeListener("noteoff",l),a.removeListener("controlchange",o)}}}return()=>{}},B1=n=>{if(je.enabled){const e=a=>{n(a)};return je.addListener("connected",e),je.addListener("disconnected",e),()=>{je.removeListener("connected",e),je.removeListener("disconnected",e)}}return()=>{}},z1=(n,e)=>{if(je.enabled){const a=je.getInputById(n);if(a){const s=je.outputs.find(l=>l.name===a.name);s?(s.sendSysex(71,e),console.log(`Sent SysEx to ${s.name}`)):console.warn("Could not find matching MIDI Output for SysEx")}}},G1=(n,e,a,s)=>{if(je.enabled){const l=je.getInputById(n);if(l){const o=je.outputs.find(u=>u.name===l.name);o&&o.sendNoteOn(e,{attack:a/127,channels:s})}}},Vm=w.createContext(null),Hc=()=>w.useContext(Vm),B0=n=>{if(!n||typeof n!="object")return{};const e=Object.keys(n);if(e.length===0)return{};const a=n[e[0]];if(Array.isArray(a))return n;console.log("MIDI: Migrating old mapping format to new multi-assignment structure...");const s={};return Object.entries(n).forEach(([l,o])=>{if(!o||!o.type||o.channel===void 0||o.address===void 0)return;const u=`${o.type}:${o.channel}:${o.address}`;s[u]||(s[u]=[]),s[u].push({controlId:l,requiresShift:!!o.requiresShift,targetType:"position",label:o.label||`${o.requiresShift?"":""}CH${o.channel}:${o.address}`})}),s},H1=({children:n,onMidiCommand:e})=>{const[a,s]=w.useState(!1),[l,o]=w.useState([]),[u,p]=w.useState(""),[h,g]=w.useState(!1),[v,S]=w.useState(null),[x,b]=w.useState({}),[T,M]=w.useState(null),[R,I]=w.useState(!1),Q=w.useRef(!1),A=w.useRef(e);w.useEffect(()=>{A.current=e},[e]),w.useEffect(()=>((async()=>{try{if(await U1(),s(!0),o(P0()),B1(()=>{console.log("MIDI Device change detected, refreshing inputs..."),o(P0())}),window.electronAPI&&window.electronAPI.getMidiMappings){const pe=await window.electronAPI.getMidiMappings();if(pe){const me=B0(pe);console.log("Loaded and migrated MIDI mappings:",me),b(me)}}}catch(pe){console.error("MIDI Init Failed:",pe)}})(),()=>{je.enabled&&je.disable()}),[]),w.useEffect(()=>{(async()=>{if(!a||l.length===0)return;let pe=u;if(!pe&&window.electronAPI?.getSelectedMidiInput){const me=await window.electronAPI.getSelectedMidiInput();me&&l.some(X=>X.id===me)&&(pe=me)}(!pe||!l.some(me=>me.id===pe))&&(pe=l[0].id),pe!==u&&(console.log(`MIDI: Auto-selecting input: ${pe}`),p(pe))})()},[a,l,u]);const _=async()=>{window.electronAPI&&window.electronAPI.saveMidiMappings&&(await window.electronAPI.saveMidiMappings(x),console.log("MIDI mappings saved to default."))},k=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(x,"midi")},G=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const J=await window.electronAPI.importMappings("midi");if(J.success&&J.mappings){const pe=B0(J.mappings);b(pe),console.log("MIDI mappings imported and migrated.")}}},F=J=>{const pe=l.find(me=>me.id===J);pe&&pe.name.toLowerCase().includes("apc40")&&(console.log("Detected APC40, sending initialization SysEx..."),z1(J,[127,41,96,0,4,65,1,1,1]))};w.useEffect(()=>{u&&window.electronAPI&&window.electronAPI.saveSelectedMidiInput&&window.electronAPI.saveSelectedMidiInput(u),u&&a&&F(u)},[u,a,l]);const K=w.useCallback((J,pe,me="inactive",X=null)=>{if(!a)return;const $=(he,Ce,Pe)=>{const Ke=he.feedbackMode||"toggle",Xe=he.feedbackConfig||{};return Ke==="clip"?Pe==="active"?Xe.activeVelocity??127:Pe==="previewing"?Xe.previewVelocity??64:Pe==="inactive"?Xe.inactiveVelocity??1:Pe==="empty"?Xe.emptyVelocity??0:0:Ke==="slider"?Math.round(Ce*127):Ke==="dropdown"?Ce?Xe.onVelocity??127:Xe.offVelocity??0:(typeof Ce=="boolean"?Ce:Ce>0)?Xe.onVelocity??127:Xe.offVelocity??0};Object.entries(x).forEach(([he,Ce])=>{Array.isArray(Ce)&&Ce.forEach(Pe=>{if(Pe.controlId===J){const[Ke,Xe,wt]=he.split(":");if(Ke==="note"){const dt=X!==null?X:Pe.blinkMode!==void 0?Pe.blinkMode+1:parseInt(Xe),_e=Pe.outputDeviceId||u;if(_e&&_e!=="any"){const Ze=$(Pe,pe,me);G1(_e,wt,Ze,dt)}}}})})},[u,a,x]);w.useEffect(()=>{let J=()=>{};return u&&(console.log(`(Re)binding MIDI listener for: ${u}`),J=P1(u,pe=>{le.current&&M(pe),N(pe)})),J},[u,h,v,x,l]);const le=w.useRef(h);w.useEffect(()=>{le.current=h},[h]);const H=(J,pe,me)=>`${J==="noteon"||J==="noteoff"?"note":"cc"}:${pe}:${me}`,N=J=>{if(J.channel===1&&J.note==="D7"){const $=J.type==="noteon";I($),Q.current=$;return}if(h&&v){if(J.type==="noteoff")return;const $=J.note||J.controller,he=Q.current,Ce=H(J.type,J.channel,$);let Pe="toggle",Ke={onVelocity:127,offVelocity:0};v.startsWith("clip_")?(Pe="clip",Ke={activeVelocity:127,previewVelocity:64,inactiveVelocity:1,emptyVelocity:0}):v.includes("intensity")||v.includes("speed")||v.includes("dimmer")||v.includes("knob")?Pe="slider":v.includes("_item_")&&(Pe="dropdown",Ke={onVelocity:127,offVelocity:0});const Xe={controlId:v,requiresShift:he,targetType:"position",inputDeviceId:u,outputDeviceId:u,label:`${he?"":""}CH${J.channel}:${$}`,feedbackMode:Pe,feedbackConfig:Ke,blinkMode:0};b(wt=>{const dt=wt[Ce]||[];return dt.some(_e=>_e.controlId===v)?wt:{...wt,[Ce]:[...dt,Xe]}}),S(null);return}const me=H(J.type,J.channel,J.note||J.controller),X=x[me];X&&X.length>0&&X.forEach($=>{const Ce=!me.startsWith("note:")||!!$.requiresShift===Q.current,Pe=!$.inputDeviceId||$.inputDeviceId==="any"||$.inputDeviceId===u;if(Ce&&Pe&&A.current){let Ke;J.type==="controlchange"?Ke=J.value??0:J.type==="noteoff"?Ke=0:Ke=J.velocity??0,A.current($.controlId,Ke,127,J.type,$)}})},z={midiInitialized:a,midiInputs:l,selectedMidiInputId:u,setSelectedMidiInputId:p,isMapping:h,startMapping:()=>g(!0),stopMapping:()=>{g(!1),S(null)},learningId:v,setLearningId:S,mappings:x,setMappings:b,removeMapping:J=>{b(pe=>{const me={...pe};return Object.keys(me).forEach(X=>{me[X]=me[X].filter($=>$.controlId!==J),me[X].length===0&&delete me[X]}),me})},removeAssignment:(J,pe)=>{b(me=>{if(!me[J])return me;const X={...me};return X[J]=X[J].filter($=>$.controlId!==pe),X[J].length===0&&delete X[J],X})},saveMappings:_,exportMappings:k,importMappings:G,initializeApc40:F,sendFeedback:K,lastMidiEvent:T,isShiftDown:R};return f.jsx(Vm.Provider,{value:z,children:n})},qm=w.createContext(null),ud=()=>w.useContext(qm),Y1=({children:n,onArtnetCommand:e})=>{const[a,s]=w.useState(!1),[l,o]=w.useState(!1),[u,p]=w.useState(null),[h,g]=w.useState({}),[v,S]=w.useState(null),x=w.useRef(e);w.useEffect(()=>{x.current=e},[e]),w.useEffect(()=>{(async()=>{try{if(window.electronAPI&&window.electronAPI.initializeArtnet&&(await window.electronAPI.initializeArtnet()).success&&(s(!0),console.log("Art-Net initialized for mapping")),window.electronAPI&&window.electronAPI.getArtnetMappings){const G=await window.electronAPI.getArtnetMappings();G&&(console.log("Loaded saved Art-Net mappings:",G),g(G))}}catch(G){console.error("Art-Net Init Failed:",G)}})()},[]);const b=async()=>{window.electronAPI&&window.electronAPI.saveArtnetMappings&&(await window.electronAPI.saveArtnetMappings(h),console.log("Art-Net mappings saved."))},T=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(h,"artnet")},M=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const k=await window.electronAPI.importMappings("artnet");k.success&&k.mappings&&(g(k.mappings),console.log("Art-Net mappings imported."))}};w.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onArtnetDataReceived)return window.electronAPI.onArtnetDataReceived(G=>{R.current&&S(G),I(G)})},[l,u,h]);const R=w.useRef(l);w.useEffect(()=>{R.current=l},[l]);const I=k=>{const{universe:G,channel:F,value:K}=k;if(l&&u){if(K===0)return;const le={universe:G,channel:F,label:`U${G}:CH${F+1}`};console.log(`Mapped ${u} to Art-Net:`,le),g(H=>({...H,[u]:le})),p(null);return}Object.entries(h).forEach(([le,H])=>{H.universe===G&&H.channel===F&&x.current&&x.current(le,K)})},_={artnetInitialized:a,isMapping:l,startMapping:()=>o(!0),stopMapping:()=>{o(!1),p(null)},learningId:u,setLearningId:p,mappings:h,setMappings:g,saveMappings:b,exportMappings:T,importMappings:M,lastDmxEvent:v};return f.jsx(qm.Provider,{value:_,children:n})},Xm=w.createContext(null),fd=()=>w.useContext(Xm),V1=({children:n,onCommand:e,enabled:a=!1})=>{const[s,l]=w.useState(!1),[o,u]=w.useState(null),[p,h]=w.useState({}),g=w.useRef(e);w.useEffect(()=>{g.current=e},[e]),w.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getKeyboardMappings){const M=await window.electronAPI.getKeyboardMappings();M&&h(M)}})()},[]);const v=async()=>{window.electronAPI&&window.electronAPI.saveKeyboardMappings&&await window.electronAPI.saveKeyboardMappings(p)},S=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(p,"keyboard")},x=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const T=await window.electronAPI.importMappings("keyboard");T.success&&T.mappings&&h(T.mappings)}};w.useEffect(()=>{const T=M=>{if(a&&!(M.target.tagName==="INPUT"||M.target.tagName==="TEXTAREA"||M.target.isContentEditable)){if(s&&o){M.preventDefault();const R={key:M.code,label:M.code.replace("Key","").replace("Digit","")};h(I=>({...I,[o]:R})),u(null);return}Object.entries(p).forEach(([R,I])=>{M.code===I.key&&(M.preventDefault(),g.current&&g.current(R,1,1,"keydown"))})}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[a,s,o,p]);const b={isMapping:s,startMapping:()=>l(!0),stopMapping:()=>{l(!1),u(null)},learningId:o,setLearningId:u,mappings:p,setMappings:h,saveMappings:v,exportMappings:S,importMappings:x,removeMapping:T=>h(M=>{const R={...M};return delete R[T],R})};return f.jsx(Xm.Provider,{value:b,children:n})},pn=({id:n,children:e,style:a})=>{const{isMapping:s,setLearningId:l,removeMapping:o,setMappings:u}=Hc(),{isMapping:p,setLearningId:h,removeMapping:g}=ud()||{},{isMapping:v,setLearningId:S,removeMapping:x}=fd()||{},b=s||p||v,T=(I,Q=null)=>{if(b){I.preventDefault(),I.stopPropagation();const A=Q!==null?`${n}_item_${Q}`:n;s&&l(A),p&&h(A),v&&S(A)}},M=I=>{b&&(I.preventDefault(),I.stopPropagation(),s&&o(n),p&&g(n),v&&x(n))},R=Bn.Children.only(e);return R.type==="select"&&b?Bn.cloneElement(R,{"data-mappable-id":n,onClickCapture:T,onContextMenu:M,className:`${R.props.className||""} mappable-target`.trim(),children:Bn.Children.map(R.props.children,I=>{if(I.type==="option"){const Q=`${n}_item_${I.props.value||I.props.children}`;return f.jsxs("option",{...I.props,"data-mappable-id":Q,style:{...I.props.style,color:"var(--theme-color)"},children:[I.props.children," [Mappable]"]})}return I})}):Bn.cloneElement(R,{"data-mappable-id":n,onClickCapture:b?T:R.props.onClickCapture,onContextMenu:b?M:R.props.onContextMenu,className:`${R.props.className||""} ${b?"mappable-target":""}`.trim(),style:{...R.props.style,...a}})},q1=({masterIntensity:n,onMasterIntensityChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_intensity",targetType:"global",label:"MASTER",min:0,max:1,step:.01}))};return f.jsx("div",{className:"master-intensity-slider",draggable:!0,onDragStart:a,children:f.jsx(pn,{id:"master_intensity",children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n,className:"slider_hor",id:"masterIntensityRange",onChange:s=>e(parseFloat(s.target.value))})})})},X1=({masterIntensity:n,onMasterIntensityChange:e,onClearAllActive:a,isGlobalBlackout:s,onToggleGlobalBlackout:l})=>{const o=(u,p)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:p,targetType:"global",label:p.toUpperCase()}))};return f.jsxs("div",{className:"composition-controls",children:[f.jsx("span",{className:"layer-control-button",children:"Comp"}),f.jsx(pn,{id:"comp_clear",children:f.jsx("span",{className:"layer-control-button",onClick:a,style:{cursor:"pointer"},draggable:!0,onDragStart:u=>o(u,"clear"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsx(pn,{id:"comp_blackout",style:{width:"100%",display:"flex"},children:f.jsx("span",{className:"layer-control-button",onClick:l,style:{cursor:"pointer",backgroundColor:s?"red":""},draggable:!0,onDragStart:u=>o(u,"blackout"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx(q1,{masterIntensity:n,onMasterIntensityChange:e})]})},$1=({name:n,index:e,onTrigger:a,onShowColumnHeaderContextMenu:s})=>{const l=u=>{u.preventDefault(),s&&s(e)},o=u=>{u.button===0&&a&&a()};return f.jsx(pn,{id:`column_${e}`,children:f.jsx("div",{className:"column-header trigger-button",onClick:o,onContextMenu:l,style:{cursor:"pointer"},children:n})})},xl=[{id:"rotate",name:"Rotate",type:"transform",description:"Rotates the shape around its center.",defaultParams:{angle:0,speed:0,direction:"CW"},paramControls:[{id:"angle",label:"Angle",type:"range",min:0,max:360,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["CW","CCW"]}]},{id:"scale",name:"Scale",type:"transform",description:"Scales the shape.",defaultParams:{scaleX:1,scaleY:1},paramControls:[{id:"scaleX",label:"Scale X",type:"range",min:.01,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"range",min:.01,max:5,step:.01}]},{id:"translate",name:"Translate",type:"transform",description:"Moves the shape.",defaultParams:{translateX:0,translateY:0},paramControls:[{id:"translateX",label:"Translate X",type:"range",min:-1,max:1,step:.01},{id:"translateY",label:"Translate Y",type:"range",min:-1,max:1,step:.01}]},{id:"color",name:"Color",type:"color",description:"Changes the color of the shape with solid, rainbow or custom palette modes.",defaultParams:{mode:"solid",color:"#ffffff",r:255,g:255,b:255,cycleSpeed:0,rainbowSpread:1,rainbowOffset:0,rainbowPalette:"rainbow",paletteColors:["#ff0000","#00ff00","#0000ff","#ffff00"],paletteSize:4,paletteSpread:1,hue:0,saturation:0,brightness:1,enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["solid","rainbow","palette"]},{id:"color",label:"Color",type:"color",showIf:{mode:"solid"}},{id:"hue",label:"Hue",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"saturation",label:"Saturation",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"brightness",label:"Brightness",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"paletteSize",label:"Palette Size",type:"range",min:2,max:16,step:1,showIf:{mode:"palette"}},{id:"paletteSpread",label:"Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"palette"}},{id:"cycleSpeed",label:"Cycle Speed",type:"range",min:0,max:10,step:.1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowSpread",label:"Rainbow Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"rainbow"}},{id:"rainbowOffset",label:"Offset",type:"range",min:0,max:360,step:1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowPalette",label:"Preset",type:"select",options:["rainbow","fire","ice","cyber"],showIf:{mode:"rainbow"}}]},{id:"wave",name:"Wave",type:"animation",description:"Applies a wave distortion to the shape.",defaultParams:{amplitude:.1,frequency:10,speed:1,direction:"x"},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:.01,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["x","y"]}]},{id:"warp",name:"Warp",type:"animation",description:"Symmetrical chaotic wave distortion.",defaultParams:{amount:.1,chaos:.5,speed:1},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1}]},{id:"distortion",name:"Distortion",type:"transform",description:"Distorts the point data.",defaultParams:{amount:.1,scale:10,speed:.5},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"scale",label:"Scale",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:5,step:.1}]},{id:"move",name:"Move (Bounce)",type:"transform",description:"Moves points and bounces them off the borders.",defaultParams:{speedX:.1,speedY:.1},paramControls:[{id:"speedX",label:"Speed X",type:"range",min:0,max:2,step:.01},{id:"speedY",label:"Speed Y",type:"range",min:0,max:2,step:.01}]},{id:"delay",name:"Delay",type:"effect",description:"Frame or Channel based delay effect.",defaultParams:{mode:"segment",playstyle:"repeat",useCustomOrder:!1,delayDirection:"left_to_right",delayAmount:5,decay:.8,steps:10,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat"]},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"delayDirection",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}},{id:"steps",label:"Steps",type:"range",min:2,max:20,step:1,showIf:{mode:["segment","frame"]}},{id:"delayAmount",label:"Delay Time",type:"range",min:1,max:60,step:1},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01}]},{id:"chase",name:"Chase",type:"effect",description:"Frame or Channel based chase effect.",defaultParams:{mode:"segment",playstyle:"repeat",steps:4,decay:.8,speed:1,overlap:1,direction:"left_to_right",useCustomOrder:!1,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat","bounce"]},{id:"steps",label:"Steps",type:"range",min:2,max:16,step:1,showIf:{mode:"segment"}},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:5,step:.1},{id:"overlap",label:"Overlap",type:"range",min:1,max:4,step:1},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"direction",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}}]},{id:"blanking",name:"Blanking",type:"animation",description:"Controls the blanking of the laser output.",defaultParams:{blankingInterval:0,spacing:0},paramControls:[{id:"blankingInterval",label:"Blanking Interval",type:"range",min:0,max:10,step:1},{id:"spacing",label:"Spacing",type:"range",min:0,max:20,step:1}]},{id:"strobe",name:"Strobe",type:"animation",description:"Applies a strobe effect to the laser output.",defaultParams:{strobeSpeed:100,strobeAmount:.5},paramControls:[{id:"strobeSpeed",label:"Strobe Speed (ms)",type:"range",min:10,max:1e3,step:10},{id:"strobeAmount",label:"Strobe Amount (0-1)",type:"range",min:0,max:1,step:.01}]},{id:"mirror",name:"Mirror",type:"transform",description:"Mirrors the shape from the center.",defaultParams:{mode:"none",additive:!0,axisOffset:0,planeRotation:0},paramControls:[{id:"mode",label:"Mirror Mode",type:"select",options:["none","x+","x-","y+","y-"]},{id:"additive",label:"Additive",type:"checkbox"},{id:"axisOffset",label:"Axis Offset",type:"range",min:-1,max:1,step:.01},{id:"planeRotation",label:"Plane Rotation",type:"range",min:0,max:360,step:1}]}],W1=xl.reduce((n,e)=>(n[e.id]=e,n),{});function z0(n,e,a,s){const l=e.style||"loop",o=e.direction||"forward";if(o==="pause")return a;let u=n;l==="bounce"&&(u*=2);let p=0;if(l==="once")p=Math.min(u,1),o==="backward"&&(p=1-p);else if(l==="bounce"){let h=u%1;Math.floor(u)%2===1?p=1-h:p=h,o==="backward"&&(p=1-p)}else p=u%1,o==="backward"&&(p=1-p);return s&&Array.isArray(s)&&s.length===2?s[0]+(s[1]-s[0])*p:a}function jc(n,e,a,s,l,o){if(!a)return e;const u=typeof a=="string"?{syncMode:a}:a;if(!u.syncMode)return e;const{time:p,progress:h=0,bpm:g=120,clipDuration:v=0,fftLevels:S={low:0,mid:0,high:0},activationTime:x=0}=s;let b=u.range;(!b||!Array.isArray(b)||b.length!==2)&&l!==void 0&&o!==void 0&&(b=[l,o]);let T=0;const M=u.speedMultiplier||1;if((u.style||"loop")==="once"&&x>0){const I=(p-x)*.001;let Q=1;if(u.syncMode==="timeline")Q=Math.max(.01,u.duration||1);else if(u.syncMode==="bpm"){const A=Math.max(.1,u.beats||4),_=g/60;Q=A/(_||2)}else if(u.syncMode==="fps")return T=I*M,z0(T,u,e,b);T=I/Q*M}else if(u.syncMode==="fps")T=p*.001*M;else if(u.syncMode==="timeline"){const I=Math.max(.01,u.duration||1);v>0?T=h*v/I*M:T=0}else if(u.syncMode==="bpm"){const I=Math.max(.1,u.beats||4),Q=g/60,A=I/(Q||2);v>0?T=h*v/A*M:T=0}else if(u.syncMode==="fft"){const I=S[u.fftRange||"low"]||0;return b?b[0]+(b[1]-b[0])*I:e}return z0(T,u,e,b)}let Zf=new Float32Array(1024*8);function Z1(n){Zf.length<n*8&&(Zf=new Float32Array(n*8*2))}function bo(n,e,a={}){const{progress:s=0,time:l=performance.now(),effectStates:o,syncSettings:u={},fftLevels:p}=a;if(!e||e.length===0)return n;const h=n.points,g=n.isTypedArray||h instanceof Float32Array,v=g?h.length/8:h.length;Z1(v);const S=Zf.subarray(0,v*8);if(g)S.set(h);else for(let T=0;T<v;T++){const M=h[T],R=T*8;S[R]=M.x,S[R+1]=M.y,S[R+2]=M.z||0,S[R+3]=M.r,S[R+4]=M.g,S[R+5]=M.b,S[R+6]=M.blanking?1:0,S[R+7]=M.lastPoint?1:0}let x=S;for(const T of e){const M=T.params;if(M.enabled===!1||!W1[T.id])continue;const I=x.length/8;let Q=M;const A=T.instanceId?`${T.instanceId}.`:`${T.id}.`;let _=!1;for(const k in M)if(u[A+k]){_=!0;break}if(_){Q={...M};for(const k in Q){const G=A+k;u[G]&&(Q[k]=jc(k,Q[k],u[G],a))}}switch(T.id){case"rotate":Q1(x,I,Q,s,l);break;case"scale":K1(x,I,Q);break;case"translate":J1(x,I,Q);break;case"color":tv(x,I,Q,l);break;case"wave":av(x,I,Q,l);break;case"blanking":rv(x,I,Q);break;case"strobe":sv(x,I,Q,l);break;case"mirror":x=iv(x,I,Q);break;case"warp":lv(x,I,Q,l);break;case"distortion":ov(x,I,Q,l);break;case"move":cv(x,I,Q,l);break;case"delay":o&&T.instanceId&&(x=uv(x,I,Q,o,T.instanceId,a));break;case"chase":x=fv(x,I,Q,l,a);break}}const b=new Float32Array(x);return x._channelDistributions&&(b._channelDistributions=x._channelDistributions),{...n,points:b,isTypedArray:!0}}function Q1(n,e,a,s,l){const{angle:o,speed:u,direction:p}=a,h=p==="CCW"?-1:1,g=l*.001*u*h,v=o*Math.PI/180+g,S=Math.sin(v),x=Math.cos(v);for(let b=0;b<e;b++){const T=b*8,M=n[T],R=n[T+1];n[T]=M*x-R*S,n[T+1]=M*S+R*x}}function K1(n,e,a){const{scaleX:s,scaleY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]*=s,n[u+1]*=l}}function J1(n,e,a){const{translateX:s,translateY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]+=s,n[u+1]+=l}}function G0(n){if(!n)return{r:255,g:255,b:255};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function ev(n,e,a){let s,l,o;const u=Math.floor(n*6),p=n*6-u,h=a*(1-e),g=a*(1-p*e),v=a*(1-(1-p)*e);switch(u%6){case 0:s=a,l=v,o=h;break;case 1:s=g,l=a,o=h;break;case 2:s=h,l=a,o=v;break;case 3:s=h,l=g,o=a;break;case 4:s=v,l=h,o=a;break;case 5:s=a,l=h,o=g;break}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function tv(n,e,a,s){const{mode:l,r:o,g:u,b:p,color:h,hue:g,saturation:v,brightness:S,cycleSpeed:x,rainbowSpread:b,rainbowOffset:T,rainbowPalette:M,paletteColors:R=[],paletteSize:I=4,paletteSpread:Q=1}=a,A=s*.001*x;if(l==="palette"){const _=Math.min(R.length,I),k=R.slice(0,_).map(G0);k.length===0&&k.push({r:255,g:255,b:255});for(let G=0;G<e;G++){const F=G*8,le=(G/e*Q+A*.5+T/360)%1*k.length,H=Math.floor(le)%k.length,N=(H+1)%k.length,V=le-Math.floor(le),U=k[H],q=k[N];n[F+3]=Math.round(U.r+(q.r-U.r)*V),n[F+4]=Math.round(U.g+(q.g-U.g)*V),n[F+5]=Math.round(U.b+(q.b-U.b)*V)}}else if(l==="rainbow"){const _=M||"rainbow";for(let k=0;k<e;k++){const G=k*8,F=(k/e*b+A*.5+T/360)%1;let K,le,H;_==="rainbow"?[K,le,H]=H0(F,1,.5):[K,le,H]=nv(_,F),n[G+3]=K,n[G+4]=le,n[G+5]=H}}else{let _=o,k=u,G=p;if(g!==void 0&&v!==void 0&&S!==void 0)[_,k,G]=ev(g,v,S);else if(h){const F=G0(h);_=F.r,k=F.g,G=F.b}if(x>0){const F=A*50%360,[K,le,H]=H0(F/360,1,.5);for(let N=0;N<e;N++){const V=N*8;n[V+3]=K,n[V+4]=le,n[V+5]=H}}else for(let F=0;F<e;F++){const K=F*8;n[K+3]=_,n[K+4]=k,n[K+5]=G}}}function nv(n,e){const a={fire:[{r:255,g:0,b:0},{r:255,g:128,b:0},{r:255,g:255,b:0},{r:255,g:0,b:0}],ice:[{r:0,g:0,b:255},{r:0,g:255,b:255},{r:255,g:255,b:255},{r:0,g:0,b:255}],cyber:[{r:255,g:0,b:255},{r:0,g:255,b:255},{r:0,g:0,b:255},{r:255,g:0,b:255}]},s=a[n]||a.fire,l=e*(s.length-1),o=Math.floor(l),u=l-o,p=s[o],h=s[o+1]||s[o];return[Math.round(p.r+(h.r-p.r)*u),Math.round(p.g+(h.g-p.g)*u),Math.round(p.b+(h.b-p.b)*u)]}function H0(n,e,a){let s,l,o;{const u=(g,v,S)=>(S<0&&(S+=1),S>1&&(S-=1),S<.16666666666666666?g+(v-g)*6*S:S<.5?v:S<.6666666666666666?g+(v-g)*(.6666666666666666-S)*6:g),p=a+e-a*e,h=2*a-p;s=u(h,p,n+1/3),l=u(h,p,n),o=u(h,p,n-1/3)}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function av(n,e,a,s){const{amplitude:l,frequency:o,speed:u,direction:p}=a,h=s*.001*u;for(let g=0;g<e;g++){const v=g*8;p==="x"?n[v+1]+=l*Math.sin(n[v]*o+h):p==="y"&&(n[v]+=l*Math.sin(n[v+1]*o+h))}}function rv(n,e,a){const{blankingInterval:s,spacing:l=0}=a;if(s<=0)return;const o=s+1+l;for(let u=0;u<e;u++)u%o>=s&&(n[u*8+6]=1)}function sv(n,e,a,s){const{strobeSpeed:l,strobeAmount:o}=a;if(s%l/l<o)for(let p=0;p<e;p++)n[p*8+6]=1}function iv(n,e,a){const{mode:s,additive:l=!0,axisOffset:o=0,planeRotation:u=0}=a;if(s==="none"||e===0)return n;const p=u*Math.PI/180,h=Math.cos(p),g=Math.sin(p),v={x:0,y:0},S=(M,R)=>{let I=M,Q=R;if(p!==0){const A=M*h+R*g,_=-M*g+R*h;I=A,Q=_}if(s==="x-"||s==="x+"?I=2*o-I:(s==="y-"||s==="y+")&&(Q=2*o-Q),p!==0){const A=I*h-Q*g,_=I*g+Q*h;I=A,Q=_}v.x=I,v.y=Q},x=(M,R)=>{if(l)return!0;let I=M,Q=R;return p!==0&&(I=M*h+R*g,Q=-M*g+R*h),s==="x+"?I>=o:s==="x-"?I<=o:s==="y+"?Q>=o:s==="y-"?Q<=o:!0};let b;const T=n._channelDistributions;if(T){b=new Float32Array((e*2+T.size*2+50)*8);const M=new Map;let R=0;for(const[Q,A]of T){const _=A.length/8,k=A.start,G=R;let F=0,K=!0;for(let le=0;le<_;le++){const H=k+le*8,N=x(n[H],n[H+1]);N&&(!K&&F>0&&(b.set(n.subarray(H,H+8),R),b[R+6]=1,b[R+3]=0,b[R+4]=0,b[R+5]=0,R+=8,F++),b.set(n.subarray(H,H+8),R),R+=8,F++),K=N}if(F>0){const le=R-8;b.set(b.subarray(le,le+8),R),b[R+6]=1,b[R+3]=0,b[R+4]=0,b[R+5]=0,R+=8;let H=!0,N=0;for(let V=_-1;V>=0;V--){const U=k+V*8,q=x(n[U],n[U+1]);if(q){!H&&N>0&&(b.set(n.subarray(U,U+8),R),S(b[R],b[R+1]),b[R]=v.x,b[R+1]=v.y,b[R+6]=1,b[R+3]=0,b[R+4]=0,b[R+5]=0,R+=8),b.set(n.subarray(U,U+8),R);const ie=R;S(b[ie],b[ie+1]),b[ie]=v.x,b[ie+1]=v.y,V===_-1?(b[ie+6]=1,b[ie+3]=0,b[ie+4]=0,b[ie+5]=0,b[ie+7]=0):(b[ie+3]=n[U+8+3],b[ie+4]=n[U+8+4],b[ie+5]=n[U+8+5],b[ie+6]=n[U+8+6],b[ie+7]=n[U+8+7]),R+=8,N++}H=q}M.set(Q,{start:G,length:R-G})}}const I=new Float32Array(R);return I.set(b.subarray(0,R)),I._channelDistributions=M,I}else{b=new Float32Array((e*2+50)*8);let M=0,R=0,I=!0;for(let Q=0;Q<e;Q++){const A=Q*8,_=x(n[A],n[A+1]);_&&(!I&&R>0&&(b.set(n.subarray(A,A+8),M),b[M+6]=1,b[M+3]=0,b[M+4]=0,b[M+5]=0,M+=8,R++),b.set(n.subarray(A,A+8),M),M+=8,R++),I=_}if(R>0){const Q=M-8;b.set(b.subarray(Q,Q+8),M),b[M+6]=1,b[M+3]=0,b[M+4]=0,b[M+5]=0,M+=8;let A=!0,_=0;for(let k=e-1;k>=0;k--){const G=k*8,F=x(n[G],n[G+1]);if(F){!A&&_>0&&(b.set(n.subarray(G,G+8),M),S(b[M],b[M+1]),b[M]=v.x,b[M+1]=v.y,b[M+6]=1,b[M+3]=0,b[M+4]=0,b[M+5]=0,M+=8),b.set(n.subarray(G,G+8),M);const K=M;S(b[K],b[K+1]),b[K]=v.x,b[K+1]=v.y,k===e-1?(b[K+6]=1,b[K+3]=0,b[K+4]=0,b[K+5]=0,b[K+7]=0):(b[K+3]=n[G+8+3],b[K+4]=n[G+8+4],b[K+5]=n[G+8+5],b[K+6]=n[G+8+6],b[K+7]=n[G+8+7]),M+=8,_++}A=F}}return b.slice(0,M)}}function lv(n,e,a,s){const{amount:l,chaos:o,speed:u}=a,p=s*.001*u;for(let h=0;h<e;h++){const g=h*8,v=n[g],S=n[g+1],x=Math.abs(S);n[g]+=Math.sin(x*10*(1+o)+p)*l*Math.cos(p*o),n[g+1]+=Math.cos(Math.abs(v)*10*(1+o)+p)*l*Math.sin(p*o)}}function ov(n,e,a,s){const{amount:l,scale:o,speed:u}=a,p=s*.001*u;for(let h=0;h<e;h++){const g=h*8,v=Math.sin(n[g]*o+p)*Math.cos(n[g+1]*o-p),S=Math.cos(n[g]*o-p)*Math.sin(n[g+1]*o+p);n[g]+=v*l,n[g+1]+=S*l}}function cv(n,e,a,s){const{speedX:l,speedY:o}=a,u=s*.001,p=u*l,h=u*o,g=4;for(let v=0;v<e;v++){const S=v*8;let x=n[S]+p,b=n[S+1]+h,T=(x+1)%g;T<0&&(T+=g),T>2&&(T=4-T),x=T-1;let M=(b+1)%g;M<0&&(M+=g),M>2&&(M=4-M),b=M-1,n[S]=x,n[S+1]=b}}function uv(n,e,a,s,l,o){const{mode:u="segment",delayAmount:p,decay:h,delayDirection:g,useCustomOrder:v,customOrder:S,playstyle:x="repeat",steps:b=10}=a;s.has(l)||s.set(l,[]);const T=s.get(l);if(T.unshift(new Float32Array(n)),u==="segment"){const M=p*b+1;T.length>M&&(T.length=M);const R=new Float32Array(n.length);for(let I=0;I<e;I++){let Q=0;const A=I/e;g==="left_to_right"?Q=Math.floor(A*b):g==="right_to_left"?Q=Math.floor((1-A)*b):g==="center_to_out"?Q=Math.floor(Math.abs(A-.5)*2*b):g==="out_to_center"&&(Q=Math.floor((1-Math.abs(A-.5)*2)*b)),Q=Math.min(b-1,Math.max(0,Q));const _=Q*p,k=_<T.length?T[_]:null,G=Math.pow(h,Q),F=I*8;if(k&&k.length>0){let K;if(k.length===n.length)K=F;else{const H=k.length/8;let N=Math.floor(A*H);N>=H&&(N=H-1),K=N*8}R[F]=k[K],R[F+1]=k[K+1],R[F+2]=k[K+2],R[F+3]=k[K+3]*G,R[F+4]=k[K+4]*G,R[F+5]=k[K+5]*G;const le=n[F+6]>.5;if(R[F+6]=le?1:k[K+6],R[F+6]>.5&&(R[F+3]=0,R[F+4]=0,R[F+5]=0),R[F+7]=k[K+7],I>0){const H=(I-1)/e;let N=0;if(g==="left_to_right"?N=Math.floor(H*b):g==="right_to_left"?N=Math.floor((1-H)*b):g==="center_to_out"?N=Math.floor(Math.abs(H-.5)*2*b):g==="out_to_center"&&(N=Math.floor((1-Math.abs(H-.5)*2)*b)),N=Math.min(b-1,Math.max(0,N)),N!==Q){R[F+6]=1,R[F+3]=0,R[F+4]=0,R[F+5]=0;const V=(I-1)*8;R[V+6]=1,R[V+3]=0,R[V+4]=0,R[V+5]=0}}}else R.set(n.subarray(F,F+8),F),R[F+3]=0,R[F+4]=0,R[F+5]=0,R[F+6]=1}return n._channelDistributions&&(R._channelDistributions=n._channelDistributions),R}else if(u==="frame"){const M=b,R=p*M+1;T.length>R&&(T.length=R);const I=[];for(let k=0;k<M;k++){const G=k*p,F=G<T.length?T[G]:null;I.push({points:F,factor:Math.pow(h,k)})}let Q=0;for(let k=0;k<I.length;k++){const G=I[k].points||n;Q+=G.length/8,k<I.length-1&&(Q+=1)}const A=new Float32Array(Q*8);let _=0;for(let k=0;k<I.length;k++){const G=I[k],F=G.points||n,K=G.factor,le=F.length/8;for(let H=0;H<le;H++){const N=H*8,V=_+H*8;A[V]=F[N],A[V+1]=F[N+1],A[V+2]=F[N+2],A[V+3]=F[N+3]*K,A[V+4]=F[N+4]*K,A[V+5]=F[N+5]*K,A[V+6]=F[N+6],A[V+7]=F[N+7]}if(_+=le*8,k<I.length-1){const H=(le-1)*8,N=_;A[N]=F[H],A[N+1]=F[H+1],A[N+2]=F[H+2],A[N+3]=0,A[N+4]=0,A[N+5]=0,A[N+6]=1,A[N+7]=0,_+=8}}return n._channelDistributions&&(A._channelDistributions=n._channelDistributions),A}else{const{assignedDacs:M}=o||{};let R=new Map,I=0;if(v||a.delayMode==="channel")(S&&S.length>0?S.map(V=>V.originalIndex):M?M.map((V,U)=>U):[0]).forEach((V,U)=>{R.set(V,U),I=Math.max(I,U)});else{const V=(M||[]).length||1;for(let U=0;U<V;U++){let q=U;g==="right_to_left"?q=V-1-U:g==="center_to_out"?q=Math.floor(Math.abs(U-(V-1)/2)):g==="out_to_center"&&(q=Math.min(U,V-1-U)),R.set(U,q),I=Math.max(I,q)}}const A=I+1,_=p*A+1;T.length>_&&(T.length=_);const k=[];for(let N=0;N<A;N++){const V=N*p;k.push({points:V<T.length?T[V]:null,factor:Math.pow(h,N),index:N})}const G=k.reduce((N,V)=>N+(V.points?V.points.length/8:n.length/8),0),F=new Float32Array(G*8);let K=0;const le=new Array(k.length);for(let N=0;N<k.length;N++){const V=k[N],U=V.points,q=U?U.length/8:n.length/8;le[N]=K;for(let ie=0;ie<q;ie++){const z=ie*8,J=K+ie*8;U?(F[J]=U[z],F[J+1]=U[z+1],F[J+2]=U[z+2],F[J+3]=U[z+3]*V.factor,F[J+4]=U[z+4]*V.factor,F[J+5]=U[z+5]*V.factor,F[J+6]=U[z+6],F[J+7]=U[z+7]):F[J+6]=1}K+=q*8}const H=new Map;return R.forEach((N,V)=>{N<k.length&&H.set(V,{start:le[N],length:k[N].points?k[N].points.length:n.length})}),F._channelDistributions=H,F}}function fv(n,e,a,s,l={}){const{mode:o="segment",steps:u,decay:p,speed:h,overlap:g,direction:v,useCustomOrder:S,customOrder:x,playstyle:b="loop"}=a,{progress:T=0,clipDuration:M=1,syncSettings:R={}}=l,I=a.instanceId?`${a.instanceId}.`:"chase.",Q=!!R[I+"speed"],A=T!==void 0&&M>0||Q;if(o==="segment"){const _=u;let k=(A?T*_:s*.001)*h;if(b==="bounce"){const F=_,K=k%(F*2);k=K>F?F*2-K:K}else b==="once"?k=Math.min(k,_):k=k%_;const G=new Float32Array(n.length);for(let F=0;F<e;F++){const K=F/e;let le=0;v==="left_to_right"?le=Math.min(_-1,Math.floor(K*_)):v==="right_to_left"?le=Math.min(_-1,Math.floor((1-K)*_)):v==="center_to_out"?le=Math.min(_-1,Math.floor(Math.abs(K-.5)*2*_)):v==="out_to_center"&&(le=Math.min(_-1,Math.floor((1-Math.abs(K-.5)*2)*_)));let H=Math.abs(k-le);H>_/2&&(H=_-H);let N=H<g?1-H/g:0;p>0&&(N=Math.pow(N,1-p));const V=F*8;if(G.set(n.subarray(V,V+8),V),G[V+3]*=N,G[V+4]*=N,G[V+5]*=N,(N<.05||n[V+6]>.5)&&(G[V+6]=1,G[V+3]=0,G[V+4]=0,G[V+5]=0),F>0){const U=(F-1)/e;let q=0;if(v==="left_to_right"?q=Math.min(_-1,Math.floor(U*_)):v==="right_to_left"?q=Math.min(_-1,Math.floor((1-U)*_)):v==="center_to_out"?q=Math.min(_-1,Math.floor(Math.abs(U-.5)*2*_)):v==="out_to_center"&&(q=Math.min(_-1,Math.floor((1-Math.abs(U-.5)*2)*_))),q!==le){G[V+6]=1,G[V+3]=0,G[V+4]=0,G[V+5]=0;const ie=(F-1)*8;G[ie+6]=1,G[ie+3]=0,G[ie+4]=0,G[ie+5]=0}}}return n._channelDistributions&&(G._channelDistributions=n._channelDistributions),G}else{const{assignedDacs:_}=l||{};let k=new Map,G=0;if(S)(x&&x.length>0?x.map(ie=>ie.originalIndex):_?_.map((ie,z)=>z):[0]).forEach((ie,z)=>{k.set(ie,z),G++});else{G=(_?_.length:1)||1;for(let q=0;q<G;q++){let ie=q;v==="right_to_left"?ie=G-1-q:v==="center_to_out"?ie=Math.floor(Math.abs(q-(G-1)/2)):v==="out_to_center"&&(ie=Math.min(q,G-1-q)),k.set(q,ie)}}const F=G;let K=(A?T*F:s*.001)*h;if(b==="bounce"){const q=F,ie=K%(q*2);K=ie>q?q*2-ie:ie}else b==="once"?K=Math.min(K,F):K=K%F;const le=e*G,H=new Float32Array(le*8),N=new Map;let V=0;const U=Array.from(k.keys());U.length===0&&U.push(0);for(const q of U){const ie=k.get(q)||0;let z=Math.abs(K-ie);z>F/2&&(z=F-z);let J=z<g?1-z/g:0;p>0&&(J=Math.pow(J,1-p));const pe=V;for(let me=0;me<e;me++){const X=me*8,$=V+me*8;H.set(n.subarray(X,X+8),$),H[$+3]*=J,H[$+4]*=J,H[$+5]*=J,J<.05&&(H[$+6]=1)}N.set(q,{start:pe,length:e*8}),V+=e*8}return H._channelDistributions=N,H}}function Qf(n,e,a=!1){if(!e||!n||!n.points)return n;const{safetyZones:s,outputArea:l,transformationEnabled:o,transformationMode:u,flipX:p,flipY:h}=e;let g=n.points;const v=n.isTypedArray||g instanceof Float32Array,S=v?g.length/8:g.length;let x=a?g:v?new Float32Array(g):g.map(b=>({...b}));for(let b=0;b<S;b++){let T,M,R,I,Q,A;if(v?(T=x[b*8],M=x[b*8+1],R=x[b*8+3],I=x[b*8+4],Q=x[b*8+5],A=x[b*8+6]):(T=x[b].x,M=x[b].y,R=x[b].r,I=x[b].g,Q=x[b].b,A=x[b].blanking?1:0),o&&l){let _=(T+1)/2,k=(1-M)/2;u==="crop"?(_<l.x||_>l.x+l.w||k<l.y||k>l.y+l.h)&&(R=0,I=0,Q=0,A=1):u==="scale"&&(_=l.x+_*l.w,k=l.y+k*l.h,T=_*2-1,M=1-k*2)}if(s&&s.length>0){let _=(T+1)/2,k=(1-M)/2;for(const G of s)if(_>=G.x&&_<=G.x+G.w&&k>=G.y&&k<=G.y+G.h){R=0,I=0,Q=0,A=1;break}}p&&(T=-T),h&&(M=-M),T=Math.max(-1,Math.min(1,T)),M=Math.max(-1,Math.min(1,M)),v?(x[b*8]=T,x[b*8+1]=M,x[b*8+3]=R,x[b*8+4]=I,x[b*8+5]=Q,x[b*8+6]=A):(x[b].x=T,x[b].y=M,x[b].r=R,x[b].g=I,x[b].b=Q,x[b].blanking=A>.5)}return{...n,points:x,isTypedArray:v}}const Y0=.08,V0=4;function dd(n){if(!n)return new Float32Array(0);const e=n instanceof Float32Array||n.isTypedArray,a=e?n.length/8:n.length;if(a>4e3){if(n instanceof Float32Array)return n;const h=new Float32Array(a*8);for(let g=0;g<a;g++){const v=n[g];h[g*8]=v.x,h[g*8+1]=v.y,h[g*8+2]=v.z||0,h[g*8+3]=v.r,h[g*8+4]=v.g,h[g*8+5]=v.b,h[g*8+6]=v.blanking?1:0,h[g*8+7]=v.lastPoint?1:0}return h}const s=[],l=(h,g,v,S,x,b,T)=>{const M=T?0:S,R=T?0:x,I=T?0:b;s.push(h,g,v,M,R,I,T?1:0,0)},o=h=>{if(e){const g=h*8;return{x:n[g],y:n[g+1],z:n[g+2],r:n[g+3],g:n[g+4],b:n[g+5],blanking:n[g+6]>.5}}else{const g=n[h];return{x:g.x||0,y:g.y||0,z:g.z||0,r:g.r||0,g:g.g||0,b:g.b||0,blanking:!!g.blanking}}};if(a===0)return new Float32Array(0);let u=o(0);for(let h=0;h<a;h++){const g=o(h);if(u.blanking!==g.blanking)if(g.blanking)for(let b=0;b<V0;b++)l(u.x,u.y,u.z,0,0,0,!0);else{l(g.x,g.y,g.z,0,0,0,!0);for(let b=0;b<V0;b++)l(g.x,g.y,g.z,0,0,0,!0)}const v=g.x-u.x,S=g.y-u.y,x=Math.sqrt(v*v+S*S);if(x>Y0){const b=Math.floor(x/Y0);for(let T=1;T<b;T++){const M=T/b;l(u.x+v*M,u.y+S*M,u.z+(g.z-u.z)*M,g.blanking?0:g.r,g.blanking?0:g.g,g.blanking?0:g.b,g.blanking)}}l(g.x,g.y,g.z,g.r,g.g,g.b,g.blanking),u=g}const p=new Float32Array(s);return n._channelDistributions&&(p._channelDistributions=n._channelDistributions),p}class dv{constructor(e,a){if(this.canvas=e,this.type=a,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.animationFrameId=null,this.frameIndexes=Array(10).fill(0),this.pointIndexes=Array(10).fill(0),this.showBeamEffect=!1,this.beamAlpha=.5,this.fadeAlpha=.13,this.beamRenderMode="both",this.positionBuffer=null,this.colorBuffer=null,this.alphaBuffer=null,this.alphaBufferData=new Float32Array(131072),this.lastPointDrawTime=0,!this.gl){console.error("WebGL not supported");return}this.setup()}setup(){const e=this.gl,a=`
      attribute vec2 aPosition;
      attribute vec3 aColor;
      attribute float aAlpha;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        gl_PointSize = 2.0;
        vColor = aColor;
        vAlpha = aAlpha;
      }
    `,s=`
      precision mediump float;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_FragColor = vec4(vColor, vAlpha);
      }
    `,l=this.createShader(e.VERTEX_SHADER,a),o=this.createShader(e.FRAGMENT_SHADER,s),u=this.createProgram(l,o);this.program=u,this.positionAttributeLocation=e.getAttribLocation(u,"aPosition"),this.colorAttributeLocation=e.getAttribLocation(u,"aColor"),this.alphaAttributeLocation=e.getAttribLocation(u,"aAlpha"),this.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer);const p=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(p),e.STATIC_DRAW),this.quadColorUniformLocation=e.getUniformLocation(u,"uColor"),this.quadAlphaUniformLocation=e.getUniformLocation(u,"uAlpha");const h=`
      attribute vec2 aPosition;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `,g=`
      precision mediump float;
      uniform vec4 uColor;
      void main() {
        gl_FragColor = uColor;
      }
    `,v=this.createShader(e.VERTEX_SHADER,h),S=this.createShader(e.FRAGMENT_SHADER,g);this.fadeProgram=this.createProgram(v,S),this.fadePositionAttributeLocation=e.getAttribLocation(this.fadeProgram,"aPosition"),this.fadeColorUniformLocation=e.getUniformLocation(this.fadeProgram,"uColor"),e.useProgram(u);const x=131072;this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,x*2*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,x*3*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.alphaBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.alphaBuffer),e.bufferData(e.ARRAY_BUFFER,x*1*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1)}reset(){this.frameIndexes.fill(0),this.pointIndexes.fill(0),this.clearCanvas()}createShader(e,a){const s=this.gl,l=s.createShader(e);if(s.shaderSource(l,a),s.compileShader(l),s.getShaderParameter(l,s.COMPILE_STATUS))return l;console.error(s.getShaderInfoLog(l)),s.deleteShader(l)}createProgram(e,a){const s=this.gl,l=s.createProgram();if(s.attachShader(l,e),s.attachShader(l,a),s.linkProgram(l),s.getProgramParameter(l,s.LINK_STATUS))return l;console.error(s.getProgramInfoLog(l)),s.deleteProgram(l)}render(e){e.showBeamEffect!==void 0&&this.setBeamEffect(e.showBeamEffect),e.beamAlpha!==void 0&&this.setBeamAlpha(e.beamAlpha),e.fadeAlpha!==void 0&&this.setFadeAlpha(e.fadeAlpha),e.beamRenderMode!==void 0&&(this.beamRenderMode=e.beamRenderMode),this.type==="world"?this.renderWorld(e.worldData,e.previewScanRate,e.layerIntensities,e.masterIntensity,e.dacSettings,e.previewTime,e.fftLevels,e.optimizationEnabled):this.renderSingle(e.ildaFrames,e.previewScanRate,e.intensity,e.effects,e.syncSettings,e.bpm,e.clipDuration,e.progress,e.previewTime,e.fftLevels,e.effectStates,e.optimizationEnabled)}renderSingle(e,a,s,l,o={},u=120,p=1,h=null,g=null,v={low:0,mid:0,high:0},S=null,x=!0){const b=this.gl;if(b.viewport(0,0,b.canvas.width,b.canvas.height),this.drawFadeQuad(),!e||e.length===0)return;const T=this.frameIndexes[0]%e.length,M=e[T],R=h!==null?h:T/e.length,I=g!==null?g:performance.now();this.draw(M,l,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,s,0,R,I,o,u,p,v,S,x),this.frameIndexes[0]++,this.frameIndexes[0]>=e.length&&(this.frameIndexes[0]=0)}renderWorld(e,a,s,l,o,u=null,p={low:0,mid:0,high:0},h=!0){const g=this.gl;g.viewport(0,0,g.canvas.width,g.canvas.height),this.drawFadeQuad();const v=u!==null?u:performance.now();e.forEach(S=>{if(S&&S.frames&&S.frames.length>0){const x=S.frames[0];if(x){const b=S.layerIndex||0;if(S.syncSettings,S.bpm,b>=this.frameIndexes.length){const R=b+5;for(;this.frameIndexes.length<R;)this.frameIndexes.push(0),this.pointIndexes.push(0)}const M=(s[b]!==void 0?s[b]:1)*l;if(M>.001){const R=S.progress!==void 0?S.progress:this.frameIndexes[b]%S.frames.length/S.frames.length,{syncSettings:I={},bpm:Q=120,clipDuration:A=1,effectStates:_=null}=S;let k=x;if(o){let G=x;if(o.dimmer!==void 0&&o.dimmer<1){const F=x.points,K=x.isTypedArray||F instanceof Float32Array,le=K?F.length/8:F.length,H=K?new Float32Array(F):F.map(N=>({...N}));for(let N=0;N<le;N++)K?(H[N*8+3]*=o.dimmer,H[N*8+4]*=o.dimmer,H[N*8+5]*=o.dimmer):(H[N].r*=o.dimmer,H[N].g*=o.dimmer,H[N].b*=o.dimmer);G={...x,points:H,isTypedArray:K}}k=Qf(G,o)}this.draw(k,S.effects,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,M,b,R,v,I,Q,A,p,_,h)}}}}),e.forEach(S=>{if(S&&S.frames){const x=S.layerIndex||0;this.frameIndexes[x]++,this.frameIndexes[x]>=S.frames.length&&(this.frameIndexes[x]=0)}})}drawFadeQuad(){const e=this.gl;this.fadeProgram&&(e.useProgram(this.fadeProgram),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer),e.enableVertexAttribArray(this.fadePositionAttributeLocation),e.vertexAttribPointer(this.fadePositionAttributeLocation,2,e.FLOAT,!1,0,0),e.uniform4f(this.fadeColorUniformLocation,0,0,0,this.fadeAlpha),e.drawArrays(e.TRIANGLES,0,6))}setBeamEffect(e){this.showBeamEffect=e}setBeamAlpha(e){this.beamAlpha=e}setFadeAlpha(e){this.fadeAlpha=e}draw(e,a,s,l,o,u,p=1,h=0,g=0,v=performance.now(),S={},x=120,b=1,T={low:0,mid:0,high:0},M=null,R=!0){if(this.gl,!e||!e.points)return;let I=e;if(R){const V=dd(e.points);I={...e,points:V,isTypedArray:!0}}const Q=bo(I,a,{progress:g,time:v,syncSettings:S,bpm:x,clipDuration:b,fftLevels:T,effectStates:M}),A=Q.points,_=Q.isTypedArray,k=_?A.length/8:A.length;if(k===0)return;const G=Math.max(1,Math.floor(k/o));let F=this.pointIndexes[h]||0;F>=k&&(F=0);const K=V=>{const U=(F+V)%k;if(_){const q=U*8;return{x:A[q],y:A[q+1],r:A[q+3],g:A[q+4],b:A[q+5],blanking:A[q+6]===1}}else{const q=A[U];return{x:q.x,y:q.y,r:q.r,g:q.g,b:q.b,blanking:q.blanking}}},le=()=>{const V=u==="points"||u==="both";if(u==="lines"||u==="both"){let q=[],ie=[],z=K(0);for(let J=1;J<G;J++){const pe=K(J),me=(F+J)%k,X=(F+J-1)%k,$=me<X;pe.blanking||$?q.length>0&&(this._drawSegment(new Float32Array(q),new Float32Array(ie),1,q.length/2,!1),q=[],ie=[]):(q.length===0&&(q.push(z.x,z.y),ie.push(pe.r/255*p,pe.g/255*p,pe.b/255*p)),q.push(pe.x,pe.y),ie.push(pe.r/255*p,pe.g/255*p,pe.b/255*p)),z=pe}q.length>0&&this._drawSegment(new Float32Array(q),new Float32Array(ie),1,q.length/2,!1)}if(V){const q=[],ie=[];for(let z=0;z<G;z++){const J=K(z);J.blanking||(q.push(J.x,J.y),ie.push(J.r/255*p,J.g/255*p,J.b/255*p))}q.length>0&&this._drawSegment(new Float32Array(q),new Float32Array(ie),1,q.length/2,!0)}},H=()=>{const V=[],U=[];for(let q=0;q<G;q++){const ie=K(q);if(!ie.blanking){V.push(0,0,ie.x,ie.y);const z=[ie.r/255*p,ie.g/255*p,ie.b/255*p];U.push(...z,...z)}}V.length>0&&this._drawLines(new Float32Array(V),new Float32Array(U),l,V.length/2)},N=()=>{const V=[],U=[];let q=K(0);for(let ie=1;ie<G;ie++){const z=K(ie);if((F+ie)%k<(F+ie-1)%k){q=z;continue}if(!z.blanking){V.push(0,0,q.x,q.y,z.x,z.y);const pe=[z.r/255*p,z.g/255*p,z.b/255*p],me=[z.r/255*p,z.g/255*p,z.b/255*p],X=[pe[0],pe[1],pe[2]],$=.3,he=[pe[0]*$,pe[1]*$,pe[2]*$],Ce=[me[0]*$,me[1]*$,me[2]*$];U.push(...X,...he,...Ce)}q=z}V.length>0&&this._drawTriangles(new Float32Array(V),new Float32Array(U),l,V.length/2)};le(),s&&(u==="points"?H():u==="lines"?N():u==="both"&&(N(),H())),this.pointIndexes[h]=(F+G)%k}_drawSegment(e,a,s,l,o=!1){const u=this.gl;u.useProgram(this.program),u.bindBuffer(u.ARRAY_BUFFER,this.positionBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,e),u.enableVertexAttribArray(this.positionAttributeLocation),u.vertexAttribPointer(this.positionAttributeLocation,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,this.colorBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,a),u.enableVertexAttribArray(this.colorAttributeLocation),u.vertexAttribPointer(this.colorAttributeLocation,3,u.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const p=this.alphaBufferData.subarray(0,l);u.bindBuffer(u.ARRAY_BUFFER,this.alphaBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,p),u.enableVertexAttribArray(this.alphaAttributeLocation),u.vertexAttribPointer(this.alphaAttributeLocation,1,u.FLOAT,!1,0,0),u.drawArrays(o?u.POINTS:u.LINE_STRIP,0,l)}_drawLines(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.LINES,0,l)}_drawTriangles(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,l)}clearCanvas(){const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}destroy(){if(cancelAnimationFrame(this.animationFrameId),this.gl){const e=this.gl.getExtension("WEBGL_losing_context");e&&e.loseContext()}}}const $m=({frame:n,effects:e,width:a=100,height:s=100})=>{const l=w.useRef(null),o=w.useRef(null),[u,p]=w.useState(null);return w.useEffect(()=>(l.current&&!o.current&&(o.current=new dv(l.current,"single")),()=>{o.current&&(o.current.destroy(),o.current=null)}),[]),w.useEffect(()=>{if(!n){p(null);return}let h=n;if(e&&e.length>0){const g=n.points,v=n.isTypedArray||g instanceof Float32Array;let S;v?S=new Float32Array(g):S=g.map(b=>({...b}));const x={...n,points:S,isTypedArray:v};h=bo(x,e,{time:performance.now(),progress:0,effectStates:new Map})}p(h)},[n,e]),w.useEffect(()=>{o.current&&u?o.current.render({ildaFrames:[u],previewScanRate:1,intensity:1,effects:[],syncSettings:{}}):o.current&&o.current.clearCanvas()},[u]),f.jsx("div",{className:"clip-thumbnail",style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"black"},children:f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"100%",height:"100%",backgroundColor:"black"}})})},pv=({frame:n,bitmap:e,width:a=50,height:s=50})=>{const l=w.useRef(null);return w.useEffect(()=>{const o=l.current;if(!o)return;const u=o.getContext("2d");if(e){u.clearRect(0,0,a,s),u.drawImage(e,0,0,a,s);return}if(!n||!n.points)return;u.fillStyle="#000000",u.fillRect(0,0,a,s);const p=n.points,h=n.isTypedArray||p instanceof Float32Array,g=h?p.length/8:p.length;u.lineWidth=1.5,u.lineCap="round";let v=null,S=null;for(let x=0;x<g;x++){let b,T,M,R,I,Q;if(h)b=p[x*8],T=p[x*8+1],M=p[x*8+3],R=p[x*8+4],I=p[x*8+5],Q=p[x*8+6]>.5;else{const k=p[x];b=k.x,T=k.y,M=k.r,R=k.g,I=k.b,Q=k.blanking}const A=(b+1)*.5*a,_=(1-(T+1)*.5)*s;if(Q){v=null,S=null;continue}else if(v!==null){u.beginPath(),u.moveTo(v,S),u.lineTo(A,_);const k=Math.floor(Math.max(0,Math.min(255,M))),G=Math.floor(Math.max(0,Math.min(255,R))),F=Math.floor(Math.max(0,Math.min(255,I)));u.strokeStyle=`rgb(${k},${G},${F})`,u.stroke()}v=A,S=_}},[n,a,s]),f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"50px",height:"50px",backgroundColor:"black",display:"block",borderRadius:"5px"}})},pd=Bn.memo(pv),hv=({layerName:n,index:e,onDropEffect:a,onDropDac:s,layerEffects:l,activeClipData:o,onDeactivateLayerClips:u,onShowLayerFullContextMenu:p,thumbnailRenderMode:h,intensity:g,onIntensityChange:v,liveFrame:S,isBlackout:x,isSolo:b,onToggleBlackout:T,onToggleSolo:M,onLayerSelect:R})=>{const[I,Q]=w.useState(l||[]),[A,_]=w.useState(!1),[k,G]=w.useState(!1);w.useEffect(()=>{Q(l||[])},[l]);const F=w.useMemo(()=>[...o?.effects||[],...l||[]],[o?.effects,l]),K=(q,ie,z,J,pe)=>{q.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:ie,paramName:z,targetType:J,layerIndex:e,label:pe}))},le=q=>{q.preventDefault(),console.log(`Right-clicked LayerControls at index: ${e}`),p&&p(e)},H=q=>{q.preventDefault(),q.stopPropagation(),_(!0),q.dataTransfer.dropEffect="copy"},N=q=>{q.preventDefault(),q.stopPropagation(),_(!1)},V=q=>{q.preventDefault(),q.stopPropagation(),_(!1);const ie=q.dataTransfer.getData("application/json");if(ie)try{const J=JSON.parse(ie);if(J.type==="transform"||J.type==="animation"||J.type==="color"||J.type==="effect"){if(a){a(J.id||J.name);return}}else if((J.isGroup||J.ip&&(typeof J.channel=="number"||J.allChannels))&&s){s(e,J);return}}catch(J){console.error("Error parsing drop data in LayerControls:",J)}const z=q.dataTransfer.getData("text/plain");if(z.startsWith("effect_")){const J=z.replace("effect_","");a&&a(J)}},U=h==="active"||h==="hover"&&k;return f.jsxs("div",{className:`layer-controls ${A?"dragging":""}`,onContextMenu:le,onDragOver:H,onDragLeave:N,onDrop:V,children:[f.jsxs("div",{className:"grid-layer",children:[f.jsx(pn,{id:`layer_${e}_clear`,children:f.jsx("span",{className:"layer-control-button full-height",onClick:()=>u(e),draggable:!0,onDragStart:q=>K(q,"toggle","clear","layer",`L${e+1} Clear`),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsxs("div",{className:"layer-control-group",children:[f.jsx(pn,{id:`layer_${e}_blackout`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:T,style:{backgroundColor:x?"red":""},draggable:!0,onDragStart:q=>K(q,"toggle","blackout","layer",`L${e+1} Blackout`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx(pn,{id:`layer_${e}_solo`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:M,style:{backgroundColor:b?"var(--theme-color)":"",color:b?"black":""},draggable:!0,onDragStart:q=>K(q,"toggle","solo","layer",`L${e+1} Solo`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-1-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M9.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z"}),f.jsx("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"})]})})})]}),f.jsxs("select",{className:"layer-blend-dropdown",children:[f.jsx("option",{children:"Normal"}),f.jsx("option",{children:"Add"}),f.jsx("option",{children:"Subtract"})]})]}),f.jsx("div",{className:"layer-control-row",children:f.jsx(pn,{id:`layer_${e}_intensity`,children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,className:"slider_ver",id:"layer-intensity-slider",onChange:q=>v(parseFloat(q.target.value))})})}),f.jsx("div",{className:"layer-preview-thumbnail",onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),style:{overflow:"hidden"},children:o?U?f.jsx($m,{frame:S||o.stillFrame,effects:F}):o.thumbnailPath?f.jsx("img",{src:`file://${o.thumbnailPath}?t=${o.thumbnailVersion||Date.now()}`,alt:"layer-thumbnail",style:{width:"100%",height:"100%",objectFit:"contain"}}):f.jsx(pd,{frame:o.stillFrame}):I.length>0&&f.jsx("div",{className:"applied-effects",children:I.map((q,ie)=>f.jsx("span",{className:"effect-tag",children:(q.name||q.id||"???").substring(0,3).toUpperCase()},q.instanceId||ie))})}),f.jsx("span",{className:"layer-name-label",onClick:()=>R&&R(e),children:n})]})},mv=({clipName:n,layerIndex:e,colIndex:a,pageId:s,onDropGenerator:l,onDropEffect:o,clipContent:u,thumbnailFrameIndex:p,onUnsupportedFile:h,onActivateClick:g,onLabelClick:v,isSelected:S,isActive:x,ildaParserWorker:b,onDropDac:T,thumbnailRenderMode:M,liveFrame:R,stillFrame:I,onClipHover:Q,onThumbnailError:A})=>{const[_,k]=w.useState(!1),[G,F]=w.useState(!1),K=n,le=M==="active"||M==="hover"&&_,H=me=>{me.preventDefault(),me.stopPropagation(),F(!0),me.dataTransfer.dropEffect="copy"},N=me=>{me.preventDefault(),me.stopPropagation(),me.currentTarget.contains(me.relatedTarget)||F(!1)},V=()=>{k(!0),Q&&Q(e,a,!0)},U=()=>{k(!1),g(!1),Q&&Q(e,a,!1)},q=async me=>{const X=me.name;if(!b){h("ILDA parser not available.");return}if(X.toLowerCase().endsWith(".ild"))try{const $=await me.arrayBuffer();console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFileDrop): ${$.byteLength}`),b.postMessage({type:"parse-ilda",arrayBuffer:$,fileName:X,filePath:me.path,layerIndex:e,colIndex:a,pageId:s},[$])}catch($){console.error("[Clip.jsx] handleFileDrop - Error reading file:",$),h(`Error reading file: ${$.message}`)}else h("Please drop a valid .ild file")},ie=async(me,X)=>{if(!X.toLowerCase().endsWith(".ild")){console.log("Unsupported file type:",X),h("Please drop a valid .ild file");return}if(!b){h("ILDA parser not available.");return}try{if(window.electronAPI&&window.electronAPI.readFileAsBinary){const $=await window.electronAPI.readFileAsBinary(me);if(!$||!($ instanceof ArrayBuffer)){console.error("[Clip.jsx] readFileAsBinary did not return an ArrayBuffer:",$),h("Error reading file: Invalid data format received.");return}console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFilePathDrop): ${$.byteLength}`),b.postMessage({type:"parse-ilda",arrayBuffer:$,fileName:X,filePath:me,layerIndex:e,colIndex:a,pageId:s},[$])}else h("Binary file access not available")}catch($){console.error("Error processing file path:",$),console.error("Error stack:",$.stack),h(`Error processing file: ${$.message}`)}},z=me=>{me.preventDefault(),me.stopPropagation(),F(!1);const X=me.dataTransfer.getData("application/json");if(X)try{const he=JSON.parse(X);if(he.filePath&&he.fileName){ie(he.filePath,he.fileName);return}if(he.type==="transform"||he.type==="animation"||he.type==="color"||he.type==="effect"){if(o){o(he),v();return}}else if(he.isGroup||he.ip&&(typeof he.channel=="number"||he.allChannels)){if(T){T(e,a,he);return}}else if(he.name&&l){l(e,a,he);return}}catch(he){console.error("Error parsing dropped data:",he)}const $=me.dataTransfer.files;if($&&$.length>0){q($[0]);return}console.log("No recognized data format found in drop"),h("No valid ILD file, effect, or generator dropped.")},J=me=>{me.preventDefault(),me.stopPropagation()},pe=me=>{me.preventDefault(),window.electronAPI&&window.electronAPI.showClipContextMenu&&window.electronAPI.showClipContextMenu(e,a,u?.triggerStyle||"normal")};return f.jsxs("div",{className:`clip ${G?"dragging":""} ${x?"active-clip":""} `,onDragEnter:J,onDragOver:H,onDragLeave:N,onDrop:z,onContextMenu:pe,children:[f.jsx(pn,{id:`clip_${e}_${a}`,children:f.jsx("div",{className:"clip-thumbnail",onMouseDown:me=>{me.button===0&&g(!0)},onMouseUp:me=>{me.button===0&&g(!1)},onMouseEnter:V,onMouseLeave:U,style:{overflow:"hidden"},children:u&&u.parsing?f.jsx("div",{className:"clip-loading-spinner"}):f.jsxs(f.Fragment,{children:[le&&u?f.jsx($m,{frame:R||I,effects:u?.effects}):u?.thumbnailPath?f.jsx("img",{src:`file://${u.thumbnailPath}?t=${u.thumbnailVersion||Date.now()}`,alt:"thumbnail",onError:()=>A&&A(e,a),style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"}}):I&&f.jsx(pd,{frame:I}),u?.triggerStyle&&u.triggerStyle!=="normal"&&f.jsxs("p",{className:"clip_icons",children:[u.triggerStyle==="toggle"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-toggles",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7"})}),u.triggerStyle==="flash"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-lightning-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"})})]})]})})}),f.jsx(pn,{id:`clip_${e}_${a}_preview`,children:f.jsx("span",{className:`clip-label ${S?"selected-clip":""}`,onClick:v,children:K})})]})},gv=Bn.memo(mv),Wm=w.createContext(null),Zm=()=>w.useContext(Wm),yv=({children:n})=>{const[e,a]=w.useState(null);return w.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(Wm.Provider,{value:e,children:n})},vv=({onDropIld:n,viewMode:e="list",onViewModeChange:a,path:s,onPathChange:l})=>{const[o,u]=w.useState([]),[p,h]=w.useState({}),[g,v]=w.useState(new Set),S=Zm(),x=w.useRef(new Set),b=w.useRef([]),T=w.useRef(!1),M=s,R=l,I=w.useCallback(()=>{if(T.current||b.current.length===0||!S)return;T.current=!0;const A=b.current.shift(),_=A.split(/[/\\]/).pop();S.postMessage({type:"load-and-parse-ilda",fileName:_,filePath:A,browserFile:!0,stopAtFirstFrame:!0})},[S]);w.useEffect(()=>{if(!S)return;const A=_=>{_.data.browserFile&&(_.data.type==="parse-ilda"?_.data.success?S.postMessage({type:"get-frame",workerId:_.data.workerId,frameIndex:0,browserFile:!0,filePath:_.data.filePath}):(console.warn(`[FileBrowser] Skipping invalid ILDA file: ${_.data.filePath}. Reason: ${_.data.error}`),v(k=>new Set(k).add(_.data.filePath)),T.current=!1,I()):_.data.type==="get-frame"&&(_.data.success&&h(k=>({...k,[_.data.filePath]:_.data.bitmap||_.data.frame})),T.current=!1,I()))};return S.addEventListener("message",A),()=>S.removeEventListener("message",A)},[S,I]),w.useEffect(()=>{if(e==="thumbnails"&&o.length>0&&S){let A=!1;o.forEach(_=>{!p[_]&&!x.current.has(_)&&(x.current.add(_),b.current.push(_),A=!0)}),A&&!T.current&&I()}},[e,o,S,p,I]),w.useEffect(()=>{(async()=>{if(s){const _=await window.electronAPI.readIldFiles(s);u(_),x.current.clear(),b.current=[],T.current=!1,h({});return}if(window.electronAPI&&window.electronAPI.getUserIldaPath){const _=await window.electronAPI.getUserIldaPath();if(_){R(_);const k=await window.electronAPI.readIldFiles(_);u(k),x.current.clear(),b.current=[],T.current=!1,h({})}}})()},[s]);const Q=async()=>{if(window.electronAPI){const A=await window.electronAPI.openFileExplorer();if(A){R(A);const _=await window.electronAPI.readIldFiles(A);u(_),x.current.clear(),b.current=[],T.current=!1,h({})}}};return f.jsxs("div",{className:"file-browser",children:[f.jsx("button",{onClick:Q,children:"Open Folder"}),f.jsxs("div",{className:"list_switcher",children:[f.jsx("button",{className:e==="list"?"active":"",onClick:()=>a&&a("list"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-list",viewBox:"0 0 16 16",children:f.jsx("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"})})}),f.jsx("button",{className:e==="thumbnails"?"active":"",onClick:()=>a&&a("thumbnails"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),f.jsx("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})]})})]}),M&&f.jsxs("p",{className:"fileBrowser",children:["Selected Directory: ",M.split(/[/\\]/).filter(Boolean).pop()]}),f.jsx("div",{className:"ild-file-grid",style:{display:e==="thumbnails"?null:"none"},children:o.filter(A=>!g.has(A)).length>0?o.filter(A=>!g.has(A)).map((A,_)=>{const k=A.split(/[/\\]/).pop(),G=p[A];return f.jsxs("div",{className:"ild-file-preview",draggable:!0,onDragStart:F=>F.dataTransfer.setData("application/json",JSON.stringify({filePath:A,fileName:k})),children:[f.jsx("div",{className:"file_thumbnail",children:G?f.jsx(pd,{bitmap:G instanceof ImageBitmap?G:null,frame:G instanceof ImageBitmap?null:G}):f.jsx("div",{className:"clip-loading-spinner"})}),f.jsx("div",{className:"file_name",children:k})]},_)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})}),f.jsx("div",{className:"ild-file-list",style:{display:e==="list"?null:"none"},children:o.filter(A=>!g.has(A)).length>0?o.filter(A=>!g.has(A)).map((A,_)=>{const k=A.split(/[/\\]/).pop();return f.jsx("div",{className:"ild-file-item",draggable:!0,onDragStart:G=>G.dataTransfer.setData("application/json",JSON.stringify({filePath:A,fileName:k})),children:k},_)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})})]})},Kf=[{id:"circle",name:"Circle",description:"Generates a simple circle.",defaultParams:{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"radius",label:"Radius",type:"range",min:.01,max:1,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:3,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"square",name:"Square",description:"Generates a simple square.",defaultParams:{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"width",label:"Width",type:"range",min:.01,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"triangle",name:"Triangle",description:"Generates a simple symmetrical triangle.",defaultParams:{size:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"size",label:"Size",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"line",name:"Line",description:"Generates a straight line.",defaultParams:{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"x1",label:"X1",type:"range",min:-1,max:1,step:.01},{id:"y1",label:"Y1",type:"range",min:-1,max:1,step:.01},{id:"x2",label:"X2",type:"range",min:-1,max:1,step:.01},{id:"y2",label:"Y2",type:"range",min:-1,max:1,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:2,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"text",name:"Text",description:"Generates text.",defaultParams:{text:"TrueLazer",x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"text",label:"Text Content",type:"text"},{id:"fontUrl",label:"Fonts",type:"text"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:300,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"star",name:"Star",description:"Generates a star shape.",defaultParams:{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"outerRadius",label:"Outer Radius",type:"range",min:.01,max:1,step:.01},{id:"innerRadius",label:"Inner Radius",type:"range",min:.01,max:1,step:.01},{id:"numSpikes",label:"Number of Spikes",type:"range",min:3,max:20,step:1},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:20,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"ndi-source",name:"NDI Source",description:"Placeholder for NDI Video Input.",defaultParams:{sourceName:"No Source",threshold:128,edgeDetection:!1,captureWidth:480,captureHeight:480,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Source Name",type:"text"},{id:"captureWidth",label:"Width",type:"range",min:128,max:1280,step:1},{id:"captureHeight",label:"Height",type:"range",min:128,max:1280,step:1},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"spout-receiver",name:"Spout Receiver",description:"Placeholder for Spout Video Input.",defaultParams:{sourceName:"Spout Input",threshold:128,edgeDetection:!1,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Sender Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"sinewave",name:"Sine Wave",description:"Generates a customizable sine wave.",defaultParams:{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:0,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:.1,max:10,step:.1},{id:"phase",label:"Phase",type:"range",min:0,max:Math.PI*2,step:.01},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:10,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"waveform",name:"Waveform",description:"Generates a real-time audio visualization.",defaultParams:{mode:"bars",width:2,height:1,numBins:32,freqRange:[0,1],x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Visualization Mode",type:"select",options:[{label:"Candle Bar",value:"bars"},{label:"Waveform (Osc)",value:"waveform"},{label:"Spectrum Line",value:"spectrum"}]},{id:"freqRange",label:"Frequency Range",type:"range",min:0,max:1,step:.01,isRange:!0,default:[0,1],showIf:{mode:["bars","spectrum"]}},{id:"numBins",label:"Resolution",type:"range",min:8,max:128,step:1},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.1,max:2,step:.01},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"timer",name:"Timer",description:"Generates a clock, count-up or count-down visualization.",defaultParams:{mode:"clock",format:"MM:SS",startTime:60,x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Mode",type:"select",options:[{label:"Clock",value:"clock"},{label:"Count-up",value:"count-up"},{label:"Count-down",value:"count-down"}]},{id:"format",label:"Format",type:"select",options:[{label:"HH:MM:SS",value:"HH:MM:SS"},{label:"MM:SS",value:"MM:SS"},{label:"SS.mm",value:"SS.mm"}]},{id:"startTime",label:"Start Time (Sec)",type:"range",min:1,max:3600,step:1,showIf:{mode:"count-down"}},{id:"fontUrl",label:"Fonts",type:"text"},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:500,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]}],bv=()=>{const[n,e]=w.useState([]);w.useEffect(()=>{const l=async()=>{if(window.electronAPI&&window.electronAPI.ndiFindSources){const u=await window.electronAPI.ndiFindSources();e(u||[])}};l();const o=setInterval(l,5e3);return()=>clearInterval(o)},[]);const a=(l,o)=>{l.dataTransfer.setData("application/json",JSON.stringify(o))},s=(l,o)=>{const u=Kf.find(h=>h.id==="ndi-source"),p={...u,defaultParams:{...u.defaultParams,sourceName:o.name}};l.dataTransfer.setData("application/json",JSON.stringify(p))};return f.jsxs("div",{className:"generator-panel",children:[f.jsx("div",{className:"generator-list",children:Kf.filter(l=>l.id!=="ndi-source"&&l.id!=="spout-receiver").map(l=>f.jsx("div",{className:"generator-item",draggable:!0,onDragStart:o=>a(o,l),children:l.name},l.id))}),f.jsx("h3",{style:{marginTop:"10px"},children:"NDI Sources"}),f.jsx("div",{className:"generator-list",children:n.length>0?n.map((l,o)=>f.jsx("div",{className:"generator-item ndi-item",draggable:!0,onDragStart:u=>s(u,l),children:l.name},`${l.name}-${o}`)):f.jsx("div",{className:"empty-msg",children:"No NDI sources found"})})]})},xv=()=>{const n=(e,a)=>{e.dataTransfer.setData("application/json",JSON.stringify(a))};return f.jsx("div",{className:"effect-panel",children:xl.map(e=>f.jsx("div",{draggable:!0,onDragStart:a=>n(a,e),className:"effect-item",children:e.name},e.id))})},_i=({value:n,onChange:e,label:a,onDrop:s,size:l=40,isAssigned:o,className:u,...p})=>{const h=w.useRef(null),g=b=>{s&&(b.preventDefault(),b.dataTransfer.dropEffect="link")},v=b=>{if(s){b.preventDefault();try{const T=b.dataTransfer.getData("application/x-truelazer-param");console.log("[RadialKnob] Dropped Data Raw:",T);const M=JSON.parse(T);console.log("[RadialKnob] Dropped Data Parsed:",M),M&&(M.type==="range"||M.type==="number")?s(M):console.warn("[RadialKnob] Invalid data type for knob:",M?.type)}catch(T){console.error("[RadialKnob] Drop Error:",T)}}},S=-135+n*270,x=b=>{if(!o||b.button!==0)return;b.preventDefault();const T=b.clientY,M=n,R=Q=>{const _=(T-Q.clientY)/200;let k=Math.max(0,Math.min(1,M+_));e(k)},I=()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",I)};window.addEventListener("mousemove",R),window.addEventListener("mouseup",I)};return w.useEffect(()=>{const b=h.current;if(!b)return;const T=M=>{if(!o)return;M.preventDefault(),M.stopPropagation();const R=M.deltaY*-.001;let I=Math.max(0,Math.min(1,n+R));e(I)};return b.addEventListener("wheel",T,{passive:!1}),()=>{b.removeEventListener("wheel",T)}},[n,e,o]),f.jsxs("div",{className:`quick-assign-knob ${o?"":"unassigned"} ${u||""}`.trim(),ref:h,style:{cursor:o?"ns-resize":"default",userSelect:"none",opacity:o?1:.5},onDragOver:g,onDrop:v,onMouseDown:x,...p,children:[f.jsx("div",{className:"knob-label",title:a,children:a}),f.jsx("div",{className:"knob-circle",children:f.jsx("div",{className:"knob-indicator",style:{transform:`rotate(${S}deg)`}})}),f.jsxs("div",{className:"knob-value",style:{fontSize:"9px",color:"#888",marginTop:"2px"},children:[Math.round(n*100),"%"]})]})},Sv=({dacs:n=[],onDacSelected:e,onDacsDiscovered:a,dacSettings:s={},onUpdateDacSettings:l,onApplyGroup:o})=>{const[u,p]=w.useState(!1),[h,g]=w.useState(null),[v,S]=w.useState([]),[x,b]=w.useState(null),[T,M]=w.useState({}),[R,I]=w.useState(""),[Q,A]=w.useState([]),_=Bn.useRef(!1);w.useEffect(()=>{window.electronAPI&&window.electronAPI.getDacGroups&&window.electronAPI.getDacGroups().then(M),window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(U=>{S(U),U.length>0&&b(U[0])})},[]),w.useEffect(()=>{u&&!_.current&&(_.current=!0,console.log("Starting DAC scan on:",x?.address),window.electronAPI?window.electronAPI.discoverDacs(2e3,x?.address).then(async U=>{console.log("DACs discovered:",U);const q=await Promise.all(U.map(async ie=>{try{const z=await window.electronAPI.getDacServices(ie.ip,x?.address,ie.type),J=ie.type&&ie.type.toLowerCase()==="etherdream"?z:z.filter(pe=>pe.serviceID!==0);return{...ie,channels:J}}catch(z){return console.error(`Error fetching services for DAC ${ie.ip}:`,z),{...ie,channels:[]}}}));a&&a(q)}).catch(U=>{console.error("Error discovering DACs:",U)}).finally(()=>{p(!1),_.current=!1}):(console.warn("electronAPI is not available. Cannot discover DACs."),p(!1),_.current=!1))},[u,x,a]);const k=(U,q)=>{const ie={...U,channel:q};g(ie),e&&e(ie)},G=(U,q,ie)=>{U.stopPropagation();const z={...q,channel:ie};U.dataTransfer.setData("application/json",JSON.stringify(z))},F=U=>{const q=U.target.value,ie=v.find(z=>z.address===q);b(ie)},K=(U,q)=>{U.stopPropagation();const ie={...q,allChannels:!0};U.dataTransfer.setData("application/json",JSON.stringify(ie))},le=(U,q)=>{const ie=Q.some(z=>z.ip===U.ip&&z.channel===q);A(ie?Q.filter(z=>!(z.ip===U.ip&&z.channel===q)):[...Q,{ip:U.ip,channel:q,type:U.type,hostName:U.hostName,unitID:U.unitID}])},H=async()=>{if(!R.trim()||Q.length===0)return;const U={...T,[R.trim()]:Q};M(U),window.electronAPI&&window.electronAPI.saveDacGroups&&await window.electronAPI.saveDacGroups(U),I(""),A([])},N=async U=>{const q={...T};delete q[U],M(q),window.electronAPI&&window.electronAPI.saveDacGroups&&await window.electronAPI.saveDacGroups(q)},V=U=>{o&&o(U)};return f.jsxs("div",{className:"dac-panel",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"DACs"})}),f.jsxs("div",{className:"network-interface-selector",style:{display:"flex",gap:5,padding:"5px 10px",alignItems:"center"},children:[f.jsxs("div",{style:{flex:1,display:"flex",gap:"2px"},children:[f.jsx("select",{onChange:F,value:x?.address||"",style:{flex:1,background:"#2a2a2a",color:"#aaa",borderRadius:"5px",cursor:"pointer",fontSize:"11px",padding:"2px 5px",border:"1px solid #444"},children:v.map(U=>f.jsxs("option",{value:U.address,children:[U.name," (",U.address,")"]},U.address))}),f.jsx("button",{className:"refresh-interfaces-btn",onClick:()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(U=>{S(U),U.length>0&&!x&&b(U[0])})},style:{fontSize:"9px",padding:"2px 5px",background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",borderRadius:"3px"},title:"Refresh Interfaces",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"}),f.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"})]})})]}),f.jsx("button",{className:`scan-dacs-btn ${u?"active scanning":""}`,onClick:()=>p(!0),disabled:u,style:{background:u?"var(--theme-color)":"#333",color:u?"#000":"#ccc",border:"1px solid #555",borderRadius:"3px",padding:"2px 10px",fontSize:"10px",fontWeight:"bold",cursor:u?"default":"pointer",textTransform:"uppercase",minWidth:"60px"},children:u?"SCANNING...":"SCAN"})]}),f.jsx("div",{className:"dac-list",children:n.map(U=>f.jsxs("div",{className:"dac-group",draggable:!0,onDragStart:q=>K(q,U),children:[f.jsxs("div",{className:"dac-ip",children:[U.hostName||U.ip," (",U.ip,")"]}),f.jsx("div",{className:"dac-channels",children:U.channels&&U.channels.length>0?U.channels.map(q=>{const ie=Q.some(z=>z.ip===U.ip&&z.channel===q.serviceID);return f.jsxs("div",{className:`dac-channel-item ${h&&(h.unitID===U.unitID||h.ip===U.ip)&&h.channel===q.serviceID?"selected":""}`,onClick:()=>k(U,q.serviceID),draggable:!0,onDragStart:z=>G(z,U,q.serviceID),style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("input",{type:"checkbox",className:"tl-checkbox",checked:ie,onChange:z=>{z.stopPropagation(),le(U,q.serviceID)},onClick:z=>z.stopPropagation()}),f.jsxs("span",{style:{flex:1},children:["Channel ",q.serviceID," (",q.name,")"]})]},`${U.unitID||U.ip}-${q.serviceID}`)}):f.jsx("div",{className:"dac-channel-item no-channels",children:"No channels found"})})]},U.unitID||U.ip))}),f.jsxs("div",{className:"dac-groups-section",style:{padding:"10px",borderTop:"1px solid #444",marginTop:"10px"},children:[f.jsx("h4",{style:{margin:"0 0 10px 0",fontSize:"0.9rem",color:"#888"},children:"DAC Groups"}),f.jsxs("div",{className:"new-group-form",style:{display:"flex",gap:"5px",marginBottom:"10px"},children:[f.jsx("input",{type:"text",placeholder:"Group Name...",value:R,onChange:U=>I(U.target.value),style:{flex:1,background:"#111",border:"1px solid #444",color:"#fff",fontSize:"11px",padding:"2px 5px",borderRadius:"3px"}}),f.jsx("button",{onClick:H,disabled:!R.trim()||Q.length===0,style:{fontSize:"10px",padding:"2px 8px",background:"#333",color:"#fff",border:"1px solid #555",borderRadius:"3px",cursor:"pointer"},children:"Save"})]}),f.jsxs("div",{className:"groups-list",children:[Object.entries(T).map(([U,q])=>f.jsxs("div",{className:"group-item",draggable:!0,onDragStart:ie=>{ie.stopPropagation(),ie.dataTransfer.setData("application/json",JSON.stringify({isGroup:!0,name:U,channels:q}))},style:{display:"flex",alignItems:"center",background:"#2a2a2a",padding:"4px 8px",borderRadius:"4px",marginBottom:"4px",fontSize:"11px",cursor:"grab"},children:[f.jsxs("span",{style:{flex:1},children:[U," (",q.length,")"]}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("button",{onClick:()=>V(q),style:{background:"var(--theme-color)",border:"none",color:"#000",padding:"2px 6px",borderRadius:"3px",cursor:"pointer",fontSize:"10px"},children:"Apply"}),f.jsx("button",{onClick:()=>N(U),style:{background:"#444",border:"none",color:"#ccc",padding:"2px 6px",borderRadius:"3px",cursor:"pointer",fontSize:"10px"},children:""})]})]},U)),Object.keys(T).length===0&&f.jsx("div",{style:{fontSize:"10px",color:"#666",fontStyle:"italic"},children:"No groups defined."})]})]}),n.length>0&&f.jsxs("div",{className:"dac-dimmers-section",children:[f.jsx("h4",{children:"Channel Dimmers"}),f.jsx("div",{className:"dac-dimmers-grid",children:n.flatMap(U=>(U.channels||[]).map(q=>({dac:U,ch:q}))).map(({dac:U,ch:q})=>{const ie=`${U.ip}:${q.serviceID}`,z=s[ie]||{},J=z.dimmer!==void 0?z.dimmer:1;return f.jsx(pn,{id:`dimmer_${ie.replace(/\./g,"_")}`,children:f.jsx(_i,{label:`${U.hostName||U.ip} Ch${q.serviceID}`,value:J,onChange:pe=>{l&&l(ie,{...z,dimmer:pe})}})},`dimmer_${ie}`)})})]})]})},Qm=({min:n,max:e,step:a,value:s,rangeValue:l,onChange:o,onRangeChange:u,showRange:p=!1,disabled:h=!1,animSettings:g,progressRef:v,workerId:S,clipDuration:x,bpm:b,getFftLevels:T})=>{const M=w.useRef(null),R=w.useRef(null),I=w.useRef(null),[Q,A]=w.useState(null),[_,k]=w.useState(null),G=n!==void 0?n:0,F=e!==void 0?e:1,K=l&&l[0]!==void 0?l[0]:G,le=l&&l[1]!==void 0?l[1]:F,H=s!==void 0?s:G,N=q=>{const ie=F-G;return ie===0?0:(q-G)/ie*100};w.useEffect(()=>{let q;const ie=()=>{if(Q==="value"){q=requestAnimationFrame(ie);return}let z=H;if(g&&g.syncMode&&v&&v.current){const me={progress:S&&v.current[S]!==void 0?v.current[S]:0,time:performance.now(),clipDuration:x||1,bpm:b||120,fftLevels:T?T():{low:0,mid:0,high:0}};z=jc(null,H,g,me,G,F)}const J=N(z);R.current&&(R.current.style.left=`${J}%`),I.current&&(I.current.style.width=`${J}%`),q=requestAnimationFrame(ie)};return q=requestAnimationFrame(ie),()=>cancelAnimationFrame(q)},[g,v,S,H,Q,G,F,b,T,x]);const V=(q,ie)=>{if(h)return;q.preventDefault(),q.stopPropagation(),A(ie);const z=pe=>{if(!M.current)return;const me=M.current.getBoundingClientRect(),X=pe.clientX-me.left;let $=Math.max(0,Math.min(100,X/me.width*100)),he=G+$/100*(F-G);a&&(he=Math.round(he/a)*a,$=(he-G)/(F-G)*100),ie==="value"?(he=Math.max(K,Math.min(le,he)),R.current&&(R.current.style.left=`${N(he)}%`),I.current&&!p&&(I.current.style.width=`${N(he)}%`),o&&o(he)):ie==="min"?(he=Math.max(G,Math.min(le,he)),u&&u([he,le])):ie==="max"&&(he=Math.max(K,Math.min(F,he)),u&&u([K,he]))},J=()=>{A(null),window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",J)};window.addEventListener("mousemove",z),window.addEventListener("mouseup",J)},U=(q,ie)=>f.jsx("div",{className:"slider-tooltip",style:{position:"absolute",bottom:"100%",left:`${ie}%`,transform:"translateX(-50%)",background:"#222",color:"#fff",padding:"2px 5px",borderRadius:"3px",fontSize:"10px",marginBottom:"8px",pointerEvents:"none",whiteSpace:"nowrap",border:"1px solid #555",zIndex:100,boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:q.toFixed(2)});return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:M,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[(Q==="min"||_==="min")&&U(K,N(K)),(Q==="max"||_==="max")&&U(le,N(le)),(Q==="value"||_==="value")&&U(H,N(H)),p&&f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:`${N(K)}%`,width:`${N(le)-N(K)}%`}}),!p&&f.jsx("div",{className:"value-slider-fill",ref:I,style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:"0%",borderRadius:"2px"}}),p&&f.jsx("div",{className:"range-slider-handle min-handle",style:{left:`${N(K)}%`},onMouseDown:q=>V(q,"min"),onMouseEnter:()=>k("min"),onMouseLeave:()=>k(null),title:`Min: ${K.toFixed(2)}`}),p&&f.jsx("div",{className:"range-slider-handle max-handle",style:{left:`${N(le)}%`},onMouseDown:q=>V(q,"max"),onMouseEnter:()=>k("max"),onMouseLeave:()=>k(null),title:`Max: ${le.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle value-handle",ref:R,style:{position:"absolute",width:"6px",height:"16px",top:"-50%",transform:"translate(-50%, -25%)",cursor:"pointer",zIndex:20,boxShadow:"0 0 2px rgba(0,0,0,0.5)"},onMouseDown:q=>V(q,"value"),onMouseEnter:()=>k("value"),onMouseLeave:()=>k(null),title:`Value: ${H.toFixed(2)}`})]})})},Km=({min:n=0,max:e=1,step:a=.01,value:s=[0,1],onChange:l,disabled:o=!1})=>{const u=w.useRef(null),[p,h]=w.useState(null),[g,v]=w.useState(null),S=s[0]!==void 0?s[0]:n,x=s[1]!==void 0?s[1]:e,b=w.useCallback(R=>{const I=e-n;return I===0?0:(R-n)/I*100},[n,e]),T=(R,I)=>f.jsx("div",{className:"slider-tooltip",style:{position:"absolute",bottom:"100%",left:`${I}%`,transform:"translateX(-50%)",background:"#222",color:"#fff",padding:"2px 5px",borderRadius:"3px",fontSize:"10px",marginBottom:"8px",pointerEvents:"none",whiteSpace:"nowrap",border:"1px solid #555",zIndex:100,boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:R.toFixed(2)}),M=(R,I)=>{if(o)return;R.preventDefault(),R.stopPropagation(),h(I);const Q=_=>{if(!u.current)return;const k=u.current.getBoundingClientRect(),G=_.clientX-k.left;let F=Math.max(0,Math.min(100,G/k.width*100)),K=n+F/100*(e-n);if(a&&(K=Math.round(K/a)*a),I==="low"){const le=Math.min(K,x-a);l&&l([le,x])}else{const le=Math.max(K,S+a);l&&l([S,le])}},A=()=>{h(null),window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",A)};window.addEventListener("mousemove",Q),window.addEventListener("mouseup",A)};return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:u,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[(p==="low"||g==="low")&&T(S,b(S)),(p==="high"||g==="high")&&T(x,b(x)),f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color)",left:`${b(S)}%`,width:`${b(x)-b(S)}%`}}),f.jsx("div",{className:"range-slider-handle",style:{left:`${b(S)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:R=>M(R,"low"),onMouseEnter:()=>v("low"),onMouseLeave:()=>v(null),title:`Low: ${S.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle",style:{left:`${b(x)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:R=>M(R,"high"),onMouseEnter:()=>v("high"),onMouseLeave:()=>v(null),title:`High: ${x.toFixed(2)}`})]})})},ba=({title:n,children:e,icon:a,defaultCollapsed:s=!1,headerActions:l,onToggle:o,isCollapsed:u,dragHandle:p})=>{const[h,g]=w.useState(s),v=o!==void 0?u:h,S=()=>{o?o(!v):g(!v)};return f.jsxs("div",{className:`settings-card ${v?"collapsed":""}`,children:[f.jsxs("div",{className:"settings-card-header",onClick:S,style:{userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer",flex:1,overflow:"hidden"},children:[p&&f.jsx("div",{onClick:x=>x.stopPropagation(),style:{display:"flex",alignItems:"center"},children:p}),f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",style:{transform:v?"rotate(0deg)":"rotate(90deg)",transition:"transform 0.2s",flexShrink:0},children:f.jsx("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})}),a&&f.jsx("span",{className:`bi ${a}`,style:{flexShrink:0}}),f.jsx("h4",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",margin:0},children:n})]}),l&&f.jsx("div",{onClick:x=>x.stopPropagation(),style:{flexShrink:0,marginLeft:"5px"},children:l})]}),!v&&f.jsx("div",{className:"settings-card-content",children:e})]})},Jm=({animSettings:n,onChange:e})=>{const{direction:a="forward",style:s="loop",syncMode:l=null,duration:o=1,beats:u=8,speedMultiplier:p=1}=n||{},h=(v,S)=>e({...n,[v]:S}),g=(v,S,x=!1)=>{let T=n?.[v]||(v==="beats"?8:1);x?T=S>1?T*2:T/2:T+=S,T<.01&&(T=.01),!x&&v!=="beats"&&(T=Math.round(T*100)/100),h(v,T)};return f.jsxs("div",{className:"anim-controls-container",children:[f.jsxs("div",{className:"anim-row controls-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"5px"},children:[f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${a==="backward"?"active":""}`,onClick:()=>h("direction","backward"),title:"Backward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",transform:"scale(-1 1)",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})}),f.jsx("button",{className:`speed-control-button ${a==="pause"?"active":""}`,onClick:()=>h("direction","pause"),title:"Pause",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"25",height:"20",viewBox:"0 0 16 16",className:"icon flat-color",children:f.jsx("path",{d:"M3 1h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m7 0h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m0 0"})})}),f.jsx("button",{className:`speed-control-button ${a==="forward"?"active":""}`,onClick:()=>h("direction","forward"),title:"Forward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${s==="once"?"active":""}`,onClick:()=>h("style","once"),title:"Once",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M43.8233 25.2305C43.7019 25.9889 43.5195 26.727 43.2814 27.4395 42.763 28.9914 41.9801 30.4222 40.9863 31.6785 38.4222 34.9201 34.454 37 30 37H16C9.39697 37 4 31.6785 4 25 4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19V31",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19 21 22 19.5 23.5",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="bounce"?"active":""}`,onClick:()=>h("style","bounce"),title:"Bounce",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M42 19H5.99998",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M30 7 42 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79897 29H42.799",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79895 29 18.799 41",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="loop"?"active":""}`,onClick:()=>h("style","loop"),title:"Loop",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M4 25C4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M44 23C44 29.6498 38.6038 35 32 35H4",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M10 41 4 35 10 29",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${l==="fps"?"active":""}`,onClick:()=>h("syncMode",l==="fps"?null:"fps"),style:{flex:1,padding:0,fontSize:"10px"},children:"F"}),f.jsx("button",{className:`speed-control-button ${l==="timeline"?"active":""}`,onClick:()=>h("syncMode",l==="timeline"?null:"timeline"),style:{flex:1,padding:0,fontSize:"10px"},children:"T"}),f.jsx("button",{className:`speed-control-button ${l==="bpm"?"active":""}`,onClick:()=>h("syncMode",l==="bpm"?null:"bpm"),style:{flex:1,padding:0,fontSize:"10px"},children:"B"}),f.jsx("button",{className:`speed-control-button ${l==="fft"?"active":""}`,onClick:()=>h("syncMode",l==="fft"?null:"fft"),style:{flex:1,padding:0,fontSize:"10px"},children:"FFT"})]})]}),l==="fft"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Range"}),f.jsxs("select",{value:n?.fftRange||"low",onChange:v=>h("fftRange",v.target.value),style:{fontSize:"10px",background:"#333",border:"1px solid #555",color:"white"},children:[f.jsx("option",{value:"low",children:"Low"}),f.jsx("option",{value:"mid",children:"Mid"}),f.jsx("option",{value:"high",children:"High"})]})]})}),l==="timeline"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:typeof o=="number"?o.toFixed(2):o,onChange:v=>h("duration",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",2,!0),children:"*2"})]})]})}),l==="bpm"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Beats"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:v=>h("beats",parseInt(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",2,!0),children:"*2"})]})]})}),(l==="timeline"||l==="bpm"||l==="fps")&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Speed"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:typeof p=="number"?p.toFixed(2):p,onChange:v=>h("speedMultiplier",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",.1),children:"+0.1"})]})]})})]})},ho=(n,e,a)=>{let s,l,o;const u=Math.floor(n*6),p=n*6-u,h=a*(1-e),g=a*(1-p*e),v=a*(1-(1-p)*e);switch(u%6){case 0:s=a,l=v,o=h;break;case 1:s=g,l=a,o=h;break;case 2:s=h,l=a,o=v;break;case 3:s=h,l=g,o=a;break;case 4:s=v,l=h,o=a;break;case 5:s=a,l=h,o=g;break}const S=x=>{const b=Math.round(x*255).toString(16);return b.length===1?"0"+b:b};return`#${S(s)}${S(l)}${S(o)}`},q0=n=>{let e=parseInt(n.slice(1,3),16)/255,a=parseInt(n.slice(3,5),16)/255,s=parseInt(n.slice(5,7),16)/255,l=Math.max(e,a,s),o=Math.min(e,a,s),u,p,h=l,g=l-o;if(p=l===0?0:g/l,l===o)u=0;else{switch(l){case e:u=(a-s)/g+(a<s?6:0);break;case a:u=(s-e)/g+2;break;case s:u=(e-a)/g+4;break}u/=6}return{h:u,s:p,v:h}},X0=({color:n="#ffffff",onChange:e})=>{const a=w.useRef(null),[s,l]=w.useState(()=>q0(n)),[o,u]=w.useState(!1);w.useEffect(()=>{const v=q0(n);ho(v.h,v.s,v.v)!==ho(s.h,s.s,s.v)&&l(v)},[n]);const p=w.useCallback(()=>{const v=a.current;if(!v)return;const S=v.getContext("2d"),x=v.width,b=v.height;S.fillStyle=ho(s.h,1,1),S.fillRect(0,0,x,b);const T=S.createLinearGradient(0,0,x,0);T.addColorStop(0,"rgba(255,255,255,1)"),T.addColorStop(1,"rgba(255,255,255,0)"),S.fillStyle=T,S.fillRect(0,0,x,b);const M=S.createLinearGradient(0,0,0,b);M.addColorStop(0,"rgba(0,0,0,0)"),M.addColorStop(1,"rgba(0,0,0,1)"),S.fillStyle=M,S.fillRect(0,0,x,b);const R=s.s*x,I=(1-s.v)*b;S.strokeStyle=s.v>.5?"#000":"#fff",S.lineWidth=2,S.beginPath(),S.arc(R,I,5,0,Math.PI*2),S.stroke()},[s]);w.useEffect(()=>{p()},[p]);const h=v=>{const x=a.current.getBoundingClientRect(),b=Math.max(0,Math.min(1,(v.clientX-x.left)/x.width)),T=Math.max(0,Math.min(1,(v.clientY-x.top)/x.height)),M={...s,s:b,v:1-T};l(M),e&&e(ho(M.h,M.s,M.v))},g=v=>{u(!0),h(v)};return w.useEffect(()=>{if(!o)return;const v=x=>h(x),S=()=>u(!1);return window.addEventListener("mousemove",v),window.addEventListener("mouseup",S),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",S)}},[o,s]),f.jsxs("div",{className:"custom-color-picker",style:{padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("canvas",{ref:a,width:150,height:100,style:{width:"100%",height:"100px",cursor:"crosshair",borderRadius:"2px"},onMouseDown:g}),f.jsx("div",{className:"hue-slider-container",style:{marginTop:"8px"},children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:s.h,onChange:v=>{const S={...s,h:parseFloat(v.target.value)};l(S),e&&e(ho(S.h,S.s,S.v))},style:{width:"100%",height:"10px",appearance:"none",background:"linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)",borderRadius:"5px"}})})]})},eg=({type:n,subType:e,currentParams:a,onApplyPreset:s,onRegisterPreset:l})=>{const[o,u]=w.useState([]),[p,h]=w.useState(""),[g,v]=w.useState(!1),[S,x]=w.useState(""),[b,T]=w.useState(!1),M=async()=>{if(window.electronAPI&&window.electronAPI.getPresets){const A=await window.electronAPI.getPresets(n,e);u(A||[])}};w.useEffect(()=>{M(),v(!1),T(!1)},[n,e]);const R=async()=>{if(!S.trim())return;const A={name:S.trim(),params:a};window.electronAPI&&window.electronAPI.savePreset&&(await window.electronAPI.savePreset(n,e,A)).success&&(M(),h(A.name),l&&l(n,e,A),v(!1),x(""))},I=async()=>{p&&window.electronAPI&&window.electronAPI.deletePreset&&(await window.electronAPI.deletePreset(n,e,p)).success&&(M(),h(""),T(!1))},Q=A=>{const _=A.target.value;if(h(_),_){const k=o.find(G=>G.name===_);k&&s&&(s(k.params),l&&l(n,e,k))}};return g?f.jsxs("div",{className:"preset-selector naming-mode",style:{display:"flex",gap:"5px",alignItems:"center",marginBottom:"10px"},children:[f.jsx("input",{type:"text",value:S,onChange:A=>x(A.target.value),placeholder:"Preset Name...",autoFocus:!0,onKeyDown:A=>{A.key==="Enter"&&R(),A.key==="Escape"&&v(!1)},style:{flex:1,background:"#000",color:"#fff",border:"1px solid var(--theme-color)",fontSize:"11px",padding:"2px 5px",borderRadius:"3px"}}),f.jsx("button",{onClick:R,style:{background:"var(--theme-color)",border:"none",color:"#000",cursor:"pointer",padding:"2px 8px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"OK"}),f.jsx("button",{onClick:()=>v(!1),style:{background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",padding:"2px 8px",borderRadius:"3px",fontSize:"10px"},children:"ESC"})]}):b?f.jsxs("div",{className:"preset-selector delete-mode",style:{display:"flex",gap:"5px",alignItems:"center",marginBottom:"10px"},children:[f.jsx("span",{style:{fontSize:"10px",color:"#f44",flex:1},children:"Delete?"}),f.jsx("button",{onClick:I,style:{background:"#f44",border:"none",color:"#fff",cursor:"pointer",padding:"2px 8px",borderRadius:"3px",fontSize:"10px",fontWeight:"bold"},children:"YES"}),f.jsx("button",{onClick:()=>T(!1),style:{background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",padding:"2px 8px",borderRadius:"3px",fontSize:"10px"},children:"NO"})]}):f.jsxs("div",{className:"preset-selector",style:{display:"flex",gap:"5px",alignItems:"center",marginBottom:"10px"},children:[f.jsxs("select",{value:p,onChange:Q,style:{flex:1,background:"#111",color:"#fff",border:"1px solid #444",fontSize:"11px",padding:"2px"},children:[f.jsx("option",{value:"",children:"-- Select Preset --"}),o.map(A=>f.jsx("option",{value:A.name,children:A.name},A.name))]}),f.jsx("button",{onClick:()=>v(!0),style:{background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",padding:"2px 5px",borderRadius:"3px",display:"flex",alignItems:"center"},title:"Save Preset",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M11 2H9v3h2V2Z"}),f.jsx("path",{d:"M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0ZM1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5Zm3-.5v4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4Zm0 10v4h8v-4a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5Z"})]})}),f.jsx("button",{onClick:()=>T(!0),disabled:!p,style:{background:"#333",border:"1px solid #555",color:p?"#f44":"#666",cursor:p?"pointer":"default",padding:"2px 5px",borderRadius:"3px",display:"flex",alignItems:"center"},title:"Delete Preset",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"}),f.jsx("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"})]})})]})},tg=({control:n,value:e,onChange:a,animSettings:s,onAnimChange:l,effectId:o,context:u,progressRef:p,workerId:h,clipDuration:g,bpm:v,getFftLevels:S,uiState:x,onUpdateUiState:b,paramKey:T})=>{const[M,R]=w.useState(!1),I=!!x?.expandedParams?.[T],Q=F=>{b&&b({expandedParams:{...x?.expandedParams||{},[T]:F}})},A=F=>{F.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,effectId:o,min:n.min,max:n.max,step:n.step,...u}))},_=s?.range||[n.min,n.max],k=F=>{l({...s,range:F})},G=F=>{l({range:_,...F})};return f.jsxs("div",{className:`param-editor ${I?"expanded":""}`,onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),style:{marginBottom:"8px",display:"grid",gridTemplateColumns:"1fr",gap:"2px"},children:[f.jsx("div",{className:"param-row-label",style:{width:"100%"},children:f.jsx("label",{className:"param-label",draggable:!0,onDragStart:A,style:{fontSize:"11px",color:"#aaa"},children:n.label})}),f.jsxs("div",{className:"param-row-control",style:{display:"grid",gridTemplateColumns:"20px 1fr 60px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${I?"active":""}`,style:{visibility:M||I||s?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>Q(!I),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",style:{display:"flex",alignItems:"center",height:"100%"},children:n.type==="range"?n.isRange?f.jsx(Km,{min:n.min,max:n.max,step:n.step,value:e,onChange:a}):f.jsx(pn,{id:`${o}_${n.id}`,style:{width:"100%"},children:f.jsx(Qm,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:_,onChange:a,onRangeChange:k,showRange:I,animSettings:s,progressRef:p,workerId:h,clipDuration:g,bpm:v,getFftLevels:S})}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:F=>a(F.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx(pn,{id:`${o}_${n.id}`,children:f.jsx("input",{type:"checkbox",checked:e,onChange:F=>a(F.target.checked),className:"param-checkbox"})}):n.type==="select"?f.jsx(pn,{id:`${o}_${n.id}`,children:f.jsx("select",{value:e,onChange:F=>a(F.target.value),className:"param-select",children:n.options.map(F=>f.jsx("option",{value:F,children:F},F))})}):null}),n.type==="range"&&!n.isRange&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:F=>a(parseFloat(F.target.value)||0),className:"param-number-input",step:n.step,style:{fontSize:"10px"}})]}),I&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Jm,{animSettings:s,onChange:G})})]})},wv=({customOrder:n=[],assignedDacs:e=[],onChange:a})=>{const[s,l]=w.useState(null),o=n&&n.length>0?n:e.map((h,g)=>({ip:h.ip,channel:h.channel,label:`Ch ${h.channel} (${h.hostName||h.ip})`,originalIndex:g})),u=(h,g)=>{l(o[g])},p=(h,g)=>{h.preventDefault();const v=o[g];if(s===v)return;const S=o.filter(x=>x!==s);S.splice(g,0,s),a(S)};return f.jsxs("div",{className:"custom-order-editor",style:{marginBottom:"10px",padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("label",{style:{fontSize:"10px",color:"#888"},children:"Channel Order (Drag to Sort)"}),f.jsx("ul",{style:{listStyle:"none",padding:0,margin:"5px 0"},children:o.map((h,g)=>f.jsxs("li",{draggable:!0,onDragStart:v=>u(v,g),onDragOver:v=>p(v,g),style:{background:"#333",border:"1px solid #444",padding:"4px",marginBottom:"2px",fontSize:"10px",cursor:"grab",display:"flex",alignItems:"center"},children:[f.jsx("span",{style:{marginRight:"5px",color:"#666"},children:""}),h.label||`Ch ${h.channel} ${h.ip?`(${h.ip})`:""}`]},g))})]})},Ev=({effect:n,onParamChange:e,syncSettings:a,onSetParamSync:s,context:l,progressRef:o,workerId:u,clipDuration:p,bpm:h,getFftLevels:g,uiState:v,onUpdateUiState:S})=>{const{mode:x,color:b,paletteColors:T=[],paletteSize:M=4}=n.params,[R,I]=w.useState(0),Q=!!v?.showHsv?.[n.instanceId],A=H=>{S&&S({showHsv:{...v?.showHsv||{},[n.instanceId]:H}})},_=H=>{const N=[...T];for(;N.length<16;)N.push("#ffffff");N[R]=H,e("paletteColors",N)},k=xl.find(H=>H.id==="color"),G=H=>{if(!H)return{h:0,s:0,v:1};const N=parseInt(H.slice(1,3),16)/255,V=parseInt(H.slice(3,5),16)/255,U=parseInt(H.slice(5,7),16)/255,q=Math.max(N,V,U),ie=Math.min(N,V,U);let z,J,pe=q;const me=q-ie;if(J=q===0?0:me/q,q===ie)z=0;else{switch(q){case N:z=(V-U)/me+(V<U?6:0);break;case V:z=(U-N)/me+2;break;case U:z=(N-V)/me+4;break}z/=6}return{h:z,s:J,v:pe}},F=H=>{e("color",H);const N=G(H);e("hue",N.h),e("saturation",N.s),e("brightness",N.v)},K=[{name:"RGBY",colors:["#ff0000","#00ff00","#0000ff","#ffff00"]},{name:"CYBER",colors:["#ff00ff","#00ffff","#ffffff","#0000ff"]},{name:"FIRE",colors:["#ff8800","#ff0000","#ffff00","#880000"]},{name:"ICE",colors:["#0000ff","#0088ff","#00ffff","#ffffff"]}],le=H=>{const N=k.paramControls.find(U=>U.id===H);if(!N)return null;const V=`${n.instanceId||n.id}.${N.id}`;return f.jsx(tg,{control:N,value:n.params[H],onChange:U=>e(H,U),animSettings:a[V],onAnimChange:U=>s(V,U),effectId:n.id,context:l,progressRef:o,workerId:u,clipDuration:p,bpm:h,getFftLevels:g,uiState:v,onUpdateUiState:S,paramKey:V},H)};return f.jsxs("div",{className:"color-effect-editor",children:[le("mode"),x==="solid"&&f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("label",{style:{fontSize:"11px",color:"#aaa"},children:"Pick Color"}),f.jsx("button",{className:`anim-toggle-btn ${Q?"active":""}`,style:{background:"none",border:"none",color:Q?"var(--theme-color)":"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>A(!Q),title:"Advanced HSV Controls",children:""})]}),!Q&&f.jsx(X0,{color:b||"#ffffff",onChange:F}),Q&&f.jsxs("div",{className:"hsv-sliders",style:{padding:"5px",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[le("hue"),le("saturation"),le("brightness"),f.jsx("div",{style:{marginTop:"5px",height:"10px",borderRadius:"2px",background:b||"#ffffff",border:"1px solid #444"}})]})]}),x==="palette"&&f.jsxs("div",{style:{marginTop:"10px"},children:[le("paletteSize"),le("paletteSpread"),le("cycleSpeed"),le("rainbowOffset"),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Presets"}),f.jsx("div",{className:"preset-row",style:{display:"flex",gap:"4px",marginBottom:"10px"},children:K.map(H=>f.jsx("button",{onClick:()=>e("paletteColors",H.colors),style:{fontSize:"9px",padding:"2px 5px",background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:"3px",cursor:"pointer"},children:H.name},H.name))}),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Palette Colors"}),f.jsx("div",{className:"palette-grid",style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"10px"},children:Array.from({length:M}).map((H,N)=>f.jsx("div",{onClick:()=>I(N),style:{width:"20px",height:"20px",background:T[N]||"#ffffff",border:R===N?"2px solid white":"1px solid #444",borderRadius:"3px",cursor:"pointer",boxSizing:"border-box"}},N))}),f.jsx(X0,{color:T[R]||"#ffffff",onChange:_})]}),x==="rainbow"&&f.jsxs("div",{style:{marginTop:"10px"},children:[le("cycleSpeed"),le("rainbowSpread"),le("rainbowOffset"),le("rainbowPalette")]})]})},ng=({effect:n,assignedDacs:e=[],onParamChange:a,onRemove:s,syncSettings:l={},onSetParamSync:o,context:u={},progressRef:p,clipDuration:h,bpm:g,getFftLevels:v,uiState:S,onUpdateUiState:x,dragHandle:b,onRegisterPreset:T})=>{if(!n)return null;const M=xl.find(F=>F.id===n.id);if(!M)return null;const R=n.id==="delay";n.id;const I=n.id==="color",Q=n.params.enabled!==!1;n.params.mode;const A=S?.collapsedEffects||{},_=!!A[n.instanceId],k=F=>{x&&x({collapsedEffects:{...A,[n.instanceId]:F}})},G=F=>{F.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"enabled",label:`${n.name} ON`,...u}))};return f.jsxs(ba,{title:n.name,isCollapsed:_,onToggle:k,dragHandle:b,headerActions:f.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[f.jsx(pn,{id:`${n.id}_blackout`,children:f.jsx("button",{className:`layer-control-button ${Q?"":"active"}`,onClick:()=>a("enabled",!Q),draggable:!0,onDragStart:G,style:{padding:"2px",background:Q?"none":"red",border:"none",color:"white",cursor:"pointer",display:"flex"},title:"Toggle Effect",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx("button",{className:"remove-effect-btn",onClick:s,children:""})]}),children:[f.jsx(eg,{type:"effect",subType:n.id,currentParams:n.params,onRegisterPreset:T,onApplyPreset:F=>{Object.entries(F).forEach(([K,le])=>{a(K,le)})}}),I?f.jsx(Ev,{effect:n,onParamChange:a,syncSettings:l,onSetParamSync:o,context:u,progressRef:p,workerId:u.workerId,clipDuration:h,bpm:g,getFftLevels:v,uiState:S,onUpdateUiState:x}):f.jsxs(f.Fragment,{children:[R&&f.jsx(f.Fragment,{children:n.params.useCustomOrder&&f.jsx(wv,{customOrder:n.params.customOrder,assignedDacs:e,onChange:F=>a("customOrder",F)})}),M.paramControls.map(F=>{if(R&&["customOrder"].includes(F.id)||F.showIf&&!Object.entries(F.showIf).every(([N,V])=>Array.isArray(V)?V.includes(n.params[N]):n.params[N]===V))return null;const K=`${n.instanceId||n.id}.${F.id}`,le=typeof l[K]=="object"?l[K]:{syncMode:l[K]};return f.jsx(tg,{control:F,value:n.params[F.id],onChange:H=>a(F.id,H),animSettings:le,onAnimChange:H=>o(K,H),effectId:n.id,context:u,progressRef:p,workerId:u.workerId,clipDuration:h,bpm:g,getFftLevels:v,uiState:S,onUpdateUiState:x,paramKey:K},F.id)})]})]})},Av=({control:n,value:e,onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:p,workerId:h,generatorId:g,clipDuration:v,uiState:S,onUpdateUiState:x})=>{const[b,T]=w.useState(!1),M=`${g}.${n.id}`,R=!!S?.expandedParams?.[M],I=G=>{x&&x({expandedParams:{...S?.expandedParams||{},[M]:G}})},Q=G=>{G.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,targetType:"generator",layerIndex:o,colIndex:u,min:n.min,max:n.max,step:n.step}))},A=typeof s[M]=="object"?s[M]:{syncMode:s[M]},_=A?.range||[n.min,n.max],k=G=>{l(M,{...A,range:G})};return f.jsxs("div",{className:`param-editor ${R?"expanded":""}`,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),style:{marginBottom:"8px"},children:[f.jsx("div",{className:"param-label-row",style:{display:"flex",alignItems:"center"},children:f.jsx("label",{draggable:!0,onDragStart:Q,className:"param-label",style:{fontSize:"11px",color:"#aaa",cursor:"grab"},children:n.label})}),f.jsxs("div",{className:"control-row",style:{display:"grid",gridTemplateColumns:"20px 1fr 50px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${R?"active":""}`,style:{visibility:b||R||A?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>I(!R),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",children:n.type==="range"?n.isRange?f.jsx(Km,{min:n.min,max:n.max,step:n.step,value:e,onChange:G=>a(n.id,G)}):f.jsx(Qm,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:_,onChange:G=>a(n.id,G),onRangeChange:k,showRange:R,animSettings:A,progressRef:p,workerId:h,clipDuration:v}):n.type==="number"?f.jsx("input",{type:"number",value:e,onChange:G=>a(n.id,parseFloat(G.target.value)||0),className:"param-number-input",step:n.step}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:G=>a(n.id,G.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx("input",{type:"checkbox",checked:e,onChange:G=>a(n.id,G.target.checked),className:"param-checkbox"}):n.type==="select"?f.jsx("select",{value:e,onChange:G=>a(n.id,G.target.value),className:"param-select",style:{width:"100%",fontSize:"11px",background:"#333",color:"#fff",border:"1px solid #555"},children:n.options.map(G=>f.jsx("option",{value:G.value,children:G.label},G.value))}):null}),n.type==="range"&&!n.isRange&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:G=>a(n.id,parseFloat(G.target.value)||0),className:"param-number-input",step:n.step,style:{width:"100%",fontSize:"10px"}})]}),R&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Jm,{animSettings:A,onChange:G=>l(M,G)})})]})},Tv=({selectedGeneratorId:n,selectedGeneratorParams:e,onParameterChange:a,syncSettings:s={},onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:p,workerId:h,clipDuration:g,uiState:v,onUpdateUiState:S,onRegisterPreset:x})=>{const[b,T]=w.useState([]),[M,R]=w.useState([]),[I,Q]=w.useState(!1);if(!n)return f.jsx("div",{className:"generator-settings-panel",children:"No generator selected."});const A=Kf.find(F=>F.id===n);if(!A)return f.jsxs("div",{className:"generator-settings-panel",children:["Generator definition not found for ID: ",n]});const _=v?.collapsedPanels||{},k=F=>{S&&S({collapsedPanels:{..._,generator:F}})};w.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getProjectFonts)try{const K=await window.electronAPI.getProjectFonts();R(K)}catch(K){console.error("Failed to load project fonts:",K)}})()},[]);const G=async F=>{const K=F.target.value;if(K==="browse")if(window.electronAPI&&window.electronAPI.showFontFileDialog){const le=await window.electronAPI.showFontFileDialog();le&&a("fontUrl",le)}else console.error("Font file dialog API not available.");else if(K==="load-system"){Q(!0);try{const H=(await window.electronAPI.getSystemFonts()).map(N=>({name:N.split(/[\\/]/).pop(),path:N})).sort((N,V)=>N.name.localeCompare(V.name));T(H)}catch(le){console.error("Failed to load system fonts:",le)}Q(!1)}else a("fontUrl",K)};return f.jsxs(ba,{title:`${A.name} Settings`,isCollapsed:!!_.generator,onToggle:k,children:[f.jsx(eg,{type:"generator",subType:n,currentParams:e,onRegisterPreset:x,onApplyPreset:F=>{Object.entries(F).forEach(([K,le])=>{a(K,le)})}}),A.paramControls.filter(F=>F.condition&&!F.condition(e)?!1:F.showIf?Object.entries(F.showIf).every(([K,le])=>Array.isArray(le)?le.includes(e[K]):e[K]===le):!0).map(F=>{if(F.id==="fontUrl"){const K=e[F.id]||"src/fonts/Geometr415 Blk BT Black.ttf";return f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{className:"param-label",children:F.label}),f.jsxs("div",{className:"font-selector-container",children:[f.jsxs("select",{className:"param-select",onChange:G,value:K,children:[M.length>0?f.jsx("optgroup",{label:"Project Fonts",children:M.map(le=>f.jsx("option",{value:le.path,children:le.name},le.path))}):f.jsx("optgroup",{label:"Default Fonts",children:f.jsx("option",{value:"src/fonts/Geometr415 Blk BT Black.ttf",children:"Geometr415"})}),b.length>0?f.jsx("optgroup",{label:"System Fonts",children:b.map(le=>f.jsx("option",{value:le.path,children:le.name},le.path))}):f.jsx("option",{value:"load-system",children:I?"Loading...":"Load System Fonts..."}),f.jsx("optgroup",{label:"Actions",children:f.jsx("option",{value:"browse",children:"Browse File..."})})]}),f.jsx("span",{className:"font-path-tiny",title:K,children:K.split(/[\\/]/).pop()})]})]},F.id)}return f.jsx(Av,{control:F,value:e[F.id],onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:p,workerId:h,generatorId:n,clipDuration:g,uiState:v,onUpdateUiState:S},F.id)})]})},Cv=({settings:n,onUpdate:e,uiState:a,onUpdateUiState:s})=>{const{mode:l="fps",duration:o=1,beats:u=8,speedMultiplier:p=1,fps:h=60}=n||{},g=a?.collapsedPanels||{},v=b=>{s&&s({collapsedPanels:{...g,playback:b}})},S=b=>{e({mode:b})},x=(b,T,M=!1)=>{let R=n[b]||(b==="beats"?8:b==="fps"?60:1);M?R=T>1?R*2:R/2:R+=T,R<.01&&(R=.01),e({[b]:R})};return f.jsxs(ba,{title:"Clip Playback",isCollapsed:!!g.playback,onToggle:v,children:[f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:l==="fps"?"active":"button_inactive",onClick:()=>S("fps"),children:"FPS"}),f.jsx("button",{className:l==="timeline"?"active":"button_inactive",onClick:()=>S("timeline"),children:"Timeline"}),f.jsx("button",{className:l==="bpm"?"active":"button_inactive",onClick:()=>S("bpm"),children:"BPM Sync"})]}),f.jsxs("div",{className:"playback-controls",children:[l==="fps"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed (FPS)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>x("fps",-1),children:"-1"}),f.jsx("input",{type:"number",value:h,onChange:b=>e({fps:parseInt(b.target.value)||60})}),f.jsx("button",{onClick:()=>x("fps",1),children:"+1"}),f.jsx("button",{onClick:()=>x("fps",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>x("fps",2,!0),children:"*2"})]})]}),f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s) (for effects)"}),f.jsx("div",{className:"value-adjuster",children:f.jsx("input",{type:"number",value:o.toFixed(2),onChange:b=>e({duration:parseFloat(b.target.value)||1})})})]})]}),l==="timeline"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>x("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:o.toFixed(2),onChange:b=>e({duration:parseFloat(b.target.value)||1})}),f.jsx("button",{onClick:()=>x("duration",1),children:"+1"}),f.jsx("button",{onClick:()=>x("duration",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>x("duration",2,!0),children:"*2"})]})]}),l==="bpm"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Beats"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>x("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:b=>e({beats:parseInt(b.target.value)||1})}),f.jsx("button",{onClick:()=>x("beats",1),children:"+1"}),f.jsx("button",{onClick:()=>x("beats",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>x("beats",2,!0),children:"*2"})]})]}),(l==="timeline"||l==="bpm")&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed Multiplier"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>x("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:p.toFixed(2),onChange:b=>e({speedMultiplier:parseFloat(b.target.value)||1})}),f.jsx("button",{onClick:()=>x("speedMultiplier",.1),children:"+0.1"})]})]})]})]})},ag=w.createContext(),Ao=()=>w.useContext(ag),Mv=({children:n})=>{const[e,a]=w.useState(null),[s,l]=w.useState(null),[o,u]=w.useState(null),[p,h]=w.useState({source:"external",lowRange:[20,250],midRange:[250,4e3],highRange:[4e3,2e4],gain:1,holdTime:100,fallTime:500,calculationMode:"average",smoothingTimeConstant:.8}),[g,v]=w.useState({low:0,mid:0,high:0}),[S,x]=w.useState([]),[b,T]=w.useState([]),[M,R]=w.useState("default"),[I,Q]=w.useState("default"),[A,_]=w.useState(1),k=w.useRef(new Uint8Array(0)),G=w.useRef(new Uint8Array(0)),F=w.useRef({low:0,mid:0,high:0}),K=w.useRef({low:0,mid:0,high:0,lastUpdateTime:Date.now(),peakTimes:{low:0,mid:0,high:0}}),le=w.useRef({}),H=w.useRef({}),N=w.useRef({});w.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const Ze=await window.electronAPI.getAllSettings();Ze.fftSettings&&Object.keys(Ze.fftSettings).length>0&&h(ft=>({...ft,...Ze.fftSettings})),Ze.selectedAudioInputDeviceId&&Q(Ze.selectedAudioInputDeviceId)}})()},[]),w.useEffect(()=>{window.electronAPI&&window.electronAPI.setFftSettings&&window.electronAPI.setFftSettings(p)},[p]),w.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedAudioInput&&window.electronAPI.setSelectedAudioInput(I)},[I]);const V=w.useCallback(async()=>{try{const _e=await navigator.mediaDevices.enumerateDevices(),Ze=_e.filter(Rt=>Rt.kind==="audiooutput"),ft=_e.filter(Rt=>Rt.kind==="audioinput");if(x(Ze),T(ft),window.electronAPI&&window.electronAPI.setAudioDevices){const Rt=Ze.map(Dt=>({deviceId:Dt.deviceId,label:Dt.label,groupId:Dt.groupId}));window.electronAPI.setAudioDevices(Rt)}}catch(_e){console.error("Error enumerating audio devices:",_e)}},[]);w.useEffect(()=>{V();let _e;return window.electronAPI&&window.electronAPI.onUpdateAudioDeviceId&&(_e=window.electronAPI.onUpdateAudioDeviceId(Ze=>{R(Ze)})),navigator.mediaDevices.addEventListener("devicechange",V),()=>{navigator.mediaDevices.removeEventListener("devicechange",V),_e&&_e()}},[V]);const U=w.useCallback(_e=>{if(!e||!s)return null;try{const Ze=e.createMediaElementSource(_e);return Ze.connect(s),Ze.connect(e.destination),Ze}catch(Ze){return console.warn("MediaElementSource already connected?",Ze),null}},[e,s]),q=w.useCallback(async(_e,Ze,ft=1,Rt=!0)=>{if(le.current[_e]&&(le.current[_e].pause(),le.current[_e].src=""),N.current[_e]=ft,!Ze)return;if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(Ze))throw new Error(`Audio file not found: ${Ze}`);const Dt=new Audio(`file:///${Ze}`);if(Dt.volume=ft*A,M&&Dt.setSinkId)try{await Dt.setSinkId(M)}catch(zt){console.error("Error setting audio sink ID:",zt)}if(le.current[_e]=Dt,e){e.state==="suspended"&&await e.resume();const zt=U(Dt);zt&&(H.current[_e]=zt)}if(Rt)try{await Dt.play()}catch(zt){throw console.error("Error playing audio:",zt),zt}return Dt},[M,U,A,e]),ie=w.useCallback(_e=>{_(_e),Object.keys(le.current).forEach(Ze=>{const ft=le.current[Ze],Rt=N.current[Ze]??1;ft&&(ft.volume=_e*Rt)})},[]),z=w.useCallback((_e,Ze)=>{N.current[_e]=Ze;const ft=le.current[_e];ft&&(ft.volume=Ze*A)},[A]),J=w.useCallback(_e=>{if(le.current[_e]&&(le.current[_e].pause(),le.current[_e].src="",delete le.current[_e],H.current[_e])){try{H.current[_e].disconnect()}catch{}delete H.current[_e]}},[]),pe=w.useCallback(_e=>{le.current[_e]&&le.current[_e].pause()},[]),me=w.useCallback(async _e=>{if(le.current[_e]&&le.current[_e].paused)try{await le.current[_e].play()}catch(Ze){console.error("Error resuming:",Ze)}},[]),X=w.useCallback(_e=>{const Ze=Math.max(.0625,Math.min(_e,16));Object.values(le.current).forEach(ft=>{try{ft.playbackRate=Ze}catch(Rt){console.warn("Failed to set playbackRate:",Rt)}})},[]),$=w.useCallback(_e=>{le.current[_e]&&(le.current[_e].currentTime=0)},[]),he=w.useCallback((_e,Ze)=>{le.current[_e]&&(le.current[_e].currentTime=Ze)},[]),Ce=w.useCallback(()=>Object.keys(le.current).forEach(J),[J]),Pe=w.useCallback(()=>Object.keys(le.current).forEach(pe),[pe]),Ke=w.useCallback(()=>Object.keys(le.current).forEach(me),[me]),Xe=w.useCallback(()=>Object.keys(le.current).forEach($),[$]),wt=w.useCallback(_e=>{const Ze=le.current[_e];return Ze?{currentTime:Ze.currentTime,duration:Ze.duration,paused:Ze.paused}:null},[]),dt=w.useCallback(async()=>{if(e)return;const _e=new(window.AudioContext||window.webkitAudioContext),Ze=_e.createAnalyser();Ze.fftSize=2048,Ze.smoothingTimeConstant=p.smoothingTimeConstant,k.current=new Uint8Array(Ze.frequencyBinCount),G.current=new Uint8Array(Ze.frequencyBinCount),_e.state==="suspended"&&await _e.resume(),a(_e),l(Ze)},[e,p.smoothingTimeConstant]);return w.useEffect(()=>{const _e=()=>{dt(),window.removeEventListener("mousedown",_e),window.removeEventListener("keydown",_e)};return window.addEventListener("mousedown",_e),window.addEventListener("keydown",_e),()=>{window.removeEventListener("mousedown",_e),window.removeEventListener("keydown",_e)}},[dt]),w.useEffect(()=>{s&&(s.smoothingTimeConstant=p.smoothingTimeConstant)},[s,p.smoothingTimeConstant]),w.useEffect(()=>{if(!e||!s||p.source!=="external"&&p.source!=="system"){o&&(o.disconnect(),u(null));return}let _e=null;return(async()=>{try{e.state==="suspended"&&await e.resume();let ft;if(p.source==="system")if(window.electronAPI&&window.electronAPI.getDesktopAudioSourceId){const Dt=await window.electronAPI.getDesktopAudioSourceId();if(Dt)ft={audio:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:Dt}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:Dt}}};else throw new Error("No desktop audio source found")}else throw new Error("System audio capture is not supported in this environment");else ft={audio:I==="default"?!0:{deviceId:{exact:I}}};_e=await navigator.mediaDevices.getUserMedia(ft),p.source==="system"&&_e.getVideoTracks().forEach(Dt=>Dt.stop());const Rt=e.createMediaStreamSource(_e);Rt.connect(s),u(Rt)}catch(ft){console.error("Failed to get external audio stream:",ft)}})(),()=>{_e&&_e.getTracks().forEach(ft=>ft.stop())}},[e,s,p.source,I]),w.useEffect(()=>{if(!s)return;let _e;const Ze=()=>{s.getByteFrequencyData(k.current),s.getByteTimeDomainData(G.current);const ft=e.sampleRate,Rt=s.frequencyBinCount,Dt=ft/s.fftSize,zt=Gt=>{const ze=Math.floor(Gt[0]/Dt),xe=Math.floor(Gt[1]/Dt);if(p.calculationMode==="peak"){let wn=0;for(let qt=ze;qt<=xe&&qt<Rt;qt++)k.current[qt]>wn&&(wn=k.current[qt]);return wn/255}else{let wn=0,qt=0;for(let Xt=ze;Xt<=xe&&Xt<Rt;Xt++)wn+=k.current[Xt],qt++;return qt>0?wn/qt/255:0}},Xn=zt(p.lowRange),nt=zt(p.midRange),tt=zt(p.highRange),ut=Date.now(),Yt=Math.max(0,ut-K.current.lastUpdateTime);K.current.lastUpdateTime=ut;const Vt=(Gt,ze)=>{let xe=Gt*p.gain;const wn=K.current[ze],qt=K.current.peakTimes[ze]||0;if(xe>=wn)return K.current.peakTimes[ze]=ut,xe;{if(ut-qt<p.holdTime)return wn;if(p.fallTime<=0)return 0;const $t=Yt/p.fallTime,pt=wn-$t;return Math.max(0,isNaN(pt)?0:pt)}},rt={low:Vt(Xn,"low"),mid:Vt(nt,"mid"),high:Vt(tt,"high")};F.current=rt,K.current={...rt,lastUpdateTime:ut,peakTimes:K.current.peakTimes},_e=requestAnimationFrame(Ze)};return Ze(),()=>cancelAnimationFrame(_e)},[e,s,p]),f.jsx(ag.Provider,{value:{audioCtx:e,analyser:s,fftSettings:p,setFftSettings:h,fftLevels:F.current,fftLevelsRef:F,fftDataRef:k,timeDataRef:G,getFftLevels:()=>F.current,connectMediaElement:U,initAudio:dt,devices:S,selectedDeviceId:M,setSelectedDeviceId:R,inputDevices:b,selectedInputDeviceId:I,setSelectedInputDeviceId:Q,globalVolume:A,setVolume:ie,setClipVolume:z,playAudio:q,stopAudio:J,pauseAudio:pe,resumeAudio:me,setPlaybackRate:X,resetAudio:$,seekAudio:he,stopAllAudio:Ce,pauseAllAudio:Pe,resumeAllAudio:Ke,resetAllAudio:Xe,getAudioInfo:wt},children:n})},kv=({audioFile:n,layerIndex:e,onSeek:a,onLoadError:s})=>{const l=w.useRef(null),o=w.useRef(null),{audioCtx:u,getAudioInfo:p}=Ao(),[h,g]=w.useState(null),[v,S]=w.useState("rgb(255, 94, 0)"),x=w.useRef(null),b=w.useRef(!1),T=w.useRef([]),M=w.useRef(null),R=w.useCallback(()=>{const k=document.createElement("div");k.style.display="none",k.style.color="var(--theme-color)",document.body.appendChild(k);const G=getComputedStyle(k).color;document.body.removeChild(k),G&&G!=="rgba(0, 0, 0, 0)"&&S(G)},[]);w.useEffect(()=>{R();const k=new MutationObserver(R);return k.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class"]}),()=>k.disconnect()},[R]),w.useEffect(()=>{if(!n?.path||!u)return;let k=!0;const G=async()=>{try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(n.path))throw new Error(`File not found: ${n.path}`);const F=await fetch(`file:///${n.path}`);if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const K=await F.arrayBuffer();if(!k)return;const le=await u.decodeAudioData(K);if(k){const H=le.getChannelData(0),N=[],V=Math.max(1,Math.floor(H.length/500));for(let U=0;U<H.length;U+=V){let q=1,ie=-1;for(let z=0;z<V&&U+z<H.length;z++){const J=H[U+z];J<q&&(q=J),J>ie&&(ie=J)}N.push({min:q,max:ie})}T.current=N,M.current=null,g(le)}}catch(F){if(!k)return;console.error("Failed to load/decode audio for waveform:",F),s&&s(F)}};return g(null),G(),()=>{k=!1}},[n,u,s]);const I=w.useCallback((k,G,F,K)=>{const le=T.current;if(!le||le.length===0)return;const H=F/2,N=2,U=N+1;if(!M.current||M.current.width!==G||M.current.height!==F){const ie=document.createElement("canvas");ie.width=G,ie.height=F;const z=ie.getContext("2d");let J=v;v.startsWith("rgb(")&&(J=v.replace("rgb","rgba").replace(")",", 0.2)")),z.fillStyle=J;const pe=Math.ceil(G/U);for(let me=0;me<pe;me++){const X=Math.floor(me/pe*le.length),$=le[X],he=(1+$.min)*H,Ce=Math.max(1,($.max-$.min)*H);z.fillRect(me*U,he,N,Ce)}M.current=ie}k.clearRect(0,0,G,F),k.drawImage(M.current,0,0);const q=G*K;if(q>0){k.save(),k.beginPath(),k.rect(0,0,q,F),k.clip(),k.fillStyle=v;const ie=Math.ceil(G/U);for(let z=0;z<ie;z++){const J=z*U;if(J>q)break;const pe=Math.floor(z/ie*le.length),me=le[pe],X=(1+me.min)*H,$=Math.max(1,(me.max-me.min)*H);k.fillRect(J,X,N,$)}k.restore()}k.fillStyle="#ffffff",k.fillRect(q,0,1,F)},[v]);w.useEffect(()=>{const k=l.current;if(!k||!h)return;const G=k.getContext("2d"),F=()=>{const K=k.getBoundingClientRect();(k.width!==K.width||k.height!==K.height)&&(k.width=K.width,k.height=K.height,M.current=null);const le=k.width,H=k.height;let N=0;if(e!=null){const V=p(e);V&&V.duration>0&&(N=V.currentTime/V.duration)}I(G,le,H,Math.max(0,Math.min(1,N))),x.current=requestAnimationFrame(F)};return F(),()=>{x.current&&cancelAnimationFrame(x.current)}},[h,e,p,I]);const Q=k=>{b.current=!0,_(k),window.addEventListener("mouseup",A),window.addEventListener("mousemove",_)},A=()=>{b.current=!1,window.removeEventListener("mouseup",A),window.removeEventListener("mousemove",_)},_=k=>{if(!l.current||!h)return;const G=l.current.getBoundingClientRect(),F=k.clientX-G.left,K=G.width,H=Math.max(0,Math.min(1,F/K))*h.duration;a&&a(H)};return f.jsx("div",{ref:o,className:"wave-player-container",style:{width:"100%",height:"35px",marginBottom:"10px",background:"transparent",borderRadius:"4px",overflow:"hidden"},onMouseDown:Q,children:f.jsx("canvas",{ref:l,style:{width:"100%",height:"100%",display:"block",cursor:"pointer"}})})},Nv=({selectedLayerIndex:n,selectedColIndex:e,clip:a,audioInfo:s,bpm:l,getFftLevels:o,onAssignAudio:u,onRemoveAudio:p,onUpdateAudioVolume:h,onUpdatePlaybackSettings:g,onSetParamSync:v,onToggleDacMirror:S,onRemoveDac:x,onRemoveEffect:b,onReorderEffects:T,onAddEffect:M,onParameterChange:R,onGeneratorParameterChange:I,onUpdateClipUiState:Q,progressRef:A,onAudioError:_,onRegisterPreset:k})=>{const[G,F]=w.useState({}),[K,le]=w.useState(null),{seekAudio:H}=Ao(),N=w.useRef(0),V=a?.uiState||{},U=V.collapsedPanels||{},q=(nt,tt)=>{Q&&Q(n,e,{collapsedPanels:{...U,[nt]:tt}})},ie=Bn.useCallback(nt=>{_&&_(n,e)},[_,n,e]);if(w.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(tt=>{F(ut=>({...ut,[tt.ip]:tt.status}))})},[]),n===null||e===null)return f.jsx("div",{className:"clip-settings-panel settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a clip to view settings."})});const z=nt=>{nt.preventDefault(),nt.stopPropagation();try{const tt=nt.dataTransfer.getData("application/json");if(!tt)return;const ut=JSON.parse(tt);ut&&ut.type&&M&&M(ut)}catch(tt){console.error("Failed to drop effect in ClipSettingsPanel:",tt)}},J=nt=>{nt.preventDefault(),nt.dataTransfer.dropEffect="copy"},pe=nt=>{le(nt)},me=(nt,tt)=>{if(nt.preventDefault(),K===null||K===tt)return;const ut=Date.now();ut-N.current<200||(N.current=ut,T&&(T(n,e,K,tt),le(tt)))},X=nt=>{le(null)},{effects:$=[],assignedDacs:he=[],playbackSettings:Ce={},syncSettings:Pe={},audioFile:Ke=null,audioVolume:Xe=1,type:wt=null,generatorDefinition:dt=null,currentParams:_e={},workerId:Ze=null}=a||{},ft=$.length>0,Rt=wt==="generator"&&!!dt,Dt=he.length>0;let zt=1;if(Ce.mode==="timeline")zt=Ce.duration||1;else if(Ce.mode==="bpm"){const nt=l||120;zt=(Ce.beats||8)*60/nt}else{const nt=Ce.fps||a?.fps||30;zt=(a?.totalFrames||30)/nt}const Xn=Ze||(wt==="ilda"?`ilda-${n}-${e}`:wt==="generator"?`generator-${n}-${e}`:null);return s&&s.duration&&s.currentTime/s.duration*100,f.jsxs("div",{className:"clip-settings-panel settings-panel-base",onDrop:z,onDragOver:J,children:[f.jsx(ba,{title:"Audio",isCollapsed:!!U.audio,onToggle:nt=>q("audio",nt),children:Ke?f.jsxs("div",{className:"assigned-audio-info",style:{position:"relative"},children:[f.jsx("button",{className:"remove-effect-btn",onClick:p,style:{position:"absolute",top:"-5px",right:"-5px",fontSize:"14px"},children:""}),f.jsx("div",{className:"audio-file-name",title:Ke.path,style:{paddingRight:"15px",marginBottom:"8px",fontSize:"11px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:Ke.name}),f.jsx(kv,{audioFile:Ke,audioInfo:s,layerIndex:n,onSeek:nt=>H(n,nt),onLoadError:ie}),f.jsxs("div",{className:"audio-volume-control",style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"10px",display:"block",marginBottom:"2px"},children:["Volume: ",Math.round(Xe*100),"%"]}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Xe,onChange:nt=>h(n,e,parseFloat(nt.target.value)),className:"slider_hor",style:{width:"100%",height:"4px"}})]})]}):f.jsx("button",{className:"assign-audio-btn",onClick:u,children:"Assign Audio File"})}),f.jsx(Cv,{settings:Ce,onUpdate:nt=>g(n,e,nt),uiState:V,onUpdateUiState:nt=>Q(n,e,nt)}),Dt&&f.jsx(ba,{title:"Assigned DACs",isCollapsed:!!U.dacs,onToggle:nt=>q("dacs",nt),children:f.jsx("ul",{className:"assigned-dacs-list",children:he.map((nt,tt)=>{const ut=G[nt.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[nt.hostName||nt.ip," - Ch ",nt.channel]}),ut&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",ut.playback_state===2?"PLAYING":ut.playback_state===1?"PREPARED":"IDLE"," | Buf: ",ut.buffer_fullness,ut.buffer_capacity?`/${ut.buffer_capacity}`:""," | PPS: ",ut.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${nt.mirrorX?"active":""}`,onClick:()=>S(n,e,tt,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${nt.mirrorY?"active":""}`,onClick:()=>S(n,e,tt,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>x(tt),children:""})]},`${nt.unitID||nt.ip}-${nt.channel}-${tt}`)})})}),Rt&&f.jsx(Tv,{selectedGeneratorId:dt.id,selectedGeneratorParams:_e,onParameterChange:I,syncSettings:Pe,onSetParamSync:v,layerIndex:n,colIndex:e,progressRef:A,workerId:Xn,clipDuration:zt,bpm:l,getFftLevels:o,uiState:V,onUpdateUiState:nt=>Q(n,e,nt),onRegisterPreset:k}),f.jsx(ba,{title:"Clip Effects",isCollapsed:!!U.effects,onToggle:nt=>q("effects",nt),children:f.jsx("div",{className:"clip-effects-list",style:{minHeight:"50px"},onDrop:X,children:ft?$.map((nt,tt)=>f.jsx("div",{onDragOver:ut=>me(ut,tt),style:{marginBottom:"4px"},children:f.jsx(ng,{effect:nt,assignedDacs:he,syncSettings:Pe,onSetParamSync:v,context:{layerIndex:n,colIndex:e,effectIndex:tt,targetType:"effect",workerId:Xn},onParamChange:(ut,Yt)=>R(n,e,tt,ut,Yt),onRemove:()=>b(n,e,tt),progressRef:A,clipDuration:zt,bpm:l,getFftLevels:o,uiState:V,onUpdateUiState:ut=>Q(n,e,ut),onRegisterPreset:k,dragHandle:f.jsx("div",{draggable:!0,onDragStart:()=>pe(tt),style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},nt.instanceId||nt.id+tt)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Rv=({selectedLayerIndex:n,autopilotMode:e,onAutopilotChange:a,layerEffects:s,assignedDacs:l=[],onToggleDacMirror:o,onRemoveDac:u,onAddEffect:p,onRemoveEffect:h,onParamChange:g,uiState:v,onUpdateUiState:S,onRegisterPreset:x})=>{const[b,T]=w.useState({}),M=v?.collapsedPanels||{},R=(A,_)=>{S&&S({collapsedPanels:{...M,[A]:_}})};if(w.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(_=>{T(k=>({...k,[_.ip]:_.status}))})},[]),n===null)return f.jsx("div",{className:"settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a layer to edit settings"})});const I=A=>{A.preventDefault(),A.stopPropagation();try{const _=JSON.parse(A.dataTransfer.getData("application/json"));_&&_.id&&p(_)}catch(_){console.error("Failed to drop effect:",_)}},Q=A=>{A.preventDefault(),A.dataTransfer.dropEffect="copy"};return f.jsxs("div",{className:"settings-panel-base",onDrop:I,onDragOver:Q,children:[l&&l.length>0&&f.jsx(ba,{title:"Assigned DACs",isCollapsed:!!M.dacs,onToggle:A=>R("dacs",A),children:f.jsx("ul",{className:"assigned-dacs-list",children:l.map((A,_)=>{const k=b[A.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[A.hostName||A.ip," - Ch ",A.channel]}),k&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",k.playback_state===2?"PLAYING":k.playback_state===1?"PREPARED":"IDLE"," | Buf: ",k.buffer_fullness,k.buffer_capacity?`/${k.buffer_capacity}`:""," | PPS: ",k.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${A.mirrorX?"active":""}`,onClick:()=>o(n,_,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${A.mirrorY?"active":""}`,onClick:()=>o(n,_,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>u(n,_),children:""})]},`${A.unitID||A.ip}-${A.channel}-${_}`)})})}),f.jsx(ba,{title:`Layer ${n+1} Autopilot`,isCollapsed:!!M.autopilot,onToggle:A=>R("autopilot",A),children:f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{children:"Mode"}),f.jsx("div",{className:"clip-playback-settings",children:f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:e==="off"?"active":"",onClick:()=>a("off"),children:"OFF"}),f.jsx("button",{className:e==="forward"?"active":"",onClick:()=>a("forward"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-forward-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m9.77 12.11 4.012-2.953a.647.647 0 0 0 0-1.114L9.771 5.09a.644.644 0 0 0-.971.557V6.65H2v3.9h6.8v1.003c0 .505.545.808.97.557"})})}),f.jsx("button",{className:e==="random"?"active":"",onClick:()=>a("random"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),f.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})})]})})]})}),f.jsx(ba,{title:"Layer Effects",isCollapsed:!!M.effects,onToggle:A=>R("effects",A),children:f.jsx("div",{className:"layer-effects-list",style:{minHeight:"50px"},children:s&&s.length>0?s.map((A,_)=>f.jsx("div",{style:{marginBottom:"4px"},children:f.jsx(ng,{effect:A,onRemove:()=>h(_),onParamChange:(k,G)=>g(_,k,G),syncSettings:{},onSetParamSync:()=>{},context:{layerIndex:n,colIndex:null,effectIndex:_,targetType:"layerEffect"},uiState:v,onUpdateUiState:S,onRegisterPreset:x,dragHandle:f.jsx("div",{draggable:!0,onDragStart:k=>{k.dataTransfer.setData("application/json",JSON.stringify({type:"effect-reorder",index:_,layerIndex:n}))},style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},A.instanceId||_)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Dv=({message:n,visible:e})=>e?f.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#333",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:1e3,opacity:e?1:0,transition:"opacity 0.5s ease-in-out"},children:n}):null,rg=w.createContext(null),sg=()=>w.useContext(rg),Iv=({children:n,onWorkerMessage:e})=>{const a=w.useRef(null);return a.current===null&&(a.current=new Worker(new URL(""+new URL("rendering.worker-BQtTgEFn.js",import.meta.url).href,import.meta.url),{type:"module"})),w.useEffect(()=>{const s=a.current;return e&&(s.onmessage=e),()=>{s.terminate(),e&&(s.onmessage=null)}},[e]),f.jsx(rg.Provider,{value:a.current,children:n})},_v=({frame:n,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:p,syncSettings:h={},bpm:g=120,clipDuration:v=1,progress:S=0,previewTime:x=0,fftLevels:b={low:0,mid:0,high:0},effectStates:T=null,optimizationEnabled:M=!0,onToggleBeamEffect:R,onCycleDisplayMode:I})=>{const Q=w.useRef(null),A=sg(),_=w.useRef(`ilda-player-${Math.random()}`);return w.useEffect(()=>{const k=Q.current;if(!k||!A)return;const G=k.transferControlToOffscreen();return A.postMessage({action:"register",payload:{id:_.current,canvas:G,type:"single",data:{showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:p,syncSettings:h,bpm:g,clipDuration:v,progress:S,previewTime:x,fftLevels:b,effectStates:T,optimizationEnabled:M}}},[G]),()=>{A.postMessage({action:"deregister",payload:{id:_.current}})}},[]),w.useEffect(()=>{if(!A)return;const k=n?[n]:[];A.postMessage({action:"update",payload:{id:_.current,data:{ildaFrames:k,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:p,syncSettings:h,bpm:g,clipDuration:v,progress:S,previewTime:x,fftLevels:b,effectStates:T,optimizationEnabled:M}}})},[A,n,e,a,s,l,o,u,p,h,g,v,S,x,b,T,M]),f.jsxs("div",{className:"ilda-player",children:[f.jsx("h3",{children:"Selected Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:R,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:I,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:Q,width:"300",height:"300",style:{backgroundColor:"black"}})]})},Ov=Bn.memo(_v),Lv=({activeFrames:n,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:p,dacSettings:h,previewTime:g=0,fftLevels:v={low:0,mid:0,high:0},optimizationEnabled:S=!0,onToggleBeamEffect:x,onCycleDisplayMode:b})=>{const T=w.useRef(null),M=sg(),R=w.useRef(`world-preview-${Math.random()}`);return w.useEffect(()=>{const I=T.current;if(!I||!M)return;const Q=I.transferControlToOffscreen();return M.postMessage({action:"register",payload:{id:R.current,canvas:Q,type:"world",data:{showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,previewTime:g,fftLevels:v,optimizationEnabled:S}}},[Q]),()=>{M.postMessage({action:"deregister",payload:{id:R.current}})}},[]),w.useEffect(()=>{if(!M)return;const I=Object.entries(n).map(([Q,{frame:A,effects:_,layerIndex:k,syncSettings:G,bpm:F,clipDuration:K,progress:le,effectStates:H}])=>({frames:[A],effects:_,workerId:Q,layerIndex:k,syncSettings:G,bpm:F,clipDuration:K,progress:le,effectStates:H}));M.postMessage({action:"update",payload:{id:R.current,data:{worldData:I,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:p,dacSettings:h,previewTime:g,fftLevels:v,optimizationEnabled:S}}})},[M,n,e,a,s,l,o,u,p,h,g,v,S]),f.jsxs("div",{className:"world-preview",children:[f.jsx("h3",{children:"World Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:x,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:b,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:T,width:"300",height:"300",style:{backgroundColor:"black"}})]})},jv=({bpm:n,onBpmChange:e})=>{const[a,s]=w.useState([]),[l,o]=w.useState(n);w.useEffect(()=>{o(n)},[n]);const u=()=>{const h=Date.now(),g=[...a,h].slice(-4);if(s(g),g.length>=2){const v=[];for(let b=1;b<g.length;b++)v.push(g[b]-g[b-1]);const S=v.reduce((b,T)=>b+T)/v.length,x=Math.round(6e4/S);e(x)}},p=h=>{const g=parseFloat(h.target.value);o(h.target.value),!isNaN(g)&&g>0&&g<999&&e(g)};return f.jsx("div",{className:"bpm-controls",children:f.jsxs("div",{className:"bpm-display",children:[f.jsx(pn,{id:"bpm_tap",children:f.jsx("button",{className:"bpm-tap-btn",onClick:u,children:"TAP"})}),f.jsxs("div",{className:"bpm-fine-controls",children:[f.jsx(pn,{id:"bpm_fine_down",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.max(1,n-.1)),children:"-"})}),f.jsx(pn,{id:"bpm_value",children:f.jsx("input",{type:"number",className:"bpm-input",value:l,onChange:p,min:"1",max:"999",step:"0.1"})}),f.jsx(pn,{id:"bpm_fine_up",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.min(999,n+.1)),children:"+"})})]}),f.jsx("span",{className:"bpm-label",children:"BPM"})]})})},Fv=({onPlay:n,onPause:e,onStop:a,isPlaying:s,isStopped:l})=>{const o=(u,p)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:p,targetType:"transport",label:p.toUpperCase()}))};return f.jsxs("div",{className:"transport-controls",children:[f.jsx(pn,{id:"transport_play",children:f.jsx("button",{className:`speed-control-button ${s?"active":""}`,onClick:n,draggable:!0,onDragStart:u=>o(u,"play"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-play-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"})})})}),f.jsx(pn,{id:"transport_pause",children:f.jsx("button",{className:`speed-control-button ${!s&&!l?"active":""}`,onClick:e,draggable:!0,onDragStart:u=>o(u,"pause"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pause-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"})})})}),f.jsx(pn,{id:"transport_stop",children:f.jsx("button",{className:`speed-control-button ${l?"active":""}`,onClick:a,draggable:!0,onDragStart:u=>o(u,"stop"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-stop-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5"})})})})]})},Uv=({value:n,onToggle:e,label:a,onDrop:s,isAssigned:l,onContextMenu:o,className:u,...p})=>{const h=v=>{v.preventDefault(),v.dataTransfer.dropEffect="link"},g=v=>{v.preventDefault();try{const S=v.dataTransfer.getData("application/x-truelazer-param");console.log("[QuickButton] Dropped Data Raw:",S);const x=JSON.parse(S);console.log("[QuickButton] Dropped Data Parsed:",x),x&&(x.type==="toggle"||x.type==="checkbox")?s(x):console.warn("[QuickButton] Invalid data type for button:",x?.type)}catch(S){console.error("[QuickButton] Drop Error:",S)}};return f.jsx("div",{className:`quick-assign-button ${n?"active":""} ${l?"":"unassigned"} ${u||""}`.trim(),style:{cursor:l?"pointer":"default",userSelect:"none",width:"90%",opacity:l?1:.5},onDragOver:h,onDrop:g,onContextMenu:o,...p,onClick:l?e:v=>v.preventDefault(),children:f.jsx("div",{className:"button-label",title:a||"Empty",children:a||"Assign"})})},Pv=({assigns:n,onUpdateKnob:e,onToggleButton:a,onAssign:s})=>{const l=(o,u,p)=>{o.preventDefault(),window.electronAPI&&window.electronAPI.showQuickAssignContextMenu&&window.electronAPI.showQuickAssignContextMenu(u,p)};return f.jsxs("div",{className:"global-quick-assigns-panel",children:[f.jsx("div",{className:"quick-assigns-row knobs-row",children:Array.from({length:8}).map((o,u)=>{const p=!!n.knobs[u].link;return f.jsx(pn,{id:`quick_knob_${u}`,children:f.jsx(_i,{value:n.knobs[u]?.value||0,label:n.knobs[u]?.label,isAssigned:p,onChange:h=>p&&e(u,h),onContextMenu:h=>l(h,"knob",u),onDrop:h=>{console.log(`[GlobalQuickAssigns] Knob ${u} Drop Data:`,h),s("knob",u,h)}})},`knob-${u}`)})}),f.jsx("div",{className:"quick-assigns-row buttons-row",children:Array.from({length:8}).map((o,u)=>{const p=!!n.buttons[u].link;return f.jsx(pn,{id:`quick_btn_${u}`,children:f.jsx(Uv,{value:n.buttons[u]?.value||!1,label:n.buttons[u]?.label,isAssigned:p,onToggle:()=>a(u),onContextMenu:h=>l(h,"button",u),onDrop:h=>{console.log(`[GlobalQuickAssigns] Button ${u} Drop Data:`,h),s("button",u,h)}})},`btn-${u}`)})})]})},Bv=({enabledShortcuts:n={},onOpenOutputSettings:e,quickAssigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o,renderSettings:u={},onSetRenderSetting:p})=>{const{midiInitialized:h,midiInputs:g,selectedMidiInputId:v,setSelectedMidiInputId:S,isMapping:x,startMapping:b,stopMapping:T,learningId:M,lastMidiEvent:R,setMappings:I,saveMappings:Q,exportMappings:A,importMappings:_}=Hc(),k=u.settingsPanelCollapsed||{},G=(rt,Gt)=>{p&&p("settingsPanelCollapsed",{...k,[rt]:Gt})},{artnetInitialized:F,isMapping:K,startMapping:le,stopMapping:H,setMappings:N,saveMappings:V,exportMappings:U,importMappings:q,lastDmxEvent:ie}=ud()||{},{isMapping:z,startMapping:J,stopMapping:pe,setMappings:me,saveMappings:X,exportMappings:$,importMappings:he}=fd()||{},[Ce,Pe]=w.useState([]),[Ke,Xe]=w.useState(""),[wt,dt]=w.useState(!1),[_e,Ze]=w.useState(57121),[ft,Rt]=w.useState("127.0.0.1"),[Dt,zt]=w.useState(57120),[Xn,nt]=w.useState(null);w.useEffect(()=>{const rt=async()=>{if(n.artnet)try{const xe=await window.electronAPI.getArtnetUniverses();Pe(xe),xe.length>0&&Xe(xe[0].id)}catch(xe){console.error("Failed to fetch Art-Net universes:",xe)}},Gt=async()=>{if(n.osc)try{if((await window.electronAPI.initializeOsc({localPort:_e,remoteAddress:ft,remotePort:Dt})).success)return dt(!0),window.electronAPI.onOscMessageReceived(({oscMessage:qt})=>{nt(qt)})}catch(xe){console.error("Failed to initialize OSC:",xe)}};let ze=()=>{};return rt(),Gt().then(xe=>{typeof xe=="function"&&(ze=xe)}),()=>{typeof ze=="function"&&ze()}},[n]);const tt=rt=>S(rt.target.value),ut=()=>x?T():b(),Yt=()=>K?H():le(),Vt=()=>z?pe():J();return f.jsxs("div",{className:"settings-panel settings-panel-base",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"Global Settings"})}),a&&f.jsx(ba,{title:"Quick Assigns",isCollapsed:!!k.quickAssigns,onToggle:rt=>G("quickAssigns",rt),children:f.jsx(Pv,{assigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o})}),f.jsxs(ba,{title:"Channel/DAC Settings",isCollapsed:!!k.dacSettings,onToggle:rt=>G("dacSettings",rt),children:[f.jsx("p",{className:"info-text",children:"Output routing and safety zones configuration."}),f.jsx("button",{className:"small-btn",style:{width:"100%",marginTop:"5px"},onClick:e,children:"Open Output Settings"})]}),f.jsxs(ba,{title:"Processing",isCollapsed:!!k.processing,onToggle:rt=>G("processing",rt),children:[f.jsxs("div",{className:"param-editor",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("label",{className:"param-label",style:{fontSize:"11px"},children:"Point Optimization"}),f.jsx("input",{type:"checkbox",checked:u.optimizationEnabled,onChange:rt=>p("optimizationEnabled",rt.target.checked)})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:"Optimizes geometry (interpolation/dwell) before applying effects. Fixes lines in Delay effect but increases point count."})]}),(n.midi||n.artnet||n.osc||n.keyboard)&&f.jsxs("div",{className:"shortcuts-settings-panel",children:[n.keyboard&&f.jsx(ba,{title:"Keyboard Shortcuts",isCollapsed:!!k.keyboard,onToggle:rt=>G("keyboard",rt),children:f.jsxs("div",{className:"keyboard-config",children:[f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${z?"active":""}`,onClick:Vt,style:{backgroundColor:z?"var(--theme-color)":"",gridColumn:"span 2"},children:z?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:X,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:$,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:he,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>me({}),children:"Clear"})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:'Assign keys to buttons/sliders by activating "Start Mapping" and clicking a control.'})]})}),n.midi&&f.jsx(ba,{title:"MIDI Shortcuts",isCollapsed:!!k.midi,onToggle:rt=>G("midi",rt),children:h?f.jsxs("div",{className:"midi-config",children:[f.jsx("select",{className:"param-select",value:v,onChange:tt,style:{marginBottom:"8px",width:"100%"},children:g.map(rt=>f.jsx("option",{value:rt.id,children:rt.name},rt.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${x?"active":""}`,onClick:ut,style:{backgroundColor:x?"var(--theme-color)":"",gridColumn:"span 2"},children:x?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:Q,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:A,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:_,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>I({}),children:"Clear"})]}),R&&f.jsxs("div",{className:"last-event-status",children:[R.type," ",R.note||R.controller," (CH",R.channel,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing MIDI..."})}),n.artnet&&f.jsx(ba,{title:"ArtNet Shortcuts",isCollapsed:!!k.artnet,onToggle:rt=>G("artnet",rt),children:F?f.jsxs("div",{className:"artnet-config",children:[f.jsx("select",{className:"param-select",value:Ke,onChange:rt=>{Xe(rt.target.value);const Gt=parseInt(rt.target.value.replace("universe-",""));window.electronAPI&&window.electronAPI.listenArtnetUniverse&&window.electronAPI.listenArtnetUniverse(Gt)},style:{marginBottom:"8px",width:"100%"},children:Ce.map(rt=>f.jsx("option",{value:rt.id,children:rt.name},rt.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${K?"active":""}`,onClick:Yt,style:{backgroundColor:K?"var(--theme-color)":"",gridColumn:"span 2"},children:K?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:V,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:U,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:q,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>N({}),children:"Clear"})]}),ie&&f.jsxs("div",{className:"last-event-status",children:["UNIV ",ie.universe," CH ",ie.channel+1," (Val: ",ie.value,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing Art-Net..."})}),n.osc&&f.jsx(ba,{title:"OSC Shortcuts",isCollapsed:!!k.osc,onToggle:rt=>G("osc",rt),children:f.jsx("div",{className:"osc-config",children:f.jsxs("p",{className:"info-text",children:["Listening on port: ",_e]})})})]})]})},zv=({show:n,title:e,initialValue:a,onSave:s,onClose:l})=>{const[o,u]=w.useState(a||"");if(w.useEffect(()=>{n&&u(a||"")},[n,a]),!n)return null;const p=()=>{s(o),l()},h=g=>{g.key==="Enter"&&p(),g.key==="Escape"&&l()};return f.jsx("div",{className:"shortcuts-modal-overlay",style:{pointerEvents:"auto"},children:f.jsxs("div",{className:"shortcuts-modal-content",style:{maxWidth:"400px"},children:[f.jsx("h3",{children:e||"Rename"}),f.jsxs("div",{className:"settings-section",style:{border:"none"},children:[f.jsx("input",{type:"text",value:o,onChange:g=>u(g.target.value),onKeyDown:h,autoFocus:!0,style:{width:"100%",padding:"8px",backgroundColor:"#1a1a1a",color:"white",border:"1px solid var(--theme-color)",borderRadius:"4px",marginBottom:"15px"}}),f.jsxs("div",{className:"button-row",style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[f.jsx("button",{onClick:l,children:"Cancel"}),f.jsx("button",{onClick:p,style:{backgroundColor:"var(--theme-color)",color:"black"},children:"Save"})]})]})]})})},Gv=({safetyZones:n,outputArea:e,testLineY:a,testLineEnabled:s,transformationEnabled:l,transformationMode:o,flipX:u,flipY:p,onUpdateSafetyZones:h,onUpdateOutputArea:g,selectedZoneIndex:v,onSelectZone:S,gridSize:x=20,snapToGrid:b=!1})=>{const T=w.useRef(null),[M,R]=w.useState(null),I=(N,V,U)=>{N.strokeStyle="#333",N.lineWidth=1,N.beginPath();for(let q=0;q<=x;q++){const ie=q/x,z=ie*V,J=ie*U;N.moveTo(z,0),N.lineTo(z,U),N.moveTo(0,J),N.lineTo(V,J)}N.stroke(),N.strokeStyle="#666",N.lineWidth=2,N.beginPath(),N.moveTo(V/2,0),N.lineTo(V/2,U),N.moveTo(0,U/2),N.lineTo(V,U/2),N.stroke(),N.fillStyle="#aaa",N.font="10px monospace",N.fillText("0,0",5,12),N.fillText("1,0",V-25,12),N.fillText("0,1",5,U-5),N.fillText("1,1",V-25,U-5)},Q=(N,V,U,q=!1,ie=!1)=>{const{x:z,y:J,w:pe,h:me}=V;if(N.fillStyle=U,N.fillRect(z,J,pe,me),N.strokeStyle=q?"#fff":ie?"#0089ff":"#ff0000",N.lineWidth=q?2:1,N.strokeRect(z,J,pe,me),q||ie){N.fillStyle="#fff";const $=(Pe,Ke)=>N.fillRect(Pe-6/2,Ke-6/2,6,6);$(z,J),$(z+pe,J),$(z,J+me),$(z+pe,J+me);const he=4;N.fillStyle="#ccc";const Ce=(Pe,Ke)=>N.fillRect(Pe-he/2,Ke-he/2,he,he);Ce(z+pe/2,J),Ce(z+pe/2,J+me),Ce(z,J+me/2),Ce(z+pe,J+me/2)}},A=()=>{const N=T.current;if(!N)return;const V=N.getContext("2d"),{width:U,height:q}=N;if(V.clearRect(0,0,U,q),I(V,U,q),l&&e&&Q(V,{x:e.x*U,y:e.y*q,w:e.w*U,h:e.h*q},"rgba(0, 137, 255, 0.2)",!1,!0),n.forEach((ie,z)=>{Q(V,{x:ie.x*U,y:ie.y*q,w:ie.w*U,h:ie.h*q},"rgba(255, 0, 0, 0.3)",z===v)}),s){let ie=a,z=0,J=1;if(l&&e){if(o==="scale")z=e.x,J=e.x+e.w,ie=e.y+ie*e.h;else if(o==="crop"){if(ie<e.y||ie>e.y+e.h)return;z=Math.max(0,e.x),J=Math.min(1,e.x+e.w)}}const pe=ie*q,me=z*U,X=J*U;let $=[[me,X]];n&&n.length>0&&n.forEach(he=>{const Ce=he.y*q,Pe=he.h*q,Ke=he.x*U,Xe=he.w*U;if(pe>=Ce&&pe<=Ce+Pe){const wt=[];$.forEach(dt=>{const[_e,Ze]=dt,ft=Ke,Rt=Ke+Xe;Rt<=_e||ft>=Ze?wt.push(dt):(ft>_e&&wt.push([_e,ft]),Rt<Ze&&wt.push([Rt,Ze]))}),$=wt}}),V.strokeStyle="#00ff00",V.lineWidth=2,V.beginPath(),$.forEach(he=>{V.moveTo(he[0],pe),V.lineTo(he[1],pe)}),V.stroke()}};w.useEffect(()=>{A()},[n,e,a,s,l,v,x,u,p]);const _=N=>{const V=T.current.getBoundingClientRect();return{x:(N.clientX-V.left)/V.width,y:(N.clientY-V.top)/V.height}},k=(N,V,U)=>{if(!U)return null;const q=.03;return Math.abs(N-U.x)<q&&Math.abs(V-U.y)<q?"nw":Math.abs(N-(U.x+U.w))<q&&Math.abs(V-U.y)<q?"ne":Math.abs(N-U.x)<q&&Math.abs(V-(U.y+U.h))<q?"sw":Math.abs(N-(U.x+U.w))<q&&Math.abs(V-(U.y+U.h))<q?"se":Math.abs(V-U.y)<q&&N>=U.x&&N<=U.x+U.w?"n":Math.abs(V-(U.y+U.h))<q&&N>=U.x&&N<=U.x+U.w?"s":Math.abs(N-U.x)<q&&V>=U.y&&V<=U.y+U.h?"w":Math.abs(N-(U.x+U.w))<q&&V>=U.y&&V<=U.y+U.h?"e":null},G=(N,V,U)=>U?N>=U.x&&N<=U.x+U.w&&V>=U.y&&V<=U.y+U.h:!1,F=N=>{const{x:V,y:U}=_(N);if(v!==null&&n[v]){const q=n[v],ie=k(V,U,q);if(ie){R({type:"zone",index:v,handle:ie,startX:V,startY:U,originalRect:{...q}});return}}for(let q=n.length-1;q>=0;q--){const ie=n[q];if(ie&&G(V,U,ie)){S(q);const z=k(V,U,ie);R({type:"zone",index:q,handle:z||"move",startX:V,startY:U,originalRect:{...ie}});return}}if(l&&e){const q=k(V,U,e);if(q){R({type:"output",handle:q,startX:V,startY:U,originalRect:{...e}}),S(null);return}if(G(V,U,e)){R({type:"output",handle:"move",startX:V,startY:U,originalRect:{...e}}),S(null);return}}S(null)},K=N=>{if(!b)return N;const V=1/x;return Math.round(N/V)*V},le=N=>{if(!M)return;const{x:V,y:U}=_(N),q=V-M.startX,ie=U-M.startY,z=(J,pe,me,X)=>{let $={...J};if(pe==="move")$.x=K(J.x+me),$.y=K(J.y+X);else{if(pe.includes("w")){const he=K(J.x+me);$.w=J.x+J.w-he,$.x=he}if(pe.includes("e")){const he=K(J.x+J.w+me);$.w=he-$.x}if(pe.includes("n")){const he=K(J.y+X);$.h=J.y+J.h-he,$.y=he}if(pe.includes("s")){const he=K(J.y+J.h+X);$.h=he-$.y}}return $.w<.01&&($.w=.01),$.h<.01&&($.h=.01),$};if(M.type==="zone"){const J=z(M.originalRect,M.handle,q,ie);h(M.index,J)}else if(M.type==="output"){const J=z(M.originalRect,M.handle,q,ie);g(J)}},H=()=>{R(null)};return f.jsx("div",{className:"output-canvas-container",style:{width:"100%",height:"100%"},children:f.jsx("canvas",{ref:T,width:600,height:600,style:{width:"100%",height:"100%",display:"block"},className:"output-canvas",onMouseDown:F,onMouseMove:le,onMouseUp:H,onMouseLeave:H})})},Hv=({show:n,onClose:e,dacs:a=[],dacSettings:s={},onUpdateDacSettings:l})=>{const[o,u]=w.useState(null),[p,h]=w.useState(null),[g,v]=w.useState(20),[S,x]=w.useState(!1),b=w.useMemo(()=>{const A=[];return a.forEach(_=>{_.channels&&_.channels.length>0?_.channels.forEach(k=>{A.push({id:`${_.ip}:${k.serviceID}`,displayName:`${_.hostName||_.unitID||"DAC"} : ${k.name||`CH ${k.serviceID}`}`,ip:_.ip,channel:k.serviceID,dacName:_.hostName||_.unitID})}):A.push({id:`${_.ip}:0`,displayName:_.hostName||_.unitID||`DAC ${_.ip}`,ip:_.ip,channel:0,dacName:_.hostName||_.unitID})}),A},[a]);if(w.useEffect(()=>{b.length>0&&!o&&u(b[0].id)},[b,o]),!n)return null;const T=s[o]||{safetyZones:[],outputArea:{x:.1,y:.1,w:.8,h:.8},transformationEnabled:!1,transformationMode:"crop",testLineEnabled:!1,testLineY:.5,flipX:!1,flipY:!1},M=A=>{o&&l(o,{...T,...A})},R=()=>{const A={x:.4,y:.4,w:.2,h:.2};M({safetyZones:[...T.safetyZones,A]}),h(T.safetyZones.length)},I=()=>{M({safetyZones:[]}),h(null)},Q=(A,_)=>{const k=[...T.safetyZones];k[A]=_,M({safetyZones:k})};return f.jsx("div",{className:"output-settings-modal-overlay",children:f.jsxs("div",{className:"output-settings-modal-content",children:[f.jsxs("div",{className:"output-settings-header",children:[f.jsx("h2",{children:"Output Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:"Close"})]}),f.jsxs("div",{className:"output-settings-body",children:[f.jsx("div",{className:"output-settings-col",children:f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Available Outputs"}),f.jsxs("ul",{className:"dac-list",children:[b.length===0?f.jsx("li",{style:{color:"#666",fontStyle:"italic"},children:"No Outputs detected"}):null,b.map((A,_)=>f.jsxs("li",{className:`dac-list-item ${o===A.id?"selected":""}`,onClick:()=>u(A.id),children:[f.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9em"},children:A.displayName}),f.jsx("span",{style:{fontSize:"0.7em",color:"#888"},children:A.ip})]},A.id))]})]})}),f.jsxs("div",{className:"output-settings-col canvas-col",children:[f.jsxs("div",{className:"canvas-toolbar",children:[f.jsx("button",{className:"tool-btn",onClick:R,title:"Add Safety Zone",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),f.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})]})}),f.jsx("button",{className:`tool-btn ${T.transformationEnabled?"active":""}`,onClick:()=>M({transformationEnabled:!T.transformationEnabled}),title:"Toggle Output Transformation",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-border-outer",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M7.5 1.906v.938h1v-.938zm0 1.875v.938h1V3.78h-1zm0 1.875v.938h1v-.938zM1.906 8.5h.938v-1h-.938zm1.875 0h.938v-1H3.78v1zm1.875 0h.938v-1h-.938zm2.813 0v-.031H8.5V7.53h-.031V7.5H7.53v.031H7.5v.938h.031V8.5zm.937 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zM7.5 9.406v.938h1v-.938zm0 1.875v.938h1v-.938zm0 1.875v.938h1v-.938z"}),f.jsx("path",{d:"M0 0v16h16V0zm1 1h14v14H1z"})]})}),f.jsx("button",{className:`tool-btn ${T.testLineEnabled?"active":""}`,onClick:()=>M({testLineEnabled:!T.testLineEnabled}),title:"Toggle Test Line",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),f.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})]})}),f.jsx("span",{style:{width:1,background:"#555",margin:"0 5px"}}),f.jsx("button",{className:`tool-btn ${S?"active":""}`,onClick:()=>x(!S),title:"Snap to Grid",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-magnet-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M15 12h-4v3h4zM5 12H1v3h4zM0 8a8 8 0 1 1 16 0v8h-6V8a2 2 0 1 0-4 0v8H0z"})})}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:5},children:[f.jsx("span",{style:{fontSize:10,color:"#aaa"},children:"Grid:"}),f.jsx("input",{type:"number",min:"5",max:"100",value:g,onChange:A=>v(parseInt(A.target.value)),className:"param-number-input",style:{width:40}})]})]}),f.jsx(Gv,{safetyZones:T.safetyZones,outputArea:T.outputArea,testLineY:T.testLineY,testLineEnabled:T.testLineEnabled,transformationEnabled:T.transformationEnabled,transformationMode:T.transformationMode,flipX:T.flipX,flipY:T.flipY,onUpdateSafetyZones:Q,onUpdateOutputArea:A=>M({outputArea:A}),selectedZoneIndex:p,onSelectZone:h,gridSize:g,snapToGrid:S})]}),f.jsx("div",{className:"output-settings-col",children:o?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Output Transformation"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Editing"}),f.jsx("input",{type:"checkbox",checked:T.transformationEnabled,onChange:A=>M({transformationEnabled:A.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip X"}),f.jsx("input",{type:"checkbox",checked:T.flipX||!1,onChange:A=>M({flipX:A.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip Y"}),f.jsx("input",{type:"checkbox",checked:T.flipY||!1,onChange:A=>M({flipY:A.target.checked})})]}),T.transformationEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{style:{flex:1},children:"Mode"}),f.jsxs("select",{className:"param-select",value:T.transformationMode,onChange:A=>M({transformationMode:A.target.value}),children:[f.jsx("option",{value:"crop",children:"Crop"}),f.jsx("option",{value:"scale",children:"Scale"})]})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Safety Zones"}),f.jsxs("div",{className:"control-row",style:{justifyContent:"space-between",marginBottom:5},children:[f.jsx("button",{className:"small-btn",onClick:R,children:"Add New"}),f.jsx("button",{className:"small-btn clear",onClick:I,children:"Clear All"})]}),f.jsx("div",{className:"zone-list",children:T.safetyZones.map((A,_)=>f.jsxs("div",{className:`zone-item ${p===_?"selected":""}`,onClick:()=>h(_),children:[f.jsxs("span",{children:["Zone ",_+1]}),f.jsx("button",{className:"delete-zone-btn",onClick:k=>{k.stopPropagation(),p===_&&h(null);const G=T.safetyZones.filter((F,K)=>K!==_);M({safetyZones:G})},children:""})]},_))}),p!==null&&f.jsxs("div",{style:{marginTop:10,borderTop:"1px solid #333",paddingTop:5},children:[f.jsx("label",{children:"Selected Zone Properties"}),f.jsx("div",{style:{fontSize:"0.8em",color:"#aaa"},children:"Select and drag zone on canvas to resize."})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Test Output"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Test Line"}),f.jsx("input",{type:"checkbox",checked:T.testLineEnabled,onChange:A=>M({testLineEnabled:A.target.checked})})]}),T.testLineEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{children:"Y Position"}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:T.testLineY,onChange:A=>M({testLineY:parseFloat(A.target.value)}),className:"param-slider"})]})]})]}):f.jsx("div",{style:{padding:20,textAlign:"center",color:"#666"},children:"Select an Output to configure settings"})})]})]})})},ig=()=>{const n=Ao();return n||{}},Yv=({show:n,onClose:e,initialTab:a="output"})=>{const s=Ao(),{fftSettings:l,setFftSettings:o,inputDevices:u,selectedInputDeviceId:p,setSelectedInputDeviceId:h}=s||{},{devices:g,selectedDeviceId:v,setSelectedDeviceId:S,globalVolume:x,setVolume:b}=ig(),[T,M]=w.useState(a);if(Bn.useEffect(()=>{n&&M(a)},[n,a]),!n)return null;if(!l)return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{padding:"20px",color:"red",border:"1px solid red",background:"#222"},children:[f.jsx("h3",{children:"Error"}),f.jsx("p",{children:"Audio Context is not available."}),f.jsx("p",{children:"Please restart the application or report this bug."}),f.jsx("button",{onClick:e,style:{marginTop:"10px",padding:"5px 10px"},children:"Close"})]}),f.jsx("style",{children:`
                    .modal-overlay {
                        position: fixed;
                        top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 10000;
                    }
                `})]});const R=(I,Q,A)=>{const _={...l},k=`${I}Range`;_[k][Q]=parseFloat(A),o(_)};return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Audio Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsxs("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"},children:[f.jsx("button",{className:`tab-btn ${T==="output"?"active":""}`,onClick:()=>M("output"),style:{padding:"8px 15px",background:"none",border:"none",color:T==="output"?"var(--theme-color)":"#888",borderBottom:T==="output"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"Audio Output"}),f.jsx("button",{className:`tab-btn ${T==="fft"?"active":""}`,onClick:()=>M("fft"),style:{padding:"8px 15px",background:"none",border:"none",color:T==="fft"?"var(--theme-color)":"#888",borderBottom:T==="fft"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"FFT Settings"})]}),f.jsxs("div",{className:"modal-body",children:[T==="output"&&f.jsxs("div",{className:"audio-output-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Device"}),f.jsx("select",{className:"param-select",value:v,onChange:I=>S(I.target.value),style:{width:"100%",padding:"5px"},children:g.map(I=>f.jsx("option",{value:I.deviceId,children:I.label||`Device ${I.deviceId.slice(0,5)}`},I.deviceId))})]}),f.jsxs("div",{className:"settings-row",style:{textAlign:"center"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Volume"}),f.jsx("div",{style:{display:"flex",justifyContent:"center"},children:f.jsx(_i,{value:x,onChange:b,label:"MASTER",isAssigned:!0,size:60})})]})]}),T==="fft"&&f.jsxs("div",{className:"fft-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Source"}),f.jsxs("select",{className:"param-select",value:l.source,onChange:I=>o({...l,source:I.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"external",children:"External (Microphone/Loopback)"}),f.jsx("option",{value:"system",children:"System Audio (Loopback)"}),f.jsx("option",{value:"clip",children:"Clip FFT (Audio from active clips)"})]})]}),l.source==="external"&&f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Input Device"}),f.jsxs("select",{className:"param-select",value:p,onChange:I=>h(I.target.value),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"default",children:"Default Input"}),u.map(I=>f.jsx("option",{value:I.deviceId,children:I.label||`Input ${I.deviceId.slice(0,5)}`},I.deviceId))]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Calculation Mode"}),f.jsxs("select",{className:"param-select",value:l.calculationMode||"average",onChange:I=>o({...l,calculationMode:I.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"average",children:"Average (Smooth)"}),f.jsx("option",{value:"peak",children:"Peak (Transient/Punchy)"})]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Ranges (Hz)"}),f.jsxs("div",{className:"range-controls",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"10px",alignItems:"center"},children:[f.jsx("span",{children:"Low:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.lowRange[0],onChange:I=>R("low",0,I.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.lowRange[1],onChange:I=>R("low",1,I.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"Mid:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.midRange[0],onChange:I=>R("mid",0,I.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.midRange[1],onChange:I=>R("mid",1,I.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"High:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.highRange[0],onChange:I=>R("high",0,I.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.highRange[1],onChange:I=>R("high",1,I.target.value),style:{width:"60px"}})]})]})]}),f.jsxs("div",{className:"settings-row",style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"GAIN"}),f.jsx(_i,{value:l.gain/5,onChange:I=>o({...l,gain:I*5}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"SMOOTH"}),f.jsx(_i,{value:l.smoothingTimeConstant||.8,onChange:I=>o({...l,smoothingTimeConstant:I}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"HOLD"}),f.jsx(_i,{value:l.holdTime/1e3,onChange:I=>o({...l,holdTime:I*1e3}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"FALL"}),f.jsx(_i,{value:l.fallTime/2e3,onChange:I=>o({...l,fallTime:I*2e3}),isAssigned:!0,size:40})]})]})]})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]})},Vv=({missingFiles:n,onRelocate:e,onClose:a})=>!n||n.length===0?null:f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{width:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Missing Files"}),f.jsx("button",{className:"close-btn",onClick:a,children:""})]}),f.jsxs("div",{className:"modal-body",style:{overflowY:"auto",flex:1},children:[f.jsx("p",{style:{marginBottom:"15px",color:"#ccc",fontSize:"0.9em"},children:"The following files could not be found. Please locate one of them to update the path for all matching files in the same directory."}),f.jsx("ul",{style:{listStyle:"none",padding:0},children:n.map((s,l)=>f.jsxs("li",{style:{background:"#333",padding:"10px",marginBottom:"5px",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{overflow:"hidden"},children:[f.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9em"},children:s.fileName}),f.jsx("div",{style:{fontSize:"0.8em",color:"#888",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"350px"},children:s.filePath})]}),f.jsx("button",{className:"small-btn",onClick:()=>e(s),style:{marginLeft:"10px",whiteSpace:"nowrap"},children:"Locate"})]},l))})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex; justify-content: center; align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .small-btn {
                    background: var(--theme-color);
                    color: black;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: bold;
                }
                .small-btn:hover {
                    opacity: 0.9;
                }
            `})]});class qv extends Bn.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,a){console.error("Uncaught error:",e,a)}render(){return this.state.hasError?f.jsx("h1",{children:"Something went wrong."}):this.props.children}}const Ff=32,$0=8;function hl(n,e,a,s){for(let l=0;l<s;l++)n.setUint8(e+l,l<a.length?a.charCodeAt(l):0)}function lg(n){let e=Ff;n.forEach(o=>{e+=Ff;const u=o.points?o.points.length:0;e+=u*$0});const a=new ArrayBuffer(e),s=new DataView(a);let l=0;return n.forEach((o,u)=>{const p=o.points||[],h=p.length;hl(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),hl(s,l+8,o.frameName||"TrueLazr",8),hl(s,l+16,o.companyName||"Gemini",8),s.setUint16(l+24,h,!1),s.setUint16(l+26,u,!1),s.setUint16(l+28,n.length,!1),s.setUint8(l+30,o.scannerHead||0),s.setUint8(l+31,0),l+=Ff;for(let g=0;g<h;g++){const v=p[g];let S=Math.max(-32768,Math.min(32767,Math.round((v.x||0)*32767))),x=Math.max(-32768,Math.min(32767,Math.round((v.y||0)*32767)));s.setInt16(l,S,!1),s.setInt16(l+2,x,!1);let b=0;v.blanking&&(b|=64),g===h-1&&(b|=128),s.setUint8(l+4,b);let T=0,M=0,R=0;if(!v.blanking){const I=v.r??0,Q=v.g??0,A=v.b??0;I<=1&&Q<=1&&A<=1&&(I>0||Q>0||A>0)?(T=Math.round(I*255),M=Math.round(Q*255),R=Math.round(A*255)):(T=Math.round(I),M=Math.round(Q),R=Math.round(A))}s.setUint8(l+5,Math.max(0,Math.min(255,R))),s.setUint8(l+6,Math.max(0,Math.min(255,M))),s.setUint8(l+7,Math.max(0,Math.min(255,T))),l+=$0}}),hl(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),hl(s,l+8,"EOF",8),hl(s,l+16,"TrueLazr",8),s.setUint16(l+24,0,!1),s.setUint16(l+26,0,!1),s.setUint16(l+28,0,!1),s.setUint8(l+30,0),s.setUint8(l+31,0),a}const W0=Object.freeze(Object.defineProperty({__proto__:null,framesToIlda:lg},Symbol.toStringTag,{value:"Module"})),Uf=[{r:255,g:0,b:0},{r:255,g:17,b:0},{r:255,g:34,b:0},{r:255,g:51,b:0},{r:255,g:68,b:0},{r:255,g:85,b:0},{r:255,g:102,b:0},{r:255,g:119,b:0},{r:255,g:136,b:0},{r:255,g:153,b:0},{r:255,g:170,b:0},{r:255,g:187,b:0},{r:255,g:204,b:0},{r:255,g:221,b:0},{r:255,g:238,b:0},{r:255,g:255,b:0},{r:255,g:255,b:0},{r:238,g:255,b:0},{r:204,g:255,b:0},{r:170,g:255,b:0},{r:136,g:255,b:0},{r:102,g:255,b:0},{r:68,g:255,b:0},{r:34,g:255,b:0},{r:0,g:255,b:0},{r:0,g:255,b:34},{r:0,g:255,b:68},{r:0,g:255,b:102},{r:0,g:255,b:136},{r:0,g:255,b:170},{r:0,g:255,b:204},{r:0,g:255,b:238},{r:0,g:136,b:255},{r:0,g:119,b:255},{r:0,g:102,b:255},{r:0,g:102,b:255},{r:0,g:85,b:255},{r:0,g:68,b:255},{r:0,g:68,b:255},{r:0,g:34,b:255},{r:0,g:0,b:255},{r:34,g:0,b:255},{r:68,g:0,b:255},{r:102,g:0,b:255},{r:136,g:0,b:255},{r:170,g:0,b:255},{r:204,g:0,b:255},{r:238,g:0,b:255},{r:255,g:0,b:255},{r:255,g:34,b:255},{r:255,g:68,b:255},{r:255,g:102,b:255},{r:255,g:136,b:255},{r:255,g:170,b:255},{r:255,g:204,b:255},{r:255,g:238,b:255},{r:255,g:255,b:255},{r:255,g:238,b:238},{r:255,g:204,b:204},{r:255,g:170,b:170},{r:255,g:136,b:136},{r:255,g:102,b:102},{r:255,g:68,b:68},{r:0,g:34,b:34}];function Xv(n,e,a,s,l=Uf){const o=[],u=new DataView(n);let p=0;try{for(let h=0;h<s;h++){if(e===2){p+=a;continue}let g,v,S=0,x,b,T,M;e===0||e===4?(g=u.getInt16(p,!1)/32768,v=u.getInt16(p+2,!1)/32768,S=u.getInt16(p+4,!1)/32768,M=u.getUint8(p+6)):(g=u.getInt16(p,!1)/32768,v=u.getInt16(p+2,!1)/32768,M=u.getUint8(p+4));const R=(M&64)!==0,I=(M&128)!==0;if(e===0||e===1){const Q=u.getUint8(p+(e===0?7:5)),A=l||Uf,_=A[Q%A.length]||Uf[0];x=_.r,b=_.g,T=_.b}else(e===4||e===5)&&(T=u.getUint8(p+(e===4?7:5)),b=u.getUint8(p+(e===4?8:6)),x=u.getUint8(p+(e===4?9:7)));if(o.push({x:g,y:v,z:S,r:x===void 0?255:x,g:b===void 0?255:b,b:T===void 0?255:T,blanking:R,lastPoint:I}),p+=a,I)break}}catch(h){console.warn("Parser: Error reading points:",h)}return o}const $v=n=>{const e=[],a=new DataView(n);let s=0,l=null,o=null;for(;s+32<=a.byteLength;){if(String.fromCharCode(a.getUint8(s),a.getUint8(s+1),a.getUint8(s+2),a.getUint8(s+3))!=="ILDA"){s++;continue}const p=a.getUint8(s+7);o===null&&(o=p);const h=String.fromCharCode(...new Uint8Array(n,s+8,8)).trim(),g=String.fromCharCode(...new Uint8Array(n,s+16,8)).trim();let v=a.getUint16(s+24,!1);const S=a.getUint16(s+26,!1),x=a.getUint16(s+28,!1),b=a.getUint8(s+30);let T;switch(p){case 0:T=8;break;case 1:T=6;break;case 2:T=3;break;case 4:T=10;break;case 5:T=8;break;default:s+=32;continue}if(p===2){l=[];const I=s+32;for(let Q=0;Q<v;Q++){const A=a.getUint8(I+Q*3),_=a.getUint8(I+Q*3+1),k=a.getUint8(I+Q*3+2);l.push({r:A,g:_,b:k})}}let M=v*T,R=32+M;if(s+R>n.byteLength)break;if(v>0&&p!==2){const I=n.slice(s+32,s+32+M),Q=Xv(I,p,T,v,l);e.push({frameName:h,companyName:g,frameNumber:S,totalFrames:x,scannerHead:b,points:Q,formatCode:p})}s+=R}return{frames:e,firstFormatCode:o,colorPalette:l}};function ml(n,e=!1,a=.5){if(!n||n.length<2)return n||[];const s=[],l=n.length,o=p=>e?n[(p+l)%l]:n[Math.max(0,Math.min(l-1,p))],u=e?l:l-1;for(let p=0;p<u;p++){const h=o(p-1),g=o(p),v=o(p+1),S=o(p+2);let x,b;!e&&l===2?(x={x:g.x+(v.x-g.x)/3,y:g.y+(v.y-g.y)/3},b={x:v.x-(v.x-g.x)/3,y:v.y-(v.y-g.y)/3}):(x={x:g.x+(v.x-h.x)*a/3,y:g.y+(v.y-h.y)*a/3},b={x:v.x-(S.x-g.x)*a/3,y:v.y-(S.y-g.y)*a/3}),p===0&&s.push({...g}),s.push(x),s.push(b),s.push({...v})}return s}const Wv=({onBack:n})=>{const[e,a]=w.useState("select"),[s,l]=w.useState("#00ff00"),[o,u]=w.useState("simple"),[p,h]=w.useState(!1),[g,v]=w.useState(1),[S,x]=w.useState(1),[b,T]=w.useState(0),[M,R]=w.useState(!1),[I,Q]=w.useState(!0),[A,_]=w.useState([[]]),[k,G]=w.useState(null),[F,K]=w.useState([[[]]]),[le,H]=w.useState(0),[N,V]=w.useState([]),[U,q]=w.useState([]),[ie,z]=w.useState([]),[J,pe]=w.useState(null),[me,X]=w.useState(null),[$,he]=w.useState(.6),[Ce,Pe]=w.useState({x:0,y:0}),[Ke,Xe]=w.useState(!0),[wt,dt]=w.useState(!1),[_e,Ze]=w.useState(25),[ft,Rt]=w.useState(!1),[Dt,zt]=w.useState(!1),[Xn,nt]=w.useState(!1),[tt,ut]=w.useState({visible:!1,x:0,y:0,target:null}),[Yt,Vt]=w.useState(0),[rt,Gt]=w.useState(-1),[ze,xe]=w.useState(0),[wn,qt]=w.useState(0),[Xt,$t]=w.useState(!0),[pt,os]=w.useState(!0),[xa,ar]=w.useState(0),[On,rr]=w.useState("fps"),[ea,La]=w.useState(1),[$n,Hr]=w.useState(120),[pa,at]=w.useState(2),[gt,Yr]=w.useState(30),[Ma,Sa]=w.useState(8),Pi=w.useRef(On),ja=w.useRef(ea),Vr=w.useRef($n),cs=w.useRef(pa),sr=w.useRef(gt),Wn=w.useRef(Ma),un=w.useRef(g),tn=w.useRef(xa);w.useEffect(()=>{Pi.current=On},[On]),w.useEffect(()=>{ja.current=ea},[ea]),w.useEffect(()=>{Vr.current=$n},[$n]),w.useEffect(()=>{cs.current=pa},[pa]),w.useEffect(()=>{sr.current=gt},[gt]),w.useEffect(()=>{Wn.current=Ma},[Ma]),w.useEffect(()=>{un.current=g},[g]),w.useEffect(()=>{tn.current=xa},[xa]);const Cn=w.useRef(null),ha=w.useRef(null),Ft=w.useRef({x:0,y:0}),us=w.useRef(!1),ta=w.useRef(!1),hn=w.useRef(!1),Fa=w.useRef(!1),ir=w.useRef(!1),Mn=w.useRef(!1),nn=w.useRef(null);w.useRef(null);const lr=w.useRef(performance.now()),yn=w.useRef(0),mn=1e3,ot=A[b]||[],Et=y=>{const C=F.slice(0,le+1);C.push(JSON.parse(JSON.stringify(y))),C.length>30&&C.shift(),K(C),H(C.length-1)},En=(y,C=!0)=>{const Y=ga(y,C);if(Y.length===0)return{x:0,y:0,w:0,h:0};const P=Math.min(...Y.map(ue=>ue.x)),B=Math.max(...Y.map(ue=>ue.x)),O=Math.min(...Y.map(ue=>ue.y)),ne=Math.max(...Y.map(ue=>ue.y));return{x:P,y:O,w:B-P,h:ne-O}},Bi=()=>{if(N.length<2)return;const y=[...A],C=[...y[b]],Y=N.sort((O,ne)=>ne-O).map(O=>C.splice(O,1)[0]),P={type:"group",shapes:Y.reverse(),color:Y[0].color,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0},B=St(P);P.pivotX=B.x,P.pivotY=B.y,C.push(P),y[b]=C,_(y),Et(y),V([C.length-1])},hi=()=>{if(N.length!==1)return;const y=ot[N[0]];if(y.type!=="group")return;const C=[...A],Y=[...C[b]];Y.splice(N[0],1);const P=y.shapes.map(B=>{const O=Pa(an(B),y);return{...B,points:O,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}});Y.push(...P),C[b]=Y,_(C),Et(C),V([])},Ln=(y,C)=>Math.sqrt(Math.pow(C.x-y.x,2)+Math.pow(C.y-y.y,2)),Ua=y=>{if(y.startsWith("rgb")){const Y=y.match(/\d+/g);return{r:parseInt(Y[0]),g:parseInt(Y[1]),b:parseInt(Y[2])}}const C=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return C?{r:parseInt(C[1],16),g:parseInt(C[2],16),b:parseInt(C[3],16)}:{r:0,g:0,b:0}},or=y=>{if(!y)return"#ffffff";if(y.startsWith("#"))return y;if(y.startsWith("rgb")){const C=Ua(y),Y=C.r.toString(16).padStart(2,"0"),P=C.g.toString(16).padStart(2,"0"),B=C.b.toString(16).padStart(2,"0");return`#${Y}${P}${B}`}return"#ffffff"},ma=y=>{const{r:C,g:Y,b:P}=Ua(or(y));return`rgb(${255-C}, ${255-Y}, ${255-P})`},Zt=(y,C,Y)=>{const P=Math.pow(Ln(C,Y),2);if(P===0)return Ln(y,C);let B=((y.x-C.x)*(Y.x-C.x)+(y.y-C.y)*(Y.y-C.y))/P;return B=Math.max(0,Math.min(1,B)),Ln(y,{x:C.x+B*(Y.x-C.x),y:C.y+B*(Y.y-C.y)})},St=(y,C=!1)=>{if(!y)return{x:500,y:500};if(y.type==="rect"&&!C)return{x:y.start.x+y.width/2,y:y.start.y+y.height/2};if((y.type==="circle"||y.type==="star"||y.type==="triangle")&&!C)return y.start;if(y.type==="line"&&!C)return{x:(y.start.x+y.end.x)/2,y:(y.start.y+y.end.y)/2};const Y=ga(y,C);if(Y.length===0)return{x:500,y:500};const P=Y.reduce((B,O)=>({x:B.x+(O.x||0),y:B.y+(O.y||0)}),{x:0,y:0});return{x:P.x/Y.length,y:P.y/Y.length}},ka=(y,C)=>{if(!C||!y)return null;const Y=Array.isArray(C)?C:[C];if(y.type==="group")return ka(y.shapes[Y[0]],Y.slice(1));const P=Y[0];return y.type==="line"?P===0?y.start:y.end:y.type==="rect"?[y.start,{x:y.start.x+y.width,y:y.start.y},{x:y.start.x+y.width,y:y.start.y+y.height},{x:y.start.x,y:y.start.y+y.height}][P]:y.type==="circle"||y.type==="star"||y.type==="triangle"?[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}][P]:y.points?y.points[P]:null},kn=y=>y?y.pivotX!==void 0&&y.pivotY!==void 0?{x:y.pivotX,y:y.pivotY}:St(y):{x:500,y:500},Pa=w.useCallback((y,C)=>{if(!y||y.length===0||!C)return y;C.type==="group"&&C.shapes;const Y=kn(C),P=C.scaleX??1,B=C.scaleY??1,O=C.rotationX||0,ne=C.rotationY||0,ue=C.rotationZ||C.rotation||0;return P===1&&B===1&&O===0&&ne===0&&ue===0?y:y.map(te=>{let ee=te.x-Y.x,ae=te.y-Y.y,fe=te.z||0;if(ee*=P,ae*=B,ue!==0){const Ae=ee*Math.cos(ue)-ae*Math.sin(ue),De=ee*Math.sin(ue)+ae*Math.cos(ue);ee=Ae,ae=De}if(O!==0){const Ae=ae*Math.cos(O)-fe*Math.sin(O),De=ae*Math.sin(O)+fe*Math.cos(O);ae=Ae,fe=De}if(ne!==0){const Ae=ee*Math.cos(ne)+fe*Math.sin(ne),De=-ee*Math.sin(ne)+fe*Math.cos(ne);ee=Ae,fe=De}return{...te,x:Y.x+ee,y:Y.y+ae,z:fe}})},[]),an=w.useCallback(y=>{if(!y)return[];let C=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline")C=y.points||[];else if(y.type==="bezier"){const Y=(y.points||[]).filter(P=>!!P);if(Y.length>=4)for(let P=0;P<=Y.length-4;P+=3){const B=Y[P],O=Y[P+1],ne=Y[P+2],ue=Y[P+3];if(B&&O&&ne&&ue){const te=P===0?0:1;for(let ee=te;ee<=20;ee++){const ae=ee/20,fe=1-ae;C.push({x:Math.pow(fe,3)*B.x+3*Math.pow(fe,2)*ae*O.x+3*fe*Math.pow(ae,2)*ne.x+Math.pow(ae,3)*ue.x,y:Math.pow(fe,3)*B.y+3*Math.pow(fe,2)*ae*O.y+3*fe*Math.pow(ae,2)*ne.y+Math.pow(ae,3)*ue.y,color:B.color})}}}else C=Y}else if(y.type==="line")C=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const Y=y.color,P=y.cornerColors||[Y,Y,Y,Y];C=[{x:y.start.x,y:y.start.y,color:P[0]},{x:y.start.x+y.width,y:y.start.y,color:P[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:P[2]},{x:y.start.x,y:y.start.y+y.height,color:P[3]}]}else if(y.type==="circle"){const Y=Math.abs(y.end.x-y.start.x),P=Math.abs(y.end.y-y.start.y),B=y.color;for(let O=0;O<32;O++){const ne=O/32*Math.PI*2;C.push({x:y.start.x+Math.cos(ne)*Y,y:y.start.y+Math.sin(ne)*P,color:B})}}else if(y.type==="star"){const Y=Math.abs(y.end.x-y.start.x),P=Math.abs(y.end.y-y.start.y),B=y.color,O=5,ne=Y,ue=Y/2.5;let te=Math.PI/2*3;const ee=Math.PI/O;for(let ae=0;ae<O;ae++)C.push({x:y.start.x+Math.cos(te)*ne,y:y.start.y+Math.sin(te)*P,color:B}),te+=ee,C.push({x:y.start.x+Math.cos(te)*ue,y:y.start.y+Math.sin(te)*(P/2.5),color:B}),te+=ee}else if(y.type==="triangle"){const Y=Math.abs(y.end.x-y.start.x),P=Math.abs(y.end.y-y.start.y),B=y.color;C=[{x:y.start.x-Y,y:y.start.y+P,color:B},{x:y.start.x+Y,y:y.start.y+P,color:B},{x:y.start.x,y:y.start.y-P,color:B}]}else y.type==="group"&&y.shapes.forEach(Y=>C.push(...an(Y)));return Pa(C,y)},[Pa]),ga=w.useCallback((y,C=!0)=>{if(!y)return[];let Y=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline"||y.type==="bezier")Y=y.points||[];else if(y.type==="line")Y=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const P=y.color,B=y.cornerColors||[P,P,P,P];Y=[{x:y.start.x,y:y.start.y,color:B[0]},{x:y.start.x+y.width,y:y.start.y,color:B[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:B[2]},{x:y.start.x,y:y.start.y+y.height,color:B[3]}]}else y.type==="circle"||y.type==="star"||y.type==="triangle"?Y=[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}]:y.type==="group"&&y.shapes.forEach(P=>Y.push(...ga(P,!0)));return C?Pa(Y,y):Y},[Pa]),wa=(y,C,Y,P=[],B=[])=>{if(y.hidden||y.locked)return null;const O=15/$,ne=ga(y);if(y.type!=="group"){const fe=[];for(let Ae=0;Ae<ne.length;Ae++)Ln(ne[Ae],C)<O&&fe.push({type:"point",index:Ae,path:[...B,Ae]});if(fe.length>0)return fe.find(De=>!P.some(Oe=>JSON.stringify(Oe)===JSON.stringify(De.path)))||fe[0]}const ue=St(y),te=kn(y);if(Y&&Ln(te,C)<15/$)return{type:"pivot"};if(Y&&Ln(ue,C)<20/$)return{type:"shape"};if(y.type==="group")for(let fe=y.shapes.length-1;fe>=0;fe--){const Ae=wa(y.shapes[fe],C,!0,P,[...B,fe]);if(Ae&&Ae.type==="point")return Ae}const ee=an(y),ae=["rect","circle","star","polygon"].includes(y.type);for(let fe=0;fe<ee.length-1;fe++)if(Zt(C,ee[fe],ee[fe+1])<O)return{type:"segment",index:fe,path:[...B,fe]};return ae&&ee.length>2&&Zt(C,ee[ee.length-1],ee[0])<O?{type:"segment",index:ee.length-1,path:[...B,ee.length-1]}:null},bn=w.useCallback((y,C)=>{if(!Cn.current)return{x:500,y:500};const Y=Cn.current.getBoundingClientRect(),P=y-Y.left,B=C-Y.top;return{x:(P-Y.width/2)/$+mn/2-Ce.x,y:(B-Y.height/2)/$+mn/2-Ce.y}},[$,Ce]),cr=w.useCallback((y,C,Y=[])=>{if(!wt)return{x:y,y:C};const P=10/$;let B=null,O=P;return ot.forEach((ne,ue)=>{if(ne.hidden)return;ga(ne).forEach((ee,ae)=>{const fe=[ue,ae];if(Y.some(Oe=>JSON.stringify(Oe)===JSON.stringify(fe)))return;const De=Ln({x:y,y:C},ee);De<O&&(O=De,B={x:ee.x,y:ee.y})})}),B||{x:Math.round(y/_e)*_e,y:Math.round(C/_e)*_e}},[wt,_e,ot,$,ga]),qr=y=>{y.preventDefault();const C=Math.pow(1.1,-y.deltaY/100);he(Y=>Math.max(.1,Math.min(10,Y*C)))},Xr=y=>{if(y.preventDefault(),p&&k){mr();return}const C=bn(y.clientX,y.clientY);for(let Y=ot.length-1;Y>=0;Y--){const P=wa(ot[Y],C,N.includes(Y),U);if(P){ut({visible:!0,x:y.clientX,y:y.clientY,target:{...P,shapeIndex:Y,pos:C}}),N.includes(Y)||V([Y]);return}}ut({visible:!0,x:y.clientX,y:y.clientY,target:{type:"canvas"}})},Tr=()=>{if(N.length!==1||U.length===0)return;const y=N[0],C=[...A],Y=[...C[b]],P=Y[y];if(!P.points){alert("Only point-based shapes can be split. Convert to points first.");return}const B=U.map(te=>Array.isArray(te)?te[0]:te).sort((te,ee)=>te-ee),O=B.map(te=>({...P.points[te]})),ne=P.points.filter((te,ee)=>!B.includes(ee));if(O.length===0)return;ne.length<2?Y.splice(y,1):Y[y]={...P,points:ne};const ue={...P,type:"polyline",points:O,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};Y.push(ue),C[b]=Y,_(C),Et(C),V([Y.length-1]),q([]),ut({visible:!1,x:0,y:0,target:null})},$r=()=>{const y=U.length>0?U:tt.target?.type==="point"?[tt.target.path||[tt.target.index]]:[];if(y.length===0)return;const C=[...A],Y=[...C[b]],P={};y.forEach(ne=>{const ue=Array.isArray(ne)?ne:[ne];if(N.length===1){const te=N[0];P[te]||(P[te]=[]),P[te].push(ue)}else if(tt.target?.shapeIndex!==void 0){const te=tt.target.shapeIndex;P[te]||(P[te]=[]),P[te].push(ue)}});const B=(ne,ue)=>{if(ne.type==="group")return ne.shapes=ne.shapes.map((te,ee)=>{const ae=ue.filter(fe=>fe[0]===ee).map(fe=>fe.slice(1));return ae.length>0?B({...te},ae):te}).filter(te=>!!te),ne.shapes.length>0?ne:null;{if(!ne.points)return null;const te=ue.map(ae=>ae[0]),ee=ne.points.filter((ae,fe)=>!te.includes(fe));return ee.length<2?null:{...ne,points:ee}}};let O=!1;Object.keys(P).forEach(ne=>{const ue=parseInt(ne),te=B(Y[ue],P[ne]);te?Y[ue]=te:Y.splice(ue,1),O=!0}),O&&(C[b]=Y,_(C),Et(C),q([])),ut({visible:!1,x:0,y:0,target:null})},mi=()=>{if(!tt.target||tt.target.type!=="segment")return;const{shapeIndex:y,index:C}=tt.target,Y=[...A],P=[...Y[b]],B={...P[y]};if(B.type==="line"||B.type==="rect"||B.type==="circle"||B.type==="star")P.splice(y,1),V([]);else if(B.points){if(B.type==="polygon"){const O=[];for(let ne=0;ne<B.points.length;ne++)O.push(B.points[(C+1+ne)%B.points.length]);B.points=O,B.type="polyline",P[y]=B}else if(B.type==="polyline"||B.type==="pen"){const O=B.points.slice(0,C+1),ne=B.points.slice(C+1);P.splice(y,1),O.length>1&&P.push({...B,points:O}),ne.length>1&&P.push({...B,points:ne}),V([])}else if(B.type==="bezier"){const O=[...B.points];O.splice(C,2),O.length<3?P.splice(y,1):(B.points=O,P[y]=B),V([])}}Y[b]=P,_(Y),Et(Y),ut({visible:!1,x:0,y:0,target:null})},Zn=()=>{if(!tt.target||tt.target.type!=="segment")return;const{shapeIndex:y,index:C,pos:Y}=tt.target,P=[...A],B=[...P[b]],O={...B[y]};if(O.points){const ne=[...O.points];ne.splice(C+1,0,{...Y,color:s}),B[y]={...O,points:ne}}else O.type==="line"&&(B[y]={type:"polyline",color:O.color,renderMode:O.renderMode||"simple",points:[{x:O.start.x,y:O.start.y,color:O.startColor||O.color},{x:Y.x,y:Y.y,color:s},{x:O.end.x,y:O.end.y,color:O.endColor||O.color}],rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1});P[b]=B,_(P),Et(P),ut({visible:!1,x:0,y:0,target:null})},Cr=()=>{if(!tt.target||tt.target.shapeIndex===void 0)return;const{shapeIndex:y}=tt.target,C=[...A],Y=[...C[b]],P=Y[y];if(["rect","circle","star","line"].includes(P.type)){const B=an(P),O={type:P.type==="line"?"polyline":"polygon",color:P.color,renderMode:P.renderMode||"simple",points:B,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};Y[y]=O,C[b]=Y,_(C),Et(C)}ut({visible:!1,x:0,y:0,target:null})},fs=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]];N.forEach(Y=>{const P={...C[Y]};delete P.pivotX,delete P.pivotY,C[Y]=P}),y[b]=C,_(y),Et(y),ut({visible:!1,x:0,y:0,target:null})},Ba=w.useCallback(y=>rr(y),[]),Mr=w.useCallback(y=>Hr(y),[]),_s=w.useCallback(y=>Yr(y),[]),kr=w.useCallback(y=>at(y),[]),za=w.useCallback(y=>Sa(y),[]),ds=w.useCallback(y=>La(y),[]),Nr=(y,C,Y=1)=>{y.preventDefault();const P=y.deltaY<0?Y:-Y;C(B=>Math.max(0,B+P))},Rr=y=>Nr(y,Hr),Os=y=>Nr(y,Sa),Wr=y=>Nr(y,at,.1),gi=y=>{y.preventDefault();const C=y.deltaY<0?1:-1;xe(Y=>Math.max(0,Y+C))},Ls=y=>{y.preventDefault();const C=y.deltaY<0?1:-1;qt(Y=>Math.max(0,Y+C))},js=y=>{y.preventDefault();const C=y.deltaY<0?1:-1;ar(Y=>Math.max(0,Math.min(g-1,Y+C)))},Dr=()=>{if(ze>=wn){alert("Start frame must be before end frame");return}const y=[...A],C=A[ze],Y=A[wn];if(!C||!Y||C.length===0||Y.length===0){alert("Both start and end frames must contain shapes");return}const P=wn-ze;for(let B=1;B<P;B++){const O=B/P,ne=ze+B,ue=[];C.forEach((te,ee)=>{const ae=Y[ee];if(!ae||te.type!==ae.type){ue.push(O<.5?JSON.parse(JSON.stringify(te)):JSON.parse(JSON.stringify(ae)));return}const fe=JSON.parse(JSON.stringify(te));if(Xt&&(te.start&&ae.start&&(fe.start.x=te.start.x+(ae.start.x-te.start.x)*O,fe.start.y=te.start.y+(ae.start.y-te.start.y)*O),te.end&&ae.end&&(fe.end.x=te.end.x+(ae.end.x-te.end.x)*O,fe.end.y=te.end.y+(ae.end.y-te.end.y)*O),te.width!==void 0&&ae.width!==void 0&&(fe.width=te.width+(ae.width-te.width)*O),te.height!==void 0&&ae.height!==void 0&&(fe.height=te.height+(ae.height-te.height)*O),fe.scaleX=(te.scaleX??1)+((ae.scaleX??1)-(te.scaleX??1))*O,fe.scaleY=(te.scaleY??1)+((ae.scaleY??1)-(te.scaleY??1))*O,fe.rotationX=(te.rotationX??0)+((ae.rotationX??0)-(te.rotationX??0))*O,fe.rotationY=(te.rotationY??0)+((ae.rotationY??0)-(te.rotationY??0))*O,fe.rotationZ=(te.rotationZ??0)+((ae.rotationZ??0)-(te.rotationZ??0))*O,te.rotation!==void 0&&ae.rotation!==void 0&&(fe.rotation=te.rotation+(ae.rotation-te.rotation)*O)),pt){const Ae=Ua(te.color),De=Ua(ae.color),Oe=Math.round(Ae.r+(De.r-Ae.r)*O),Ye=Math.round(Ae.g+(De.g-Ae.g)*O),L=Math.round(Ae.b+(De.b-Ae.b)*O);fe.color=`rgb(${Oe},${Ye},${L})`}te.points&&ae.points&&te.points.length===ae.points.length&&(fe.points=te.points.map((Ae,De)=>{const Oe=ae.points[De];let Ye=Ae.x,L=Ae.y,D=Ae.z||0,W=Ae.color||te.color;if(Xt&&(Ye=Ae.x+(Oe.x-Ae.x)*O,L=Ae.y+(Oe.y-Ae.y)*O,D=(Ae.z||0)+((Oe.z||0)-(Ae.z||0))*O),pt){const Z=Ua(Ae.color||te.color),re=Ua(Oe.color||ae.color),ce=Math.round(Z.r+(re.r-Z.r)*O),we=Math.round(Z.g+(re.g-Z.g)*O),Be=Math.round(Z.b+(re.b-Z.b)*O);W=`rgb(${ce},${we},${Be})`}return{x:Ye,y:L,z:D,color:W}})),ue.push(fe)}),y[ne]=ue}_(y),Et(y),alert("Interpolation complete!")},ur=()=>{if(N.length!==1)return;const y=ot[N[0]];if(!y||!y.points)return;const C=[];for(let Y=1;Y<y.points.length;Y+=2)C.push(Y);q(C)},fr=()=>{if(N.length!==1)return;const y=ot[N[0]];if(!y||!y.points)return;const C=[];for(let Y=0;Y<y.points.length;Y+=2)C.push(Y);q(C)},ps=()=>{if(N.length!==1)return;const y=ot[N[0]];if(!y||!y.points)return;const C=[];for(let Y=0;Y<y.points.length;Y++)U.includes(Y)||C.push(Y);q(C)},Zr=()=>{if(N.length!==1||U.length===0)return;const y=ot[N[0]];if(!y||!y.points)return;const C=new Set(U);U.forEach(Y=>{Y>0&&C.add(Y-1),Y<y.points.length-1&&C.add(Y+1),(y.type==="polygon"||y.type==="rect"||y.type==="circle"||y.type==="star")&&(Y===0&&C.add(y.points.length-1),Y===y.points.length-1&&C.add(0))}),q(Array.from(C).sort((Y,P)=>Y-P))},dr=()=>{if(N.length!==1||U.length===0)return;const y=ot[N[0]];if(!y||!y.points)return;const C=U.filter(Y=>{const P=Y===0&&(y.type==="polygon"||y.type==="rect")?y.points.length-1:Y-1,B=Y===y.points.length-1&&(y.type==="polygon"||y.type==="rect")?0:Y+1;return U.includes(P)&&U.includes(B)});q(C)},oa=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Select Background Image",filters:[{name:"Images",extensions:["jpg","png","png","webp","bmp"]}],properties:["openFile"]});if(!y)return;const C=new Image;C.onload=()=>{pe(C)},C.src=`file://${y}`},Na=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]],Y=15/$,P=B=>{let O=[];return B.points?O=[...B.points]:O=an(B),{...B,type:"polyline",points:O,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}};if(N.length===1){const B=N[0],O={...C[B]};if(O.points||(O.points=an(O),O.rotationX=0,O.rotationY=0,O.rotationZ=0,O.scaleX=1,O.scaleY=1),U.length===2){const[ne,ue]=[...U].sort((ae,fe)=>ae-fe),te=[],ee=O.points.length;for(let ae=0;ae<ee;ae++)te.push(O.points[(ne+ae)%ee]);O.points=te,O.type="polygon"}else O.type="polygon";C[B]=O}else{const O=[...N].sort((ne,ue)=>ue-ne).map(ne=>P(C.splice(ne,1)[0]));if(O.length>0){let ne=O.pop();for(;O.length>0;){let ue=1/0,te=-1,ee="end-end",ae=!1,fe=!1,Ae=-1;const De=ne.points[0],Oe=ne.points[ne.points.length-1];if(O.forEach((L,D)=>{const W=L.points[0],Z=L.points[L.points.length-1],re=Ln(Oe,W),ce=Ln(Oe,Z),we=Ln(De,W),Be=Ln(De,Z);if(re<ue&&(ue=re,te=D,ee="end-end",ae=!1,fe=!1),ce<ue&&(ue=ce,te=D,ee="end-end",ae=!1,fe=!0),we<ue&&(ue=we,te=D,ee="end-end",ae=!0,fe=!1),Be<ue&&(ue=Be,te=D,ee="end-end",ae=!0,fe=!0),ue>Y)for(let Ue=0;Ue<ne.points.length;Ue++){const qe=ne.points[Ue],ye=Ln(qe,W),He=Ln(qe,Z);ye<ue&&(ue=ye,te=D,ee="mid-insert",Ae=Ue,fe=!1),He<ue&&(ue=He,te=D,ee="mid-insert",Ae=Ue,fe=!0)}}),te===-1)break;const Ye=O.splice(te,1)[0];if(ee==="end-end")ae&&ne.points.reverse(),fe&&Ye.points.reverse(),ne.points=[...ne.points,...Ye.points];else{fe&&Ye.points.reverse();const L=[...Ye.points].reverse();L.shift();const D=[...Ye.points,...L],W=ne.points.slice(0,Ae+1),Z=ne.points.slice(Ae+1);ne.points=[...W,...D,...Z]}}C.push(ne)}}y[b]=C,_(y),Et(y),V([C.length-1]),q([])},Ir=(y,C=!1,Y=!1)=>{if(!y||y.length<2)return y;const P=[],B=O=>Y?y[(O+y.length)%y.length]:y[Math.max(0,Math.min(y.length-1,O))];for(let O=0;O<y.length;O++){if(!Y&&O===y.length-1){P.push(y[O]);break}const ne=B(O-1),ue=B(O),te=B(O+1),ee=B(O+2);if(P.push(ue),C){const Oe=-.0625*ne.x+.5625*ue.x+.5625*te.x+-.0625*ee.x,Ye=-.0625*ne.y+.5625*ue.y+.5625*te.y+-.0625*ee.y,L=Ua(ue.color||"#ffffff"),D=Ua(te.color||"#ffffff");Math.round((L.r+D.r)/2),Math.round((L.g+D.g)/2),Math.round((L.b+D.b)/2),P.push({x:Oe,y:Ye,color:ue.color})}else{const ae=(ue.x+te.x)/2,fe=(ue.y+te.y)/2;P.push({x:ae,y:fe,color:ue.color})}}return P},pr=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]];let Y=!1;N.forEach(P=>{const B={...C[P]};B.type==="polyline"?(B.type="polygon",C[P]=B,Y=!0):B.type==="polygon"&&(B.type="polyline",C[P]=B,Y=!0)}),Y&&(y[b]=C,_(y),Et(y)),ut({visible:!1,x:0,y:0,target:null})},Ea=(y=!1)=>{if(N.length===0)return;const C=[...A],Y=[...C[b]];let P=!1;const B=(O,ne,ue,te)=>{if(ue.length===0&&te.length===0||te.includes(O))return!0;const ee=O,ae=(O+1)%ne;return ue.includes(ee)&&ue.includes(ae)};N.forEach(O=>{const ne={...Y[O]};let ue=[];U.forEach(ee=>{const ae=Array.isArray(ee)?ee:[ee];ae.length===1&&ue.push(ae[0])});let te=[];if(ie.forEach(ee=>{const ae=Array.isArray(ee)?ee:[ee];ae.length===1&&te.push(ae[0])}),ne.type==="pen"||ne.type==="polyline"||ne.type==="polygon")if(ue.length>0||te.length>0){const ae=ne.points,fe=[],Ae=ne.type==="polygon",De=ae.length;for(let Oe=0;Oe<De;Oe++){if(!Ae&&Oe===De-1){fe.push(ae[Oe]);break}if(fe.push(ae[Oe]),B(Oe,De,ue,te)){const Ye=ae[Oe],L=ae[(Oe+1)%De];if(y){const D=ye=>ae[(ye+De)%De],W=Ae?D(Oe-1):Oe>0?ae[Oe-1]:Ye,Z=Ae?D(Oe+2):Oe<De-2?ae[Oe+2]:L,re=-.0625,ce=.5625,we=.5625,Be=-.0625,Ue=re*W.x+ce*Ye.x+we*L.x+Be*Z.x,qe=re*W.y+ce*Ye.y+we*L.y+Be*Z.y;fe.push({x:Ue,y:qe,color:Ye.color})}else{const D=(Ye.x+L.x)/2,W=(Ye.y+L.y)/2;fe.push({x:D,y:W,color:Ye.color})}}}ne.points=fe,Y[O]=ne,P=!0}else{const ae=ne.type==="polygon";ne.points=Ir(ne.points,y,ae),Y[O]=ne,P=!0}else if(ne.type==="circle"||ne.type==="star"||ne.type==="rect"){const ee=ue.length>0||te.length>0,ae=an(ne);if(ee){const fe=[],Ae=ae.length;for(let De=0;De<Ae;De++)if(fe.push(ae[De]),B(De,Ae,ue,te)){const Oe=ae[De],Ye=ae[(De+1)%Ae];if(y){const L=ce=>ae[(ce+Ae)%Ae],D=L(De-1),W=L(De+2),Z=-.0625*D.x+.5625*Oe.x+.5625*Ye.x-.0625*W.x,re=-.0625*D.y+.5625*Oe.y+.5625*Ye.y-.0625*W.y;fe.push({x:Z,y:re,color:Oe.color})}else fe.push({x:(Oe.x+Ye.x)/2,y:(Oe.y+Ye.y)/2,color:Oe.color})}Y[O]={...ne,type:"polygon",points:fe,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else Y[O]={...ne,type:"polygon",points:Ir(ae,y,!0),rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};P=!0}}),P&&(C[b]=Y,_(C),Et(C))},hs=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]];let Y=!1;N.forEach(P=>{const B={...C[P]};let O=[];U.forEach(ue=>{const te=Array.isArray(ue)?ue:[ue];te.length===1&&O.push(te[0])});let ne=[];if(ie.forEach(ue=>{const te=Array.isArray(ue)?ue:[ue];te.length===1&&ne.push(te[0])}),ne.length>0){const ue=B.type==="polyline"||B.type==="polygon"||B.type==="pen"?B.points:an(B);ne.forEach(te=>{O.push(te),O.push((te+1)%ue.length)}),O=Array.from(new Set(O))}if(B.type==="pen"||B.type==="polyline"||B.type==="polygon")if(O.length>0){O.sort((te,ee)=>te-ee);const ue=O.filter((te,ee)=>ee%2===1);B.points.length-ue.length>=2&&(B.points=B.points.filter((te,ee)=>!ue.includes(ee)),C[P]=B,Y=!0)}else B.points.length>2&&(B.points=B.points.filter((ue,te)=>te%2===0),C[P]=B,Y=!0);else if(B.type==="circle"||B.type==="star"||B.type==="rect"){const ue=an(B);let te=[];if(O.length>0){O.sort((ae,fe)=>ae-fe);const ee=O.filter((ae,fe)=>fe%2===1);te=ue.filter((ae,fe)=>!ee.includes(fe))}else te=ue.filter((ee,ae)=>ae%2===0);if(te.length>=2){const ee={type:"polygon",color:B.color,renderMode:B.renderMode,points:te,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};C[P]=ee,Y=!0}}}),Y&&(y[b]=C,_(y),Et(y),U.length>0&&q([]),ie.length>0&&z([]))},Qr=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]];let Y=!1;const P=.5;N.forEach(B=>{const O={...C[B]};let ne=[];O.type==="pen"||O.type==="polyline"||O.type==="polygon"?ne=O.points:(O.type==="circle"||O.type==="star"||O.type==="rect")&&(ne=an(O),O.type="polygon",O.rotationX=0,O.rotationY=0,O.rotationZ=0,O.scaleX=1,O.scaleY=1);let ue=[];if(U.length>0&&U.forEach(te=>{const ee=Array.isArray(te)?te:[te];ee.length===1&&ue.push(ee[0])}),ne.length>1){const te=[ne[0]];for(let ee=1;ee<ne.length;ee++)ue.length===0||ue.includes(ee)?Ln(ne[ee],te[te.length-1])>P&&te.push(ne[ee]):te.push(ne[ee]);O.type==="polygon"&&te.length>2&&(ue.length===0||ue.includes(ne.length-1),Ln(te[te.length-1],te[0])<P&&(ue.length,te.pop())),te.length!==ne.length&&(O.points=te,C[B]=O,Y=!0)}}),Y&&(y[b]=C,_(y),Et(y),U.length>0&&q([]))},An=()=>{if(N.length===0)return;const y=[...A],C=[...y[b]];let Y=!1;const P=150*(Math.PI/180),B=(O,ne,ue)=>{const te=Math.atan2(O.y-ne.y,O.x-ne.x),ee=Math.atan2(ue.y-ne.y,ue.x-ne.x);let ae=Math.abs(te-ee);return ae>Math.PI&&(ae=2*Math.PI-ae),ae};N.forEach(O=>{const ne={...C[O]};let ue=[];ne.type==="pen"||ne.type==="polyline"||ne.type==="polygon"?ue=ne.points:(ne.type==="circle"||ne.type==="star"||ne.type==="rect")&&(ue=an(ne),ne.type="polygon",ne.rotationX=0,ne.rotationY=0,ne.rotationZ=0,ne.scaleX=1,ne.scaleY=1);let te=[];if(U.length>0&&U.forEach(ee=>{const ae=Array.isArray(ee)?ee:[ee];ae.length===1&&te.push(ae[0])}),ue.length>2){const ee=[],ae=ne.type==="polygon"||ne.type==="rect"||ne.type==="circle"||ne.type==="star";for(let fe=0;fe<ue.length;fe++){if(ee.push(ue[fe]),te.length>0&&!te.includes(fe))continue;let Ae,De;if(fe===0)if(ae)Ae=ue[ue.length-1];else continue;else Ae=ue[fe-1];if(fe===ue.length-1)if(ae)De=ue[0];else continue;else De=ue[fe+1];B(Ae,ue[fe],De)<P&&ee.push({...ue[fe]})}ee.length!==ue.length&&(ne.points=ee,C[O]=ne,Y=!0)}}),Y&&(y[b]=C,_(y),Et(y)),ut({visible:!1,x:0,y:0,target:null})},ms=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import ILDA",filters:[{name:"ILDA Files",extensions:["ild"]}],properties:["openFile"]});if(y){nt(!0);try{const C=await window.electronAPI.readFileAsBinary(y),{frames:Y}=$v(C);if(Y&&Y.length>0){const P=Y.map(B=>{const O=[];let ne=[];if(B.points.forEach(ue=>{const te=ue.x*500+500,ee=(1-ue.y)*500,ae=`rgb(${ue.r},${ue.g},${ue.b})`;if(ue.blanking){if(ne.length>1){const fe=ne[0];Math.sqrt(Math.pow(fe.x-te,2)+Math.pow(fe.y-ee,2))<2?O.push({type:"polygon",points:ne,color:ne[0].color,renderMode:"simple",rotation:0}):O.push({type:"polyline",points:ne,color:ne[0].color,renderMode:"simple",rotation:0})}ne=[]}else ne.push({x:te,y:ee,color:ae})}),ne.length>1){const ue=ne[0],te=ne[ne.length-1];Math.sqrt(Math.pow(ue.x-te.x,2)+Math.pow(ue.y-te.y,2))<2?O.push({type:"polygon",points:ne,color:ne[0].color,renderMode:"simple",rotation:0}):O.push({type:"polyline",points:ne,color:ne[0].color,renderMode:"simple",rotation:0})}return O});_(P),Et(P),v(P.length),T(0)}}catch(C){console.error(C)}finally{nt(!1)}}},rn=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import SVG",filters:[{name:"SVG Files",extensions:["svg"]}],properties:["openFile"]});if(y){nt(!0);try{const C=await window.electronAPI.readFileContent(y),Y=new DOMParser,P=new TextDecoder().decode(C),O=Y.parseFromString(P,"image/svg+xml").querySelector("svg");if(!O)throw new Error("Invalid SVG");let ne=O.getAttribute("viewBox")?.split(/[\s,]+/).map(parseFloat);if(!ne||ne.length!==4){const W=parseFloat(O.getAttribute("width"))||1e3,Z=parseFloat(O.getAttribute("height"))||1e3;ne=[0,0,W,Z]}const[ue,te,ee,ae]=ne,fe=Math.min(mn/ee,mn/ae)*.8,Ae=(mn-ee*fe)/2-ue*fe,De=(mn-ae*fe)/2-te*fe,Oe=[],Ye=document.createElement("div");Ye.style.display="none",Ye.innerHTML=P,document.body.appendChild(Ye);const L=Ye.querySelector("svg"),D=(W,Z=new DOMMatrix)=>{let re="";const ce=W.tagName.toLowerCase();let we=new DOMMatrix(W.getAttribute("transform")||"");const Be=Z.multiply(we);if(ce==="g"){Array.from(W.children).forEach(ye=>D(ye,Be));return}if(ce==="path")re=W.getAttribute("d");else if(ce==="rect"){const ye=parseFloat(W.getAttribute("x"))||0,He=parseFloat(W.getAttribute("y"))||0,Le=parseFloat(W.getAttribute("width"))||0,ke=parseFloat(W.getAttribute("height"))||0;re=`M${ye},${He} h${Le} v${ke} h${-Le} z`}else if(ce==="circle"||ce==="ellipse"){const ye=parseFloat(W.getAttribute("cx"))||0,He=parseFloat(W.getAttribute("cy"))||0,Le=parseFloat(W.getAttribute("rx"))||parseFloat(W.getAttribute("r"))||0,ke=parseFloat(W.getAttribute("ry"))||parseFloat(W.getAttribute("r"))||0;re=`M${ye-Le},${He} a${Le},${ke} 0 1,0 ${Le*2},0 a${Le},${ke} 0 1,0 ${-Le*2},0 z`}else ce==="line"?re=`M${W.getAttribute("x1")},${W.getAttribute("y1")} L${W.getAttribute("x2")},${W.getAttribute("y2")}`:(ce==="polyline"||ce==="polygon")&&(re=`M${W.getAttribute("points")}${ce==="polygon"?" z":""}`);if(!re)return;const Ue=document.createElementNS("http://www.w3.org/2000/svg","path");Ue.setAttribute("d",re),L.appendChild(Ue);const qe=Ue.getTotalLength();if(qe>0){const ye=[],He=qe*fe*Math.max(Be.a,Be.d),Le=Math.min(1e3,Math.max(10,Math.floor(He/5)));for(let ke=0;ke<=Le;ke++){const Qe=Ue.getPointAtLength(ke/Le*qe),Fe=new DOMPoint(Qe.x,Qe.y).matrixTransform(Be);ye.push({x:Fe.x*fe+Ae,y:Fe.y*fe+De,color:s})}Oe.push({type:"polyline",points:ye,color:s,renderMode:"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1})}};if(Array.from(O.children).forEach(W=>D(W)),document.body.removeChild(Ye),Oe.length>0){const W=[...A];W[b]=[...W[b]||[],...Oe],_(W),Et(W)}}catch(C){console.error("SVG Import Error:",C),alert("Error importing SVG: "+C.message)}finally{nt(!1)}}},yi=()=>{if(confirm("Press OK to clear ALL frames in the animation, or CANCEL to clear only the CURRENT frame.")){const C=A.map(()=>[]);_(C),Et(C)}else{const C=[...A];C[b]=[],_(C),Et(C)}V([]),q([])},zn=()=>{if(N.length===0)return;let y;if(U.length>0&&N.length===1){const C=ot[N[0]],Y=ga(C);y={type:"polyline",points:U.map(B=>({...Y[B]})),color:C.color,renderMode:C.renderMode||"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else y=N.map(C=>JSON.parse(JSON.stringify(ot[C])));X({data:y,sourceFrameIndex:b}),ut({visible:!1})},Ga=()=>{if(!me)return;const{data:y}=me,C=Array.isArray(y)?JSON.parse(JSON.stringify(y)):[JSON.parse(JSON.stringify(y))],Y=[...A],P=[...Y[b]||[]];C.forEach(B=>{P.push(B)}),Y[b]=P,_(Y),Et(Y),V(C.map((B,O)=>P.length-C.length+O)),q([]),ut({visible:!1})},Fs=()=>{const y=[...A];y.splice(b+1,0,JSON.parse(JSON.stringify(A[b]))),_(y),Et(y),v(C=>C+1),T(C=>C+1)},Kr=()=>{if(le>0&&F[le-1]){const y=le-1;H(y),_(JSON.parse(JSON.stringify(F[y])))}},Ha=()=>{if(le<F.length-1&&F[le+1]){const y=le+1;H(y),_(JSON.parse(JSON.stringify(F[y])))}};w.useEffect(()=>{},[A]);const fn=y=>{if(N.length===0)return;const C=(Y,P)=>{let B={...Y,...P};return P.color&&(B.points&&(B.points=B.points.map(O=>({...O,color:P.color}))),B.startColor&&(B.startColor=P.color),B.endColor&&(B.endColor=P.color),B.cornerColors&&(B.cornerColors=B.cornerColors.map(()=>P.color)),B.centerColor&&(B.centerColor=P.color),B.outerColor&&(B.outerColor=P.color)),B.type==="group"&&B.shapes&&(B.shapes=B.shapes.map(O=>C(O,P))),B};_(Y=>{const P=[...Y],B=[...P[b]];return N.forEach(O=>{B[O]&&(B[O]=C(B[O],y))}),P[b]=B,Et(P),P})},hr=y=>{N.length!==1||U.length===0||_(C=>{const Y=[...C],P=[...Y[b]],B=N[0];if(!P[B])return C;let O={...P[B]};return U.forEach(ne=>{const ue=Array.isArray(ne)?ne:[ne],te=(ee,ae,fe)=>{if(ae.length===1){const Ae=ae[0],De={...ee};return De.points?(De.points=[...De.points],De.points[Ae]={...De.points[Ae],color:fe}):De.type==="line"?Ae===0?De.startColor=fe:De.endColor=fe:De.type==="rect"?(De.cornerColors=[...De.cornerColors||[De.color,De.color,De.color,De.color]],De.cornerColors[Ae]=fe):(De.type==="circle"||De.type==="star")&&(Ae===0?De.centerColor=fe:De.outerColor=fe),De}else{const[Ae,...De]=ae,Oe={...ee};return Oe.shapes=[...Oe.shapes],Oe.shapes[Ae]=te(Oe.shapes[Ae],De,fe),Oe}};O=te(O,ue,y)}),P[B]=O,Y[b]=P,Et(Y),Y})},Ya=async()=>{if(!A.every(y=>y.length===0)){zt(!0);try{const C=A.slice(xa).map(P=>{const B=[];return P.forEach((O,ne)=>{const ue=O.renderMode||"simple",te=an(O),ee=Ae=>({...Ae,x:(Ae.x-500)/500,y:1-Ae.y/500}),ae=te.map(ee);if(ae.length<2)return;const fe=[];for(let Ae=0;Ae<ae.length-1;Ae++){let De=ue;ue==="dashed"&&Ae%2===1&&(De="blanked");const Oe=Va(ae[Ae],ae[Ae+1],De);Ae<ae.length-2?fe.push(...Oe.slice(0,-1)):fe.push(...Oe)}if(O.type==="polygon"||O.type==="rect"||O.type==="circle"||O.type==="star"||O.type==="triangle"){const Ae=ae[0],De=ae[ae.length-1];if(Math.sqrt(Math.pow(Ae.x-De.x,2)+Math.pow(Ae.y-De.y,2))>.001){let Ye=ue;ue==="dashed"&&(ae.length-1)%2===1&&(Ye="blanked");const L=Va(ae[ae.length-1],ae[0],Ye);L.length>1&&fe.push(...L.slice(1))}}fe.length>0&&(B.push({...fe[0],blanking:!0}),B.push(...fe))}),{points:B,frameName:"SHAPE"}}),Y=lg(C);await window.electronAPI.saveIldaFile(Y,"built_shape.ild")}catch(y){console.error(y)}finally{zt(!1)}}},Va=(y,C,Y)=>{const P=Ua(y.color||s),B=Ua(C.color||s);if(Y==="dotted")return[{x:y.x,y:y.y,r:P.r,g:P.g,b:P.b,blanking:!1},{x:y.x,y:y.y,r:P.r,g:P.g,b:P.b,blanking:!1}];const O=Y==="blanked";return[{x:y.x,y:y.y,r:P.r,g:P.g,b:P.b,blanking:O},{x:C.x,y:C.y,r:B.r,g:B.g,b:B.b,blanking:O}]},mr=()=>{if(k&&(k.type==="polygon"||k.type==="polyline"||k.type==="bezier")){let y={...k};if(k.type==="polygon"||k.type==="polyline"?y.points=k.points.slice(0,-1):k.type==="bezier"&&ft&&(y.anchors=k.anchors.slice(0,-1),y.points=ml(y.anchors,!1)),y.type==="bezier"&&y.anchors.length>1||y.points.length>1){const C=[...A];C[b]=[...C[b]||[],y],_(C),Et(C),V([C[b].length-1])}}h(!1),G(null)},vi=y=>{if(y.button===1||y.button===0&&y.altKey){ir.current=!0,Ft.current={x:y.clientX,y:y.clientY};return}if(y.button!==0)return;const C=bn(y.clientX,y.clientY),Y=cr(C.x,C.y),P=Y.x,B=Y.y;if(ut({visible:!1}),e==="select"){const O=[];for(let ne=ot.length-1;ne>=0;ne--){const ue=wa(ot[ne],C,N.includes(ne),U);ue&&O.push({...ue,shapeIndex:ne})}if(O.length>0){let ne=O[0];const ue=N[0];if(O.length>1&&O[0].shapeIndex===ue)if(O[0].type==="point"){const ae=O[0].path||[O[0].index];U.some(Ae=>JSON.stringify(Ae)===JSON.stringify(ae))&&(ne=O[1])}else ne=O[1];const te=ne.shapeIndex,ee=ne;if(ee.type==="point"){const ae=ee.path||[ee.index];y.shiftKey?N.includes(te)?q(fe=>fe.some(De=>JSON.stringify(De)===JSON.stringify(ae))?fe.filter(De=>JSON.stringify(De)!==JSON.stringify(ae)):[...fe,ae]):(V([te]),q([ae])):(q([ae]),V([te])),us.current=!0}else if(ee.type==="segment"){const ae=ee.path||[ee.index];y.shiftKey?N.includes(te)?z(fe=>fe.some(De=>JSON.stringify(De)===JSON.stringify(ae))?fe.filter(De=>JSON.stringify(De)!==JSON.stringify(ae)):[...fe,ae]):(V([te]),z([ae])):(z([ae]),V([te]),q([])),ta.current=!0}else ee.type==="pivot"?hn.current=!0:(!y.shiftKey&&!N.includes(te)?V([te]):y.shiftKey&&V(ae=>ae.includes(te)?ae.filter(fe=>fe!==te):[...ae,te]),ta.current=!0);Ft.current=C}else Mn.current=!0,Ft.current=C,nn.current={x:C.x,y:C.y,w:0,h:0};return}if(h(!0),Ft.current=C,e==="polygon"||e==="polyline"||(e==="line"||e==="bezier")&&ft)if(!k)e==="bezier"?(G({type:"bezier",color:s,renderMode:o,isSmooth:!0,anchors:[{x:P,y:B,color:s},{x:P,y:B,color:s}],points:[{x:P,y:B,color:s},{x:P,y:B,color:s},{x:P,y:B,color:s},{x:P,y:B,color:s}],rotation:0}),Gt(-1)):G({type:e==="polygon"?"polygon":"polyline",color:s,renderMode:o,points:[{x:P,y:B,color:s},{x:P,y:B,color:s}],rotation:0});else{const O=k.type==="bezier"?k.anchors[0]:k.points[0];if(Ln({x:P,y:B},O)<15/$&&(k.type==="bezier"&&k.anchors.length>2||k.points.length>3)){let ue={...k};k.type==="bezier"?(ue.anchors=k.anchors.slice(0,-1),ue.closed=!0,ue.points=ml(ue.anchors,!0)):(ue.points=k.points.slice(0,-1),ue.type="polygon");const te=[...A];te[b]=[...te[b]||[],ue],_(te),Et(te),V([te[b].length-1]),h(!1),G(null);return}if(e==="bezier"){const ue=[...k.anchors,{x:P,y:B,color:s}],te=ml(ue,!1);G(ee=>({...ee,anchors:ue,points:te}))}else G(ue=>({...ue,points:[...ue.points,{x:P,y:B,color:s}]}))}else{const O={type:e,color:s,renderMode:o,start:{x:P,y:B},end:{x:P,y:B},width:0,height:0,rotation:0,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0};if(e==="pen")O.points=[{x:P,y:B,color:s},{x:P,y:B,color:s}];else if(e==="bezier"){const ne=[{x:P,y:B,color:s},{x:P,y:B,color:s}],ue=ml(ne,!1);O.isSmooth=!0,O.anchors=ne,O.points=ue}G(O)}},Ra=w.useCallback((y,C,Y)=>{const P={...y};return y.type==="group"?P.shapes=y.shapes.map(B=>Ra(B,C,Y)):(y.points&&(P.points=y.points.map(B=>({...B,x:B.x+C,y:B.y+Y}))),y.anchors&&(P.anchors=y.anchors.map(B=>({...B,x:B.x+C,y:B.y+Y}))),y.start&&(P.start={...y.start,x:y.start.x+C,y:y.start.y+Y}),y.end&&(P.end={...y.end,x:y.end.x+C,y:y.end.y+Y})),y.pivotX!==void 0&&(P.pivotX=y.pivotX+C),y.pivotY!==void 0&&(P.pivotY=y.pivotY+Y),P},[]),Us=w.useCallback((y,C,Y,P)=>{if(C.length===1){const B=C[0],O={...y};if(O.type==="line")B===0?O.start={...O.start,x:O.start.x+Y,y:O.start.y+P}:O.end={...O.end,x:O.end.x+Y,y:O.end.y+P};else if(O.type==="rect")B===0?(O.start={...O.start,x:O.start.x+Y,y:O.start.y+P},O.width-=Y,O.height-=P):B===1?(O.start={...O.start,y:O.start.y+P},O.width+=Y,O.height-=P):B===2?(O.width+=Y,O.height+=P):B===3&&(O.start={...O.start,x:O.start.x+Y},O.width-=Y,O.height+=P);else if(O.type==="circle"||O.type==="star"||O.type==="triangle")B===0?O.start={...O.start,x:O.start.x+Y,y:O.start.y+P}:B===1?O.end={...O.end,x:O.end.x+Y}:B===2&&(O.end={...O.end,y:O.end.y+P});else if(O.points&&(O.points=[...O.points],O.points[B]&&(O.points[B]={...O.points[B],x:O.points[B].x+Y,y:O.points[B].y+P},O.type==="bezier"&&O.isSmooth)))if(B%3!==0)O.manualIndices||(O.manualIndices=[]),O.manualIndices.includes(B)||O.manualIndices.push(B);else{const ue=B/3;O.anchors&&O.anchors[ue]&&(O.anchors[ue].x+=Y,O.anchors[ue].y+=P,ml(O.anchors,O.closed).forEach((ee,ae)=>{O.manualIndices&&O.manualIndices.includes(ae)||(O.points[ae].x=ee.x,O.points[ae].y=ee.y)}))}return O}else{const[B,...O]=C,ne={...y};return ne.shapes=[...ne.shapes],ne.shapes[B]=Us(ne.shapes[B],O,Y,P),ne}},[]),_r=y=>{const C=bn(y.clientX,y.clientY);if(ir.current){const O=(y.clientX-Ft.current.x)/$,ne=(y.clientY-Ft.current.y)/$;Pe(ue=>({x:ue.x+O,y:ue.y+ne})),Ft.current={x:y.clientX,y:y.clientY};return}if(Fa.current&&N.length>0){const O=kn(ot[N[0]]);fn({rotationZ:Math.atan2(C.y-O.y,C.x-O.x)+Math.PI/2});return}if(Mn.current){nn.current={x:Math.min(Ft.current.x,C.x),y:Math.min(Ft.current.y,C.y),w:Math.abs(C.x-Ft.current.x),h:Math.abs(C.y-Ft.current.y)},Vt(O=>O+1);return}if(ta.current){const O=C.x-Ft.current.x,ne=C.y-Ft.current.y,ue=ot[N[0]],te=St(ue),ee=cr(te.x+O,te.y+ne),ae=ee.x-te.x,fe=ee.y-te.y;(ae!==0||fe!==0)&&(_(Ae=>{const De=[...Ae],Oe=[...De[b]];return N.forEach(Ye=>{Oe[Ye]=Ra({...Oe[Ye]},ae,fe)}),De[b]=Oe,De}),Ft.current.x+=ae,Ft.current.y+=fe);return}if(hn.current&&N.length===1){const O=cr(C.x,C.y);_(ne=>{const ue=[...ne],te=[...ue[b]];return te[N[0]]={...te[N[0]],pivotX:O.x,pivotY:O.y},ue[b]=te,ue});return}if(us.current&&N.length===1){const O=C.x-Ft.current.x,ne=C.y-Ft.current.y,ue=ot[N[0]],te=U[0],ee=ka(ue,te);if(ee){const ae=cr(ee.x+O,ee.y+ne,U),fe=ae.x-ee.x,Ae=ae.y-ee.y;(fe!==0||Ae!==0)&&(_(De=>{const Oe=[...De],Ye=[...Oe[b]];let L={...Ye[N[0]]};return U.forEach(D=>{const W=Array.isArray(D)?D:[D];L=Us(L,W,fe,Ae)}),Ye[N[0]]=L,Oe[b]=Ye,Oe}),Ft.current.x+=fe,Ft.current.y+=Ae)}return}if(!p)return;const Y=cr(C.x,C.y),P=Y.x,B=Y.y;G(O=>{if(!O)return null;const ne={...O},ue=y.shiftKey;if(e==="pen")ne.points=[...O.points,{x:P,y:B,color:s}];else if(e==="bezier"){const te=[...ne.anchors],ee=te.length-1;te[ee]={x:P,y:B,color:s},ne.anchors=te,ne.points=ml(te,!1)}else if(ne.type==="polyline"||ne.type==="polygon"){const te=[...ne.points];let ee=P,ae=B;if(ue){const fe=te[te.length-2];Math.abs(P-fe.x)>Math.abs(B-fe.y)?ae=fe.y:ee=fe.x}te[te.length-1]={x:ee,y:ae,color:s},ne.points=te}else if(e==="line"){let te=P,ee=B;ue&&(Math.abs(P-Ft.current.x)>Math.abs(B-Ft.current.y)?ee=Ft.current.y:te=Ft.current.x),ne.end={x:te,y:ee}}else if(e==="circle"||e==="star"||e==="triangle"){let te=P,ee=B;if(ue){const ae=Math.max(Math.abs(P-Ft.current.x),Math.abs(B-Ft.current.y));te=Ft.current.x+(P>=Ft.current.x?ae:-ae),ee=Ft.current.y+(B>=Ft.current.y?ae:-ae)}ne.end={x:te,y:ee}}else if(e==="rect"){let te=P-Ft.current.x,ee=B-Ft.current.y;if(ue){const ae=Math.max(Math.abs(te),Math.abs(ee));te=te>0?ae:-ae,ee=ee>0?ae:-ae}ne.width=te,ne.height=ee}return ne})},Tl=y=>{if(Mn.current&&nn.current){const P=nn.current,B=y.shiftKey;if(P.w<5/$&&P.h<5/$)B||(V([]),q([]),z([]));else if(N.length===1){const O=N[0],ne=ot[O],ue=ga(ne),te=[];if(ue.forEach((ee,ae)=>{ee.x>=P.x&&ee.x<=P.x+P.w&&ee.y>=P.y&&ee.y<=P.y+P.h&&te.push(ae)}),te.length>0)q(B?ee=>Array.from(new Set([...ee,...te])).sort((ae,fe)=>ae-fe):te);else{const ee=[];ot.forEach((ae,fe)=>{if(ae.hidden||ae.locked)return;const Ae=En(ae);Ae.x<P.x+P.w&&Ae.x+Ae.w>P.x&&Ae.y<P.y+P.h&&Ae.y+Ae.h>P.y&&ee.push(fe)}),B?V(ae=>Array.from(new Set([...ae,...ee]))):(V(ee),q([]))}}else{const O=[];ot.forEach((ne,ue)=>{if(ne.hidden||ne.locked)return;const te=En(ne);te.x<P.x+P.w&&te.x+te.w>P.x&&te.y<P.y+P.h&&te.y+te.h>P.y&&O.push(ue)}),B?V(ne=>Array.from(new Set([...ne,...O]))):(V(O),q([]))}}if((us.current||ta.current||hn.current)&&Et(A),us.current=!1,ta.current=!1,hn.current=!1,Fa.current=!1,Mn.current=!1,ir.current=!1,nn.current=null,!p)return;const C=k.type==="polygon"||k.type==="polyline",Y=k.type==="bezier"&&ft;if(k&&!C&&!Y){const P=[...A];P[b]=[...P[b]||[],k],_(P),Et(P),V([P[b].length-1]),h(!1),G(null)}},Ps=(y,C,Y,P=!1,B=[])=>{if(!C||C.hidden)return;if(y.save(),C.type==="group"){if(C.shapes.forEach((ee,ae)=>Ps(y,ee,!1,P,[...B,ae])),y.restore(),Y&&!P){y.save();const ee=St(C),ae=kn(C);y.fillStyle="#0089ff",y.beginPath(),y.arc(ee.x,ee.y,6/$,0,Math.PI*2),y.fill(),y.strokeStyle="white",y.lineWidth=1/$,y.stroke();const fe=En(C);y.beginPath(),y.moveTo(ee.x,fe.y),y.lineTo(ee.x,fe.y-30/$),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(ee.x,fe.y-30/$,6/$,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke(),y.strokeStyle="var(--theme-color)",y.lineWidth=2/$,y.beginPath(),y.moveTo(ae.x-10/$,ae.y),y.lineTo(ae.x+10/$,ae.y),y.moveTo(ae.x,ae.y-10/$),y.lineTo(ae.x,ae.y+10/$),y.stroke(),y.beginPath(),y.arc(ae.x,ae.y,5/$,0,Math.PI*2),y.stroke(),y.restore()}return}const O=St(C);y.lineWidth=(Y?2.5:1.5)/$;const ne=(ee,ae,fe="simple",Ae=[])=>{if(!ee||ee.length<2)return;if(ie.length>0){y.save(),y.lineWidth=6/$,y.globalAlpha=.6,y.lineCap="round";for(let Oe=0;Oe<ee.length-1;Oe++){const Ye=[...Ae,Oe];ie.some(D=>JSON.stringify(D)===JSON.stringify(Ye))&&(y.strokeStyle=ma(ee[Oe].color||C.color),y.beginPath(),y.moveTo(ee[Oe].x,ee[Oe].y),y.lineTo(ee[Oe+1].x,ee[Oe+1].y),y.stroke())}if(ae&&ee.length>2){const Oe=ee.length-1,Ye=[...Ae,Oe];ie.some(D=>JSON.stringify(D)===JSON.stringify(Ye))&&(y.strokeStyle=ma(ee[Oe].color||C.color),y.beginPath(),y.moveTo(ee[Oe].x,ee[Oe].y),y.lineTo(ee[0].x,ee[0].y),y.stroke())}y.restore()}let De=!1;y.beginPath(),ee[0]&&y.moveTo(ee[0].x,ee[0].y);for(let Oe=0;Oe<ee.length-1;Oe++){if(fe==="dashed"&&Oe%2===1){De&&(y.stroke(),De=!1),y.moveTo(ee[Oe+1].x,ee[Oe+1].y);continue}const Ye=ee[Oe],L=ee[Oe+1];if(!Ye||!L)continue;const D=P?"#444":Ye.color||C.color,W=P?"#444":L.color||C.color;if(D!==W){De&&(y.stroke(),De=!1);const Z=y.createLinearGradient(Ye.x,Ye.y,L.x,L.y);Z.addColorStop(0,D),Z.addColorStop(1,W),y.strokeStyle=Z,y.beginPath(),y.moveTo(Ye.x,Ye.y),y.lineTo(L.x,L.y),y.stroke(),y.beginPath(),y.moveTo(L.x,L.y)}else y.strokeStyle!==D&&(De&&(y.stroke(),y.beginPath(),y.moveTo(Ye.x,Ye.y)),y.strokeStyle=D),y.lineTo(L.x,L.y),De=!0}if(ae&&ee.length>2){const Oe=ee.length-1;if(fe==="dashed"&&Oe%2===1)De&&y.stroke();else{const Ye=ee[Oe],L=ee[0],D=P?"#444":Ye.color||C.color,W=P?"#444":L.color||C.color;if(D!==W){De&&y.stroke();const Z=y.createLinearGradient(Ye.x,Ye.y,L.x,L.y);Z.addColorStop(0,D),Z.addColorStop(1,W),y.strokeStyle=Z,y.beginPath(),y.moveTo(Ye.x,Ye.y),y.lineTo(L.x,L.y),y.stroke()}else y.strokeStyle!==D&&De&&(y.stroke(),y.beginPath(),y.moveTo(Ye.x,Ye.y),y.strokeStyle=D),y.lineTo(L.x,L.y),y.stroke(),De=!1}}else De&&y.stroke();fe==="dotted"&&ee.forEach(Oe=>{y.fillStyle=P?"#444":Oe.color||C.color,y.beginPath(),y.arc(Oe.x,Oe.y,3/$,0,Math.PI*2),y.fill()})},ue=(ee,ae,fe="simple",Ae=[])=>{if(!ee||!ae)return;const De=[...Ae,0];if(ie.some(D=>JSON.stringify(D)===JSON.stringify(De))&&(y.save(),y.strokeStyle=ma(ee.color||C.color),y.lineWidth=6/$,y.globalAlpha=.6,y.lineCap="round",y.beginPath(),y.moveTo(ee.x,ee.y),y.lineTo(ae.x,ae.y),y.stroke(),y.restore()),fe==="dotted"){[ee,ae].forEach(D=>{y.fillStyle=P?"#444":D.color||C.color,y.beginPath(),y.arc(D.x,D.y,3/$,0,Math.PI*2),y.fill()});return}const Ye=P?"#444":ee.color||C.color,L=P?"#444":ae.color||C.color;if(Ye===L)y.strokeStyle=Ye;else{const D=y.createLinearGradient(ee.x,ee.y,ae.x,ae.y);D.addColorStop(0,Ye),D.addColorStop(1,L),y.strokeStyle=D}y.beginPath(),y.moveTo(ee.x,ee.y),y.lineTo(ae.x,ae.y),y.stroke()};if(C.renderMode==="points"){an({...C,rotation:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}).forEach(ee=>{y.fillStyle=P?"#444":ee.color||C.color,y.beginPath(),y.arc(ee.x,ee.y,3/$,0,Math.PI*2),y.fill()}),y.restore();return}const te=C.renderMode||"simple";switch(C.type){case"pen":case"polyline":case"bezier":{const ee=an(C);ne(ee,!1,te,B);break}case"polygon":{const ee=an(C);ne(ee,!0,te,B);break}case"line":{const ee=an(C);ue(ee[0],ee[1],te,B);break}case"rect":{const ee=an(C);ne(ee,!0,te,B);break}case"circle":{const ee=an(C);ne(ee,!0,te,B);break}case"star":{const ee=an(C);ne(ee,!0,te,B);break}}if(Y&&!P){const ee=ga(C);if(C.type==="bezier"){y.save(),y.setLineDash([5/$,5/$]),y.strokeStyle="rgba(255,255,255,0.3)",y.lineWidth=1/$;for(let Ae=0;Ae<=ee.length-4;Ae+=3)y.beginPath(),y.moveTo(ee[Ae].x,ee[Ae].y),y.lineTo(ee[Ae+1].x,ee[Ae+1].y),y.stroke(),y.beginPath(),y.moveTo(ee[Ae+2].x,ee[Ae+2].y),y.lineTo(ee[Ae+3].x,ee[Ae+3].y),y.stroke();y.restore()}ee.forEach((Ae,De)=>{const Oe=[...B,De],Ye=U.some(D=>{const W=Array.isArray(D)?D:[D];return JSON.stringify(W)===JSON.stringify(Oe)});let L=!1;if(C.type==="bezier"&&(L=De%3!==0),y.fillStyle=Ye?"var(--theme-color)":L?"#888":"white",y.beginPath(),L){const D=4/$;y.rect(Ae.x-D,Ae.y-D,D*2,D*2)}else y.arc(Ae.x,Ae.y,5/$,0,Math.PI*2);y.fill(),y.strokeStyle=Ye?"white":"black",y.lineWidth=1/$,y.stroke()});const ae=Math.min(...ee.map(Ae=>Ae.y));y.beginPath(),y.moveTo(O.x,ae),y.lineTo(O.x,ae-30/$),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(O.x,ae-30/$,6/$,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke();const fe=kn(C);y.strokeStyle="var(--theme-color)",y.lineWidth=2/$,y.beginPath(),y.moveTo(fe.x-10/$,fe.y),y.lineTo(fe.x+10/$,fe.y),y.moveTo(fe.x,fe.y-10/$),y.lineTo(fe.x,fe.y+10/$),y.stroke(),y.beginPath(),y.arc(fe.x,fe.y,5/$,0,Math.PI*2),y.stroke()}y.restore()};w.useEffect(()=>{const y=Cn.current;if(!y)return;const C=y.getContext("2d");let Y;const P=()=>{if(Cn.current){if(C.save(),C.clearRect(0,0,y.width,y.height),C.translate(y.width/2,y.height/2),C.scale($,$),C.translate(-mn/2+Ce.x,-mn/2+Ce.y),C.fillStyle="#000",C.fillRect(0,0,mn,mn),Ke){C.beginPath(),C.strokeStyle="#222",C.lineWidth=.5/$;for(let B=0;B<=mn;B+=_e)C.moveTo(B,0),C.lineTo(B,mn);for(let B=0;B<=mn;B+=_e)C.moveTo(0,B),C.lineTo(mn,B);C.stroke(),C.beginPath(),C.strokeStyle="#444",C.lineWidth=1/$,C.moveTo(mn/2,0),C.lineTo(mn/2,mn),C.moveTo(0,mn/2),C.lineTo(mn,mn/2),C.stroke()}J&&(C.globalAlpha=.3,C.drawImage(J,0,0,mn,mn),C.globalAlpha=1),I&&b>0&&!M&&A[b-1]&&(C.globalAlpha=.15,A[b-1].forEach(B=>Ps(C,B,!1,!0)),C.globalAlpha=1),ot.length>0&&ot.forEach((B,O)=>Ps(C,B,N.includes(O))),p&&k&&Ps(C,k,!1),Mn.current&&nn.current&&(C.fillStyle="rgba(0, 137, 255, 0.3)",C.fillRect(nn.current.x,nn.current.y,nn.current.w,nn.current.h),C.strokeStyle="#0089ff",C.lineWidth=2/$,C.setLineDash([]),C.strokeRect(nn.current.x,nn.current.y,nn.current.w,nn.current.h)),C.restore(),Y=requestAnimationFrame(P)}};return Y=requestAnimationFrame(P),()=>cancelAnimationFrame(Y)},[A,b,k,p,J,Ke,_e,N,U,ie,I,M,$,Ce,Yt]),w.useEffect(()=>{if(!M||g<=1){yn.current=0;return}let y;lr.current=performance.now();const C=Y=>{const P=Y-lr.current;if(lr.current=Y,P>500||P<=0){y=requestAnimationFrame(C);return}yn.current+=P;const B=Pi.current,O=Math.max(.01,ja.current),ne=Math.max(1,un.current),ue=tn.current,te=Math.max(1,ne-ue);let ee=33.33;if(B==="fps"?ee=1e3/(Math.max(1,sr.current)*O):B==="bpm"?ee=6e4/Math.max(1,Vr.current)*Math.max(1,Wn.current)/te/O:B==="time"&&(ee=Math.max(.1,cs.current)*1e3/te/O),ee=Math.max(1,ee),yn.current>=ee){const ae=Math.floor(yn.current/ee);ae>0&&(T(fe=>{const Ae=fe+ae;return Ae>=ne?ue+(Ae-ue)%te:Ae}),yn.current-=ae*ee)}y=requestAnimationFrame(C)};return y=requestAnimationFrame(C),()=>{y&&cancelAnimationFrame(y)}},[M,g]),w.useEffect(()=>{const y=ha.current;if(y)return y.addEventListener("wheel",qr,{passive:!1}),()=>y.removeEventListener("wheel",qr)},[$]),w.useEffect(()=>{x(g)},[g]),w.useEffect(()=>{_(y=>{const C=[...y];if(g>y.length)for(let Y=y.length;Y<g;Y++)C.push([]);else if(g<y.length)return C.slice(0,g);return C})},[g]),w.useEffect(()=>{const y=C=>{ut({visible:!1,x:0,y:0,target:null}),p&&k&&C.target!==Cn.current&&mr()};return window.addEventListener("click",y),()=>window.removeEventListener("click",y)},[p,k]),w.useEffect(()=>{M||(V([]),q([]),z([]))},[b,M]),w.useEffect(()=>{const y=C=>{const Y=["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)||document.activeElement.isContentEditable;if((C.ctrlKey||C.metaKey)&&C.key==="z")Y||(C.preventDefault(),Kr());else if((C.ctrlKey||C.metaKey)&&C.key==="y")Y||(C.preventDefault(),Ha());else if((C.ctrlKey||C.metaKey)&&C.key==="c")Y||(C.preventDefault(),zn());else if((C.ctrlKey||C.metaKey)&&C.key==="v")Y||(C.preventDefault(),Ga());else if(C.key===" "||C.code==="Space")Y||(C.preventDefault(),R(P=>!P));else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(C.key)){if(!Y){const P=N.length>0||U.length>0;if(!P&&(C.key==="ArrowLeft"||C.key==="ArrowRight"))C.preventDefault(),C.key==="ArrowLeft"?T(B=>Math.max(0,B-1)):T(B=>Math.min(g-1,B+1));else if(P){C.preventDefault();const B=C.shiftKey?10:1;let O=0,ne=0;C.key==="ArrowLeft"?O=-B:C.key==="ArrowRight"?O=B:C.key==="ArrowUp"?ne=-B:C.key==="ArrowDown"&&(ne=B),_(ue=>{const te=[...ue],ee=[...te[b]];if(U.length>0&&N.length===1){const ae=N[0];let fe={...ee[ae]};U.forEach(Ae=>{const De=Array.isArray(Ae)?Ae:[Ae];fe=Us(fe,De,O,ne)}),ee[ae]=fe}else N.forEach(ae=>{ee[ae]&&(ee[ae]=Ra({...ee[ae]},O,ne))});return te[b]=ee,Et(te),te})}}}else if((C.key==="Delete"||C.key==="Backspace")&&!Y&&N.length>0){const P=[...A];P[b]=P[b].filter((B,O)=>!N.includes(O)),_(P),Et(P),V([]),q([])}};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[A,b,N,U,me,F,le,M,g,Ra,Us]);const Cl=({currentFrame:y,frameCount:C,syncMode:Y,bpm:P,beats:B,duration:O,fps:ne,onSeek:ue,snapToGrid:te})=>{const ee=w.useRef(null),ae=Oe=>{if(Y==="bpm"){const Ye=6e4/(P||120),L=Ye*(B||8),D=Oe/C*L,W=Math.floor(D/Ye)+1,Z=Math.floor(D%Ye/Ye*4)+1;return`B${W}.${Z}`}else if(Y==="time"){const Ye=(O||2)*1e3,L=Oe/C*Ye,D=Math.floor(L/1e3),W=Math.floor(L%1e3);return`${D}:${W.toString().padStart(3,"0")}`}return`F${Oe+1}`},fe=Oe=>{if(!ee.current)return;const Ye=ee.current.getBoundingClientRect();let D=(Oe.clientX-Ye.left)/Ye.width,W=Math.round(D*(C-1));if(te){if(Y==="bpm"){const Z=C/B;W=Math.round(W/Z)*Z}else if(Y==="time"){const Z=C/O;W=Math.round(W/Z)*Z}}ue(Math.max(0,Math.min(C-1,Math.round(W))))},Ae=[],De=Y==="bpm"?B||8:10;for(let Oe=0;Oe<=De;Oe++){const Ye=Oe/De*100;let L="";Y==="bpm"?L=`B${Oe+1}`:Y==="time"?L=`${(Oe/De*(O||2)).toFixed(1)}s`:L=Math.round(Oe/De*C),Ae.push(f.jsx("div",{style:{position:"absolute",left:`${Ye}%`,top:0,bottom:0,borderLeft:"1px solid #444",pointerEvents:"none"},children:f.jsx("span",{style:{fontSize:"0.6rem",color:"#666",marginLeft:"2px"},children:L})},Oe))}return f.jsxs("div",{ref:ee,onMouseDown:fe,style:{position:"relative",height:"35px",background:"#111",borderRadius:"4px",border:"1px solid #333",cursor:"pointer",overflow:"hidden"},children:[Ae,f.jsx("div",{style:{position:"absolute",left:`${y/(C-1)*100}%`,top:0,bottom:0,width:"2px",background:"var(--theme-color)",boxShadow:"0 0 5px var(--theme-color)",zIndex:10}}),f.jsx("div",{style:{position:"absolute",right:"5px",bottom:"2px",fontSize:"0.7rem",color:"var(--theme-color)",fontWeight:"bold"},children:ae(y)})]})},qa=Bn.memo(({active:y,onClick:C,icon:Y})=>f.jsx("button",{onClick:C,style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:y?"var(--theme-color)":"#222",color:y?"black":"#888",border:"none",borderRadius:"4px",fontSize:"1.2rem",padding:0},children:f.jsx("i",{className:`bi ${Y}`})})),Bs=Bn.memo(({active:y,onClick:C,children:Y})=>f.jsx("button",{onClick:C,style:{background:y?"#444":"#222",color:y?"var(--theme-color)":"#888",border:y?"1px solid var(--theme-color)":"1px solid #333",fontSize:"0.7rem",padding:"5px"},children:Y})),zi=N.length===1&&ot[N[0]]&&U.length>0?ga(ot[N[0]])[U[0]]?.color||ot[N[0]].color:"#000000";return f.jsxs("div",{className:"shape-builder",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column",userSelect:"none"},children:[Xn&&f.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e4,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsx("h3",{children:"WORKING..."})}),f.jsxs("header",{style:{height:"50px",padding:"0 20px",background:"#1a1a1a",borderBottom:"1px solid #333",display:"flex",alignItems:"center",gap:"15px"},children:[f.jsx("h2",{style:{margin:0,fontSize:"1rem",color:"var(--theme-color)",width:"180px"},children:"SHAPE BUILDER"}),f.jsxs("div",{className:"action-group",style:{display:"flex",gap:"8px"},children:[f.jsx("button",{onClick:Kr,title:"Undo",children:f.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),f.jsx("button",{onClick:Ha,title:"Redo",children:f.jsx("i",{className:"bi bi-arrow-clockwise"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:zn,title:"Copy",children:f.jsx("i",{className:"bi bi-clipboard"})}),f.jsx("button",{onClick:Ga,title:"Paste",children:f.jsx("i",{className:"bi bi-clipboard-check"})}),f.jsx("button",{onClick:Na,title:"Join Points / Shapes",children:f.jsx("i",{className:"bi bi-share"})}),f.jsx("button",{onClick:Bi,title:"Group",disabled:N.length<2,children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:hi,title:"Ungroup",disabled:N.length!==1||ot[N[0]]?.type!=="group",children:f.jsx("i",{className:"bi bi-exclude"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:()=>Ea(!1),title:"Subdivide (Linear)",disabled:N.length===0,children:f.jsx("i",{className:"bi bi-grid-3x3"})}),f.jsx("button",{onClick:()=>Ea(!0),title:"Subdivide (Smooth)",disabled:N.length===0,children:f.jsx("i",{className:"bi bi-bezier"})}),f.jsx("button",{onClick:hs,title:"Decimate (Reduce Points)",disabled:N.length===0,children:f.jsx("i",{className:"bi bi-filter-left"})}),f.jsx("button",{onClick:Qr,title:"Merge Overlapping Points",disabled:N.length===0,children:f.jsx("i",{className:"bi bi-node-plus"})}),f.jsx("button",{onClick:rn,title:"Import SVG",children:f.jsx("i",{className:"bi bi-vector-pen"})}),f.jsx("button",{onClick:ms,title:"Import ILDA",children:f.jsx("i",{className:"bi bi-folder2-open"})}),f.jsx("button",{onClick:oa,title:"Import Background Image",children:f.jsx("i",{className:"bi bi-image"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:yi,title:"Clear All",children:f.jsx("i",{className:"bi bi-trash"})}),f.jsx("button",{onClick:()=>{he(.6),Pe({x:0,y:0})},title:"Recenter",children:f.jsx("i",{className:"bi bi-aspect-ratio"})})]}),f.jsxs("div",{className:"grid-controls",style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.8rem",marginLeft:"15px"},children:[f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:Ke,onChange:y=>Xe(y.target.checked)})," Grid"]}),f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:wt,onChange:y=>dt(y.target.checked)})," Snap"]}),(e==="line"||e==="bezier")&&f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:ft,onChange:y=>Rt(y.target.checked)})," Continuous"]}),f.jsxs("select",{value:_e,onChange:y=>Ze(parseInt(y.target.value)),style:{background:"#222",color:"white",border:"1px solid #444",borderRadius:"3px"},children:[f.jsx("option",{value:"10",children:"10px"}),f.jsx("option",{value:"25",children:"25px"}),f.jsx("option",{value:"50",children:"50px"}),f.jsx("option",{value:"100",children:"100px"})]})]}),f.jsx("button",{onClick:n,style:{marginLeft:"auto"},children:"Back to Show Control"})]}),f.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[f.jsxs("aside",{style:{width:"60px",background:"#1a1a1a",borderRight:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 0",gap:"10px"},children:[f.jsx(qa,{active:e==="select",onClick:()=>{a("select"),h(!1),G(null)},icon:"bi-cursor"}),e==="select"&&f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",background:"#222",padding:"4px",borderRadius:"4px",border:"1px solid #333"},children:[f.jsx("button",{onClick:ur,title:"Select Odd Points",style:{padding:"4px",fontSize:"0.7rem"},children:"ODD"}),f.jsx("button",{onClick:fr,title:"Select Even Points",style:{padding:"4px",fontSize:"0.7rem"},children:"EVN"}),f.jsx("button",{onClick:ps,title:"Invert Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-arrow-left-right"})}),f.jsx("button",{onClick:Zr,title:"Expand Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-plus-lg"})}),f.jsx("button",{onClick:dr,title:"Shrink Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-dash-lg"})})]}),f.jsx(qa,{active:e==="pen",onClick:()=>{a("pen"),h(!1),G(null)},icon:"bi-pencil"}),f.jsx(qa,{active:e==="bezier",onClick:()=>{a("bezier"),h(!1),G(null)},icon:"bi-bezier2"}),f.jsx(qa,{active:e==="line",onClick:()=>{a("line"),h(!1),G(null)},icon:"bi-slash-lg"}),f.jsx(qa,{active:e==="rect",onClick:()=>{a("rect"),h(!1),G(null)},icon:"bi-square"}),f.jsx(qa,{active:e==="circle",onClick:()=>{a("circle"),h(!1),G(null)},icon:"bi-circle"}),f.jsx(qa,{active:e==="polygon",onClick:()=>{a("polygon"),h(!1),G(null)},icon:"bi-pentagon"}),f.jsx(qa,{active:e==="star",onClick:()=>{a("star"),h(!1),G(null)},icon:"bi-star"}),f.jsx(qa,{active:e==="triangle",onClick:()=>{a("triangle"),h(!1),G(null)},icon:"bi-triangle"}),f.jsxs("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",paddingBottom:"10px"},children:[f.jsx("input",{type:"color",value:or(s),onChange:y=>{l(y.target.value),N.length>0&&fn({color:y.target.value})},title:"Custom Color",style:{width:"35px",height:"35px",border:"2px solid #333",background:"none",cursor:"pointer",marginBottom:"5px"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:[{name:"Red",hex:"#ff0000"},{name:"Orange",hex:"#ff6400"},{name:"Yellow",hex:"#ffff00"},{name:"Green",hex:"#00ff00"},{name:"Cyan",hex:"#00ffff"},{name:"Blue",hex:"#0000ff"},{name:"Violette",hex:"#8000ff"},{name:"Pink",hex:"#ff6496"},{name:"Magenta",hex:"#ff00ff"},{name:"White",hex:"#ffffff"}].map(y=>f.jsx("button",{onClick:()=>{l(y.hex),N.length>0&&fn({color:y.hex})},title:y.name,style:{width:"18px",height:"18px",background:y.hex,border:s===y.hex?"2px solid white":"1px solid #444",borderRadius:"2px",padding:0,cursor:"pointer"}},y.hex))})]})]}),f.jsxs("main",{style:{flex:1,background:"#050505",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[f.jsxs("div",{ref:ha,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[f.jsx("canvas",{ref:Cn,width:window.innerWidth-300,height:window.innerHeight-130,onMouseDown:vi,onMouseMove:_r,onMouseUp:Tl,onContextMenu:Xr,onDoubleClick:mr,style:{background:"transparent"}}),tt.visible&&f.jsxs("div",{className:"context-menu",style:{position:"fixed",top:tt.y,left:tt.x,background:"#222",border:"1px solid #444",borderRadius:"4px",padding:"5px 0",zIndex:1e4},children:[(tt.target?.type==="point"||U.length>0)&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"menu-item",onClick:$r,children:["Delete ",U.length>1?"Points":"Point"]}),f.jsx("div",{className:"menu-item",onClick:Tr,children:"Split to New Shape"})]}),tt.target?.type==="segment"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"menu-item",onClick:mi,children:"Delete Line"}),f.jsx("div",{className:"menu-item",onClick:Zn,children:"Split Line"})]}),(tt.target?.type==="shape"||N.length>0)&&f.jsxs(f.Fragment,{children:[N.some(y=>ot[y]?.type==="polyline"||ot[y]?.type==="polygon")&&f.jsx("div",{className:"menu-item",onClick:pr,children:N.every(y=>ot[y]?.type==="polygon")?"Open Shape":"Close Shape"}),f.jsx("div",{className:"menu-item",onClick:()=>Ea(!1),children:"Subdivide (Linear)"}),f.jsx("div",{className:"menu-item",onClick:()=>Ea(!0),children:"Subdivide (Smooth)"}),f.jsx("div",{className:"menu-item",onClick:hs,children:"Decimate"}),f.jsx("div",{className:"menu-item",onClick:Qr,children:"Merge Points"}),f.jsx("div",{className:"menu-item",onClick:An,children:"Add Corner Points"}),f.jsx("div",{className:"menu-item",onClick:fs,children:"Reset Anchor Point"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),N.length===1&&["rect","circle","star","line"].includes(ot[N[0]]?.type)&&f.jsx("div",{className:"menu-item",onClick:Cr,children:"Convert to Points"}),f.jsx("div",{className:"menu-item",onClick:()=>{const y=[...A],C=N.length>0?N:[tt.target.shapeIndex];y[b]=y[b].filter((Y,P)=>!C.includes(P)),_(y),V([]),q([]),ut({visible:!1})},children:"Delete Shape(s)"})]}),J&&f.jsx("div",{className:"menu-item",onClick:()=>{pe(null),ut({visible:!1})},children:"Clear Background"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),f.jsx("div",{className:"menu-item",onClick:zn,children:"Copy"}),f.jsx("div",{className:"menu-item",onClick:Ga,children:"Paste"})]})]}),f.jsxs("div",{className:"timeline-bar",style:{height:"80px",background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",alignItems:"center",padding:"0 20px",gap:"20px"},children:[f.jsxs("div",{className:"playback-controls",style:{display:"flex",gap:"10px"},children:[f.jsx("button",{onClick:()=>R(!M),style:{width:"40px",height:"40px",borderRadius:"50%",background:M?"var(--theme-color)":"#333",color:M?"black":"white"},children:f.jsx("i",{className:`bi ${M?"bi-pause-fill":"bi-play-fill"}`})}),f.jsx("button",{onClick:()=>T(y=>Math.max(0,y-1)),children:f.jsx("i",{className:"bi bi-chevron-left"})}),f.jsx("button",{onClick:()=>T(y=>Math.min(g-1,y+1)),children:f.jsx("i",{className:"bi bi-chevron-right"})}),f.jsx("button",{onClick:Fs,title:"Duplicate Frame",children:f.jsx("i",{className:"bi bi-layers-half"})})]}),f.jsxs("div",{className:"frame-slider-container",style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#666"},children:[f.jsxs("span",{children:["FRAME ",b+1," / ",g]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",checked:I,onChange:y=>Q(y.target.checked)})," Onion Skin"]})]}),f.jsx(Cl,{currentFrame:b,frameCount:g,syncMode:On,bpm:$n,beats:Ma,duration:pa,fps:gt,snapToGrid:wt,onSeek:T})]}),f.jsxs("div",{className:"timeline-settings",style:{display:"flex",alignItems:"center",gap:"15px"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"START:"}),f.jsx("input",{type:"number",min:"1",max:g,value:xa+1,onChange:y=>ar(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:js,style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"LENGTH:"}),f.jsx("input",{type:"number",min:"1",max:"999",value:S,onChange:y=>x(y.target.value),onBlur:()=>v(Math.max(1,parseInt(S)||1)),onKeyDown:y=>{y.key==="Enter"&&v(Math.max(1,parseInt(S)||1))},onWheel:y=>Nr(y,v),style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]})]})]})]}),f.jsxs("aside",{style:{width:"260px",background:"#1a1a1a",borderLeft:"1px solid #333",display:"flex",flexDirection:"column",overflow:"hidden"},children:[f.jsxs("div",{className:"layers-panel",style:{display:"flex",flexDirection:"column",height:"220px",flexShrink:0,overflowY:"auto",borderBottom:"1px solid #333",padding:"15px"},children:[f.jsxs("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["LAYERS",f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("button",{onClick:Bi,title:"Group",disabled:N.length<2,style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:hi,title:"Ungroup",disabled:N.length!==1||ot[N[0]]?.type!=="group",style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-exclude"})})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:ot.map((y,C)=>({s:y,i:C})).reverse().map(({s:y,i:C})=>f.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"5px",background:N.includes(C)?"#333":"transparent",borderRadius:"3px",cursor:"pointer",border:N.includes(C)?"1px solid var(--theme-color)":"1px solid transparent"},onClick:Y=>{y.locked&&!y.hidden||(Y.shiftKey?V(P=>P.includes(C)?P.filter(B=>B!==C):[...P,C]):V([C]))},children:[f.jsx("div",{style:{width:"10px",height:"10px",background:y.color,marginRight:"8px",borderRadius:"2px"}}),f.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[y.type.toUpperCase()," ",C]}),f.jsx("button",{onClick:Y=>{Y.stopPropagation();const P=[...A];P[b][C]={...y,hidden:!y.hidden},_(P),Et(P)},style:{background:"none",border:"none",padding:"2px",color:y.hidden?"#555":"#ccc"},title:y.hidden?"Show":"Hide",children:f.jsx("i",{className:`bi ${y.hidden?"bi-eye-slash":"bi-eye"}`})}),f.jsx("button",{onClick:Y=>{Y.stopPropagation();const P=[...A];P[b][C]={...y,locked:!y.locked},_(P),Et(P)},style:{background:"none",border:"none",padding:"2px",color:y.locked?"var(--theme-color)":"#555"},title:y.locked?"Unlock":"Lock",children:f.jsx("i",{className:`bi ${y.locked?"bi-lock-fill":"bi-unlock"}`})})]},C))})]}),f.jsxs("div",{className:"properties-scroll-container",style:{flex:1,overflowY:"auto",padding:"15px",display:"flex",flexDirection:"column",gap:"20px"},children:[f.jsx("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",borderBottom:"1px solid #333",paddingBottom:"5px"},children:"PROPERTIES"}),f.jsxs("div",{className:"animation-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"TWEENING TOOL"}),f.jsxs("div",{style:{display:"flex",gap:"5px",marginBottom:"8px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"START FRAME"}),f.jsx("input",{type:"number",value:ze+1,onChange:y=>xe(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:gi,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"END FRAME"}),f.jsx("input",{type:"number",value:wn+1,onChange:y=>qt(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:Ls,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]})]}),f.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"8px",fontSize:"0.7rem",color:"#ccc"},children:[f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:Xt,onChange:y=>$t(y.target.checked)})," POS"]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:pt,onChange:y=>os(y.target.checked)})," COLOR"]})]}),"                                              ",f.jsx("button",{onClick:Dr,className:"primary-btn",style:{width:"100%",padding:"5px"},children:"INTERPOLATE"})]}),f.jsxs("div",{className:"sync-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"PLAYBACK SYNC"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"10px"},children:[f.jsx(Bs,{active:On==="fps",onClick:()=>Ba("fps"),children:"FPS"}),f.jsx(Bs,{active:On==="bpm",onClick:()=>Ba("bpm"),children:"BPM"}),f.jsx(Bs,{active:On==="time",onClick:()=>Ba("time"),children:"TIME"})]}),On==="fps"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["FPS: ",gt]}),f.jsx("input",{type:"range",min:"1",max:"60",value:gt,onChange:y=>_s(parseInt(y.target.value))})]}),On==="bpm"&&f.jsxs("div",{style:{marginBottom:"8px",display:"flex",gap:"5px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BPM: ",$n]}),f.jsx("input",{type:"number",value:$n,onChange:y=>Mr(parseInt(y.target.value)||0),onWheel:Rr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BEATS: ",Ma]}),f.jsx("input",{type:"number",value:Ma,onChange:y=>za(parseInt(y.target.value)||1),onWheel:Os,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]})]}),On==="time"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["DURATION (S): ",pa]}),f.jsx("input",{type:"number",step:"0.1",value:pa,onChange:y=>kr(parseFloat(y.target.value)||0),onWheel:Wr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888",display:"flex",justifyContent:"space-between"},children:["SPEED: ",f.jsxs("span",{children:[ea.toFixed(1),"x"]})]}),f.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:ea,onChange:y=>ds(parseFloat(y.target.value))}),f.jsxs("div",{style:{display:"flex",gap:"4px",marginTop:"4px"},children:[f.jsx("button",{onClick:()=>ds(.5),style:{flex:1,fontSize:"0.6rem"},children:"0.5x"}),f.jsx("button",{onClick:()=>ds(1),style:{flex:1,fontSize:"0.6rem"},children:"1.0x"}),f.jsx("button",{onClick:()=>ds(2),style:{flex:1,fontSize:"0.6rem"},children:"2.0x"})]})]})]}),N.length>0?f.jsxs("div",{className:"shape-properties",style:{display:"flex",flexDirection:"column",gap:"15px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#666",display:"block"},children:N.length===1?`TYPE: ${ot[N[0]]?.type?.toUpperCase()}`:`${N.length} SHAPES SELECTED`}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"COLOR"}),f.jsx("input",{type:"color",value:or(ot[N[0]]?.color||"#ffffff"),onChange:y=>fn({color:y.target.value}),style:{width:"100%",height:"30px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>fn({color:y}),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]}),N.length===1&&ot[N[0]]&&["rect","circle","star","line"].includes(ot[N[0]].type)&&f.jsxs("div",{className:"primitive-properties",style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",background:"#222",borderRadius:"4px"},children:[f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"POSITION (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(ot[N[0]].start?.x||0),onChange:y=>{const C=ot[N[0]];if(!C||!C.start)return;const Y=(parseInt(y.target.value)||0)-C.start.x;_(P=>{const B=[...P],O=[...B[b]];return O[N[0]]=Ra({...O[N[0]]},Y,0),B[b]=O,B})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(ot[N[0]].start?.y||0),onChange:y=>{const C=ot[N[0]];if(!C||!C.start)return;const Y=(parseInt(y.target.value)||0)-C.start.y;_(P=>{const B=[...P],O=[...B[b]];return O[N[0]]=Ra({...O[N[0]]},0,Y),B[b]=O,B})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),ot[N[0]].type==="rect"&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"SIZE (W / H)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(ot[N[0]].width||0),onChange:y=>fn({width:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(ot[N[0]].height||0),onChange:y=>fn({height:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),(ot[N[0]].type==="circle"||ot[N[0]].type==="star")&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"RADIUS (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Math.abs((ot[N[0]].end?.x||0)-(ot[N[0]].start?.x||0))),onChange:y=>{const C=parseInt(y.target.value)||0,Y=ot[N[0]];!Y||!Y.start||!Y.end||fn({end:{...Y.end,x:Y.start.x+C}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Math.abs((ot[N[0]].end?.y||0)-(ot[N[0]].start?.y||0))),onChange:y=>{const C=parseInt(y.target.value)||0,Y=ot[N[0]];!Y||!Y.start||!Y.end||fn({end:{...Y.end,y:Y.start.y+C}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"SCALE X / Y"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",step:"0.1",value:ot[N[0]]?.scaleX||1,onChange:y=>fn({scaleX:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}}),f.jsx("input",{type:"number",step:"0.1",value:ot[N[0]]?.scaleY||1,onChange:y=>fn({scaleY:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"ROTATION X / Y / Z (DEG)"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:["rotationX","rotationY","rotationZ"].map(y=>{const C=ot[N[0]]?.[y]||0,Y=Math.round(C*180/Math.PI*100)/100;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("span",{style:{fontSize:"0.7rem",color:"#555",width:"10px"},children:y.slice(-1)}),f.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:Y,onChange:P=>fn({[y]:parseFloat(P.target.value)*Math.PI/180}),style:{flex:1}}),f.jsx("input",{type:"number",value:Y,onChange:P=>fn({[y]:(parseFloat(P.target.value)||0)*Math.PI/180}),style:{width:"50px",background:"#111",border:"1px solid #444",color:"white",padding:"2px",fontSize:"0.7rem"}})]},y)})})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"RENDER MODE"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:["simple","dotted","dashed","points"].map(y=>f.jsx(Bs,{active:ot[N[0]]?.renderMode===y,onClick:()=>fn({renderMode:y}),children:y},y))})]})]}):f.jsx("p",{style:{fontSize:"0.8rem",color:"#555",textAlign:"center",marginTop:"20px"},children:"Select shapes or drag a box to begin."}),U.length>0&&N.length===1&&f.jsxs("div",{className:"point-properties",style:{background:"#222",padding:"10px",borderRadius:"4px",border:"1px solid var(--theme-color)",flexShrink:0},children:[f.jsxs("label",{style:{fontSize:"0.8rem",color:"var(--theme-color)",display:"block",marginBottom:"5px"},children:[U.length," POINTS SELECTED"]}),f.jsx("input",{type:"color",value:or(zi),onChange:y=>hr(y.target.value),style:{width:"100%",height:"40px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>hr(y),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]})]}),f.jsx("div",{className:"save-container",style:{padding:"15px",borderTop:"1px solid #333",background:"#1a1a1a"},children:f.jsx("button",{className:"primary-btn",style:{width:"100%",padding:"12px"},onClick:Ya,disabled:A.every(y=>y.length===0)||Dt,children:Dt?"EXPORTING...":"SAVE AS CLIP"})})]})]}),f.jsx("style",{children:`
        button { padding: 4px 10px; background: #333; border: 1px solid #444; color: #ccc; border-radius: 3px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; }
        button:hover:not(:disabled) { background: #444; color: white; }
        .primary-btn { background: var(--theme-color) !important; color: black !important; font-weight: bold; border: none !important; }
        .context-menu { background: #222; border: 1px solid #444; border-radius: 4px; padding: 5px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-width: 120px; }
        .context-menu .menu-item { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; color: #ccc; }
        .context-menu .menu-item:hover { background: var(--theme-color); color: black; }
        input[type="range"] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--theme-color); border-radius: 50%; cursor: pointer; }
        
        .sb-checkbox {
            appearance: none !important;
            -webkit-appearance: none !important;
            width: 14px !important;
            height: 14px !important;
            min-width: 14px !important;
            min-height: 14px !important;
            background: #111 !important;
            border: 1px solid #444 !important;
            border-radius: 2px !important;
            cursor: pointer;
            position: relative;
            margin: 0 4px 0 0 !important;
            display: inline-block;
            vertical-align: middle;
        }
        /* Crucial: Kill the global "OFF/ON" toggle styling */
        .sb-checkbox:before {
            content: none !important;
            display: none !important;
        }
        .sb-checkbox:checked {
            background: var(--theme-color) !important;
            border-color: var(--theme-color) !important;
        }
        .sb-checkbox:checked::after {
            content: '\\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 10px;
            font-weight: bold;
            display: block !important;
        }
      `})]})},Zv=({onBack:n})=>f.jsxs("div",{className:"timeline-editor-page",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column"},children:[f.jsxs("header",{style:{padding:"10px 20px",borderBottom:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("h2",{children:"Timeline Editor (Coming Soon)"}),f.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#ff5e00",border:"none",color:"white",borderRadius:"4px",cursor:"pointer"},children:"Back to Show Control"})]}),f.jsx("main",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("p",{children:"This is the Timeline Editor placeholder."}),f.jsx("p",{children:"Goal: Arrange clips on a timeline for synchronized playback."})]})})]}),Qv=({show:n,onClose:e,initialTab:a="output"})=>{const[s,l]=w.useState(a);return Bn.useEffect(()=>{n&&l(a)},[n,a]),n?f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"About"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsx("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"}}),f.jsx("div",{className:"modal-body",children:f.jsx("div",{className:"audio-output-settings"})})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]}):null},og=w.createContext(null),Kv=()=>w.useContext(og),Jv=({children:n})=>{const[e,a]=w.useState(null);return w.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(og.Provider,{value:e,children:n})},cg=w.createContext(null),eb=({children:n})=>{const e=w.useMemo(()=>{try{const a=new Worker(new URL(""+new URL("generators.worker-X7mnN_oE.js",import.meta.url).href,import.meta.url),{type:"module"});return a.onerror=s=>{console.error("Generator Worker instantiation or internal error:",s)},a}catch(a){return console.error("Failed to create Generator Worker:",a),null}},[]);return w.useEffect(()=>{if(e)return()=>{e.terminate()}},[e]),f.jsx(cg.Provider,{value:e,children:n})},tb=()=>{const n=w.useContext(cg);if(n===void 0)throw new Error("useGeneratorWorker must be used within a GeneratorWorkerProvider");return n};var nb=Hm();const ab=od(nb),Z0=[{name:"Off",hex:"#000000",velocity:0},{name:"Grey Dark",hex:"#1E1E1E",velocity:1},{name:"Grey Mid",hex:"#7F7F7F",velocity:2},{name:"White",hex:"#FFFFFF",velocity:3},{name:"Red Light",hex:"#FF4C4C",velocity:4},{name:"Red",hex:"#FF0000",velocity:5},{name:"Red Dark",hex:"#590000",velocity:6},{name:"Red Very Dark",hex:"#190000",velocity:7},{name:"Orange Light",hex:"#FFBD6C",velocity:8},{name:"Orange",hex:"#FF5400",velocity:9},{name:"Orange Dark",hex:"#591D00",velocity:10},{name:"Orange Very Dark",hex:"#271B00",velocity:11},{name:"Yellow Light",hex:"#FFFF4C",velocity:12},{name:"Yellow",hex:"#FFFF00",velocity:13},{name:"Yellow Dark",hex:"#595900",velocity:14},{name:"Yellow Very Dark",hex:"#191900",velocity:15},{name:"Lime Light",hex:"#88FF4C",velocity:16},{name:"Lime",hex:"#54FF00",velocity:17},{name:"Lime Dark",hex:"#1D5900",velocity:18},{name:"Lime Very Dark",hex:"#142B00",velocity:19},{name:"Green Light",hex:"#4CFF4C",velocity:20},{name:"Green",hex:"#00FF00",velocity:21},{name:"Green Dark",hex:"#005900",velocity:22},{name:"Green Very Dark",hex:"#001900",velocity:23},{name:"Spring Light",hex:"#4CFF5E",velocity:24},{name:"Spring",hex:"#00FF19",velocity:25},{name:"Spring Dark",hex:"#00590D",velocity:26},{name:"Spring Very Dark",hex:"#001902",velocity:27},{name:"Turquoise Light",hex:"#4CFF88",velocity:28},{name:"Turquoise",hex:"#00FF55",velocity:29},{name:"Turquoise Dark",hex:"#00591D",velocity:30},{name:"Turquoise Very Dark",hex:"#001F12",velocity:31},{name:"Cyan Light",hex:"#4CFFB7",velocity:32},{name:"Cyan",hex:"#00FF99",velocity:33},{name:"Cyan Dark",hex:"#005935",velocity:34},{name:"Cyan Very Dark",hex:"#001912",velocity:35},{name:"Sky Light",hex:"#4CC3FF",velocity:36},{name:"Sky",hex:"#00A9FF",velocity:37},{name:"Sky Dark",hex:"#004152",velocity:38},{name:"Sky Very Dark",hex:"#001019",velocity:39},{name:"Ocean Light",hex:"#4C88FF",velocity:40},{name:"Ocean",hex:"#0055FF",velocity:41},{name:"Ocean Dark",hex:"#001D59",velocity:42},{name:"Ocean Very Dark",hex:"#000819",velocity:43},{name:"Blue Light",hex:"#4C4CFF",velocity:44},{name:"Blue",hex:"#0000FF",velocity:45},{name:"Blue Dark",hex:"#000059",velocity:46},{name:"Blue Very Dark",hex:"#000019",velocity:47},{name:"Orchid Light",hex:"#874CFF",velocity:48},{name:"Orchid",hex:"#5400FF",velocity:49},{name:"Orchid Dark",hex:"#190064",velocity:50},{name:"Orchid Very Dark",hex:"#0F0030",velocity:51},{name:"Magenta Light",hex:"#FF4CFF",velocity:52},{name:"Magenta",hex:"#FF00FF",velocity:53},{name:"Magenta Dark",hex:"#590059",velocity:54},{name:"Magenta Very Dark",hex:"#190019",velocity:55},{name:"Pink Light",hex:"#FF4C87",velocity:56},{name:"Pink",hex:"#FF0054",velocity:57},{name:"Pink Dark",hex:"#59001D",velocity:58},{name:"Pink Very Dark",hex:"#220013",velocity:59},{name:"Bright Red",hex:"#FF1500",velocity:60},{name:"Bright Orange",hex:"#993500",velocity:61},{name:"Gold",hex:"#795100",velocity:62},{name:"Moss",hex:"#436400",velocity:63},{name:"Grass",hex:"#033900",velocity:64},{name:"Sea",hex:"#005735",velocity:65},{name:"Navy Ocean",hex:"#00547F",velocity:66},{name:"Pure Blue",hex:"#0000FF",velocity:67},{name:"Slate",hex:"#00454F",velocity:68},{name:"Indigo",hex:"#2500CC",velocity:69},{name:"Grey Bright",hex:"#7F7F7F",velocity:70},{name:"Charcoal",hex:"#202020",velocity:71},{name:"Strong Red",hex:"#FF0000",velocity:72},{name:"Neon Green",hex:"#BDFF2D",velocity:73},{name:"Lime Strong",hex:"#AFED06",velocity:74},{name:"Green Strong",hex:"#64FF09",velocity:76},{name:"Mint Strong",hex:"#00FF87",velocity:77},{name:"Cyan Strong",hex:"#00A9FF",velocity:78},{name:"Blue Strong",hex:"#002AFF",velocity:79},{name:"Purple Strong",hex:"#3F00FF",velocity:80},{name:"Violet Strong",hex:"#7A00FF",velocity:81},{name:"Rose Strong",hex:"#B21A7D",velocity:82},{name:"Brown",hex:"#402100",velocity:83},{name:"Fire",hex:"#FF4A00",velocity:84},{name:"Acid Green",hex:"#88E106",velocity:85},{name:"Spring Strong",hex:"#72FF15",velocity:86},{name:"Vibrant Green",hex:"#00FF00",velocity:87},{name:"Aqua",hex:"#3BFF26",velocity:88},{name:"Vibrant Cyan",hex:"#59FF71",velocity:89},{name:"Sky Strong",hex:"#38FFCC",velocity:90},{name:"Deep Sky",hex:"#5B8AFF",velocity:91},{name:"Indigo Dark",hex:"#3151C6",velocity:92},{name:"Deep Purple",hex:"#877FE9",velocity:93},{name:"Deep Magenta",hex:"#D31DFF",velocity:94},{name:"Deep Rose",hex:"#FF005D",velocity:95},{name:"Vibrant Orange",hex:"#FF7F00",velocity:96},{name:"Deep Yellow",hex:"#B9B000",velocity:97},{name:"Neon Lime",hex:"#90FF00",velocity:98},{name:"Dark Gold",hex:"#835D07",velocity:99},{name:"Tan",hex:"#392b00",velocity:100},{name:"Forest",hex:"#144C10",velocity:101},{name:"Teal",hex:"#0D5038",velocity:102},{name:"Night",hex:"#15152A",velocity:103},{name:"Midnight",hex:"#16205A",velocity:104},{name:"Mud",hex:"#693C1C",velocity:105},{name:"Dark Red",hex:"#A8000A",velocity:106},{name:"Soft Red",hex:"#DE513D",velocity:107},{name:"Soft Orange",hex:"#D86A1C",velocity:108},{name:"Soft Yellow",hex:"#FFE126",velocity:109},{name:"Soft Lime",hex:"#9EE12F",velocity:110},{name:"Soft Green",hex:"#67B50F",velocity:111},{name:"Soft Grey",hex:"#1E1E30",velocity:112},{name:"Mint Light",hex:"#DCFF6B",velocity:113},{name:"Cyan Pale",hex:"#80FFBD",velocity:114},{name:"Lavender",hex:"#9A99FF",velocity:115},{name:"Mauve",hex:"#8E66FF",velocity:116},{name:"Grey Soft",hex:"#404040",velocity:117},{name:"Grey Pale",hex:"#757575",velocity:118},{name:"Pure White",hex:"#E0FFFF",velocity:119},{name:"Red Hardware",hex:"#A00000",velocity:120},{name:"Red Half",hex:"#350000",velocity:121},{name:"Green Hardware",hex:"#1AD000",velocity:122},{name:"Green Half",hex:"#074200",velocity:123},{name:"Yellow Hardware",hex:"#B9B000",velocity:124},{name:"Yellow Half",hex:"#3F3100",velocity:125},{name:"Amber Hardware",hex:"#B35F00",velocity:126},{name:"Amber Half",hex:"#4B1502",velocity:127}],gl=({value:n,onChange:e,label:a})=>f.jsxs("div",{className:"midi-color-picker",style:{marginBottom:"8px"},children:[a&&f.jsx("label",{style:{display:"block",fontSize:"10px",color:"#888",marginBottom:"2px"},children:a}),f.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[f.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"3px",background:Z0.find(s=>s.velocity===n)?.hex||"#000",border:"1px solid #555"}}),f.jsx("select",{value:n,onChange:s=>e(parseInt(s.target.value)),style:{flex:1,background:"#111",color:"#fff",border:"1px solid #444",fontSize:"11px",padding:"2px"},children:Z0.map(s=>f.jsxs("option",{value:s.velocity,children:[s.name," (",s.velocity,")"]},s.velocity))})]})]}),rb=()=>{const{isMapping:n,mappings:e,learningId:a,setLearningId:s,removeAssignment:l,setMappings:o,midiInputs:u,selectedMidiInputId:p}=Hc(),{isMapping:h,mappings:g,learningId:v}=ud()||{},{isMapping:S,mappings:x,learningId:b}=fd()||{},T=n||h||S,[M,R]=w.useState([]),I=w.useMemo(()=>{if(!a)return[];const _=[];return Object.entries(e).forEach(([k,G])=>{G.forEach(F=>{F.controlId===a&&_.push({key:k,...F})})}),_},[a,e]),Q=(_,k,G,F)=>{o(K=>{const le={...K};return le[_]?(le[_]=le[_].map(H=>H.controlId===k?{...H,[G]:F}:H),le):K})},A=w.useCallback(()=>{if(!T)return;const _=document.querySelectorAll("[data-mappable-id]"),k=Array.from(_).map(G=>{const F=G.getBoundingClientRect();return{id:G.getAttribute("data-mappable-id"),rect:{top:F.top,left:F.left,width:F.width,height:F.height}}});R(k)},[T]);return w.useEffect(()=>{if(T){A(),window.addEventListener("resize",A);const _=setTimeout(A,100);return()=>{window.removeEventListener("resize",A),clearTimeout(_)}}else R([])},[T,A]),T?ab.createPortal(f.jsx("div",{className:"midi-mapping-global-overlay-container",children:M.map(_=>{let k=null;const G=n,F=h,K=S;if(G){const H=Object.entries(e).filter(([N,V])=>V.some(U=>U.controlId===_.id));H.length>0&&(k=H[0][1].find(V=>V.controlId===_.id).label,H.length>1&&(k+=` (+${H.length-1})`))}else if(F){const H=g?g[_.id]:null;k=H?H.label:null}else if(K){const H=x?x[_.id]:null;k=H?H.label:null}const le=G&&a===_.id||F&&v===_.id||K&&b===_.id;return f.jsxs(Bn.Fragment,{children:[f.jsx("div",{className:`midi-mapping-label-box ${le?"learning":""} ${k?"mapped":""} ${F?"artnet-mapping":""} ${K?"keyboard-mapping":""}`,style:{position:"fixed",top:_.rect.top,left:_.rect.left,width:_.rect.width,height:_.rect.height,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:f.jsx("div",{className:"mapping-label",children:k||"+"})}),le&&G&&f.jsxs("div",{className:"assignment-editor-popup",style:{position:"fixed",top:_.rect.top+_.rect.height+10,left:_.rect.left,background:"#1a1a1a",border:"1px solid #444",borderRadius:"5px",padding:"10px",zIndex:10001,minWidth:"250px",boxShadow:"0 5px 15px rgba(0,0,0,0.5)",pointerEvents:"auto"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[f.jsx("h4",{style:{margin:0,fontSize:"0.9rem"},children:"MIDI Assignments"}),f.jsx("button",{onClick:()=>s(null),style:{background:"none",border:"none",color:"#888",cursor:"pointer"},children:""})]}),I.length>0?I.map((H,N)=>f.jsxs("div",{className:"assignment-item",style:{background:"#222",padding:"8px",borderRadius:"4px",marginBottom:"8px",borderLeft:"3px solid var(--theme-color)"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"},children:[f.jsx("span",{style:{fontWeight:"bold",fontSize:"0.8rem"},children:H.label}),f.jsx("button",{onClick:()=>l(H.key,H.controlId),style:{background:"none",border:"none",color:"#ff4444",cursor:"pointer",fontSize:"12px"},children:"Remove"})]}),f.jsxs("div",{className:"setting-group",style:{marginBottom:"5px"},children:[f.jsx("label",{style:{fontSize:"10px",color:"#888",display:"block"},children:"Target"}),f.jsxs("select",{value:H.targetType||"position",onChange:V=>Q(H.key,H.controlId,"targetType",V.target.value),style:{width:"100%",background:"#111",color:"#fff",border:"1px solid #333",fontSize:"10px"},children:[f.jsx("option",{value:"position",children:"By Position (Static)"}),f.jsx("option",{value:"thisClip",children:"This Clip (Contextual)"}),f.jsx("option",{value:"selectedLayer",children:"Selected Layer (Dynamic)"})]})]}),f.jsxs("div",{className:"setting-group",children:[f.jsx("label",{style:{fontSize:"10px",color:"#888",display:"block"},children:"Input Device"}),f.jsxs("select",{value:H.inputDeviceId||"any",onChange:V=>Q(H.key,H.controlId,"inputDeviceId",V.target.value),style:{width:"100%",background:"#111",color:"#fff",border:"1px solid #333",fontSize:"10px"},children:[f.jsx("option",{value:"any",children:"Any Device"}),u.map(V=>f.jsx("option",{value:V.id,children:V.name},V.id))]})]}),f.jsxs("div",{className:"feedback-settings",style:{marginTop:"10px",padding:"5px",background:"#111",borderRadius:"3px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("span",{style:{fontSize:"9px",color:"var(--theme-color)",fontWeight:"bold"},children:"CONTROL MODE"}),f.jsxs("select",{value:H.controlMode||"absolute",onChange:V=>Q(H.key,H.controlId,"controlMode",V.target.value),style:{background:"#000",color:"#fff",border:"1px solid #444",fontSize:"9px"},children:[f.jsx("option",{value:"absolute",children:"Absolute"}),f.jsx("option",{value:"relative",children:"Relative (Encoder)"}),f.jsx("option",{value:"fake_relative",children:"Fake Relative (Knob)"})]})]}),f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("span",{style:{fontSize:"9px",color:"var(--theme-color)",fontWeight:"bold"},children:"FEEDBACK (MIDI OUT)"}),f.jsxs("select",{value:H.feedbackMode||"toggle",onChange:V=>Q(H.key,H.controlId,"feedbackMode",V.target.value),style:{background:"#000",color:"#fff",border:"1px solid #444",fontSize:"9px"},children:[f.jsx("option",{value:"toggle",children:"Toggle"}),f.jsx("option",{value:"clip",children:"Clip"}),f.jsx("option",{value:"slider",children:"Slider"}),f.jsx("option",{value:"dropdown",children:"Dropdown"})]})]}),f.jsxs("div",{className:"setting-group",style:{marginBottom:"8px"},children:[f.jsx("label",{style:{fontSize:"9px",color:"#888",display:"block"},children:"Blink Mode"}),f.jsxs("select",{value:H.blinkMode||0,onChange:V=>Q(H.key,H.controlId,"blinkMode",parseInt(V.target.value)),style:{width:"100%",background:"#000",color:"#fff",border:"1px solid #333",fontSize:"9px"},children:[f.jsx("option",{value:0,children:"Static (Primary Color)"}),f.jsx("option",{value:1,children:"Oneshot 1/24 (Secondary Color)"}),f.jsx("option",{value:2,children:"Oneshot 1/16"}),f.jsx("option",{value:3,children:"Oneshot 1/8"}),f.jsx("option",{value:4,children:"Oneshot 1/4"}),f.jsx("option",{value:5,children:"Oneshot 1/2"}),f.jsx("option",{value:6,children:"Pulsing 1/24"}),f.jsx("option",{value:7,children:"Pulsing 1/16"}),f.jsx("option",{value:8,children:"Pulsing 1/8"}),f.jsx("option",{value:9,children:"Pulsing 1/4"}),f.jsx("option",{value:10,children:"Pulsing 1/2"}),f.jsx("option",{value:11,children:"Blinking 1/24"}),f.jsx("option",{value:12,children:"Blinking 1/16"}),f.jsx("option",{value:13,children:"Blinking 1/8"}),f.jsx("option",{value:14,children:"Blinking 1/4"}),f.jsx("option",{value:15,children:"Blinking 1/2"})]})]}),f.jsxs("div",{className:"color-selectors",style:{marginTop:"5px"},children:[(!H.feedbackMode||H.feedbackMode==="toggle"||H.feedbackMode==="dropdown")&&f.jsxs(f.Fragment,{children:[f.jsx(gl,{label:"On Color",value:H.feedbackConfig?.onVelocity??127,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,onVelocity:V})}),f.jsx(gl,{label:"Off Color",value:H.feedbackConfig?.offVelocity??0,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,offVelocity:V})})]}),H.feedbackMode==="clip"&&f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:[f.jsx(gl,{label:"Active",value:H.feedbackConfig?.activeVelocity??127,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,activeVelocity:V})}),f.jsx(gl,{label:"Preview",value:H.feedbackConfig?.previewVelocity??64,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,previewVelocity:V})}),f.jsx(gl,{label:"Inactive",value:H.feedbackConfig?.inactiveVelocity??1,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,inactiveVelocity:V})}),f.jsx(gl,{label:"Empty",value:H.feedbackConfig?.emptyVelocity??0,onChange:V=>Q(H.key,H.controlId,"feedbackConfig",{...H.feedbackConfig,emptyVelocity:V})})]})]})]})]},`${H.key}_${N}`)):f.jsx("div",{style:{textAlign:"center",padding:"10px",color:"#666",fontSize:"0.8rem"},children:"Press a button or move a fader on your MIDI controller to add an assignment."}),I.length>0&&f.jsx("div",{style:{fontSize:"9px",color:"#555",marginTop:"5px",textAlign:"center"},children:"Press another MIDI control to add more links."})]})]},_.id)})}),document.body):null};String.prototype.codePointAt||(function(){var n=(function(){try{var a={},s=Object.defineProperty,l=s(a,a,a)&&s}catch{}return l})(),e=function(a){if(this==null)throw TypeError();var s=String(this),l=s.length,o=a?Number(a):0;if(o!=o&&(o=0),!(o<0||o>=l)){var u=s.charCodeAt(o),p;return u>=55296&&u<=56319&&l>o+1&&(p=s.charCodeAt(o+1),p>=56320&&p<=57343)?(u-55296)*1024+p-56320+65536:u}};n?n(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var hd=0,ug=-3;function xo(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function sb(n,e){this.source=n,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new xo,this.dtree=new xo}var fg=new xo,dg=new xo,md=new Uint8Array(30),gd=new Uint16Array(30),pg=new Uint8Array(30),hg=new Uint16Array(30),ib=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Q0=new xo,rs=new Uint8Array(320);function mg(n,e,a,s){var l,o;for(l=0;l<a;++l)n[l]=0;for(l=0;l<30-a;++l)n[l+a]=l/a|0;for(o=s,l=0;l<30;++l)e[l]=o,o+=1<<n[l]}function lb(n,e){var a;for(a=0;a<7;++a)n.table[a]=0;for(n.table[7]=24,n.table[8]=152,n.table[9]=112,a=0;a<24;++a)n.trans[a]=256+a;for(a=0;a<144;++a)n.trans[24+a]=a;for(a=0;a<8;++a)n.trans[168+a]=280+a;for(a=0;a<112;++a)n.trans[176+a]=144+a;for(a=0;a<5;++a)e.table[a]=0;for(e.table[5]=32,a=0;a<32;++a)e.trans[a]=a}var K0=new Uint16Array(16);function Pf(n,e,a,s){var l,o;for(l=0;l<16;++l)n.table[l]=0;for(l=0;l<s;++l)n.table[e[a+l]]++;for(n.table[0]=0,o=0,l=0;l<16;++l)K0[l]=o,o+=n.table[l];for(l=0;l<s;++l)e[a+l]&&(n.trans[K0[e[a+l]]++]=l)}function ob(n){n.bitcount--||(n.tag=n.source[n.sourceIndex++],n.bitcount=7);var e=n.tag&1;return n.tag>>>=1,e}function ss(n,e,a){if(!e)return a;for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var s=n.tag&65535>>>16-e;return n.tag>>>=e,n.bitcount-=e,s+a}function Jf(n,e){for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var a=0,s=0,l=0,o=n.tag;do s=2*s+(o&1),o>>>=1,++l,a+=e.table[l],s-=e.table[l];while(s>=0);return n.tag=o,n.bitcount-=l,e.trans[a+s]}function cb(n,e,a){var s,l,o,u,p,h;for(s=ss(n,5,257),l=ss(n,5,1),o=ss(n,4,4),u=0;u<19;++u)rs[u]=0;for(u=0;u<o;++u){var g=ss(n,3,0);rs[ib[u]]=g}for(Pf(Q0,rs,0,19),p=0;p<s+l;){var v=Jf(n,Q0);switch(v){case 16:var S=rs[p-1];for(h=ss(n,2,3);h;--h)rs[p++]=S;break;case 17:for(h=ss(n,3,3);h;--h)rs[p++]=0;break;case 18:for(h=ss(n,7,11);h;--h)rs[p++]=0;break;default:rs[p++]=v;break}}Pf(e,rs,0,s),Pf(a,rs,s,l)}function J0(n,e,a){for(;;){var s=Jf(n,e);if(s===256)return hd;if(s<256)n.dest[n.destLen++]=s;else{var l,o,u,p;for(s-=257,l=ss(n,md[s],gd[s]),o=Jf(n,a),u=n.destLen-ss(n,pg[o],hg[o]),p=u;p<u+l;++p)n.dest[n.destLen++]=n.dest[p]}}}function ub(n){for(var e,a,s;n.bitcount>8;)n.sourceIndex--,n.bitcount-=8;if(e=n.source[n.sourceIndex+1],e=256*e+n.source[n.sourceIndex],a=n.source[n.sourceIndex+3],a=256*a+n.source[n.sourceIndex+2],e!==(~a&65535))return ug;for(n.sourceIndex+=4,s=e;s;--s)n.dest[n.destLen++]=n.source[n.sourceIndex++];return n.bitcount=0,hd}function fb(n,e){var a=new sb(n,e),s,l,o;do{switch(s=ob(a),l=ss(a,2,0),l){case 0:o=ub(a);break;case 1:o=J0(a,fg,dg);break;case 2:cb(a,a.ltree,a.dtree),o=J0(a,a.ltree,a.dtree);break;default:o=ug}if(o!==hd)throw new Error("Data error")}while(!s);return a.destLen<a.dest.length?typeof a.dest.slice=="function"?a.dest.slice(0,a.destLen):a.dest.subarray(0,a.destLen):a.dest}lb(fg,dg);mg(md,gd,4,3);mg(pg,hg,2,1);md[28]=0;gd[28]=258;var db=fb;function yl(n,e,a,s,l){return Math.pow(1-l,3)*n+3*Math.pow(1-l,2)*l*e+3*(1-l)*Math.pow(l,2)*a+Math.pow(l,3)*s}function Is(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Is.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Is.prototype.addPoint=function(n,e){typeof n=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=n,this.x2=n),n<this.x1&&(this.x1=n),n>this.x2&&(this.x2=n)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Is.prototype.addX=function(n){this.addPoint(n,null)};Is.prototype.addY=function(n){this.addPoint(null,n)};Is.prototype.addBezier=function(n,e,a,s,l,o,u,p){var h=[n,e],g=[a,s],v=[l,o],S=[u,p];this.addPoint(n,e),this.addPoint(u,p);for(var x=0;x<=1;x++){var b=6*h[x]-12*g[x]+6*v[x],T=-3*h[x]+9*g[x]-9*v[x]+3*S[x],M=3*g[x]-3*h[x];if(T===0){if(b===0)continue;var R=-M/b;0<R&&R<1&&(x===0&&this.addX(yl(h[x],g[x],v[x],S[x],R)),x===1&&this.addY(yl(h[x],g[x],v[x],S[x],R)));continue}var I=Math.pow(b,2)-4*M*T;if(!(I<0)){var Q=(-b+Math.sqrt(I))/(2*T);0<Q&&Q<1&&(x===0&&this.addX(yl(h[x],g[x],v[x],S[x],Q)),x===1&&this.addY(yl(h[x],g[x],v[x],S[x],Q)));var A=(-b-Math.sqrt(I))/(2*T);0<A&&A<1&&(x===0&&this.addX(yl(h[x],g[x],v[x],S[x],A)),x===1&&this.addY(yl(h[x],g[x],v[x],S[x],A)))}}};Is.prototype.addQuad=function(n,e,a,s,l,o){var u=n+.6666666666666666*(a-n),p=e+2/3*(s-e),h=u+1/3*(l-n),g=p+1/3*(o-e);this.addBezier(n,e,u,p,h,g,l,o)};function qn(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}qn.prototype.moveTo=function(n,e){this.commands.push({type:"M",x:n,y:e})};qn.prototype.lineTo=function(n,e){this.commands.push({type:"L",x:n,y:e})};qn.prototype.curveTo=qn.prototype.bezierCurveTo=function(n,e,a,s,l,o){this.commands.push({type:"C",x1:n,y1:e,x2:a,y2:s,x:l,y:o})};qn.prototype.quadTo=qn.prototype.quadraticCurveTo=function(n,e,a,s){this.commands.push({type:"Q",x1:n,y1:e,x:a,y:s})};qn.prototype.close=qn.prototype.closePath=function(){this.commands.push({type:"Z"})};qn.prototype.extend=function(n){if(n.commands)n=n.commands;else if(n instanceof Is){var e=n;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,n)};qn.prototype.getBoundingBox=function(){for(var n=new Is,e=0,a=0,s=0,l=0,o=0;o<this.commands.length;o++){var u=this.commands[o];switch(u.type){case"M":n.addPoint(u.x,u.y),e=s=u.x,a=l=u.y;break;case"L":n.addPoint(u.x,u.y),s=u.x,l=u.y;break;case"Q":n.addQuad(s,l,u.x1,u.y1,u.x,u.y),s=u.x,l=u.y;break;case"C":n.addBezier(s,l,u.x1,u.y1,u.x2,u.y2,u.x,u.y),s=u.x,l=u.y;break;case"Z":s=e,l=a;break;default:throw new Error("Unexpected path command "+u.type)}}return n.isEmpty()&&n.addPoint(0,0),n};qn.prototype.draw=function(n){n.beginPath();for(var e=0;e<this.commands.length;e+=1){var a=this.commands[e];a.type==="M"?n.moveTo(a.x,a.y):a.type==="L"?n.lineTo(a.x,a.y):a.type==="C"?n.bezierCurveTo(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n.quadraticCurveTo(a.x1,a.y1,a.x,a.y):a.type==="Z"&&n.closePath()}this.fill&&(n.fillStyle=this.fill,n.fill()),this.stroke&&(n.strokeStyle=this.stroke,n.lineWidth=this.strokeWidth,n.stroke())};qn.prototype.toPathData=function(n){n=n!==void 0?n:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(n)}function a(){for(var u=arguments,p="",h=0;h<arguments.length;h+=1){var g=u[h];g>=0&&h>0&&(p+=" "),p+=e(g)}return p}for(var s="",l=0;l<this.commands.length;l+=1){var o=this.commands[l];o.type==="M"?s+="M"+a(o.x,o.y):o.type==="L"?s+="L"+a(o.x,o.y):o.type==="C"?s+="C"+a(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?s+="Q"+a(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(s+="Z")}return s};qn.prototype.toSVG=function(n){var e='<path d="';return e+=this.toPathData(n),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};qn.prototype.toDOMElement=function(n){var e=this.toPathData(n),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",e),a};function gg(n){throw new Error(n)}function em(n,e){n||gg(e)}var vt={fail:gg,argument:em,assert:em},tm=32768,nm=2147483648,Sl={},We={},xt={};function zr(n){return function(){return n}}We.BYTE=function(n){return vt.argument(n>=0&&n<=255,"Byte value should be between 0 and 255."),[n]};xt.BYTE=zr(1);We.CHAR=function(n){return[n.charCodeAt(0)]};xt.CHAR=zr(1);We.CHARARRAY=function(n){typeof n>"u"&&(n="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],a=0;a<n.length;a+=1)e[a]=n.charCodeAt(a);return e};xt.CHARARRAY=function(n){return typeof n>"u"?0:n.length};We.USHORT=function(n){return[n>>8&255,n&255]};xt.USHORT=zr(2);We.SHORT=function(n){return n>=tm&&(n=-(2*tm-n)),[n>>8&255,n&255]};xt.SHORT=zr(2);We.UINT24=function(n){return[n>>16&255,n>>8&255,n&255]};xt.UINT24=zr(3);We.ULONG=function(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]};xt.ULONG=zr(4);We.LONG=function(n){return n>=nm&&(n=-(2*nm-n)),[n>>24&255,n>>16&255,n>>8&255,n&255]};xt.LONG=zr(4);We.FIXED=We.ULONG;xt.FIXED=xt.ULONG;We.FWORD=We.SHORT;xt.FWORD=xt.SHORT;We.UFWORD=We.USHORT;xt.UFWORD=xt.USHORT;We.LONGDATETIME=function(n){return[0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255]};xt.LONGDATETIME=zr(8);We.TAG=function(n){return vt.argument(n.length===4,"Tag should be exactly 4 ASCII characters."),[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]};xt.TAG=zr(4);We.Card8=We.BYTE;xt.Card8=xt.BYTE;We.Card16=We.USHORT;xt.Card16=xt.USHORT;We.OffSize=We.BYTE;xt.OffSize=xt.BYTE;We.SID=We.USHORT;xt.SID=xt.USHORT;We.NUMBER=function(n){return n>=-107&&n<=107?[n+139]:n>=108&&n<=1131?(n=n-108,[(n>>8)+247,n&255]):n>=-1131&&n<=-108?(n=-n-108,[(n>>8)+251,n&255]):n>=-32768&&n<=32767?We.NUMBER16(n):We.NUMBER32(n)};xt.NUMBER=function(n){return We.NUMBER(n).length};We.NUMBER16=function(n){return[28,n>>8&255,n&255]};xt.NUMBER16=zr(3);We.NUMBER32=function(n){return[29,n>>24&255,n>>16&255,n>>8&255,n&255]};xt.NUMBER32=zr(5);We.REAL=function(n){var e=n.toString(),a=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(a){var s=parseFloat("1e"+((a[2]?+a[2]:0)+a[1].length));e=(Math.round(n*s)/s).toString()}for(var l="",o=0,u=e.length;o<u;o+=1){var p=e[o];p==="e"?l+=e[++o]==="-"?"c":"b":p==="."?l+="a":p==="-"?l+="e":l+=p}l+=l.length&1?"f":"ff";for(var h=[30],g=0,v=l.length;g<v;g+=2)h.push(parseInt(l.substr(g,2),16));return h};xt.REAL=function(n){return We.REAL(n).length};We.NAME=We.CHARARRAY;xt.NAME=xt.CHARARRAY;We.STRING=We.CHARARRAY;xt.STRING=xt.CHARARRAY;Sl.UTF8=function(n,e,a){for(var s=[],l=a,o=0;o<l;o++,e+=1)s[o]=n.getUint8(e);return String.fromCharCode.apply(null,s)};Sl.UTF16=function(n,e,a){for(var s=[],l=a/2,o=0;o<l;o++,e+=2)s[o]=n.getUint16(e);return String.fromCharCode.apply(null,s)};We.UTF16=function(n){for(var e=[],a=0;a<n.length;a+=1){var s=n.charCodeAt(a);e[e.length]=s>>8&255,e[e.length]=s&255}return e};xt.UTF16=function(n){return n.length*2};var ed={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Sl.MACSTRING=function(n,e,a,s){var l=ed[s];if(l!==void 0){for(var o="",u=0;u<a;u++){var p=n.getUint8(e+u);p<=127?o+=String.fromCharCode(p):o+=l[p&127]}return o}};var Nc=typeof WeakMap=="function"&&new WeakMap,Rc,pb=function(n){if(!Rc){Rc={};for(var e in ed)Rc[e]=new String(e)}var a=Rc[n];if(a!==void 0){if(Nc){var s=Nc.get(a);if(s!==void 0)return s}var l=ed[n];if(l!==void 0){for(var o={},u=0;u<l.length;u++)o[l.charCodeAt(u)]=u+128;return Nc&&Nc.set(a,o),o}}};We.MACSTRING=function(n,e){var a=pb(e);if(a!==void 0){for(var s=[],l=0;l<n.length;l++){var o=n.charCodeAt(l);if(o>=128&&(o=a[o],o===void 0))return;s[l]=o}return s}};xt.MACSTRING=function(n,e){var a=We.MACSTRING(n,e);return a!==void 0?a.length:0};function td(n){return n>=-128&&n<=127}function hb(n,e,a){for(var s=0,l=n.length;e<l&&s<64&&n[e]===0;)++e,++s;return a.push(128|s-1),e}function mb(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(!td(u)||u===0&&o+1<l&&n[o+1]===0)break;++o,++s}a.push(s-1);for(var p=e;p<o;++p)a.push(n[p]+256&255);return o}function gb(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(u===0||td(u)&&o+1<l&&td(n[o+1]))break;++o,++s}a.push(64|s-1);for(var p=e;p<o;++p){var h=n[p];a.push(h+65536>>8&255,h+256&255)}return o}We.VARDELTAS=function(n){for(var e=0,a=[];e<n.length;){var s=n[e];s===0?e=hb(n,e,a):s>=-128&&s<=127?e=mb(n,e,a):e=gb(n,e,a)}return a};We.INDEX=function(n){for(var e=1,a=[e],s=[],l=0;l<n.length;l+=1){var o=We.OBJECT(n[l]);Array.prototype.push.apply(s,o),e+=o.length,a.push(e)}if(s.length===0)return[0,0];for(var u=[],p=1+Math.floor(Math.log(e)/Math.log(2))/8|0,h=[void 0,We.BYTE,We.USHORT,We.UINT24,We.ULONG][p],g=0;g<a.length;g+=1){var v=h(a[g]);Array.prototype.push.apply(u,v)}return Array.prototype.concat(We.Card16(n.length),We.OffSize(p),u,s)};xt.INDEX=function(n){return We.INDEX(n).length};We.DICT=function(n){for(var e=[],a=Object.keys(n),s=a.length,l=0;l<s;l+=1){var o=parseInt(a[l],0),u=n[o];e=e.concat(We.OPERAND(u.value,u.type)),e=e.concat(We.OPERATOR(o))}return e};xt.DICT=function(n){return We.DICT(n).length};We.OPERATOR=function(n){return n<1200?[n]:[12,n-1200]};We.OPERAND=function(n,e){var a=[];if(Array.isArray(e))for(var s=0;s<e.length;s+=1)vt.argument(n.length===e.length,"Not enough arguments given for type"+e),a=a.concat(We.OPERAND(n[s],e[s]));else if(e==="SID")a=a.concat(We.NUMBER(n));else if(e==="offset")a=a.concat(We.NUMBER32(n));else if(e==="number")a=a.concat(We.NUMBER(n));else if(e==="real")a=a.concat(We.REAL(n));else throw new Error("Unknown operand type "+e);return a};We.OP=We.BYTE;xt.OP=xt.BYTE;var Dc=typeof WeakMap=="function"&&new WeakMap;We.CHARSTRING=function(n){if(Dc){var e=Dc.get(n);if(e!==void 0)return e}for(var a=[],s=n.length,l=0;l<s;l+=1){var o=n[l];a=a.concat(We[o.type](o.value))}return Dc&&Dc.set(n,a),a};xt.CHARSTRING=function(n){return We.CHARSTRING(n).length};We.OBJECT=function(n){var e=We[n.type];return vt.argument(e!==void 0,"No encoding function for type "+n.type),e(n.value)};xt.OBJECT=function(n){var e=xt[n.type];return vt.argument(e!==void 0,"No sizeOf function for type "+n.type),e(n.value)};We.TABLE=function(n){for(var e=[],a=n.fields.length,s=[],l=[],o=0;o<a;o+=1){var u=n.fields[o],p=We[u.type];vt.argument(p!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var h=n[u.name];h===void 0&&(h=u.value);var g=p(h);u.type==="TABLE"?(l.push(e.length),e=e.concat([0,0]),s.push(g)):e=e.concat(g)}for(var v=0;v<s.length;v+=1){var S=l[v],x=e.length;vt.argument(x<65536,"Table "+n.tableName+" too big."),e[S]=x>>8,e[S+1]=x&255,e=e.concat(s[v])}return e};xt.TABLE=function(n){for(var e=0,a=n.fields.length,s=0;s<a;s+=1){var l=n.fields[s],o=xt[l.type];vt.argument(o!==void 0,"No sizeOf function for field type "+l.type+" ("+l.name+")");var u=n[l.name];u===void 0&&(u=l.value),e+=o(u),l.type==="TABLE"&&(e+=2)}return e};We.RECORD=We.TABLE;xt.RECORD=xt.TABLE;We.LITERAL=function(n){return n};xt.LITERAL=function(n){return n.length};function la(n,e,a){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var s=0;s<e.length;s+=1){var l=e[s];this[l.name]=l.value}if(this.tableName=n,this.fields=e,a)for(var o=Object.keys(a),u=0;u<o.length;u+=1){var p=o[u],h=a[p];this[p]!==void 0&&(this[p]=h)}}la.prototype.encode=function(){return We.TABLE(this)};la.prototype.sizeOf=function(){return xt.TABLE(this)};function So(n,e,a){a===void 0&&(a=e.length);var s=new Array(e.length+1);s[0]={name:n+"Count",type:"USHORT",value:a};for(var l=0;l<e.length;l++)s[l+1]={name:n+l,type:"USHORT",value:e[l]};return s}function nd(n,e,a){var s=e.length,l=new Array(s+1);l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l[o+1]={name:n+o,type:"TABLE",value:a(e[o],o)};return l}function wo(n,e,a){var s=e.length,l=[];l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l=l.concat(a(e[o],o));return l}function Fc(n){n.format===1?la.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(So("glyph",n.glyphs))):n.format===2?la.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(wo("rangeRecord",n.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):vt.assert(!1,"Coverage format must be 1 or 2.")}Fc.prototype=Object.create(la.prototype);Fc.prototype.constructor=Fc;function Uc(n){la.call(this,"scriptListTable",wo("scriptRecord",n,function(e,a){var s=e.script,l=s.defaultLangSys;return vt.assert(!!l,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+a,type:"TAG",value:e.tag},{name:"script"+a,type:"TABLE",value:new la("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new la("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(So("featureIndex",l.featureIndexes)))}].concat(wo("langSys",s.langSysRecords,function(o,u){var p=o.langSys;return[{name:"langSysTag"+u,type:"TAG",value:o.tag},{name:"langSys"+u,type:"TABLE",value:new la("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:p.reqFeatureIndex}].concat(So("featureIndex",p.featureIndexes)))}]})))}]}))}Uc.prototype=Object.create(la.prototype);Uc.prototype.constructor=Uc;function Pc(n){la.call(this,"featureListTable",wo("featureRecord",n,function(e,a){var s=e.feature;return[{name:"featureTag"+a,type:"TAG",value:e.tag},{name:"feature"+a,type:"TABLE",value:new la("featureTable",[{name:"featureParams",type:"USHORT",value:s.featureParams}].concat(So("lookupListIndex",s.lookupListIndexes)))}]}))}Pc.prototype=Object.create(la.prototype);Pc.prototype.constructor=Pc;function Bc(n,e){la.call(this,"lookupListTable",nd("lookup",n,function(a){var s=e[a.lookupType];return vt.assert(!!s,"Unable to write GSUB lookup type "+a.lookupType+" tables."),new la("lookupTable",[{name:"lookupType",type:"USHORT",value:a.lookupType},{name:"lookupFlag",type:"USHORT",value:a.lookupFlag}].concat(nd("subtable",a.subtables,s)))}))}Bc.prototype=Object.create(la.prototype);Bc.prototype.constructor=Bc;var et={Table:la,Record:la,Coverage:Fc,ScriptList:Uc,FeatureList:Pc,LookupList:Bc,ushortList:So,tableList:nd,recordList:wo};function am(n,e){return n.getUint8(e)}function zc(n,e){return n.getUint16(e,!1)}function yb(n,e){return n.getInt16(e,!1)}function yd(n,e){return n.getUint32(e,!1)}function yg(n,e){var a=n.getInt16(e,!1),s=n.getUint16(e+2,!1);return a+s/65535}function vb(n,e){for(var a="",s=e;s<e+4;s+=1)a+=String.fromCharCode(n.getInt8(s));return a}function bb(n,e,a){for(var s=0,l=0;l<a;l+=1)s<<=8,s+=n.getUint8(e+l);return s}function xb(n,e,a){for(var s=[],l=e;l<a;l+=1)s.push(n.getUint8(l));return s}function Sb(n){for(var e="",a=0;a<n.length;a+=1)e+=String.fromCharCode(n[a]);return e}var wb={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Ee(n,e){this.data=n,this.offset=e,this.relativeOffset=0}Ee.prototype.parseByte=function(){var n=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};Ee.prototype.parseChar=function(){var n=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};Ee.prototype.parseCard8=Ee.prototype.parseByte;Ee.prototype.parseUShort=function(){var n=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};Ee.prototype.parseCard16=Ee.prototype.parseUShort;Ee.prototype.parseSID=Ee.prototype.parseUShort;Ee.prototype.parseOffset16=Ee.prototype.parseUShort;Ee.prototype.parseShort=function(){var n=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};Ee.prototype.parseF2Dot14=function(){var n=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,n};Ee.prototype.parseULong=function(){var n=yd(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};Ee.prototype.parseOffset32=Ee.prototype.parseULong;Ee.prototype.parseFixed=function(){var n=yg(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};Ee.prototype.parseString=function(n){var e=this.data,a=this.offset+this.relativeOffset,s="";this.relativeOffset+=n;for(var l=0;l<n;l++)s+=String.fromCharCode(e.getUint8(a+l));return s};Ee.prototype.parseTag=function(){return this.parseString(4)};Ee.prototype.parseLongDateTime=function(){var n=yd(this.data,this.offset+this.relativeOffset+4);return n-=2082844800,this.relativeOffset+=8,n};Ee.prototype.parseVersion=function(n){var e=zc(this.data,this.offset+this.relativeOffset),a=zc(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,n===void 0&&(n=4096),e+a/n/10};Ee.prototype.skip=function(n,e){e===void 0&&(e=1),this.relativeOffset+=wb[n]*e};Ee.prototype.parseULongList=function(n){n===void 0&&(n=this.parseULong());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint32(s),s+=4;return this.relativeOffset+=n*4,e};Ee.prototype.parseOffset16List=Ee.prototype.parseUShortList=function(n){n===void 0&&(n=this.parseUShort());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint16(s),s+=2;return this.relativeOffset+=n*2,e};Ee.prototype.parseShortList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getInt16(s),s+=2;return this.relativeOffset+=n*2,e};Ee.prototype.parseByteList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint8(s++);return this.relativeOffset+=n,e};Ee.prototype.parseList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};Ee.prototype.parseList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};Ee.prototype.parseRecordList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var p=s[u],h=e[p];o[p]=h.call(this)}a[l]=o}return a};Ee.prototype.parseRecordList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var p=s[u],h=e[p];o[p]=h.call(this)}a[l]=o}return a};Ee.prototype.parseStruct=function(n){if(typeof n=="function")return n.call(this);for(var e=Object.keys(n),a={},s=0;s<e.length;s++){var l=e[s],o=n[l];a[l]=o.call(this)}return a};Ee.prototype.parseValueRecord=function(n){if(n===void 0&&(n=this.parseUShort()),n!==0){var e={};return n&1&&(e.xPlacement=this.parseShort()),n&2&&(e.yPlacement=this.parseShort()),n&4&&(e.xAdvance=this.parseShort()),n&8&&(e.yAdvance=this.parseShort()),n&16&&(e.xPlaDevice=void 0,this.parseShort()),n&32&&(e.yPlaDevice=void 0,this.parseShort()),n&64&&(e.xAdvDevice=void 0,this.parseShort()),n&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};Ee.prototype.parseValueRecordList=function(){for(var n=this.parseUShort(),e=this.parseUShort(),a=new Array(e),s=0;s<e;s++)a[s]=this.parseValueRecord(n);return a};Ee.prototype.parsePointer=function(n){var e=this.parseOffset16();if(e>0)return new Ee(this.data,this.offset+e).parseStruct(n)};Ee.prototype.parsePointer32=function(n){var e=this.parseOffset32();if(e>0)return new Ee(this.data,this.offset+e).parseStruct(n)};Ee.prototype.parseListOfLists=function(n){for(var e=this.parseOffset16List(),a=e.length,s=this.relativeOffset,l=new Array(a),o=0;o<a;o++){var u=e[o];if(u===0){l[o]=void 0;continue}if(this.relativeOffset=u,n){for(var p=this.parseOffset16List(),h=new Array(p.length),g=0;g<p.length;g++)this.relativeOffset=u+p[g],h[g]=n.call(this);l[o]=h}else l[o]=this.parseUShortList()}return this.relativeOffset=s,l};Ee.prototype.parseCoverage=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort(),a=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(a)};if(e===2){for(var s=new Array(a),l=0;l<a;l++)s[l]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:s}}throw new Error("0x"+n.toString(16)+": Coverage format must be 1 or 2.")};Ee.prototype.parseClassDef=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Ee.uShort,end:Ee.uShort,classId:Ee.uShort})};throw new Error("0x"+n.toString(16)+": ClassDef format must be 1 or 2.")};Ee.list=function(n,e){return function(){return this.parseList(n,e)}};Ee.list32=function(n,e){return function(){return this.parseList32(n,e)}};Ee.recordList=function(n,e){return function(){return this.parseRecordList(n,e)}};Ee.recordList32=function(n,e){return function(){return this.parseRecordList32(n,e)}};Ee.pointer=function(n){return function(){return this.parsePointer(n)}};Ee.pointer32=function(n){return function(){return this.parsePointer32(n)}};Ee.tag=Ee.prototype.parseTag;Ee.byte=Ee.prototype.parseByte;Ee.uShort=Ee.offset16=Ee.prototype.parseUShort;Ee.uShortList=Ee.prototype.parseUShortList;Ee.uLong=Ee.offset32=Ee.prototype.parseULong;Ee.uLongList=Ee.prototype.parseULongList;Ee.struct=Ee.prototype.parseStruct;Ee.coverage=Ee.prototype.parseCoverage;Ee.classDef=Ee.prototype.parseClassDef;var rm={reserved:Ee.uShort,reqFeatureIndex:Ee.uShort,featureIndexes:Ee.uShortList};Ee.prototype.parseScriptList=function(){return this.parsePointer(Ee.recordList({tag:Ee.tag,script:Ee.pointer({defaultLangSys:Ee.pointer(rm),langSysRecords:Ee.recordList({tag:Ee.tag,langSys:Ee.pointer(rm)})})}))||[]};Ee.prototype.parseFeatureList=function(){return this.parsePointer(Ee.recordList({tag:Ee.tag,feature:Ee.pointer({featureParams:Ee.offset16,lookupListIndexes:Ee.uShortList})}))||[]};Ee.prototype.parseLookupList=function(n){return this.parsePointer(Ee.list(Ee.pointer(function(){var e=this.parseUShort();vt.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var a=this.parseUShort(),s=a&16;return{lookupType:e,lookupFlag:a,subtables:this.parseList(Ee.pointer(n[e])),markFilteringSet:s?this.parseUShort():void 0}})))||[]};Ee.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var n=this.parseUShort(),e=this.parseUShort();vt.argument(n===1&&e<1,"GPOS/GSUB feature variations table unknown.");var a=this.parseRecordList32({conditionSetOffset:Ee.offset32,featureTableSubstitutionOffset:Ee.offset32});return a})||[]};var lt={getByte:am,getCard8:am,getUShort:zc,getCard16:zc,getShort:yb,getULong:yd,getFixed:yg,getTag:vb,getOffset:bb,getBytes:xb,bytesToString:Sb,Parser:Ee};function Eb(n,e){e.parseUShort(),n.length=e.parseULong(),n.language=e.parseULong();var a;n.groupCount=a=e.parseULong(),n.glyphIndexMap={};for(var s=0;s<a;s+=1)for(var l=e.parseULong(),o=e.parseULong(),u=e.parseULong(),p=l;p<=o;p+=1)n.glyphIndexMap[p]=u,u++}function Ab(n,e,a,s,l){n.length=e.parseUShort(),n.language=e.parseUShort();var o;n.segCount=o=e.parseUShort()>>1,e.skip("uShort",3),n.glyphIndexMap={};for(var u=new lt.Parser(a,s+l+14),p=new lt.Parser(a,s+l+16+o*2),h=new lt.Parser(a,s+l+16+o*4),g=new lt.Parser(a,s+l+16+o*6),v=s+l+16+o*8,S=0;S<o-1;S+=1)for(var x=void 0,b=u.parseUShort(),T=p.parseUShort(),M=h.parseShort(),R=g.parseUShort(),I=T;I<=b;I+=1)R!==0?(v=g.offset+g.relativeOffset-2,v+=R,v+=(I-T)*2,x=lt.getUShort(a,v),x!==0&&(x=x+M&65535)):x=I+M&65535,n.glyphIndexMap[I]=x}function Tb(n,e){var a={};a.version=lt.getUShort(n,e),vt.argument(a.version===0,"cmap table version should be 0."),a.numTables=lt.getUShort(n,e+2);for(var s=-1,l=a.numTables-1;l>=0;l-=1){var o=lt.getUShort(n,e+4+l*8),u=lt.getUShort(n,e+4+l*8+2);if(o===3&&(u===0||u===1||u===10)||o===0&&(u===0||u===1||u===2||u===3||u===4)){s=lt.getULong(n,e+4+l*8+4);break}}if(s===-1)throw new Error("No valid cmap sub-tables found.");var p=new lt.Parser(n,e+s);if(a.format=p.parseUShort(),a.format===12)Eb(a,p);else if(a.format===4)Ab(a,p,n,e,s);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+a.format+").");return a}function Cb(n,e,a){n.segments.push({end:e,start:e,delta:-(e-a),offset:0,glyphIndex:a})}function Mb(n){n.segments.push({end:65535,start:65535,delta:1,offset:0})}function kb(n){var e=!0,a;for(a=n.length-1;a>0;a-=1){var s=n.get(a);if(s.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var l=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(l=l.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),l=l.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new et.Table("cmap",l);for(o.segments=[],a=0;a<n.length;a+=1){for(var u=n.get(a),p=0;p<u.unicodes.length;p+=1)Cb(o,u.unicodes[p],a);o.segments=o.segments.sort(function(Q,A){return Q.start-A.start})}Mb(o);var h=o.segments.length,g=0,v=[],S=[],x=[],b=[],T=[],M=[];for(a=0;a<h;a+=1){var R=o.segments[a];R.end<=65535&&R.start<=65535?(v=v.concat({name:"end_"+a,type:"USHORT",value:R.end}),S=S.concat({name:"start_"+a,type:"USHORT",value:R.start}),x=x.concat({name:"idDelta_"+a,type:"SHORT",value:R.delta}),b=b.concat({name:"idRangeOffset_"+a,type:"USHORT",value:R.offset}),R.glyphId!==void 0&&(T=T.concat({name:"glyph_"+a,type:"USHORT",value:R.glyphId}))):g+=1,!e&&R.glyphIndex!==void 0&&(M=M.concat({name:"cmap12Start_"+a,type:"ULONG",value:R.start}),M=M.concat({name:"cmap12End_"+a,type:"ULONG",value:R.end}),M=M.concat({name:"cmap12Glyph_"+a,type:"ULONG",value:R.glyphIndex}))}if(o.segCountX2=(h-g)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(h-g)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(v),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(S),o.fields=o.fields.concat(x),o.fields=o.fields.concat(b),o.fields=o.fields.concat(T),o.cmap4Length=14+v.length*2+2+S.length*2+x.length*2+b.length*2+T.length*2,!e){var I=16+M.length*4;o.cmap12Offset=20+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:I},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:M.length/3}]),o.fields=o.fields.concat(M)}return o}var vg={parse:Tb,make:kb},Oc=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Nb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Rb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Oi=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function bg(n){this.font=n}bg.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.font.glyphs;if(a){for(var s=0;s<a.length;s+=1)for(var l=a.get(s),o=0;o<l.unicodes.length;o+=1)if(l.unicodes[o]===e)return s}return null};function xg(n){this.cmap=n}xg.prototype.charToGlyphIndex=function(n){return this.cmap.glyphIndexMap[n.codePointAt(0)]||0};function Gc(n,e){this.encoding=n,this.charset=e}Gc.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.encoding[e];return this.charset.indexOf(a)};function vd(n){switch(n.version){case 1:this.names=Oi.slice();break;case 2:this.names=new Array(n.numberOfGlyphs);for(var e=0;e<n.numberOfGlyphs;e++)n.glyphNameIndex[e]<Oi.length?this.names[e]=Oi[n.glyphNameIndex[e]]:this.names[e]=n.names[n.glyphNameIndex[e]-Oi.length];break;case 2.5:this.names=new Array(n.numberOfGlyphs);for(var a=0;a<n.numberOfGlyphs;a++)this.names[a]=Oi[a+n.glyphNameIndex[a]];break;case 3:this.names=[];break;default:this.names=[];break}}vd.prototype.nameToGlyphIndex=function(n){return this.names.indexOf(n)};vd.prototype.glyphIndexToName=function(n){return this.names[n]};function Db(n){for(var e,a=n.tables.cmap.glyphIndexMap,s=Object.keys(a),l=0;l<s.length;l+=1){var o=s[l],u=a[o];e=n.glyphs.get(u),e.addUnicode(parseInt(o))}for(var p=0;p<n.glyphs.length;p+=1)e=n.glyphs.get(p),n.cffEncoding?n.isCIDFont?e.name="gid"+p:e.name=n.cffEncoding.charset[p]:n.glyphNames.names&&(e.name=n.glyphNames.glyphIndexToName(p))}function Ib(n){n._IndexToUnicodeMap={};for(var e=n.tables.cmap.glyphIndexMap,a=Object.keys(e),s=0;s<a.length;s+=1){var l=a[s],o=e[l];n._IndexToUnicodeMap[o]===void 0?n._IndexToUnicodeMap[o]={unicodes:[parseInt(l)]}:n._IndexToUnicodeMap[o].unicodes.push(parseInt(l))}}function _b(n,e){e.lowMemory?Ib(n):Db(n)}function Ob(n,e,a,s,l){n.beginPath(),n.moveTo(e,a),n.lineTo(s,l),n.stroke()}var Ii={line:Ob};function Lb(n,e){var a=e||new qn;return{configurable:!0,get:function(){return typeof a=="function"&&(a=a()),a},set:function(s){a=s}}}function er(n){this.bindConstructorValues(n)}er.prototype.bindConstructorValues=function(n){this.index=n.index||0,this.name=n.name||null,this.unicode=n.unicode||void 0,this.unicodes=n.unicodes||n.unicode!==void 0?[n.unicode]:[],"xMin"in n&&(this.xMin=n.xMin),"yMin"in n&&(this.yMin=n.yMin),"xMax"in n&&(this.xMax=n.xMax),"yMax"in n&&(this.yMax=n.yMax),"advanceWidth"in n&&(this.advanceWidth=n.advanceWidth),Object.defineProperty(this,"path",Lb(this,n.path))};er.prototype.addUnicode=function(n){this.unicodes.length===0&&(this.unicode=n),this.unicodes.push(n)};er.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};er.prototype.getPath=function(n,e,a,s,l){n=n!==void 0?n:0,e=e!==void 0?e:0,a=a!==void 0?a:72;var o,u;s||(s={});var p=s.xScale,h=s.yScale;if(s.hinting&&l&&l.hinting&&(u=this.path&&l.hinting.exec(this,a)),u)o=l.hinting.getCommands(u),n=Math.round(n),e=Math.round(e),p=h=1;else{o=this.path.commands;var g=1/(this.path.unitsPerEm||1e3)*a;p===void 0&&(p=g),h===void 0&&(h=g)}for(var v=new qn,S=0;S<o.length;S+=1){var x=o[S];x.type==="M"?v.moveTo(n+x.x*p,e+-x.y*h):x.type==="L"?v.lineTo(n+x.x*p,e+-x.y*h):x.type==="Q"?v.quadraticCurveTo(n+x.x1*p,e+-x.y1*h,n+x.x*p,e+-x.y*h):x.type==="C"?v.curveTo(n+x.x1*p,e+-x.y1*h,n+x.x2*p,e+-x.y2*h,n+x.x*p,e+-x.y*h):x.type==="Z"&&v.closePath()}return v};er.prototype.getContours=function(){if(this.points===void 0)return[];for(var n=[],e=[],a=0;a<this.points.length;a+=1){var s=this.points[a];e.push(s),s.lastPointOfContour&&(n.push(e),e=[])}return vt.argument(e.length===0,"There are still points left in the current contour."),n};er.prototype.getMetrics=function(){for(var n=this.path.commands,e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];l.type!=="Z"&&(e.push(l.x),a.push(l.y)),(l.type==="Q"||l.type==="C")&&(e.push(l.x1),a.push(l.y1)),l.type==="C"&&(e.push(l.x2),a.push(l.y2))}var o={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,a),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o};er.prototype.draw=function(n,e,a,s,l){this.getPath(e,a,s,l).draw(n)};er.prototype.drawPoints=function(n,e,a,s){function l(S,x,b,T){n.beginPath();for(var M=0;M<S.length;M+=1)n.moveTo(x+S[M].x*T,b+S[M].y*T),n.arc(x+S[M].x*T,b+S[M].y*T,2,0,Math.PI*2,!1);n.closePath(),n.fill()}e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24;for(var o=1/this.path.unitsPerEm*s,u=[],p=[],h=this.path,g=0;g<h.commands.length;g+=1){var v=h.commands[g];v.x!==void 0&&u.push({x:v.x,y:-v.y}),v.x1!==void 0&&p.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&p.push({x:v.x2,y:-v.y2})}n.fillStyle="blue",l(u,e,a,o),n.fillStyle="red",l(p,e,a,o)};er.prototype.drawMetrics=function(n,e,a,s){var l;e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24,l=1/this.path.unitsPerEm*s,n.lineWidth=1,n.strokeStyle="black",Ii.line(n,e,-1e4,e,1e4),Ii.line(n,-1e4,a,1e4,a);var o=this.xMin||0,u=this.yMin||0,p=this.xMax||0,h=this.yMax||0,g=this.advanceWidth||0;n.strokeStyle="blue",Ii.line(n,e+o*l,-1e4,e+o*l,1e4),Ii.line(n,e+p*l,-1e4,e+p*l,1e4),Ii.line(n,-1e4,a+-u*l,1e4,a+-u*l),Ii.line(n,-1e4,a+-h*l,1e4,a+-h*l),n.strokeStyle="green",Ii.line(n,e+g*l,-1e4,e+g*l,1e4)};function Ic(n,e,a){Object.defineProperty(n,e,{get:function(){return n.path,n[a]},set:function(s){n[a]=s},enumerable:!0,configurable:!0})}function bd(n,e){if(this.font=n,this.glyphs={},Array.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];s.path.unitsPerEm=n.unitsPerEm,this.glyphs[a]=s}this.length=e&&e.length||0}bd.prototype.get=function(n){if(this.glyphs[n]===void 0){this.font._push(n),typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());var e=this.glyphs[n],a=this.font._IndexToUnicodeMap[n];if(a)for(var s=0;s<a.unicodes.length;s++)e.addUnicode(a.unicodes[s]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+n:e.name=this.font.cffEncoding.charset[n]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(n)),this.glyphs[n].advanceWidth=this.font._hmtxTableData[n].advanceWidth,this.glyphs[n].leftSideBearing=this.font._hmtxTableData[n].leftSideBearing}else typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());return this.glyphs[n]};bd.prototype.push=function(n,e){this.glyphs[n]=e,this.length++};function jb(n,e){return new er({index:e,font:n})}function Fb(n,e,a,s,l,o){return function(){var u=new er({index:e,font:n});return u.path=function(){a(u,s,l);var p=o(n.glyphs,u);return p.unitsPerEm=n.unitsPerEm,p},Ic(u,"xMin","_xMin"),Ic(u,"xMax","_xMax"),Ic(u,"yMin","_yMin"),Ic(u,"yMax","_yMax"),u}}function Ub(n,e,a,s){return function(){var l=new er({index:e,font:n});return l.path=function(){var o=a(n,l,s);return o.unitsPerEm=n.unitsPerEm,o},l}}var ls={GlyphSet:bd,glyphLoader:jb,ttfGlyphLoader:Fb,cffGlyphLoader:Ub};function Sg(n,e){if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var a=0;a<n.length;a+=1)if(!Sg(n[a],e[a]))return!1;return!0}else return!1}function ad(n){var e;return n.length<1240?e=107:n.length<33900?e=1131:e=32768,e}function ui(n,e,a){var s=[],l=[],o=lt.getCard16(n,e),u,p;if(o!==0){var h=lt.getByte(n,e+2);u=e+(o+1)*h+2;for(var g=e+3,v=0;v<o+1;v+=1)s.push(lt.getOffset(n,g,h)),g+=h;p=u+s[o]}else p=e+2;for(var S=0;S<s.length-1;S+=1){var x=lt.getBytes(n,u+s[S],u+s[S+1]);a&&(x=a(x)),l.push(x)}return{objects:l,startOffset:e,endOffset:p}}function Pb(n,e){var a=[],s=lt.getCard16(n,e),l,o;if(s!==0){var u=lt.getByte(n,e+2);l=e+(s+1)*u+2;for(var p=e+3,h=0;h<s+1;h+=1)a.push(lt.getOffset(n,p,u)),p+=u;o=l+a[s]}else o=e+2;return{offsets:a,startOffset:e,endOffset:o}}function Bb(n,e,a,s,l){var o=lt.getCard16(a,s),u=0;if(o!==0){var p=lt.getByte(a,s+2);u=s+(o+1)*p+2}var h=lt.getBytes(a,u+e[n],u+e[n+1]);return h}function zb(n){for(var e="",a=15,s=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var l=n.parseByte(),o=l>>4,u=l&15;if(o===a||(e+=s[o],u===a))break;e+=s[u]}return parseFloat(e)}function Gb(n,e){var a,s,l,o;if(e===28)return a=n.parseByte(),s=n.parseByte(),a<<8|s;if(e===29)return a=n.parseByte(),s=n.parseByte(),l=n.parseByte(),o=n.parseByte(),a<<24|s<<16|l<<8|o;if(e===30)return zb(n);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return a=n.parseByte(),(e-247)*256+a+108;if(e>=251&&e<=254)return a=n.parseByte(),-(e-251)*256-a-108;throw new Error("Invalid b0 "+e)}function Hb(n){for(var e={},a=0;a<n.length;a+=1){var s=n[a][0],l=n[a][1],o=void 0;if(l.length===1?o=l[0]:o=l,e.hasOwnProperty(s)&&!isNaN(e[s]))throw new Error("Object "+e+" already has key "+s);e[s]=o}return e}function wg(n,e,a){e=e!==void 0?e:0;var s=new lt.Parser(n,e),l=[],o=[];for(a=a!==void 0?a:n.length;s.relativeOffset<a;){var u=s.parseByte();u<=21?(u===12&&(u=1200+s.parseByte()),l.push([u,o]),o=[]):o.push(Gb(s,u))}return Hb(l)}function yo(n,e){return e<=390?e=Oc[e]:e=n[e-391],e}function Eg(n,e,a){for(var s={},l,o=0;o<e.length;o+=1){var u=e[o];if(Array.isArray(u.type)){var p=[];p.length=u.type.length;for(var h=0;h<u.type.length;h++)l=n[u.op]!==void 0?n[u.op][h]:void 0,l===void 0&&(l=u.value!==void 0&&u.value[h]!==void 0?u.value[h]:null),u.type[h]==="SID"&&(l=yo(a,l)),p[h]=l;s[u.name]=p}else l=n[u.op],l===void 0&&(l=u.value!==void 0?u.value:null),u.type==="SID"&&(l=yo(a,l)),s[u.name]=l}return s}function Yb(n,e){var a={};return a.formatMajor=lt.getCard8(n,e),a.formatMinor=lt.getCard8(n,e+1),a.size=lt.getCard8(n,e+2),a.offsetSize=lt.getCard8(n,e+3),a.startOffset=e,a.endOffset=e+4,a}var Ag=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Tg=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Vb(n,e){var a=wg(n,0,n.byteLength);return Eg(a,Ag,e)}function Cg(n,e,a,s){var l=wg(n,e,a);return Eg(l,Tg,s)}function sm(n,e,a,s){for(var l=[],o=0;o<a.length;o+=1){var u=new DataView(new Uint8Array(a[o]).buffer),p=Vb(u,s);p._subrs=[],p._subrsBias=0,p._defaultWidthX=0,p._nominalWidthX=0;var h=p.private[0],g=p.private[1];if(h!==0&&g!==0){var v=Cg(n,g+e,h,s);if(p._defaultWidthX=v.defaultWidthX,p._nominalWidthX=v.nominalWidthX,v.subrs!==0){var S=g+v.subrs,x=ui(n,S+e);p._subrs=x.objects,p._subrsBias=ad(p._subrs)}p._privateDict=v}l.push(p)}return l}function qb(n,e,a,s){var l,o,u=new lt.Parser(n,e);a-=1;var p=[".notdef"],h=u.parseCard8();if(h===0)for(var g=0;g<a;g+=1)l=u.parseSID(),p.push(yo(s,l));else if(h===1)for(;p.length<=a;){l=u.parseSID(),o=u.parseCard8();for(var v=0;v<=o;v+=1)p.push(yo(s,l)),l+=1}else if(h===2)for(;p.length<=a;){l=u.parseSID(),o=u.parseCard16();for(var S=0;S<=o;S+=1)p.push(yo(s,l)),l+=1}else throw new Error("Unknown charset format "+h);return p}function Xb(n,e,a){var s,l={},o=new lt.Parser(n,e),u=o.parseCard8();if(u===0)for(var p=o.parseCard8(),h=0;h<p;h+=1)s=o.parseCard8(),l[s]=h;else if(u===1){var g=o.parseCard8();s=1;for(var v=0;v<g;v+=1)for(var S=o.parseCard8(),x=o.parseCard8(),b=S;b<=S+x;b+=1)l[b]=s,s+=1}else throw new Error("Unknown encoding format "+u);return new Gc(l,a)}function im(n,e,a){var s,l,o,u,p=new qn,h=[],g=0,v=!1,S=!1,x=0,b=0,T,M,R,I;if(n.isCIDFont){var Q=n.tables.cff.topDict._fdSelect[e.index],A=n.tables.cff.topDict._fdArray[Q];T=A._subrs,M=A._subrsBias,R=A._defaultWidthX,I=A._nominalWidthX}else T=n.tables.cff.topDict._subrs,M=n.tables.cff.topDict._subrsBias,R=n.tables.cff.topDict._defaultWidthX,I=n.tables.cff.topDict._nominalWidthX;var _=R;function k(K,le){S&&p.closePath(),p.moveTo(K,le),S=!0}function G(){var K;K=h.length%2!==0,K&&!v&&(_=h.shift()+I),g+=h.length>>1,h.length=0,v=!0}function F(K){for(var le,H,N,V,U,q,ie,z,J,pe,me,X,$=0;$<K.length;){var he=K[$];switch($+=1,he){case 1:G();break;case 3:G();break;case 4:h.length>1&&!v&&(_=h.shift()+I,v=!0),b+=h.pop(),k(x,b);break;case 5:for(;h.length>0;)x+=h.shift(),b+=h.shift(),p.lineTo(x,b);break;case 6:for(;h.length>0&&(x+=h.shift(),p.lineTo(x,b),h.length!==0);)b+=h.shift(),p.lineTo(x,b);break;case 7:for(;h.length>0&&(b+=h.shift(),p.lineTo(x,b),h.length!==0);)x+=h.shift(),p.lineTo(x,b);break;case 8:for(;h.length>0;)s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u+h.shift(),p.curveTo(s,l,o,u,x,b);break;case 10:U=h.pop()+M,q=T[U],q&&F(q);break;case 11:return;case 12:switch(he=K[$],$+=1,he){case 35:s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),ie=o+h.shift(),z=u+h.shift(),J=ie+h.shift(),pe=z+h.shift(),me=J+h.shift(),X=pe+h.shift(),x=me+h.shift(),b=X+h.shift(),h.shift(),p.curveTo(s,l,o,u,ie,z),p.curveTo(J,pe,me,X,x,b);break;case 34:s=x+h.shift(),l=b,o=s+h.shift(),u=l+h.shift(),ie=o+h.shift(),z=u,J=ie+h.shift(),pe=u,me=J+h.shift(),X=b,x=me+h.shift(),p.curveTo(s,l,o,u,ie,z),p.curveTo(J,pe,me,X,x,b);break;case 36:s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),ie=o+h.shift(),z=u,J=ie+h.shift(),pe=u,me=J+h.shift(),X=pe+h.shift(),x=me+h.shift(),p.curveTo(s,l,o,u,ie,z),p.curveTo(J,pe,me,X,x,b);break;case 37:s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),ie=o+h.shift(),z=u+h.shift(),J=ie+h.shift(),pe=z+h.shift(),me=J+h.shift(),X=pe+h.shift(),Math.abs(me-x)>Math.abs(X-b)?x=me+h.shift():b=X+h.shift(),p.curveTo(s,l,o,u,ie,z),p.curveTo(J,pe,me,X,x,b);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+he),h.length=0}break;case 14:h.length>0&&!v&&(_=h.shift()+I,v=!0),S&&(p.closePath(),S=!1);break;case 18:G();break;case 19:case 20:G(),$+=g+7>>3;break;case 21:h.length>2&&!v&&(_=h.shift()+I,v=!0),b+=h.pop(),x+=h.pop(),k(x,b);break;case 22:h.length>1&&!v&&(_=h.shift()+I,v=!0),x+=h.pop(),k(x,b);break;case 23:G();break;case 24:for(;h.length>2;)s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u+h.shift(),p.curveTo(s,l,o,u,x,b);x+=h.shift(),b+=h.shift(),p.lineTo(x,b);break;case 25:for(;h.length>6;)x+=h.shift(),b+=h.shift(),p.lineTo(x,b);s=x+h.shift(),l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u+h.shift(),p.curveTo(s,l,o,u,x,b);break;case 26:for(h.length%2&&(x+=h.shift());h.length>0;)s=x,l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o,b=u+h.shift(),p.curveTo(s,l,o,u,x,b);break;case 27:for(h.length%2&&(b+=h.shift());h.length>0;)s=x+h.shift(),l=b,o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u,p.curveTo(s,l,o,u,x,b);break;case 28:le=K[$],H=K[$+1],h.push((le<<24|H<<16)>>16),$+=2;break;case 29:U=h.pop()+n.gsubrsBias,q=n.gsubrs[U],q&&F(q);break;case 30:for(;h.length>0&&(s=x,l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u+(h.length===1?h.shift():0),p.curveTo(s,l,o,u,x,b),h.length!==0);)s=x+h.shift(),l=b,o=s+h.shift(),u=l+h.shift(),b=u+h.shift(),x=o+(h.length===1?h.shift():0),p.curveTo(s,l,o,u,x,b);break;case 31:for(;h.length>0&&(s=x+h.shift(),l=b,o=s+h.shift(),u=l+h.shift(),b=u+h.shift(),x=o+(h.length===1?h.shift():0),p.curveTo(s,l,o,u,x,b),h.length!==0);)s=x,l=b+h.shift(),o=s+h.shift(),u=l+h.shift(),x=o+h.shift(),b=u+(h.length===1?h.shift():0),p.curveTo(s,l,o,u,x,b);break;default:he<32?console.log("Glyph "+e.index+": unknown operator "+he):he<247?h.push(he-139):he<251?(le=K[$],$+=1,h.push((he-247)*256+le+108)):he<255?(le=K[$],$+=1,h.push(-(he-251)*256-le-108)):(le=K[$],H=K[$+1],N=K[$+2],V=K[$+3],$+=4,h.push((le<<24|H<<16|N<<8|V)/65536))}}}return F(a),e.advanceWidth=_,p}function $b(n,e,a,s){var l=[],o,u=new lt.Parser(n,e),p=u.parseCard8();if(p===0)for(var h=0;h<a;h++){if(o=u.parseCard8(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");l.push(o)}else if(p===3){var g=u.parseCard16(),v=u.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var S,x=0;x<g;x++){if(o=u.parseCard8(),S=u.parseCard16(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");if(S>a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+S);for(;v<S;v++)l.push(o);v=S}if(S!==a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+S)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+p);return l}function Wb(n,e,a,s){a.tables.cff={};var l=Yb(n,e),o=ui(n,l.endOffset,lt.bytesToString),u=ui(n,o.endOffset),p=ui(n,u.endOffset,lt.bytesToString),h=ui(n,p.endOffset);a.gsubrs=h.objects,a.gsubrsBias=ad(a.gsubrs);var g=sm(n,e,u.objects,p.objects);if(g.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+g.length);var v=g[0];if(a.tables.cff.topDict=v,v._privateDict&&(a.defaultWidthX=v._privateDict.defaultWidthX,a.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(a.isCIDFont=!0),a.isCIDFont){var S=v.fdArray,x=v.fdSelect;if(S===0||x===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");S+=e;var b=ui(n,S),T=sm(n,e,b.objects,p.objects);v._fdArray=T,x+=e,v._fdSelect=$b(n,x,a.numGlyphs,T.length)}var M=e+v.private[1],R=Cg(n,M,v.private[0],p.objects);if(a.defaultWidthX=R.defaultWidthX,a.nominalWidthX=R.nominalWidthX,R.subrs!==0){var I=M+R.subrs,Q=ui(n,I);a.subrs=Q.objects,a.subrsBias=ad(a.subrs)}else a.subrs=[],a.subrsBias=0;var A;s.lowMemory?(A=Pb(n,e+v.charStrings),a.nGlyphs=A.offsets.length):(A=ui(n,e+v.charStrings),a.nGlyphs=A.objects.length);var _=qb(n,e+v.charset,a.nGlyphs,p.objects);if(v.encoding===0?a.cffEncoding=new Gc(Nb,_):v.encoding===1?a.cffEncoding=new Gc(Rb,_):a.cffEncoding=Xb(n,e+v.encoding,_),a.encoding=a.encoding||a.cffEncoding,a.glyphs=new ls.GlyphSet(a),s.lowMemory)a._push=function(F){var K=Bb(F,A.offsets,n,e+v.charStrings);a.glyphs.push(F,ls.cffGlyphLoader(a,F,im,K))};else for(var k=0;k<a.nGlyphs;k+=1){var G=A.objects[k];a.glyphs.push(k,ls.cffGlyphLoader(a,k,im,G))}}function Mg(n,e){var a,s=Oc.indexOf(n);return s>=0&&(a=s),s=e.indexOf(n),s>=0?a=s+Oc.length:(a=Oc.length+e.length,e.push(n)),a}function Zb(){return new et.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Qb(n){var e=new et.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var a=0;a<n.length;a+=1)e.names.push({name:"name_"+a,type:"NAME",value:n[a]});return e}function kg(n,e,a){for(var s={},l=0;l<n.length;l+=1){var o=n[l],u=e[o.name];u!==void 0&&!Sg(u,o.value)&&(o.type==="SID"&&(u=Mg(u,a)),s[o.op]={name:o.name,type:o.type,value:u})}return s}function lm(n,e){var a=new et.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=kg(Ag,n,e),a}function om(n){var e=new et.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:n}],e}function Kb(n){var e=new et.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var a=0;a<n.length;a+=1)e.strings.push({name:"string_"+a,type:"STRING",value:n[a]});return e}function Jb(){return new et.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function ex(n,e){for(var a=new et.Record("Charsets",[{name:"format",type:"Card8",value:0}]),s=0;s<n.length;s+=1){var l=n[s],o=Mg(l,e);a.fields.push({name:"glyph_"+s,type:"SID",value:o})}return a}function tx(n){var e=[],a=n.path;e.push({name:"width",type:"NUMBER",value:n.advanceWidth});for(var s=0,l=0,o=0;o<a.commands.length;o+=1){var u=void 0,p=void 0,h=a.commands[o];if(h.type==="Q"){var g=.3333333333333333,v=2/3;h={type:"C",x:h.x,y:h.y,x1:Math.round(g*s+v*h.x1),y1:Math.round(g*l+v*h.y1),x2:Math.round(g*h.x+v*h.x1),y2:Math.round(g*h.y+v*h.y1)}}if(h.type==="M")u=Math.round(h.x-s),p=Math.round(h.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:p}),e.push({name:"rmoveto",type:"OP",value:21}),s=Math.round(h.x),l=Math.round(h.y);else if(h.type==="L")u=Math.round(h.x-s),p=Math.round(h.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:p}),e.push({name:"rlineto",type:"OP",value:5}),s=Math.round(h.x),l=Math.round(h.y);else if(h.type==="C"){var S=Math.round(h.x1-s),x=Math.round(h.y1-l),b=Math.round(h.x2-h.x1),T=Math.round(h.y2-h.y1);u=Math.round(h.x-h.x2),p=Math.round(h.y-h.y2),e.push({name:"dx1",type:"NUMBER",value:S}),e.push({name:"dy1",type:"NUMBER",value:x}),e.push({name:"dx2",type:"NUMBER",value:b}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:p}),e.push({name:"rrcurveto",type:"OP",value:8}),s=Math.round(h.x),l=Math.round(h.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function nx(n){for(var e=new et.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),a=0;a<n.length;a+=1){var s=n.get(a),l=tx(s);e.charStrings.push({name:s.name,type:"CHARSTRING",value:l})}return e}function ax(n,e){var a=new et.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=kg(Tg,n,e),a}function rx(n,e){for(var a=new et.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),s=1/e.unitsPerEm,l={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[s,0,0,s,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},u=[],p,h=1;h<n.length;h+=1)p=n.get(h),u.push(p.name);var g=[];a.header=Zb(),a.nameIndex=Qb([e.postScriptName]);var v=lm(l,g);a.topDictIndex=om(v),a.globalSubrIndex=Jb(),a.charsets=ex(u,g),a.charStringsIndex=nx(n),a.privateDict=ax(o,g),a.stringIndex=Kb(g);var S=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return l.charset=S,l.encoding=0,l.charStrings=l.charset+a.charsets.sizeOf(),l.private[1]=l.charStrings+a.charStringsIndex.sizeOf(),v=lm(l,g),a.topDictIndex=om(v),a}var Ng={parse:Wb,make:rx};function sx(n,e){var a={},s=new lt.Parser(n,e);return a.version=s.parseVersion(),a.fontRevision=Math.round(s.parseFixed()*1e3)/1e3,a.checkSumAdjustment=s.parseULong(),a.magicNumber=s.parseULong(),vt.argument(a.magicNumber===1594834165,"Font header has wrong magic number."),a.flags=s.parseUShort(),a.unitsPerEm=s.parseUShort(),a.created=s.parseLongDateTime(),a.modified=s.parseLongDateTime(),a.xMin=s.parseShort(),a.yMin=s.parseShort(),a.xMax=s.parseShort(),a.yMax=s.parseShort(),a.macStyle=s.parseUShort(),a.lowestRecPPEM=s.parseUShort(),a.fontDirectionHint=s.parseShort(),a.indexToLocFormat=s.parseShort(),a.glyphDataFormat=s.parseShort(),a}function ix(n){var e=Math.round(new Date().getTime()/1e3)+2082844800,a=e;return n.createdTimestamp&&(a=n.createdTimestamp+2082844800),new et.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:a},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],n)}var Rg={parse:sx,make:ix};function lx(n,e){var a={},s=new lt.Parser(n,e);return a.version=s.parseVersion(),a.ascender=s.parseShort(),a.descender=s.parseShort(),a.lineGap=s.parseShort(),a.advanceWidthMax=s.parseUShort(),a.minLeftSideBearing=s.parseShort(),a.minRightSideBearing=s.parseShort(),a.xMaxExtent=s.parseShort(),a.caretSlopeRise=s.parseShort(),a.caretSlopeRun=s.parseShort(),a.caretOffset=s.parseShort(),s.relativeOffset+=8,a.metricDataFormat=s.parseShort(),a.numberOfHMetrics=s.parseUShort(),a}function ox(n){return new et.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],n)}var Dg={parse:lx,make:ox};function cx(n,e,a,s,l){for(var o,u,p=new lt.Parser(n,e),h=0;h<s;h+=1){h<a&&(o=p.parseUShort(),u=p.parseShort());var g=l.get(h);g.advanceWidth=o,g.leftSideBearing=u}}function ux(n,e,a,s,l){n._hmtxTableData={};for(var o,u,p=new lt.Parser(e,a),h=0;h<l;h+=1)h<s&&(o=p.parseUShort(),u=p.parseShort()),n._hmtxTableData[h]={advanceWidth:o,leftSideBearing:u}}function fx(n,e,a,s,l,o,u){u.lowMemory?ux(n,e,a,s,l):cx(e,a,s,l,o)}function dx(n){for(var e=new et.Table("hmtx",[]),a=0;a<n.length;a+=1){var s=n.get(a),l=s.advanceWidth||0,o=s.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+a,type:"USHORT",value:l}),e.fields.push({name:"leftSideBearing_"+a,type:"SHORT",value:o})}return e}var Ig={parse:fx,make:dx};function px(n){for(var e=new et.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:n.length}]),a="",s=12+n.length*4,l=0;l<n.length;++l){var o=a.indexOf(n[l]);o<0&&(o=a.length,a+=n[l]),e.fields.push({name:"offset "+l,type:"USHORT",value:s+o}),e.fields.push({name:"length "+l,type:"USHORT",value:n[l].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),e}function hx(n,e){var a=new lt.Parser(n,e),s=a.parseULong();vt.argument(s===1,"Unsupported ltag table version."),a.skip("uLong",1);for(var l=a.parseULong(),o=[],u=0;u<l;u++){for(var p="",h=e+a.parseUShort(),g=a.parseUShort(),v=h;v<h+g;++v)p+=String.fromCharCode(n.getInt8(v));o.push(p)}return o}var _g={make:px,parse:hx};function mx(n,e){var a={},s=new lt.Parser(n,e);return a.version=s.parseVersion(),a.numGlyphs=s.parseUShort(),a.version===1&&(a.maxPoints=s.parseUShort(),a.maxContours=s.parseUShort(),a.maxCompositePoints=s.parseUShort(),a.maxCompositeContours=s.parseUShort(),a.maxZones=s.parseUShort(),a.maxTwilightPoints=s.parseUShort(),a.maxStorage=s.parseUShort(),a.maxFunctionDefs=s.parseUShort(),a.maxInstructionDefs=s.parseUShort(),a.maxStackElements=s.parseUShort(),a.maxSizeOfInstructions=s.parseUShort(),a.maxComponentElements=s.parseUShort(),a.maxComponentDepth=s.parseUShort()),a}function gx(n){return new et.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:n}])}var Og={parse:mx,make:gx},Lg=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],jg={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},yx={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Fg={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function vx(n,e,a){switch(n){case 0:if(e===65535)return"und";if(a)return a[e];break;case 1:return jg[e];case 3:return Fg[e]}}var rd="utf-16",bx={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},xx={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Ug(n,e,a){switch(n){case 0:return rd;case 1:return xx[a]||bx[e];case 3:if(e===1||e===10)return rd;break}}function Sx(n,e,a){for(var s={},l=new lt.Parser(n,e),o=l.parseUShort(),u=l.parseUShort(),p=l.offset+l.parseUShort(),h=0;h<u;h++){var g=l.parseUShort(),v=l.parseUShort(),S=l.parseUShort(),x=l.parseUShort(),b=Lg[x]||x,T=l.parseUShort(),M=l.parseUShort(),R=vx(g,S,a),I=Ug(g,v,S);if(I!==void 0&&R!==void 0){var Q=void 0;if(I===rd?Q=Sl.UTF16(n,p+M,T):Q=Sl.MACSTRING(n,p+M,T,I),Q){var A=s[b];A===void 0&&(A=s[b]={}),A[R]=Q}}}return o===1&&l.parseUShort(),s}function Bf(n){var e={};for(var a in n)e[n[a]]=parseInt(a);return e}function cm(n,e,a,s,l,o){return new et.Record("NameRecord",[{name:"platformID",type:"USHORT",value:n},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:a},{name:"nameID",type:"USHORT",value:s},{name:"length",type:"USHORT",value:l},{name:"offset",type:"USHORT",value:o}])}function wx(n,e){var a=n.length,s=e.length-a+1;e:for(var l=0;l<s;l++)for(;l<s;l++){for(var o=0;o<a;o++)if(e[l+o]!==n[o])continue e;return l}return-1}function um(n,e){var a=wx(n,e);if(a<0){a=e.length;for(var s=0,l=n.length;s<l;++s)e.push(n[s])}return a}function Ex(n,e){var a,s=[],l={},o=Bf(Lg);for(var u in n){var p=o[u];if(p===void 0&&(p=u),a=parseInt(p),isNaN(a))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');l[a]=n[u],s.push(a)}for(var h=Bf(jg),g=Bf(Fg),v=[],S=[],x=0;x<s.length;x++){a=s[x];var b=l[a];for(var T in b){var M=b[T],R=1,I=h[T],Q=yx[I],A=Ug(R,Q,I),_=We.MACSTRING(M,A);_===void 0&&(R=0,I=e.indexOf(T),I<0&&(I=e.length,e.push(T)),Q=4,_=We.UTF16(M));var k=um(_,S);v.push(cm(R,Q,I,a,_.length,k));var G=g[T];if(G!==void 0){var F=We.UTF16(M),K=um(F,S);v.push(cm(3,1,G,a,F.length,K))}}}v.sort(function(N,V){return N.platformID-V.platformID||N.encodingID-V.encodingID||N.languageID-V.languageID||N.nameID-V.nameID});for(var le=new et.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),H=0;H<v.length;H++)le.fields.push({name:"record_"+H,type:"RECORD",value:v[H]});return le.fields.push({name:"strings",type:"LITERAL",value:S}),le}var Pg={parse:Sx,make:Ex},sd=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Ax(n){for(var e=0;e<sd.length;e+=1){var a=sd[e];if(n>=a.begin&&n<a.end)return e}return-1}function Tx(n,e){var a={},s=new lt.Parser(n,e);a.version=s.parseUShort(),a.xAvgCharWidth=s.parseShort(),a.usWeightClass=s.parseUShort(),a.usWidthClass=s.parseUShort(),a.fsType=s.parseUShort(),a.ySubscriptXSize=s.parseShort(),a.ySubscriptYSize=s.parseShort(),a.ySubscriptXOffset=s.parseShort(),a.ySubscriptYOffset=s.parseShort(),a.ySuperscriptXSize=s.parseShort(),a.ySuperscriptYSize=s.parseShort(),a.ySuperscriptXOffset=s.parseShort(),a.ySuperscriptYOffset=s.parseShort(),a.yStrikeoutSize=s.parseShort(),a.yStrikeoutPosition=s.parseShort(),a.sFamilyClass=s.parseShort(),a.panose=[];for(var l=0;l<10;l++)a.panose[l]=s.parseByte();return a.ulUnicodeRange1=s.parseULong(),a.ulUnicodeRange2=s.parseULong(),a.ulUnicodeRange3=s.parseULong(),a.ulUnicodeRange4=s.parseULong(),a.achVendID=String.fromCharCode(s.parseByte(),s.parseByte(),s.parseByte(),s.parseByte()),a.fsSelection=s.parseUShort(),a.usFirstCharIndex=s.parseUShort(),a.usLastCharIndex=s.parseUShort(),a.sTypoAscender=s.parseShort(),a.sTypoDescender=s.parseShort(),a.sTypoLineGap=s.parseShort(),a.usWinAscent=s.parseUShort(),a.usWinDescent=s.parseUShort(),a.version>=1&&(a.ulCodePageRange1=s.parseULong(),a.ulCodePageRange2=s.parseULong()),a.version>=2&&(a.sxHeight=s.parseShort(),a.sCapHeight=s.parseShort(),a.usDefaultChar=s.parseUShort(),a.usBreakChar=s.parseUShort(),a.usMaxContent=s.parseUShort()),a}function Cx(n){return new et.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],n)}var id={parse:Tx,make:Cx,unicodeRanges:sd,getUnicodeRange:Ax};function Mx(n,e){var a={},s=new lt.Parser(n,e);switch(a.version=s.parseVersion(),a.italicAngle=s.parseFixed(),a.underlinePosition=s.parseShort(),a.underlineThickness=s.parseShort(),a.isFixedPitch=s.parseULong(),a.minMemType42=s.parseULong(),a.maxMemType42=s.parseULong(),a.minMemType1=s.parseULong(),a.maxMemType1=s.parseULong(),a.version){case 1:a.names=Oi.slice();break;case 2:a.numberOfGlyphs=s.parseUShort(),a.glyphNameIndex=new Array(a.numberOfGlyphs);for(var l=0;l<a.numberOfGlyphs;l++)a.glyphNameIndex[l]=s.parseUShort();a.names=[];for(var o=0;o<a.numberOfGlyphs;o++)if(a.glyphNameIndex[o]>=Oi.length){var u=s.parseChar();a.names.push(s.parseString(u))}break;case 2.5:a.numberOfGlyphs=s.parseUShort(),a.offset=new Array(a.numberOfGlyphs);for(var p=0;p<a.numberOfGlyphs;p++)a.offset[p]=s.parseChar();break}return a}function kx(){return new et.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Bg={parse:Mx,make:kx},Ur=new Array(9);Ur[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(Ee.coverage),deltaGlyphId:this.parseUShort()};if(a===2)return{substFormat:2,coverage:this.parsePointer(Ee.coverage),substitute:this.parseOffset16List()};vt.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};Ur[2]=function(){var e=this.parseUShort();return vt.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ee.coverage),sequences:this.parseListOfLists()}};Ur[3]=function(){var e=this.parseUShort();return vt.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ee.coverage),alternateSets:this.parseListOfLists()}};Ur[4]=function(){var e=this.parseUShort();return vt.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ee.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var bl={sequenceIndex:Ee.uShort,lookupListIndex:Ee.uShort};Ur[5]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:a,coverage:this.parsePointer(Ee.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,bl)}})};if(a===2)return{substFormat:a,coverage:this.parsePointer(Ee.coverage),classDef:this.parsePointer(Ee.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,bl)}})};if(a===3){var s=this.parseUShort(),l=this.parseUShort();return{substFormat:a,coverages:this.parseList(s,Ee.pointer(Ee.coverage)),lookupRecords:this.parseRecordList(l,bl)}}vt.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Ur[6]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(Ee.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(bl)}})};if(a===2)return{substFormat:2,coverage:this.parsePointer(Ee.coverage),backtrackClassDef:this.parsePointer(Ee.classDef),inputClassDef:this.parsePointer(Ee.classDef),lookaheadClassDef:this.parsePointer(Ee.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(bl)}})};if(a===3)return{substFormat:3,backtrackCoverage:this.parseList(Ee.pointer(Ee.coverage)),inputCoverage:this.parseList(Ee.pointer(Ee.coverage)),lookaheadCoverage:this.parseList(Ee.pointer(Ee.coverage)),lookupRecords:this.parseRecordList(bl)};vt.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Ur[7]=function(){var e=this.parseUShort();vt.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var a=this.parseUShort(),s=new Ee(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:a,extension:Ur[a].call(s)}};Ur[8]=function(){var e=this.parseUShort();return vt.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ee.coverage),backtrackCoverage:this.parseList(Ee.pointer(Ee.coverage)),lookaheadCoverage:this.parseList(Ee.pointer(Ee.coverage)),substitutes:this.parseUShortList()}};function Nx(n,e){e=e||0;var a=new Ee(n,e),s=a.parseVersion(1);return vt.argument(s===1||s===1.1,"Unsupported GSUB table version."),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(Ur)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(Ur),variations:a.parseFeatureVariationsList()}}var wl=new Array(9);wl[1]=function(e){return e.substFormat===1?new et.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new et.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)}].concat(et.ushortList("substitute",e.substitute)))};wl[2]=function(e){return vt.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new et.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)}].concat(et.tableList("seqSet",e.sequences,function(a){return new et.Table("sequenceSetTable",et.ushortList("sequence",a))})))};wl[3]=function(e){return vt.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new et.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)}].concat(et.tableList("altSet",e.alternateSets,function(a){return new et.Table("alternateSetTable",et.ushortList("alternate",a))})))};wl[4]=function(e){return vt.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new et.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)}].concat(et.tableList("ligSet",e.ligatureSets,function(a){return new et.Table("ligatureSetTable",et.tableList("ligature",a,function(s){return new et.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:s.ligGlyph}].concat(et.ushortList("component",s.components,s.components.length+1)))}))})))};wl[6]=function(e){if(e.substFormat===1){var a=new et.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new et.Coverage(e.coverage)}].concat(et.tableList("chainRuleSet",e.chainRuleSets,function(o){return new et.Table("chainRuleSetTable",et.tableList("chainRule",o,function(u){var p=et.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(et.ushortList("inputGlyph",u.input,u.input.length+1)).concat(et.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(et.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(h,g){p=p.concat({name:"sequenceIndex"+g,type:"USHORT",value:h.sequenceIndex}).concat({name:"lookupListIndex"+g,type:"USHORT",value:h.lookupListIndex})}),new et.Table("chainRuleTable",p)}))})));return a}else if(e.substFormat===2)vt.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var s=[{name:"substFormat",type:"USHORT",value:e.substFormat}];s.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(o,u){s.push({name:"backtrackCoverage"+u,type:"TABLE",value:new et.Coverage(o)})}),s.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(o,u){s.push({name:"inputCoverage"+u,type:"TABLE",value:new et.Coverage(o)})}),s.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(o,u){s.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new et.Coverage(o)})}),s.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(o,u){s=s.concat({name:"sequenceIndex"+u,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:o.lookupListIndex})});var l=new et.Table("chainContextTable",s);return l}vt.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Rx(n){return new et.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new et.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new et.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new et.LookupList(n.lookups,wl)}])}var zg={parse:Nx,make:Rx};function Dx(n,e){var a=new lt.Parser(n,e),s=a.parseULong();vt.argument(s===1,"Unsupported META table version."),a.parseULong(),a.parseULong();for(var l=a.parseULong(),o={},u=0;u<l;u++){var p=a.parseTag(),h=a.parseULong(),g=a.parseULong(),v=Sl.UTF8(n,e+h,g);o[p]=v}return o}function Ix(n){var e=Object.keys(n).length,a="",s=16+e*12,l=new et.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:s},{name:"numTags",type:"ULONG",value:e}]);for(var o in n){var u=a.length;a+=n[o],l.fields.push({name:"tag "+o,type:"TAG",value:o}),l.fields.push({name:"offset "+o,type:"ULONG",value:s+u}),l.fields.push({name:"length "+o,type:"ULONG",value:n[o].length})}return l.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),l}var Gg={parse:Dx,make:Ix};function fm(n){return Math.log(n)/Math.log(2)|0}function xd(n){for(;n.length%4!==0;)n.push(0);for(var e=0,a=0;a<n.length;a+=4)e+=(n[a]<<24)+(n[a+1]<<16)+(n[a+2]<<8)+n[a+3];return e%=Math.pow(2,32),e}function dm(n,e,a,s){return new et.Record("Table Record",[{name:"tag",type:"TAG",value:n!==void 0?n:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:a!==void 0?a:0},{name:"length",type:"ULONG",value:s!==void 0?s:0}])}function Hg(n){var e=new et.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=n,e.numTables=n.length;var a=Math.pow(2,fm(e.numTables));e.searchRange=16*a,e.entrySelector=fm(a),e.rangeShift=e.numTables*16-e.searchRange;for(var s=[],l=[],o=e.sizeOf()+dm().sizeOf()*e.numTables;o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<n.length;u+=1){var p=n[u];vt.argument(p.tableName.length===4,"Table name"+p.tableName+" is invalid.");var h=p.sizeOf(),g=dm(p.tableName,xd(p.encode()),o,h);for(s.push({name:g.tag+" Table Record",type:"RECORD",value:g}),l.push({name:p.tableName+" table",type:"RECORD",value:p}),o+=h,vt.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(v,S){return v.value.tag>S.value.tag?1:-1}),e.fields=e.fields.concat(s),e.fields=e.fields.concat(l),e}function pm(n,e,a){for(var s=0;s<e.length;s+=1){var l=n.charToGlyphIndex(e[s]);if(l>0){var o=n.glyphs.get(l);return o.getMetrics()}}return a}function _x(n){for(var e=0,a=0;a<n.length;a+=1)e+=n[a];return e/n.length}function Ox(n){for(var e=[],a=[],s=[],l=[],o=[],u=[],p=[],h,g=0,v=0,S=0,x=0,b=0,T=0;T<n.glyphs.length;T+=1){var M=n.glyphs.get(T),R=M.unicode|0;if(isNaN(M.advanceWidth))throw new Error("Glyph "+M.name+" ("+T+"): advanceWidth is not a number.");(h>R||h===void 0)&&R>0&&(h=R),g<R&&(g=R);var I=id.getUnicodeRange(R);if(I<32)v|=1<<I;else if(I<64)S|=1<<I-32;else if(I<96)x|=1<<I-64;else if(I<123)b|=1<<I-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(M.name!==".notdef"){var Q=M.getMetrics();e.push(Q.xMin),a.push(Q.yMin),s.push(Q.xMax),l.push(Q.yMax),u.push(Q.leftSideBearing),p.push(Q.rightSideBearing),o.push(M.advanceWidth)}}var A={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,l),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:_x(o),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,p)};A.ascender=n.ascender,A.descender=n.descender;var _=Rg.make({flags:3,unitsPerEm:n.unitsPerEm,xMin:A.xMin,yMin:A.yMin,xMax:A.xMax,yMax:A.yMax,lowestRecPPEM:3,createdTimestamp:n.createdTimestamp}),k=Dg.make({ascender:A.ascender,descender:A.descender,advanceWidthMax:A.advanceWidthMax,minLeftSideBearing:A.minLeftSideBearing,minRightSideBearing:A.minRightSideBearing,xMaxExtent:A.maxLeftSideBearing+(A.xMax-A.xMin),numberOfHMetrics:n.glyphs.length}),G=Og.make(n.glyphs.length),F=id.make(Object.assign({xAvgCharWidth:Math.round(A.advanceWidthAvg),usFirstCharIndex:h,usLastCharIndex:g,ulUnicodeRange1:v,ulUnicodeRange2:S,ulUnicodeRange3:x,ulUnicodeRange4:b,sTypoAscender:A.ascender,sTypoDescender:A.descender,sTypoLineGap:0,usWinAscent:A.yMax,usWinDescent:Math.abs(A.yMin),ulCodePageRange1:1,sxHeight:pm(n,"xyvw",{yMax:Math.round(A.ascender/2)}).yMax,sCapHeight:pm(n,"HIKLEFJMNTZBDPRAGOQSUVWXY",A).yMax,usDefaultChar:n.hasChar(" ")?32:0,usBreakChar:n.hasChar(" ")?32:0},n.tables.os2)),K=Ig.make(n.glyphs),le=vg.make(n.glyphs),H=n.getEnglishName("fontFamily"),N=n.getEnglishName("fontSubfamily"),V=H+" "+N,U=n.getEnglishName("postScriptName");U||(U=H.replace(/\s/g,"")+"-"+N);var q={};for(var ie in n.names)q[ie]=n.names[ie];q.uniqueID||(q.uniqueID={en:n.getEnglishName("manufacturer")+":"+V}),q.postScriptName||(q.postScriptName={en:U}),q.preferredFamily||(q.preferredFamily=n.names.fontFamily),q.preferredSubfamily||(q.preferredSubfamily=n.names.fontSubfamily);var z=[],J=Pg.make(q,z),pe=z.length>0?_g.make(z):void 0,me=Bg.make(),X=Ng.make(n.glyphs,{version:n.getEnglishName("version"),fullName:V,familyName:H,weightName:N,postScriptName:U,unitsPerEm:n.unitsPerEm,fontBBox:[0,A.yMin,A.ascender,A.advanceWidthMax]}),$=n.metas&&Object.keys(n.metas).length>0?Gg.make(n.metas):void 0,he=[_,k,G,F,J,le,me,X,K];pe&&he.push(pe),n.tables.gsub&&he.push(zg.make(n.tables.gsub)),$&&he.push($);for(var Ce=Hg(he),Pe=Ce.encode(),Ke=xd(Pe),Xe=Ce.fields,wt=!1,dt=0;dt<Xe.length;dt+=1)if(Xe[dt].name==="head table"){Xe[dt].value.checkSumAdjustment=2981146554-Ke,wt=!0;break}if(!wt)throw new Error("Could not find head table with checkSum to adjust.");return Ce}var Lx={make:Hg,fontToTable:Ox,computeCheckSum:xd};function zf(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l].tag;if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function hm(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l];if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function mm(n,e){for(var a,s=0,l=n.length-1;s<=l;){var o=s+l>>>1;a=n[o];var u=a.start;if(u===e)return a;u<e?s=o+1:l=o-1}if(s>0)return a=n[s-1],e>a.end?0:a}function To(n,e){this.font=n,this.tableName=e}To.prototype={searchTag:zf,binSearch:hm,getTable:function(n){var e=this.font.tables[this.tableName];return!e&&n&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var n=this.getTable();return n?n.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var n=this.getTable();if(n){for(var e=!1,a=0;a<n.scripts.length;a++){var s=n.scripts[a].tag;if(s==="DFLT")return s;s==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(n,e){var a=this.getTable(e);if(a){n=n||"DFLT";var s=a.scripts,l=zf(a.scripts,n);if(l>=0)return s[l].script;if(e){var o={tag:n,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return s.splice(-1-l,0,o),o.script}}},getLangSysTable:function(n,e,a){var s=this.getScriptTable(n,a);if(s){if(!e||e==="dflt"||e==="DFLT")return s.defaultLangSys;var l=zf(s.langSysRecords,e);if(l>=0)return s.langSysRecords[l].langSys;if(a){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return s.langSysRecords.splice(-1-l,0,o),o.langSys}}},getFeatureTable:function(n,e,a,s){var l=this.getLangSysTable(n,e,s);if(l){for(var o,u=l.featureIndexes,p=this.font.tables[this.tableName].features,h=0;h<u.length;h++)if(o=p[u[h]],o.tag===a)return o.feature;if(s){var g=p.length;return vt.assert(g===0||a>=p[g-1].tag,"Features must be added in alphabetical order."),o={tag:a,feature:{params:0,lookupListIndexes:[]}},p.push(o),u.push(g),o.feature}}},getLookupTables:function(n,e,a,s,l){var o=this.getFeatureTable(n,e,a,l),u=[];if(o){for(var p,h=o.lookupListIndexes,g=this.font.tables[this.tableName].lookups,v=0;v<h.length;v++)p=g[h[v]],p.lookupType===s&&u.push(p);if(u.length===0&&l){p={lookupType:s,lookupFlag:0,subtables:[],markFilteringSet:void 0};var S=g.length;return g.push(p),h.push(S),[p]}}return u},getGlyphClass:function(n,e){switch(n.format){case 1:return n.startGlyph<=e&&e<n.startGlyph+n.classes.length?n.classes[e-n.startGlyph]:0;case 2:var a=mm(n.ranges,e);return a?a.classId:0}},getCoverageIndex:function(n,e){switch(n.format){case 1:var a=hm(n.glyphs,e);return a>=0?a:-1;case 2:var s=mm(n.ranges,e);return s?s.index+e-s.start:-1}},expandCoverage:function(n){if(n.format===1)return n.glyphs;for(var e=[],a=n.ranges,s=0;s<a.length;s++)for(var l=a[s],o=l.start,u=l.end,p=o;p<=u;p++)e.push(p);return e}};function Co(n){To.call(this,n,"gpos")}Co.prototype=To.prototype;Co.prototype.init=function(){var n=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(n)};Co.prototype.getKerningValue=function(n,e,a){for(var s=0;s<n.length;s++)for(var l=n[s].subtables,o=0;o<l.length;o++){var u=l[o],p=this.getCoverageIndex(u.coverage,e);if(!(p<0))switch(u.posFormat){case 1:for(var h=u.pairSets[p],g=0;g<h.length;g++){var v=h[g];if(v.secondGlyph===a)return v.value1&&v.value1.xAdvance||0}break;case 2:var S=this.getGlyphClass(u.classDef1,e),x=this.getGlyphClass(u.classDef2,a),b=u.classRecords[S][x];return b.value1&&b.value1.xAdvance||0}}return 0};Co.prototype.getKerningTables=function(n,e){if(this.font.tables.gpos)return this.getLookupTables(n,e,"kern",2)};function tr(n){To.call(this,n,"gsub")}function jx(n,e){var a=n.length;if(a!==e.length)return!1;for(var s=0;s<a;s++)if(n[s]!==e[s])return!1;return!0}function Sd(n,e,a){for(var s=n.subtables,l=0;l<s.length;l++){var o=s[l];if(o.substFormat===e)return o}if(a)return s.push(a),a}tr.prototype=To.prototype;tr.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};tr.prototype.getSingle=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,1),o=0;o<l.length;o++)for(var u=l[o].subtables,p=0;p<u.length;p++){var h=u[p],g=this.expandCoverage(h.coverage),v=void 0;if(h.substFormat===1){var S=h.deltaGlyphId;for(v=0;v<g.length;v++){var x=g[v];s.push({sub:x,by:x+S})}}else{var b=h.substitute;for(v=0;v<g.length;v++)s.push({sub:g[v],by:b[v]})}}return s};tr.prototype.getMultiple=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,2),o=0;o<l.length;o++)for(var u=l[o].subtables,p=0;p<u.length;p++){var h=u[p],g=this.expandCoverage(h.coverage),v=void 0;for(v=0;v<g.length;v++){var S=g[v],x=h.sequences[v];s.push({sub:S,by:x})}}return s};tr.prototype.getAlternates=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,3),o=0;o<l.length;o++)for(var u=l[o].subtables,p=0;p<u.length;p++)for(var h=u[p],g=this.expandCoverage(h.coverage),v=h.alternateSets,S=0;S<g.length;S++)s.push({sub:g[S],by:v[S]});return s};tr.prototype.getLigatures=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,4),o=0;o<l.length;o++)for(var u=l[o].subtables,p=0;p<u.length;p++)for(var h=u[p],g=this.expandCoverage(h.coverage),v=h.ligatureSets,S=0;S<g.length;S++)for(var x=g[S],b=v[S],T=0;T<b.length;T++){var M=b[T];s.push({sub:[x].concat(M.components),by:M.ligGlyph})}return s};tr.prototype.addSingle=function(n,e,a,s){var l=this.getLookupTables(a,s,n,1,!0)[0],o=Sd(l,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});vt.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var u=e.sub,p=this.binSearch(o.coverage.glyphs,u);p<0&&(p=-1-p,o.coverage.glyphs.splice(p,0,u),o.substitute.splice(p,0,0)),o.substitute[p]=e.by};tr.prototype.addMultiple=function(n,e,a,s){vt.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var l=this.getLookupTables(a,s,n,2,!0)[0],o=Sd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});vt.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var u=e.sub,p=this.binSearch(o.coverage.glyphs,u);p<0&&(p=-1-p,o.coverage.glyphs.splice(p,0,u),o.sequences.splice(p,0,0)),o.sequences[p]=e.by};tr.prototype.addAlternate=function(n,e,a,s){var l=this.getLookupTables(a,s,n,3,!0)[0],o=Sd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});vt.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var u=e.sub,p=this.binSearch(o.coverage.glyphs,u);p<0&&(p=-1-p,o.coverage.glyphs.splice(p,0,u),o.alternateSets.splice(p,0,0)),o.alternateSets[p]=e.by};tr.prototype.addLigature=function(n,e,a,s){var l=this.getLookupTables(a,s,n,4,!0)[0],o=l.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},l.subtables[0]=o),vt.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var u=e.sub[0],p=e.sub.slice(1),h={ligGlyph:e.by,components:p},g=this.binSearch(o.coverage.glyphs,u);if(g>=0){for(var v=o.ligatureSets[g],S=0;S<v.length;S++)if(jx(v[S].components,p))return;v.push(h)}else g=-1-g,o.coverage.glyphs.splice(g,0,u),o.ligatureSets.splice(g,0,[h])};tr.prototype.getFeature=function(n,e,a){if(/ss\d\d/.test(n))return this.getSingle(n,e,a);switch(n){case"aalt":case"salt":return this.getSingle(n,e,a).concat(this.getAlternates(n,e,a));case"dlig":case"liga":case"rlig":return this.getLigatures(n,e,a);case"ccmp":return this.getMultiple(n,e,a).concat(this.getLigatures(n,e,a));case"stch":return this.getMultiple(n,e,a)}};tr.prototype.add=function(n,e,a,s){if(/ss\d\d/.test(n))return this.addSingle(n,e,a,s);switch(n){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(n,e,a,s):this.addAlternate(n,e,a,s);case"dlig":case"liga":case"rlig":return this.addLigature(n,e,a,s);case"ccmp":return e.by instanceof Array?this.addMultiple(n,e,a,s):this.addLigature(n,e,a,s)}};function Fx(){return typeof window<"u"}function Yg(n){for(var e=new ArrayBuffer(n.length),a=new Uint8Array(e),s=0;s<n.length;++s)a[s]=n[s];return e}function Ux(n){for(var e=new Buffer(n.byteLength),a=new Uint8Array(n),s=0;s<e.length;++s)e[s]=a[s];return e}function mo(n,e){if(!n)throw e}function gm(n,e,a,s,l){var o;return(e&s)>0?(o=n.parseByte(),(e&l)===0&&(o=-o),o=a+o):(e&l)>0?o=a:o=a+n.parseShort(),o}function Vg(n,e,a){var s=new lt.Parser(e,a);n.numberOfContours=s.parseShort(),n._xMin=s.parseShort(),n._yMin=s.parseShort(),n._xMax=s.parseShort(),n._yMax=s.parseShort();var l,o;if(n.numberOfContours>0){for(var u=n.endPointIndices=[],p=0;p<n.numberOfContours;p+=1)u.push(s.parseUShort());n.instructionLength=s.parseUShort(),n.instructions=[];for(var h=0;h<n.instructionLength;h+=1)n.instructions.push(s.parseByte());var g=u[u.length-1]+1;l=[];for(var v=0;v<g;v+=1)if(o=s.parseByte(),l.push(o),(o&8)>0)for(var S=s.parseByte(),x=0;x<S;x+=1)l.push(o),v+=1;if(vt.argument(l.length===g,"Bad flags."),u.length>0){var b=[],T;if(g>0){for(var M=0;M<g;M+=1)o=l[M],T={},T.onCurve=!!(o&1),T.lastPointOfContour=u.indexOf(M)>=0,b.push(T);for(var R=0,I=0;I<g;I+=1)o=l[I],T=b[I],T.x=gm(s,o,R,2,16),R=T.x;for(var Q=0,A=0;A<g;A+=1)o=l[A],T=b[A],T.y=gm(s,o,Q,4,32),Q=T.y}n.points=b}else n.points=[]}else if(n.numberOfContours===0)n.points=[];else{n.isComposite=!0,n.points=[],n.components=[];for(var _=!0;_;){l=s.parseUShort();var k={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(l&1)>0?(l&2)>0?(k.dx=s.parseShort(),k.dy=s.parseShort()):k.matchedPoints=[s.parseUShort(),s.parseUShort()]:(l&2)>0?(k.dx=s.parseChar(),k.dy=s.parseChar()):k.matchedPoints=[s.parseByte(),s.parseByte()],(l&8)>0?k.xScale=k.yScale=s.parseF2Dot14():(l&64)>0?(k.xScale=s.parseF2Dot14(),k.yScale=s.parseF2Dot14()):(l&128)>0&&(k.xScale=s.parseF2Dot14(),k.scale01=s.parseF2Dot14(),k.scale10=s.parseF2Dot14(),k.yScale=s.parseF2Dot14()),n.components.push(k),_=!!(l&32)}if(l&256){n.instructionLength=s.parseUShort(),n.instructions=[];for(var G=0;G<n.instructionLength;G+=1)n.instructions.push(s.parseByte())}}}function Gf(n,e){for(var a=[],s=0;s<n.length;s+=1){var l=n[s],o={x:e.xScale*l.x+e.scale01*l.y+e.dx,y:e.scale10*l.x+e.yScale*l.y+e.dy,onCurve:l.onCurve,lastPointOfContour:l.lastPointOfContour};a.push(o)}return a}function Px(n){for(var e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];a.push(l),l.lastPointOfContour&&(e.push(a),a=[])}return vt.argument(a.length===0,"There are still points left in the current contour."),e}function qg(n){var e=new qn;if(!n)return e;for(var a=Px(n),s=0;s<a.length;++s){var l=a[s],o=null,u=l[l.length-1],p=l[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(p.onCurve)e.moveTo(p.x,p.y);else{var h={x:(u.x+p.x)*.5,y:(u.y+p.y)*.5};e.moveTo(h.x,h.y)}for(var g=0;g<l.length;++g)if(o=u,u=p,p=l[(g+1)%l.length],u.onCurve)e.lineTo(u.x,u.y);else{var v=p;o.onCurve||((u.x+o.x)*.5,(u.y+o.y)*.5),p.onCurve||(v={x:(u.x+p.x)*.5,y:(u.y+p.y)*.5}),e.quadraticCurveTo(u.x,u.y,v.x,v.y)}e.closePath()}return e}function Xg(n,e){if(e.isComposite)for(var a=0;a<e.components.length;a+=1){var s=e.components[a],l=n.get(s.glyphIndex);if(l.getPath(),l.points){var o=void 0;if(s.matchedPoints===void 0)o=Gf(l.points,s);else{if(s.matchedPoints[0]>e.points.length-1||s.matchedPoints[1]>l.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[s.matchedPoints[0]],p=l.points[s.matchedPoints[1]],h={xScale:s.xScale,scale01:s.scale01,scale10:s.scale10,yScale:s.yScale,dx:0,dy:0};p=Gf([p],h)[0],h.dx=u.x-p.x,h.dy=u.y-p.y,o=Gf(l.points,h)}e.points=e.points.concat(o)}}return qg(e.points)}function Bx(n,e,a,s){for(var l=new ls.GlyphSet(s),o=0;o<a.length-1;o+=1){var u=a[o],p=a[o+1];u!==p?l.push(o,ls.ttfGlyphLoader(s,o,Vg,n,e+u,Xg)):l.push(o,ls.glyphLoader(s,o))}return l}function zx(n,e,a,s){var l=new ls.GlyphSet(s);return s._push=function(o){var u=a[o],p=a[o+1];u!==p?l.push(o,ls.ttfGlyphLoader(s,o,Vg,n,e+u,Xg)):l.push(o,ls.glyphLoader(s,o))},l}function Gx(n,e,a,s,l){return l.lowMemory?zx(n,e,a,s):Bx(n,e,a,s)}var $g={getPath:qg,parse:Gx},Wg,Fi,Zg,ld;function Qg(n){this.font=n,this.getCommands=function(e){return $g.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Hx(n){return n}function Kg(n){return Math.sign(n)*Math.round(Math.abs(n))}function Yx(n){return Math.sign(n)*Math.round(Math.abs(n*2))/2}function Vx(n){return Math.sign(n)*(Math.round(Math.abs(n)+.5)-.5)}function qx(n){return Math.sign(n)*Math.ceil(Math.abs(n))}function Xx(n){return Math.sign(n)*Math.floor(Math.abs(n))}var Jg=function(n){var e=this.srPeriod,a=this.srPhase,s=this.srThreshold,l=1;return n<0&&(n=-n,l=-1),n+=s-a,n=Math.trunc(n/e)*e,n+=a,n<0?a*l:n*l},is={x:1,y:0,axis:"x",distance:function(n,e,a,s){return(a?n.xo:n.x)-(s?e.xo:e.x)},interpolate:function(n,e,a,s){var l,o,u,p,h,g,v;if(!s||s===this){if(l=n.xo-e.xo,o=n.xo-a.xo,h=e.x-e.xo,g=a.x-a.xo,u=Math.abs(l),p=Math.abs(o),v=u+p,v===0){n.x=n.xo+(h+g)/2;return}n.x=n.xo+(h*p+g*u)/v;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),h=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),p=Math.abs(o),v=u+p,v===0){is.setRelative(n,n,(h+g)/2,s,!0);return}is.setRelative(n,n,(h*p+g*u)/v,s,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(n,e,a,s,l){if(!s||s===this){n.x=(l?e.xo:e.x)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,p=o+a*s.x,h=u+a*s.y;n.x=p+(n.y-h)/s.normalSlope},slope:0,touch:function(n){n.xTouched=!0},touched:function(n){return n.xTouched},untouch:function(n){n.xTouched=!1}},Rs={x:0,y:1,axis:"y",distance:function(n,e,a,s){return(a?n.yo:n.y)-(s?e.yo:e.y)},interpolate:function(n,e,a,s){var l,o,u,p,h,g,v;if(!s||s===this){if(l=n.yo-e.yo,o=n.yo-a.yo,h=e.y-e.yo,g=a.y-a.yo,u=Math.abs(l),p=Math.abs(o),v=u+p,v===0){n.y=n.yo+(h+g)/2;return}n.y=n.yo+(h*p+g*u)/v;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),h=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),p=Math.abs(o),v=u+p,v===0){Rs.setRelative(n,n,(h+g)/2,s,!0);return}Rs.setRelative(n,n,(h*p+g*u)/v,s,!0)},normalSlope:0,setRelative:function(n,e,a,s,l){if(!s||s===this){n.y=(l?e.yo:e.y)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,p=o+a*s.x,h=u+a*s.y;n.y=h+s.normalSlope*(n.x-p)},slope:Number.POSITIVE_INFINITY,touch:function(n){n.yTouched=!0},touched:function(n){return n.yTouched},untouch:function(n){n.yTouched=!1}};Object.freeze(is);Object.freeze(Rs);function Mo(n,e){this.x=n,this.y=e,this.axis=void 0,this.slope=e/n,this.normalSlope=-n/e,Object.freeze(this)}Mo.prototype.distance=function(n,e,a,s){return this.x*is.distance(n,e,a,s)+this.y*Rs.distance(n,e,a,s)};Mo.prototype.interpolate=function(n,e,a,s){var l,o,u,p,h,g,v;if(u=s.distance(n,e,!0,!0),p=s.distance(n,a,!0,!0),l=s.distance(e,e,!1,!0),o=s.distance(a,a,!1,!0),h=Math.abs(u),g=Math.abs(p),v=h+g,v===0){this.setRelative(n,n,(l+o)/2,s,!0);return}this.setRelative(n,n,(l*g+o*h)/v,s,!0)};Mo.prototype.setRelative=function(n,e,a,s,l){s=s||this;var o=l?e.xo:e.x,u=l?e.yo:e.y,p=o+a*s.x,h=u+a*s.y,g=s.normalSlope,v=this.slope,S=n.x,x=n.y;n.x=(v*S-g*p+h-x)/(v-g),n.y=v*(n.x-S)+x};Mo.prototype.touch=function(n){n.xTouched=!0,n.yTouched=!0};function ko(n,e){var a=Math.sqrt(n*n+e*e);return n/=a,e/=a,n===1&&e===0?is:n===0&&e===1?Rs:new Mo(n,e)}function Ds(n,e,a,s){this.x=this.xo=Math.round(n*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=a,this.onCurve=s,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Ds.prototype.nextTouched=function(n){for(var e=this.nextPointOnContour;!n.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Ds.prototype.prevTouched=function(n){for(var e=this.prevPointOnContour;!n.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Eo=Object.freeze(new Ds(0,0)),$x={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function fi(n,e){switch(this.env=n,this.stack=[],this.prog=e,n){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=is,this.round=Kg}}Qg.prototype.exec=function(n,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var a=this.font,s=this._prepState;if(!s||s.ppem!==e){var l=this._fpgmState;if(!l){fi.prototype=$x,l=this._fpgmState=new fi("fpgm",a.tables.fpgm),l.funcs=[],l.font=a,exports.DEBUG&&(console.log("---EXEC FPGM---"),l.step=-1);try{Fi(l)}catch(g){console.log("Hinting error in FPGM:"+g),this._errorState=3;return}}fi.prototype=l,s=this._prepState=new fi("prep",a.tables.prep),s.ppem=e;var o=a.tables.cvt;if(o)for(var u=s.cvt=new Array(o.length),p=e/a.unitsPerEm,h=0;h<o.length;h++)u[h]=o[h]*p;else s.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),s.step=-1);try{Fi(s)}catch(g){this._errorState<2&&console.log("Hinting error in PREP:"+g),this._errorState=2}}if(!(this._errorState>1))try{return Zg(n,s)}catch(g){this._errorState<1&&(console.log("Hinting error:"+g),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Zg=function(n,e){var a=e.ppem/e.font.unitsPerEm,s=a,l=n.components,o,u,p;if(fi.prototype=e,!l)p=new fi("glyf",n.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),p.step=-1),ld(n,p,a,s),u=p.gZone;else{var h=e.font;u=[],o=[];for(var g=0;g<l.length;g++){var v=l[g],S=h.glyphs.get(v.glyphIndex);p=new fi("glyf",S.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+g+"---"),p.step=-1),ld(S,p,a,s);for(var x=Math.round(v.dx*a),b=Math.round(v.dy*s),T=p.gZone,M=p.contours,R=0;R<T.length;R++){var I=T[R];I.xTouched=I.yTouched=!1,I.xo=I.x=I.x+x,I.yo=I.y=I.y+b}var Q=u.length;u.push.apply(u,T);for(var A=0;A<M.length;A++)o.push(M[A]+Q)}n.instructions&&!p.inhibitGridFit&&(p=new fi("glyf",n.instructions),p.gZone=p.z0=p.z1=p.z2=u,p.contours=o,u.push(new Ds(0,0),new Ds(Math.round(n.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),p.step=-1),Fi(p),u.length-=2)}return u};ld=function(n,e,a,s){for(var l=n.points||[],o=l.length,u=e.gZone=e.z0=e.z1=e.z2=[],p=e.contours=[],h,g=0;g<o;g++)h=l[g],u[g]=new Ds(h.x*a,h.y*s,h.lastPointOfContour,h.onCurve);for(var v,S,x=0;x<o;x++)h=u[x],v||(v=h,p.push(x)),h.lastPointOfContour?(h.nextPointOnContour=v,v.prevPointOnContour=h,v=void 0):(S=u[x+1],h.nextPointOnContour=S,S.prevPointOnContour=h);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var b=0;b<o;b++)console.log(b,u[b].x,u[b].y)}if(u.push(new Ds(0,0),new Ds(Math.round(n.advanceWidth*a),0)),Fi(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<o;T++)console.log(T,u[T].x,u[T].y)}}};Fi=function(n){var e=n.prog;if(e){var a=e.length,s;for(n.ip=0;n.ip<a;n.ip++){if(exports.DEBUG&&n.step++,s=Wg[e[n.ip]],!s)throw new Error("unknown instruction: 0x"+Number(e[n.ip]).toString(16));s(n)}}};function Yc(n){for(var e=n.tZone=new Array(n.gZone.length),a=0;a<e.length;a++)e[a]=new Ds(0,0)}function ey(n,e){var a=n.prog,s=n.ip,l=1,o;do if(o=a[++s],o===88)l++;else if(o===89)l--;else if(o===64)s+=a[s+1]+1;else if(o===65)s+=2*a[s+1]+1;else if(o>=176&&o<=183)s+=o-176+1;else if(o>=184&&o<=191)s+=(o-184+1)*2;else if(e&&l===1&&o===27)break;while(l>0);n.ip=s}function ym(n,e){exports.DEBUG&&console.log(e.step,"SVTCA["+n.axis+"]"),e.fv=e.pv=e.dpv=n}function vm(n,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+n.axis+"]"),e.pv=e.dpv=n}function bm(n,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+n.axis+"]"),e.fv=n}function xm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SPVTL["+n+"]",s,l);var p,h;n?(p=o.y-u.y,h=u.x-o.x):(p=u.x-o.x,h=u.y-o.y),e.pv=e.dpv=ko(p,h)}function Sm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SFVTL["+n+"]",s,l);var p,h;n?(p=o.y-u.y,h=u.x-o.x):(p=u.x-o.x,h=u.y-o.y),e.fv=ko(p,h)}function Wx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.pv=n.dpv=ko(s,a)}function Zx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.fv=ko(s,a)}function Qx(n){var e=n.stack,a=n.pv;exports.DEBUG&&console.log(n.step,"GPV[]"),e.push(a.x*16384),e.push(a.y*16384)}function Kx(n){var e=n.stack,a=n.fv;exports.DEBUG&&console.log(n.step,"GFV[]"),e.push(a.x*16384),e.push(a.y*16384)}function Jx(n){n.fv=n.pv,exports.DEBUG&&console.log(n.step,"SFVTPV[]")}function eS(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop(),o=e.pop(),u=e.pop(),p=n.z0,h=n.z1,g=p[a],v=p[s],S=h[l],x=h[o],b=n.z2[u];exports.DEBUG&&console.log("ISECT[], ",a,s,l,o,u);var T=g.x,M=g.y,R=v.x,I=v.y,Q=S.x,A=S.y,_=x.x,k=x.y,G=(T-R)*(A-k)-(M-I)*(Q-_),F=T*I-M*R,K=Q*k-A*_;b.x=(F*(Q-_)-K*(T-R))/G,b.y=(F*(A-k)-K*(M-I))/G}function tS(n){n.rp0=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP0[]",n.rp0)}function nS(n){n.rp1=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP1[]",n.rp1)}function aS(n){n.rp2=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP2[]",n.rp2)}function rS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP0[]",e),n.zp0=e,e){case 0:n.tZone||Yc(n),n.z0=n.tZone;break;case 1:n.z0=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function sS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP1[]",e),n.zp1=e,e){case 0:n.tZone||Yc(n),n.z1=n.tZone;break;case 1:n.z1=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function iS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP2[]",e),n.zp2=e,e){case 0:n.tZone||Yc(n),n.z2=n.tZone;break;case 1:n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function lS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZPS[]",e),n.zp0=n.zp1=n.zp2=e,e){case 0:n.tZone||Yc(n),n.z0=n.z1=n.z2=n.tZone;break;case 1:n.z0=n.z1=n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function oS(n){n.loop=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SLOOP[]",n.loop)}function cS(n){exports.DEBUG&&console.log(n.step,"RTG[]"),n.round=Kg}function uS(n){exports.DEBUG&&console.log(n.step,"RTHG[]"),n.round=Vx}function fS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SMD[]",e),n.minDis=e/64}function dS(n){exports.DEBUG&&console.log(n.step,"ELSE[]"),ey(n,!1)}function pS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"JMPR[]",e),n.ip+=e-1}function hS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCVTCI[]",e),n.cvCutIn=e/64}function mS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DUP[]"),e.push(e[e.length-1])}function Hf(n){exports.DEBUG&&console.log(n.step,"POP[]"),n.stack.pop()}function gS(n){exports.DEBUG&&console.log(n.step,"CLEAR[]"),n.stack.length=0}function yS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SWAP[]"),e.push(a),e.push(s)}function vS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DEPTH[]"),e.push(e.length)}function bS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LOOPCALL[]",a,s);var l=n.ip,o=n.prog;n.prog=n.funcs[a];for(var u=0;u<s;u++)Fi(n),exports.DEBUG&&console.log(++n.step,u+1<s?"next loopcall":"done loopcall",u);n.ip=l,n.prog=o}function xS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"CALL[]",e);var a=n.ip,s=n.prog;n.prog=n.funcs[e],Fi(n),n.ip=a,n.prog=s,exports.DEBUG&&console.log(++n.step,"returning from",e)}function SS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CINDEX[]",a),e.push(e[e.length-a])}function wS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"MINDEX[]",a),e.push(e.splice(e.length-a,1)[0])}function ES(n){if(n.env!=="fpgm")throw new Error("FDEF not allowed here");var e=n.stack,a=n.prog,s=n.ip,l=e.pop(),o=s;for(exports.DEBUG&&console.log(n.step,"FDEF[]",l);a[++s]!==45;);n.ip=s,n.funcs[l]=a.slice(o+1,s)}function wm(n,e){var a=e.stack.pop(),s=e.z0[a],l=e.fv,o=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+n+"]",a);var u=o.distance(s,Eo);n&&(u=e.round(u)),l.setRelative(s,Eo,u,o),l.touch(s),e.rp0=e.rp1=a}function Em(n,e){var a=e.z2,s=a.length-2,l,o,u;exports.DEBUG&&console.log(e.step,"IUP["+n.axis+"]");for(var p=0;p<s;p++)l=a[p],!n.touched(l)&&(o=l.prevTouched(n),o!==l&&(u=l.nextTouched(n),o===u&&n.setRelative(l,l,n.distance(o,o,!1,!0),n,!0),n.interpolate(l,o,u,n)))}function Am(n,e){for(var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,p=e.loop,h=e.z2;p--;){var g=a.pop(),v=h[g],S=u.distance(l,l,!1,!0);o.setRelative(v,v,S,u),o.touch(v),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-p)+": ":"")+"SHP["+(n?"rp1":"rp2")+"]",g)}e.loop=1}function Tm(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,p=a.pop(),h=e.z2[e.contours[p]],g=h;exports.DEBUG&&console.log(e.step,"SHC["+n+"]",p);var v=u.distance(l,l,!1,!0);do g!==l&&o.setRelative(g,g,v,u),g=g.nextPointOnContour;while(g!==h)}function Cm(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,p=a.pop();exports.DEBUG&&console.log(e.step,"SHZ["+n+"]",p);var h;switch(p){case 0:h=e.tZone;break;case 1:h=e.gZone;break;default:throw new Error("Invalid zone")}for(var g,v=u.distance(l,l,!1,!0),S=h.length-2,x=0;x<S;x++)g=h[x],o.setRelative(g,g,v,u)}function AS(n){for(var e=n.stack,a=n.loop,s=n.fv,l=e.pop()/64,o=n.z2;a--;){var u=e.pop(),p=o[u];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-a)+": ":"")+"SHPIX[]",u,l),s.setRelative(p,p,l),s.touch(p)}n.loop=1}function TS(n){for(var e=n.stack,a=n.rp1,s=n.rp2,l=n.loop,o=n.z0[a],u=n.z1[s],p=n.fv,h=n.dpv,g=n.z2;l--;){var v=e.pop(),S=g[v];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"IP[]",v,a,"<->",s),p.interpolate(S,o,u,h),p.touch(S)}n.loop=1}function Mm(n,e){var a=e.stack,s=a.pop()/64,l=a.pop(),o=e.z1[l],u=e.z0[e.rp0],p=e.fv,h=e.pv;p.setRelative(o,u,s,h),p.touch(o),exports.DEBUG&&console.log(e.step,"MSIRP["+n+"]",s,l),e.rp1=e.rp0,e.rp2=l,n&&(e.rp0=l)}function CS(n){for(var e=n.stack,a=n.rp0,s=n.z0[a],l=n.loop,o=n.fv,u=n.pv,p=n.z1;l--;){var h=e.pop(),g=p[h];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"ALIGNRP[]",h),o.setRelative(g,s,0,u),o.touch(g)}n.loop=1}function MS(n){exports.DEBUG&&console.log(n.step,"RTDG[]"),n.round=Yx}function km(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z0[l],u=e.fv,p=e.pv,h=e.cvt[s];exports.DEBUG&&console.log(e.step,"MIAP["+n+"]",s,"(",h,")",l);var g=p.distance(o,Eo);n&&(Math.abs(g-h)<e.cvCutIn&&(g=h),g=e.round(g)),u.setRelative(o,Eo,g,p),e.zp0===0&&(o.xo=o.x,o.yo=o.y),u.touch(o),e.rp0=e.rp1=l}function kS(n){var e=n.prog,a=n.ip,s=n.stack,l=e[++a];exports.DEBUG&&console.log(n.step,"NPUSHB[]",l);for(var o=0;o<l;o++)s.push(e[++a]);n.ip=a}function NS(n){var e=n.ip,a=n.prog,s=n.stack,l=a[++e];exports.DEBUG&&console.log(n.step,"NPUSHW[]",l);for(var o=0;o<l;o++){var u=a[++e]<<8|a[++e];u&32768&&(u=-((u^65535)+1)),s.push(u)}n.ip=e}function RS(n){var e=n.stack,a=n.store;a||(a=n.store=[]);var s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"WS",s,l),a[l]=s}function DS(n){var e=n.stack,a=n.store,s=e.pop();exports.DEBUG&&console.log(n.step,"RS",s);var l=a&&a[s]||0;e.push(l)}function IS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTP",a,s),n.cvt[s]=a/64}function _S(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"RCVT",a),e.push(n.cvt[a]*64)}function Nm(n,e){var a=e.stack,s=a.pop(),l=e.z2[s];exports.DEBUG&&console.log(e.step,"GC["+n+"]",s),a.push(e.dpv.distance(l,Eo,n,!1)*64)}function Rm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z1[s],u=e.z0[l],p=e.dpv.distance(u,o,n,n);exports.DEBUG&&console.log(e.step,"MD["+n+"]",s,l,"->",p),e.stack.push(Math.round(p*64))}function OS(n){exports.DEBUG&&console.log(n.step,"MPPEM[]"),n.stack.push(n.ppem)}function LS(n){exports.DEBUG&&console.log(n.step,"FLIPON[]"),n.autoFlip=!0}function jS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LT[]",a,s),e.push(s<a?1:0)}function FS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LTEQ[]",a,s),e.push(s<=a?1:0)}function US(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GT[]",a,s),e.push(s>a?1:0)}function PS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GTEQ[]",a,s),e.push(s>=a?1:0)}function BS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"EQ[]",a,s),e.push(a===s?1:0)}function zS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"NEQ[]",a,s),e.push(a!==s?1:0)}function GS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ODD[]",a),e.push(Math.trunc(a)%2?1:0)}function HS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"EVEN[]",a),e.push(Math.trunc(a)%2?0:1)}function YS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"IF[]",e),e||(ey(n,!0),exports.DEBUG&&console.log(n.step,"EIF[]"))}function VS(n){exports.DEBUG&&console.log(n.step,"EIF[]")}function qS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"AND[]",a,s),e.push(a&&s?1:0)}function XS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"OR[]",a,s),e.push(a||s?1:0)}function $S(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NOT[]",a),e.push(a?0:1)}function Yf(n,e){var a=e.stack,s=a.pop(),l=e.fv,o=e.pv,u=e.ppem,p=e.deltaBase+(n-1)*16,h=e.deltaShift,g=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+n+"]",s,a);for(var v=0;v<s;v++){var S=a.pop(),x=a.pop(),b=p+((x&240)>>4);if(b===u){var T=(x&15)-8;T>=0&&T++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",S,"by",T*h);var M=g[S];l.setRelative(M,M,T*h,o)}}}function WS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDB[]",a),n.deltaBase=a}function ZS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDS[]",a),n.deltaShift=Math.pow(.5,a)}function QS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"ADD[]",a,s),e.push(s+a)}function KS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SUB[]",a,s),e.push(s-a)}function JS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"DIV[]",a,s),e.push(s*64/a)}function e2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MUL[]",a,s),e.push(s*a/64)}function t2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ABS[]",a),e.push(Math.abs(a))}function n2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NEG[]",a),e.push(-a)}function a2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"FLOOR[]",a),e.push(Math.floor(a/64)*64)}function r2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CEILING[]",a),e.push(Math.ceil(a/64)*64)}function _c(n,e){var a=e.stack,s=a.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),a.push(e.round(s/64)*64)}function s2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTF[]",a,s),n.cvt[s]=a*n.ppem/n.font.unitsPerEm}function Vf(n,e){var a=e.stack,s=a.pop(),l=e.ppem,o=e.deltaBase+(n-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+n+"]",s,a);for(var p=0;p<s;p++){var h=a.pop(),g=a.pop(),v=o+((g&240)>>4);if(v===l){var S=(g&15)-8;S>=0&&S++;var x=S*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",h,"by",x),e.cvt[h]+=x}}}function i2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SROUND[]",e),n.round=Jg;var a;switch(e&192){case 0:a=.5;break;case 64:a=1;break;case 128:a=2;break;default:throw new Error("invalid SROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function l2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"S45ROUND[]",e),n.round=Jg;var a;switch(e&192){case 0:a=Math.sqrt(2)/2;break;case 64:a=Math.sqrt(2);break;case 128:a=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function o2(n){exports.DEBUG&&console.log(n.step,"ROFF[]"),n.round=Hx}function c2(n){exports.DEBUG&&console.log(n.step,"RUTG[]"),n.round=qx}function u2(n){exports.DEBUG&&console.log(n.step,"RDTG[]"),n.round=Xx}function f2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANCTRL[]",e)}function Dm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log(e.step,"SDPVTL["+n+"]",s,l);var p,h;n?(p=o.y-u.y,h=u.x-o.x):(p=u.x-o.x,h=u.y-o.y),e.dpv=ko(p,h)}function d2(n){var e=n.stack,a=e.pop(),s=0;exports.DEBUG&&console.log(n.step,"GETINFO[]",a),a&1&&(s=35),a&32&&(s|=4096),e.push(s)}function p2(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"ROLL[]"),e.push(s),e.push(a),e.push(l)}function h2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MAX[]",a,s),e.push(Math.max(s,a))}function m2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MIN[]",a,s),e.push(Math.min(s,a))}function g2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANTYPE[]",e)}function y2(n){var e=n.stack.pop(),a=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"INSTCTRL[]",e,a),e){case 1:n.inhibitGridFit=!!a;return;case 2:n.ignoreCvt=!!a;return;default:throw new Error("invalid INSTCTRL[] selector")}}function oi(n,e){var a=e.stack,s=e.prog,l=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+n+"]");for(var o=0;o<n;o++)a.push(s[++l]);e.ip=l}function ci(n,e){var a=e.ip,s=e.prog,l=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+n+"]");for(var o=0;o<n;o++){var u=s[++a]<<8|s[++a];u&32768&&(u=-((u^65535)+1)),l.push(u)}e.ip=a}function it(n,e,a,s,l,o){var u=o.stack,p=n&&u.pop(),h=u.pop(),g=o.rp0,v=o.z0[g],S=o.z1[h],x=o.minDis,b=o.fv,T=o.dpv,M,R,I,Q;R=M=T.distance(S,v,!0,!0),I=R>=0?1:-1,R=Math.abs(R),n&&(Q=o.cvt[p],s&&Math.abs(R-Q)<o.cvCutIn&&(R=Q)),a&&R<x&&(R=x),s&&(R=o.round(R)),b.setRelative(S,v,I*R,T),b.touch(S),exports.DEBUG&&console.log(o.step,(n?"MIRP[":"MDRP[")+(e?"M":"m")+(a?">":"_")+(s?"R":"_")+(l===0?"Gr":l===1?"Bl":l===2?"Wh":"")+"]",n?p+"("+o.cvt[p]+","+Q+")":"",h,"(d =",M,"->",I*R,")"),o.rp1=o.rp0,o.rp2=h,e&&(o.rp0=h)}Wg=[ym.bind(void 0,Rs),ym.bind(void 0,is),vm.bind(void 0,Rs),vm.bind(void 0,is),bm.bind(void 0,Rs),bm.bind(void 0,is),xm.bind(void 0,0),xm.bind(void 0,1),Sm.bind(void 0,0),Sm.bind(void 0,1),Wx,Zx,Qx,Kx,Jx,eS,tS,nS,aS,rS,sS,iS,lS,oS,cS,uS,fS,dS,pS,hS,void 0,void 0,mS,Hf,gS,yS,vS,SS,wS,void 0,void 0,void 0,bS,xS,ES,void 0,wm.bind(void 0,0),wm.bind(void 0,1),Em.bind(void 0,Rs),Em.bind(void 0,is),Am.bind(void 0,0),Am.bind(void 0,1),Tm.bind(void 0,0),Tm.bind(void 0,1),Cm.bind(void 0,0),Cm.bind(void 0,1),AS,TS,Mm.bind(void 0,0),Mm.bind(void 0,1),CS,MS,km.bind(void 0,0),km.bind(void 0,1),kS,NS,RS,DS,IS,_S,Nm.bind(void 0,0),Nm.bind(void 0,1),void 0,Rm.bind(void 0,0),Rm.bind(void 0,1),OS,void 0,LS,void 0,void 0,jS,FS,US,PS,BS,zS,GS,HS,YS,VS,qS,XS,$S,Yf.bind(void 0,1),WS,ZS,QS,KS,JS,e2,t2,n2,a2,r2,_c.bind(void 0,0),_c.bind(void 0,1),_c.bind(void 0,2),_c.bind(void 0,3),void 0,void 0,void 0,void 0,s2,Yf.bind(void 0,2),Yf.bind(void 0,3),Vf.bind(void 0,1),Vf.bind(void 0,2),Vf.bind(void 0,3),i2,l2,void 0,void 0,o2,void 0,c2,u2,Hf,Hf,void 0,void 0,void 0,void 0,void 0,f2,Dm.bind(void 0,0),Dm.bind(void 0,1),d2,void 0,p2,h2,m2,g2,y2,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,oi.bind(void 0,1),oi.bind(void 0,2),oi.bind(void 0,3),oi.bind(void 0,4),oi.bind(void 0,5),oi.bind(void 0,6),oi.bind(void 0,7),oi.bind(void 0,8),ci.bind(void 0,1),ci.bind(void 0,2),ci.bind(void 0,3),ci.bind(void 0,4),ci.bind(void 0,5),ci.bind(void 0,6),ci.bind(void 0,7),ci.bind(void 0,8),it.bind(void 0,0,0,0,0,0),it.bind(void 0,0,0,0,0,1),it.bind(void 0,0,0,0,0,2),it.bind(void 0,0,0,0,0,3),it.bind(void 0,0,0,0,1,0),it.bind(void 0,0,0,0,1,1),it.bind(void 0,0,0,0,1,2),it.bind(void 0,0,0,0,1,3),it.bind(void 0,0,0,1,0,0),it.bind(void 0,0,0,1,0,1),it.bind(void 0,0,0,1,0,2),it.bind(void 0,0,0,1,0,3),it.bind(void 0,0,0,1,1,0),it.bind(void 0,0,0,1,1,1),it.bind(void 0,0,0,1,1,2),it.bind(void 0,0,0,1,1,3),it.bind(void 0,0,1,0,0,0),it.bind(void 0,0,1,0,0,1),it.bind(void 0,0,1,0,0,2),it.bind(void 0,0,1,0,0,3),it.bind(void 0,0,1,0,1,0),it.bind(void 0,0,1,0,1,1),it.bind(void 0,0,1,0,1,2),it.bind(void 0,0,1,0,1,3),it.bind(void 0,0,1,1,0,0),it.bind(void 0,0,1,1,0,1),it.bind(void 0,0,1,1,0,2),it.bind(void 0,0,1,1,0,3),it.bind(void 0,0,1,1,1,0),it.bind(void 0,0,1,1,1,1),it.bind(void 0,0,1,1,1,2),it.bind(void 0,0,1,1,1,3),it.bind(void 0,1,0,0,0,0),it.bind(void 0,1,0,0,0,1),it.bind(void 0,1,0,0,0,2),it.bind(void 0,1,0,0,0,3),it.bind(void 0,1,0,0,1,0),it.bind(void 0,1,0,0,1,1),it.bind(void 0,1,0,0,1,2),it.bind(void 0,1,0,0,1,3),it.bind(void 0,1,0,1,0,0),it.bind(void 0,1,0,1,0,1),it.bind(void 0,1,0,1,0,2),it.bind(void 0,1,0,1,0,3),it.bind(void 0,1,0,1,1,0),it.bind(void 0,1,0,1,1,1),it.bind(void 0,1,0,1,1,2),it.bind(void 0,1,0,1,1,3),it.bind(void 0,1,1,0,0,0),it.bind(void 0,1,1,0,0,1),it.bind(void 0,1,1,0,0,2),it.bind(void 0,1,1,0,0,3),it.bind(void 0,1,1,0,1,0),it.bind(void 0,1,1,0,1,1),it.bind(void 0,1,1,0,1,2),it.bind(void 0,1,1,0,1,3),it.bind(void 0,1,1,1,0,0),it.bind(void 0,1,1,1,0,1),it.bind(void 0,1,1,1,0,2),it.bind(void 0,1,1,1,0,3),it.bind(void 0,1,1,1,1,0),it.bind(void 0,1,1,1,1,1),it.bind(void 0,1,1,1,1,2),it.bind(void 0,1,1,1,1,3)];function El(n){this.char=n,this.state={},this.activeState=null}function wd(n,e,a){this.contextName=a,this.startIndex=n,this.endOffset=e}function v2(n,e,a){this.contextName=n,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=a}function Pr(n,e){this.context=n,this.index=e,this.length=n.length,this.current=n[e],this.backtrack=n.slice(0,e),this.lookahead=n.slice(e+1)}function Vc(n){this.eventId=n,this.subscribers=[]}function b2(n){var e=this,a=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];a.forEach(function(l){Object.defineProperty(e.events,l,{value:new Vc(l)})}),n&&a.forEach(function(l){var o=n[l];typeof o=="function"&&e.events[l].subscribe(o)});var s=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];s.forEach(function(l){e.events[l].subscribe(e.updateContextsRanges)})}function _n(n){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],b2.call(this,n)}El.prototype.setState=function(n,e){return this.state[n]=e,this.activeState={key:n,value:this.state[n]},this.activeState};El.prototype.getState=function(n){return this.state[n]||null};_n.prototype.inboundIndex=function(n){return n>=0&&n<this.tokens.length};_n.prototype.composeRUD=function(n){var e=this,a=!0,s=n.map(function(o){return e[o[0]].apply(e,o.slice(1).concat(a))}),l=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(s.every(l))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:s.filter(l)};this.dispatch("composeRUD",[s.filter(function(o){return!l(o)})])};_n.prototype.replaceRange=function(n,e,a,s){e=e!==null?e:this.tokens.length;var l=a.every(function(u){return u instanceof El});if(!isNaN(n)&&this.inboundIndex(n)&&l){var o=this.tokens.splice.apply(this.tokens,[n,e].concat(a));return s||this.dispatch("replaceToken",[n,e,a]),[o,a]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};_n.prototype.replaceToken=function(n,e,a){if(!isNaN(n)&&this.inboundIndex(n)&&e instanceof El){var s=this.tokens.splice(n,1,e);return a||this.dispatch("replaceToken",[n,e]),[s[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};_n.prototype.removeRange=function(n,e,a){e=isNaN(e)?this.tokens.length:e;var s=this.tokens.splice(n,e);return a||this.dispatch("removeRange",[s,n,e]),s};_n.prototype.removeToken=function(n,e){if(!isNaN(n)&&this.inboundIndex(n)){var a=this.tokens.splice(n,1);return e||this.dispatch("removeToken",[a,n]),a}else return{FAIL:"removeToken: invalid token index."}};_n.prototype.insertToken=function(n,e,a){var s=n.every(function(l){return l instanceof El});return s?(this.tokens.splice.apply(this.tokens,[e,0].concat(n)),a||this.dispatch("insertToken",[n,e]),n):{FAIL:"insertToken: invalid token(s)."}};_n.prototype.registerModifier=function(n,e,a){this.events.newToken.subscribe(function(s,l){var o=[s,l],u=e===null||e.apply(this,o)===!0,p=[s,l];if(u){var h=a.apply(this,p);s.setState(n,h)}}),this.registeredModifiers.push(n)};Vc.prototype.subscribe=function(n){return typeof n=="function"?this.subscribers.push(n)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Vc.prototype.unsubscribe=function(n){this.subscribers.splice(n,1)};Pr.prototype.setCurrentIndex=function(n){this.index=n,this.current=this.context[n],this.backtrack=this.context.slice(0,n),this.lookahead=this.context.slice(n+1)};Pr.prototype.get=function(n){switch(!0){case n===0:return this.current;case(n<0&&Math.abs(n)<=this.backtrack.length):return this.backtrack.slice(n)[0];case(n>0&&n<=this.lookahead.length):return this.lookahead[n-1];default:return null}};_n.prototype.rangeToText=function(n){if(n instanceof wd)return this.getRangeTokens(n).map(function(e){return e.char}).join("")};_n.prototype.getText=function(){return this.tokens.map(function(n){return n.char}).join("")};_n.prototype.getContext=function(n){var e=this.registeredContexts[n];return e||null};_n.prototype.on=function(n,e){var a=this.events[n];return a?a.subscribe(e):null};_n.prototype.dispatch=function(n,e){var a=this,s=this.events[n];s instanceof Vc&&s.subscribers.forEach(function(l){l.apply(a,e||[])})};_n.prototype.registerContextChecker=function(n,e,a){if(this.getContext(n))return{FAIL:"context name '"+n+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof a!="function")return{FAIL:"missing context end check."};var s=new v2(n,e,a);return this.registeredContexts[n]=s,this.contextCheckers.push(s),s};_n.prototype.getRangeTokens=function(n){var e=n.startIndex+n.endOffset;return[].concat(this.tokens.slice(n.startIndex,e))};_n.prototype.getContextRanges=function(n){var e=this.getContext(n);return e?e.ranges:{FAIL:"context checker '"+n+"' is not registered."}};_n.prototype.resetContextsRanges=function(){var n=this.registeredContexts;for(var e in n)if(n.hasOwnProperty(e)){var a=n[e];a.ranges=[]}};_n.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var n=this.tokens.map(function(s){return s.char}),e=0;e<n.length;e++){var a=new Pr(n,e);this.runContextCheck(a)}this.dispatch("updateContextsRanges",[this.registeredContexts])};_n.prototype.setEndOffset=function(n,e){var a=this.getContext(e).openRange.startIndex,s=new wd(a,n,e),l=this.getContext(e).ranges;return s.rangeId=e+"."+l.length,l.push(s),this.getContext(e).openRange=null,s};_n.prototype.runContextCheck=function(n){var e=this,a=n.index;this.contextCheckers.forEach(function(s){var l=s.contextName,o=e.getContext(l).openRange;if(!o&&s.checkStart(n)&&(o=new wd(a,null,l),e.getContext(l).openRange=o,e.dispatch("contextStart",[l,a])),o&&s.checkEnd(n)){var u=a-o.startIndex+1,p=e.setEndOffset(u,l);e.dispatch("contextEnd",[l,p])}})};_n.prototype.tokenize=function(n){this.tokens=[],this.resetContextsRanges();var e=Array.from(n);this.dispatch("start");for(var a=0;a<e.length;a++){var s=e[a],l=new Pr(e,a);this.dispatch("next",[l]),this.runContextCheck(l);var o=new El(s);this.tokens.push(o),this.dispatch("newToken",[o,l])}return this.dispatch("end",[this.tokens]),this.tokens};function di(n){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(n)}function ty(n){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(n)}function pi(n){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(n)}function Lc(n){return/[A-z]/.test(n)}function x2(n){return/\s/.test(n)}function nr(n){this.font=n,this.features={}}function Li(n){this.id=n.id,this.tag=n.tag,this.substitution=n.substitution}function No(n,e){if(!n)return-1;switch(e.format){case 1:return e.glyphs.indexOf(n);case 2:for(var a=e.ranges,s=0;s<a.length;s++){var l=a[s];if(n>=l.start&&n<=l.end){var o=n-l.start;return l.index+o}}break;default:return-1}return-1}function S2(n,e){var a=No(n,e.coverage);return a===-1?null:n+e.deltaGlyphId}function w2(n,e){var a=No(n,e.coverage);return a===-1?null:e.substitute[a]}function qf(n,e){for(var a=[],s=0;s<n.length;s++){var l=n[s],o=e.current;o=Array.isArray(o)?o[0]:o;var u=No(o,l);u!==-1&&a.push(u)}return a.length!==n.length?-1:a}function E2(n,e){var a=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(n.context.length<a)return[];var s=qf(e.inputCoverage,n);if(s===-1)return[];var l=e.inputCoverage.length-1;if(n.lookahead.length<e.lookaheadCoverage.length)return[];for(var o=n.lookahead.slice(l);o.length&&pi(o[0].char);)o.shift();var u=new Pr(o,0),p=qf(e.lookaheadCoverage,u),h=[].concat(n.backtrack);for(h.reverse();h.length&&pi(h[0].char);)h.shift();if(h.length<e.backtrackCoverage.length)return[];var g=new Pr(h,0),v=qf(e.backtrackCoverage,g),S=s.length===e.inputCoverage.length&&p.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,x=[];if(S)for(var b=0;b<e.lookupRecords.length;b++)for(var T=e.lookupRecords[b],M=T.lookupListIndex,R=this.getLookupByIndex(M),I=0;I<R.subtables.length;I++){var Q=R.subtables[I],A=this.getLookupMethod(R,Q),_=this.getSubstitutionType(R,Q);if(_==="12")for(var k=0;k<s.length;k++){var G=n.get(k),F=A(G);F&&x.push(F)}}return x}function A2(n,e){var a=n.current,s=No(a,e.coverage);if(s===-1)return null;for(var l,o=e.ligatureSets[s],u=0;u<o.length;u++){l=o[u];for(var p=0;p<l.components.length;p++){var h=n.lookahead[p],g=l.components[p];if(h!==g)break;if(p===l.components.length-1)return l}}return null}function T2(n,e){var a=No(n,e.coverage);return a===-1?null:e.sequences[a]}nr.prototype.getDefaultScriptFeaturesIndexes=function(){for(var n=this.font.tables.gsub.scripts,e=0;e<n.length;e++){var a=n[e];if(a.tag==="DFLT")return a.script.defaultLangSys.featureIndexes}return[]};nr.prototype.getScriptFeaturesIndexes=function(n){var e=this.font.tables;if(!e.gsub)return[];if(!n)return this.getDefaultScriptFeaturesIndexes();for(var a=this.font.tables.gsub.scripts,s=0;s<a.length;s++){var l=a[s];if(l.tag===n&&l.script.defaultLangSys)return l.script.defaultLangSys.featureIndexes;var o=l.langSysRecords;if(o)for(var u=0;u<o.length;u++){var p=o[u];if(p.tag===n){var h=p.langSys;return h.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};nr.prototype.mapTagsToFeatures=function(n,e){for(var a={},s=0;s<n.length;s++){var l=n[s].tag,o=n[s].feature;a[l]=o}this.features[e].tags=a};nr.prototype.getScriptFeatures=function(n){var e=this.features[n];if(this.features.hasOwnProperty(n))return e;var a=this.getScriptFeaturesIndexes(n);if(!a)return null;var s=this.font.tables.gsub;return e=a.map(function(l){return s.features[l]}),this.features[n]=e,this.mapTagsToFeatures(e,n),e};nr.prototype.getSubstitutionType=function(n,e){var a=n.lookupType.toString(),s=e.substFormat.toString();return a+s};nr.prototype.getLookupMethod=function(n,e){var a=this,s=this.getSubstitutionType(n,e);switch(s){case"11":return function(l){return S2.apply(a,[l,e])};case"12":return function(l){return w2.apply(a,[l,e])};case"63":return function(l){return E2.apply(a,[l,e])};case"41":return function(l){return A2.apply(a,[l,e])};case"21":return function(l){return T2.apply(a,[l,e])};default:throw new Error("lookupType: "+n.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};nr.prototype.lookupFeature=function(n){var e=n.contextParams,a=e.index,s=this.getFeature({tag:n.tag,script:n.script});if(!s)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+n.tag+"' for script '"+n.script+"'.");for(var l=this.getFeatureLookups(s),o=[].concat(e.context),u=0;u<l.length;u++)for(var p=l[u],h=this.getLookupSubtables(p),g=0;g<h.length;g++){var v=h[g],S=this.getSubstitutionType(p,v),x=this.getLookupMethod(p,v),b=void 0;switch(S){case"11":b=x(e.current),b&&o.splice(a,1,new Li({id:11,tag:n.tag,substitution:b}));break;case"12":b=x(e.current),b&&o.splice(a,1,new Li({id:12,tag:n.tag,substitution:b}));break;case"63":b=x(e),Array.isArray(b)&&b.length&&o.splice(a,1,new Li({id:63,tag:n.tag,substitution:b}));break;case"41":b=x(e),b&&o.splice(a,1,new Li({id:41,tag:n.tag,substitution:b}));break;case"21":b=x(e.current),b&&o.splice(a,1,new Li({id:21,tag:n.tag,substitution:b}));break}e=new Pr(o,a),!(Array.isArray(b)&&!b.length)&&(b=null)}return o.length?o:null};nr.prototype.supports=function(n){if(!n.script)return!1;this.getScriptFeatures(n.script);var e=this.features.hasOwnProperty(n.script);if(!n.tag)return e;var a=this.features[n.script].some(function(s){return s.tag===n.tag});return e&&a};nr.prototype.getLookupSubtables=function(n){return n.subtables||null};nr.prototype.getLookupByIndex=function(n){var e=this.font.tables.gsub.lookups;return e[n]||null};nr.prototype.getFeatureLookups=function(n){return n.lookupListIndexes.map(this.getLookupByIndex.bind(this))};nr.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var a=this.features[e.script];return a?a.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function C2(n){var e=n.current,a=n.get(-1);return a===null&&di(e)||!di(a)&&di(e)}function M2(n){var e=n.get(1);return e===null||!di(e)}var k2={startCheck:C2,endCheck:M2};function N2(n){var e=n.current,a=n.get(-1);return(di(e)||pi(e))&&!di(a)}function R2(n){var e=n.get(1);switch(!0){case e===null:return!0;case(!di(e)&&!pi(e)):var a=x2(e);if(!a)return!0;if(a){var s=!1;if(s=n.lookahead.some(function(l){return di(l)||pi(l)}),!s)return!0}break;default:return!1}}var D2={startCheck:N2,endCheck:R2};function I2(n,e,a){e[a].setState(n.tag,n.substitution)}function _2(n,e,a){e[a].setState(n.tag,n.substitution)}function O2(n,e,a){n.substitution.forEach(function(s,l){var o=e[a+l];o.setState(n.tag,s)})}function L2(n,e,a){var s=e[a];s.setState(n.tag,n.substitution.ligGlyph);for(var l=n.substitution.components.length,o=0;o<l;o++)s=e[a+o+1],s.setState("deleted",!0)}var Im={11:I2,12:_2,63:O2,41:L2};function Ed(n,e,a){n instanceof Li&&Im[n.id]&&Im[n.id](n,e,a)}function j2(n){for(var e=[].concat(n.backtrack),a=e.length-1;a>=0;a--){var s=e[a],l=ty(s),o=pi(s);if(!l&&!o)return!0;if(l)return!1}return!1}function F2(n){if(ty(n.current))return!1;for(var e=0;e<n.lookahead.length;e++){var a=n.lookahead[e],s=pi(a);if(!s)return!0}return!1}function U2(n){var e=this,a="arab",s=this.featuresTags[a],l=this.tokenizer.getRangeTokens(n);if(l.length!==1){var o=new Pr(l.map(function(p){return p.getState("glyphIndex")}),0),u=new Pr(l.map(function(p){return p.char}),0);l.forEach(function(p,h){if(!pi(p.char)){o.setCurrentIndex(h),u.setCurrentIndex(h);var g=0;j2(u)&&(g|=1),F2(u)&&(g|=2);var v;switch(g){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(s.indexOf(v)!==-1){var S=e.query.lookupFeature({tag:v,script:a,contextParams:o});if(S instanceof Error)return console.info(S.message);S.forEach(function(x,b){x instanceof Li&&(Ed(x,l,b),o.context[b]=x.substitution)})}}})}}function _m(n,e){var a=n.map(function(s){return s.activeState.value});return new Pr(a,0)}function P2(n){var e=this,a="arab",s=this.tokenizer.getRangeTokens(n),l=_m(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var p=e.query.lookupFeature({tag:"rlig",script:a,contextParams:l});p.length&&(p.forEach(function(h){return Ed(h,s,u)}),l=_m(s))})}function B2(n){var e=n.current,a=n.get(-1);return a===null&&Lc(e)||!Lc(a)&&Lc(e)}function z2(n){var e=n.get(1);return e===null||!Lc(e)}var G2={startCheck:B2,endCheck:z2};function Om(n,e){var a=n.map(function(s){return s.activeState.value});return new Pr(a,0)}function H2(n){var e=this,a="latn",s=this.tokenizer.getRangeTokens(n),l=Om(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var p=e.query.lookupFeature({tag:"liga",script:a,contextParams:l});p.length&&(p.forEach(function(h){return Ed(h,s,u)}),l=Om(s))})}function Gr(n){this.baseDir=n||"ltr",this.tokenizer=new _n,this.featuresTags={}}Gr.prototype.setText=function(n){this.text=n};Gr.prototype.contextChecks={latinWordCheck:G2,arabicWordCheck:k2,arabicSentenceCheck:D2};function Xf(n){var e=this.contextChecks[n+"Check"];return this.tokenizer.registerContextChecker(n,e.startCheck,e.endCheck)}function Y2(){return Xf.call(this,"latinWord"),Xf.call(this,"arabicWord"),Xf.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function V2(){var n=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(a){var s=n.tokenizer.getRangeTokens(a);n.tokenizer.replaceRange(a.startIndex,a.endOffset,s.reverse())})}Gr.prototype.registerFeatures=function(n,e){var a=this,s=e.filter(function(l){return a.query.supports({script:n,tag:l})});this.featuresTags.hasOwnProperty(n)?this.featuresTags[n]=this.featuresTags[n].concat(s):this.featuresTags[n]=s};Gr.prototype.applyFeatures=function(n,e){if(!n)throw new Error("No valid font was provided to apply features");this.query||(this.query=new nr(n));for(var a=0;a<e.length;a++){var s=e[a];this.query.supports({script:s.script})&&this.registerFeatures(s.script,s.tags)}};Gr.prototype.registerModifier=function(n,e,a){this.tokenizer.registerModifier(n,e,a)};function Ad(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function q2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Ad.call(this);var a=this.tokenizer.getContextRanges("arabicWord");a.forEach(function(s){U2.call(n,s)})}}function X2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("rlig")!==-1){Ad.call(this);var s=this.tokenizer.getContextRanges("arabicWord");s.forEach(function(l){P2.call(n,l)})}}}function $2(){var n=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("liga")!==-1){Ad.call(this);var s=this.tokenizer.getContextRanges("latinWord");s.forEach(function(l){H2.call(n,l)})}}}Gr.prototype.checkContextReady=function(n){return!!this.tokenizer.getContext(n)};Gr.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(q2.call(this),X2.call(this)),this.checkContextReady("latinWord")&&$2.call(this),this.checkContextReady("arabicSentence")&&V2.call(this)};Gr.prototype.processText=function(n){(!this.text||this.text!==n)&&(this.setText(n),Y2.call(this),this.applyFeaturesToContexts())};Gr.prototype.getBidiText=function(n){return this.processText(n),this.tokenizer.getText()};Gr.prototype.getTextGlyphs=function(n){this.processText(n);for(var e=[],a=0;a<this.tokenizer.tokens.length;a++){var s=this.tokenizer.tokens[a];if(!s.state.deleted){var l=s.activeState.value;e.push(Array.isArray(l)?l[0]:l)}}return e};function cn(n){n=n||{},n.tables=n.tables||{},n.empty||(mo(n.familyName,"When creating a new Font object, familyName is required."),mo(n.styleName,"When creating a new Font object, styleName is required."),mo(n.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),mo(n.ascender,"When creating a new Font object, ascender is required."),mo(n.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:n.familyName||" "},fontSubfamily:{en:n.styleName||" "},fullName:{en:n.fullName||n.familyName+" "+n.styleName},postScriptName:{en:n.postScriptName||(n.familyName+n.styleName).replace(/\s/g,"")},designer:{en:n.designer||" "},designerURL:{en:n.designerURL||" "},manufacturer:{en:n.manufacturer||" "},manufacturerURL:{en:n.manufacturerURL||" "},license:{en:n.license||" "},licenseURL:{en:n.licenseURL||" "},version:{en:n.version||"Version 0.1"},description:{en:n.description||" "},copyright:{en:n.copyright||" "},trademark:{en:n.trademark||" "}},this.unitsPerEm=n.unitsPerEm||1e3,this.ascender=n.ascender,this.descender=n.descender,this.createdTimestamp=n.createdTimestamp,this.tables=Object.assign(n.tables,{os2:Object.assign({usWeightClass:n.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:n.widthClass||this.usWidthClasses.MEDIUM,fsSelection:n.fsSelection||this.fsSelectionValues.REGULAR},n.tables.os2)})),this.supported=!0,this.glyphs=new ls.GlyphSet(this,n.glyphs||[]),this.encoding=new bg(this),this.position=new Co(this),this.substitution=new tr(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Qg(this)}})}cn.prototype.hasChar=function(n){return this.encoding.charToGlyphIndex(n)!==null};cn.prototype.charToGlyphIndex=function(n){return this.encoding.charToGlyphIndex(n)};cn.prototype.charToGlyph=function(n){var e=this.charToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};cn.prototype.updateFeatures=function(n){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(a){return n[a]})}:e})};cn.prototype.stringToGlyphs=function(n,e){var a=this,s=new Gr,l=function(S){return a.charToGlyphIndex(S.char)};s.registerModifier("glyphIndex",null,l);var o=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;s.applyFeatures(this,o);for(var u=s.getTextGlyphs(n),p=u.length,h=new Array(p),g=this.glyphs.get(0),v=0;v<p;v+=1)h[v]=this.glyphs.get(u[v])||g;return h};cn.prototype.nameToGlyphIndex=function(n){return this.glyphNames.nameToGlyphIndex(n)};cn.prototype.nameToGlyph=function(n){var e=this.nameToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};cn.prototype.glyphIndexToName=function(n){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(n):""};cn.prototype.getKerningValue=function(n,e){n=n.index||n,e=e.index||e;var a=this.position.defaultKerningTables;return a?this.position.getKerningValue(a,n,e):this.kerningPairs[n+","+e]||0};cn.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};cn.prototype.forEachGlyph=function(n,e,a,s,l,o){e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:72,l=Object.assign({},this.defaultRenderOptions,l);var u=1/this.unitsPerEm*s,p=this.stringToGlyphs(n,l),h;if(l.kerning){var g=l.script||this.position.getDefaultScriptName();h=this.position.getKerningTables(g,l.language)}for(var v=0;v<p.length;v+=1){var S=p[v];if(o.call(this,S,e,a,s,l),S.advanceWidth&&(e+=S.advanceWidth*u),l.kerning&&v<p.length-1){var x=h?this.position.getKerningValue(h,S.index,p[v+1].index):this.getKerningValue(S,p[v+1]);e+=x*u}l.letterSpacing?e+=l.letterSpacing*s:l.tracking&&(e+=l.tracking/1e3*s)}return e};cn.prototype.getPath=function(n,e,a,s,l){var o=new qn;return this.forEachGlyph(n,e,a,s,l,function(u,p,h,g){var v=u.getPath(p,h,g,l,this);o.extend(v)}),o};cn.prototype.getPaths=function(n,e,a,s,l){var o=[];return this.forEachGlyph(n,e,a,s,l,function(u,p,h,g){var v=u.getPath(p,h,g,l,this);o.push(v)}),o};cn.prototype.getAdvanceWidth=function(n,e,a){return this.forEachGlyph(n,0,0,e,a,function(){})};cn.prototype.draw=function(n,e,a,s,l,o){this.getPath(e,a,s,l,o).draw(n)};cn.prototype.drawPoints=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,p,h,g){u.drawPoints(n,p,h,g)})};cn.prototype.drawMetrics=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,p,h,g){u.drawMetrics(n,p,h,g)})};cn.prototype.getEnglishName=function(n){var e=this.names[n];if(e)return e.en};cn.prototype.validate=function(){var n=this;function e(s,l){}function a(s){var l=n.getEnglishName(s);l&&l.trim().length>0}a("fontFamily"),a("weightName"),a("manufacturer"),a("copyright"),a("version"),this.unitsPerEm>0};cn.prototype.toTables=function(){return Lx.fontToTable(this)};cn.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};cn.prototype.toArrayBuffer=function(){for(var n=this.toTables(),e=n.encode(),a=new ArrayBuffer(e.length),s=new Uint8Array(a),l=0;l<e.length;l++)s[l]=e[l];return a};cn.prototype.download=function(n){var e=this.getEnglishName("fontFamily"),a=this.getEnglishName("fontSubfamily");n=n||e.replace(/\s/g,"")+"-"+a+".otf";var s=this.toArrayBuffer();if(Fx())if(window.URL=window.URL||window.webkitURL,window.URL){var l=new DataView(s),o=new Blob([l],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(o),u.download=n;var p=document.createEvent("MouseEvents");p.initEvent("click",!0,!1),u.dispatchEvent(p)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var h=require("fs"),g=Ux(s);h.writeFileSync(n,g)}};cn.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};cn.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};cn.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function ny(n,e){var a=JSON.stringify(n),s=256;for(var l in e){var o=parseInt(l);if(!(!o||o<256)){if(JSON.stringify(e[l])===a)return o;s<=o&&(s=o+1)}}return e[s]=n,s}function W2(n,e,a){var s=ny(e.name,a);return[{name:"tag_"+n,type:"TAG",value:e.tag},{name:"minValue_"+n,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+n,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+n,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+n,type:"USHORT",value:0},{name:"nameID_"+n,type:"USHORT",value:s}]}function Z2(n,e,a){var s={},l=new lt.Parser(n,e);return s.tag=l.parseTag(),s.minValue=l.parseFixed(),s.defaultValue=l.parseFixed(),s.maxValue=l.parseFixed(),l.skip("uShort",1),s.name=a[l.parseUShort()]||{},s}function Q2(n,e,a,s){for(var l=ny(e.name,s),o=[{name:"nameID_"+n,type:"USHORT",value:l},{name:"flags_"+n,type:"USHORT",value:0}],u=0;u<a.length;++u){var p=a[u].tag;o.push({name:"axis_"+n+" "+p,type:"FIXED",value:e.coordinates[p]<<16})}return o}function K2(n,e,a,s){var l={},o=new lt.Parser(n,e);l.name=s[o.parseUShort()]||{},o.skip("uShort",1),l.coordinates={};for(var u=0;u<a.length;++u)l.coordinates[a[u].tag]=o.parseFixed();return l}function J2(n,e){var a=new et.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:n.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:n.instances.length},{name:"instanceSize",type:"USHORT",value:4+n.axes.length*4}]);a.offsetToData=a.sizeOf();for(var s=0;s<n.axes.length;s++)a.fields=a.fields.concat(W2(s,n.axes[s],e));for(var l=0;l<n.instances.length;l++)a.fields=a.fields.concat(Q2(l,n.instances[l],n.axes,e));return a}function ew(n,e,a){var s=new lt.Parser(n,e),l=s.parseULong();vt.argument(l===65536,"Unsupported fvar table version.");var o=s.parseOffset16();s.skip("uShort",1);for(var u=s.parseUShort(),p=s.parseUShort(),h=s.parseUShort(),g=s.parseUShort(),v=[],S=0;S<u;S++)v.push(Z2(n,e+o+S*p,a));for(var x=[],b=e+o+u*p,T=0;T<h;T++)x.push(K2(n,b+T*g,v,a));return{axes:v,instances:x}}var tw={make:J2,parse:ew},nw=function(){return{coverage:this.parsePointer(Ee.coverage),attachPoints:this.parseList(Ee.pointer(Ee.uShortList))}},aw=function(){var n=this.parseUShort();if(vt.argument(n===1||n===2||n===3,"Unsupported CaretValue table version."),n===1)return{coordinate:this.parseShort()};if(n===2)return{pointindex:this.parseShort()};if(n===3)return{coordinate:this.parseShort()}},rw=function(){return this.parseList(Ee.pointer(aw))},sw=function(){return{coverage:this.parsePointer(Ee.coverage),ligGlyphs:this.parseList(Ee.pointer(rw))}},iw=function(){return this.parseUShort(),this.parseList(Ee.pointer(Ee.coverage))};function lw(n,e){e=e||0;var a=new Ee(n,e),s=a.parseVersion(1);vt.argument(s===1||s===1.2||s===1.3,"Unsupported GDEF table version.");var l={version:s,classDef:a.parsePointer(Ee.classDef),attachList:a.parsePointer(nw),ligCaretList:a.parsePointer(sw),markAttachClassDef:a.parsePointer(Ee.classDef)};return s>=1.2&&(l.markGlyphSets=a.parsePointer(iw)),l}var ow={parse:lw},Br=new Array(10);Br[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{posFormat:1,coverage:this.parsePointer(Ee.coverage),value:this.parseValueRecord()};if(a===2)return{posFormat:2,coverage:this.parsePointer(Ee.coverage),values:this.parseValueRecordList()};vt.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Br[2]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();vt.assert(a===1||a===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var s=this.parsePointer(Ee.coverage),l=this.parseUShort(),o=this.parseUShort();if(a===1)return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,pairSets:this.parseList(Ee.pointer(Ee.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}})))};if(a===2){var u=this.parsePointer(Ee.classDef),p=this.parsePointer(Ee.classDef),h=this.parseUShort(),g=this.parseUShort();return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,classDef1:u,classDef2:p,class1Count:h,class2Count:g,classRecords:this.parseList(h,Ee.list(g,function(){return{value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}}))}}};Br[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Br[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Br[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Br[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Br[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Br[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Br[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function cw(n,e){e=e||0;var a=new Ee(n,e),s=a.parseVersion(1);return vt.argument(s===1||s===1.1,"Unsupported GPOS table version "+s),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(Br)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(Br),variations:a.parseFeatureVariationsList()}}var uw=new Array(10);function fw(n){return new et.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new et.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new et.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new et.LookupList(n.lookups,uw)}])}var dw={parse:cw,make:fw};function pw(n){var e={};n.skip("uShort");var a=n.parseUShort();vt.argument(a===0,"Unsupported kern sub-table version."),n.skip("uShort",2);var s=n.parseUShort();n.skip("uShort",3);for(var l=0;l<s;l+=1){var o=n.parseUShort(),u=n.parseUShort(),p=n.parseShort();e[o+","+u]=p}return e}function hw(n){var e={};n.skip("uShort");var a=n.parseULong();a>1&&console.warn("Only the first kern subtable is supported."),n.skip("uLong");var s=n.parseUShort(),l=s&255;if(n.skip("uShort"),l===0){var o=n.parseUShort();n.skip("uShort",3);for(var u=0;u<o;u+=1){var p=n.parseUShort(),h=n.parseUShort(),g=n.parseShort();e[p+","+h]=g}}return e}function mw(n,e){var a=new lt.Parser(n,e),s=a.parseUShort();if(s===0)return pw(a);if(s===1)return hw(a);throw new Error("Unsupported kern table version ("+s+").")}var gw={parse:mw};function yw(n,e,a,s){for(var l=new lt.Parser(n,e),o=s?l.parseUShort:l.parseULong,u=[],p=0;p<a+1;p+=1){var h=o.call(l);s&&(h*=2),u.push(h)}return u}var vw={parse:yw};function bw(n,e){var a=require("fs");a.readFile(n,function(s,l){if(s)return e(s.message);e(null,Yg(l))})}function xw(n,e){var a=new XMLHttpRequest;a.open("get",n,!0),a.responseType="arraybuffer",a.onload=function(){return a.response?e(null,a.response):e("Font could not be loaded: "+a.statusText)},a.onerror=function(){e("Font could not be loaded")},a.send()}function Lm(n,e){for(var a=[],s=12,l=0;l<e;l+=1){var o=lt.getTag(n,s),u=lt.getULong(n,s+4),p=lt.getULong(n,s+8),h=lt.getULong(n,s+12);a.push({tag:o,checksum:u,offset:p,length:h,compression:!1}),s+=16}return a}function Sw(n,e){for(var a=[],s=44,l=0;l<e;l+=1){var o=lt.getTag(n,s),u=lt.getULong(n,s+4),p=lt.getULong(n,s+8),h=lt.getULong(n,s+12),g=void 0;p<h?g="WOFF":g=!1,a.push({tag:o,offset:u,compression:g,compressedLength:p,length:h}),s+=20}return a}function Pn(n,e){if(e.compression==="WOFF"){var a=new Uint8Array(n.buffer,e.offset+2,e.compressedLength-2),s=new Uint8Array(e.length);if(db(a,s),s.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var l=new DataView(s.buffer,0);return{data:l,offset:0}}else return{data:n,offset:e.offset}}function Td(n,e){e=e??{};var a,s,l=new cn({empty:!0}),o=new DataView(n,0),u,p=[],h=lt.getTag(o,0);if(h==="\0\0\0"||h==="true"||h==="typ1")l.outlinesFormat="truetype",u=lt.getUShort(o,4),p=Lm(o,u);else if(h==="OTTO")l.outlinesFormat="cff",u=lt.getUShort(o,4),p=Lm(o,u);else if(h==="wOFF"){var g=lt.getTag(o,4);if(g==="\0\0\0")l.outlinesFormat="truetype";else if(g==="OTTO")l.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+h);u=lt.getUShort(o,12),p=Sw(o,u)}else throw new Error("Unsupported OpenType signature "+h);for(var v,S,x,b,T,M,R,I,Q,A,_,k,G=0;G<u;G+=1){var F=p[G],K=void 0;switch(F.tag){case"cmap":K=Pn(o,F),l.tables.cmap=vg.parse(K.data,K.offset),l.encoding=new xg(l.tables.cmap);break;case"cvt ":K=Pn(o,F),k=new lt.Parser(K.data,K.offset),l.tables.cvt=k.parseShortList(F.length/2);break;case"fvar":S=F;break;case"fpgm":K=Pn(o,F),k=new lt.Parser(K.data,K.offset),l.tables.fpgm=k.parseByteList(F.length);break;case"head":K=Pn(o,F),l.tables.head=Rg.parse(K.data,K.offset),l.unitsPerEm=l.tables.head.unitsPerEm,a=l.tables.head.indexToLocFormat;break;case"hhea":K=Pn(o,F),l.tables.hhea=Dg.parse(K.data,K.offset),l.ascender=l.tables.hhea.ascender,l.descender=l.tables.hhea.descender,l.numberOfHMetrics=l.tables.hhea.numberOfHMetrics;break;case"hmtx":R=F;break;case"ltag":K=Pn(o,F),s=_g.parse(K.data,K.offset);break;case"maxp":K=Pn(o,F),l.tables.maxp=Og.parse(K.data,K.offset),l.numGlyphs=l.tables.maxp.numGlyphs;break;case"name":A=F;break;case"OS/2":K=Pn(o,F),l.tables.os2=id.parse(K.data,K.offset);break;case"post":K=Pn(o,F),l.tables.post=Bg.parse(K.data,K.offset),l.glyphNames=new vd(l.tables.post);break;case"prep":K=Pn(o,F),k=new lt.Parser(K.data,K.offset),l.tables.prep=k.parseByteList(F.length);break;case"glyf":x=F;break;case"loca":Q=F;break;case"CFF ":v=F;break;case"kern":I=F;break;case"GDEF":b=F;break;case"GPOS":T=F;break;case"GSUB":M=F;break;case"meta":_=F;break}}var le=Pn(o,A);if(l.tables.name=Pg.parse(le.data,le.offset,s),l.names=l.tables.name,x&&Q){var H=a===0,N=Pn(o,Q),V=vw.parse(N.data,N.offset,l.numGlyphs,H),U=Pn(o,x);l.glyphs=$g.parse(U.data,U.offset,V,l,e)}else if(v){var q=Pn(o,v);Ng.parse(q.data,q.offset,l,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var ie=Pn(o,R);if(Ig.parse(l,ie.data,ie.offset,l.numberOfHMetrics,l.numGlyphs,l.glyphs,e),_b(l,e),I){var z=Pn(o,I);l.kerningPairs=gw.parse(z.data,z.offset)}else l.kerningPairs={};if(b){var J=Pn(o,b);l.tables.gdef=ow.parse(J.data,J.offset)}if(T){var pe=Pn(o,T);l.tables.gpos=dw.parse(pe.data,pe.offset),l.position.init()}if(M){var me=Pn(o,M);l.tables.gsub=zg.parse(me.data,me.offset)}if(S){var X=Pn(o,S);l.tables.fvar=tw.parse(X.data,X.offset,l.names)}if(_){var $=Pn(o,_);l.tables.meta=Gg.parse($.data,$.offset),l.metas=l.tables.meta}return l}function ww(n,e,a){a=a??{};var s=typeof window>"u",l=s&&!a.isUrl?bw:xw;return new Promise(function(o,u){l(n,function(p,h){if(p){if(e)return e(p);u(p)}var g;try{g=Td(h,a)}catch(v){if(e)return e(v,null);u(v)}if(e)return e(null,g);o(g)})})}function Ew(n,e){var a=require("fs"),s=a.readFileSync(n);return Td(Yg(s),e)}var Aw=Object.freeze({__proto__:null,Font:cn,Glyph:er,Path:qn,BoundingBox:Is,_parse:lt,parse:Td,load:ww,loadSync:Ew});const Ui=(n,e)=>({...e,...n}),go=new Map;function Al(n,e){const{renderingStyle:a,thickness:s,blankingSize:l}=Ui(e,{renderingStyle:"normal",thickness:1,blankingSize:3});if(a==="normal"||!n||n.length===0)return n;const o=[];if(a==="dotted")for(const u of n)for(let p=0;p<s;p++)o.push({...u});else if(a==="blanked"){const u=Math.max(1,Math.floor(l));for(let p=0;p<n.length;p++){const h=n[p];h.blanking?o.push({...h}):Math.floor(p/u)%2===0?o.push({...h}):o.push({...h,r:0,g:0,b:0,blanking:!0})}}else if(a==="dots")for(const u of n)o.push({...u,r:0,g:0,b:0,blanking:!0}),o.push({...u,blanking:!1}),o.push({...u,blanking:!1});return o}async function jm(n,e){try{const{text:a,x:s,y:l,r:o,g:u,b:p,fontSize:h,numPoints:g,fontUrl:v}=Ui(n,{text:"TrueLazer",x:0,y:.3,r:255,g:255,b:255,fontSize:72,numPoints:100}),S=v||(e?`${e.byteLength}_${new Uint8Array(e.slice(0,100)).join("")}`:null);if(!S)throw new Error("A font buffer or URL is required to generate text.");let x=go.get(S);if(!x){if(!e)throw new Error(`Font buffer missing for ${v} and not in cache.`);if(x=Aw.parse(e),go.set(S,x),go.size>10){const H=go.keys().next().value;go.delete(H)}}const b=x.getPath(a,0,0,h),T=b.commands,M=b.getBoundingBox(),R=(M.x1+M.x2)/2,I=(M.y1+M.y2)/2;let Q=0,A=0,_=0;T.forEach(H=>{if(H.type==="M")A=H.x,_=H.y;else if(H.type==="L"||H.type==="Q"||H.type==="C"){const N=H.x-A,V=H.y-_;Q+=Math.sqrt(N*N+V*V),A=H.x,_=H.y}});const k=g/(Q||1),G=[];A=0,_=0;let F=0,K=0;const le=200;if(T.forEach(H=>{if(H.type==="M"){if(G.length>0){const U=G[G.length-1];G.push({...U,r:0,g:0,b:0,blanking:!0})}F=H.x,K=H.y;const N=(H.x-R)/le+s,V=-(H.y-I)/le+l;G.push({x:N,y:V,r:0,g:0,b:0,blanking:!0}),G.push({x:N,y:V,r:o,g:u,b:p,blanking:!1}),A=H.x,_=H.y}else if(H.type==="L"){const N=H.x-A,V=H.y-_,U=Math.sqrt(N*N+V*V),q=Math.max(1,Math.floor(U*k));for(let ie=1;ie<=q;ie++){const z=ie/q;G.push({x:(A+N*z-R)/le+s,y:-(_+V*z-I)/le+l,r:o,g:u,b:p})}A=H.x,_=H.y}else if(H.type==="Q"){const N=H.x-A,V=H.y-_,U=Math.sqrt(N*N+V*V),q=Math.max(2,Math.floor(U*k));for(let ie=1;ie<=q;ie++){const z=ie/q,J=Math.pow(1-z,2)*A+2*(1-z)*z*H.x1+Math.pow(z,2)*H.x,pe=Math.pow(1-z,2)*_+2*(1-z)*z*H.y1+Math.pow(z,2)*H.y;G.push({x:(J-R)/le+s,y:-(pe-I)/le+l,r:o,g:u,b:p})}A=H.x,_=H.y}else if(H.type==="C"){const N=H.x-A,V=H.y-_,U=Math.sqrt(N*N+V*V),q=Math.max(3,Math.floor(U*k));for(let ie=1;ie<=q;ie++){const z=ie/q,J=Math.pow(1-z,3)*A+3*Math.pow(1-z,2)*z*H.x1+3*(1-z)*Math.pow(z,2)*H.x2+Math.pow(z,3)*H.x,pe=Math.pow(1-z,3)*_+3*Math.pow(1-z,2)*z*H.y1+3*(1-z)*Math.pow(z,2)*H.y2+Math.pow(z,3)*H.y;G.push({x:(J-R)/le+s,y:-(pe-I)/le+l,r:o,g:u,b:p})}A=H.x,_=H.y}else H.type==="Z"&&(G.push({x:(F-R)/le+s,y:-(K-I)/le+l,r:o,g:u,b:p}),A=F,_=K)}),G.length>0){const H=G[G.length-1];G.push({...H,r:0,g:0,b:0,blanking:!0})}return{points:Al(G,n)}}catch(a){throw console.error("Error in generateText:",a),a}}function Fm(n){try{const{radius:e,numPoints:a,x:s,y:l,r:o,g:u,b:p}=Ui(n,{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255}),h=[];for(let g=0;g<=a;g++){const v=g/a*2*Math.PI;h.push({x:e*Math.cos(v)+s,y:e*Math.sin(v)+l,r:o,g:u,b:p})}return{points:Al(h,n)}}catch(e){throw console.error("Error in generateCircle:",e),e}}function Um(n){try{const{width:e,height:a,pointDensity:s,x:l,y:o,r:u,g:p,b:h}=Ui(n,{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255}),g=[{x:-e/2+l,y:-a/2+o},{x:e/2+l,y:-a/2+o},{x:e/2+l,y:a/2+o},{x:-e/2+l,y:a/2+o},{x:-e/2+l,y:-a/2+o}],v=[];for(let S=0;S<g.length-1;S++){const x=g[S],b=g[S+1];for(let T=0;T<s;T++){const M=T/s;v.push({x:x.x+(b.x-x.x)*M,y:x.y+(b.y-x.y)*M,r:u,g:p,b:h})}}return v.push({...g[g.length-1],r:u,g:p,b:h}),{points:Al(v,n)}}catch(e){throw console.error("Error in generateSquare:",e),e}}function Pm(n){try{const{x1:e,y1:a,x2:s,y2:l,pointDensity:o,r:u,g:p,b:h}=Ui(n,{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255}),g=[];for(let v=0;v<=o;v++){const S=v/o;g.push({x:e+(s-e)*S,y:a+(l-a)*S,r:u,g:p,b:h})}return{points:Al(g,n)}}catch(e){throw console.error("Error in generateLine:",e),e}}function Bm(n){try{const{outerRadius:e,innerRadius:a,numSpikes:s,pointDensity:l,x:o,y:u,r:p,g:h,b:g}=Ui(n,{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255}),v=[];for(let x=0;x<s*2;x++){const b=x%2===0?e:a,T=x/(s*2)*2*Math.PI-Math.PI/2;v.push({x:b*Math.cos(T)+o,y:b*Math.sin(T)+u})}v.push({...v[0]});const S=[];for(let x=0;x<v.length-1;x++){const b=v[x],T=v[x+1];for(let M=0;M<l;M++){const R=M/l;S.push({x:b.x+(T.x-b.x)*R,y:b.y+(T.y-b.y)*R,r:p,g:h,b:g})}}return S.push({...v[v.length-1],r:p,g:h,b:g}),{points:Al(S,n)}}catch(e){throw console.error("Error in generateStar:",e),e}}function Tw(n){try{const{amplitude:e,frequency:a,phase:s,width:l,numPoints:o,x:u,y:p,r:h,g,b:v}=Ui(n,{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255}),S=[],x=-l/2;for(let b=0;b<=o;b++){const T=b/o,M=x+T*l,R=e*Math.sin(a*(M*Math.PI)+s);S.push({x:M+u,y:R+p,r:h,g,b:v})}return{points:Al(S,n)}}catch(e){throw console.error("Error in generateSinewave:",e),e}}const vo=()=>Math.random().toString(36).substr(2,9),Cw=Bn.memo(({playbackFps:n,onSpeedChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_speed",targetType:"global",label:"SPEED",min:1,max:120,step:1}))};return f.jsxs("div",{className:"master-speed-slider",children:[f.jsxs("label",{htmlFor:"masterSpeedRange",draggable:!0,onDragStart:a,children:[n," FPS"]}),f.jsx(pn,{id:"master_speed",children:f.jsx("input",{type:"range",min:"1",max:"120",value:n,className:"slider_hor",id:"masterSpeedRange",onChange:s=>e(parseInt(s.target.value))})})]})}),Mw=Bn.memo(({isWorldOutputActive:n,onToggleWorldOutput:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"laser_output",targetType:"global",label:"LASER"}))};return f.jsx("div",{className:"container",draggable:!0,onDragStart:a,children:f.jsx(pn,{id:"laser_output",children:f.jsx("input",{type:"checkbox",className:"laser-toggle",checked:n,onChange:e})})})}),ji=(n,e,a,s,l)=>!Array.isArray(n)||n.length!==e?Array(e).fill(null).map((o,u)=>Array(a).fill(null).map((p,h)=>Array(s).fill(null).map((g,v)=>l(u,h,v)))):n.map((o,u)=>!Array.isArray(o)||o.length!==a?Array(a).fill(null).map((p,h)=>Array(s).fill(null).map((g,v)=>l(u,h,v))):o.map((p,h)=>!Array.isArray(p)||p.length!==s?Array(s).fill(null).map((g,v)=>l(u,h,v)):p)),ay=n=>({columns:Array.from({length:8},(e,a)=>`Col ${a+1}`),layers:Array.from({length:5},(e,a)=>`Layer ${a+1}`),activePageId:n?.activePageId??0,numPages:n?.numPages??8,clipContents:ji(n?.clipContents,8,5,8,()=>({parsing:!1})),clipNames:ji(n?.clipNames,8,5,8,(e,a,s)=>`Clip ${a+1}-${s+1}`),thumbnailFrameIndexes:ji(n?.thumbnailFrameIndexes,8,5,8,()=>0),layerEffects:Array.from({length:5},()=>[]),layerAssignedDacs:n?.layerAssignedDacs??Array(5).fill([]),layerIntensities:Array(5).fill(1),layerAutopilots:Array(5).fill("off"),layerBlackouts:Array(5).fill(!1),layerSolos:Array(5).fill(!1),masterIntensity:1,globalBlackout:!1,selectedLayerIndex:null,selectedColIndex:null,notification:{message:"",visible:!1},dacs:[],selectedDac:n?.dacAssignment?.selectedDac??n?.selectedDac??null,fileBrowserViewMode:"list",fileBrowserPath:"",layerUiStates:Array(6).fill({}),ildaFrames:[],selectedIldaWorkerId:null,selectedIldaTotalFrames:0,bpm:n?.bpm??120,showBeamEffect:n?.renderSettings?.showBeamEffect??!0,beamAlpha:n?.renderSettings?.beamAlpha??.1,fadeAlpha:n?.renderSettings?.fadeAlpha??.13,playbackFps:n?.renderSettings?.playbackFps??60,previewScanRate:n?.renderSettings?.previewScanRate??1,beamRenderMode:n?.renderSettings?.beamRenderMode??"both",worldShowBeamEffect:n?.renderSettings?.worldShowBeamEffect??!0,worldBeamRenderMode:n?.renderSettings?.worldBeamRenderMode??"both",optimizationEnabled:n?.renderSettings?.optimizationEnabled??!0,activeClipIndexes:n?.activeClipIndexes??Array(5).fill(null),isPlaying:!1,isStopped:!0,isWorldOutputActive:!1,thumbnailRenderMode:n?.thumbnailRenderMode??"still",theme:n?.theme??"orange",projectLoadTimestamp:null,clipClipboard:null,dacOutputSettings:n?.dacOutputSettings??{},projectPresets:n?.projectPresets??{},quickAssigns:{knobs:Array(8).fill(null).map(()=>({value:0,label:null,link:null})),buttons:Array(8).fill(null).map(()=>({value:!1,label:null,link:null}))}});function kw(n,e){switch(e.type){case"SET_DAC_OUTPUT_SETTINGS":return{...n,dacOutputSettings:{...n.dacOutputSettings,[e.payload.id]:e.payload.settings}};case"SET_ACTIVE_PAGE":return{...n,activePageId:e.payload};case"REGISTER_PROJECT_PRESET":{const{type:a,subType:s,preset:l}=e.payload,o={...n.projectPresets};return o[a]||(o[a]={}),o[a][s]||(o[a][s]={}),o[a][s][l.name]=l,{...n,projectPresets:o}}case"SET_COLUMNS":return{...n,columns:e.payload};case"SET_COLUMN_NAME":{const a=[...n.columns];return a[e.payload.index]=e.payload.name,{...n,columns:a}}case"DUPLICATE_COLUMN":{const a=e.payload.index,s=[...n.columns];s.splice(a+1,0,`${s[a]} (Copy)`);const l=n.clipContents.map(p=>{const h=[...p],g=h[a];let v=null;if(g&&(v=JSON.parse(JSON.stringify(g)),v.type==="ilda"&&(v.workerId=null),v.effects)){const S=v.syncSettings||{};v.effects=v.effects.map(x=>{const b=x.instanceId,T=vo();return Object.keys(S).forEach(M=>{b&&M.startsWith(`${b}.`)&&(S[`${T}.${M.split(".")[1]}`]=S[M],delete S[M])}),{...x,instanceId:T}}),v.syncSettings=S}return h.splice(a+1,0,v),h}),o=n.clipNames.map(p=>{const h=[...p];return h.splice(a+1,0,`${h[a]} (Copy)`),h}),u=n.thumbnailFrameIndexes.map(p=>{const h=[...p];return h.splice(a+1,0,h[a]),h});return{...n,columns:s,clipContents:l,clipNames:o,thumbnailFrameIndexes:u}}case"SET_LAYERS":return{...n,layers:e.payload};case"SET_LAYER_NAME":{const a=[...n.layers];return a[e.payload.index]=e.payload.name,{...n,layers:a}}case"SET_CLIP_CONTENT":{const{layerIndex:a,colIndex:s,content:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipContents],u=n.activePageId;if(o[u]||(o[u]=Array.from({length:5},()=>Array.from({length:8},()=>({parsing:!1})))),o[u]=[...o[u]],!o[u][a])return console.error(`Reducer Error: Layer array at index ${a} on page ${u} is undefined.`),n;o[u][a]=[...o[u][a]];const p=o[u][a][s]||{};return o[u][a][s]={...p,...l},{...n,clipContents:o}}case"SET_CLIP_NAME":{const{layerIndex:a,colIndex:s,name:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipNames],u=n.activePageId;return o[u]||(o[u]=Array.from({length:5},(p,h)=>Array.from({length:8},(g,v)=>`Clip ${h+1}-${v+1}`))),o[u]=[...o[u]],o[u][a]&&(o[u][a]=[...o[u][a]],o[u][a][s]=l),{...n,clipNames:o}}case"SET_THUMBNAIL_FRAME_INDEX":{const a=[...n.thumbnailFrameIndexes],s=n.activePageId;return a[s]||(a[s]=Array(5).fill(null).map(()=>Array(8).fill(0))),a[s]=[...a[s]],a[s][e.payload.layerIndex]=[...a[s][e.payload.layerIndex]],a[s][e.payload.layerIndex][e.payload.colIndex]=e.payload.index,{...n,thumbnailFrameIndexes:a}}case"ADD_LAYER_EFFECT":{const a=[...n.layerEffects],s={...e.payload.effect,instanceId:vo(),params:{...e.payload.effect.defaultParams}};return a[e.payload.layerIndex].push(s),{...n,layerEffects:a}}case"ADD_CLIP_EFFECT":{const a=n.activePageId,s=[...n.clipContents];if(s[a]=[...s[a]],!s[a][e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} on page ${a} is undefined.`),n;s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l=s[a][e.payload.layerIndex][e.payload.colIndex]||{},o={...e.payload.effect,instanceId:vo(),params:{...e.payload.effect.defaultParams}},u={...l,effects:[...l.effects||[],o]};return s[a][e.payload.layerIndex][e.payload.colIndex]=u,{...n,clipContents:s}}case"SET_SELECTED_CLIP":return{...n,selectedLayerIndex:e.payload.layerIndex,selectedColIndex:e.payload.colIndex};case"SET_NOTIFICATION":return{...n,notification:e.payload};case"SET_ILDA_FRAMES":return{...n,ildaFrames:e.payload};case"SET_SELECTED_ILDA_DATA":return{...n,selectedIldaWorkerId:e.payload.workerId,selectedIldaTotalFrames:e.payload.totalFrames,selectedGeneratorId:e.payload.generatorId,selectedGeneratorParams:e.payload.generatorParams};case"SET_ACTIVE_CLIP":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]={pageId:n.activePageId,colIndex:e.payload.colIndex},{...n,activeClipIndexes:a}}case"CLEAR_CLIP":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]],s[a][e.payload.layerIndex][e.payload.colIndex]=null;const l=[...n.clipNames];l[a]=[...l[a]],l[a][e.payload.layerIndex]=[...l[a][e.payload.layerIndex]],l[a][e.payload.layerIndex][e.payload.colIndex]=`Clip ${e.payload.layerIndex+1}-${e.payload.colIndex+1}`;const o=[...n.thumbnailFrameIndexes];o[a]=[...o[a]],o[a][e.payload.layerIndex]=[...o[a][e.payload.layerIndex]],o[a][e.payload.layerIndex][e.payload.colIndex]=0;const u=[...n.activeClipIndexes],p=u[e.payload.layerIndex];return p&&p.pageId===a&&p.colIndex===e.payload.colIndex&&(u[e.payload.layerIndex]=null),n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex?{...n,clipContents:s,clipNames:l,thumbnailFrameIndexes:o,activeClipIndexes:u,selectedLayerIndex:null,selectedColIndex:null,selectedIldaWorkerId:null,selectedIldaTotalFrames:0,selectedGeneratorId:null,selectedGeneratorParams:{}}:{...n,clipContents:s,clipNames:l,thumbnailFrameIndexes:o,activeClipIndexes:u}}case"DEACTIVATE_LAYER_CLIPS":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]=null,{...n,activeClipIndexes:a}}case"CLEAR_ALL_ACTIVE_CLIPS":return{...n,activeClipIndexes:Array(n.layers.length).fill(null)};case"SET_LAYER_INTENSITY":{const a=[...n.layerIntensities];return a[e.payload.layerIndex]=e.payload.intensity,{...n,layerIntensities:a}}case"SET_LAYER_AUTOPILOT":{const a=[...n.layerAutopilots];return a[e.payload.layerIndex]=e.payload.mode,{...n,layerAutopilots:a}}case"TOGGLE_LAYER_BLACKOUT":{const a=[...n.layerBlackouts];return a[e.payload.layerIndex]=!a[e.payload.layerIndex],{...n,layerBlackouts:a}}case"TOGGLE_LAYER_SOLO":{const a=[...n.layerSolos],s=a[e.payload.layerIndex];return a.fill(!1),s||(a[e.payload.layerIndex]=!0),{...n,layerSolos:a}}case"SET_MASTER_INTENSITY":return{...n,masterIntensity:e.payload};case"TOGGLE_GLOBAL_BLACKOUT":return{...n,globalBlackout:!n.globalBlackout};case"SET_RENDER_SETTING":return{...n,[e.payload.setting]:e.payload.value};case"SET_FILE_BROWSER_VIEW_MODE":return{...n,fileBrowserViewMode:e.payload};case"SET_FILE_BROWSER_PATH":return{...n,fileBrowserPath:e.payload};case"UPDATE_CLIP_UI_STATE":{const{layerIndex:a,colIndex:s,uiState:l}=e.payload,o=n.activePageId,u=[...n.clipContents];u[o]=[...u[o]],u[o][a]=[...u[o][a]];const p={...u[o][a][s]};return p&&(p.uiState={...p.uiState||{},...l},u[o][a][s]=p),{...n,clipContents:u}}case"UPDATE_LAYER_UI_STATE":{const{layerIndex:a,uiState:s}=e.payload,l=[...n.layerUiStates];return l[a]={...l[a],...s},{...n,layerUiStates:l}}case"REMOVE_CLIP_EFFECT":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l={...s[a][e.payload.layerIndex][e.payload.colIndex]};if(l&&l.effects){const o=[...l.effects];o.splice(e.payload.effectIndex,1),l.effects=o,s[a][e.payload.layerIndex][e.payload.colIndex]=l}return{...n,clipContents:s}}case"REORDER_CLIP_EFFECTS":{const{layerIndex:a,colIndex:s,oldIndex:l,newIndex:o}=e.payload,u=n.activePageId,p=[...n.clipContents];p[u]=[...p[u]],p[u][a]=[...p[u][a]];const h={...p[u][a][s]};if(h&&h.effects){const g=[...h.effects],[v]=g.splice(l,1);g.splice(o,0,v),h.effects=g,p[u][a][s]=h}return{...n,clipContents:p}}case"REMOVE_LAYER_EFFECT":{const a=[...n.layerEffects];return a[e.payload.layerIndex]&&(a[e.payload.layerIndex]=[...a[e.payload.layerIndex]],a[e.payload.layerIndex].splice(e.payload.effectIndex,1)),{...n,layerEffects:a}}case"UPDATE_LAYER_EFFECT_PARAMETER":{const a=[...n.layerEffects];if(a[e.payload.layerIndex]){a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=e.payload.effectIndex;if(a[e.payload.layerIndex][s]){const l={...a[e.payload.layerIndex][s]};l.params={...l.params,[e.payload.paramName]:e.payload.newValue},a[e.payload.layerIndex][s]=l}}return{...n,layerEffects:a}}case"UPDATE_EFFECT_PARAMETER":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l={...s[a][e.payload.layerIndex][e.payload.colIndex]};if(l&&l.effects){const o=[...l.effects],u={...o[e.payload.effectIndex]};u.params={...u.params,[e.payload.paramName]:e.payload.newValue},o[e.payload.effectIndex]=u,l.effects=o,s[a][e.payload.layerIndex][e.payload.colIndex]=l}return{...n,clipContents:s}}case"UPDATE_CLIP_PLAYBACK_SETTINGS":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l={...s[a][e.payload.layerIndex][e.payload.colIndex]};return l&&(l.playbackSettings={...l.playbackSettings||{mode:"fps",duration:1,beats:8,speedMultiplier:1},...e.payload.settings},s[a][e.payload.layerIndex][e.payload.colIndex]=l),{...n,clipContents:s}}case"SET_CLIP_PARAM_SYNC":{const{layerIndex:a,colIndex:s,paramId:l,syncMode:o}=e.payload,u=n.activePageId,p=[...n.clipContents];p[u]=[...p[u]],p[u][a]=[...p[u][a]];const h={...p[u][a][s]};if(h){const g=h.syncSettings||{},v=g[l]===o?null:o;h.syncSettings={...g,[l]:v},p[u][a][s]=h}return{...n,clipContents:p}}case"UPDATE_GENERATOR_PARAM":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l={...s[a][e.payload.layerIndex][e.payload.colIndex]};return l&&l.type==="generator"&&l.currentParams&&(l.currentParams={...l.currentParams,[e.payload.paramName]:e.payload.newValue},s[a][e.payload.layerIndex][e.payload.colIndex]=l,n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex)?{...n,clipContents:s,selectedGeneratorParams:l.currentParams}:{...n,clipContents:s}}case"SET_DACS":return{...n,dacs:e.payload};case"SET_BPM":return{...n,bpm:e.payload};case"SET_SELECTED_DAC":return{...n,selectedDac:e.payload};case"SET_IS_PLAYING":return{...n,isPlaying:e.payload};case"SET_IS_STOPPED":return{...n,isStopped:e.payload};case"SET_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:e.payload};case"SET_OPTIMIZATION_ENABLED":return{...n,optimizationEnabled:e.payload};case"TOGGLE_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:!n.isWorldOutputActive};case"SET_CLIPBOARD":return{...n,clipClipboard:e.payload};case"SET_CLIP_DAC":{const a=n.activePageId,s=[...n.clipContents];if(s[a]=[...s[a]],!s[a][e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} on page ${a} is undefined.`),n;s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const l=s[a][e.payload.layerIndex][e.payload.colIndex]||{};let o=l.assignedDacs||[];const u=[],p=g=>{const{channels:v,allChannels:S,...x}=g;return x};if(e.payload.dac.allChannels&&e.payload.dac.channels)e.payload.dac.channels.forEach(g=>{o.some(v=>v.ip===e.payload.dac.ip&&v.channel===g.serviceID)||u.push({...p(e.payload.dac),channel:g.serviceID,mirrorX:!1,mirrorY:!1})});else{const g=e.payload.dac.channel;g!==void 0&&!o.some(v=>v.ip===e.payload.dac.ip&&v.channel===g)&&u.push({...p(e.payload.dac),channel:g,mirrorX:!1,mirrorY:!1})}if(u.length===0)return n;const h={...l,assignedDacs:[...o,...u]};return s[a][e.payload.layerIndex][e.payload.colIndex]=h,{...n,clipContents:s}}case"SET_CLIP_DAC_GROUP":{const{layerIndex:a,colIndex:s,groupDacs:l}=e.payload,o=n.activePageId,u=[...n.clipContents];u[o]=[...u[o]],u[o][a]=[...u[o][a]];const p=u[o][a][s]||{},h=p.assignedDacs||[],g=l.filter(v=>!h.some(S=>S.ip===v.ip&&S.channel===v.channel)).map(v=>({...v,mirrorX:!1,mirrorY:!1}));return g.length===0?n:(u[o][a][s]={...p,assignedDacs:[...h,...g]},{...n,clipContents:u})}case"SET_LAYER_DAC":{const{layerIndex:a,dac:s}=e.payload,l=[...n.layerAssignedDacs],o=l[a]||[];let u=[];const p=h=>{const{channels:g,allChannels:v,...S}=h;return S};if(s.allChannels&&s.channels)s.channels.forEach(h=>{o.some(g=>g.ip===s.ip&&g.channel===h.serviceID)||u.push({...p(s),channel:h.serviceID,mirrorX:!1,mirrorY:!1})});else{const h=s.channel;h!==void 0&&!o.some(g=>g.ip===s.ip&&g.channel===h)&&u.push({...p(s),channel:h,mirrorX:!1,mirrorY:!1})}return u.length===0?n:(l[a]=[...o,...u],{...n,layerAssignedDacs:l})}case"SET_LAYER_DAC_GROUP":{const{layerIndex:a,groupDacs:s}=e.payload,l=[...n.layerAssignedDacs],o=l[a]||[],u=s.filter(p=>!o.some(h=>h.ip===p.ip&&h.channel===p.channel)).map(p=>({...p,mirrorX:!1,mirrorY:!1}));return u.length===0?n:(l[a]=[...o,...u],{...n,layerAssignedDacs:l})}case"TOGGLE_CLIP_DAC_MIRROR":{const{layerIndex:a,colIndex:s,dacIndex:l,axis:o}=e.payload,u=n.activePageId,p=[...n.clipContents];p[u]=[...p[u]],p[u][a]=[...p[u][a]];const h={...p[u][a][s]};if(h&&h.assignedDacs){const g=[...h.assignedDacs],v={...g[l]};return o==="x"&&(v.mirrorX=!v.mirrorX),o==="y"&&(v.mirrorY=!v.mirrorY),g[l]=v,h.assignedDacs=g,p[u][a][s]=h,{...n,clipContents:p}}return n}case"REMOVE_CLIP_DAC":{const a=n.activePageId,s=[...n.clipContents];s[a]=[...s[a]],s[a][e.payload.layerIndex]=[...s[a][e.payload.layerIndex]];const{layerIndex:l,colIndex:o,dacIndex:u}=e.payload,p=s[a][l][o];if(p&&p.assignedDacs){const h=[...p.assignedDacs];return h.splice(u,1),s[a][e.payload.layerIndex][e.payload.colIndex]={...p,assignedDacs:h},{...n,clipContents:s}}return n}case"TOGGLE_LAYER_DAC_MIRROR":{const{layerIndex:a,dacIndex:s,axis:l}=e.payload,o=[...n.layerAssignedDacs],u=o[a]?[...o[a]]:[];if(u[s]){const p={...u[s]};return l==="x"&&(p.mirrorX=!p.mirrorX),l==="y"&&(p.mirrorY=!p.mirrorY),u[s]=p,o[a]=u,{...n,layerAssignedDacs:o}}return n}case"REMOVE_LAYER_DAC":{const{layerIndex:a,dacIndex:s}=e.payload,l=[...n.layerAssignedDacs];if(l[a]){const o=[...l[a]];return o.splice(s,1),l[a]=o,{...n,layerAssignedDacs:l}}return n}case"SET_CLIP_AUDIO":{const a=n.activePageId,s=[...n.clipContents],{layerIndex:l,colIndex:o,audioFile:u}=e.payload;s[a]=[...s[a]],s[a][l]=[...s[a][l]];const p=s[a][l][o];return p?(s[a][l][o]={...p,audioFile:u,audioVolume:p.audioVolume!==void 0?p.audioVolume:1},{...n,clipContents:s}):n}case"SET_CLIP_AUDIO_VOLUME":{const a=n.activePageId,s=[...n.clipContents],{layerIndex:l,colIndex:o,volume:u}=e.payload;s[a]=[...s[a]],s[a][l]=[...s[a][l]];const p=s[a][l][o];return p?(s[a][l][o]={...p,audioVolume:u},{...n,clipContents:s}):n}case"REMOVE_CLIP_AUDIO":{const a=n.activePageId,s=[...n.clipContents],{layerIndex:l,colIndex:o}=e.payload;s[a]=[...s[a]],s[a][l]=[...s[a][l]];const u=s[a][l][o];return u?(s[a][l][o]={...u,audioFile:null},{...n,clipContents:s}):n}case"SET_CLIP_PARSING_STATUS":{const{layerIndex:a,colIndex:s,status:l}=e.payload,o=n.activePageId,u=[...n.clipContents];if(u[o]=[...u[o]],u[o][a]){u[o][a]=[...u[o][a]];const p=u[o][a][s]||{};return u[o][a][s]={...p,parsing:l},{...n,clipContents:u}}return n}case"SET_BULK_PARSING_STATUS":{const a=n.activePageId,s=[...n.clipContents];return s[a]=[...s[a]],new Set(e.payload.map(o=>o.layerIndex)).forEach(o=>{s[a][o]&&(s[a][o]=[...s[a][o]])}),e.payload.forEach(({layerIndex:o,colIndex:u,status:p})=>{if(s[a][o]){const h=s[a][o][u]||{};s[a][o][u]={...h,parsing:p}}}),{...n,clipContents:s}}case"SET_THUMBNAIL_RENDER_MODE":return{...n,thumbnailRenderMode:e.payload};case"SET_CLIP_TRIGGER_STYLE":{const{layerIndex:a,colIndex:s,style:l}=e.payload,o=n.activePageId,u=[...n.clipContents];u[o]=[...u[o]],u[o][a]=[...u[o][a]];const p=u[o][a][s]||{};return u[o][a][s]={...p,triggerStyle:l},{...n,clipContents:u}}case"SET_THEME":return{...n,theme:e.payload};case"UPDATE_THUMBNAIL":{const{layerIndex:a,colIndex:s,frameIndex:l}=e.payload,o=n.activePageId,u=[...n.thumbnailFrameIndexes];return u[o]=[...u[o]],u[o][a]=[...u[o][a]],u[o][a][s]=l,{...n,thumbnailFrameIndexes:u}}case"RESET_STATE":return ay({});case"LOAD_PROJECT":{const a={...n,...e.payload};return a.clipContents=ji(a.clipContents,8,5,8,()=>({parsing:!1})),a.clipNames=ji(a.clipNames,8,5,8,(s,l,o)=>`Clip ${l+1}-${o+1}`),a.thumbnailFrameIndexes=ji(a.thumbnailFrameIndexes,8,5,8,()=>0),a.clipContents=a.clipContents.map(s=>s.map(l=>l.map(o=>o&&o.type==="ilda"?{...o,workerId:null,parsing:!1}:o))),a.activeClipIndexes=Array(n.layers.length).fill(null),a.selectedLayerIndex=null,a.selectedColIndex=null,a.selectedIldaWorkerId=null,a.selectedIldaTotalFrames=0,a.selectedGeneratorId=null,a.selectedGeneratorParams={},a.projectLoadTimestamp=Date.now(),a}case"LOAD_SETTINGS":return{...n,showBeamEffect:e.payload.renderSettings?.showBeamEffect??n.showBeamEffect,beamAlpha:e.payload.renderSettings?.beamAlpha??n.beamAlpha,fadeAlpha:e.payload.renderSettings?.fadeAlpha??n.fadeAlpha,playbackFps:e.payload.renderSettings?.playbackFps??n.playbackFps,previewScanRate:e.payload.renderSettings?.previewScanRate??n.previewScanRate,beamRenderMode:e.payload.renderSettings?.beamRenderMode??n.beamRenderMode,theme:e.payload.theme??n.theme,thumbnailRenderMode:e.payload.thumbnailRenderMode??n.thumbnailRenderMode,selectedDac:e.payload.selectedDac??n.selectedDac,clipNames:e.payload.clipNames?ji(e.payload.clipNames,8,5,8,(a,s,l)=>`Clip ${s+1}-${l+1}`):n.clipNames,dacOutputSettings:e.payload.dacOutputSettings??n.dacOutputSettings};case"ASSIGN_QUICK_CONTROL":{const{type:a,index:s,link:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons",p=l.targetType==="effect"||l.targetType==="generator"?l.pageId??n.activePageId:void 0;return o[u][s]={...o[u][s],label:l.paramName||l.paramId,link:{...l,pageId:p},min:l.min,max:l.max,step:l.step},{...n,quickAssigns:o}}case"CLEAR_QUICK_CONTROL":{const{type:a,index:s}=e.payload,l={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},o=a==="knob"?"knobs":"buttons";return l[o][s]={value:a==="knob"?0:!1,label:null,link:null},{...n,quickAssigns:l}}case"UPDATE_QUICK_CONTROL":{const{type:a,index:s,value:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons",p=o[u][s];o[u][s]={...p,value:l};let h={...n,quickAssigns:o};if(p.link){const{layerIndex:g,colIndex:v,effectIndex:S,targetType:x}=p.link,b=p.link.paramName||p.link.paramId;let T=l;if(a==="knob"&&p.min!==void 0&&p.max!==void 0&&(T=p.min+l*(p.max-p.min),p.step&&(T=Math.round(T/p.step)*p.step),T=parseFloat(T.toFixed(5))),console.log(`Updating ${x} param ${b} to ${T} (Link: L${g} C${v} E${S})`),x==="layerEffect"){const M=[...h.layerEffects];if(M[g]&&(M[g]=[...M[g]],M[g][S])){const R={...M[g][S]};R.params={...R.params,[b]:T},M[g][S]=R,h={...h,layerEffects:M}}}else if(x==="global")b==="master_intensity"?h={...h,masterIntensity:T}:b==="master_speed"&&(h={...h,playbackFps:T});else{const M=[...h.clipContents],R=p.link.pageId??n.activePageId;if(M[R]&&M[R][g]){M[R]=[...M[R]],M[R][g]=[...M[R][g]];const I=M[R][g][v];if(I)if(x==="effect"&&I.effects&&I.effects[S]){const Q=[...I.effects],A={...Q[S]};A.params={...A.params,[b]:T},Q[S]=A,M[R][g][v]={...I,effects:Q}}else x==="generator"&&(M[R][g][v]={...I,currentParams:{...I.currentParams,[b]:T}});h.clipContents=M}}}return h}case"TOGGLE_QUICK_BUTTON":{const{index:a}=e.payload,l=!n.quickAssigns.buttons[a].value,o={...n.quickAssigns,buttons:[...n.quickAssigns.buttons]};o.buttons[a]={...o.buttons[a],value:l};let u={...n,quickAssigns:o};const p=o.buttons[a];if(p.link){const{layerIndex:h,colIndex:g,effectIndex:v,targetType:S}=p.link,x=p.link.paramName||p.link.paramId;if(S==="global")x==="blackout"?u.globalBlackout=l:x==="laser_output"&&(u.isWorldOutputActive=l);else if(S==="layer"){if(x==="blackout"){const b=[...u.layerBlackouts];b[h]=l,u={...u,layerBlackouts:b}}else if(x==="solo"){const b=[...u.layerSolos];l?(b.fill(!1),b[h]=!0):b[h]=!1,u={...u,layerSolos:b}}else if(x==="clear"){if(l){const b=[...u.activeClipIndexes];b[h]=null,u={...u,activeClipIndexes:b},o.buttons[a].value=!1,u.quickAssigns=o}}else if(x==="autopilot"){const b=[...u.layerAutopilots];b[h]=l?"forward":"off",u={...u,layerAutopilots:b}}}else if(S==="layerEffect"){const b=[...u.layerEffects];if(b[h]&&(b[h]=[...b[h]],b[h][v])){const T={...b[h][v]};T.params={...T.params,[x]:l},b[h][v]=T,u={...u,layerEffects:b}}}else{const b=[...u.clipContents],T=p.link.pageId??n.activePageId;if(b[T]&&b[T][h]){b[T]=[...b[T]],b[T][h]=[...b[T][h]];const M=b[T][h][g];if(M)if(S==="effect"&&M.effects&&M.effects[v]){const R=[...M.effects],I={...R[v]};I.params={...I.params,[x]:l},R[v]=I,b[T][h][g]={...M,effects:R}}else S==="generator"&&(b[T][h][g]={...M,currentParams:{...M.currentParams,[x]:l}});u.clipContents=b}}}return u}case"UPDATE_CLIP_FILE_PATH":{const{oldPath:a,newPath:s}=e.payload;console.log(`Reducer: Updating clip path from ${a} to ${s}`);const l=n.clipContents.map(o=>o.map(u=>u.map(p=>{let h=p;return p&&p.filePath===a&&(h={...h,filePath:s,parsingFailed:!1}),p&&p.audioFile&&p.audioFile.path===a&&(h={...h,audioFile:{...p.audioFile,path:s}}),h})));return{...n,clipContents:l}}case"SET_CLIP_PARSING_FAILED":{const{layerIndex:a,colIndex:s,failed:l}=e.payload,o=n.activePageId,u=[...n.clipContents];if(u[o]=[...u[o]],u[o][a]){u[o][a]=[...u[o][a]];const p=u[o][a][s];p&&(u[o][a][s]={...p,parsingFailed:l})}return{...n,clipContents:u}}default:return n}}const zm={orange:{full:96,dim:10},yellow:{full:13,dim:15},cyan:{full:33,dim:35},"light-blue":{full:37,dim:39},blue:{full:45,dim:47},magenta:{full:53,dim:55},red:{full:5,dim:7},green:{full:21,dim:23},white:{full:119,dim:1}},$f=async(n,e,a,s,l=!0)=>{if(!n||!n.points)return null;let o=n;if(l)try{const I=dd(n.points);o={...n,points:I,isTypedArray:!0}}catch(I){console.warn("Failed to optimize points for thumbnail:",I)}let u=o;try{e&&e.length>0&&(u=bo(o,e,{progress:0,time:0,effectStates:{},assignedDacs:[]}))}catch(I){console.warn("Failed to apply effects for thumbnail:",I)}const p=128,h=128,g=document.createElement("canvas");g.width=p,g.height=h;const v=g.getContext("2d");v.fillStyle="#000000",v.fillRect(0,0,p,h);const S=u.points,x=u.isTypedArray||S instanceof Float32Array,b=x?S.length/8:S.length;v.lineWidth=1.5,v.lineCap="round";let T=null,M=null,R=!0;for(let I=0;I<b;I++){let Q,A,_,k,G,F;if(x){const H=I*8;Q=S[H],A=S[H+1],_=S[H+3],k=S[H+4],G=S[H+5],F=S[H+6]>.5}else{const H=S[I];Q=H.x,A=H.y,_=H.r,k=H.g,G=H.b,F=!!H.blanking}const K=(Q+1)*.5*p,le=(1-(A+1)*.5)*h;if(!F&&!R&&T!==null){v.beginPath(),v.moveTo(T,M),v.lineTo(K,le);const H=Math.floor(Math.max(0,Math.min(255,_))),N=Math.floor(Math.max(0,Math.min(255,k))),V=Math.floor(Math.max(0,Math.min(255,G)));v.strokeStyle=`rgb(${H},${N},${V})`,v.stroke()}T=K,M=le,R=F}try{const Q=await(await new Promise(A=>g.toBlob(A,"image/png"))).arrayBuffer();if(window.electronAPI&&window.electronAPI.saveThumbnail){const A=`thumb_L${a}_C${s}.png`;return await window.electronAPI.saveThumbnail(Q,A)}}catch(I){console.error("Error generating/saving thumbnail:",I)}return null},Gm=Bn.memo(({type:n,previewFrameCountRef:e,totalPointsSentRef:a,activeChannelsCountRef:s,lastStatUpdateTimeRef:l})=>{const[o,u]=w.useState({cpu:"0.0",ram:"0",fps:0,pps:0,avgPps:0});return w.useEffect(()=>{const p=window.electronAPI?.onSystemStats(g=>{u(v=>({...v,...g}))});let h;return n==="performance"&&l&&e&&a&&s&&(h=setInterval(()=>{const g=performance.now(),v=(g-(l.current||0))/1e3;if(v>0){const S=Math.round((e.current||0)/v),x=Math.round((a.current||0)/v),b=(s.current||0)>0?Math.round(x/s.current):0;u(T=>({...T,fps:S,pps:x,avgPps:b})),e.current=0,a.current=0,l.current=g}},1e3)),()=>{p&&p(),h&&clearInterval(h)}},[n,e,a,s,l]),n==="system"?f.jsxs("div",{className:"systemStats",children:[f.jsxs("p",{className:"sysStats",children:["CPU: ",o.cpu,"%"]}),f.jsxs("p",{className:"sysStats",children:["RAM: ",o.ram,"MB"]})]}):f.jsxs("div",{className:"performanceStats",children:[f.jsxs("p",{className:"perfStats",children:["FPS: ",o.fps]}),f.jsxs("p",{className:"perfStats",children:["AnimPPS: ",o.avgPps," (Avg)"]})]})}),Nw=Bn.memo(({playbackFps:n,previewScanRate:e,previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})=>f.jsxs("div",{className:"system-monitor-grid",children:[f.jsx(Gm,{type:"performance",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o}),f.jsx(Gm,{type:"system",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})]})),Rw=Bn.memo(({clipContents:n,activeClipIndexes:e,layerEffects:a,bpm:s,playbackFps:l,selectedLayerIndex:o,selectedColIndex:u,liveFramesRef:p,progressRef:h,selectedDac:g,liveDacOutputSettingsRef:v,dacOutputSettings:S,getAudioInfo:x,fftLevels:b,getFftLevels:T,effectStatesRef:M,clipActivationTimesRef:R,showBeamEffect:I,beamAlpha:Q,fadeAlpha:A,previewScanRate:_,beamRenderMode:k,worldShowBeamEffect:G,worldBeamRenderMode:F,masterIntensity:K,layerIntensities:le,globalBlackout:H,layerSolos:N,layerBlackouts:V,handleToggleBeamEffect:U,handleCycleDisplayMode:q,previewFrameCountRef:ie,totalPointsSentRef:z,activeChannelsCountRef:J,lastStatUpdateTimeRef:pe,liveClipContentsRef:me,optimizationEnabled:X,onRegisterPreset:$,activePageId:he})=>{const[Ce,Pe]=w.useState(0),Ke=w.useRef(0),Xe=w.useRef(performance.now()),wt=1e3/70;w.useEffect(()=>{let Yt;const Vt=rt=>{rt-Ke.current>wt&&(ie.current++,Xe.current=performance.now(),Pe(Gt=>Gt+1),Ke.current=rt),Yt=requestAnimationFrame(Vt)};return Yt=requestAnimationFrame(Vt),()=>cancelAnimationFrame(Yt)},[wt,ie]);const dt=me?.current||n,_e=he,Ze=o!==null&&u!==null?dt[_e]?.[o]?.[u]:null,ft=o!==null?e[o]:null,Rt=u!==null?Ze?.type==="ilda"?Ze?.workerId:`generator-${_e}-${o}-${u}`:ft&&ft.colIndex!==null?dt[ft.pageId]?.[o]?.[ft.colIndex]?.type==="ilda"?dt[ft.pageId]?.[o]?.[ft.colIndex]?.workerId:`generator-${ft.pageId}-${o}-${ft.colIndex}`:null,Dt=Rt?p.current[Rt]:null,zt=Rt&&h.current[Rt]||0;let Xn=[],nt=1;if(o!==null){const Yt=a[o]||[];u!==null?Xn=[...Ze?.effects||[],...Yt]:ft&&ft.colIndex!==null?Xn=[...dt[ft.pageId]?.[o]?.[ft.colIndex]?.effects||[],...Yt]:Xn=Yt;const Vt=N.some(Gt=>Gt);let rt=le[o];H?rt=0:Vt?rt=N[o]?V[o]?0:rt:0:V[o]&&(rt=0),nt=rt*K}const tt=w.useMemo(()=>{const Yt={};return e.forEach((Vt,rt)=>{if(Vt&&Vt.colIndex!==null){const Gt=dt[Vt.pageId]?.[rt]?.[Vt.colIndex];if(Gt){let ze=Gt.type==="ilda"?Gt.workerId:`generator-${Vt.pageId}-${rt}-${Vt.colIndex}`;ze&&p.current[ze]&&(Yt[ze]={frame:p.current[ze],effects:[...Gt.effects||[],...a[rt]||[]],layerIndex:rt,syncSettings:Gt.syncSettings||{},bpm:s,clipDuration:(()=>{const xe=Gt.playbackSettings||{};return xe.mode==="timeline"?xe.duration||1:xe.mode==="bpm"?(xe.beats||8)*60/(s||120):(Gt.totalFrames||30)/(Gt.fps||l||30)})(),progress:h.current[ze]||0,effectStates:M.current,clipActivationTime:R.current[rt]||0})}}}),Yt},[e,dt,Ce,s,a,l,p,h,M,R]),ut=w.useMemo(()=>{const Yt=N.some(Vt=>Vt);return le.map((Vt,rt)=>H?0:Yt?N[rt]?V[rt]?0:Vt:0:V[rt]?0:Vt)},[le,V,N,H]);return f.jsxs("div",{className:"side-panel",children:[f.jsx(Ov,{frame:Dt,effects:Xn,showBeamEffect:I,beamAlpha:Q,fadeAlpha:A,previewScanRate:_,beamRenderMode:k,intensity:nt,syncSettings:Ze?.syncSettings,bpm:s,clipDuration:(()=>{const Yt=Ze?.playbackSettings||{};return Yt.mode==="timeline"?Yt.duration||1:Yt.mode==="bpm"?(Yt.beats||8)*60/(s||120):(Ze?.totalFrames||30)/(Ze?.fps||l||30)})(),progress:zt,previewTime:Xe.current,fftLevels:T?T():b,effectStates:M.current,clipActivationTime:o!==null&&R.current[o]||0,optimizationEnabled:X,onToggleBeamEffect:()=>U("clip"),onCycleDisplayMode:()=>q("clip")}),f.jsx(Lv,{activeFrames:tt,showBeamEffect:G,beamAlpha:Q,fadeAlpha:A,previewScanRate:_,beamRenderMode:F,layerIntensities:ut,masterIntensity:K,dacSettings:g?v.current?v.current[`${g.ip}:${g.channel}`]:S[`${g.ip}:${g.channel}`]:null,previewTime:Xe.current,fftLevels:T?T():b,optimizationEnabled:X,onToggleBeamEffect:()=>U("world"),onCycleDisplayMode:()=>q("world")})]})});function Dw(){const n=Kv(),e=Zm(),a=tb(),{fftLevels:s,getFftLevels:l,fftDataRef:o,timeDataRef:u}=Ao()||{},{devices:p,selectedDeviceId:h,setSelectedDeviceId:g,playAudio:v,stopAudio:S,pauseAllAudio:x,resumeAllAudio:b,setPlaybackRate:T,resetAllAudio:M,stopAllAudio:R,getAudioInfo:I,setClipVolume:Q}=ig();w.useRef(new Set),w.useRef(0);const A=w.useRef({}),_=w.useRef(new Map),k=w.useRef({}),G=w.useRef({}),F=w.useRef({}),K=w.useRef({}),le=w.useRef(new Set),H=w.useRef({}),[N,V]=w.useState(null),[U,q]=w.useState(!1),[ie,z]=w.useState("main"),[J,pe]=w.useState(!1),[me,X]=w.useState(!1),[$,he]=w.useState({midi:!1,artnet:!1,osc:!1,keyboard:!1}),[Ce,Pe]=w.useState(!1),[Ke,Xe]=w.useState(!1),[wt,dt]=w.useState(!1),[_e,Ze]=w.useState(!1),[ft,Rt]=w.useState({title:"",initialValue:"",onSave:()=>{}}),[Dt,zt]=w.useState("files"),[Xn,nt]=w.useState("clip"),[tt,ut]=w.useState([]),Yt=w.useRef(0),Vt=w.useRef(0),rt=w.useRef(0),Gt=w.useRef(performance.now()),[ze,xe]=w.useReducer(kw,ay(U?N:{})),wn=w.useRef(new Map),qt=w.useCallback((L,D,W=30)=>{wn.current.has(L)&&clearTimeout(wn.current.get(L));const Z=setTimeout(()=>{xe(D),wn.current.delete(L)},W);wn.current.set(L,Z)},[]),{columns:Xt,layers:$t,clipContents:pt,clipNames:os,thumbnailFrameIndexes:xa,layerEffects:ar,layerAssignedDacs:On,layerIntensities:rr,layerAutopilots:ea,layerBlackouts:La,layerSolos:$n,masterIntensity:Hr,globalBlackout:pa,selectedLayerIndex:at,selectedColIndex:gt,notification:Yr,dacs:Ma,selectedDac:Sa,ildaFrames:Pi,selectedIldaWorkerId:ja,selectedIldaTotalFrames:Vr,bpm:cs,showBeamEffect:sr,beamAlpha:Wn,fadeAlpha:un,playbackFps:tn,previewScanRate:Cn,beamRenderMode:ha,worldShowBeamEffect:Ft,worldBeamRenderMode:us,optimizationEnabled:ta,activeClipIndexes:hn,isPlaying:Fa,isStopped:ir,isWorldOutputActive:Mn,activePageId:nn,numPages:lr,selectedGeneratorId:yn,selectedGeneratorParams:mn,thumbnailRenderMode:ot,theme:Et,dacOutputSettings:En,fileBrowserViewMode:Bi,fileBrowserPath:hi,layerUiStates:Ln,settingsPanelCollapsed:Ua,quickAssigns:or}=ze,ma=w.useMemo(()=>$t.map((L,D)=>{const W=hn[D];if(W&&W.colIndex!==null){const{pageId:Z,colIndex:re}=W,ce=pt[Z]?.[D]?.[re];if(ce){let we,Be=null;if(ce.type==="ilda"&&ce.workerId&&ce.totalFrames)return we=ce.workerId,Be=ce.stillFrame,{type:"ilda",workerId:we,totalFrames:ce.totalFrames,effects:ce.effects||[],dac:ce.dac||null,assignedDacs:ce.assignedDacs||[],ildaFormat:ce.ildaFormat||0,stillFrame:Be,layerIndex:D,pageId:Z,colIndex:re,syncSettings:ce.syncSettings||{},fps:ce.fps||null};if(ce.type==="generator"&&ce.frames&&ce.generatorDefinition)return we=`generator-${D}-${re}`,we=`generator-${Z}-${D}-${re}`,Be=ce.stillFrame||ce.frames?.[0]||null,{type:"generator",workerId:we,totalFrames:ce.frames.length,effects:ce.effects||[],dac:ce.dac||null,assignedDacs:ce.assignedDacs||[],ildaFormat:0,stillFrame:Be,layerIndex:D,pageId:Z,colIndex:re,syncSettings:ce.syncSettings||{},fps:ce.fps||null}}}return null}).filter(Boolean),[$t,hn,pt]),Zt=w.useRef(pt),St=w.useRef(null),ka=w.useRef(!1),kn=w.useRef(null),Pa=w.useRef(!1);w.useEffect(()=>{pt&&(St.current=structuredClone(pt))},[]),w.useEffect(()=>{En&&(kn.current=structuredClone(En))},[]);const an=w.useRef(rr),ga=w.useRef(ea),wa=w.useRef(ar),bn=w.useRef(Hr),cr=w.useRef(La),qr=w.useRef($n),Xr=w.useRef(pa),Tr=w.useRef(Fa),$r=w.useRef(Mn),mi=w.useRef(Sa),Zn=w.useRef(ze.bpm),Cr=w.useRef(at),fs=w.useRef(gt),Ba=w.useRef(null),Mr=w.useRef(I),_s=w.useRef(ta);w.useEffect(()=>{Tr.current=Fa},[Fa]),w.useEffect(()=>{$r.current=Mn},[Mn]),w.useEffect(()=>{mi.current=Sa},[Sa]),w.useEffect(()=>{Zn.current=ze.bpm},[ze.bpm]),w.useEffect(()=>{Cr.current=at},[at]),w.useEffect(()=>{fs.current=gt},[gt]),w.useEffect(()=>{Mr.current=I},[I]),w.useEffect(()=>{_s.current=ta},[ta]);const kr=w.useRef(tn);w.useEffect(()=>{kr.current=tn},[tn]);const za=w.useRef(En),ds=w.useRef(Ma),Nr=w.useRef([]),Rr=w.useRef(hn),Os=w.useRef(On),Wr=w.useRef(os),gi=w.useRef(ja),Ls=w.useRef(Vr),js=w.useRef({}),Dr=w.useRef(new Map),ur=w.useRef(new Map),fr=w.useRef(new Map),ps=w.useRef(null),Zr=w.useRef({}),dr=w.useRef(null),oa=w.useRef(0),Na=w.useRef(new Map),Ir=w.useRef(new Map),pr=w.useRef(new Map);w.useRef(performance.now()),w.useEffect(()=>{if(ka.current){ka.current=!1;return}pt&&(St.current=structuredClone(pt))},[pt]),w.useEffect(()=>{if(Pa.current){Pa.current=!1;return}En&&(kn.current=structuredClone(En))},[En]),w.useEffect(()=>{an.current=rr,ga.current=ea,wa.current=ar,bn.current=Hr,cr.current=La,qr.current=$n,Xr.current=pa,kr.current=tn,ds.current=Ma,Nr.current=ma,Zt.current=pt,Rr.current=hn,Os.current=On,Wr.current=os,gi.current=ja,Ls.current=Vr},[rr,On,ea,ar,Hr,La,$n,pa,En,Ma,ma,pt,hn,os,ja,Vr]);const Ea=w.useCallback(L=>{const D=1-L*2,W=[],Z=100;for(let re=0;re<Z;re++){const ce=re/(Z-1)*2-1;W.push({x:ce,y:D,r:0,g:255,b:0,blanking:!1})}return{points:W,isTypedArray:!1}},[]),hs=w.useCallback((L,D)=>{kn.current&&(kn.current[L]=D,Pa.current=!0),xe({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:L,settings:D}})},[]),Qr=w.useCallback(L=>{xe({type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:L}})},[]);w.useEffect(()=>{const L=tn/60;T(L)},[tn,T]);const An=L=>{xe({type:"SET_NOTIFICATION",payload:{message:L,visible:!0}}),setTimeout(()=>{xe({type:"SET_NOTIFICATION",payload:{message:"",visible:!1}})},3e3)};w.useEffect(()=>{const L={orange:"#ff5e00",yellow:"#ffd400",cyan:"#00fff3","light-blue":"#0089ff",blue:"#005aff",magenta:"#fb00ff",red:"#ff0000",green:"#00ff00",white:"#ffffff"},D=L[Et]||L.orange;document.documentElement.style.setProperty("--theme-color",D);const W=parseInt(D.slice(1,3),16),Z=parseInt(D.slice(3,5),16),re=parseInt(D.slice(5,7),16);document.documentElement.style.setProperty("--theme-color-transparent",`rgba(${W}, ${Z}, ${re}, 0.3)`),window.electronAPI&&window.electronAPI.setTheme&&window.electronAPI.setTheme(Et)},[Et]),w.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedDac&&window.electronAPI.setSelectedDac(Sa)},[Sa]),w.useMemo(()=>{const L=new Set;return ja&&L.add(ja),ma.forEach(D=>{D&&D.type==="ilda"&&D.workerId&&L.add(D.workerId)}),Array.from(L)},[ja,ma]),w.useEffect(()=>{if(!n)return;const L=async ye=>{if(!ye.data.browserFile){if(ye.data.type==="get-frame"&&ye.data.success)if(ye.data.isStillFrame){const{workerId:He,frame:Le,layerIndex:ke,colIndex:Qe,pageId:Fe=rn.current.activePageId}=ye.data;if(ke===void 0||Qe===void 0)return;let Te=null;const Ge=(St.current?St.current:Zt.current)?.[Fe]?.[ke]?.[Qe],Je=Ge?.effects||[];let ct=null;const Ct=Ge?.assignedDacs||[];if(Ct.length>0){const Mt=Ct[0],kt=`${Mt.ip}:${Mt.channel}`;ct=za.current[kt]}else if(Sa){const Mt=`${Sa.ip}:${Sa.channel}`;ct=za.current[Mt]}let Ut=Le;ct&&(Ut=Qf(Le,ct)),Te=await $f(Ut,Je,ke,Qe,ta),xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:ke,colIndex:Qe,content:{stillFrame:Le,parsing:!1,thumbnailPath:Te,thumbnailVersion:Date.now()}}})}else A.current[ye.data.workerId]=ye.data.frame;else if(ye.data.type==="parse-ilda"&&ye.data.success){const{workerId:He,totalFrames:Le,ildaFormat:ke,fileName:Qe,filePath:Fe,layerIndex:Te,colIndex:$e,pageId:Ge=rn.current.activePageId}=ye.data;if(Te===void 0||$e===void 0)return;const Je={type:"ilda",workerId:He,totalFrames:Le,ildaFormat:ke,fileName:Qe,filePath:Fe,parsing:!0,playbackSettings:{mode:"fps",duration:Le/60,beats:8,speedMultiplier:1}};xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:Te,colIndex:$e,content:Je}});const ct=Wr.current[Ge][Te][$e],Ct=`Clip ${Te+1}-${$e+1}`;ct===Ct&&xe({type:"SET_CLIP_NAME",payload:{layerIndex:Te,colIndex:$e,name:Qe}})}else if(ye.data.type==="get-all-frames"&&ye.data.success){console.log("Received get-all-frames response:",ye.data);const{frames:He,workerId:Le,layerIndex:ke,colIndex:Qe,pageId:Fe=rn.current.activePageId}=ye.data;if(ke===void 0||Qe===void 0)return;j0(async()=>{const{framesToIlda:Te}=await Promise.resolve().then(()=>W0);return{framesToIlda:Te}},void 0,import.meta.url).then(({framesToIlda:Te})=>{const $e=Te(He),Je=(Zt.current[Fe]?.[ke]?.[Qe]).fileName||"export.ild";window.electronAPI&&window.electronAPI.saveIldaFile&&window.electronAPI.saveIldaFile($e,Je).then(ct=>{ct.success?An(`Exported to ${ct.filePath}`):ct.error&&An(`Export failed: ${ct.error}`)})}).catch(Te=>console.error("Failed to load ilda-writer in response:",Te))}else if(ye.data.success===!1){An(`Worker error: ${ye.data.error}`);const{layerIndex:He,colIndex:Le}=ye.data;He!==void 0&&Le!==void 0&&xe({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:He,colIndex:Le,status:!1}})}}};n.addEventListener("message",L);let D,W,Z=0;const re=60,ce=1e3/re,we=ye=>{if(ye.length===0)return null;if(ye.length===1){const Qe=ye[0],Fe=Qe.points instanceof Float32Array||Qe.isTypedArray;return{...Qe,points:Fe?new Float32Array(Qe.points):Qe.points.map(Te=>({...Te})),isTypedArray:Fe}}let He=0;ye.forEach((Qe,Fe)=>{const $e=Qe.points instanceof Float32Array||Qe.isTypedArray?Qe.points.length/8:Qe.points.length;He+=$e,Fe<ye.length-1&&(He+=2)});const Le=new Float32Array(He*8);let ke=0;return ye.forEach((Qe,Fe)=>{const Te=Qe.points instanceof Float32Array||Qe.isTypedArray,$e=Te?Qe.points.length/8:Qe.points.length;for(let Ge=0;Ge<$e;Ge++){const Je=(ke+Ge)*8;if(Te){const ct=Ge*8;Le.set(Qe.points.subarray(ct,ct+8),Je)}else{const ct=Qe.points[Ge];Le[Je]=ct.x,Le[Je+1]=ct.y,Le[Je+2]=ct.z||0,Le[Je+3]=ct.r,Le[Je+4]=ct.g,Le[Je+5]=ct.b,Le[Je+6]=ct.blanking?1:0,Le[Je+7]=ct.lastPoint?1:0}Le[Je+7]=0}if(ke+=$e,Fe<ye.length-1){const Ge=ye[Fe+1],Je=Ge.points instanceof Float32Array||Ge.isTypedArray,ct=Le[(ke-1)*8],Ct=Le[(ke-1)*8+1];let Ut,Mt;Je?(Ut=Ge.points[0],Mt=Ge.points[1]):(Ut=Ge.points[0].x,Mt=Ge.points[0].y);let kt=ke*8;Le[kt]=ct,Le[kt+1]=Ct,Le[kt+6]=1,Le[kt+3]=0,Le[kt+4]=0,Le[kt+5]=0;let Tt=(ke+1)*8;Le[Tt]=Ut,Le[Tt+1]=Mt,Le[Tt+6]=1,Le[Tt+3]=0,Le[Tt+4]=0,Le[Tt+5]=0,ke+=2}}),Le[(He-1)*8+7]=1,{points:Le,isTypedArray:!0}},Be=ye=>{if(!$r.current){cancelAnimationFrame(W);return}if(ye-Z>ce){if(window.electronAPI&&$r.current){const He=new Map;Nr.current.forEach(ke=>{if(ke&&A.current[ke.workerId]){const Qe=Os.current[ke.layerIndex]||[],Fe=ke.assignedDacs||[];let Te=[...Qe,...Fe];Te.length===0&&mi.current&&(Te=[mi.current]);const $e=[],Ge=new Set;if(Te.forEach(At=>{const Gn=At.channel!==void 0?At.channel:At.channels&&At.channels.length>0?At.channels[0].serviceID:0,Rn=`${At.ip}:${Gn}`;Ge.has(Rn)||(Ge.add(Rn),$e.push({...At,channel:Gn}))}),$e.length===0)return;const ct=(St.current||Zt.current)[ke.pageId]?.[ke.layerIndex]?.[ke.colIndex],Ct=ct?ct.effects||[]:ke.effects||[],Ut=ke.layerIndex,Mt=wa.current[Ut]||[],kt=[...Ct,...Mt],Tt=A.current[ke.workerId],Nn=an.current[ke.layerIndex],vn=Xr.current,Qt=cr.current[ke.layerIndex],Da=qr.current[ke.layerIndex],na=qr.current.some(At=>At);let ca=Nn;vn?ca=0:na?Da?Qt&&(ca=0):ca=0:Qt&&(ca=0);const It=ca*bn.current;if(It<=0)return;const Pt=k.current[ke.workerId]||0;ct?.syncSettings||ke.syncSettings;const Aa={...Tt,points:Ue(Tt.points)?Tt.points:Tt.points.map(At=>({...At,r:Math.round(At.r*It),g:Math.round(At.g*It),b:Math.round(At.b*It)}))};if(Ue(Aa.points)){const At=Aa.points,Gn=At.length/8,Rn=new Float32Array(At);for(let aa=0;aa<Gn;aa++)Rn[aa*8+3]*=It,Rn[aa*8+4]*=It,Rn[aa*8+5]*=It;Aa.points=Rn}const Ta=ct?ct.playbackSettings:ke.playbackSettings||{};let xn=1;if(Ta.mode==="timeline")xn=Ta.duration||1;else if(Ta.mode==="bpm"){const At=Zn.current||120;xn=(Ta.beats||8)*60/At}else{const At=Ta.fps||ke.fps||kr.current||30;xn=(ke.totalFrames||30)/At}const jn=Ta.speedMultiplier||1;jn!==0&&(xn/=jn);const Kt=bo(Aa,kt,{progress:Pt,time:ye,effectStates:_.current,assignedDacs:$e,syncSettings:ke.syncSettings||{},bpm:Zn.current,clipDuration:xn,fftLevels:l?l():s});if(_s.current){const At=dd(Kt.points);Kt.points=At,Kt.isTypedArray=!0}$e.forEach((At,Gn)=>{const Rn=At.ip,aa=At.channel||(At.channels&&At.channels.length>0?At.channels[0].serviceID:0);if(aa!==void 0){const gs=`${Rn}:${aa}`;He.has(gs)||He.set(gs,{ip:Rn,channel:aa,type:At.type,frames:[]});let Xa=Kt;if(Kt.points&&Kt.points._channelDistributions){const Qn=Kt.points._channelDistributions.get(Gn);if(Qn){const gr=Kt.points.subarray(Qn.start,Qn.start+Qn.length);Xa={...Kt,points:gr}}else Xa={...Kt,points:new Float32Array(0)}}if(At.mirrorX||At.mirrorY){const Qn=Xa.points,gr=Xa.isTypedArray,Ml=gr?Qn.length/8:Qn.length,yr=gr?new Float32Array(Qn):Qn.map(Hn=>({...Hn}));for(let Hn=0;Hn<Ml;Hn++)gr?(At.mirrorX&&(yr[Hn*8]=-yr[Hn*8]),At.mirrorY&&(yr[Hn*8+1]=-yr[Hn*8+1])):(At.mirrorX&&(yr[Hn].x=-yr[Hn].x),At.mirrorY&&(yr[Hn].y=-yr[Hn].y));Xa={...Xa,points:yr}}He.get(gs).frames.push(Xa)}})}}),ds.current.forEach(ke=>{(ke.channels&&ke.channels.length>0?ke.channels.map(Fe=>Fe.serviceID):[0]).forEach(Fe=>{const Te=`${ke.ip}:${Fe}`,$e=kn.current?kn.current[Te]:za.current[Te];if($e){He.has(Te)||He.set(Te,{ip:ke.ip,channel:Fe,type:ke.type,frames:[]});const Ge=He.get(Te);if($e.testLineEnabled){const Je=Ea($e.testLineY!==void 0?$e.testLineY:.5);Ge.frames=[Je]}}})});let Le=0;He.forEach(ke=>{let Qe=we(ke.frames);const Fe=`${ke.ip}:${ke.channel}`,Te=kn.current?kn.current[Fe]:za.current[Fe];if(Qe&&Te){if(Te.dimmer!==void 0&&Te.dimmer<1){const $e=Te.dimmer,Ge=Qe.points,Je=Qe.isTypedArray,ct=Je?Ge.length/8:Ge.length;for(let Ct=0;Ct<ct;Ct++)Je?(Ge[Ct*8+3]*=$e,Ge[Ct*8+4]*=$e,Ge[Ct*8+5]*=$e):(Ge[Ct].r*=$e,Ge[Ct].g*=$e,Ge[Ct].b*=$e)}Qe=Qf(Qe,Te,!1)}if(Qe){Le++;const $e=Ue(Qe.points)?Qe.points.length/8:Qe.points.length;Vt.current+=$e,window.electronAPI.sendFrame(ke.ip,ke.channel,Qe.points,re,ke.type,{skipOptimization:!_s.current})}}),rt.current=Le}Z=ye}W=requestAnimationFrame(Be)};function Ue(ye){return!!ye&&(ye instanceof Float32Array||ye.buffer instanceof ArrayBuffer)}const qe=ye=>{const He=1e3/kr.current,Le=Zn.current||120,ke=(Fe,Te,$e,Ge)=>{const Je=Fe.pageId!==void 0?Fe.pageId:rn.current.activePageId;F.current[Ge]||(F.current[Ge]=ye);let ct=ye-F.current[Ge];ct>1e3&&(ct=He),Tr.current&&(Zr.current[Ge]===void 0&&(Zr.current[Ge]=0),Zr.current[Ge]+=ct);const Ct=Zr.current[Ge]||0,Ut=Rr.current[Te],kt=Ut&&Ut.pageId===Je&&Ut.colIndex===$e?Mr.current(Te):null;let Tt=K.current[Ge]||0,Nn=0;const vn=Fe.totalFrames||1,Qt=Fe.playbackSettings||{mode:"fps",duration:vn/60,beats:8,speedMultiplier:1};if(kt&&Tr.current&&!kt.paused)Nn=kt.duration>0?kt.currentTime/kt.duration:0,Tt=Math.floor(Nn*vn);else if(Qt.mode==="timeline"){const It=Qt.duration*1e3/(Qt.speedMultiplier||1);It>0&&(Nn=Ct/It%1,Tt=Math.floor(Nn*vn))}else if(Qt.mode==="bpm"){const It=6e4/Le,Pt=Qt.beats*It/(Qt.speedMultiplier||1);Pt>0&&(Nn=Ct/Pt%1,Tt=Math.floor(Nn*vn))}else{const Pt=1e3/((Qt.fps||60)*(Qt.speedMultiplier||1));if(ct>=Pt){const Aa=Math.floor(ct/Pt);Tr.current?(F.current[Ge]=ye-ct%Pt,Tt=Tt+Aa):F.current[Ge]=ye,Nn=vn>0?Tt%vn/vn:0}else return}Qt.mode!=="fps"&&(F.current[Ge]=ye),isNaN(Tt)&&(Tt=0),isNaN(Nn)&&(Nn=0);const na=(js.current[Ge]||0)>.9&&Nn<.1;if(js.current[Ge]=Nn,k.current[Ge]=Nn,vn>0&&(Tt=Tt%vn,Tt<0&&(Tt+=vn)),na&&Tr.current){const It=ga.current[Te];if(It&&It!=="off"){const Pt=Zt.current[Je]?.[Te]||[],Aa=Rr.current[Te];if(Aa&&Aa.pageId===Je){const Ta=Aa.colIndex;let xn=-1;if(It==="forward")for(let jn=1;jn<8;jn++){const Kt=(Ta+jn)%8;if(Pt[Kt]){xn=Kt;break}}else if(It==="random"){const jn=Pt.map((Kt,At)=>Kt?At:null).filter(Kt=>Kt!==null&&Kt!==Ta);jn.length>0&&(xn=jn[Math.floor(Math.random()*jn.length)])}xn!==-1&&setTimeout(()=>_r(Te,xn),0)}}}let ca=1;if(Qt.mode==="timeline"?ca=Qt.duration||1:Qt.mode==="bpm"?ca=(Qt.beats||8)*60/Le:Fe.type==="generator"&&(!Fe.frames||Fe.frames.length<=1)?ca=Qt.duration||1:ca=vn/(Qt.fps||60),Fe.type==="generator"){const It=Fe.syncSettings||{},Pt=Fe.generatorDefinition?.id,Aa=Fe.generatorDefinition,Ta=Object.keys(It).filter(xn=>xn.startsWith(`${Pt}.`));if(Ta.length>0){const xn=Fe.currentParams||{},jn={...xn};let Kt=!1;const At={time:ye,progress:Nn,bpm:Le,clipDuration:ca,fftLevels:l?l():s,activationTime:G.current[Te]||0};for(const Gn of Ta){const Rn=Gn.split(".")[1],aa=Aa?.paramControls?.find(Qn=>Qn.id===Rn),gs=xn[Rn]!==void 0?xn[Rn]:Fe.generatorDefinition.defaultParams[Rn],Xa=jc(Rn,gs,It[Gn],At,aa?.min,aa?.max);Xa!==jn[Rn]&&(jn[Rn]=Xa,Kt=!0)}if(Kt){const Gn=++oa.current;Ha(Te,$e,Fe.generatorDefinition,jn,Gn,!0)}}if(Pt==="waveform"){const xn=Fe.currentParams||{},jn=xn.mode==="waveform"?u.current:o.current,Kt=++oa.current,At={time:ye,activationTime:G.current[Te]||0};Ha(Te,$e,Fe.generatorDefinition,xn,Kt,!1,!0,jn,At)}else if(Pt==="timer"){const xn=Fe.currentParams||{},jn=++oa.current,Kt={time:ye,activationTime:G.current[Te]||0};Ha(Te,$e,Fe.generatorDefinition,xn,jn,!1,!0,null,Kt)}}(K.current[Ge]!==Tt||!A.current[Ge])&&(K.current[Ge]=Tt,Fe.type==="ilda"?n.postMessage({type:"get-frame",workerId:Ge,frameIndex:Tt,pageId:Je}):Fe.type==="generator"&&(Fe.frames&&Fe.frames.length>1?Fe.frames[Tt%Fe.frames.length]&&(A.current[Ge]=Fe.frames[Tt%Fe.frames.length]):!A.current[Ge]&&Fe.frames&&Fe.frames.length>0&&(A.current[Ge]=Fe.frames[0])))};$t.forEach((Fe,Te)=>{const $e=Rr.current[Te];if(!$e||$e.colIndex===null)return;const{pageId:Ge,colIndex:Je}=$e,Ct=(St.current||Zt.current)[Ge]?.[Te]?.[Je];if(!Ct)return;let Ut=Ct.type==="ilda"?Ct.workerId:Ct.type==="generator"?`generator-${Ge}-${Te}-${Je}`:null;Ut&&ke(Ct,Te,Je,Ut)});const Qe=gi.current;if(Qe&&!Nr.current.some(Fe=>Fe.workerId===Qe)){const Fe=Cr.current,Te=fs.current,$e=rn.current.activePageId;if(Fe!==null&&Te!==null){const Je=(St.current||Zt.current)[$e]?.[Fe]?.[Te];Je&&ke(Je,Fe,Te,Qe)}}if(dr.current){const{layerIndex:Fe,colIndex:Te}=dr.current,$e=rn.current.activePageId,Ge=Rr.current[Fe],Je=Ge&&Ge.pageId===$e&&Ge.colIndex===Te;Cr.current===Fe&&fs.current;const ct=gi.current;if(!Je){const Ut=(St.current||Zt.current)[$e]?.[Fe]?.[Te];if(Ut){let Mt=Ut.type==="ilda"?Ut.workerId:Ut.type==="generator"?`generator-${$e}-${Fe}-${Te}`:null;Mt&&Mt!==ct&&ke(Ut,Fe,Te,Mt)}}}D=requestAnimationFrame(qe)};return D=requestAnimationFrame(qe),Mn?W=requestAnimationFrame(Be):cancelAnimationFrame(W),()=>{n.removeEventListener("message",L),cancelAnimationFrame(D),cancelAnimationFrame(W)}},[n,Mn]),w.useEffect(()=>{let L,D,W;return window.electronAPI&&(L=window.electronAPI.onClipContextMenuCommand((Z,re,ce)=>{if(console.log(`Clip context menu command received: ${Z} for ${re}-${ce}`),Z==="export-ilda"){const we=Zt.current[re][ce];console.log("Exporting clip:",we),we&&(we.type==="ilda"&&we.workerId&&n?(An("Preparing ILDA export..."),console.log("Requesting frames from worker:",we.workerId),n.postMessage({type:"get-all-frames",workerId:we.workerId,layerIndex:re,colIndex:ce})):we.type==="generator"?(console.log("Exporting generator frames with parameter animation..."),(async()=>{const{framesToIlda:Ue}=await j0(async()=>{const{framesToIlda:Je}=await Promise.resolve().then(()=>W0);return{framesToIlda:Je}},void 0,import.meta.url),qe=tn||60;let ye=2;const He=we.playbackSettings||{};He.mode==="timeline"?ye=He.duration||2:He.mode==="bpm"?ye=(He.beats||8)*60/(ze.bpm||120):we.frames?.length>1&&(ye=we.frames.length/qe);const Le=Math.ceil(ye*qe),ke=[],Qe=new Map,Fe=we.generatorDefinition?.id;let Te=null;if(["text","spout-receiver"].includes(Fe)){const Je=we.currentParams?.fontUrl||"src/fonts/Geometr415 Blk BT Black.ttf";try{Je.startsWith("http")?Te=await window.electronAPI.fetchUrlAsArrayBuffer(Je):Te=await window.electronAPI.readFileForWorker(Je)}catch(ct){console.error("Failed to load font for export:",ct)}}for(let Je=0;Je<Le;Je++){const ct=Je*(1e3/qe),Ct=Je/Le,Ut=we.syncSettings||{},Mt=we.generatorDefinition,kt=we.currentParams||{},Tt={...kt},Nn={time:ct,progress:Ct,bpm:ze.bpm,clipDuration:ye,fftLevels:{low:0,mid:0,high:0},activationTime:0};for(const Qt in Ut)if(Qt.startsWith(`${Fe}.`)){const Da=Qt.split(".")[1],na=Mt?.paramControls?.find(It=>It.id===Da),ca=kt[Da]!==void 0?kt[Da]:Mt.defaultParams[Da];Tt[Da]=jc(Da,ca,Ut[Qt],Nn,na?.min,na?.max)}let vn=null;try{if(Fe==="circle")vn=Fm(Tt);else if(Fe==="square")vn=Um(Tt);else if(Fe==="line")vn=Pm(Tt);else if(Fe==="star")vn=Bm(Tt);else if(Fe==="text")vn=await jm(Tt,Te);else if(Fe==="spout-receiver")vn=await jm({...Tt,text:Tt.sourceName},Te);else if(we.frames){const Qt=Math.floor(Ct*we.frames.length)%we.frames.length;vn=we.frames[Qt]}}catch(Qt){console.error("Generation failed during export:",Qt)}if(vn){const Qt=(we.effects||[]).filter(Pt=>!((Pt.id==="delay"||Pt.id==="chase")&&Pt.params?.mode==="channel")),Da=bo(vn,Qt,{time:ct,progress:Ct,effectStates:Qe,syncSettings:we.syncSettings||{},bpm:ze.bpm,clipDuration:ye,assignedDacs:we.assignedDacs||[]}),na=Da.points,ca=na.length/8,It=[];for(let Pt=0;Pt<ca;Pt++)It.push({x:na[Pt*8],y:na[Pt*8+1],z:na[Pt*8+2],r:na[Pt*8+3],g:na[Pt*8+4],b:na[Pt*8+5],blanking:na[Pt*8+6]>.5,lastPoint:na[Pt*8+7]>.5});ke.push({...Da,points:It,frameName:`Frame ${Je}`,companyName:"TrueLazer"})}}const $e=Ue(ke),Ge=`${we.generatorDefinition?.name||"generator"}_export.ild`;if(window.electronAPI&&window.electronAPI.saveIldaFile){const Je=await window.electronAPI.saveIldaFile($e,Ge);Je.success?An(`Exported to ${Je.filePath}`):Je.error&&An(`Export failed: ${Je.error}`)}})().catch(Ue=>console.error("Failed to export generator:",Ue))):(console.warn("Clip type not supported for export or missing data:",we.type,we),we.type==="ilda"&&!we.workerId?An("Clip data not loaded. Please play the clip to load it."):we.type==="generator"&&!we.frames&&An("Generator not rendered yet.")))}else if(Z==="update-thumbnail"){const we=rn.current.activePageId,Be=pt[we]?.[re]?.[ce];if(Be){if(Be.type==="ilda"&&Be.workerId&&n){const Ue=K.current[Be.workerId]||0;n.postMessage({type:"get-frame",workerId:Be.workerId,frameIndex:Ue,isStillFrame:!0,layerIndex:re,colIndex:ce,pageId:we})}else if(Be.type==="generator"&&Be.generatorDefinition){const Ue=K.current[`generator-${we}-${re}-${ce}`]||0,qe=Be.frames?.[Ue%Be.frames.length];if(qe){const ye=Be.effects||[];$f(qe,ye,re,ce,ta).then(He=>{xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:re,colIndex:ce,content:{stillFrame:qe,thumbnailPath:He,thumbnailVersion:Date.now()}}})})}}}}else if(Z==="clear-clip")xe({type:"CLEAR_CLIP",payload:{layerIndex:re,colIndex:ce}});else if(Z==="rename-clip"){const we=rn.current.activePageId,Be=Wr.current[we][re][ce];Rt({title:"Rename Clip",initialValue:Be,onSave:Ue=>xe({type:"SET_CLIP_NAME",payload:{layerIndex:re,colIndex:ce,name:Ue}})}),Pe(!0)}else if(Z==="copy-clip"){const we=rn.current.activePageId,Be={content:Zt.current[we][re][ce],name:Wr.current[we][re][ce]};xe({type:"SET_CLIPBOARD",payload:Be}),An("Clip copied.")}else if(Z==="cut-clip"){const we=rn.current.activePageId,Be={content:Zt.current[we][re][ce],name:Wr.current[we][re][ce]};xe({type:"SET_CLIPBOARD",payload:Be}),xe({type:"CLEAR_CLIP",payload:{layerIndex:re,colIndex:ce}}),An("Clip cut.")}else if(Z==="paste-clip")if(ze.clipClipboard){const{content:we,name:Be}=ze.clipClipboard;let Ue=JSON.parse(JSON.stringify(we));if(Ue.type==="ilda"&&(Ue.workerId=null),Ue.effects&&Ue.effects.length>0){const ye={...Ue.syncSettings||{}};Ue.effects=Ue.effects.map(He=>{const Le=He.instanceId,ke=vo();return Object.keys(ye).forEach(Qe=>{if(Le&&Qe.startsWith(`${Le}.`)){const Fe=Qe.substring(Le.length);ye[`${ke}${Fe}`]=ye[Qe],delete ye[Qe]}}),{...He,instanceId:ke}}),Ue.syncSettings=ye}xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:re,colIndex:ce,content:Ue}}),xe({type:"SET_CLIP_NAME",payload:{layerIndex:re,colIndex:ce,name:Be}}),An("Clip pasted."),setTimeout(()=>{const qe=Ue;if(qe.type==="generator"&&qe.generatorDefinition){const ye=`${re}-${ce}`,He={...qe.generatorDefinition.defaultParams,...qe.currentParams};Dr.current.set(ye,JSON.stringify(He));const Le=++oa.current;Ha(re,ce,qe.generatorDefinition,qe.currentParams,Le)}},100)}else An("Clipboard is empty.");else Z==="set-trigger-style-normal"?xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:ce,style:"normal"}}):Z==="set-trigger-style-toggle"?xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:ce,style:"toggle"}}):Z==="set-trigger-style-flash"&&xe({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:ce,style:"flash"}})}),D=window.electronAPI.onLayerFullContextMenuCommand((Z,re)=>{if(console.log(`Layer context menu command received: ${Z} for ${re}`),Z==="layer-rename"){const ce=$t[re];Rt({title:"Rename Layer",initialValue:ce,onSave:we=>xe({type:"SET_LAYER_NAME",payload:{index:re,name:we}})}),Pe(!0)}else Z==="layer-clear-clips"&&xe({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:re}})}),W=window.electronAPI.onContextMenuActionFromMain(Z=>{if(console.log("General context menu action received:",Z),Z.type==="rename-column"){const re=Xt[Z.index];Rt({title:"Rename Column",initialValue:re,onSave:ce=>xe({type:"SET_COLUMN_NAME",payload:{index:Z.index,name:ce}})}),Pe(!0)}else if(Z.type==="rename-layer"){const re=$t[Z.index];Rt({title:"Rename Layer",initialValue:re,onSave:ce=>xe({type:"SET_LAYER_NAME",payload:{index:Z.index,name:ce}})}),Pe(!0)}else if(Z.type==="reset-quick-assign"){const re=Z.controlType==="knob"?0:!1;xe({type:"UPDATE_QUICK_CONTROL",payload:{type:Z.controlType,index:Z.index,value:re}})}else Z.type==="clear-quick-assign"&&xe({type:"CLEAR_QUICK_CONTROL",payload:{type:Z.controlType,index:Z.index}})})),()=>{L&&L(),D&&D(),W&&W()}},[pt,os,$t,Xt,n,a,ze.clipClipboard]);const ms=w.useRef(xa);w.useEffect(()=>{for(let L=0;L<(ze.numPages||8);L++)for(let D=0;D<$t.length;D++)for(let W=0;W<Xt.length;W++){const Z=xa[L]?.[D]?.[W]||0,re=ms.current[L]?.[D]?.[W]||0,ce=pt[L]?.[D]?.[W],we=ce?.workerId,Be=ur.current.get(`${L}-${D}-${W}`),Ue=Z!==re;(Ue||we&&!Be)&&ce&&ce.type==="ilda"&&we&&(console.log(`[App.jsx] Fetching still frame for ${L}-${D}-${W} at index ${Z}. Reason: ${Ue?"index change":"worker ready"}`),n.postMessage({type:"get-frame",workerId:we,frameIndex:Z,isStillFrame:!0,layerIndex:D,colIndex:W,pageId:L})),we?ur.current.set(`${L}-${D}-${W}`,we):ur.current.delete(`${L}-${D}-${W}`)}ms.current=xa},[xa,pt,$t.length,Xt.length,n,ze.numPages]),w.useEffect(()=>{a&&pt.forEach((L,D)=>{L.forEach((W,Z)=>{W.forEach((re,ce)=>{if(re&&re.type==="generator"&&re.generatorDefinition){if(re.generatorDefinition.id==="ndi-source")return;const we=`${D}-${Z}-${ce}`,Be={...re.generatorDefinition.defaultParams,...re.currentParams||{}},Ue=JSON.stringify(Be);if(Dr.current.get(we)!==Ue){console.log(`[App.jsx] Generator ${we} params changed, regenerating...`);const qe=++oa.current;Ha(Z,ce,re.generatorDefinition,re.currentParams,qe,!1,!1,null,null,D),Dr.current.set(we,Ue)}}})})})},[pt,a]),w.useEffect(()=>{if(!ze.projectLoadTimestamp||!n||!a)return;console.log("Project loaded, regenerating content...");const L=[];pt.forEach((D,W)=>{D.forEach((Z,re)=>{Z.forEach((ce,we)=>{if(ce){if(ce.type==="ilda"&&ce.filePath&&!ce.workerId)console.log(`Reparsing ILDA file for clip ${W}-${re}-${we}: ${ce.filePath}`),n.postMessage({type:"load-and-parse-ilda",fileName:ce.fileName,filePath:ce.filePath,layerIndex:re,colIndex:we,pageId:W});else if(ce.type==="generator"&&ce.generatorDefinition){console.log(`Regenerating generator clip ${W}-${re}-${we} on project load`);const Be=++oa.current;Ha(re,we,ce.generatorDefinition,ce.currentParams,Be,!1,!1,null,null,W)}ce.audioFile&&ce.audioFile.path&&window.electronAPI&&window.electronAPI.checkFileExists&&L.push(window.electronAPI.checkFileExists(ce.audioFile.path).then(Be=>{Be||ut(Ue=>{const qe=`audio-${W}-${re}-${we}`;return Ue.some(ye=>ye.requestId===qe)?Ue:[...Ue,{filePath:ce.audioFile.path,fileName:ce.audioFile.name||ce.audioFile.path.split(/[/\\]/).pop(),requestId:qe,type:"audio"}]})}))}})})})},[ze.projectLoadTimestamp,n,a]),w.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onUpdateThumbnailRenderMode){const L=window.electronAPI.onUpdateThumbnailRenderMode(D=>{console.log("App.jsx: Received thumbnail mode update:",D),xe({type:"SET_THUMBNAIL_RENDER_MODE",payload:D})});return()=>L()}},[]);const rn=w.useRef(ze);w.useEffect(()=>{rn.current=ze},[ze]),w.useEffect(()=>{let L,D,W,Z,re;return window.electronAPI&&(L=window.electronAPI.on("new-project",()=>xe({type:"RESET_STATE"})),D=window.electronAPI.on("open-project",()=>{}),W=window.electronAPI.on("save-project",()=>{console.log("Saving project with state:",rn.current),window.electronAPI.send("save-project",rn.current)}),Z=window.electronAPI.on("save-project-as",()=>{console.log("Saving project AS with state:",rn.current),window.electronAPI.send("save-project-as",rn.current)}),re=window.electronAPI.on("load-project-data",ce=>{xe({type:"LOAD_PROJECT",payload:ce})})),()=>{L&&L(),D&&D(),W&&W(),Z&&Z(),re&&re()}},[]),w.useEffect(()=>{let L,D;return(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const Z=await window.electronAPI.getAllSettings();Z&&(Z.shortcutsState&&he(Z.shortcutsState),xe({type:"LOAD_SETTINGS",payload:Z}))}})(),window.electronAPI&&(L=window.electronAPI.onMenuAction(Z=>{if(console.log("Menu action received:",Z),Z==="output-settings")Xe(!0);else if(Z==="shapeBuilder")z("shapeBuilder"),xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(Z==="timeline")z("timeline"),xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(Z==="about")pe(!0);else if(Z==="settings-audio-output")dt(!0);else if(Z==="settings-audio-fft")Ze(!0);else if(Z.startsWith("set-theme-")){const re=Z.split("set-theme-")[1];xe({type:"SET_THEME",payload:re})}else if(Z==="shortcuts-window"||Z.startsWith("open-")&&Z.endsWith("-settings"))X(!0);else if(Z==="column-duplicate")gt!==null&&(xe({type:"DUPLICATE_COLUMN",payload:{index:gt}}),An("Column duplicated."));else if(Z==="column-clear-clips")gt!==null&&$t.forEach((re,ce)=>{xe({type:"CLEAR_CLIP",payload:{layerIndex:ce,colIndex:gt}})});else if(Z.startsWith("toggle-")){const re=Z.split("-");if(re.length===3){const ce=re[1],we=re[2]==="true";he(Be=>({...Be,[ce]:we}))}}}),D=window.electronAPI.onRenderSettingsCommand(Z=>{console.log("Render settings command received:",Z),xe({type:"SET_RENDER_SETTING",payload:{setting:Z.setting,value:Z.value}})})),()=>{L&&L(),D&&D()}},[]),w.useEffect(()=>{if(!n)return;const L=async D=>{if(D.data.type==="request-file-content"){const{filePath:W,requestId:Z,maxBytes:re}=D.data;try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(W))throw new Error(`File not found: ${W}`);const ce=await window.electronAPI.readFileForWorker(W,re);n.postMessage({type:"file-content-response",requestId:Z,arrayBuffer:ce},[ce])}catch(ce){console.warn(`File missing or read error: ${W}`,ce.message);const we=W.split(/[/\\]/).pop();ut(Be=>Be.some(Ue=>Ue.requestId===Z)?Be:[...Be,{filePath:W,fileName:we,requestId:Z}])}}else if(D.data.type==="parsing-status"){const{layerIndex:W,colIndex:Z,status:re}=D.data;W!==void 0&&Z!==void 0&&(xe({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:W,colIndex:Z,status:re}}),re||xe({type:"SET_CLIP_PARSING_FAILED",payload:{layerIndex:W,colIndex:Z,failed:!0}}))}};return n.addEventListener("message",L),()=>{n.removeEventListener("message",L)}},[n]),w.useEffect(()=>{if(!e)return;const L=async D=>{if(D.data.type==="request-file-content"){const{filePath:W,requestId:Z,maxBytes:re}=D.data;try{const ce=await window.electronAPI.readFileForWorker(W,re);e.postMessage({type:"file-content-response",requestId:Z,arrayBuffer:ce},[ce])}catch(ce){console.error(`Thumbnail Worker: Error reading file: ${W}`,ce),e.postMessage({type:"file-content-response",requestId:Z,error:ce.message})}}};return e.addEventListener("message",L),()=>{e.removeEventListener("message",L)}},[e]),w.useEffect(()=>{if(!n)return;const L=[];pt.forEach((D,W)=>{D.forEach((Z,re)=>{Z&&Z.type==="ilda"&&Z.filePath&&!Z.workerId&&!Z.parsing&&!Z.parsingFailed&&L.push({layerIndex:W,colIndex:re,fileName:Z.fileName,filePath:Z.filePath})})}),L.length>0&&(console.log(`Triggering re-parse for ${L.length} clips.`),xe({type:"SET_BULK_PARSING_STATUS",payload:L.map(D=>({layerIndex:D.layerIndex,colIndex:D.colIndex,status:!0}))}),L.forEach(D=>{n.postMessage({type:"load-and-parse-ilda",fileName:D.fileName,filePath:D.filePath,layerIndex:D.layerIndex,colIndex:D.colIndex})}))},[pt,n]);const yi=St.current||pt,zn=ze.activePageId;if(at!==null){const L=ar[at]||[];if(gt!==null)[...yi[zn]?.[at]?.[gt]?.effects||[],...L];else{const D=hn[at];D&&D.colIndex!==null&&[...yi[D.pageId]?.[at]?.[D.colIndex]?.effects||[],...L]}}const Ga=w.useCallback((L,D,W,Z,re)=>{const ce=ze.activePageId;if(St.current&&St.current[ce]&&St.current[ce][L]&&St.current[ce][L][D]){const we=St.current[ce][L][D];we&&we.effects&&we.effects[W]&&(we.effects[W].params[Z]=re,ka.current=!0)}qt(`effect-${L}-${D}-${W}-${Z}`,{type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:L,colIndex:D,effectIndex:W,paramName:Z,newValue:re}})},[qt,ze.activePageId]);w.useEffect(()=>{if(!a)return;const L=D=>{if(!D.data.browserFile){if(D.data.layerIndex!==void 0&&D.data.colIndex!==void 0){const W=`${D.data.layerIndex}-${D.data.colIndex}`;if(Ir.current.set(W,!1),pr.current.has(W)){const{message:Z,transferables:re}=pr.current.get(W);pr.current.delete(W),Ir.current.set(W,!0),a.postMessage(Z,re)}}if(D.data.success){const{layerIndex:W,colIndex:Z,frames:re,generatorDefinition:ce,currentParams:we,isLive:Be,isAutoUpdate:Ue,seq:qe}=D.data;if(W===void 0||Z===void 0)return;if(qe!==void 0){const He=`${W}-${Z}`,Le=Na.current.get(He)||0;if(qe<Le)return;Na.current.set(He,qe)}const ye=`generator-${W}-${Z}`;if(A.current[ye]=re[0],!Be&&!Ue&&qe===oa.current){const{pageId:He=rn.current.activePageId}=D.data,ke=Zt.current?.[He]?.[W]?.[Z]||{},Qe={...ke,type:"generator",generatorDefinition:ce,frames:re,stillFrame:re[0],currentParams:we,playbackSettings:ke.playbackSettings||{mode:"fps",duration:re.length/60,beats:8,speedMultiplier:1}};xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:W,colIndex:Z,content:Qe}});const Fe=Wr.current[He][W][Z],Te=`Clip ${W+1}-${Z+1}`;Fe===Te&&xe({type:"SET_CLIP_NAME",payload:{layerIndex:W,colIndex:Z,name:ce.name}})}else D.data.isNdi&&window.electronAPI&&window.electronAPI.ndiRendererReady&&window.electronAPI.ndiRendererReady()}else An(`Error generating frames: ${D.data.error}`)}};return a.addEventListener("message",L),()=>{a.removeEventListener("message",L)}},[a]);const Fs=w.useCallback((L,D,W)=>{if(a){const Z=ze.activePageId,re=`${Z}-${L}-${D}`,ce={...W.defaultParams};Dr.current.set(re,JSON.stringify(ce));const we=++oa.current;Ha(L,D,W,W.defaultParams,we,!1,!1,null,null,Z)}},[a,ze.activePageId]),Kr=(L,D)=>{try{switch(L){case"circle":return Fm(D);case"square":return Um(D);case"line":return Pm(D);case"star":return Bm(D);case"sinewave":return Tw(D);default:return null}}catch(W){return console.error(`Error in synchronous live generation for ${L}:`,W),null}},Ha=async(L,D,W,Z,re,ce=!1,we=!1,Be=null,Ue=null,qe=ze.activePageId)=>{const ye={...W.defaultParams,...Z},He=`${qe}-${L}-${D}`;let Le=null,ke=null;if(["text","ndi-source","spout-receiver","timer"].includes(W.id)){const Te="src/fonts/Geometr415 Blk BT Black.ttf";if(ke=ye.fontUrl||Te,["https://raw.githubusercontent.com/google/fonts/main/ofl/roboto/Roboto-Regular.ttf","https://raw.githubusercontent.com/googlefonts/roboto-2/main/src/hinted/Roboto-Regular.ttf"].includes(ke)&&(ke=Te),fr.current.has(ke))Le=fr.current.get(ke);else try{if(ke.startsWith("http"))if(window.electronAPI&&window.electronAPI.fetchUrlAsArrayBuffer)Le=await window.electronAPI.fetchUrlAsArrayBuffer(ke);else throw new Error("URL fetching API is not available.");else if(window.electronAPI&&window.electronAPI.readFileForWorker)Le=await window.electronAPI.readFileForWorker(ke);else throw new Error("File reading API is not available.");Le&&fr.current.set(ke,Le)}catch(Ge){console.error(`Failed to load font for text generator at ${L}-${D}:`,Ge),An(`Font error: ${Ge.message}`);return}}const Qe={type:"generate",pageId:qe,layerIndex:L,colIndex:D,generator:W,params:ye,fontBuffer:ke&&!le.current.has(ke)?Le:null,audioData:Be,context:Ue,seq:re,isAutoUpdate:ce,isLive:we};ke&&Le&&le.current.add(ke);const Fe=[];Ir.current.get(He)?pr.current.set(He,{message:Qe,transferables:Fe}):(Ir.current.set(He,!0),a&&a.postMessage(Qe,Fe))},fn=w.useCallback(L=>{S(L),xe({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:L}})},[S]),hr=w.useCallback(()=>{R(),xe({type:"CLEAR_ALL_ACTIVE_CLIPS"})},[R]),Ya=w.useCallback(()=>{b(),$t.forEach((L,D)=>{const W=hn[D];if(W&&W.colIndex!==null){const Z=pt[W.pageId]?.[D]?.[W.colIndex];Z&&Z.audioFile&&!I(D)&&v(D,Z.audioFile.path,Z.audioVolume??1,!0)}}),xe({type:"SET_IS_PLAYING",payload:!0}),xe({type:"SET_IS_STOPPED",payload:!1})},[b,$t,hn,pt,I,v]),Va=w.useCallback(()=>{x(),xe({type:"SET_IS_PLAYING",payload:!1}),xe({type:"SET_IS_STOPPED",payload:!1})},[x]),mr=w.useCallback(()=>{M(),x(),xe({type:"SET_IS_PLAYING",payload:!1}),xe({type:"SET_IS_STOPPED",payload:!0}),K.current={}},[M,x]),vi=w.useCallback(()=>{const L=!Mn;xe({type:"SET_WORLD_OUTPUT_ACTIVE",payload:L}),window.electronAPI&&(L?ze.dacs.forEach(D=>{window.electronAPI.startDacOutput(D.ip,D.type)}):ze.dacs.forEach(D=>{window.electronAPI.stopDacOutput(D.ip,D.type)}))},[Mn,ze.dacs]),Ra=w.useCallback((L,D)=>{const W=ze.activePageId;xe({type:"SET_SELECTED_CLIP",payload:{layerIndex:L,colIndex:D}});const Z=pt[W]?.[L]?.[D];if(Z&&Z.type==="ilda")xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:Z.workerId,totalFrames:Z.totalFrames,generatorId:null,generatorParams:{}}});else if(Z&&Z.type==="generator"){const re=`generator-${W}-${L}-${D}`;xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:re,generatorId:Z.generatorDefinition.id,generatorParams:Z.currentParams,totalFrames:Z.frames.length}})}else xe({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:null,totalFrames:0,generatorId:null,generatorParams:{}}})},[pt,ze.activePageId]),Us=w.useCallback((L,D,W)=>{W?dr.current={layerIndex:L,colIndex:D}:dr.current&&dr.current.layerIndex===L&&dr.current.colIndex===D&&(dr.current=null)},[]),_r=w.useCallback((L,D,W=!0)=>{const Z=ze.activePageId,re=pt[Z]?.[L]?.[D];if(!re){W&&(Ra(L,D),fn(L));return}const ce=re.triggerStyle||"normal",we=hn[L],Be=we&&we.pageId===Z&&we.colIndex===D;if(ce==="normal"){if(!W)return}else if(ce==="toggle"){if(!W)return;if(Be){fn(L);return}}else if(ce==="flash"&&!W){Be&&fn(L);return}if(re&&re.type==="generator"&&re.frames&&re.frames.length>0){const Ue=`generator-${Z}-${L}-${D}`;A.current[Ue]=re.frames[0],F.current[Ue]=performance.now(),K.current[Ue]=0}else re&&re.type==="ilda"&&re.workerId&&(F.current[re.workerId]=performance.now(),K.current[re.workerId]=0);if(re&&re.audioFile?v(L,re.audioFile.path,re.audioVolume??1,Tr.current).catch(Ue=>{console.warn(`Failed to play audio for clip ${Z}-${L}-${D}:`,Ue),ut(qe=>{const ye=`audio-${Z}-${L}-${D}`;return qe.some(He=>He.requestId===ye)?qe:[...qe,{filePath:re.audioFile.path,fileName:re.audioFile.name||re.audioFile.path.split(/[/\\]/).pop(),requestId:ye,type:"audio"}]})}):S(L),G.current[L]=performance.now(),xe({type:"SET_ACTIVE_CLIP",payload:{layerIndex:L,colIndex:D}}),re){if(re.type==="ilda"&&re.workerId){const Ue=K.current[re.workerId]||0;xe({type:"UPDATE_THUMBNAIL",payload:{layerIndex:L,colIndex:D,frameIndex:Ue}})}else if(re.type==="generator"&&re.frames){const Ue=K.current[`generator-${Z}-${L}-${D}`]||0,qe=re.frames[Ue%re.frames.length];qe&&xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:L,colIndex:D,content:{stillFrame:qe}}})}}},[pt,hn,ze.activePageId,fn,v,Fa,S,Ra]),Tl=w.useCallback((L,D,W)=>{const Z=ze.activePageId;if(St.current&&St.current[Z]&&St.current[Z][L]&&St.current[Z][L][D]){const re=St.current[Z][L][D];if(re){const ce={...W,instanceId:vo(),params:{...W.defaultParams}};re.effects=[...re.effects||[],ce],ka.current=!0}}xe({type:"ADD_CLIP_EFFECT",payload:{layerIndex:L,colIndex:D,effect:W}})},[ze.activePageId]),Ps=w.useCallback((L,D)=>{const W=xl.find(Z=>(Z.id||Z.name)===D);W&&xe({type:"ADD_LAYER_EFFECT",payload:{layerIndex:L,effect:W}})},[]),Cl=w.useCallback((L,D,W)=>{ka.current=!0,W.isGroup?xe({type:"SET_CLIP_DAC_GROUP",payload:{layerIndex:L,colIndex:D,groupDacs:W.channels}}):xe({type:"SET_CLIP_DAC",payload:{layerIndex:L,colIndex:D,dac:W}})},[]),qa=w.useCallback((L,D)=>{D.isGroup?xe({type:"SET_LAYER_DAC_GROUP",payload:{layerIndex:L,groupDacs:D.channels}}):xe({type:"SET_LAYER_DAC",payload:{layerIndex:L,dac:D}})},[]),Bs=L=>{window.electronAPI&&window.electronAPI.showLayerFullContextMenu&&window.electronAPI.showLayerFullContextMenu(L)},zi=L=>{window.electronAPI&&window.electronAPI.showColumnContextMenu&&window.electronAPI.showColumnContextMenu(L)},y=L=>{const D=ze.activePageId;$t.forEach((W,Z)=>{const re=pt[D]?.[Z]?.[L];re&&(re.type==="ilda"||re.type==="generator")?_r(Z,L):fn(Z)})},C=w.useCallback(L=>{xe({type:"SET_SELECTED_DAC",payload:L})},[]),Y=w.useCallback(L=>{xe({type:"SET_DACS",payload:L})},[]),P=w.useCallback(L=>{at!==null&&gt!==null?xe({type:"SET_CLIP_DAC_GROUP",payload:{layerIndex:at,colIndex:gt,groupDacs:L}}):at!==null?xe({type:"SET_LAYER_DAC_GROUP",payload:{layerIndex:at,groupDacs:L}}):An("Please select a layer or clip first to apply a DAC group.")},[at,gt]),B=w.useCallback((L,D,W)=>{xe({type:"REGISTER_PROJECT_PRESET",payload:{type:L,subType:D,preset:W}})},[]),O=(L,D)=>{const W=ze.activePageId;if(at!==null&&gt!==null){let Z=null,re={};if(St.current&&St.current[W]&&St.current[W][at]&&St.current[W][at][gt]){const He=St.current[W][at][gt];He&&He.currentParams&&(He.currentParams[L]=D,ka.current=!0,Z=He,re=He.currentParams)}if(Z||(Z=pt[W]?.[at]?.[gt],Z&&Z.currentParams&&(re={...Z.currentParams,[L]:D})),!Z||!Z.generatorDefinition)return;const ce=Z.generatorDefinition.id,we=`generator-${W}-${at}-${gt}`,Be=Kr(ce,re);Be&&(A.current[we]=Be),qt(`generator-${W}-${at}-${gt}-${L}`,{type:"UPDATE_GENERATOR_PARAM",payload:{layerIndex:at,colIndex:gt,paramName:L,newValue:D}});const Ue=`${W}-${at}-${gt}`,qe={...Z.generatorDefinition.defaultParams,...re};Dr.current.set(Ue,JSON.stringify(qe));const ye=++oa.current;Ha(at,gt,Z.generatorDefinition,re,ye,!1,!0,null,null,W)}},ne=at!==null&&gt!==null?pt[ze.activePageId]?.[at]?.[gt]:null;w.useEffect(()=>{if(!window.electronAPI||!a)return;(async()=>{let D=null;$t.forEach((Z,re)=>{const ce=hn[re];if(ce&&ce.colIndex!==null){const we=pt[ce.pageId]?.[re]?.[ce.colIndex];we&&we.type==="generator"&&we.generatorDefinition?.id==="ndi-source"&&(D=we)}}),!D&&ne?.type==="generator"&&ne?.generatorDefinition?.id==="ndi-source"&&(D=ne);const W=D?.currentParams?.sourceName;W&&W!=="No Source"?W!==ps.current&&(console.log(`[NDI] Switching to source: ${W}`),await window.electronAPI.ndiCreateReceiver(W),ps.current=W):ps.current&&(console.log("[NDI] Destroying receiver"),await window.electronAPI.ndiDestroyReceiver(),ps.current=null)})()},[hn,pt,ne,$t]),w.useEffect(()=>{const L=[...ma,ne].find(D=>D?.type==="generator"&&D?.generatorDefinition?.id==="ndi-source");if(L&&window.electronAPI?.ndiUpdateSettings){const{captureWidth:D,captureHeight:W}=L.currentParams||{};D&&W&&window.electronAPI.ndiUpdateSettings({width:D,height:W})}},[ma,ne]),w.useEffect(()=>{if(!window.electronAPI||!a)return;const L=W=>{let Z=!1;Rr.current.forEach((re,ce)=>{if(re===null)return;const we=Zt.current[ce][re];we&&we.type==="generator"&&we.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:ce,colIndex:re,generator:we.generatorDefinition,params:{...we.generatorDefinition.defaultParams,...we.currentParams},ndiFrame:W,isLive:!0,isNdi:!0}),Z=!0)}),Ba.current?.type==="generator"&&Ba.current?.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:Cr.current,colIndex:fs.current,generator:Ba.current.generatorDefinition,params:{...Ba.current.generatorDefinition.defaultParams,...Ba.current.currentParams},ndiFrame:W,isLive:!0,isNdi:!0}),Z=!0),Z||window.electronAPI.ndiRendererReady()},D=window.electronAPI.onNdiFrame(L);return()=>D()},[a]);const ue=w.useCallback((L,D,W)=>{const Z=L==="knob"?"knobs":"buttons",re=ze.quickAssigns[Z][D];if(re.link){const{layerIndex:ce,colIndex:we,effectIndex:Be,targetType:Ue}=re.link,qe=re.link.paramName||re.link.paramId;let ye=W;if(L==="knob"&&re.min!==void 0&&re.max!==void 0&&(ye=re.min+W*(re.max-re.min),re.step&&(ye=Math.round(ye/re.step)*re.step),ye=parseFloat(ye.toFixed(5))),Ue==="global")qe==="master_intensity"?bn.current=ye:qe==="master_speed"&&(kr.current=ye);else if(Ue==="layerEffect")wa.current[ce]&&wa.current[ce][Be]&&(wa.current[ce][Be].params[qe]=ye);else if(Ue==="effect"||Ue==="generator"){const He=re.link.pageId??ze.activePageId;if(St.current&&St.current[He]&&St.current[He][ce]&&St.current[He][ce][we]){const Le=St.current[He][ce][we];Ue==="effect"&&Le.effects&&Le.effects[Be]?Le.effects[Be].params[qe]=ye:Ue==="generator"&&Le.currentParams&&(Le.currentParams[qe]=ye),ka.current=!0}}}qt(`quick-${L}-${D}`,{type:"UPDATE_QUICK_CONTROL",payload:{type:L,index:D,value:W}})},[ze.quickAssigns,qt]),te=w.useCallback(L=>{const D=ze.quickAssigns.buttons[L],W=D.link,Z=!D.value;if(W){const{layerIndex:re,colIndex:ce,effectIndex:we,targetType:Be}=W,Ue=W.paramName||W.paramId;if(Be==="transport"){Ue==="play"?Ya():Ue==="pause"?Va():Ue==="stop"&&mr();return}if(Be==="global"){if(Ue==="blackout")Xr.current=Z;else if(Ue==="laser_output"){vi();return}else if(Ue==="clear"){hr();return}}else if(Be==="layer")Ue==="blackout"?cr.current[re]=Z:Ue==="solo"?(qr.current.fill(!1),qr.current[re]=Z):Ue==="autopilot"&&(ga.current[re]=Z?"forward":"off");else if(Be==="layerEffect")wa.current[re]&&wa.current[re][we]&&(wa.current[re][we].params[Ue]=Z);else if(Be==="effect"||Be==="generator"){const qe=W.pageId??ze.activePageId;if(St.current&&St.current[qe]&&St.current[qe][re]&&St.current[qe][re][ce]){const ye=St.current[qe][re][ce];Be==="effect"&&ye.effects&&ye.effects[we]?ye.effects[we].params[Ue]=Z:Be==="generator"&&ye.currentParams&&(ye.currentParams[Ue]=Z),ka.current=!0}}}xe({type:"TOGGLE_QUICK_BUTTON",payload:{index:L}})},[ze.quickAssigns,Ya,Va,mr,vi,hr,ze.activePageId]),ee=w.useCallback((L,D,W=127,Z="noteon",re=null)=>{if(D===0&&!L.endsWith("_intensity")&&L!=="master_intensity"&&L!=="master_speed"&&!L.startsWith("clip_")&&L!=="bpm_value"&&L!=="bpm_fine_up"&&L!=="bpm_fine_down"&&!L.startsWith("quick_")&&!L.startsWith("dimmer_")&&!L.includes("_item_"))return;let ce=D/W;const we=re?.controlMode||"absolute";if(Z==="controlchange"){if(we==="relative"){let ye=0;D<=10?ye=D*.01:D>=118&&(ye=(D-128)*.01),ce=ye}else if(we==="fake_relative"){const ye=re?.key||L,He=H.current[ye]??D;H.current[ye]=D,ce=(D-He)/W}}const Be=re?.targetType||"position",qe=(()=>{if(Be==="selectedLayer")return{layerIndex:Cr.current,colIndex:null};if(Be==="thisClip"){const ye=L.split("_");if(ye[0]==="clip"&&ye.length>=3)return{layerIndex:parseInt(ye[1]),colIndex:parseInt(ye[2])}}return null})();switch(L){case"transport_play":D>0&&Ya();break;case"transport_pause":D>0&&Va();break;case"transport_stop":D>0&&mr();break;case"comp_blackout":D>0&&xe({type:"TOGGLE_GLOBAL_BLACKOUT"});break;case"comp_clear":D>0&&hr();break;case"master_intensity":we==="absolute"?bn.current=ce:bn.current=Math.max(0,Math.min(1,bn.current+ce)),qt("master_intensity",{type:"SET_MASTER_INTENSITY",payload:bn.current});break;case"master_speed":const ye=(kr.current-1)/119;let He=ce;we!=="absolute"&&(He=Math.max(0,Math.min(1,ye+ce)));const Le=Math.max(1,Math.round(He*119+1));qt("master_speed",{type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:Le}});break;case"laser_output":D>0&&xe({type:"TOGGLE_WORLD_OUTPUT_ACTIVE"});break;case"bpm_value":if(Z==="controlchange"){let Te=0;we==="absolute"?D<=10?Te=D:D>=118&&(Te=D-128):Te=Math.round(ce*100),Te!==0&&xe({type:"SET_BPM",payload:Math.max(1,Math.min(999,(ze.bpm||120)+Te))})}break;case"bpm_fine_up":D>0&&xe({type:"SET_BPM",payload:Math.min(999,(ze.bpm||120)+.1)});break;case"bpm_fine_down":D>0&&xe({type:"SET_BPM",payload:Math.max(1,(ze.bpm||120)-.1)});break;case"bpm_tap":break;default:if(L.startsWith("middle_bar_page_")){if(D>0){const Te=parseInt(L.split("_")[3]);xe({type:"SET_ACTIVE_PAGE",payload:Te})}return}let ke=L,Qe=null,Fe=null;if(qe&&(Qe=qe.layerIndex,Fe=qe.colIndex,L.startsWith("layer_")||L.startsWith("clip_"))){const Te=L.split("_"),$e=Te[Te.length-1];Fe!==null?ke=`clip_${Qe}_${Fe}_${$e}`:ke=`layer_${Qe}_${$e}`}if(ke.includes("_item_")){if(D===0)return;const[Te,$e]=ke.split("_item_"),Ge=Te.split("_");if(Ge.length>=2&&at!==null&&gt!==null){const Je=Ge[0],ct=Ge.slice(1).join("_"),Ut=pt[rn.current.activePageId]?.[at]?.[gt]?.effects?.findIndex(Mt=>Mt.id===Je);Ut!==-1&&xe({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:at,colIndex:gt,effectIndex:Ut,paramName:ct,newValue:$e}})}return}if(ke.startsWith("layer_")){const Te=ke.split("_"),$e=parseInt(Te[1]),Ge=Te[2];if(Ge==="blackout"&&D>0)xe({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:$e}});else if(Ge==="solo"&&D>0)xe({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:$e}});else if(Ge==="intensity"){let Je=ce;we!=="absolute"&&(Je=Math.max(0,Math.min(1,(an.current[$e]||0)+ce))),an.current[$e]=Je,qt(`layer_${$e}_intensity`,{type:"SET_LAYER_INTENSITY",payload:{layerIndex:$e,intensity:Je}})}else Ge==="clear"&&D>0&&fn($e)}else if(ke.startsWith("clip_")){const Te=ke.split("_"),$e=parseInt(Te[1]),Ge=parseInt(Te[2]),Je=Te[3];Je==="preview"?D>0&&Ra($e,Ge):Je==="intensity"?xe({type:"SET_CLIP_INTENSITY",payload:{layerIndex:$e,colIndex:Ge,intensity:ce}}):_r($e,Ge,D>0)}else if(ke.startsWith("column_")){const Te=ke.split("_"),$e=parseInt(Te[1]);D>0&&y($e)}else if(ke.startsWith("quick_knob_")){const Te=parseInt(ke.split("_")[2]);ue("knob",Te,ce)}else if(ke.startsWith("quick_btn_")){const Te=parseInt(ke.split("_")[2]);D>0&&te(Te)}else if(ke.startsWith("dimmer_")){const Te=ke.replace("dimmer_","").replace(/_/g,"."),$e=En[Te]||{};xe({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:Te,settings:{...$e,dimmer:ce}}})}else{const Te=ke.split("_");if(Te.length>=2&&at!==null&&gt!==null){const $e=rn.current.activePageId,Ge=pt[$e]?.[at]?.[gt];if(Ge&&Ge.effects){const Je=Te[0],ct=Te.slice(1).join("_"),Ct=Ge.effects.findIndex(Ut=>Ut.id===Je);if(Ct!==-1){const Mt=xl.find(kt=>kt.id===Je)?.paramControls.find(kt=>kt.id===ct);if(Mt){let kt=ce;if(Mt.type==="range"||Mt.type==="number"){const Tt=Ge.effects[Ct].params[ct]??Mt.min;if(we==="absolute")kt=Mt.min+ce*(Mt.max-Mt.min);else{const Nn=ce*(Mt.max-Mt.min);kt=Tt+Nn}kt=Math.max(Mt.min,Math.min(Mt.max,kt)),Mt.step&&(kt=Math.round(kt/Mt.step)*Mt.step)}else Mt.type==="checkbox"&&(kt=ce>.5);xe({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:at,colIndex:gt,effectIndex:Ct,paramName:ct,newValue:kt}})}}}}}}},[Ya,Va,mr,hr,fn,Qr,ze.bpm,ze.activePageId,Ra,_r,y,pt,at,gt,En]),ae=w.useCallback(L=>{if(L==="world"){const W=!(ze.worldShowBeamEffect??!0);if(xe({type:"SET_RENDER_SETTING",payload:{setting:"worldShowBeamEffect",value:W}}),window.electronAPI&&window.electronAPI.setRenderSettings){const Z={...ze.renderSettings,showBeamEffect:ze.showBeamEffect,beamRenderMode:ze.beamRenderMode,previewScanRate:ze.previewScanRate,beamAlpha:ze.beamAlpha,fadeAlpha:ze.fadeAlpha,worldShowBeamEffect:W,worldBeamRenderMode:ze.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(Z)}}else{const D=!sr;if(xe({type:"SET_RENDER_SETTING",payload:{setting:"showBeamEffect",value:D}}),window.electronAPI&&window.electronAPI.setRenderSettings){const W={showBeamEffect:D,beamRenderMode:ha,previewScanRate:Cn,beamAlpha:Wn,fadeAlpha:un,worldShowBeamEffect:ze.worldShowBeamEffect??!0,worldBeamRenderMode:ze.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(W)}}},[sr,ha,Cn,Wn,un,ze.worldShowBeamEffect,ze.worldBeamRenderMode]),fe=w.useCallback(L=>{if(L==="world"){const D=ze.worldBeamRenderMode??"both";let W="points";if(D==="both"?W="points":D==="points"?W="lines":D==="lines"&&(W="both"),xe({type:"SET_RENDER_SETTING",payload:{setting:"worldBeamRenderMode",value:W}}),window.electronAPI&&window.electronAPI.setRenderSettings){const Z={showBeamEffect:sr,beamRenderMode:ha,previewScanRate:Cn,beamAlpha:Wn,fadeAlpha:un,worldShowBeamEffect:ze.worldShowBeamEffect??!0,worldBeamRenderMode:W};window.electronAPI.setRenderSettings(Z)}}else{let D="points";if(ha==="both"?D="points":ha==="points"?D="lines":ha==="lines"&&(D="both"),xe({type:"SET_RENDER_SETTING",payload:{setting:"beamRenderMode",value:D}}),window.electronAPI&&window.electronAPI.setRenderSettings){const W={showBeamEffect:sr,beamRenderMode:D,previewScanRate:Cn,beamAlpha:Wn,fadeAlpha:un,worldShowBeamEffect:ze.worldShowBeamEffect??!0,worldBeamRenderMode:ze.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(W)}}},[sr,ha,Cn,Wn,un,ze.worldShowBeamEffect,ze.worldBeamRenderMode]),Ae=async L=>{if(!(!window.electronAPI||!window.electronAPI.showOpenDialog))try{const D=await window.electronAPI.showOpenDialog({title:`Locate missing file: ${L.fileName}`,defaultPath:L.filePath,filters:[{name:"ILDA Files",extensions:["ild"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(D){const W=D,Z=window.electronAPI.pathSeparator||(W.includes("/")?"/":"\\");if(xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:L.filePath,newPath:W}}),L.type!=="audio"){const ye=await window.electronAPI.readFileForWorker(W);n&&n.postMessage({type:"file-content-response",requestId:L.requestId,arrayBuffer:ye},[ye])}ut(ye=>ye.filter(He=>He.requestId!==L.requestId));const re=ye=>ye.substring(0,ye.lastIndexOf(Z)),ce=ye=>ye.substring(ye.lastIndexOf(Z)+1),we=re(L.filePath),Be=re(W);console.log(`[Relocate] Scanning for other files moving from [${we}] to [${Be}]`);const Ue=rn.current.clipContents.flat().filter(ye=>ye),qe=new Set([L.filePath]);for(const ye of Ue){if(ye.type==="ilda"&&ye.filePath&&!qe.has(ye.filePath)&&re(ye.filePath)===we){const He=ce(ye.filePath),Le=`${Be}${Z}${He}`;ye.filePath!==Le&&await window.electronAPI.checkFileExists(Le)&&(console.log(`[Relocate] Auto-resolving ILDA: ${He}`),xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:ye.filePath,newPath:Le}}),qe.add(ye.filePath),n&&ut(Qe=>Qe.filter(Fe=>Fe.filePath!==ye.filePath)))}if(ye.audioFile&&ye.audioFile.path&&!qe.has(ye.audioFile.path)&&re(ye.audioFile.path)===we){const He=ce(ye.audioFile.path),Le=`${Be}${Z}${He}`;ye.audioFile.path!==Le&&await window.electronAPI.checkFileExists(Le)&&(console.log(`[Relocate] Auto-resolving Audio: ${He}`),xe({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:ye.audioFile.path,newPath:Le}}),qe.add(ye.audioFile.path),ut(Qe=>Qe.filter(Fe=>Fe.filePath!==ye.audioFile.path)))}}}}catch(D){console.error("Relocation failed:",D),An(`Relocation failed: ${D.message}`)}},De=w.useCallback((L,D)=>{const W=rn.current.activePageId;console.log(`Thumbnail load error for ${W}-${L}-${D}, requesting regeneration...`);const Z=Zt.current[W]?.[L]?.[D];if(Z)if(Z.type==="ilda"&&Z.workerId&&n){const re=xa[W][L][D]||0;n.postMessage({type:"get-frame",workerId:Z.workerId,frameIndex:re,isStillFrame:!0,layerIndex:L,colIndex:D,pageId:W})}else Z.type==="generator"&&Z.stillFrame&&$f(Z.stillFrame,Z.effects,L,D,ta).then(re=>{re&&xe({type:"SET_CLIP_CONTENT",payload:{layerIndex:L,colIndex:D,content:{thumbnailPath:re,thumbnailVersion:Date.now()}}})})},[Zt,xa,n,ta]),Oe=w.useCallback((L,D)=>{const W=rn.current.activePageId,Z=Zt.current[W]?.[L]?.[D];Z&&Z.audioFile&&ut(re=>{const ce=`audio-${W}-${L}-${D}`;return re.some(we=>we.requestId===ce)?re:[...re,{filePath:Z.audioFile.path,fileName:Z.audioFile.name||Z.audioFile.path.split(/[/\\]/).pop(),requestId:ce,type:"audio"}]})},[Zt]),Ye=Bn.memo(({isPlaying:L,globalBlackout:D,layerBlackouts:W,layerSolos:Z,isWorldOutputActive:re,clipContents:ce,activeClipIndexes:we,selectedLayerIndex:Be,selectedColIndex:Ue,quickAssigns:qe,activePageId:ye,theme:He})=>{const{sendFeedback:Le}=Hc();return w.useEffect(()=>{if(!Le)return;const ke=zm[He]||zm.orange,Qe=ye;$t.forEach((Fe,Te)=>{Xt.forEach(($e,Ge)=>{const Je=`clip_${Te}_${Ge}`,ct=we[Te],Ct=ct&&ct.pageId===Qe&&ct.colIndex===Ge,Ut=Be===Te&&Ue===Ge,Mt=!!ce[Qe]?.[Te]?.[Ge];let kt="empty";Ct?kt="active":Ut?kt="previewing":Mt&&(kt="inactive"),Le(Je,Ct,kt)})}),Le("transport_play",L?ke.full:ke.dim),Le("transport_stop",L?ke.dim:ke.full),Le("blackout",D),Le("laser_output",re),$t.forEach((Fe,Te)=>{Le(`layer_${Te}_blackout`,W[Te]),Le(`layer_${Te}_solo`,Z[Te])}),qe&&qe.buttons&&qe.buttons.forEach((Fe,Te)=>{Le(`quick_btn_${Te}`,Fe.value?ke.full:0)})},[we,Be,Ue,ce,L,D,re,W,Z,Le,qe,He]),null});return f.jsx(H1,{onMidiCommand:ee,children:f.jsx(Y1,{onArtnetCommand:(L,D)=>ee(L,D,255),children:f.jsxs(V1,{onCommand:ee,enabled:$.keyboard,children:[f.jsx(Ye,{isPlaying:Fa,globalBlackout:pa,layerBlackouts:La,layerSolos:$n,isWorldOutputActive:Mn,clipContents:pt,activeClipIndexes:hn,selectedLayerIndex:at,selectedColIndex:gt,quickAssigns:or,activePageId:nn,theme:Et}),"    ",f.jsx(rb,{}),ie==="main"?f.jsx("div",{className:"app",children:f.jsxs(qv,{children:[f.jsx(Dv,{message:Yr.message,visible:Yr.visible}),f.jsx(Qv,{show:J,onClose:()=>pe(!1)}),f.jsx(Hv,{show:Ke,onClose:()=>Xe(!1),dacs:Ma,dacSettings:En,onUpdateDacSettings:hs}),f.jsx(Yv,{show:wt||_e,onClose:()=>{dt(!1),Ze(!1)},initialTab:_e?"fft":"output"}),f.jsx(zv,{show:Ce,title:ft.title,initialValue:ft.initialValue,onSave:ft.onSave,onClose:()=>X(!1)||Pe(!1)}),f.jsx(Vv,{missingFiles:tt,onRelocate:Ae,onClose:()=>ut([])}),f.jsxs("div",{className:"main-content",children:[f.jsxs("div",{className:"top-bar-left-area",children:[f.jsx(X1,{masterIntensity:Hr,onMasterIntensityChange:L=>xe({type:"SET_MASTER_INTENSITY",payload:L}),onClearAllActive:hr,isGlobalBlackout:pa,onToggleGlobalBlackout:()=>xe({type:"TOGGLE_GLOBAL_BLACKOUT"})}),f.jsx(Mw,{isWorldOutputActive:Mn,onToggleWorldOutput:vi})]}),f.jsxs("div",{className:"layer-controls-container",children:[$t.map((L,D)=>{const W=ma.find(re=>re.layerIndex===D),Z=W?A.current[W.workerId]:null;return f.jsx(hv,{layerName:L,index:D,onDropEffect:re=>Ps(D,re),onDropDac:(re,ce)=>qa(re,ce),layerEffects:ar[D],activeClipData:W,liveFrame:Z,thumbnailRenderMode:ot,intensity:rr[D],onIntensityChange:re=>xe({type:"SET_LAYER_INTENSITY",payload:{layerIndex:D,intensity:re}}),onDeactivateLayerClips:()=>fn(D),onShowLayerFullContextMenu:()=>Bs(D),isBlackout:La[D],isSolo:$n[D],onToggleBlackout:()=>xe({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:D}}),onToggleSolo:()=>xe({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:D}}),onLayerSelect:re=>xe({type:"SET_SELECTED_CLIP",payload:{layerIndex:re,colIndex:null}})},D)}),"          "]}),f.jsx("div",{className:"clip-deck-container",children:f.jsxs("div",{className:"clip-deck",children:[f.jsx("div",{className:"column-headers-container",children:Xt.map((L,D)=>f.jsx($1,{name:L,index:D,onTrigger:()=>y(D),onShowColumnHeaderContextMenu:()=>zi(D)},D))}),$t.map((L,D)=>f.jsx("div",{className:"layer-row",children:Xt.map((W,Z)=>{const re=nn,ce=pt?.[re]?.[D]?.[Z];let we=null;ce&&ce.type==="ilda"?we=ce.workerId:ce&&ce.type==="generator"&&(we=`generator-${re}-${D}-${Z}`);const Be=we?A.current[we]:null,Ue=ce?.stillFrame||(ce?.type==="generator"?ce.frames?.[0]:null),qe=hn[D],ye=qe&&qe.pageId===re&&qe.colIndex===Z;return f.jsx(gv,{layerIndex:D,colIndex:Z,pageId:re,clipName:os?.[re]?.[D]?.[Z]||`Clip ${D+1}-${Z+1}`,clipContent:ce,thumbnailFrameIndex:xa[re]?.[D]?.[Z]||0,thumbnailRenderMode:ot,liveFrame:Be,stillFrame:Ue,onActivateClick:He=>_r(D,Z,He),isActive:ye,onUnsupportedFile:An,onDropEffect:He=>Tl(D,Z,He),onDropGenerator:Fs,onDropDac:(He,Le,ke)=>{Cl(He,Le,ke)},onLabelClick:()=>Ra(D,Z),isSelected:at===D&&gt===Z,ildaParserWorker:n,onClipHover:Us,onThumbnailError:De},Z)})},D))]})}),f.jsx(Rw,{clipContents:pt,activeClipIndexes:hn,layerEffects:ar,bpm:cs,playbackFps:tn,selectedLayerIndex:at,selectedColIndex:gt,liveFramesRef:A,progressRef:k,selectedDac:Sa,liveDacOutputSettingsRef:kn,dacOutputSettings:En,getAudioInfo:I,fftLevels:s,getFftLevels:l,effectStatesRef:_,clipActivationTimesRef:G,showBeamEffect:sr,beamAlpha:Wn,fadeAlpha:un,previewScanRate:Cn,beamRenderMode:ha,worldShowBeamEffect:Ft,worldBeamRenderMode:us,masterIntensity:Hr,layerIntensities:rr,globalBlackout:pa,layerSolos:$n,layerBlackouts:La,handleToggleBeamEffect:ae,handleCycleDisplayMode:fe,previewFrameCountRef:Yt,totalPointsSentRef:Vt,activeChannelsCountRef:rt,lastStatUpdateTimeRef:Gt,liveClipContentsRef:St,optimizationEnabled:ta,onRegisterPreset:B,activePageId:nn}),f.jsxs("div",{className:"middle-bar",children:[f.jsx("div",{className:"middle-bar-left-area",children:f.jsx(jv,{bpm:cs,onBpmChange:L=>xe({type:"SET_BPM",payload:L})})}),f.jsxs("div",{className:"middle-bar-mid-area",children:[f.jsx(Fv,{onPlay:Ya,onPause:Va,onStop:mr,isPlaying:Fa,isStopped:ir}),f.jsx(Cw,{playbackFps:tn,onSpeedChange:Qr})]}),f.jsx("div",{className:"middle-bar-right-area",children:f.jsx("div",{className:"page-navigation",children:Array.from({length:lr||8}).map((L,D)=>f.jsx(pn,{id:`middle_bar_page_${D}`,children:f.jsx("button",{className:`page-btn ${nn===D?"active":""}`,onClick:()=>xe({type:"SET_ACTIVE_PAGE",payload:D}),style:{background:nn===D?"var(--theme-color)":"#333",color:nn===D?"#000":"#ccc",border:"none",padding:"2px 8px",margin:"0 2px",borderRadius:"3px",fontSize:"11px",cursor:"pointer",fontWeight:"bold"},children:D+1})},D))})})]}),f.jsxs("div",{className:"bottom-panel",children:[f.jsxs("div",{className:"bottom-panel-tabs-container-1",children:[f.jsxs("div",{className:"bottom-panel-tabs-1",children:[f.jsx("button",{className:`tab-button-1 ${Dt==="files"?"active":""}`,onClick:()=>zt("files"),children:"Files"}),f.jsx("button",{className:`tab-button-1 ${Dt==="generators"?"active":""}`,onClick:()=>zt("generators"),children:"Generators"}),f.jsx("button",{className:`tab-button-1 ${Dt==="effects"?"active":""}`,onClick:()=>zt("effects"),children:"Effects"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-1",children:[Dt==="files"&&f.jsx(vv,{viewMode:Bi,onViewModeChange:L=>xe({type:"SET_FILE_BROWSER_VIEW_MODE",payload:L}),path:hi,onPathChange:L=>xe({type:"SET_FILE_BROWSER_PATH",payload:L}),onDropIld:(L,D,W)=>n.postMessage({type:"parse-ilda",file:W,layerIndex:L,colIndex:D,pageId:nn})}),Dt==="generators"&&f.jsx(bv,{}),Dt==="effects"&&f.jsx(xv,{})]})]}),f.jsxs("div",{className:"bottom-panel-tabs-container-2",children:[f.jsxs("div",{className:"bottom-panel-tabs-2",children:[f.jsx("button",{className:`tab-button-2 ${Xn==="clip"?"active":""}`,onClick:()=>nt("clip"),children:"Clip-Settings"}),f.jsx("button",{className:`tab-button-2 ${Xn==="layer"?"active":""}`,onClick:()=>nt("layer"),children:"Layer-Settings"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-2",children:[Xn==="clip"&&f.jsx(Nv,{selectedLayerIndex:at,selectedColIndex:gt,clip:ne,audioInfo:I(at),bpm:cs,getFftLevels:l,onAssignAudio:async()=>{const L=await window.electronAPI.showAudioFileDialog();if(L){const D=L.split(/[\\/]/).pop();xe({type:"SET_CLIP_AUDIO",payload:{layerIndex:at,colIndex:gt,audioFile:{path:L,name:D}}})}},onRemoveAudio:()=>{S(at),xe({type:"REMOVE_CLIP_AUDIO",payload:{layerIndex:at,colIndex:gt}})},onUpdateAudioVolume:(L,D,W)=>{xe({type:"SET_CLIP_AUDIO_VOLUME",payload:{layerIndex:L,colIndex:D,volume:W}}),Q(L,W)},onUpdatePlaybackSettings:(L,D,W)=>xe({type:"UPDATE_CLIP_PLAYBACK_SETTINGS",payload:{layerIndex:L,colIndex:D,settings:W}}),onSetParamSync:(L,D)=>xe({type:"SET_CLIP_PARAM_SYNC",payload:{layerIndex:at,colIndex:gt,paramId:L,syncMode:D}}),onToggleDacMirror:(L,D,W,Z)=>xe({type:"TOGGLE_CLIP_DAC_MIRROR",payload:{layerIndex:L,colIndex:D,dacIndex:W,axis:Z}}),onRemoveDac:L=>xe({type:"REMOVE_CLIP_DAC",payload:{layerIndex:at,colIndex:gt,dacIndex:L}}),onRemoveEffect:(L,D,W)=>xe({type:"REMOVE_CLIP_EFFECT",payload:{layerIndex:L,colIndex:D,effectIndex:W}}),onReorderEffects:(L,D,W,Z)=>xe({type:"REORDER_CLIP_EFFECTS",payload:{layerIndex:L,colIndex:D,oldIndex:W,newIndex:Z}}),onAddEffect:L=>xe({type:"ADD_CLIP_EFFECT",payload:{layerIndex:at,colIndex:gt,effect:L}}),onUpdateClipUiState:(L,D,W)=>xe({type:"UPDATE_CLIP_UI_STATE",payload:{layerIndex:L,colIndex:D,uiState:W}}),onParameterChange:Ga,onGeneratorParameterChange:O,progressRef:k,onAudioError:Oe,onRegisterPreset:B}),Xn==="layer"&&f.jsx(Rv,{selectedLayerIndex:at,autopilotMode:at!==null?ea[at]:"off",onAutopilotChange:L=>xe({type:"SET_LAYER_AUTOPILOT",payload:{layerIndex:at,mode:L}}),layerEffects:at!==null?ar[at]:[],assignedDacs:at!==null&&On?On[at]:[],onToggleDacMirror:(L,D,W)=>xe({type:"TOGGLE_LAYER_DAC_MIRROR",payload:{layerIndex:L,dacIndex:D,axis:W}}),onRemoveDac:(L,D)=>xe({type:"REMOVE_LAYER_DAC",payload:{layerIndex:L,dacIndex:D}}),onAddEffect:L=>at!==null&&xe({type:"ADD_LAYER_EFFECT",payload:{layerIndex:at,effect:L}}),onRemoveEffect:L=>at!==null&&xe({type:"REMOVE_LAYER_EFFECT",payload:{layerIndex:at,effectIndex:L}}),onParamChange:(L,D,W)=>at!==null&&xe({type:"UPDATE_LAYER_EFFECT_PARAMETER",payload:{layerIndex:at,effectIndex:L,paramName:D,newValue:W}}),uiState:at!==null?Ln[at]:{},onUpdateUiState:L=>xe({type:"UPDATE_LAYER_UI_STATE",payload:{layerIndex:at,uiState:L}}),onRegisterPreset:B})]})]}),f.jsx(Sv,{dacs:Ma,onDacSelected:C,onDacsDiscovered:Y,dacSettings:En,onUpdateDacSettings:hs,onApplyGroup:P}),f.jsx(Bv,{enabledShortcuts:$,onOpenOutputSettings:()=>Xe(!0),onOpenShortcutsSettings:()=>X(!0),quickAssigns:or,renderSettings:{showBeamEffect:sr,beamAlpha:Wn,fadeAlpha:un,previewScanRate:Cn,beamRenderMode:ha,worldShowBeamEffect:Ft,worldBeamRenderMode:us,settingsPanelCollapsed:ze.settingsPanelCollapsed,optimizationEnabled:ta},onSetRenderSetting:(L,D)=>{xe(L==="optimizationEnabled"?{type:"SET_OPTIMIZATION_ENABLED",payload:D}:{type:"SET_RENDER_SETTING",payload:{setting:L,value:D}})},onUpdateKnob:(L,D)=>{ue("knob",L,D)},onToggleButton:L=>{te(L)},onAssign:(L,D,W)=>xe({type:"ASSIGN_QUICK_CONTROL",payload:{type:L,index:D,link:W}})})]}),f.jsx("div",{className:"SystemMonitor",children:f.jsx(Nw,{playbackFps:tn,previewScanRate:Cn,previewFrameCountRef:Yt,totalPointsSentRef:Vt,activeChannelsCountRef:rt,lastStatUpdateTimeRef:Gt})})]})]})}):ie==="shapeBuilder"?f.jsx(Wv,{onBack:()=>z("main")}):f.jsx(Zv,{onBack:()=>z("main")})]})})})}D1.createRoot(document.getElementById("root")).render(f.jsx(Iv,{children:f.jsx(Jv,{children:f.jsxs(eb,{children:[" ",f.jsx(yv,{children:f.jsx(Mv,{children:f.jsx(Dw,{})})})]})})}));

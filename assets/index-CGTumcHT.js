(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();function nd(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Tf={exports:{}},jl={};var T0;function mv(){if(T0)return jl;T0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(i,o,c){var f=null;if(c!==void 0&&(f=""+c),o.key!==void 0&&(f=""+o.key),"key"in o){c={};for(var h in o)h!=="key"&&(c[h]=o[h])}else c=o;return o=c.ref,{$$typeof:a,type:i,key:f,ref:o!==void 0?o:null,props:c}}return jl.Fragment=e,jl.jsx=r,jl.jsxs=r,jl}var C0;function gv(){return C0||(C0=1,Tf.exports=mv()),Tf.exports}var m=gv(),Cf={exports:{}},vt={};var M0;function yv(){if(M0)return vt;M0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),x=Symbol.iterator;function b(U){return U===null||typeof U!="object"?null:(U=x&&U[x]||U["@@iterator"],typeof U=="function"?U:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,C={};function _(U,ee,ve){this.props=U,this.context=ee,this.refs=C,this.updater=ve||S}_.prototype.isReactComponent={},_.prototype.setState=function(U,ee){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,ee,"setState")},_.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function I(){}I.prototype=_.prototype;function M(U,ee,ve){this.props=U,this.context=ee,this.refs=C,this.updater=ve||S}var N=M.prototype=new I;N.constructor=M,E(N,_.prototype),N.isPureReactComponent=!0;var D=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function P(U,ee,ve,Me,me,Ce){return ve=Ce.ref,{$$typeof:a,type:U,key:ee,ref:ve!==void 0?ve:null,props:Ce}}function q(U,ee){return P(U.type,ee,void 0,void 0,void 0,U.props)}function Y(U){return typeof U=="object"&&U!==null&&U.$$typeof===a}function te(U){var ee={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(ve){return ee[ve]})}var H=/\/+/g;function Z(U,ee){return typeof U=="object"&&U!==null&&U.key!=null?te(""+U.key):ee.toString(36)}function W(){}function X(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(W,W):(U.status="pending",U.then(function(ee){U.status==="pending"&&(U.status="fulfilled",U.value=ee)},function(ee){U.status==="pending"&&(U.status="rejected",U.reason=ee)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function K(U,ee,ve,Me,me){var Ce=typeof U;(Ce==="undefined"||Ce==="boolean")&&(U=null);var Oe=!1;if(U===null)Oe=!0;else switch(Ce){case"bigint":case"string":case"number":Oe=!0;break;case"object":switch(U.$$typeof){case a:case e:Oe=!0;break;case v:return Oe=U._init,K(Oe(U._payload),ee,ve,Me,me)}}if(Oe)return me=me(U),Oe=Me===""?"."+Z(U,0):Me,D(me)?(ve="",Oe!=null&&(ve=Oe.replace(H,"$&/")+"/"),K(me,ee,ve,"",function(bt){return bt})):me!=null&&(Y(me)&&(me=q(me,ve+(me.key==null||U&&U.key===me.key?"":(""+me.key).replace(H,"$&/")+"/")+Oe)),ee.push(me)),1;Oe=0;var at=Me===""?".":Me+":";if(D(U))for(var tt=0;tt<U.length;tt++)Me=U[tt],Ce=at+Z(Me,tt),Oe+=K(Me,ee,ve,Ce,me);else if(tt=b(U),typeof tt=="function")for(U=tt.call(U),tt=0;!(Me=U.next()).done;)Me=Me.value,Ce=at+Z(Me,tt++),Oe+=K(Me,ee,ve,Ce,me);else if(Ce==="object"){if(typeof U.then=="function")return K(X(U),ee,ve,Me,me);throw ee=String(U),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.")}return Oe}function F(U,ee,ve){if(U==null)return U;var Me=[],me=0;return K(U,Me,"","",function(Ce){return ee.call(ve,Ce,me++)}),Me}function z(U){if(U._status===-1){var ee=U._result;ee=ee(),ee.then(function(ve){(U._status===0||U._status===-1)&&(U._status=1,U._result=ve)},function(ve){(U._status===0||U._status===-1)&&(U._status=2,U._result=ve)}),U._status===-1&&(U._status=0,U._result=ee)}if(U._status===1)return U._result.default;throw U._result}var ie=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ee=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(ee))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)};function be(){}return vt.Children={map:F,forEach:function(U,ee,ve){F(U,function(){ee.apply(this,arguments)},ve)},count:function(U){var ee=0;return F(U,function(){ee++}),ee},toArray:function(U){return F(U,function(ee){return ee})||[]},only:function(U){if(!Y(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},vt.Component=_,vt.Fragment=r,vt.Profiler=o,vt.PureComponent=M,vt.StrictMode=i,vt.Suspense=p,vt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,vt.__COMPILER_RUNTIME={__proto__:null,c:function(U){return k.H.useMemoCache(U)}},vt.cache=function(U){return function(){return U.apply(null,arguments)}},vt.cloneElement=function(U,ee,ve){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var Me=E({},U.props),me=U.key,Ce=void 0;if(ee!=null)for(Oe in ee.ref!==void 0&&(Ce=void 0),ee.key!==void 0&&(me=""+ee.key),ee)!G.call(ee,Oe)||Oe==="key"||Oe==="__self"||Oe==="__source"||Oe==="ref"&&ee.ref===void 0||(Me[Oe]=ee[Oe]);var Oe=arguments.length-2;if(Oe===1)Me.children=ve;else if(1<Oe){for(var at=Array(Oe),tt=0;tt<Oe;tt++)at[tt]=arguments[tt+2];Me.children=at}return P(U.type,me,void 0,void 0,Ce,Me)},vt.createContext=function(U){return U={$$typeof:f,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:c,_context:U},U},vt.createElement=function(U,ee,ve){var Me,me={},Ce=null;if(ee!=null)for(Me in ee.key!==void 0&&(Ce=""+ee.key),ee)G.call(ee,Me)&&Me!=="key"&&Me!=="__self"&&Me!=="__source"&&(me[Me]=ee[Me]);var Oe=arguments.length-2;if(Oe===1)me.children=ve;else if(1<Oe){for(var at=Array(Oe),tt=0;tt<Oe;tt++)at[tt]=arguments[tt+2];me.children=at}if(U&&U.defaultProps)for(Me in Oe=U.defaultProps,Oe)me[Me]===void 0&&(me[Me]=Oe[Me]);return P(U,Ce,void 0,void 0,null,me)},vt.createRef=function(){return{current:null}},vt.forwardRef=function(U){return{$$typeof:h,render:U}},vt.isValidElement=Y,vt.lazy=function(U){return{$$typeof:v,_payload:{_status:-1,_result:U},_init:z}},vt.memo=function(U,ee){return{$$typeof:y,type:U,compare:ee===void 0?null:ee}},vt.startTransition=function(U){var ee=k.T,ve={};k.T=ve;try{var Me=U(),me=k.S;me!==null&&me(ve,Me),typeof Me=="object"&&Me!==null&&typeof Me.then=="function"&&Me.then(be,ie)}catch(Ce){ie(Ce)}finally{k.T=ee}},vt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},vt.use=function(U){return k.H.use(U)},vt.useActionState=function(U,ee,ve){return k.H.useActionState(U,ee,ve)},vt.useCallback=function(U,ee){return k.H.useCallback(U,ee)},vt.useContext=function(U){return k.H.useContext(U)},vt.useDebugValue=function(){},vt.useDeferredValue=function(U,ee){return k.H.useDeferredValue(U,ee)},vt.useEffect=function(U,ee,ve){var Me=k.H;if(typeof ve=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Me.useEffect(U,ee)},vt.useId=function(){return k.H.useId()},vt.useImperativeHandle=function(U,ee,ve){return k.H.useImperativeHandle(U,ee,ve)},vt.useInsertionEffect=function(U,ee){return k.H.useInsertionEffect(U,ee)},vt.useLayoutEffect=function(U,ee){return k.H.useLayoutEffect(U,ee)},vt.useMemo=function(U,ee){return k.H.useMemo(U,ee)},vt.useOptimistic=function(U,ee){return k.H.useOptimistic(U,ee)},vt.useReducer=function(U,ee,ve){return k.H.useReducer(U,ee,ve)},vt.useRef=function(U){return k.H.useRef(U)},vt.useState=function(U){return k.H.useState(U)},vt.useSyncExternalStore=function(U,ee,ve){return k.H.useSyncExternalStore(U,ee,ve)},vt.useTransition=function(){return k.H.useTransition()},vt.version="19.1.1",vt}var N0;function ad(){return N0||(N0=1,Cf.exports=yv()),Cf.exports}var T=ad();const ha=nd(T);var Mf={exports:{}},Pl={},Nf={exports:{}},Rf={};var R0;function vv(){return R0||(R0=1,(function(a){function e(F,z){var ie=F.length;F.push(z);e:for(;0<ie;){var be=ie-1>>>1,U=F[be];if(0<o(U,z))F[be]=z,F[ie]=U,ie=be;else break e}}function r(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var z=F[0],ie=F.pop();if(ie!==z){F[0]=ie;e:for(var be=0,U=F.length,ee=U>>>1;be<ee;){var ve=2*(be+1)-1,Me=F[ve],me=ve+1,Ce=F[me];if(0>o(Me,ie))me<U&&0>o(Ce,Me)?(F[be]=Ce,F[me]=ie,be=me):(F[be]=Me,F[ve]=ie,be=ve);else if(me<U&&0>o(Ce,ie))F[be]=Ce,F[me]=ie,be=me;else break e}}return z}function o(F,z){var ie=F.sortIndex-z.sortIndex;return ie!==0?ie:F.id-z.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;a.unstable_now=function(){return c.now()}}else{var f=Date,h=f.now();a.unstable_now=function(){return f.now()-h}}var p=[],y=[],v=1,x=null,b=3,S=!1,E=!1,C=!1,_=!1,I=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function D(F){for(var z=r(y);z!==null;){if(z.callback===null)i(y);else if(z.startTime<=F)i(y),z.sortIndex=z.expirationTime,e(p,z);else break;z=r(y)}}function k(F){if(C=!1,D(F),!E)if(r(p)!==null)E=!0,G||(G=!0,Z());else{var z=r(y);z!==null&&K(k,z.startTime-F)}}var G=!1,P=-1,q=5,Y=-1;function te(){return _?!0:!(a.unstable_now()-Y<q)}function H(){if(_=!1,G){var F=a.unstable_now();Y=F;var z=!0;try{e:{E=!1,C&&(C=!1,M(P),P=-1),S=!0;var ie=b;try{t:{for(D(F),x=r(p);x!==null&&!(x.expirationTime>F&&te());){var be=x.callback;if(typeof be=="function"){x.callback=null,b=x.priorityLevel;var U=be(x.expirationTime<=F);if(F=a.unstable_now(),typeof U=="function"){x.callback=U,D(F),z=!0;break t}x===r(p)&&i(p),D(F)}else i(p);x=r(p)}if(x!==null)z=!0;else{var ee=r(y);ee!==null&&K(k,ee.startTime-F),z=!1}}break e}finally{x=null,b=ie,S=!1}z=void 0}}finally{z?Z():G=!1}}}var Z;if(typeof N=="function")Z=function(){N(H)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,X=W.port2;W.port1.onmessage=H,Z=function(){X.postMessage(null)}}else Z=function(){I(H,0)};function K(F,z){P=I(function(){F(a.unstable_now())},z)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(F){F.callback=null},a.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<F?Math.floor(1e3/F):5},a.unstable_getCurrentPriorityLevel=function(){return b},a.unstable_next=function(F){switch(b){case 1:case 2:case 3:var z=3;break;default:z=b}var ie=b;b=z;try{return F()}finally{b=ie}},a.unstable_requestPaint=function(){_=!0},a.unstable_runWithPriority=function(F,z){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var ie=b;b=F;try{return z()}finally{b=ie}},a.unstable_scheduleCallback=function(F,z,ie){var be=a.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?be+ie:be):ie=be,F){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=ie+U,F={id:v++,callback:z,priorityLevel:F,startTime:ie,expirationTime:U,sortIndex:-1},ie>be?(F.sortIndex=ie,e(y,F),r(p)===null&&F===r(y)&&(C?(M(P),P=-1):C=!0,K(k,ie-be))):(F.sortIndex=U,e(p,F),E||S||(E=!0,G||(G=!0,Z()))),F},a.unstable_shouldYield=te,a.unstable_wrapCallback=function(F){var z=b;return function(){var ie=b;b=z;try{return F.apply(this,arguments)}finally{b=ie}}}})(Rf)),Rf}var k0;function bv(){return k0||(k0=1,Nf.exports=vv()),Nf.exports}var kf={exports:{}},ia={};var D0;function xv(){if(D0)return ia;D0=1;var a=ad();function e(p){var y="https://react.dev/errors/"+p;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)y+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+p+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var i={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},o=Symbol.for("react.portal");function c(p,y,v){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:x==null?null:""+x,children:p,containerInfo:y,implementation:v}}var f=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,y){if(p==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return ia.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ia.createPortal=function(p,y){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(e(299));return c(p,y,null,v)},ia.flushSync=function(p){var y=f.T,v=i.p;try{if(f.T=null,i.p=2,p)return p()}finally{f.T=y,i.p=v,i.d.f()}},ia.preconnect=function(p,y){typeof p=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,i.d.C(p,y))},ia.prefetchDNS=function(p){typeof p=="string"&&i.d.D(p)},ia.preinit=function(p,y){if(typeof p=="string"&&y&&typeof y.as=="string"){var v=y.as,x=h(v,y.crossOrigin),b=typeof y.integrity=="string"?y.integrity:void 0,S=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;v==="style"?i.d.S(p,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:x,integrity:b,fetchPriority:S}):v==="script"&&i.d.X(p,{crossOrigin:x,integrity:b,fetchPriority:S,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},ia.preinitModule=function(p,y){if(typeof p=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var v=h(y.as,y.crossOrigin);i.d.M(p,{crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&i.d.M(p)},ia.preload=function(p,y){if(typeof p=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var v=y.as,x=h(v,y.crossOrigin);i.d.L(p,v,{crossOrigin:x,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},ia.preloadModule=function(p,y){if(typeof p=="string")if(y){var v=h(y.as,y.crossOrigin);i.d.m(p,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else i.d.m(p)},ia.requestFormReset=function(p){i.d.r(p)},ia.unstable_batchedUpdates=function(p,y){return p(y)},ia.useFormState=function(p,y,v){return f.H.useFormState(p,y,v)},ia.useFormStatus=function(){return f.H.useHostTransitionStatus()},ia.version="19.1.1",ia}var _0;function Bm(){if(_0)return kf.exports;_0=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),kf.exports=xv(),kf.exports}var O0;function Sv(){if(O0)return Pl;O0=1;var a=bv(),e=ad(),r=Bm();function i(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var s=n,l=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(l=s.return),n=s.return;while(n)}return s.tag===3?l:null}function f(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function h(n){if(c(n)!==n)throw Error(i(188))}function p(n){var s=n.alternate;if(!s){if(s=c(n),s===null)throw Error(i(188));return s!==n?null:n}for(var l=n,u=s;;){var d=l.return;if(d===null)break;var g=d.alternate;if(g===null){if(u=d.return,u!==null){l=u;continue}break}if(d.child===g.child){for(g=d.child;g;){if(g===l)return h(d),n;if(g===u)return h(d),s;g=g.sibling}throw Error(i(188))}if(l.return!==u.return)l=d,u=g;else{for(var A=!1,R=d.child;R;){if(R===l){A=!0,l=d,u=g;break}if(R===u){A=!0,u=d,l=g;break}R=R.sibling}if(!A){for(R=g.child;R;){if(R===l){A=!0,l=g,u=d;break}if(R===u){A=!0,u=g,l=d;break}R=R.sibling}if(!A)throw Error(i(189))}}if(l.alternate!==u)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?n:s}function y(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=y(n),s!==null)return s;n=n.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),M=Symbol.for("react.consumer"),N=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),te=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function Z(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var W=Symbol.for("react.client.reference");function X(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===W?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case E:return"Fragment";case _:return"Profiler";case C:return"StrictMode";case k:return"Suspense";case G:return"SuspenseList";case Y:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case S:return"Portal";case N:return(n.displayName||"Context")+".Provider";case M:return(n._context.displayName||"Context")+".Consumer";case D:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case P:return s=n.displayName||null,s!==null?s:X(n.type)||"Memo";case q:s=n._payload,n=n._init;try{return X(n(s))}catch{}}return null}var K=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie={pending:!1,data:null,method:null,action:null},be=[],U=-1;function ee(n){return{current:n}}function ve(n){0>U||(n.current=be[U],be[U]=null,U--)}function Me(n,s){U++,be[U]=n.current,n.current=s}var me=ee(null),Ce=ee(null),Oe=ee(null),at=ee(null);function tt(n,s){switch(Me(Oe,s),Me(Ce,n),Me(me,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?Jh(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=Jh(s),n=e0(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}ve(me),Me(me,n)}function bt(){ve(me),ve(Ce),ve(Oe)}function sn(n){n.memoizedState!==null&&Me(at,n);var s=me.current,l=e0(s,n.type);s!==l&&(Me(Ce,n),Me(me,l))}function Jt(n){Ce.current===n&&(ve(me),ve(Ce)),at.current===n&&(ve(at),Il._currentValue=ie)}var en=Object.prototype.hasOwnProperty,xt=a.unstable_scheduleCallback,tn=a.unstable_cancelCallback,Ie=a.unstable_shouldYield,rt=a.unstable_requestPaint,Re=a.unstable_now,wt=a.unstable_getCurrentPriorityLevel,nn=a.unstable_ImmediatePriority,Ue=a.unstable_UserBlockingPriority,le=a.unstable_NormalPriority,ln=a.unstable_LowPriority,It=a.unstable_IdlePriority,qt=a.log,mt=a.unstable_setDisableYieldValue,Ye=null,At=null;function Bn(n){if(typeof qt=="function"&&mt(n),At&&typeof At.setStrictMode=="function")try{At.setStrictMode(Ye,n)}catch{}}var on=Math.clz32?Math.clz32:kr,es=Math.log,Fn=Math.LN2;function kr(n){return n>>>=0,n===0?32:31-(es(n)/Fn|0)|0}var Kn=256,Ta=4194304;function jn(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Jn(n,s,l){var u=n.pendingLanes;if(u===0)return 0;var d=0,g=n.suspendedLanes,A=n.pingedLanes;n=n.warmLanes;var R=u&134217727;return R!==0?(u=R&~g,u!==0?d=jn(u):(A&=R,A!==0?d=jn(A):l||(l=R&~n,l!==0&&(d=jn(l))))):(R=u&~g,R!==0?d=jn(R):A!==0?d=jn(A):l||(l=u&~n,l!==0&&(d=jn(l)))),d===0?0:s!==0&&s!==d&&(s&g)===0&&(g=d&-d,l=s&-s,g>=l||g===32&&(l&4194048)!==0)?s:d}function qe(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function gt(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ts(){var n=Kn;return Kn<<=1,(Kn&4194048)===0&&(Kn=256),n}function Ga(){var n=Ta;return Ta<<=1,(Ta&62914560)===0&&(Ta=4194304),n}function Pn(n){for(var s=[],l=0;31>l;l++)s.push(n);return s}function Dr(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function gr(n,s,l,u,d,g){var A=n.pendingLanes;n.pendingLanes=l,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=l,n.entangledLanes&=l,n.errorRecoveryDisabledLanes&=l,n.shellSuspendCounter=0;var R=n.entanglements,V=n.expirationTimes,fe=n.hiddenUpdates;for(l=A&~l;0<l;){var Se=31-on(l),Te=1<<Se;R[Se]=0,V[Se]=-1;var de=fe[Se];if(de!==null)for(fe[Se]=null,Se=0;Se<de.length;Se++){var pe=de[Se];pe!==null&&(pe.lane&=-536870913)}l&=~Te}u!==0&&ns(n,u,0),g!==0&&d===0&&n.tag!==0&&(n.suspendedLanes|=g&~(A&~s))}function ns(n,s,l){n.pendingLanes|=s,n.suspendedLanes&=~s;var u=31-on(s);n.entangledLanes|=s,n.entanglements[u]=n.entanglements[u]|1073741824|l&4194090}function Ha(n,s){var l=n.entangledLanes|=s;for(n=n.entanglements;l;){var u=31-on(l),d=1<<u;d&s|n[u]&s&&(n[u]|=s),l&=~d}}function Ca(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Ma(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function oa(){var n=z.p;return n!==0?n:(n=window.event,n===void 0?32:b0(n.type))}function Ya(n,s){var l=z.p;try{return z.p=n,s()}finally{z.p=l}}var Mn=Math.random().toString(36).slice(2),bn="__reactFiber$"+Mn,xn="__reactProps$"+Mn,_n="__reactContainer$"+Mn,dn="__reactEvents$"+Mn,ar="__reactListeners$"+Mn,ma="__reactHandles$"+Mn,qa="__reactResources$"+Mn,as="__reactMarker$"+Mn;function rs(n){delete n[bn],delete n[xn],delete n[dn],delete n[ar],delete n[ma]}function ga(n){var s=n[bn];if(s)return s;for(var l=n.parentNode;l;){if(s=l[_n]||l[bn]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(n=r0(n);n!==null;){if(l=n[bn])return l;n=r0(n)}return s}n=l,l=n.parentNode}return null}function pn(n){if(n=n[bn]||n[_n]){var s=n.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return n}return null}function ca(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(i(33))}function Pt(n){var s=n[qa];return s||(s=n[qa]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function it(n){n[as]=!0}var Na=new Set,Vn={};function Nn(n,s){Va(n,s),Va(n+"Capture",s)}function Va(n,s){for(Vn[n]=s,n=0;n<s.length;n++)Na.add(s[n])}var Is=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),w={},O={};function J(n){return en.call(O,n)?!0:en.call(w,n)?!1:Is.test(n)?O[n]=!0:(w[n]=!0,!1)}function Q(n,s,l){if(J(s))if(l===null)n.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+l)}}function ne(n,s,l){if(l===null)n.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+l)}}function ue(n,s,l,u){if(u===null)n.removeAttribute(l);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(l);return}n.setAttributeNS(s,l,""+u)}}var ye,oe;function _e(n){if(ye===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);ye=s&&s[1]||"",oe=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ye+n+oe}var De=!1;function ze(n,s){if(!n||De)return"";De=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var Te=function(){throw Error()};if(Object.defineProperty(Te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Te,[])}catch(pe){var de=pe}Reflect.construct(n,[],Te)}else{try{Te.call()}catch(pe){de=pe}n.call(Te.prototype)}}else{try{throw Error()}catch(pe){de=pe}(Te=n())&&typeof Te.catch=="function"&&Te.catch(function(){})}}catch(pe){if(pe&&de&&typeof pe.stack=="string")return[pe.stack,de.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=u.DetermineComponentFrameRoot(),A=g[0],R=g[1];if(A&&R){var V=A.split(`
`),fe=R.split(`
`);for(d=u=0;u<V.length&&!V[u].includes("DetermineComponentFrameRoot");)u++;for(;d<fe.length&&!fe[d].includes("DetermineComponentFrameRoot");)d++;if(u===V.length||d===fe.length)for(u=V.length-1,d=fe.length-1;1<=u&&0<=d&&V[u]!==fe[d];)d--;for(;1<=u&&0<=d;u--,d--)if(V[u]!==fe[d]){if(u!==1||d!==1)do if(u--,d--,0>d||V[u]!==fe[d]){var Se=`
`+V[u].replace(" at new "," at ");return n.displayName&&Se.includes("<anonymous>")&&(Se=Se.replace("<anonymous>",n.displayName)),Se}while(1<=u&&0<=d);break}}}finally{De=!1,Error.prepareStackTrace=l}return(l=n?n.displayName||n.name:"")?_e(l):""}function ke(n){switch(n.tag){case 26:case 27:case 5:return _e(n.type);case 16:return _e("Lazy");case 13:return _e("Suspense");case 19:return _e("SuspenseList");case 0:case 15:return ze(n.type,!1);case 11:return ze(n.type.render,!1);case 1:return ze(n.type,!0);case 31:return _e("Activity");default:return""}}function ot(n){try{var s="";do s+=ke(n),n=n.return;while(n);return s}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function Tt(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function cn(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ea(n){var s=cn(n)?"checked":"value",l=Object.getOwnPropertyDescriptor(n.constructor.prototype,s),u=""+n[s];if(!n.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var d=l.get,g=l.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return d.call(this)},set:function(A){u=""+A,g.call(this,A)}}),Object.defineProperty(n,s,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(A){u=""+A},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Xa(n){n._valueTracker||(n._valueTracker=ea(n))}function ua(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var l=s.getValue(),u="";return n&&(u=cn(n)?n.checked?"true":"false":n.value),n=u,n!==l?(s.setValue(n),!0):!1}function Rt(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var Ra=/[\n"\\]/g;function un(n){return n.replace(Ra,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function fa(n,s,l,u,d,g,A,R){n.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?n.type=A:n.removeAttribute("type"),s!=null?A==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+Tt(s)):n.value!==""+Tt(s)&&(n.value=""+Tt(s)):A!=="submit"&&A!=="reset"||n.removeAttribute("value"),s!=null?ya(n,A,Tt(s)):l!=null?ya(n,A,Tt(l)):u!=null&&n.removeAttribute("value"),d==null&&g!=null&&(n.defaultChecked=!!g),d!=null&&(n.checked=d&&typeof d!="function"&&typeof d!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?n.name=""+Tt(R):n.removeAttribute("name")}function Ls(n,s,l,u,d,g,A,R){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(n.type=g),s!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||s!=null))return;l=l!=null?""+Tt(l):"",s=s!=null?""+Tt(s):l,R||s===n.value||(n.value=s),n.defaultValue=s}u=u??d,u=typeof u!="function"&&typeof u!="symbol"&&!!u,n.checked=R?n.checked:!!u,n.defaultChecked=!!u,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(n.name=A)}function ya(n,s,l){s==="number"&&Rt(n.ownerDocument)===n||n.defaultValue===""+l||(n.defaultValue=""+l)}function da(n,s,l,u){if(n=n.options,s){s={};for(var d=0;d<l.length;d++)s["$"+l[d]]=!0;for(l=0;l<n.length;l++)d=s.hasOwnProperty("$"+n[l].value),n[l].selected!==d&&(n[l].selected=d),d&&u&&(n[l].defaultSelected=!0)}else{for(l=""+Tt(l),s=null,d=0;d<n.length;d++){if(n[d].value===l){n[d].selected=!0,u&&(n[d].defaultSelected=!0);return}s!==null||n[d].disabled||(s=n[d])}s!==null&&(s.selected=!0)}}function yr(n,s,l){if(s!=null&&(s=""+Tt(s),s!==n.value&&(n.value=s),l==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=l!=null?""+Tt(l):""}function ta(n,s,l,u){if(s==null){if(u!=null){if(l!=null)throw Error(i(92));if(K(u)){if(1<u.length)throw Error(i(93));u=u[0]}l=u}l==null&&(l=""),s=l}l=Tt(s),n.defaultValue=l,u=n.textContent,u===l&&u!==""&&u!==null&&(n.value=u)}function Xn(n,s){if(s){var l=n.firstChild;if(l&&l===n.lastChild&&l.nodeType===3){l.nodeValue=s;return}}n.textContent=s}var Sn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function On(n,s,l){var u=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?u?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":u?n.setProperty(s,l):typeof l!="number"||l===0||Sn.has(s)?s==="float"?n.cssFloat=l:n[s]=(""+l).trim():n[s]=l+"px"}function vr(n,s,l){if(s!=null&&typeof s!="object")throw Error(i(62));if(n=n.style,l!=null){for(var u in l)!l.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?n.setProperty(u,""):u==="float"?n.cssFloat="":n[u]="");for(var d in s)u=s[d],s.hasOwnProperty(d)&&l[d]!==u&&On(n,d,u)}else for(var g in s)s.hasOwnProperty(g)&&On(n,g,s[g])}function ka(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _r=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Us(n){return Rc.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var oi=null;function mn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Or=null,Da=null;function Zi(n){var s=pn(n);if(s&&(n=s.stateNode)){var l=n[xn]||null;e:switch(n=s.stateNode,s.type){case"input":if(fa(n,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=n;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+un(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var u=l[s];if(u!==n&&u.form===n.form){var d=u[xn]||null;if(!d)throw Error(i(90));fa(u,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(s=0;s<l.length;s++)u=l[s],u.form===n.form&&ua(u)}break e;case"textarea":yr(n,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&da(n,!!l.multiple,s,!1)}}}var Qi=!1;function so(n,s,l){if(Qi)return n(s,l);Qi=!0;try{var u=n(s);return u}finally{if(Qi=!1,(Or!==null||Da!==null)&&(Go(),Or&&(s=Or,n=Da,Da=Or=null,Zi(s),n)))for(s=0;s<n.length;s++)Zi(n[s])}}function $a(n,s){var l=n.stateNode;if(l===null)return null;var u=l[xn]||null;if(u===null)return null;l=u[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break e;default:n=!1}if(n)return null;if(l&&typeof l!="function")throw Error(i(231,s,typeof l));return l}var zn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ir=!1;if(zn)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){Ir=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{Ir=!1}var va=null,Lr=null,ss=null;function is(){if(ss)return ss;var n,s=Lr,l=s.length,u,d="value"in va?va.value:va.textContent,g=d.length;for(n=0;n<l&&s[n]===d[n];n++);var A=l-n;for(u=1;u<=A&&s[l-u]===d[g-u];u++);return ss=d.slice(n,1<u?1-u:void 0)}function ci(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function br(){return!0}function io(){return!1}function na(n){function s(l,u,d,g,A){this._reactName=l,this._targetInst=d,this.type=u,this.nativeEvent=g,this.target=A,this.currentTarget=null;for(var R in n)n.hasOwnProperty(R)&&(l=n[R],this[R]=l?l(g):g[R]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?br:io,this.isPropagationStopped=io,this}return v(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=br)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=br)},persist:function(){},isPersistent:br}),s}var Ur={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ui=na(Ur),Bs=v({},Ur,{view:0,detail:0}),kc=na(Bs),Fs,Wi,js,fi=v({},Bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ge,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==js&&(js&&n.type==="mousemove"?(Fs=n.screenX-js.screenX,Wi=n.screenY-js.screenY):Wi=Fs=0,js=n),Fs)},movementY:function(n){return"movementY"in n?n.movementY:Wi}}),aa=na(fi),lo=v({},fi,{dataTransfer:0}),oo=na(lo),Ki=v({},Bs,{relatedTarget:0}),Ji=na(Ki),Dc=v({},Ur,{animationName:0,elapsedTime:0,pseudoElement:0}),_c=na(Dc),Oc=v({},Ur,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Ic=na(Oc),j=v({},Ur,{data:0}),L=na(j),$={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},B={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},re={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xe(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=re[n])?!!s[n]:!1}function ge(){return xe}var Le=v({},Bs,{key:function(n){if(n.key){var s=$[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=ci(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?B[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ge,charCode:function(n){return n.type==="keypress"?ci(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ci(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Pe=na(Le),st=v({},fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ee=na(st),et=v({},Bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ge}),Be=na(et),Ge=v({},Ur,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xe=na(Ge),Fe=v({},fi,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Je=na(Fe),dt=v({},Ur,{newState:0,oldState:0}),$e=na(dt),Ke=[9,13,27,32],ht=zn&&"CompositionEvent"in window,Dt=null;zn&&"documentMode"in document&&(Dt=document.documentMode);var Ot=zn&&"TextEvent"in window&&!Dt,Vt=zn&&(!ht||Dt&&8<Dt&&11>=Dt),Xt=" ",St=!1;function Ps(n,s){switch(n){case"keyup":return Ke.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ra(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var an=!1;function $t(n,s){switch(n){case"compositionend":return ra(s);case"keypress":return s.which!==32?null:(St=!0,Xt);case"textInput":return n=s.data,n===Xt&&St?null:n;default:return null}}function Bt(n,s){if(an)return n==="compositionend"||!ht&&Ps(n,s)?(n=is(),ss=Lr=va=null,an=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Vt&&s.locale!=="ko"?null:s.data;default:return null}}var In={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qt(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!In[n.type]:s==="textarea"}function kt(n,s,l,u){Or?Da?Da.push(u):Da=[u]:Or=u,s=$o(s,"onChange"),0<s.length&&(l=new ui("onChange","change",null,l,u),n.push({event:l,listeners:s}))}var Wt=null,En=null;function Br(n){$h(n,0)}function Za(n){var s=ca(n);if(ua(s))return n}function wn(n,s){if(n==="change")return s}var yt=!1;if(zn){var ba;if(zn){var $n="oninput"in document;if(!$n){var xa=document.createElement("div");xa.setAttribute("oninput","return;"),$n=typeof xa.oninput=="function"}ba=$n}else ba=!1;yt=ba&&(!document.documentMode||9<document.documentMode)}function di(){Wt&&(Wt.detachEvent("onpropertychange",xr),En=Wt=null)}function xr(n){if(n.propertyName==="value"&&Za(En)){var s=[];kt(s,En,n,mn(n)),so(Br,s)}}function sr(n,s,l){n==="focusin"?(di(),Wt=s,En=l,Wt.attachEvent("onpropertychange",xr)):n==="focusout"&&di()}function zs(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Za(En)}function Lc(n,s){if(n==="click")return Za(s)}function ir(n,s){if(n==="input"||n==="change")return Za(s)}function Sa(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var _a=typeof Object.is=="function"?Object.is:Sa;function el(n,s){if(_a(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var l=Object.keys(n),u=Object.keys(s);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var d=l[u];if(!en.call(s,d)||!_a(n[d],s[d]))return!1}return!0}function xd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Sd(n,s){var l=xd(n);n=0;for(var u;l;){if(l.nodeType===3){if(u=n+l.textContent.length,n<=s&&u>=s)return{node:l,offset:s-n};n=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=xd(l)}}function Ed(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Ed(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function wd(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=Rt(n.document);s instanceof n.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)n=s.contentWindow;else break;s=Rt(n.document)}return s}function Uc(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var Qg=zn&&"documentMode"in document&&11>=document.documentMode,pi=null,Bc=null,tl=null,Fc=!1;function Ad(n,s,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Fc||pi==null||pi!==Rt(u)||(u=pi,"selectionStart"in u&&Uc(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),tl&&el(tl,u)||(tl=u,u=$o(Bc,"onSelect"),0<u.length&&(s=new ui("onSelect","select",null,s,l),n.push({event:s,listeners:u}),s.target=pi)))}function Gs(n,s){var l={};return l[n.toLowerCase()]=s.toLowerCase(),l["Webkit"+n]="webkit"+s,l["Moz"+n]="moz"+s,l}var hi={animationend:Gs("Animation","AnimationEnd"),animationiteration:Gs("Animation","AnimationIteration"),animationstart:Gs("Animation","AnimationStart"),transitionrun:Gs("Transition","TransitionRun"),transitionstart:Gs("Transition","TransitionStart"),transitioncancel:Gs("Transition","TransitionCancel"),transitionend:Gs("Transition","TransitionEnd")},jc={},Td={};zn&&(Td=document.createElement("div").style,"AnimationEvent"in window||(delete hi.animationend.animation,delete hi.animationiteration.animation,delete hi.animationstart.animation),"TransitionEvent"in window||delete hi.transitionend.transition);function Hs(n){if(jc[n])return jc[n];if(!hi[n])return n;var s=hi[n],l;for(l in s)if(s.hasOwnProperty(l)&&l in Td)return jc[n]=s[l];return n}var Cd=Hs("animationend"),Md=Hs("animationiteration"),Nd=Hs("animationstart"),Wg=Hs("transitionrun"),Kg=Hs("transitionstart"),Jg=Hs("transitioncancel"),Rd=Hs("transitionend"),kd=new Map,Pc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pc.push("scrollEnd");function lr(n,s){kd.set(n,s),Nn(s,[n])}var Dd=new WeakMap;function Qa(n,s){if(typeof n=="object"&&n!==null){var l=Dd.get(n);return l!==void 0?l:(s={value:n,source:s,stack:ot(s)},Dd.set(n,s),s)}return{value:n,source:s,stack:ot(s)}}var Wa=[],mi=0,zc=0;function co(){for(var n=mi,s=zc=mi=0;s<n;){var l=Wa[s];Wa[s++]=null;var u=Wa[s];Wa[s++]=null;var d=Wa[s];Wa[s++]=null;var g=Wa[s];if(Wa[s++]=null,u!==null&&d!==null){var A=u.pending;A===null?d.next=d:(d.next=A.next,A.next=d),u.pending=d}g!==0&&_d(l,d,g)}}function uo(n,s,l,u){Wa[mi++]=n,Wa[mi++]=s,Wa[mi++]=l,Wa[mi++]=u,zc|=u,n.lanes|=u,n=n.alternate,n!==null&&(n.lanes|=u)}function Gc(n,s,l,u){return uo(n,s,l,u),fo(n)}function gi(n,s){return uo(n,null,null,s),fo(n)}function _d(n,s,l){n.lanes|=l;var u=n.alternate;u!==null&&(u.lanes|=l);for(var d=!1,g=n.return;g!==null;)g.childLanes|=l,u=g.alternate,u!==null&&(u.childLanes|=l),g.tag===22&&(n=g.stateNode,n===null||n._visibility&1||(d=!0)),n=g,g=g.return;return n.tag===3?(g=n.stateNode,d&&s!==null&&(d=31-on(l),n=g.hiddenUpdates,u=n[d],u===null?n[d]=[s]:u.push(s),s.lane=l|536870912),g):null}function fo(n){if(50<Cl)throw Cl=0,$u=null,Error(i(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var yi={};function ey(n,s,l,u){this.tag=n,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(n,s,l,u){return new ey(n,s,l,u)}function Hc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Fr(n,s){var l=n.alternate;return l===null?(l=Oa(n.tag,s,n.key,n.mode),l.elementType=n.elementType,l.type=n.type,l.stateNode=n.stateNode,l.alternate=n,n.alternate=l):(l.pendingProps=s,l.type=n.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=n.flags&65011712,l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,s=n.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=n.sibling,l.index=n.index,l.ref=n.ref,l.refCleanup=n.refCleanup,l}function Od(n,s){n.flags&=65011714;var l=n.alternate;return l===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=l.childLanes,n.lanes=l.lanes,n.child=l.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=l.memoizedProps,n.memoizedState=l.memoizedState,n.updateQueue=l.updateQueue,n.type=l.type,s=l.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function po(n,s,l,u,d,g){var A=0;if(u=n,typeof n=="function")Hc(n)&&(A=1);else if(typeof n=="string")A=nv(n,l,me.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case Y:return n=Oa(31,l,s,d),n.elementType=Y,n.lanes=g,n;case E:return Ys(l.children,d,g,s);case C:A=8,d|=24;break;case _:return n=Oa(12,l,s,d|2),n.elementType=_,n.lanes=g,n;case k:return n=Oa(13,l,s,d),n.elementType=k,n.lanes=g,n;case G:return n=Oa(19,l,s,d),n.elementType=G,n.lanes=g,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case I:case N:A=10;break e;case M:A=9;break e;case D:A=11;break e;case P:A=14;break e;case q:A=16,u=null;break e}A=29,l=Error(i(130,n===null?"null":typeof n,"")),u=null}return s=Oa(A,l,s,d),s.elementType=n,s.type=u,s.lanes=g,s}function Ys(n,s,l,u){return n=Oa(7,n,u,s),n.lanes=l,n}function Yc(n,s,l){return n=Oa(6,n,null,s),n.lanes=l,n}function qc(n,s,l){return s=Oa(4,n.children!==null?n.children:[],n.key,s),s.lanes=l,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var vi=[],bi=0,ho=null,mo=0,Ka=[],Ja=0,qs=null,jr=1,Pr="";function Vs(n,s){vi[bi++]=mo,vi[bi++]=ho,ho=n,mo=s}function Id(n,s,l){Ka[Ja++]=jr,Ka[Ja++]=Pr,Ka[Ja++]=qs,qs=n;var u=jr;n=Pr;var d=32-on(u)-1;u&=~(1<<d),l+=1;var g=32-on(s)+d;if(30<g){var A=d-d%5;g=(u&(1<<A)-1).toString(32),u>>=A,d-=A,jr=1<<32-on(s)+d|l<<d|u,Pr=g+n}else jr=1<<g|l<<d|u,Pr=n}function Vc(n){n.return!==null&&(Vs(n,1),Id(n,1,0))}function Xc(n){for(;n===ho;)ho=vi[--bi],vi[bi]=null,mo=vi[--bi],vi[bi]=null;for(;n===qs;)qs=Ka[--Ja],Ka[Ja]=null,Pr=Ka[--Ja],Ka[Ja]=null,jr=Ka[--Ja],Ka[Ja]=null}var pa=null,gn=null,Ut=!1,Xs=null,Sr=!1,$c=Error(i(519));function $s(n){var s=Error(i(418,""));throw rl(Qa(s,n)),$c}function Ld(n){var s=n.stateNode,l=n.type,u=n.memoizedProps;switch(s[bn]=n,s[xn]=u,l){case"dialog":Nt("cancel",s),Nt("close",s);break;case"iframe":case"object":case"embed":Nt("load",s);break;case"video":case"audio":for(l=0;l<Nl.length;l++)Nt(Nl[l],s);break;case"source":Nt("error",s);break;case"img":case"image":case"link":Nt("error",s),Nt("load",s);break;case"details":Nt("toggle",s);break;case"input":Nt("invalid",s),Ls(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0),Xa(s);break;case"select":Nt("invalid",s);break;case"textarea":Nt("invalid",s),ta(s,u.value,u.defaultValue,u.children),Xa(s)}l=u.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||u.suppressHydrationWarning===!0||Kh(s.textContent,l)?(u.popover!=null&&(Nt("beforetoggle",s),Nt("toggle",s)),u.onScroll!=null&&Nt("scroll",s),u.onScrollEnd!=null&&Nt("scrollend",s),u.onClick!=null&&(s.onclick=Zo),s=!0):s=!1,s||$s(n)}function Ud(n){for(pa=n.return;pa;)switch(pa.tag){case 5:case 13:Sr=!1;return;case 27:case 3:Sr=!0;return;default:pa=pa.return}}function nl(n){if(n!==pa)return!1;if(!Ut)return Ud(n),Ut=!0,!1;var s=n.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=n.type,l=!(l!=="form"&&l!=="button")||ff(n.type,n.memoizedProps)),l=!l),l&&gn&&$s(n),Ud(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));e:{for(n=n.nextSibling,s=0;n;){if(n.nodeType===8)if(l=n.data,l==="/$"){if(s===0){gn=cr(n.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++;n=n.nextSibling}gn=null}}else s===27?(s=gn,Es(n.type)?(n=mf,mf=null,gn=n):gn=s):gn=pa?cr(n.stateNode.nextSibling):null;return!0}function al(){gn=pa=null,Ut=!1}function Bd(){var n=Xs;return n!==null&&(Aa===null?Aa=n:Aa.push.apply(Aa,n),Xs=null),n}function rl(n){Xs===null?Xs=[n]:Xs.push(n)}var Zc=ee(null),Zs=null,zr=null;function ls(n,s,l){Me(Zc,s._currentValue),s._currentValue=l}function Gr(n){n._currentValue=Zc.current,ve(Zc)}function Qc(n,s,l){for(;n!==null;){var u=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),n===l)break;n=n.return}}function Wc(n,s,l,u){var d=n.child;for(d!==null&&(d.return=n);d!==null;){var g=d.dependencies;if(g!==null){var A=d.child;g=g.firstContext;e:for(;g!==null;){var R=g;g=d;for(var V=0;V<s.length;V++)if(R.context===s[V]){g.lanes|=l,R=g.alternate,R!==null&&(R.lanes|=l),Qc(g.return,l,n),u||(A=null);break e}g=R.next}}else if(d.tag===18){if(A=d.return,A===null)throw Error(i(341));A.lanes|=l,g=A.alternate,g!==null&&(g.lanes|=l),Qc(A,l,n),A=null}else A=d.child;if(A!==null)A.return=d;else for(A=d;A!==null;){if(A===n){A=null;break}if(d=A.sibling,d!==null){d.return=A.return,A=d;break}A=A.return}d=A}}function sl(n,s,l,u){n=null;for(var d=s,g=!1;d!==null;){if(!g){if((d.flags&524288)!==0)g=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var A=d.alternate;if(A===null)throw Error(i(387));if(A=A.memoizedProps,A!==null){var R=d.type;_a(d.pendingProps.value,A.value)||(n!==null?n.push(R):n=[R])}}else if(d===at.current){if(A=d.alternate,A===null)throw Error(i(387));A.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(n!==null?n.push(Il):n=[Il])}d=d.return}n!==null&&Wc(s,n,l,u),s.flags|=262144}function go(n){for(n=n.firstContext;n!==null;){if(!_a(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Qs(n){Zs=n,zr=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function sa(n){return Fd(Zs,n)}function yo(n,s){return Zs===null&&Qs(n),Fd(n,s)}function Fd(n,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},zr===null){if(n===null)throw Error(i(308));zr=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else zr=zr.next=s;return l}var ty=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(l,u){n.push(u)}};this.abort=function(){s.aborted=!0,n.forEach(function(l){return l()})}},ny=a.unstable_scheduleCallback,ay=a.unstable_NormalPriority,Ln={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Kc(){return{controller:new ty,data:new Map,refCount:0}}function il(n){n.refCount--,n.refCount===0&&ny(ay,function(){n.controller.abort()})}var ll=null,Jc=0,xi=0,Si=null;function ry(n,s){if(ll===null){var l=ll=[];Jc=0,xi=tf(),Si={status:"pending",value:void 0,then:function(u){l.push(u)}}}return Jc++,s.then(jd,jd),s}function jd(){if(--Jc===0&&ll!==null){Si!==null&&(Si.status="fulfilled");var n=ll;ll=null,xi=0,Si=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function sy(n,s){var l=[],u={status:"pending",value:null,reason:null,then:function(d){l.push(d)}};return n.then(function(){u.status="fulfilled",u.value=s;for(var d=0;d<l.length;d++)(0,l[d])(s)},function(d){for(u.status="rejected",u.reason=d,d=0;d<l.length;d++)(0,l[d])(void 0)}),u}var Pd=F.S;F.S=function(n,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&ry(n,s),Pd!==null&&Pd(n,s)};var Ws=ee(null);function eu(){var n=Ws.current;return n!==null?n:Kt.pooledCache}function vo(n,s){s===null?Me(Ws,Ws.current):Me(Ws,s.pool)}function zd(){var n=eu();return n===null?null:{parent:Ln._currentValue,pool:n}}var ol=Error(i(460)),Gd=Error(i(474)),bo=Error(i(542)),tu={then:function(){}};function Hd(n){return n=n.status,n==="fulfilled"||n==="rejected"}function xo(){}function Yd(n,s,l){switch(l=n[l],l===void 0?n.push(s):l!==s&&(s.then(xo,xo),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Vd(n),n;default:if(typeof s.status=="string")s.then(xo,xo);else{if(n=Kt,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=s,n.status="pending",n.then(function(u){if(s.status==="pending"){var d=s;d.status="fulfilled",d.value=u}},function(u){if(s.status==="pending"){var d=s;d.status="rejected",d.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Vd(n),n}throw cl=s,ol}}var cl=null;function qd(){if(cl===null)throw Error(i(459));var n=cl;return cl=null,n}function Vd(n){if(n===ol||n===bo)throw Error(i(483))}var os=!1;function nu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function au(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function cs(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function us(n,s,l){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(Ft&2)!==0){var d=u.pending;return d===null?s.next=s:(s.next=d.next,d.next=s),u.pending=s,s=fo(n),_d(n,null,l),s}return uo(n,u,s,l),fo(n)}function ul(n,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,Ha(n,l)}}function ru(n,s){var l=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var d=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var A={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?d=g=A:g=g.next=A,l=l.next}while(l!==null);g===null?d=g=s:g=g.next=s}else d=g=s;l={baseState:u.baseState,firstBaseUpdate:d,lastBaseUpdate:g,shared:u.shared,callbacks:u.callbacks},n.updateQueue=l;return}n=l.lastBaseUpdate,n===null?l.firstBaseUpdate=s:n.next=s,l.lastBaseUpdate=s}var su=!1;function fl(){if(su){var n=Si;if(n!==null)throw n}}function dl(n,s,l,u){su=!1;var d=n.updateQueue;os=!1;var g=d.firstBaseUpdate,A=d.lastBaseUpdate,R=d.shared.pending;if(R!==null){d.shared.pending=null;var V=R,fe=V.next;V.next=null,A===null?g=fe:A.next=fe,A=V;var Se=n.alternate;Se!==null&&(Se=Se.updateQueue,R=Se.lastBaseUpdate,R!==A&&(R===null?Se.firstBaseUpdate=fe:R.next=fe,Se.lastBaseUpdate=V))}if(g!==null){var Te=d.baseState;A=0,Se=fe=V=null,R=g;do{var de=R.lane&-536870913,pe=de!==R.lane;if(pe?(_t&de)===de:(u&de)===de){de!==0&&de===xi&&(su=!0),Se!==null&&(Se=Se.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var ft=n,lt=R;de=s;var Ht=l;switch(lt.tag){case 1:if(ft=lt.payload,typeof ft=="function"){Te=ft.call(Ht,Te,de);break e}Te=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=lt.payload,de=typeof ft=="function"?ft.call(Ht,Te,de):ft,de==null)break e;Te=v({},Te,de);break e;case 2:os=!0}}de=R.callback,de!==null&&(n.flags|=64,pe&&(n.flags|=8192),pe=d.callbacks,pe===null?d.callbacks=[de]:pe.push(de))}else pe={lane:de,tag:R.tag,payload:R.payload,callback:R.callback,next:null},Se===null?(fe=Se=pe,V=Te):Se=Se.next=pe,A|=de;if(R=R.next,R===null){if(R=d.shared.pending,R===null)break;pe=R,R=pe.next,pe.next=null,d.lastBaseUpdate=pe,d.shared.pending=null}}while(!0);Se===null&&(V=Te),d.baseState=V,d.firstBaseUpdate=fe,d.lastBaseUpdate=Se,g===null&&(d.shared.lanes=0),vs|=A,n.lanes=A,n.memoizedState=Te}}function Xd(n,s){if(typeof n!="function")throw Error(i(191,n));n.call(s)}function $d(n,s){var l=n.callbacks;if(l!==null)for(n.callbacks=null,n=0;n<l.length;n++)Xd(l[n],s)}var Ei=ee(null),So=ee(0);function Zd(n,s){n=Zr,Me(So,n),Me(Ei,s),Zr=n|s.baseLanes}function iu(){Me(So,Zr),Me(Ei,Ei.current)}function lu(){Zr=So.current,ve(Ei),ve(So)}var fs=0,Et=null,zt=null,Rn=null,Eo=!1,wi=!1,Ks=!1,wo=0,pl=0,Ai=null,iy=0;function An(){throw Error(i(321))}function ou(n,s){if(s===null)return!1;for(var l=0;l<s.length&&l<n.length;l++)if(!_a(n[l],s[l]))return!1;return!0}function cu(n,s,l,u,d,g){return fs=g,Et=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,F.H=n===null||n.memoizedState===null?_p:Op,Ks=!1,g=l(u,d),Ks=!1,wi&&(g=Wd(s,l,u,d)),Qd(n),g}function Qd(n){F.H=Ro;var s=zt!==null&&zt.next!==null;if(fs=0,Rn=zt=Et=null,Eo=!1,pl=0,Ai=null,s)throw Error(i(300));n===null||Gn||(n=n.dependencies,n!==null&&go(n)&&(Gn=!0))}function Wd(n,s,l,u){Et=n;var d=0;do{if(wi&&(Ai=null),pl=0,wi=!1,25<=d)throw Error(i(301));if(d+=1,Rn=zt=null,n.updateQueue!=null){var g=n.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}F.H=py,g=s(l,u)}while(wi);return g}function ly(){var n=F.H,s=n.useState()[0];return s=typeof s.then=="function"?hl(s):s,n=n.useState()[0],(zt!==null?zt.memoizedState:null)!==n&&(Et.flags|=1024),s}function uu(){var n=wo!==0;return wo=0,n}function fu(n,s,l){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~l}function du(n){if(Eo){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Eo=!1}fs=0,Rn=zt=Et=null,wi=!1,pl=wo=0,Ai=null}function Ea(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rn===null?Et.memoizedState=Rn=n:Rn=Rn.next=n,Rn}function kn(){if(zt===null){var n=Et.alternate;n=n!==null?n.memoizedState:null}else n=zt.next;var s=Rn===null?Et.memoizedState:Rn.next;if(s!==null)Rn=s,zt=n;else{if(n===null)throw Et.alternate===null?Error(i(467)):Error(i(310));zt=n,n={memoizedState:zt.memoizedState,baseState:zt.baseState,baseQueue:zt.baseQueue,queue:zt.queue,next:null},Rn===null?Et.memoizedState=Rn=n:Rn=Rn.next=n}return Rn}function pu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hl(n){var s=pl;return pl+=1,Ai===null&&(Ai=[]),n=Yd(Ai,n,s),s=Et,(Rn===null?s.memoizedState:Rn.next)===null&&(s=s.alternate,F.H=s===null||s.memoizedState===null?_p:Op),n}function Ao(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return hl(n);if(n.$$typeof===N)return sa(n)}throw Error(i(438,String(n)))}function hu(n){var s=null,l=Et.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var u=Et.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(d){return d.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=pu(),Et.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(n),u=0;u<n;u++)l[u]=te;return s.index++,l}function Hr(n,s){return typeof s=="function"?s(n):s}function To(n){var s=kn();return mu(s,zt,n)}function mu(n,s,l){var u=n.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=l;var d=n.baseQueue,g=u.pending;if(g!==null){if(d!==null){var A=d.next;d.next=g.next,g.next=A}s.baseQueue=d=g,u.pending=null}if(g=n.baseState,d===null)n.memoizedState=g;else{s=d.next;var R=A=null,V=null,fe=s,Se=!1;do{var Te=fe.lane&-536870913;if(Te!==fe.lane?(_t&Te)===Te:(fs&Te)===Te){var de=fe.revertLane;if(de===0)V!==null&&(V=V.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Te===xi&&(Se=!0);else if((fs&de)===de){fe=fe.next,de===xi&&(Se=!0);continue}else Te={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},V===null?(R=V=Te,A=g):V=V.next=Te,Et.lanes|=de,vs|=de;Te=fe.action,Ks&&l(g,Te),g=fe.hasEagerState?fe.eagerState:l(g,Te)}else de={lane:Te,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},V===null?(R=V=de,A=g):V=V.next=de,Et.lanes|=Te,vs|=Te;fe=fe.next}while(fe!==null&&fe!==s);if(V===null?A=g:V.next=R,!_a(g,n.memoizedState)&&(Gn=!0,Se&&(l=Si,l!==null)))throw l;n.memoizedState=g,n.baseState=A,n.baseQueue=V,u.lastRenderedState=g}return d===null&&(u.lanes=0),[n.memoizedState,u.dispatch]}function gu(n){var s=kn(),l=s.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=n;var u=l.dispatch,d=l.pending,g=s.memoizedState;if(d!==null){l.pending=null;var A=d=d.next;do g=n(g,A.action),A=A.next;while(A!==d);_a(g,s.memoizedState)||(Gn=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),l.lastRenderedState=g}return[g,u]}function Kd(n,s,l){var u=Et,d=kn(),g=Ut;if(g){if(l===void 0)throw Error(i(407));l=l()}else l=s();var A=!_a((zt||d).memoizedState,l);A&&(d.memoizedState=l,Gn=!0),d=d.queue;var R=tp.bind(null,u,d,n);if(ml(2048,8,R,[n]),d.getSnapshot!==s||A||Rn!==null&&Rn.memoizedState.tag&1){if(u.flags|=2048,Ti(9,Co(),ep.bind(null,u,d,l,s),null),Kt===null)throw Error(i(349));g||(fs&124)!==0||Jd(u,s,l)}return l}function Jd(n,s,l){n.flags|=16384,n={getSnapshot:s,value:l},s=Et.updateQueue,s===null?(s=pu(),Et.updateQueue=s,s.stores=[n]):(l=s.stores,l===null?s.stores=[n]:l.push(n))}function ep(n,s,l,u){s.value=l,s.getSnapshot=u,np(s)&&ap(n)}function tp(n,s,l){return l(function(){np(s)&&ap(n)})}function np(n){var s=n.getSnapshot;n=n.value;try{var l=s();return!_a(n,l)}catch{return!0}}function ap(n){var s=gi(n,2);s!==null&&Fa(s,n,2)}function yu(n){var s=Ea();if(typeof n=="function"){var l=n;if(n=l(),Ks){Bn(!0);try{l()}finally{Bn(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:n},s}function rp(n,s,l,u){return n.baseState=l,mu(n,zt,typeof u=="function"?u:Hr)}function oy(n,s,l,u,d){if(No(n))throw Error(i(485));if(n=s.action,n!==null){var g={payload:d,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){g.listeners.push(A)}};F.T!==null?l(!0):g.isTransition=!1,u(g),l=s.pending,l===null?(g.next=s.pending=g,sp(s,g)):(g.next=l.next,s.pending=l.next=g)}}function sp(n,s){var l=s.action,u=s.payload,d=n.state;if(s.isTransition){var g=F.T,A={};F.T=A;try{var R=l(d,u),V=F.S;V!==null&&V(A,R),ip(n,s,R)}catch(fe){vu(n,s,fe)}finally{F.T=g}}else try{g=l(d,u),ip(n,s,g)}catch(fe){vu(n,s,fe)}}function ip(n,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(u){lp(n,s,u)},function(u){return vu(n,s,u)}):lp(n,s,l)}function lp(n,s,l){s.status="fulfilled",s.value=l,op(s),n.state=l,s=n.pending,s!==null&&(l=s.next,l===s?n.pending=null:(l=l.next,s.next=l,sp(n,l)))}function vu(n,s,l){var u=n.pending;if(n.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=l,op(s),s=s.next;while(s!==u)}n.action=null}function op(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function cp(n,s){return s}function up(n,s){if(Ut){var l=Kt.formState;if(l!==null){e:{var u=Et;if(Ut){if(gn){t:{for(var d=gn,g=Sr;d.nodeType!==8;){if(!g){d=null;break t}if(d=cr(d.nextSibling),d===null){d=null;break t}}g=d.data,d=g==="F!"||g==="F"?d:null}if(d){gn=cr(d.nextSibling),u=d.data==="F!";break e}}$s(u)}u=!1}u&&(s=l[0])}}return l=Ea(),l.memoizedState=l.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cp,lastRenderedState:s},l.queue=u,l=Rp.bind(null,Et,u),u.dispatch=l,u=yu(!1),g=wu.bind(null,Et,!1,u.queue),u=Ea(),d={state:s,dispatch:null,action:n,pending:null},u.queue=d,l=oy.bind(null,Et,d,g,l),d.dispatch=l,u.memoizedState=n,[s,l,!1]}function fp(n){var s=kn();return dp(s,zt,n)}function dp(n,s,l){if(s=mu(n,s,cp)[0],n=To(Hr)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=hl(s)}catch(A){throw A===ol?bo:A}else u=s;s=kn();var d=s.queue,g=d.dispatch;return l!==s.memoizedState&&(Et.flags|=2048,Ti(9,Co(),cy.bind(null,d,l),null)),[u,g,n]}function cy(n,s){n.action=s}function pp(n){var s=kn(),l=zt;if(l!==null)return dp(s,l,n);kn(),s=s.memoizedState,l=kn();var u=l.queue.dispatch;return l.memoizedState=n,[s,u,!1]}function Ti(n,s,l,u){return n={tag:n,create:l,deps:u,inst:s,next:null},s=Et.updateQueue,s===null&&(s=pu(),Et.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=n.next=n:(u=l.next,l.next=n,n.next=u,s.lastEffect=n),n}function Co(){return{destroy:void 0,resource:void 0}}function hp(){return kn().memoizedState}function Mo(n,s,l,u){var d=Ea();u=u===void 0?null:u,Et.flags|=n,d.memoizedState=Ti(1|s,Co(),l,u)}function ml(n,s,l,u){var d=kn();u=u===void 0?null:u;var g=d.memoizedState.inst;zt!==null&&u!==null&&ou(u,zt.memoizedState.deps)?d.memoizedState=Ti(s,g,l,u):(Et.flags|=n,d.memoizedState=Ti(1|s,g,l,u))}function mp(n,s){Mo(8390656,8,n,s)}function gp(n,s){ml(2048,8,n,s)}function yp(n,s){return ml(4,2,n,s)}function vp(n,s){return ml(4,4,n,s)}function bp(n,s){if(typeof s=="function"){n=n();var l=s(n);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function xp(n,s,l){l=l!=null?l.concat([n]):null,ml(4,4,bp.bind(null,s,n),l)}function bu(){}function Sp(n,s){var l=kn();s=s===void 0?null:s;var u=l.memoizedState;return s!==null&&ou(s,u[1])?u[0]:(l.memoizedState=[n,s],n)}function Ep(n,s){var l=kn();s=s===void 0?null:s;var u=l.memoizedState;if(s!==null&&ou(s,u[1]))return u[0];if(u=n(),Ks){Bn(!0);try{n()}finally{Bn(!1)}}return l.memoizedState=[u,s],u}function xu(n,s,l){return l===void 0||(fs&1073741824)!==0?n.memoizedState=s:(n.memoizedState=l,n=Th(),Et.lanes|=n,vs|=n,l)}function wp(n,s,l,u){return _a(l,s)?l:Ei.current!==null?(n=xu(n,l,u),_a(n,s)||(Gn=!0),n):(fs&42)===0?(Gn=!0,n.memoizedState=l):(n=Th(),Et.lanes|=n,vs|=n,s)}function Ap(n,s,l,u,d){var g=z.p;z.p=g!==0&&8>g?g:8;var A=F.T,R={};F.T=R,wu(n,!1,s,l);try{var V=d(),fe=F.S;if(fe!==null&&fe(R,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var Se=sy(V,u);gl(n,s,Se,Ba(n))}else gl(n,s,u,Ba(n))}catch(Te){gl(n,s,{then:function(){},status:"rejected",reason:Te},Ba())}finally{z.p=g,F.T=A}}function uy(){}function Su(n,s,l,u){if(n.tag!==5)throw Error(i(476));var d=Tp(n).queue;Ap(n,d,s,ie,l===null?uy:function(){return Cp(n),l(u)})}function Tp(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:ie,baseState:ie,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:ie},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:l},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function Cp(n){var s=Tp(n).next.queue;gl(n,s,{},Ba())}function Eu(){return sa(Il)}function Mp(){return kn().memoizedState}function Np(){return kn().memoizedState}function fy(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var l=Ba();n=cs(l);var u=us(s,n,l);u!==null&&(Fa(u,s,l),ul(u,s,l)),s={cache:Kc()},n.payload=s;return}s=s.return}}function dy(n,s,l){var u=Ba();l={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},No(n)?kp(s,l):(l=Gc(n,s,l,u),l!==null&&(Fa(l,n,u),Dp(l,s,u)))}function Rp(n,s,l){var u=Ba();gl(n,s,l,u)}function gl(n,s,l,u){var d={lane:u,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(No(n))kp(s,d);else{var g=n.alternate;if(n.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var A=s.lastRenderedState,R=g(A,l);if(d.hasEagerState=!0,d.eagerState=R,_a(R,A))return uo(n,s,d,0),Kt===null&&co(),!1}catch{}if(l=Gc(n,s,d,u),l!==null)return Fa(l,n,u),Dp(l,s,u),!0}return!1}function wu(n,s,l,u){if(u={lane:2,revertLane:tf(),action:u,hasEagerState:!1,eagerState:null,next:null},No(n)){if(s)throw Error(i(479))}else s=Gc(n,l,u,2),s!==null&&Fa(s,n,2)}function No(n){var s=n.alternate;return n===Et||s!==null&&s===Et}function kp(n,s){wi=Eo=!0;var l=n.pending;l===null?s.next=s:(s.next=l.next,l.next=s),n.pending=s}function Dp(n,s,l){if((l&4194048)!==0){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,Ha(n,l)}}var Ro={readContext:sa,use:Ao,useCallback:An,useContext:An,useEffect:An,useImperativeHandle:An,useLayoutEffect:An,useInsertionEffect:An,useMemo:An,useReducer:An,useRef:An,useState:An,useDebugValue:An,useDeferredValue:An,useTransition:An,useSyncExternalStore:An,useId:An,useHostTransitionStatus:An,useFormState:An,useActionState:An,useOptimistic:An,useMemoCache:An,useCacheRefresh:An},_p={readContext:sa,use:Ao,useCallback:function(n,s){return Ea().memoizedState=[n,s===void 0?null:s],n},useContext:sa,useEffect:mp,useImperativeHandle:function(n,s,l){l=l!=null?l.concat([n]):null,Mo(4194308,4,bp.bind(null,s,n),l)},useLayoutEffect:function(n,s){return Mo(4194308,4,n,s)},useInsertionEffect:function(n,s){Mo(4,2,n,s)},useMemo:function(n,s){var l=Ea();s=s===void 0?null:s;var u=n();if(Ks){Bn(!0);try{n()}finally{Bn(!1)}}return l.memoizedState=[u,s],u},useReducer:function(n,s,l){var u=Ea();if(l!==void 0){var d=l(s);if(Ks){Bn(!0);try{l(s)}finally{Bn(!1)}}}else d=s;return u.memoizedState=u.baseState=d,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:d},u.queue=n,n=n.dispatch=dy.bind(null,Et,n),[u.memoizedState,n]},useRef:function(n){var s=Ea();return n={current:n},s.memoizedState=n},useState:function(n){n=yu(n);var s=n.queue,l=Rp.bind(null,Et,s);return s.dispatch=l,[n.memoizedState,l]},useDebugValue:bu,useDeferredValue:function(n,s){var l=Ea();return xu(l,n,s)},useTransition:function(){var n=yu(!1);return n=Ap.bind(null,Et,n.queue,!0,!1),Ea().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,l){var u=Et,d=Ea();if(Ut){if(l===void 0)throw Error(i(407));l=l()}else{if(l=s(),Kt===null)throw Error(i(349));(_t&124)!==0||Jd(u,s,l)}d.memoizedState=l;var g={value:l,getSnapshot:s};return d.queue=g,mp(tp.bind(null,u,g,n),[n]),u.flags|=2048,Ti(9,Co(),ep.bind(null,u,g,l,s),null),l},useId:function(){var n=Ea(),s=Kt.identifierPrefix;if(Ut){var l=Pr,u=jr;l=(u&~(1<<32-on(u)-1)).toString(32)+l,s=""+s+"R"+l,l=wo++,0<l&&(s+="H"+l.toString(32)),s+=""}else l=iy++,s=""+s+"r"+l.toString(32)+"";return n.memoizedState=s},useHostTransitionStatus:Eu,useFormState:up,useActionState:up,useOptimistic:function(n){var s=Ea();s.memoizedState=s.baseState=n;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=wu.bind(null,Et,!0,l),l.dispatch=s,[n,s]},useMemoCache:hu,useCacheRefresh:function(){return Ea().memoizedState=fy.bind(null,Et)}},Op={readContext:sa,use:Ao,useCallback:Sp,useContext:sa,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:Ep,useReducer:To,useRef:hp,useState:function(){return To(Hr)},useDebugValue:bu,useDeferredValue:function(n,s){var l=kn();return wp(l,zt.memoizedState,n,s)},useTransition:function(){var n=To(Hr)[0],s=kn().memoizedState;return[typeof n=="boolean"?n:hl(n),s]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:Eu,useFormState:fp,useActionState:fp,useOptimistic:function(n,s){var l=kn();return rp(l,zt,n,s)},useMemoCache:hu,useCacheRefresh:Np},py={readContext:sa,use:Ao,useCallback:Sp,useContext:sa,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:Ep,useReducer:gu,useRef:hp,useState:function(){return gu(Hr)},useDebugValue:bu,useDeferredValue:function(n,s){var l=kn();return zt===null?xu(l,n,s):wp(l,zt.memoizedState,n,s)},useTransition:function(){var n=gu(Hr)[0],s=kn().memoizedState;return[typeof n=="boolean"?n:hl(n),s]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:Eu,useFormState:pp,useActionState:pp,useOptimistic:function(n,s){var l=kn();return zt!==null?rp(l,zt,n,s):(l.baseState=n,[n,l.queue.dispatch])},useMemoCache:hu,useCacheRefresh:Np},Ci=null,yl=0;function ko(n){var s=yl;return yl+=1,Ci===null&&(Ci=[]),Yd(Ci,n,s)}function vl(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Do(n,s){throw s.$$typeof===x?Error(i(525)):(n=Object.prototype.toString.call(s),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function Ip(n){var s=n._init;return s(n._payload)}function Lp(n){function s(se,ae){if(n){var ce=se.deletions;ce===null?(se.deletions=[ae],se.flags|=16):ce.push(ae)}}function l(se,ae){if(!n)return null;for(;ae!==null;)s(se,ae),ae=ae.sibling;return null}function u(se){for(var ae=new Map;se!==null;)se.key!==null?ae.set(se.key,se):ae.set(se.index,se),se=se.sibling;return ae}function d(se,ae){return se=Fr(se,ae),se.index=0,se.sibling=null,se}function g(se,ae,ce){return se.index=ce,n?(ce=se.alternate,ce!==null?(ce=ce.index,ce<ae?(se.flags|=67108866,ae):ce):(se.flags|=67108866,ae)):(se.flags|=1048576,ae)}function A(se){return n&&se.alternate===null&&(se.flags|=67108866),se}function R(se,ae,ce,we){return ae===null||ae.tag!==6?(ae=Yc(ce,se.mode,we),ae.return=se,ae):(ae=d(ae,ce),ae.return=se,ae)}function V(se,ae,ce,we){var Ze=ce.type;return Ze===E?Se(se,ae,ce.props.children,we,ce.key):ae!==null&&(ae.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===q&&Ip(Ze)===ae.type)?(ae=d(ae,ce.props),vl(ae,ce),ae.return=se,ae):(ae=po(ce.type,ce.key,ce.props,null,se.mode,we),vl(ae,ce),ae.return=se,ae)}function fe(se,ae,ce,we){return ae===null||ae.tag!==4||ae.stateNode.containerInfo!==ce.containerInfo||ae.stateNode.implementation!==ce.implementation?(ae=qc(ce,se.mode,we),ae.return=se,ae):(ae=d(ae,ce.children||[]),ae.return=se,ae)}function Se(se,ae,ce,we,Ze){return ae===null||ae.tag!==7?(ae=Ys(ce,se.mode,we,Ze),ae.return=se,ae):(ae=d(ae,ce),ae.return=se,ae)}function Te(se,ae,ce){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return ae=Yc(""+ae,se.mode,ce),ae.return=se,ae;if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case b:return ce=po(ae.type,ae.key,ae.props,null,se.mode,ce),vl(ce,ae),ce.return=se,ce;case S:return ae=qc(ae,se.mode,ce),ae.return=se,ae;case q:var we=ae._init;return ae=we(ae._payload),Te(se,ae,ce)}if(K(ae)||Z(ae))return ae=Ys(ae,se.mode,ce,null),ae.return=se,ae;if(typeof ae.then=="function")return Te(se,ko(ae),ce);if(ae.$$typeof===N)return Te(se,yo(se,ae),ce);Do(se,ae)}return null}function de(se,ae,ce,we){var Ze=ae!==null?ae.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ze!==null?null:R(se,ae,""+ce,we);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case b:return ce.key===Ze?V(se,ae,ce,we):null;case S:return ce.key===Ze?fe(se,ae,ce,we):null;case q:return Ze=ce._init,ce=Ze(ce._payload),de(se,ae,ce,we)}if(K(ce)||Z(ce))return Ze!==null?null:Se(se,ae,ce,we,null);if(typeof ce.then=="function")return de(se,ae,ko(ce),we);if(ce.$$typeof===N)return de(se,ae,yo(se,ce),we);Do(se,ce)}return null}function pe(se,ae,ce,we,Ze){if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return se=se.get(ce)||null,R(ae,se,""+we,Ze);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case b:return se=se.get(we.key===null?ce:we.key)||null,V(ae,se,we,Ze);case S:return se=se.get(we.key===null?ce:we.key)||null,fe(ae,se,we,Ze);case q:var Ct=we._init;return we=Ct(we._payload),pe(se,ae,ce,we,Ze)}if(K(we)||Z(we))return se=se.get(ce)||null,Se(ae,se,we,Ze,null);if(typeof we.then=="function")return pe(se,ae,ce,ko(we),Ze);if(we.$$typeof===N)return pe(se,ae,ce,yo(ae,we),Ze);Do(ae,we)}return null}function ft(se,ae,ce,we){for(var Ze=null,Ct=null,nt=ae,ct=ae=0,Yn=null;nt!==null&&ct<ce.length;ct++){nt.index>ct?(Yn=nt,nt=null):Yn=nt.sibling;var Lt=de(se,nt,ce[ct],we);if(Lt===null){nt===null&&(nt=Yn);break}n&&nt&&Lt.alternate===null&&s(se,nt),ae=g(Lt,ae,ct),Ct===null?Ze=Lt:Ct.sibling=Lt,Ct=Lt,nt=Yn}if(ct===ce.length)return l(se,nt),Ut&&Vs(se,ct),Ze;if(nt===null){for(;ct<ce.length;ct++)nt=Te(se,ce[ct],we),nt!==null&&(ae=g(nt,ae,ct),Ct===null?Ze=nt:Ct.sibling=nt,Ct=nt);return Ut&&Vs(se,ct),Ze}for(nt=u(nt);ct<ce.length;ct++)Yn=pe(nt,se,ct,ce[ct],we),Yn!==null&&(n&&Yn.alternate!==null&&nt.delete(Yn.key===null?ct:Yn.key),ae=g(Yn,ae,ct),Ct===null?Ze=Yn:Ct.sibling=Yn,Ct=Yn);return n&&nt.forEach(function(Ms){return s(se,Ms)}),Ut&&Vs(se,ct),Ze}function lt(se,ae,ce,we){if(ce==null)throw Error(i(151));for(var Ze=null,Ct=null,nt=ae,ct=ae=0,Yn=null,Lt=ce.next();nt!==null&&!Lt.done;ct++,Lt=ce.next()){nt.index>ct?(Yn=nt,nt=null):Yn=nt.sibling;var Ms=de(se,nt,Lt.value,we);if(Ms===null){nt===null&&(nt=Yn);break}n&&nt&&Ms.alternate===null&&s(se,nt),ae=g(Ms,ae,ct),Ct===null?Ze=Ms:Ct.sibling=Ms,Ct=Ms,nt=Yn}if(Lt.done)return l(se,nt),Ut&&Vs(se,ct),Ze;if(nt===null){for(;!Lt.done;ct++,Lt=ce.next())Lt=Te(se,Lt.value,we),Lt!==null&&(ae=g(Lt,ae,ct),Ct===null?Ze=Lt:Ct.sibling=Lt,Ct=Lt);return Ut&&Vs(se,ct),Ze}for(nt=u(nt);!Lt.done;ct++,Lt=ce.next())Lt=pe(nt,se,ct,Lt.value,we),Lt!==null&&(n&&Lt.alternate!==null&&nt.delete(Lt.key===null?ct:Lt.key),ae=g(Lt,ae,ct),Ct===null?Ze=Lt:Ct.sibling=Lt,Ct=Lt);return n&&nt.forEach(function(hv){return s(se,hv)}),Ut&&Vs(se,ct),Ze}function Ht(se,ae,ce,we){if(typeof ce=="object"&&ce!==null&&ce.type===E&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case b:e:{for(var Ze=ce.key;ae!==null;){if(ae.key===Ze){if(Ze=ce.type,Ze===E){if(ae.tag===7){l(se,ae.sibling),we=d(ae,ce.props.children),we.return=se,se=we;break e}}else if(ae.elementType===Ze||typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===q&&Ip(Ze)===ae.type){l(se,ae.sibling),we=d(ae,ce.props),vl(we,ce),we.return=se,se=we;break e}l(se,ae);break}else s(se,ae);ae=ae.sibling}ce.type===E?(we=Ys(ce.props.children,se.mode,we,ce.key),we.return=se,se=we):(we=po(ce.type,ce.key,ce.props,null,se.mode,we),vl(we,ce),we.return=se,se=we)}return A(se);case S:e:{for(Ze=ce.key;ae!==null;){if(ae.key===Ze)if(ae.tag===4&&ae.stateNode.containerInfo===ce.containerInfo&&ae.stateNode.implementation===ce.implementation){l(se,ae.sibling),we=d(ae,ce.children||[]),we.return=se,se=we;break e}else{l(se,ae);break}else s(se,ae);ae=ae.sibling}we=qc(ce,se.mode,we),we.return=se,se=we}return A(se);case q:return Ze=ce._init,ce=Ze(ce._payload),Ht(se,ae,ce,we)}if(K(ce))return ft(se,ae,ce,we);if(Z(ce)){if(Ze=Z(ce),typeof Ze!="function")throw Error(i(150));return ce=Ze.call(ce),lt(se,ae,ce,we)}if(typeof ce.then=="function")return Ht(se,ae,ko(ce),we);if(ce.$$typeof===N)return Ht(se,ae,yo(se,ce),we);Do(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ae!==null&&ae.tag===6?(l(se,ae.sibling),we=d(ae,ce),we.return=se,se=we):(l(se,ae),we=Yc(ce,se.mode,we),we.return=se,se=we),A(se)):l(se,ae)}return function(se,ae,ce,we){try{yl=0;var Ze=Ht(se,ae,ce,we);return Ci=null,Ze}catch(nt){if(nt===ol||nt===bo)throw nt;var Ct=Oa(29,nt,null,se.mode);return Ct.lanes=we,Ct.return=se,Ct}}}var Mi=Lp(!0),Up=Lp(!1),er=ee(null),Er=null;function ds(n){var s=n.alternate;Me(Un,Un.current&1),Me(er,n),Er===null&&(s===null||Ei.current!==null||s.memoizedState!==null)&&(Er=n)}function Bp(n){if(n.tag===22){if(Me(Un,Un.current),Me(er,n),Er===null){var s=n.alternate;s!==null&&s.memoizedState!==null&&(Er=n)}}else ps()}function ps(){Me(Un,Un.current),Me(er,er.current)}function Yr(n){ve(er),Er===n&&(Er=null),ve(Un)}var Un=ee(0);function _o(n){for(var s=n;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||hf(l)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Au(n,s,l,u){s=n.memoizedState,l=l(u,s),l=l==null?s:v({},s,l),n.memoizedState=l,n.lanes===0&&(n.updateQueue.baseState=l)}var Tu={enqueueSetState:function(n,s,l){n=n._reactInternals;var u=Ba(),d=cs(u);d.payload=s,l!=null&&(d.callback=l),s=us(n,d,u),s!==null&&(Fa(s,n,u),ul(s,n,u))},enqueueReplaceState:function(n,s,l){n=n._reactInternals;var u=Ba(),d=cs(u);d.tag=1,d.payload=s,l!=null&&(d.callback=l),s=us(n,d,u),s!==null&&(Fa(s,n,u),ul(s,n,u))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var l=Ba(),u=cs(l);u.tag=2,s!=null&&(u.callback=s),s=us(n,u,l),s!==null&&(Fa(s,n,l),ul(s,n,l))}};function Fp(n,s,l,u,d,g,A){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,g,A):s.prototype&&s.prototype.isPureReactComponent?!el(l,u)||!el(d,g):!0}function jp(n,s,l,u){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,u),s.state!==n&&Tu.enqueueReplaceState(s,s.state,null)}function Js(n,s){var l=s;if("ref"in s){l={};for(var u in s)u!=="ref"&&(l[u]=s[u])}if(n=n.defaultProps){l===s&&(l=v({},l));for(var d in n)l[d]===void 0&&(l[d]=n[d])}return l}var Oo=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function Pp(n){Oo(n)}function zp(n){console.error(n)}function Gp(n){Oo(n)}function Io(n,s){try{var l=n.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function Hp(n,s,l){try{var u=n.onCaughtError;u(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Cu(n,s,l){return l=cs(l),l.tag=3,l.payload={element:null},l.callback=function(){Io(n,s)},l}function Yp(n){return n=cs(n),n.tag=3,n}function qp(n,s,l,u){var d=l.type.getDerivedStateFromError;if(typeof d=="function"){var g=u.value;n.payload=function(){return d(g)},n.callback=function(){Hp(s,l,u)}}var A=l.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(n.callback=function(){Hp(s,l,u),typeof d!="function"&&(bs===null?bs=new Set([this]):bs.add(this));var R=u.stack;this.componentDidCatch(u.value,{componentStack:R!==null?R:""})})}function hy(n,s,l,u,d){if(l.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=l.alternate,s!==null&&sl(s,l,d,!0),l=er.current,l!==null){switch(l.tag){case 13:return Er===null?Qu():l.alternate===null&&yn===0&&(yn=3),l.flags&=-257,l.flags|=65536,l.lanes=d,u===tu?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([u]):s.add(u),Ku(n,u,d)),!1;case 22:return l.flags|=65536,u===tu?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([u]):l.add(u)),Ku(n,u,d)),!1}throw Error(i(435,l.tag))}return Ku(n,u,d),Qu(),!1}if(Ut)return s=er.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=d,u!==$c&&(n=Error(i(422),{cause:u}),rl(Qa(n,l)))):(u!==$c&&(s=Error(i(423),{cause:u}),rl(Qa(s,l))),n=n.current.alternate,n.flags|=65536,d&=-d,n.lanes|=d,u=Qa(u,l),d=Cu(n.stateNode,u,d),ru(n,d),yn!==4&&(yn=2)),!1;var g=Error(i(520),{cause:u});if(g=Qa(g,l),Tl===null?Tl=[g]:Tl.push(g),yn!==4&&(yn=2),s===null)return!0;u=Qa(u,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,n=d&-d,l.lanes|=n,n=Cu(l.stateNode,u,n),ru(l,n),!1;case 1:if(s=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(bs===null||!bs.has(g))))return l.flags|=65536,d&=-d,l.lanes|=d,d=Yp(d),qp(d,n,l,u),ru(l,d),!1}l=l.return}while(l!==null);return!1}var Vp=Error(i(461)),Gn=!1;function Zn(n,s,l,u){s.child=n===null?Up(s,null,l,u):Mi(s,n.child,l,u)}function Xp(n,s,l,u,d){l=l.render;var g=s.ref;if("ref"in u){var A={};for(var R in u)R!=="ref"&&(A[R]=u[R])}else A=u;return Qs(s),u=cu(n,s,l,A,g,d),R=uu(),n!==null&&!Gn?(fu(n,s,d),qr(n,s,d)):(Ut&&R&&Vc(s),s.flags|=1,Zn(n,s,u,d),s.child)}function $p(n,s,l,u,d){if(n===null){var g=l.type;return typeof g=="function"&&!Hc(g)&&g.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=g,Zp(n,s,g,u,d)):(n=po(l.type,null,u,s,s.mode,d),n.ref=s.ref,n.return=s,s.child=n)}if(g=n.child,!Iu(n,d)){var A=g.memoizedProps;if(l=l.compare,l=l!==null?l:el,l(A,u)&&n.ref===s.ref)return qr(n,s,d)}return s.flags|=1,n=Fr(g,u),n.ref=s.ref,n.return=s,s.child=n}function Zp(n,s,l,u,d){if(n!==null){var g=n.memoizedProps;if(el(g,u)&&n.ref===s.ref)if(Gn=!1,s.pendingProps=u=g,Iu(n,d))(n.flags&131072)!==0&&(Gn=!0);else return s.lanes=n.lanes,qr(n,s,d)}return Mu(n,s,l,u,d)}function Qp(n,s,l){var u=s.pendingProps,d=u.children,g=n!==null?n.memoizedState:null;if(u.mode==="hidden"){if((s.flags&128)!==0){if(u=g!==null?g.baseLanes|l:l,n!==null){for(d=s.child=n.child,g=0;d!==null;)g=g|d.lanes|d.childLanes,d=d.sibling;s.childLanes=g&~u}else s.childLanes=0,s.child=null;return Wp(n,s,u,l)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&vo(s,g!==null?g.cachePool:null),g!==null?Zd(s,g):iu(),Bp(s);else return s.lanes=s.childLanes=536870912,Wp(n,s,g!==null?g.baseLanes|l:l,l)}else g!==null?(vo(s,g.cachePool),Zd(s,g),ps(),s.memoizedState=null):(n!==null&&vo(s,null),iu(),ps());return Zn(n,s,d,l),s.child}function Wp(n,s,l,u){var d=eu();return d=d===null?null:{parent:Ln._currentValue,pool:d},s.memoizedState={baseLanes:l,cachePool:d},n!==null&&vo(s,null),iu(),Bp(s),n!==null&&sl(n,s,u,!0),null}function Lo(n,s){var l=s.ref;if(l===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(n===null||n.ref!==l)&&(s.flags|=4194816)}}function Mu(n,s,l,u,d){return Qs(s),l=cu(n,s,l,u,void 0,d),u=uu(),n!==null&&!Gn?(fu(n,s,d),qr(n,s,d)):(Ut&&u&&Vc(s),s.flags|=1,Zn(n,s,l,d),s.child)}function Kp(n,s,l,u,d,g){return Qs(s),s.updateQueue=null,l=Wd(s,u,l,d),Qd(n),u=uu(),n!==null&&!Gn?(fu(n,s,g),qr(n,s,g)):(Ut&&u&&Vc(s),s.flags|=1,Zn(n,s,l,g),s.child)}function Jp(n,s,l,u,d){if(Qs(s),s.stateNode===null){var g=yi,A=l.contextType;typeof A=="object"&&A!==null&&(g=sa(A)),g=new l(u,g),s.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Tu,s.stateNode=g,g._reactInternals=s,g=s.stateNode,g.props=u,g.state=s.memoizedState,g.refs={},nu(s),A=l.contextType,g.context=typeof A=="object"&&A!==null?sa(A):yi,g.state=s.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(Au(s,l,A,u),g.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(A=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),A!==g.state&&Tu.enqueueReplaceState(g,g.state,null),dl(s,u,g,d),fl(),g.state=s.memoizedState),typeof g.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(n===null){g=s.stateNode;var R=s.memoizedProps,V=Js(l,R);g.props=V;var fe=g.context,Se=l.contextType;A=yi,typeof Se=="object"&&Se!==null&&(A=sa(Se));var Te=l.getDerivedStateFromProps;Se=typeof Te=="function"||typeof g.getSnapshotBeforeUpdate=="function",R=s.pendingProps!==R,Se||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R||fe!==A)&&jp(s,g,u,A),os=!1;var de=s.memoizedState;g.state=de,dl(s,u,g,d),fl(),fe=s.memoizedState,R||de!==fe||os?(typeof Te=="function"&&(Au(s,l,Te,u),fe=s.memoizedState),(V=os||Fp(s,l,V,u,de,fe,A))?(Se||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=fe),g.props=u,g.state=fe,g.context=A,u=V):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{g=s.stateNode,au(n,s),A=s.memoizedProps,Se=Js(l,A),g.props=Se,Te=s.pendingProps,de=g.context,fe=l.contextType,V=yi,typeof fe=="object"&&fe!==null&&(V=sa(fe)),R=l.getDerivedStateFromProps,(fe=typeof R=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(A!==Te||de!==V)&&jp(s,g,u,V),os=!1,de=s.memoizedState,g.state=de,dl(s,u,g,d),fl();var pe=s.memoizedState;A!==Te||de!==pe||os||n!==null&&n.dependencies!==null&&go(n.dependencies)?(typeof R=="function"&&(Au(s,l,R,u),pe=s.memoizedState),(Se=os||Fp(s,l,Se,u,de,pe,V)||n!==null&&n.dependencies!==null&&go(n.dependencies))?(fe||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(u,pe,V),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(u,pe,V)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||A===n.memoizedProps&&de===n.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||A===n.memoizedProps&&de===n.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=pe),g.props=u,g.state=pe,g.context=V,u=Se):(typeof g.componentDidUpdate!="function"||A===n.memoizedProps&&de===n.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||A===n.memoizedProps&&de===n.memoizedState||(s.flags|=1024),u=!1)}return g=u,Lo(n,s),u=(s.flags&128)!==0,g||u?(g=s.stateNode,l=u&&typeof l.getDerivedStateFromError!="function"?null:g.render(),s.flags|=1,n!==null&&u?(s.child=Mi(s,n.child,null,d),s.child=Mi(s,null,l,d)):Zn(n,s,l,d),s.memoizedState=g.state,n=s.child):n=qr(n,s,d),n}function eh(n,s,l,u){return al(),s.flags|=256,Zn(n,s,l,u),s.child}var Nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ru(n){return{baseLanes:n,cachePool:zd()}}function ku(n,s,l){return n=n!==null?n.childLanes&~l:0,s&&(n|=tr),n}function th(n,s,l){var u=s.pendingProps,d=!1,g=(s.flags&128)!==0,A;if((A=g)||(A=n!==null&&n.memoizedState===null?!1:(Un.current&2)!==0),A&&(d=!0,s.flags&=-129),A=(s.flags&32)!==0,s.flags&=-33,n===null){if(Ut){if(d?ds(s):ps(),Ut){var R=gn,V;if(V=R){e:{for(V=R,R=Sr;V.nodeType!==8;){if(!R){R=null;break e}if(V=cr(V.nextSibling),V===null){R=null;break e}}R=V}R!==null?(s.memoizedState={dehydrated:R,treeContext:qs!==null?{id:jr,overflow:Pr}:null,retryLane:536870912,hydrationErrors:null},V=Oa(18,null,null,0),V.stateNode=R,V.return=s,s.child=V,pa=s,gn=null,V=!0):V=!1}V||$s(s)}if(R=s.memoizedState,R!==null&&(R=R.dehydrated,R!==null))return hf(R)?s.lanes=32:s.lanes=536870912,null;Yr(s)}return R=u.children,u=u.fallback,d?(ps(),d=s.mode,R=Uo({mode:"hidden",children:R},d),u=Ys(u,d,l,null),R.return=s,u.return=s,R.sibling=u,s.child=R,d=s.child,d.memoizedState=Ru(l),d.childLanes=ku(n,A,l),s.memoizedState=Nu,u):(ds(s),Du(s,R))}if(V=n.memoizedState,V!==null&&(R=V.dehydrated,R!==null)){if(g)s.flags&256?(ds(s),s.flags&=-257,s=_u(n,s,l)):s.memoizedState!==null?(ps(),s.child=n.child,s.flags|=128,s=null):(ps(),d=u.fallback,R=s.mode,u=Uo({mode:"visible",children:u.children},R),d=Ys(d,R,l,null),d.flags|=2,u.return=s,d.return=s,u.sibling=d,s.child=u,Mi(s,n.child,null,l),u=s.child,u.memoizedState=Ru(l),u.childLanes=ku(n,A,l),s.memoizedState=Nu,s=d);else if(ds(s),hf(R)){if(A=R.nextSibling&&R.nextSibling.dataset,A)var fe=A.dgst;A=fe,u=Error(i(419)),u.stack="",u.digest=A,rl({value:u,source:null,stack:null}),s=_u(n,s,l)}else if(Gn||sl(n,s,l,!1),A=(l&n.childLanes)!==0,Gn||A){if(A=Kt,A!==null&&(u=l&-l,u=(u&42)!==0?1:Ca(u),u=(u&(A.suspendedLanes|l))!==0?0:u,u!==0&&u!==V.retryLane))throw V.retryLane=u,gi(n,u),Fa(A,n,u),Vp;R.data==="$?"||Qu(),s=_u(n,s,l)}else R.data==="$?"?(s.flags|=192,s.child=n.child,s=null):(n=V.treeContext,gn=cr(R.nextSibling),pa=s,Ut=!0,Xs=null,Sr=!1,n!==null&&(Ka[Ja++]=jr,Ka[Ja++]=Pr,Ka[Ja++]=qs,jr=n.id,Pr=n.overflow,qs=s),s=Du(s,u.children),s.flags|=4096);return s}return d?(ps(),d=u.fallback,R=s.mode,V=n.child,fe=V.sibling,u=Fr(V,{mode:"hidden",children:u.children}),u.subtreeFlags=V.subtreeFlags&65011712,fe!==null?d=Fr(fe,d):(d=Ys(d,R,l,null),d.flags|=2),d.return=s,u.return=s,u.sibling=d,s.child=u,u=d,d=s.child,R=n.child.memoizedState,R===null?R=Ru(l):(V=R.cachePool,V!==null?(fe=Ln._currentValue,V=V.parent!==fe?{parent:fe,pool:fe}:V):V=zd(),R={baseLanes:R.baseLanes|l,cachePool:V}),d.memoizedState=R,d.childLanes=ku(n,A,l),s.memoizedState=Nu,u):(ds(s),l=n.child,n=l.sibling,l=Fr(l,{mode:"visible",children:u.children}),l.return=s,l.sibling=null,n!==null&&(A=s.deletions,A===null?(s.deletions=[n],s.flags|=16):A.push(n)),s.child=l,s.memoizedState=null,l)}function Du(n,s){return s=Uo({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function Uo(n,s){return n=Oa(22,n,null,s),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function _u(n,s,l){return Mi(s,n.child,null,l),n=Du(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function nh(n,s,l){n.lanes|=s;var u=n.alternate;u!==null&&(u.lanes|=s),Qc(n.return,s,l)}function Ou(n,s,l,u,d){var g=n.memoizedState;g===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:d}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=u,g.tail=l,g.tailMode=d)}function ah(n,s,l){var u=s.pendingProps,d=u.revealOrder,g=u.tail;if(Zn(n,s,u.children,l),u=Un.current,(u&2)!==0)u=u&1|2,s.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&nh(n,l,s);else if(n.tag===19)nh(n,l,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}u&=1}switch(Me(Un,u),d){case"forwards":for(l=s.child,d=null;l!==null;)n=l.alternate,n!==null&&_o(n)===null&&(d=l),l=l.sibling;l=d,l===null?(d=s.child,s.child=null):(d=l.sibling,l.sibling=null),Ou(s,!1,d,l,g);break;case"backwards":for(l=null,d=s.child,s.child=null;d!==null;){if(n=d.alternate,n!==null&&_o(n)===null){s.child=d;break}n=d.sibling,d.sibling=l,l=d,d=n}Ou(s,!0,l,null,g);break;case"together":Ou(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function qr(n,s,l){if(n!==null&&(s.dependencies=n.dependencies),vs|=s.lanes,(l&s.childLanes)===0)if(n!==null){if(sl(n,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(i(153));if(s.child!==null){for(n=s.child,l=Fr(n,n.pendingProps),s.child=l,l.return=s;n.sibling!==null;)n=n.sibling,l=l.sibling=Fr(n,n.pendingProps),l.return=s;l.sibling=null}return s.child}function Iu(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&go(n)))}function my(n,s,l){switch(s.tag){case 3:tt(s,s.stateNode.containerInfo),ls(s,Ln,n.memoizedState.cache),al();break;case 27:case 5:sn(s);break;case 4:tt(s,s.stateNode.containerInfo);break;case 10:ls(s,s.type,s.memoizedProps.value);break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(ds(s),s.flags|=128,null):(l&s.child.childLanes)!==0?th(n,s,l):(ds(s),n=qr(n,s,l),n!==null?n.sibling:null);ds(s);break;case 19:var d=(n.flags&128)!==0;if(u=(l&s.childLanes)!==0,u||(sl(n,s,l,!1),u=(l&s.childLanes)!==0),d){if(u)return ah(n,s,l);s.flags|=128}if(d=s.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Me(Un,Un.current),u)break;return null;case 22:case 23:return s.lanes=0,Qp(n,s,l);case 24:ls(s,Ln,n.memoizedState.cache)}return qr(n,s,l)}function rh(n,s,l){if(n!==null)if(n.memoizedProps!==s.pendingProps)Gn=!0;else{if(!Iu(n,l)&&(s.flags&128)===0)return Gn=!1,my(n,s,l);Gn=(n.flags&131072)!==0}else Gn=!1,Ut&&(s.flags&1048576)!==0&&Id(s,mo,s.index);switch(s.lanes=0,s.tag){case 16:e:{n=s.pendingProps;var u=s.elementType,d=u._init;if(u=d(u._payload),s.type=u,typeof u=="function")Hc(u)?(n=Js(u,n),s.tag=1,s=Jp(null,s,u,n,l)):(s.tag=0,s=Mu(null,s,u,n,l));else{if(u!=null){if(d=u.$$typeof,d===D){s.tag=11,s=Xp(null,s,u,n,l);break e}else if(d===P){s.tag=14,s=$p(null,s,u,n,l);break e}}throw s=X(u)||u,Error(i(306,s,""))}}return s;case 0:return Mu(n,s,s.type,s.pendingProps,l);case 1:return u=s.type,d=Js(u,s.pendingProps),Jp(n,s,u,d,l);case 3:e:{if(tt(s,s.stateNode.containerInfo),n===null)throw Error(i(387));u=s.pendingProps;var g=s.memoizedState;d=g.element,au(n,s),dl(s,u,null,l);var A=s.memoizedState;if(u=A.cache,ls(s,Ln,u),u!==g.cache&&Wc(s,[Ln],l,!0),fl(),u=A.element,g.isDehydrated)if(g={element:u,isDehydrated:!1,cache:A.cache},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){s=eh(n,s,u,l);break e}else if(u!==d){d=Qa(Error(i(424)),s),rl(d),s=eh(n,s,u,l);break e}else for(n=s.stateNode.containerInfo,n.nodeType===9?n=n.body:n=n.nodeName==="HTML"?n.ownerDocument.body:n,gn=cr(n.firstChild),pa=s,Ut=!0,Xs=null,Sr=!0,l=Up(s,null,u,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(al(),u===d){s=qr(n,s,l);break e}Zn(n,s,u,l)}s=s.child}return s;case 26:return Lo(n,s),n===null?(l=o0(s.type,null,s.pendingProps,null))?s.memoizedState=l:Ut||(l=s.type,n=s.pendingProps,u=Qo(Oe.current).createElement(l),u[bn]=s,u[xn]=n,Wn(u,l,n),it(u),s.stateNode=u):s.memoizedState=o0(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return sn(s),n===null&&Ut&&(u=s.stateNode=s0(s.type,s.pendingProps,Oe.current),pa=s,Sr=!0,d=gn,Es(s.type)?(mf=d,gn=cr(u.firstChild)):gn=d),Zn(n,s,s.pendingProps.children,l),Lo(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&Ut&&((d=u=gn)&&(u=Hy(u,s.type,s.pendingProps,Sr),u!==null?(s.stateNode=u,pa=s,gn=cr(u.firstChild),Sr=!1,d=!0):d=!1),d||$s(s)),sn(s),d=s.type,g=s.pendingProps,A=n!==null?n.memoizedProps:null,u=g.children,ff(d,g)?u=null:A!==null&&ff(d,A)&&(s.flags|=32),s.memoizedState!==null&&(d=cu(n,s,ly,null,null,l),Il._currentValue=d),Lo(n,s),Zn(n,s,u,l),s.child;case 6:return n===null&&Ut&&((n=l=gn)&&(l=Yy(l,s.pendingProps,Sr),l!==null?(s.stateNode=l,pa=s,gn=null,n=!0):n=!1),n||$s(s)),null;case 13:return th(n,s,l);case 4:return tt(s,s.stateNode.containerInfo),u=s.pendingProps,n===null?s.child=Mi(s,null,u,l):Zn(n,s,u,l),s.child;case 11:return Xp(n,s,s.type,s.pendingProps,l);case 7:return Zn(n,s,s.pendingProps,l),s.child;case 8:return Zn(n,s,s.pendingProps.children,l),s.child;case 12:return Zn(n,s,s.pendingProps.children,l),s.child;case 10:return u=s.pendingProps,ls(s,s.type,u.value),Zn(n,s,u.children,l),s.child;case 9:return d=s.type._context,u=s.pendingProps.children,Qs(s),d=sa(d),u=u(d),s.flags|=1,Zn(n,s,u,l),s.child;case 14:return $p(n,s,s.type,s.pendingProps,l);case 15:return Zp(n,s,s.type,s.pendingProps,l);case 19:return ah(n,s,l);case 31:return u=s.pendingProps,l=s.mode,u={mode:u.mode,children:u.children},n===null?(l=Uo(u,l),l.ref=s.ref,s.child=l,l.return=s,s=l):(l=Fr(n.child,u),l.ref=s.ref,s.child=l,l.return=s,s=l),s;case 22:return Qp(n,s,l);case 24:return Qs(s),u=sa(Ln),n===null?(d=eu(),d===null&&(d=Kt,g=Kc(),d.pooledCache=g,g.refCount++,g!==null&&(d.pooledCacheLanes|=l),d=g),s.memoizedState={parent:u,cache:d},nu(s),ls(s,Ln,d)):((n.lanes&l)!==0&&(au(n,s),dl(s,null,null,l),fl()),d=n.memoizedState,g=s.memoizedState,d.parent!==u?(d={parent:u,cache:u},s.memoizedState=d,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=d),ls(s,Ln,u)):(u=g.cache,ls(s,Ln,u),u!==d.cache&&Wc(s,[Ln],l,!0))),Zn(n,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Vr(n){n.flags|=4}function sh(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!p0(s)){if(s=er.current,s!==null&&((_t&4194048)===_t?Er!==null:(_t&62914560)!==_t&&(_t&536870912)===0||s!==Er))throw cl=tu,Gd;n.flags|=8192}}function Bo(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?Ga():536870912,n.lanes|=s,Di|=s)}function bl(n,s){if(!Ut)switch(n.tailMode){case"hidden":s=n.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n.tail=null:l.sibling=null;break;case"collapsed":l=n.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function hn(n){var s=n.alternate!==null&&n.alternate.child===n.child,l=0,u=0;if(s)for(var d=n.child;d!==null;)l|=d.lanes|d.childLanes,u|=d.subtreeFlags&65011712,u|=d.flags&65011712,d.return=n,d=d.sibling;else for(d=n.child;d!==null;)l|=d.lanes|d.childLanes,u|=d.subtreeFlags,u|=d.flags,d.return=n,d=d.sibling;return n.subtreeFlags|=u,n.childLanes=l,s}function gy(n,s,l){var u=s.pendingProps;switch(Xc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hn(s),null;case 1:return hn(s),null;case 3:return l=s.stateNode,u=null,n!==null&&(u=n.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Gr(Ln),bt(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(n===null||n.child===null)&&(nl(s)?Vr(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Bd())),hn(s),null;case 26:return l=s.memoizedState,n===null?(Vr(s),l!==null?(hn(s),sh(s,l)):(hn(s),s.flags&=-16777217)):l?l!==n.memoizedState?(Vr(s),hn(s),sh(s,l)):(hn(s),s.flags&=-16777217):(n.memoizedProps!==u&&Vr(s),hn(s),s.flags&=-16777217),null;case 27:Jt(s),l=Oe.current;var d=s.type;if(n!==null&&s.stateNode!=null)n.memoizedProps!==u&&Vr(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return hn(s),null}n=me.current,nl(s)?Ld(s):(n=s0(d,u,l),s.stateNode=n,Vr(s))}return hn(s),null;case 5:if(Jt(s),l=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==u&&Vr(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return hn(s),null}if(n=me.current,nl(s))Ld(s);else{switch(d=Qo(Oe.current),n){case 1:n=d.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:n=d.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":n=d.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":n=d.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":n=d.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof u.is=="string"?d.createElement("select",{is:u.is}):d.createElement("select"),u.multiple?n.multiple=!0:u.size&&(n.size=u.size);break;default:n=typeof u.is=="string"?d.createElement(l,{is:u.is}):d.createElement(l)}}n[bn]=s,n[xn]=u;e:for(d=s.child;d!==null;){if(d.tag===5||d.tag===6)n.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}s.stateNode=n;e:switch(Wn(n,l,u),l){case"button":case"input":case"select":case"textarea":n=!!u.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Vr(s)}}return hn(s),s.flags&=-16777217,null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==u&&Vr(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(i(166));if(n=Oe.current,nl(s)){if(n=s.stateNode,l=s.memoizedProps,u=null,d=pa,d!==null)switch(d.tag){case 27:case 5:u=d.memoizedProps}n[bn]=s,n=!!(n.nodeValue===l||u!==null&&u.suppressHydrationWarning===!0||Kh(n.nodeValue,l)),n||$s(s)}else n=Qo(n).createTextNode(u),n[bn]=s,s.stateNode=n}return hn(s),null;case 13:if(u=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(d=nl(s),u!==null&&u.dehydrated!==null){if(n===null){if(!d)throw Error(i(318));if(d=s.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));d[bn]=s}else al(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;hn(s),d=!1}else d=Bd(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=d),d=!0;if(!d)return s.flags&256?(Yr(s),s):(Yr(s),null)}if(Yr(s),(s.flags&128)!==0)return s.lanes=l,s;if(l=u!==null,n=n!==null&&n.memoizedState!==null,l){u=s.child,d=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(d=u.alternate.memoizedState.cachePool.pool);var g=null;u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),g!==d&&(u.flags|=2048)}return l!==n&&l&&(s.child.flags|=8192),Bo(s,s.updateQueue),hn(s),null;case 4:return bt(),n===null&&sf(s.stateNode.containerInfo),hn(s),null;case 10:return Gr(s.type),hn(s),null;case 19:if(ve(Un),d=s.memoizedState,d===null)return hn(s),null;if(u=(s.flags&128)!==0,g=d.rendering,g===null)if(u)bl(d,!1);else{if(yn!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(g=_o(n),g!==null){for(s.flags|=128,bl(d,!1),n=g.updateQueue,s.updateQueue=n,Bo(s,n),s.subtreeFlags=0,n=l,l=s.child;l!==null;)Od(l,n),l=l.sibling;return Me(Un,Un.current&1|2),s.child}n=n.sibling}d.tail!==null&&Re()>Po&&(s.flags|=128,u=!0,bl(d,!1),s.lanes=4194304)}else{if(!u)if(n=_o(g),n!==null){if(s.flags|=128,u=!0,n=n.updateQueue,s.updateQueue=n,Bo(s,n),bl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!g.alternate&&!Ut)return hn(s),null}else 2*Re()-d.renderingStartTime>Po&&l!==536870912&&(s.flags|=128,u=!0,bl(d,!1),s.lanes=4194304);d.isBackwards?(g.sibling=s.child,s.child=g):(n=d.last,n!==null?n.sibling=g:s.child=g,d.last=g)}return d.tail!==null?(s=d.tail,d.rendering=s,d.tail=s.sibling,d.renderingStartTime=Re(),s.sibling=null,n=Un.current,Me(Un,u?n&1|2:n&1),s):(hn(s),null);case 22:case 23:return Yr(s),lu(),u=s.memoizedState!==null,n!==null?n.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(l&536870912)!==0&&(s.flags&128)===0&&(hn(s),s.subtreeFlags&6&&(s.flags|=8192)):hn(s),l=s.updateQueue,l!==null&&Bo(s,l.retryQueue),l=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==l&&(s.flags|=2048),n!==null&&ve(Ws),null;case 24:return l=null,n!==null&&(l=n.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Gr(Ln),hn(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function yy(n,s){switch(Xc(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Gr(Ln),bt(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return Jt(s),null;case 13:if(Yr(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(i(340));al()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return ve(Un),null;case 4:return bt(),null;case 10:return Gr(s.type),null;case 22:case 23:return Yr(s),lu(),n!==null&&ve(Ws),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return Gr(Ln),null;case 25:return null;default:return null}}function ih(n,s){switch(Xc(s),s.tag){case 3:Gr(Ln),bt();break;case 26:case 27:case 5:Jt(s);break;case 4:bt();break;case 13:Yr(s);break;case 19:ve(Un);break;case 10:Gr(s.type);break;case 22:case 23:Yr(s),lu(),n!==null&&ve(Ws);break;case 24:Gr(Ln)}}function xl(n,s){try{var l=s.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var d=u.next;l=d;do{if((l.tag&n)===n){u=void 0;var g=l.create,A=l.inst;u=g(),A.destroy=u}l=l.next}while(l!==d)}}catch(R){Zt(s,s.return,R)}}function hs(n,s,l){try{var u=s.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var g=d.next;u=g;do{if((u.tag&n)===n){var A=u.inst,R=A.destroy;if(R!==void 0){A.destroy=void 0,d=s;var V=l,fe=R;try{fe()}catch(Se){Zt(d,V,Se)}}}u=u.next}while(u!==g)}}catch(Se){Zt(s,s.return,Se)}}function lh(n){var s=n.updateQueue;if(s!==null){var l=n.stateNode;try{$d(s,l)}catch(u){Zt(n,n.return,u)}}}function oh(n,s,l){l.props=Js(n.type,n.memoizedProps),l.state=n.memoizedState;try{l.componentWillUnmount()}catch(u){Zt(n,s,u)}}function Sl(n,s){try{var l=n.ref;if(l!==null){switch(n.tag){case 26:case 27:case 5:var u=n.stateNode;break;case 30:u=n.stateNode;break;default:u=n.stateNode}typeof l=="function"?n.refCleanup=l(u):l.current=u}}catch(d){Zt(n,s,d)}}function wr(n,s){var l=n.ref,u=n.refCleanup;if(l!==null)if(typeof u=="function")try{u()}catch(d){Zt(n,s,d)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(d){Zt(n,s,d)}else l.current=null}function ch(n){var s=n.type,l=n.memoizedProps,u=n.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&u.focus();break e;case"img":l.src?u.src=l.src:l.srcSet&&(u.srcset=l.srcSet)}}catch(d){Zt(n,n.return,d)}}function Lu(n,s,l){try{var u=n.stateNode;Fy(u,n.type,l,s),u[xn]=s}catch(d){Zt(n,n.return,d)}}function uh(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Es(n.type)||n.tag===4}function Uu(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||uh(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Es(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Bu(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(n,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(n),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Zo));else if(u!==4&&(u===27&&Es(n.type)&&(l=n.stateNode,s=null),n=n.child,n!==null))for(Bu(n,s,l),n=n.sibling;n!==null;)Bu(n,s,l),n=n.sibling}function Fo(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?l.insertBefore(n,s):l.appendChild(n);else if(u!==4&&(u===27&&Es(n.type)&&(l=n.stateNode),n=n.child,n!==null))for(Fo(n,s,l),n=n.sibling;n!==null;)Fo(n,s,l),n=n.sibling}function fh(n){var s=n.stateNode,l=n.memoizedProps;try{for(var u=n.type,d=s.attributes;d.length;)s.removeAttributeNode(d[0]);Wn(s,u,l),s[bn]=n,s[xn]=l}catch(g){Zt(n,n.return,g)}}var Xr=!1,Tn=!1,Fu=!1,dh=typeof WeakSet=="function"?WeakSet:Set,Hn=null;function vy(n,s){if(n=n.containerInfo,cf=nc,n=wd(n),Uc(n)){if("selectionStart"in n)var l={start:n.selectionStart,end:n.selectionEnd};else e:{l=(l=n.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var d=u.anchorOffset,g=u.focusNode;u=u.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var A=0,R=-1,V=-1,fe=0,Se=0,Te=n,de=null;t:for(;;){for(var pe;Te!==l||d!==0&&Te.nodeType!==3||(R=A+d),Te!==g||u!==0&&Te.nodeType!==3||(V=A+u),Te.nodeType===3&&(A+=Te.nodeValue.length),(pe=Te.firstChild)!==null;)de=Te,Te=pe;for(;;){if(Te===n)break t;if(de===l&&++fe===d&&(R=A),de===g&&++Se===u&&(V=A),(pe=Te.nextSibling)!==null)break;Te=de,de=Te.parentNode}Te=pe}l=R===-1||V===-1?null:{start:R,end:V}}else l=null}l=l||{start:0,end:0}}else l=null;for(uf={focusedElem:n,selectionRange:l},nc=!1,Hn=s;Hn!==null;)if(s=Hn,n=s.child,(s.subtreeFlags&1024)!==0&&n!==null)n.return=s,Hn=n;else for(;Hn!==null;){switch(s=Hn,g=s.alternate,n=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&g!==null){n=void 0,l=s,d=g.memoizedProps,g=g.memoizedState,u=l.stateNode;try{var ft=Js(l.type,d,l.elementType===l.type);n=u.getSnapshotBeforeUpdate(ft,g),u.__reactInternalSnapshotBeforeUpdate=n}catch(lt){Zt(l,l.return,lt)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,l=n.nodeType,l===9)pf(n);else if(l===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":pf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=s.sibling,n!==null){n.return=s.return,Hn=n;break}Hn=s.return}}function ph(n,s,l){var u=l.flags;switch(l.tag){case 0:case 11:case 15:ms(n,l),u&4&&xl(5,l);break;case 1:if(ms(n,l),u&4)if(n=l.stateNode,s===null)try{n.componentDidMount()}catch(A){Zt(l,l.return,A)}else{var d=Js(l.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(d,s,n.__reactInternalSnapshotBeforeUpdate)}catch(A){Zt(l,l.return,A)}}u&64&&lh(l),u&512&&Sl(l,l.return);break;case 3:if(ms(n,l),u&64&&(n=l.updateQueue,n!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{$d(n,s)}catch(A){Zt(l,l.return,A)}}break;case 27:s===null&&u&4&&fh(l);case 26:case 5:ms(n,l),s===null&&u&4&&ch(l),u&512&&Sl(l,l.return);break;case 12:ms(n,l);break;case 13:ms(n,l),u&4&&gh(n,l),u&64&&(n=l.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(l=My.bind(null,l),qy(n,l))));break;case 22:if(u=l.memoizedState!==null||Xr,!u){s=s!==null&&s.memoizedState!==null||Tn,d=Xr;var g=Tn;Xr=u,(Tn=s)&&!g?gs(n,l,(l.subtreeFlags&8772)!==0):ms(n,l),Xr=d,Tn=g}break;case 30:break;default:ms(n,l)}}function hh(n){var s=n.alternate;s!==null&&(n.alternate=null,hh(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&rs(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var fn=null,wa=!1;function $r(n,s,l){for(l=l.child;l!==null;)mh(n,s,l),l=l.sibling}function mh(n,s,l){if(At&&typeof At.onCommitFiberUnmount=="function")try{At.onCommitFiberUnmount(Ye,l)}catch{}switch(l.tag){case 26:Tn||wr(l,s),$r(n,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Tn||wr(l,s);var u=fn,d=wa;Es(l.type)&&(fn=l.stateNode,wa=!1),$r(n,s,l),kl(l.stateNode),fn=u,wa=d;break;case 5:Tn||wr(l,s);case 6:if(u=fn,d=wa,fn=null,$r(n,s,l),fn=u,wa=d,fn!==null)if(wa)try{(fn.nodeType===9?fn.body:fn.nodeName==="HTML"?fn.ownerDocument.body:fn).removeChild(l.stateNode)}catch(g){Zt(l,s,g)}else try{fn.removeChild(l.stateNode)}catch(g){Zt(l,s,g)}break;case 18:fn!==null&&(wa?(n=fn,a0(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,l.stateNode),Fl(n)):a0(fn,l.stateNode));break;case 4:u=fn,d=wa,fn=l.stateNode.containerInfo,wa=!0,$r(n,s,l),fn=u,wa=d;break;case 0:case 11:case 14:case 15:Tn||hs(2,l,s),Tn||hs(4,l,s),$r(n,s,l);break;case 1:Tn||(wr(l,s),u=l.stateNode,typeof u.componentWillUnmount=="function"&&oh(l,s,u)),$r(n,s,l);break;case 21:$r(n,s,l);break;case 22:Tn=(u=Tn)||l.memoizedState!==null,$r(n,s,l),Tn=u;break;default:$r(n,s,l)}}function gh(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Fl(n)}catch(l){Zt(s,s.return,l)}}function by(n){switch(n.tag){case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new dh),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new dh),s;default:throw Error(i(435,n.tag))}}function ju(n,s){var l=by(n);s.forEach(function(u){var d=Ny.bind(null,n,u);l.has(u)||(l.add(u),u.then(d,d))})}function Ia(n,s){var l=s.deletions;if(l!==null)for(var u=0;u<l.length;u++){var d=l[u],g=n,A=s,R=A;e:for(;R!==null;){switch(R.tag){case 27:if(Es(R.type)){fn=R.stateNode,wa=!1;break e}break;case 5:fn=R.stateNode,wa=!1;break e;case 3:case 4:fn=R.stateNode.containerInfo,wa=!0;break e}R=R.return}if(fn===null)throw Error(i(160));mh(g,A,d),fn=null,wa=!1,g=d.alternate,g!==null&&(g.return=null),d.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)yh(s,n),s=s.sibling}var or=null;function yh(n,s){var l=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ia(s,n),La(n),u&4&&(hs(3,n,n.return),xl(3,n),hs(5,n,n.return));break;case 1:Ia(s,n),La(n),u&512&&(Tn||l===null||wr(l,l.return)),u&64&&Xr&&(n=n.updateQueue,n!==null&&(u=n.callbacks,u!==null&&(l=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=l===null?u:l.concat(u))));break;case 26:var d=or;if(Ia(s,n),La(n),u&512&&(Tn||l===null||wr(l,l.return)),u&4){var g=l!==null?l.memoizedState:null;if(u=n.memoizedState,l===null)if(u===null)if(n.stateNode===null){e:{u=n.type,l=n.memoizedProps,d=d.ownerDocument||d;t:switch(u){case"title":g=d.getElementsByTagName("title")[0],(!g||g[as]||g[bn]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=d.createElement(u),d.head.insertBefore(g,d.querySelector("head > title"))),Wn(g,u,l),g[bn]=n,it(g),u=g;break e;case"link":var A=f0("link","href",d).get(u+(l.href||""));if(A){for(var R=0;R<A.length;R++)if(g=A[R],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){A.splice(R,1);break t}}g=d.createElement(u),Wn(g,u,l),d.head.appendChild(g);break;case"meta":if(A=f0("meta","content",d).get(u+(l.content||""))){for(R=0;R<A.length;R++)if(g=A[R],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){A.splice(R,1);break t}}g=d.createElement(u),Wn(g,u,l),d.head.appendChild(g);break;default:throw Error(i(468,u))}g[bn]=n,it(g),u=g}n.stateNode=u}else d0(d,n.type,n.stateNode);else n.stateNode=u0(d,u,n.memoizedProps);else g!==u?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,u===null?d0(d,n.type,n.stateNode):u0(d,u,n.memoizedProps)):u===null&&n.stateNode!==null&&Lu(n,n.memoizedProps,l.memoizedProps)}break;case 27:Ia(s,n),La(n),u&512&&(Tn||l===null||wr(l,l.return)),l!==null&&u&4&&Lu(n,n.memoizedProps,l.memoizedProps);break;case 5:if(Ia(s,n),La(n),u&512&&(Tn||l===null||wr(l,l.return)),n.flags&32){d=n.stateNode;try{Xn(d,"")}catch(pe){Zt(n,n.return,pe)}}u&4&&n.stateNode!=null&&(d=n.memoizedProps,Lu(n,d,l!==null?l.memoizedProps:d)),u&1024&&(Fu=!0);break;case 6:if(Ia(s,n),La(n),u&4){if(n.stateNode===null)throw Error(i(162));u=n.memoizedProps,l=n.stateNode;try{l.nodeValue=u}catch(pe){Zt(n,n.return,pe)}}break;case 3:if(Jo=null,d=or,or=Wo(s.containerInfo),Ia(s,n),or=d,La(n),u&4&&l!==null&&l.memoizedState.isDehydrated)try{Fl(s.containerInfo)}catch(pe){Zt(n,n.return,pe)}Fu&&(Fu=!1,vh(n));break;case 4:u=or,or=Wo(n.stateNode.containerInfo),Ia(s,n),La(n),or=u;break;case 12:Ia(s,n),La(n);break;case 13:Ia(s,n),La(n),n.child.flags&8192&&n.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(qu=Re()),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,ju(n,u)));break;case 22:d=n.memoizedState!==null;var V=l!==null&&l.memoizedState!==null,fe=Xr,Se=Tn;if(Xr=fe||d,Tn=Se||V,Ia(s,n),Tn=Se,Xr=fe,La(n),u&8192)e:for(s=n.stateNode,s._visibility=d?s._visibility&-2:s._visibility|1,d&&(l===null||V||Xr||Tn||ei(n)),l=null,s=n;;){if(s.tag===5||s.tag===26){if(l===null){V=l=s;try{if(g=V.stateNode,d)A=g.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{R=V.stateNode;var Te=V.memoizedProps.style,de=Te!=null&&Te.hasOwnProperty("display")?Te.display:null;R.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(pe){Zt(V,V.return,pe)}}}else if(s.tag===6){if(l===null){V=s;try{V.stateNode.nodeValue=d?"":V.memoizedProps}catch(pe){Zt(V,V.return,pe)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break e;for(;s.sibling===null;){if(s.return===null||s.return===n)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=n.updateQueue,u!==null&&(l=u.retryQueue,l!==null&&(u.retryQueue=null,ju(n,l))));break;case 19:Ia(s,n),La(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,ju(n,u)));break;case 30:break;case 21:break;default:Ia(s,n),La(n)}}function La(n){var s=n.flags;if(s&2){try{for(var l,u=n.return;u!==null;){if(uh(u)){l=u;break}u=u.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var d=l.stateNode,g=Uu(n);Fo(n,g,d);break;case 5:var A=l.stateNode;l.flags&32&&(Xn(A,""),l.flags&=-33);var R=Uu(n);Fo(n,R,A);break;case 3:case 4:var V=l.stateNode.containerInfo,fe=Uu(n);Bu(n,fe,V);break;default:throw Error(i(161))}}catch(Se){Zt(n,n.return,Se)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function vh(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;vh(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function ms(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ph(n,s.alternate,s),s=s.sibling}function ei(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:hs(4,s,s.return),ei(s);break;case 1:wr(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&oh(s,s.return,l),ei(s);break;case 27:kl(s.stateNode);case 26:case 5:wr(s,s.return),ei(s);break;case 22:s.memoizedState===null&&ei(s);break;case 30:ei(s);break;default:ei(s)}n=n.sibling}}function gs(n,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,d=n,g=s,A=g.flags;switch(g.tag){case 0:case 11:case 15:gs(d,g,l),xl(4,g);break;case 1:if(gs(d,g,l),u=g,d=u.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(fe){Zt(u,u.return,fe)}if(u=g,d=u.updateQueue,d!==null){var R=u.stateNode;try{var V=d.shared.hiddenCallbacks;if(V!==null)for(d.shared.hiddenCallbacks=null,d=0;d<V.length;d++)Xd(V[d],R)}catch(fe){Zt(u,u.return,fe)}}l&&A&64&&lh(g),Sl(g,g.return);break;case 27:fh(g);case 26:case 5:gs(d,g,l),l&&u===null&&A&4&&ch(g),Sl(g,g.return);break;case 12:gs(d,g,l);break;case 13:gs(d,g,l),l&&A&4&&gh(d,g);break;case 22:g.memoizedState===null&&gs(d,g,l),Sl(g,g.return);break;case 30:break;default:gs(d,g,l)}s=s.sibling}}function Pu(n,s){var l=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==l&&(n!=null&&n.refCount++,l!=null&&il(l))}function zu(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&il(n))}function Ar(n,s,l,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)bh(n,s,l,u),s=s.sibling}function bh(n,s,l,u){var d=s.flags;switch(s.tag){case 0:case 11:case 15:Ar(n,s,l,u),d&2048&&xl(9,s);break;case 1:Ar(n,s,l,u);break;case 3:Ar(n,s,l,u),d&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&il(n)));break;case 12:if(d&2048){Ar(n,s,l,u),n=s.stateNode;try{var g=s.memoizedProps,A=g.id,R=g.onPostCommit;typeof R=="function"&&R(A,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(V){Zt(s,s.return,V)}}else Ar(n,s,l,u);break;case 13:Ar(n,s,l,u);break;case 23:break;case 22:g=s.stateNode,A=s.alternate,s.memoizedState!==null?g._visibility&2?Ar(n,s,l,u):El(n,s):g._visibility&2?Ar(n,s,l,u):(g._visibility|=2,Ni(n,s,l,u,(s.subtreeFlags&10256)!==0)),d&2048&&Pu(A,s);break;case 24:Ar(n,s,l,u),d&2048&&zu(s.alternate,s);break;default:Ar(n,s,l,u)}}function Ni(n,s,l,u,d){for(d=d&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var g=n,A=s,R=l,V=u,fe=A.flags;switch(A.tag){case 0:case 11:case 15:Ni(g,A,R,V,d),xl(8,A);break;case 23:break;case 22:var Se=A.stateNode;A.memoizedState!==null?Se._visibility&2?Ni(g,A,R,V,d):El(g,A):(Se._visibility|=2,Ni(g,A,R,V,d)),d&&fe&2048&&Pu(A.alternate,A);break;case 24:Ni(g,A,R,V,d),d&&fe&2048&&zu(A.alternate,A);break;default:Ni(g,A,R,V,d)}s=s.sibling}}function El(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=n,u=s,d=u.flags;switch(u.tag){case 22:El(l,u),d&2048&&Pu(u.alternate,u);break;case 24:El(l,u),d&2048&&zu(u.alternate,u);break;default:El(l,u)}s=s.sibling}}var wl=8192;function Ri(n){if(n.subtreeFlags&wl)for(n=n.child;n!==null;)xh(n),n=n.sibling}function xh(n){switch(n.tag){case 26:Ri(n),n.flags&wl&&n.memoizedState!==null&&rv(or,n.memoizedState,n.memoizedProps);break;case 5:Ri(n);break;case 3:case 4:var s=or;or=Wo(n.stateNode.containerInfo),Ri(n),or=s;break;case 22:n.memoizedState===null&&(s=n.alternate,s!==null&&s.memoizedState!==null?(s=wl,wl=16777216,Ri(n),wl=s):Ri(n));break;default:Ri(n)}}function Sh(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function Al(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];Hn=u,wh(u,n)}Sh(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Eh(n),n=n.sibling}function Eh(n){switch(n.tag){case 0:case 11:case 15:Al(n),n.flags&2048&&hs(9,n,n.return);break;case 3:Al(n);break;case 12:Al(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,jo(n)):Al(n);break;default:Al(n)}}function jo(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var u=s[l];Hn=u,wh(u,n)}Sh(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:hs(8,s,s.return),jo(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,jo(s));break;default:jo(s)}n=n.sibling}}function wh(n,s){for(;Hn!==null;){var l=Hn;switch(l.tag){case 0:case 11:case 15:hs(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var u=l.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:il(l.memoizedState.cache)}if(u=l.child,u!==null)u.return=l,Hn=u;else e:for(l=n;Hn!==null;){u=Hn;var d=u.sibling,g=u.return;if(hh(u),u===l){Hn=null;break e}if(d!==null){d.return=g,Hn=d;break e}Hn=g}}}var xy={getCacheForType:function(n){var s=sa(Ln),l=s.data.get(n);return l===void 0&&(l=n(),s.data.set(n,l)),l}},Sy=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Kt=null,Mt=null,_t=0,jt=0,Ua=null,ys=!1,ki=!1,Gu=!1,Zr=0,yn=0,vs=0,ti=0,Hu=0,tr=0,Di=0,Tl=null,Aa=null,Yu=!1,qu=0,Po=1/0,zo=null,bs=null,Qn=0,xs=null,_i=null,Oi=0,Vu=0,Xu=null,Ah=null,Cl=0,$u=null;function Ba(){if((Ft&2)!==0&&_t!==0)return _t&-_t;if(F.T!==null){var n=xi;return n!==0?n:tf()}return oa()}function Th(){tr===0&&(tr=(_t&536870912)===0||Ut?ts():536870912);var n=er.current;return n!==null&&(n.flags|=32),tr}function Fa(n,s,l){(n===Kt&&(jt===2||jt===9)||n.cancelPendingCommit!==null)&&(Ii(n,0),Ss(n,_t,tr,!1)),Dr(n,l),((Ft&2)===0||n!==Kt)&&(n===Kt&&((Ft&2)===0&&(ti|=l),yn===4&&Ss(n,_t,tr,!1)),Tr(n))}function Ch(n,s,l){if((Ft&6)!==0)throw Error(i(327));var u=!l&&(s&124)===0&&(s&n.expiredLanes)===0||qe(n,s),d=u?Ay(n,s):Wu(n,s,!0),g=u;do{if(d===0){ki&&!u&&Ss(n,s,0,!1);break}else{if(l=n.current.alternate,g&&!Ey(l)){d=Wu(n,s,!1),g=!1;continue}if(d===2){if(g=s,n.errorRecoveryDisabledLanes&g)var A=0;else A=n.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){s=A;e:{var R=n;d=Tl;var V=R.current.memoizedState.isDehydrated;if(V&&(Ii(R,A).flags|=256),A=Wu(R,A,!1),A!==2){if(Gu&&!V){R.errorRecoveryDisabledLanes|=g,ti|=g,d=4;break e}g=Aa,Aa=d,g!==null&&(Aa===null?Aa=g:Aa.push.apply(Aa,g))}d=A}if(g=!1,d!==2)continue}}if(d===1){Ii(n,0),Ss(n,s,0,!0);break}e:{switch(u=n,g=d,g){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:Ss(u,s,tr,!ys);break e;case 2:Aa=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(d=qu+300-Re(),10<d)){if(Ss(u,s,tr,!ys),Jn(u,0,!0)!==0)break e;u.timeoutHandle=t0(Mh.bind(null,u,l,Aa,zo,Yu,s,tr,ti,Di,ys,g,2,-0,0),d);break e}Mh(u,l,Aa,zo,Yu,s,tr,ti,Di,ys,g,0,-0,0)}}break}while(!0);Tr(n)}function Mh(n,s,l,u,d,g,A,R,V,fe,Se,Te,de,pe){if(n.timeoutHandle=-1,Te=s.subtreeFlags,(Te&8192||(Te&16785408)===16785408)&&(Ol={stylesheets:null,count:0,unsuspend:av},xh(s),Te=sv(),Te!==null)){n.cancelPendingCommit=Te(Ih.bind(null,n,s,g,l,u,d,A,R,V,Se,1,de,pe)),Ss(n,g,A,!fe);return}Ih(n,s,g,l,u,d,A,R,V)}function Ey(n){for(var s=n;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var u=0;u<l.length;u++){var d=l[u],g=d.getSnapshot;d=d.value;try{if(!_a(g(),d))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ss(n,s,l,u){s&=~Hu,s&=~ti,n.suspendedLanes|=s,n.pingedLanes&=~s,u&&(n.warmLanes|=s),u=n.expirationTimes;for(var d=s;0<d;){var g=31-on(d),A=1<<g;u[g]=-1,d&=~A}l!==0&&ns(n,l,s)}function Go(){return(Ft&6)===0?(Ml(0),!1):!0}function Zu(){if(Mt!==null){if(jt===0)var n=Mt.return;else n=Mt,zr=Zs=null,du(n),Ci=null,yl=0,n=Mt;for(;n!==null;)ih(n.alternate,n),n=n.return;Mt=null}}function Ii(n,s){var l=n.timeoutHandle;l!==-1&&(n.timeoutHandle=-1,Py(l)),l=n.cancelPendingCommit,l!==null&&(n.cancelPendingCommit=null,l()),Zu(),Kt=n,Mt=l=Fr(n.current,null),_t=s,jt=0,Ua=null,ys=!1,ki=qe(n,s),Gu=!1,Di=tr=Hu=ti=vs=yn=0,Aa=Tl=null,Yu=!1,(s&8)!==0&&(s|=s&32);var u=n.entangledLanes;if(u!==0)for(n=n.entanglements,u&=s;0<u;){var d=31-on(u),g=1<<d;s|=n[d],u&=~g}return Zr=s,co(),l}function Nh(n,s){Et=null,F.H=Ro,s===ol||s===bo?(s=qd(),jt=3):s===Gd?(s=qd(),jt=4):jt=s===Vp?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ua=s,Mt===null&&(yn=1,Io(n,Qa(s,n.current)))}function Rh(){var n=F.H;return F.H=Ro,n===null?Ro:n}function kh(){var n=F.A;return F.A=xy,n}function Qu(){yn=4,ys||(_t&4194048)!==_t&&er.current!==null||(ki=!0),(vs&134217727)===0&&(ti&134217727)===0||Kt===null||Ss(Kt,_t,tr,!1)}function Wu(n,s,l){var u=Ft;Ft|=2;var d=Rh(),g=kh();(Kt!==n||_t!==s)&&(zo=null,Ii(n,s)),s=!1;var A=yn;e:do try{if(jt!==0&&Mt!==null){var R=Mt,V=Ua;switch(jt){case 8:Zu(),A=6;break e;case 3:case 2:case 9:case 6:er.current===null&&(s=!0);var fe=jt;if(jt=0,Ua=null,Li(n,R,V,fe),l&&ki){A=0;break e}break;default:fe=jt,jt=0,Ua=null,Li(n,R,V,fe)}}wy(),A=yn;break}catch(Se){Nh(n,Se)}while(!0);return s&&n.shellSuspendCounter++,zr=Zs=null,Ft=u,F.H=d,F.A=g,Mt===null&&(Kt=null,_t=0,co()),A}function wy(){for(;Mt!==null;)Dh(Mt)}function Ay(n,s){var l=Ft;Ft|=2;var u=Rh(),d=kh();Kt!==n||_t!==s?(zo=null,Po=Re()+500,Ii(n,s)):ki=qe(n,s);e:do try{if(jt!==0&&Mt!==null){s=Mt;var g=Ua;t:switch(jt){case 1:jt=0,Ua=null,Li(n,s,g,1);break;case 2:case 9:if(Hd(g)){jt=0,Ua=null,_h(s);break}s=function(){jt!==2&&jt!==9||Kt!==n||(jt=7),Tr(n)},g.then(s,s);break e;case 3:jt=7;break e;case 4:jt=5;break e;case 7:Hd(g)?(jt=0,Ua=null,_h(s)):(jt=0,Ua=null,Li(n,s,g,7));break;case 5:var A=null;switch(Mt.tag){case 26:A=Mt.memoizedState;case 5:case 27:var R=Mt;if(!A||p0(A)){jt=0,Ua=null;var V=R.sibling;if(V!==null)Mt=V;else{var fe=R.return;fe!==null?(Mt=fe,Ho(fe)):Mt=null}break t}}jt=0,Ua=null,Li(n,s,g,5);break;case 6:jt=0,Ua=null,Li(n,s,g,6);break;case 8:Zu(),yn=6;break e;default:throw Error(i(462))}}Ty();break}catch(Se){Nh(n,Se)}while(!0);return zr=Zs=null,F.H=u,F.A=d,Ft=l,Mt!==null?0:(Kt=null,_t=0,co(),yn)}function Ty(){for(;Mt!==null&&!Ie();)Dh(Mt)}function Dh(n){var s=rh(n.alternate,n,Zr);n.memoizedProps=n.pendingProps,s===null?Ho(n):Mt=s}function _h(n){var s=n,l=s.alternate;switch(s.tag){case 15:case 0:s=Kp(l,s,s.pendingProps,s.type,void 0,_t);break;case 11:s=Kp(l,s,s.pendingProps,s.type.render,s.ref,_t);break;case 5:du(s);default:ih(l,s),s=Mt=Od(s,Zr),s=rh(l,s,Zr)}n.memoizedProps=n.pendingProps,s===null?Ho(n):Mt=s}function Li(n,s,l,u){zr=Zs=null,du(s),Ci=null,yl=0;var d=s.return;try{if(hy(n,d,s,l,_t)){yn=1,Io(n,Qa(l,n.current)),Mt=null;return}}catch(g){if(d!==null)throw Mt=d,g;yn=1,Io(n,Qa(l,n.current)),Mt=null;return}s.flags&32768?(Ut||u===1?n=!0:ki||(_t&536870912)!==0?n=!1:(ys=n=!0,(u===2||u===9||u===3||u===6)&&(u=er.current,u!==null&&u.tag===13&&(u.flags|=16384))),Oh(s,n)):Ho(s)}function Ho(n){var s=n;do{if((s.flags&32768)!==0){Oh(s,ys);return}n=s.return;var l=gy(s.alternate,s,Zr);if(l!==null){Mt=l;return}if(s=s.sibling,s!==null){Mt=s;return}Mt=s=n}while(s!==null);yn===0&&(yn=5)}function Oh(n,s){do{var l=yy(n.alternate,n);if(l!==null){l.flags&=32767,Mt=l;return}if(l=n.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(n=n.sibling,n!==null)){Mt=n;return}Mt=n=l}while(n!==null);yn=6,Mt=null}function Ih(n,s,l,u,d,g,A,R,V){n.cancelPendingCommit=null;do Yo();while(Qn!==0);if((Ft&6)!==0)throw Error(i(327));if(s!==null){if(s===n.current)throw Error(i(177));if(g=s.lanes|s.childLanes,g|=zc,gr(n,l,g,A,R,V),n===Kt&&(Mt=Kt=null,_t=0),_i=s,xs=n,Oi=l,Vu=g,Xu=d,Ah=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,Ry(le,function(){return jh(),null})):(n.callbackNode=null,n.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=F.T,F.T=null,d=z.p,z.p=2,A=Ft,Ft|=4;try{vy(n,s,l)}finally{Ft=A,z.p=d,F.T=u}}Qn=1,Lh(),Uh(),Bh()}}function Lh(){if(Qn===1){Qn=0;var n=xs,s=_i,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=F.T,F.T=null;var u=z.p;z.p=2;var d=Ft;Ft|=4;try{yh(s,n);var g=uf,A=wd(n.containerInfo),R=g.focusedElem,V=g.selectionRange;if(A!==R&&R&&R.ownerDocument&&Ed(R.ownerDocument.documentElement,R)){if(V!==null&&Uc(R)){var fe=V.start,Se=V.end;if(Se===void 0&&(Se=fe),"selectionStart"in R)R.selectionStart=fe,R.selectionEnd=Math.min(Se,R.value.length);else{var Te=R.ownerDocument||document,de=Te&&Te.defaultView||window;if(de.getSelection){var pe=de.getSelection(),ft=R.textContent.length,lt=Math.min(V.start,ft),Ht=V.end===void 0?lt:Math.min(V.end,ft);!pe.extend&&lt>Ht&&(A=Ht,Ht=lt,lt=A);var se=Sd(R,lt),ae=Sd(R,Ht);if(se&&ae&&(pe.rangeCount!==1||pe.anchorNode!==se.node||pe.anchorOffset!==se.offset||pe.focusNode!==ae.node||pe.focusOffset!==ae.offset)){var ce=Te.createRange();ce.setStart(se.node,se.offset),pe.removeAllRanges(),lt>Ht?(pe.addRange(ce),pe.extend(ae.node,ae.offset)):(ce.setEnd(ae.node,ae.offset),pe.addRange(ce))}}}}for(Te=[],pe=R;pe=pe.parentNode;)pe.nodeType===1&&Te.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<Te.length;R++){var we=Te[R];we.element.scrollLeft=we.left,we.element.scrollTop=we.top}}nc=!!cf,uf=cf=null}finally{Ft=d,z.p=u,F.T=l}}n.current=s,Qn=2}}function Uh(){if(Qn===2){Qn=0;var n=xs,s=_i,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=F.T,F.T=null;var u=z.p;z.p=2;var d=Ft;Ft|=4;try{ph(n,s.alternate,s)}finally{Ft=d,z.p=u,F.T=l}}Qn=3}}function Bh(){if(Qn===4||Qn===3){Qn=0,rt();var n=xs,s=_i,l=Oi,u=Ah;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Qn=5:(Qn=0,_i=xs=null,Fh(n,n.pendingLanes));var d=n.pendingLanes;if(d===0&&(bs=null),Ma(l),s=s.stateNode,At&&typeof At.onCommitFiberRoot=="function")try{At.onCommitFiberRoot(Ye,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=F.T,d=z.p,z.p=2,F.T=null;try{for(var g=n.onRecoverableError,A=0;A<u.length;A++){var R=u[A];g(R.value,{componentStack:R.stack})}}finally{F.T=s,z.p=d}}(Oi&3)!==0&&Yo(),Tr(n),d=n.pendingLanes,(l&4194090)!==0&&(d&42)!==0?n===$u?Cl++:(Cl=0,$u=n):Cl=0,Ml(0)}}function Fh(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,il(s)))}function Yo(n){return Lh(),Uh(),Bh(),jh()}function jh(){if(Qn!==5)return!1;var n=xs,s=Vu;Vu=0;var l=Ma(Oi),u=F.T,d=z.p;try{z.p=32>l?32:l,F.T=null,l=Xu,Xu=null;var g=xs,A=Oi;if(Qn=0,_i=xs=null,Oi=0,(Ft&6)!==0)throw Error(i(331));var R=Ft;if(Ft|=4,Eh(g.current),bh(g,g.current,A,l),Ft=R,Ml(0,!1),At&&typeof At.onPostCommitFiberRoot=="function")try{At.onPostCommitFiberRoot(Ye,g)}catch{}return!0}finally{z.p=d,F.T=u,Fh(n,s)}}function Ph(n,s,l){s=Qa(l,s),s=Cu(n.stateNode,s,2),n=us(n,s,2),n!==null&&(Dr(n,2),Tr(n))}function Zt(n,s,l){if(n.tag===3)Ph(n,n,l);else for(;s!==null;){if(s.tag===3){Ph(s,n,l);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(bs===null||!bs.has(u))){n=Qa(l,n),l=Yp(2),u=us(s,l,2),u!==null&&(qp(l,u,s,n),Dr(u,2),Tr(u));break}}s=s.return}}function Ku(n,s,l){var u=n.pingCache;if(u===null){u=n.pingCache=new Sy;var d=new Set;u.set(s,d)}else d=u.get(s),d===void 0&&(d=new Set,u.set(s,d));d.has(l)||(Gu=!0,d.add(l),n=Cy.bind(null,n,s,l),s.then(n,n))}function Cy(n,s,l){var u=n.pingCache;u!==null&&u.delete(s),n.pingedLanes|=n.suspendedLanes&l,n.warmLanes&=~l,Kt===n&&(_t&l)===l&&(yn===4||yn===3&&(_t&62914560)===_t&&300>Re()-qu?(Ft&2)===0&&Ii(n,0):Hu|=l,Di===_t&&(Di=0)),Tr(n)}function zh(n,s){s===0&&(s=Ga()),n=gi(n,s),n!==null&&(Dr(n,s),Tr(n))}function My(n){var s=n.memoizedState,l=0;s!==null&&(l=s.retryLane),zh(n,l)}function Ny(n,s){var l=0;switch(n.tag){case 13:var u=n.stateNode,d=n.memoizedState;d!==null&&(l=d.retryLane);break;case 19:u=n.stateNode;break;case 22:u=n.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(s),zh(n,l)}function Ry(n,s){return xt(n,s)}var qo=null,Ui=null,Ju=!1,Vo=!1,ef=!1,ni=0;function Tr(n){n!==Ui&&n.next===null&&(Ui===null?qo=Ui=n:Ui=Ui.next=n),Vo=!0,Ju||(Ju=!0,Dy())}function Ml(n,s){if(!ef&&Vo){ef=!0;do for(var l=!1,u=qo;u!==null;){if(n!==0){var d=u.pendingLanes;if(d===0)var g=0;else{var A=u.suspendedLanes,R=u.pingedLanes;g=(1<<31-on(42|n)+1)-1,g&=d&~(A&~R),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,qh(u,g))}else g=_t,g=Jn(u,u===Kt?g:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(g&3)===0||qe(u,g)||(l=!0,qh(u,g));u=u.next}while(l);ef=!1}}function ky(){Gh()}function Gh(){Vo=Ju=!1;var n=0;ni!==0&&(jy()&&(n=ni),ni=0);for(var s=Re(),l=null,u=qo;u!==null;){var d=u.next,g=Hh(u,s);g===0?(u.next=null,l===null?qo=d:l.next=d,d===null&&(Ui=l)):(l=u,(n!==0||(g&3)!==0)&&(Vo=!0)),u=d}Ml(n)}function Hh(n,s){for(var l=n.suspendedLanes,u=n.pingedLanes,d=n.expirationTimes,g=n.pendingLanes&-62914561;0<g;){var A=31-on(g),R=1<<A,V=d[A];V===-1?((R&l)===0||(R&u)!==0)&&(d[A]=gt(R,s)):V<=s&&(n.expiredLanes|=R),g&=~R}if(s=Kt,l=_t,l=Jn(n,n===s?l:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u=n.callbackNode,l===0||n===s&&(jt===2||jt===9)||n.cancelPendingCommit!==null)return u!==null&&u!==null&&tn(u),n.callbackNode=null,n.callbackPriority=0;if((l&3)===0||qe(n,l)){if(s=l&-l,s===n.callbackPriority)return s;switch(u!==null&&tn(u),Ma(l)){case 2:case 8:l=Ue;break;case 32:l=le;break;case 268435456:l=It;break;default:l=le}return u=Yh.bind(null,n),l=xt(l,u),n.callbackPriority=s,n.callbackNode=l,s}return u!==null&&u!==null&&tn(u),n.callbackPriority=2,n.callbackNode=null,2}function Yh(n,s){if(Qn!==0&&Qn!==5)return n.callbackNode=null,n.callbackPriority=0,null;var l=n.callbackNode;if(Yo()&&n.callbackNode!==l)return null;var u=_t;return u=Jn(n,n===Kt?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u===0?null:(Ch(n,u,s),Hh(n,Re()),n.callbackNode!=null&&n.callbackNode===l?Yh.bind(null,n):null)}function qh(n,s){if(Yo())return null;Ch(n,s,!0)}function Dy(){zy(function(){(Ft&6)!==0?xt(nn,ky):Gh()})}function tf(){return ni===0&&(ni=ts()),ni}function Vh(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Us(""+n)}function Xh(n,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,n.id&&l.setAttribute("form",n.id),s.parentNode.insertBefore(l,s),n=new FormData(n),l.parentNode.removeChild(l),n}function _y(n,s,l,u,d){if(s==="submit"&&l&&l.stateNode===d){var g=Vh((d[xn]||null).action),A=u.submitter;A&&(s=(s=A[xn]||null)?Vh(s.formAction):A.getAttribute("formAction"),s!==null&&(g=s,A=null));var R=new ui("action","action",null,u,d);n.push({event:R,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(ni!==0){var V=A?Xh(d,A):new FormData(d);Su(l,{pending:!0,data:V,method:d.method,action:g},null,V)}}else typeof g=="function"&&(R.preventDefault(),V=A?Xh(d,A):new FormData(d),Su(l,{pending:!0,data:V,method:d.method,action:g},g,V))},currentTarget:d}]})}}for(var nf=0;nf<Pc.length;nf++){var af=Pc[nf],Oy=af.toLowerCase(),Iy=af[0].toUpperCase()+af.slice(1);lr(Oy,"on"+Iy)}lr(Cd,"onAnimationEnd"),lr(Md,"onAnimationIteration"),lr(Nd,"onAnimationStart"),lr("dblclick","onDoubleClick"),lr("focusin","onFocus"),lr("focusout","onBlur"),lr(Wg,"onTransitionRun"),lr(Kg,"onTransitionStart"),lr(Jg,"onTransitionCancel"),lr(Rd,"onTransitionEnd"),Va("onMouseEnter",["mouseout","mouseover"]),Va("onMouseLeave",["mouseout","mouseover"]),Va("onPointerEnter",["pointerout","pointerover"]),Va("onPointerLeave",["pointerout","pointerover"]),Nn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Nn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Nn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Nn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ly=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Nl));function $h(n,s){s=(s&4)!==0;for(var l=0;l<n.length;l++){var u=n[l],d=u.event;u=u.listeners;e:{var g=void 0;if(s)for(var A=u.length-1;0<=A;A--){var R=u[A],V=R.instance,fe=R.currentTarget;if(R=R.listener,V!==g&&d.isPropagationStopped())break e;g=R,d.currentTarget=fe;try{g(d)}catch(Se){Oo(Se)}d.currentTarget=null,g=V}else for(A=0;A<u.length;A++){if(R=u[A],V=R.instance,fe=R.currentTarget,R=R.listener,V!==g&&d.isPropagationStopped())break e;g=R,d.currentTarget=fe;try{g(d)}catch(Se){Oo(Se)}d.currentTarget=null,g=V}}}}function Nt(n,s){var l=s[dn];l===void 0&&(l=s[dn]=new Set);var u=n+"__bubble";l.has(u)||(Zh(s,n,2,!1),l.add(u))}function rf(n,s,l){var u=0;s&&(u|=4),Zh(l,n,u,s)}var Xo="_reactListening"+Math.random().toString(36).slice(2);function sf(n){if(!n[Xo]){n[Xo]=!0,Na.forEach(function(l){l!=="selectionchange"&&(Ly.has(l)||rf(l,!1,n),rf(l,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[Xo]||(s[Xo]=!0,rf("selectionchange",!1,s))}}function Zh(n,s,l,u){switch(b0(s)){case 2:var d=ov;break;case 8:d=cv;break;default:d=xf}l=d.bind(null,s,l,n),d=void 0,!Ir||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(d=!0),u?d!==void 0?n.addEventListener(s,l,{capture:!0,passive:d}):n.addEventListener(s,l,!0):d!==void 0?n.addEventListener(s,l,{passive:d}):n.addEventListener(s,l,!1)}function lf(n,s,l,u,d){var g=u;if((s&1)===0&&(s&2)===0&&u!==null)e:for(;;){if(u===null)return;var A=u.tag;if(A===3||A===4){var R=u.stateNode.containerInfo;if(R===d)break;if(A===4)for(A=u.return;A!==null;){var V=A.tag;if((V===3||V===4)&&A.stateNode.containerInfo===d)return;A=A.return}for(;R!==null;){if(A=ga(R),A===null)return;if(V=A.tag,V===5||V===6||V===26||V===27){u=g=A;continue e}R=R.parentNode}}u=u.return}so(function(){var fe=g,Se=mn(l),Te=[];e:{var de=kd.get(n);if(de!==void 0){var pe=ui,ft=n;switch(n){case"keypress":if(ci(l)===0)break e;case"keydown":case"keyup":pe=Pe;break;case"focusin":ft="focus",pe=Ji;break;case"focusout":ft="blur",pe=Ji;break;case"beforeblur":case"afterblur":pe=Ji;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=aa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=oo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=Be;break;case Cd:case Md:case Nd:pe=_c;break;case Rd:pe=Xe;break;case"scroll":case"scrollend":pe=kc;break;case"wheel":pe=Je;break;case"copy":case"cut":case"paste":pe=Ic;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=Ee;break;case"toggle":case"beforetoggle":pe=$e}var lt=(s&4)!==0,Ht=!lt&&(n==="scroll"||n==="scrollend"),se=lt?de!==null?de+"Capture":null:de;lt=[];for(var ae=fe,ce;ae!==null;){var we=ae;if(ce=we.stateNode,we=we.tag,we!==5&&we!==26&&we!==27||ce===null||se===null||(we=$a(ae,se),we!=null&&lt.push(Rl(ae,we,ce))),Ht)break;ae=ae.return}0<lt.length&&(de=new pe(de,ft,null,l,Se),Te.push({event:de,listeners:lt}))}}if((s&7)===0){e:{if(de=n==="mouseover"||n==="pointerover",pe=n==="mouseout"||n==="pointerout",de&&l!==oi&&(ft=l.relatedTarget||l.fromElement)&&(ga(ft)||ft[_n]))break e;if((pe||de)&&(de=Se.window===Se?Se:(de=Se.ownerDocument)?de.defaultView||de.parentWindow:window,pe?(ft=l.relatedTarget||l.toElement,pe=fe,ft=ft?ga(ft):null,ft!==null&&(Ht=c(ft),lt=ft.tag,ft!==Ht||lt!==5&&lt!==27&&lt!==6)&&(ft=null)):(pe=null,ft=fe),pe!==ft)){if(lt=aa,we="onMouseLeave",se="onMouseEnter",ae="mouse",(n==="pointerout"||n==="pointerover")&&(lt=Ee,we="onPointerLeave",se="onPointerEnter",ae="pointer"),Ht=pe==null?de:ca(pe),ce=ft==null?de:ca(ft),de=new lt(we,ae+"leave",pe,l,Se),de.target=Ht,de.relatedTarget=ce,we=null,ga(Se)===fe&&(lt=new lt(se,ae+"enter",ft,l,Se),lt.target=ce,lt.relatedTarget=Ht,we=lt),Ht=we,pe&&ft)t:{for(lt=pe,se=ft,ae=0,ce=lt;ce;ce=Bi(ce))ae++;for(ce=0,we=se;we;we=Bi(we))ce++;for(;0<ae-ce;)lt=Bi(lt),ae--;for(;0<ce-ae;)se=Bi(se),ce--;for(;ae--;){if(lt===se||se!==null&&lt===se.alternate)break t;lt=Bi(lt),se=Bi(se)}lt=null}else lt=null;pe!==null&&Qh(Te,de,pe,lt,!1),ft!==null&&Ht!==null&&Qh(Te,Ht,ft,lt,!0)}}e:{if(de=fe?ca(fe):window,pe=de.nodeName&&de.nodeName.toLowerCase(),pe==="select"||pe==="input"&&de.type==="file")var Ze=wn;else if(Qt(de))if(yt)Ze=ir;else{Ze=zs;var Ct=sr}else pe=de.nodeName,!pe||pe.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?fe&&ka(fe.elementType)&&(Ze=wn):Ze=Lc;if(Ze&&(Ze=Ze(n,fe))){kt(Te,Ze,l,Se);break e}Ct&&Ct(n,de,fe),n==="focusout"&&fe&&de.type==="number"&&fe.memoizedProps.value!=null&&ya(de,"number",de.value)}switch(Ct=fe?ca(fe):window,n){case"focusin":(Qt(Ct)||Ct.contentEditable==="true")&&(pi=Ct,Bc=fe,tl=null);break;case"focusout":tl=Bc=pi=null;break;case"mousedown":Fc=!0;break;case"contextmenu":case"mouseup":case"dragend":Fc=!1,Ad(Te,l,Se);break;case"selectionchange":if(Qg)break;case"keydown":case"keyup":Ad(Te,l,Se)}var nt;if(ht)e:{switch(n){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else an?Ps(n,l)&&(ct="onCompositionEnd"):n==="keydown"&&l.keyCode===229&&(ct="onCompositionStart");ct&&(Vt&&l.locale!=="ko"&&(an||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&an&&(nt=is()):(va=Se,Lr="value"in va?va.value:va.textContent,an=!0)),Ct=$o(fe,ct),0<Ct.length&&(ct=new L(ct,n,null,l,Se),Te.push({event:ct,listeners:Ct}),nt?ct.data=nt:(nt=ra(l),nt!==null&&(ct.data=nt)))),(nt=Ot?$t(n,l):Bt(n,l))&&(ct=$o(fe,"onBeforeInput"),0<ct.length&&(Ct=new L("onBeforeInput","beforeinput",null,l,Se),Te.push({event:Ct,listeners:ct}),Ct.data=nt)),_y(Te,n,fe,l,Se)}$h(Te,s)})}function Rl(n,s,l){return{instance:n,listener:s,currentTarget:l}}function $o(n,s){for(var l=s+"Capture",u=[];n!==null;){var d=n,g=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||g===null||(d=$a(n,l),d!=null&&u.unshift(Rl(n,d,g)),d=$a(n,s),d!=null&&u.push(Rl(n,d,g))),n.tag===3)return u;n=n.return}return[]}function Bi(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Qh(n,s,l,u,d){for(var g=s._reactName,A=[];l!==null&&l!==u;){var R=l,V=R.alternate,fe=R.stateNode;if(R=R.tag,V!==null&&V===u)break;R!==5&&R!==26&&R!==27||fe===null||(V=fe,d?(fe=$a(l,g),fe!=null&&A.unshift(Rl(l,fe,V))):d||(fe=$a(l,g),fe!=null&&A.push(Rl(l,fe,V)))),l=l.return}A.length!==0&&n.push({event:s,listeners:A})}var Uy=/\r\n?/g,By=/\u0000|\uFFFD/g;function Wh(n){return(typeof n=="string"?n:""+n).replace(Uy,`
`).replace(By,"")}function Kh(n,s){return s=Wh(s),Wh(n)===s}function Zo(){}function Gt(n,s,l,u,d,g){switch(l){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||Xn(n,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&Xn(n,""+u);break;case"className":ne(n,"class",u);break;case"tabIndex":ne(n,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":ne(n,l,u);break;case"style":vr(n,u,g);break;case"data":if(s!=="object"){ne(n,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||l!=="href")){n.removeAttribute(l);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(l);break}u=Us(""+u),n.setAttribute(l,u);break;case"action":case"formAction":if(typeof u=="function"){n.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(s!=="input"&&Gt(n,s,"name",d.name,d,null),Gt(n,s,"formEncType",d.formEncType,d,null),Gt(n,s,"formMethod",d.formMethod,d,null),Gt(n,s,"formTarget",d.formTarget,d,null)):(Gt(n,s,"encType",d.encType,d,null),Gt(n,s,"method",d.method,d,null),Gt(n,s,"target",d.target,d,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(l);break}u=Us(""+u),n.setAttribute(l,u);break;case"onClick":u!=null&&(n.onclick=Zo);break;case"onScroll":u!=null&&Nt("scroll",n);break;case"onScrollEnd":u!=null&&Nt("scrollend",n);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(d.children!=null)throw Error(i(60));n.innerHTML=l}}break;case"multiple":n.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":n.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){n.removeAttribute("xlink:href");break}l=Us(""+u),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,""+u):n.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,""):n.removeAttribute(l);break;case"capture":case"download":u===!0?n.setAttribute(l,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(l,u):n.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?n.setAttribute(l,u):n.removeAttribute(l);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?n.removeAttribute(l):n.setAttribute(l,u);break;case"popover":Nt("beforetoggle",n),Nt("toggle",n),Q(n,"popover",u);break;case"xlinkActuate":ue(n,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":ue(n,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":ue(n,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":ue(n,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":ue(n,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":ue(n,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":ue(n,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":ue(n,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":ue(n,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":Q(n,"is",u);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=_r.get(l)||l,Q(n,l,u))}}function of(n,s,l,u,d,g){switch(l){case"style":vr(n,u,g);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(l=u.__html,l!=null){if(d.children!=null)throw Error(i(60));n.innerHTML=l}}break;case"children":typeof u=="string"?Xn(n,u):(typeof u=="number"||typeof u=="bigint")&&Xn(n,""+u);break;case"onScroll":u!=null&&Nt("scroll",n);break;case"onScrollEnd":u!=null&&Nt("scrollend",n);break;case"onClick":u!=null&&(n.onclick=Zo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vn.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(d=l.endsWith("Capture"),s=l.slice(2,d?l.length-7:void 0),g=n[xn]||null,g=g!=null?g[l]:null,typeof g=="function"&&n.removeEventListener(s,g,d),typeof u=="function")){typeof g!="function"&&g!==null&&(l in n?n[l]=null:n.hasAttribute(l)&&n.removeAttribute(l)),n.addEventListener(s,u,d);break e}l in n?n[l]=u:u===!0?n.setAttribute(l,""):Q(n,l,u)}}}function Wn(n,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Nt("error",n),Nt("load",n);var u=!1,d=!1,g;for(g in l)if(l.hasOwnProperty(g)){var A=l[g];if(A!=null)switch(g){case"src":u=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Gt(n,s,g,A,l,null)}}d&&Gt(n,s,"srcSet",l.srcSet,l,null),u&&Gt(n,s,"src",l.src,l,null);return;case"input":Nt("invalid",n);var R=g=A=d=null,V=null,fe=null;for(u in l)if(l.hasOwnProperty(u)){var Se=l[u];if(Se!=null)switch(u){case"name":d=Se;break;case"type":A=Se;break;case"checked":V=Se;break;case"defaultChecked":fe=Se;break;case"value":g=Se;break;case"defaultValue":R=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(i(137,s));break;default:Gt(n,s,u,Se,l,null)}}Ls(n,g,R,V,fe,A,d,!1),Xa(n);return;case"select":Nt("invalid",n),u=A=g=null;for(d in l)if(l.hasOwnProperty(d)&&(R=l[d],R!=null))switch(d){case"value":g=R;break;case"defaultValue":A=R;break;case"multiple":u=R;default:Gt(n,s,d,R,l,null)}s=g,l=A,n.multiple=!!u,s!=null?da(n,!!u,s,!1):l!=null&&da(n,!!u,l,!0);return;case"textarea":Nt("invalid",n),g=d=u=null;for(A in l)if(l.hasOwnProperty(A)&&(R=l[A],R!=null))switch(A){case"value":u=R;break;case"defaultValue":d=R;break;case"children":g=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(i(91));break;default:Gt(n,s,A,R,l,null)}ta(n,u,d,g),Xa(n);return;case"option":for(V in l)l.hasOwnProperty(V)&&(u=l[V],u!=null)&&(V==="selected"?n.selected=u&&typeof u!="function"&&typeof u!="symbol":Gt(n,s,V,u,l,null));return;case"dialog":Nt("beforetoggle",n),Nt("toggle",n),Nt("cancel",n),Nt("close",n);break;case"iframe":case"object":Nt("load",n);break;case"video":case"audio":for(u=0;u<Nl.length;u++)Nt(Nl[u],n);break;case"image":Nt("error",n),Nt("load",n);break;case"details":Nt("toggle",n);break;case"embed":case"source":case"link":Nt("error",n),Nt("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in l)if(l.hasOwnProperty(fe)&&(u=l[fe],u!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:Gt(n,s,fe,u,l,null)}return;default:if(ka(s)){for(Se in l)l.hasOwnProperty(Se)&&(u=l[Se],u!==void 0&&of(n,s,Se,u,l,void 0));return}}for(R in l)l.hasOwnProperty(R)&&(u=l[R],u!=null&&Gt(n,s,R,u,l,null))}function Fy(n,s,l,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,g=null,A=null,R=null,V=null,fe=null,Se=null;for(pe in l){var Te=l[pe];if(l.hasOwnProperty(pe)&&Te!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":V=Te;default:u.hasOwnProperty(pe)||Gt(n,s,pe,null,u,Te)}}for(var de in u){var pe=u[de];if(Te=l[de],u.hasOwnProperty(de)&&(pe!=null||Te!=null))switch(de){case"type":g=pe;break;case"name":d=pe;break;case"checked":fe=pe;break;case"defaultChecked":Se=pe;break;case"value":A=pe;break;case"defaultValue":R=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,s));break;default:pe!==Te&&Gt(n,s,de,pe,u,Te)}}fa(n,A,R,V,fe,Se,g,d);return;case"select":pe=A=R=de=null;for(g in l)if(V=l[g],l.hasOwnProperty(g)&&V!=null)switch(g){case"value":break;case"multiple":pe=V;default:u.hasOwnProperty(g)||Gt(n,s,g,null,u,V)}for(d in u)if(g=u[d],V=l[d],u.hasOwnProperty(d)&&(g!=null||V!=null))switch(d){case"value":de=g;break;case"defaultValue":R=g;break;case"multiple":A=g;default:g!==V&&Gt(n,s,d,g,u,V)}s=R,l=A,u=pe,de!=null?da(n,!!l,de,!1):!!u!=!!l&&(s!=null?da(n,!!l,s,!0):da(n,!!l,l?[]:"",!1));return;case"textarea":pe=de=null;for(R in l)if(d=l[R],l.hasOwnProperty(R)&&d!=null&&!u.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Gt(n,s,R,null,u,d)}for(A in u)if(d=u[A],g=l[A],u.hasOwnProperty(A)&&(d!=null||g!=null))switch(A){case"value":de=d;break;case"defaultValue":pe=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(i(91));break;default:d!==g&&Gt(n,s,A,d,u,g)}yr(n,de,pe);return;case"option":for(var ft in l)de=l[ft],l.hasOwnProperty(ft)&&de!=null&&!u.hasOwnProperty(ft)&&(ft==="selected"?n.selected=!1:Gt(n,s,ft,null,u,de));for(V in u)de=u[V],pe=l[V],u.hasOwnProperty(V)&&de!==pe&&(de!=null||pe!=null)&&(V==="selected"?n.selected=de&&typeof de!="function"&&typeof de!="symbol":Gt(n,s,V,de,u,pe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in l)de=l[lt],l.hasOwnProperty(lt)&&de!=null&&!u.hasOwnProperty(lt)&&Gt(n,s,lt,null,u,de);for(fe in u)if(de=u[fe],pe=l[fe],u.hasOwnProperty(fe)&&de!==pe&&(de!=null||pe!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,s));break;default:Gt(n,s,fe,de,u,pe)}return;default:if(ka(s)){for(var Ht in l)de=l[Ht],l.hasOwnProperty(Ht)&&de!==void 0&&!u.hasOwnProperty(Ht)&&of(n,s,Ht,void 0,u,de);for(Se in u)de=u[Se],pe=l[Se],!u.hasOwnProperty(Se)||de===pe||de===void 0&&pe===void 0||of(n,s,Se,de,u,pe);return}}for(var se in l)de=l[se],l.hasOwnProperty(se)&&de!=null&&!u.hasOwnProperty(se)&&Gt(n,s,se,null,u,de);for(Te in u)de=u[Te],pe=l[Te],!u.hasOwnProperty(Te)||de===pe||de==null&&pe==null||Gt(n,s,Te,de,u,pe)}var cf=null,uf=null;function Qo(n){return n.nodeType===9?n:n.ownerDocument}function Jh(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function e0(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function ff(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var df=null;function jy(){var n=window.event;return n&&n.type==="popstate"?n===df?!1:(df=n,!0):(df=null,!1)}var t0=typeof setTimeout=="function"?setTimeout:void 0,Py=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,zy=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(n){return n0.resolve(null).then(n).catch(Gy)}:t0;function Gy(n){setTimeout(function(){throw n})}function Es(n){return n==="head"}function a0(n,s){var l=s,u=0,d=0;do{var g=l.nextSibling;if(n.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"){if(0<u&&8>u){l=u;var A=n.ownerDocument;if(l&1&&kl(A.documentElement),l&2&&kl(A.body),l&4)for(l=A.head,kl(l),A=l.firstChild;A;){var R=A.nextSibling,V=A.nodeName;A[as]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&A.rel.toLowerCase()==="stylesheet"||l.removeChild(A),A=R}}if(d===0){n.removeChild(g),Fl(s);return}d--}else l==="$"||l==="$?"||l==="$!"?d++:u=l.charCodeAt(0)-48;else u=0;l=g}while(l);Fl(s)}function pf(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":pf(l),rs(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}n.removeChild(l)}}function Hy(n,s,l,u){for(;n.nodeType===1;){var d=l;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(u){if(!n[as])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(g=n.getAttribute("rel"),g==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(g!==d.rel||n.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||n.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||n.getAttribute("title")!==(d.title==null?null:d.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(g=n.getAttribute("src"),(g!==(d.src==null?null:d.src)||n.getAttribute("type")!==(d.type==null?null:d.type)||n.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&g&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var g=d.name==null?null:""+d.name;if(d.type==="hidden"&&n.getAttribute("name")===g)return n}else return n;if(n=cr(n.nextSibling),n===null)break}return null}function Yy(n,s,l){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!l||(n=cr(n.nextSibling),n===null))return null;return n}function hf(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function qy(n,s){var l=n.ownerDocument;if(n.data!=="$?"||l.readyState==="complete")s();else{var u=function(){s(),l.removeEventListener("DOMContentLoaded",u)};l.addEventListener("DOMContentLoaded",u),n._reactRetry=u}}function cr(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return n}var mf=null;function r0(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var l=n.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return n;s--}else l==="/$"&&s++}n=n.previousSibling}return null}function s0(n,s,l){switch(s=Qo(l),n){case"html":if(n=s.documentElement,!n)throw Error(i(452));return n;case"head":if(n=s.head,!n)throw Error(i(453));return n;case"body":if(n=s.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function kl(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);rs(n)}var nr=new Map,i0=new Set;function Wo(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Qr=z.d;z.d={f:Vy,r:Xy,D:$y,C:Zy,L:Qy,m:Wy,X:Jy,S:Ky,M:ev};function Vy(){var n=Qr.f(),s=Go();return n||s}function Xy(n){var s=pn(n);s!==null&&s.tag===5&&s.type==="form"?Cp(s):Qr.r(n)}var Fi=typeof document>"u"?null:document;function l0(n,s,l){var u=Fi;if(u&&typeof s=="string"&&s){var d=un(s);d='link[rel="'+n+'"][href="'+d+'"]',typeof l=="string"&&(d+='[crossorigin="'+l+'"]'),i0.has(d)||(i0.add(d),n={rel:n,crossOrigin:l,href:s},u.querySelector(d)===null&&(s=u.createElement("link"),Wn(s,"link",n),it(s),u.head.appendChild(s)))}}function $y(n){Qr.D(n),l0("dns-prefetch",n,null)}function Zy(n,s){Qr.C(n,s),l0("preconnect",n,s)}function Qy(n,s,l){Qr.L(n,s,l);var u=Fi;if(u&&n&&s){var d='link[rel="preload"][as="'+un(s)+'"]';s==="image"&&l&&l.imageSrcSet?(d+='[imagesrcset="'+un(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(d+='[imagesizes="'+un(l.imageSizes)+'"]')):d+='[href="'+un(n)+'"]';var g=d;switch(s){case"style":g=ji(n);break;case"script":g=Pi(n)}nr.has(g)||(n=v({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:n,as:s},l),nr.set(g,n),u.querySelector(d)!==null||s==="style"&&u.querySelector(Dl(g))||s==="script"&&u.querySelector(_l(g))||(s=u.createElement("link"),Wn(s,"link",n),it(s),u.head.appendChild(s)))}}function Wy(n,s){Qr.m(n,s);var l=Fi;if(l&&n){var u=s&&typeof s.as=="string"?s.as:"script",d='link[rel="modulepreload"][as="'+un(u)+'"][href="'+un(n)+'"]',g=d;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Pi(n)}if(!nr.has(g)&&(n=v({rel:"modulepreload",href:n},s),nr.set(g,n),l.querySelector(d)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(_l(g)))return}u=l.createElement("link"),Wn(u,"link",n),it(u),l.head.appendChild(u)}}}function Ky(n,s,l){Qr.S(n,s,l);var u=Fi;if(u&&n){var d=Pt(u).hoistableStyles,g=ji(n);s=s||"default";var A=d.get(g);if(!A){var R={loading:0,preload:null};if(A=u.querySelector(Dl(g)))R.loading=5;else{n=v({rel:"stylesheet",href:n,"data-precedence":s},l),(l=nr.get(g))&&gf(n,l);var V=A=u.createElement("link");it(V),Wn(V,"link",n),V._p=new Promise(function(fe,Se){V.onload=fe,V.onerror=Se}),V.addEventListener("load",function(){R.loading|=1}),V.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Ko(A,s,u)}A={type:"stylesheet",instance:A,count:1,state:R},d.set(g,A)}}}function Jy(n,s){Qr.X(n,s);var l=Fi;if(l&&n){var u=Pt(l).hoistableScripts,d=Pi(n),g=u.get(d);g||(g=l.querySelector(_l(d)),g||(n=v({src:n,async:!0},s),(s=nr.get(d))&&yf(n,s),g=l.createElement("script"),it(g),Wn(g,"link",n),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},u.set(d,g))}}function ev(n,s){Qr.M(n,s);var l=Fi;if(l&&n){var u=Pt(l).hoistableScripts,d=Pi(n),g=u.get(d);g||(g=l.querySelector(_l(d)),g||(n=v({src:n,async:!0,type:"module"},s),(s=nr.get(d))&&yf(n,s),g=l.createElement("script"),it(g),Wn(g,"link",n),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},u.set(d,g))}}function o0(n,s,l,u){var d=(d=Oe.current)?Wo(d):null;if(!d)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=ji(l.href),l=Pt(d).hoistableStyles,u=l.get(s),u||(u={type:"style",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){n=ji(l.href);var g=Pt(d).hoistableStyles,A=g.get(n);if(A||(d=d.ownerDocument||d,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(n,A),(g=d.querySelector(Dl(n)))&&!g._p&&(A.instance=g,A.state.loading=5),nr.has(n)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},nr.set(n,l),g||tv(d,n,l,A.state))),s&&u===null)throw Error(i(528,""));return A}if(s&&u!==null)throw Error(i(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Pi(l),l=Pt(d).hoistableScripts,u=l.get(s),u||(u={type:"script",instance:null,count:0,state:null},l.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function ji(n){return'href="'+un(n)+'"'}function Dl(n){return'link[rel="stylesheet"]['+n+"]"}function c0(n){return v({},n,{"data-precedence":n.precedence,precedence:null})}function tv(n,s,l,u){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=n.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),Wn(s,"link",l),it(s),n.head.appendChild(s))}function Pi(n){return'[src="'+un(n)+'"]'}function _l(n){return"script[async]"+n}function u0(n,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var u=n.querySelector('style[data-href~="'+un(l.href)+'"]');if(u)return s.instance=u,it(u),u;var d=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return u=(n.ownerDocument||n).createElement("style"),it(u),Wn(u,"style",d),Ko(u,l.precedence,n),s.instance=u;case"stylesheet":d=ji(l.href);var g=n.querySelector(Dl(d));if(g)return s.state.loading|=4,s.instance=g,it(g),g;u=c0(l),(d=nr.get(d))&&gf(u,d),g=(n.ownerDocument||n).createElement("link"),it(g);var A=g;return A._p=new Promise(function(R,V){A.onload=R,A.onerror=V}),Wn(g,"link",u),s.state.loading|=4,Ko(g,l.precedence,n),s.instance=g;case"script":return g=Pi(l.src),(d=n.querySelector(_l(g)))?(s.instance=d,it(d),d):(u=l,(d=nr.get(g))&&(u=v({},l),yf(u,d)),n=n.ownerDocument||n,d=n.createElement("script"),it(d),Wn(d,"link",u),n.head.appendChild(d),s.instance=d);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,Ko(u,l.precedence,n));return s.instance}function Ko(n,s,l){for(var u=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=u.length?u[u.length-1]:null,g=d,A=0;A<u.length;A++){var R=u[A];if(R.dataset.precedence===s)g=R;else if(g!==d)break}g?g.parentNode.insertBefore(n,g.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(n,s.firstChild))}function gf(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function yf(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var Jo=null;function f0(n,s,l){if(Jo===null){var u=new Map,d=Jo=new Map;d.set(l,u)}else d=Jo,u=d.get(l),u||(u=new Map,d.set(l,u));if(u.has(n))return u;for(u.set(n,null),l=l.getElementsByTagName(n),d=0;d<l.length;d++){var g=l[d];if(!(g[as]||g[bn]||n==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var A=g.getAttribute(s)||"";A=n+A;var R=u.get(A);R?R.push(g):u.set(A,[g])}}return u}function d0(n,s,l){n=n.ownerDocument||n,n.head.insertBefore(l,s==="title"?n.querySelector("head > title"):null)}function nv(n,s,l){if(l===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(n=s.disabled,typeof s.precedence=="string"&&n==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function p0(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var Ol=null;function av(){}function rv(n,s,l){if(Ol===null)throw Error(i(475));var u=Ol;if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var d=ji(l.href),g=n.querySelector(Dl(d));if(g){n=g._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(u.count++,u=ec.bind(u),n.then(u,u)),s.state.loading|=4,s.instance=g,it(g);return}g=n.ownerDocument||n,l=c0(l),(d=nr.get(d))&&gf(l,d),g=g.createElement("link"),it(g);var A=g;A._p=new Promise(function(R,V){A.onload=R,A.onerror=V}),Wn(g,"link",l),s.instance=g}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(u.count++,s=ec.bind(u),n.addEventListener("load",s),n.addEventListener("error",s))}}function sv(){if(Ol===null)throw Error(i(475));var n=Ol;return n.stylesheets&&n.count===0&&vf(n,n.stylesheets),0<n.count?function(s){var l=setTimeout(function(){if(n.stylesheets&&vf(n,n.stylesheets),n.unsuspend){var u=n.unsuspend;n.unsuspend=null,u()}},6e4);return n.unsuspend=s,function(){n.unsuspend=null,clearTimeout(l)}}:null}function ec(){if(this.count--,this.count===0){if(this.stylesheets)vf(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var tc=null;function vf(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,tc=new Map,s.forEach(iv,n),tc=null,ec.call(n))}function iv(n,s){if(!(s.state.loading&4)){var l=tc.get(n);if(l)var u=l.get(null);else{l=new Map,tc.set(n,l);for(var d=n.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<d.length;g++){var A=d[g];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(l.set(A.dataset.precedence,A),u=A)}u&&l.set(null,u)}d=s.instance,A=d.getAttribute("data-precedence"),g=l.get(A)||u,g===u&&l.set(null,d),l.set(A,d),this.count++,u=ec.bind(this),d.addEventListener("load",u),d.addEventListener("error",u),g?g.parentNode.insertBefore(d,g.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(d,n.firstChild)),s.state.loading|=4}}var Il={$$typeof:N,Provider:null,Consumer:null,_currentValue:ie,_currentValue2:ie,_threadCount:0};function lv(n,s,l,u,d,g,A,R){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pn(0),this.hiddenUpdates=Pn(null),this.identifierPrefix=u,this.onUncaughtError=d,this.onCaughtError=g,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function h0(n,s,l,u,d,g,A,R,V,fe,Se,Te){return n=new lv(n,s,l,A,R,V,fe,Te),s=1,g===!0&&(s|=24),g=Oa(3,null,null,s),n.current=g,g.stateNode=n,s=Kc(),s.refCount++,n.pooledCache=s,s.refCount++,g.memoizedState={element:u,isDehydrated:l,cache:s},nu(g),n}function m0(n){return n?(n=yi,n):yi}function g0(n,s,l,u,d,g){d=m0(d),u.context===null?u.context=d:u.pendingContext=d,u=cs(s),u.payload={element:l},g=g===void 0?null:g,g!==null&&(u.callback=g),l=us(n,u,s),l!==null&&(Fa(l,n,s),ul(l,n,s))}function y0(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var l=n.retryLane;n.retryLane=l!==0&&l<s?l:s}}function bf(n,s){y0(n,s),(n=n.alternate)&&y0(n,s)}function v0(n){if(n.tag===13){var s=gi(n,67108864);s!==null&&Fa(s,n,67108864),bf(n,67108864)}}var nc=!0;function ov(n,s,l,u){var d=F.T;F.T=null;var g=z.p;try{z.p=2,xf(n,s,l,u)}finally{z.p=g,F.T=d}}function cv(n,s,l,u){var d=F.T;F.T=null;var g=z.p;try{z.p=8,xf(n,s,l,u)}finally{z.p=g,F.T=d}}function xf(n,s,l,u){if(nc){var d=Sf(u);if(d===null)lf(n,s,u,ac,l),x0(n,u);else if(fv(d,n,s,l,u))u.stopPropagation();else if(x0(n,u),s&4&&-1<uv.indexOf(n)){for(;d!==null;){var g=pn(d);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var A=jn(g.pendingLanes);if(A!==0){var R=g;for(R.pendingLanes|=2,R.entangledLanes|=2;A;){var V=1<<31-on(A);R.entanglements[1]|=V,A&=~V}Tr(g),(Ft&6)===0&&(Po=Re()+500,Ml(0))}}break;case 13:R=gi(g,2),R!==null&&Fa(R,g,2),Go(),bf(g,2)}if(g=Sf(u),g===null&&lf(n,s,u,ac,l),g===d)break;d=g}d!==null&&u.stopPropagation()}else lf(n,s,u,null,l)}}function Sf(n){return n=mn(n),Ef(n)}var ac=null;function Ef(n){if(ac=null,n=ga(n),n!==null){var s=c(n);if(s===null)n=null;else{var l=s.tag;if(l===13){if(n=f(s),n!==null)return n;n=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return ac=n,null}function b0(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(wt()){case nn:return 2;case Ue:return 8;case le:case ln:return 32;case It:return 268435456;default:return 32}default:return 32}}var wf=!1,ws=null,As=null,Ts=null,Ll=new Map,Ul=new Map,Cs=[],uv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x0(n,s){switch(n){case"focusin":case"focusout":ws=null;break;case"dragenter":case"dragleave":As=null;break;case"mouseover":case"mouseout":Ts=null;break;case"pointerover":case"pointerout":Ll.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ul.delete(s.pointerId)}}function Bl(n,s,l,u,d,g){return n===null||n.nativeEvent!==g?(n={blockedOn:s,domEventName:l,eventSystemFlags:u,nativeEvent:g,targetContainers:[d]},s!==null&&(s=pn(s),s!==null&&v0(s)),n):(n.eventSystemFlags|=u,s=n.targetContainers,d!==null&&s.indexOf(d)===-1&&s.push(d),n)}function fv(n,s,l,u,d){switch(s){case"focusin":return ws=Bl(ws,n,s,l,u,d),!0;case"dragenter":return As=Bl(As,n,s,l,u,d),!0;case"mouseover":return Ts=Bl(Ts,n,s,l,u,d),!0;case"pointerover":var g=d.pointerId;return Ll.set(g,Bl(Ll.get(g)||null,n,s,l,u,d)),!0;case"gotpointercapture":return g=d.pointerId,Ul.set(g,Bl(Ul.get(g)||null,n,s,l,u,d)),!0}return!1}function S0(n){var s=ga(n.target);if(s!==null){var l=c(s);if(l!==null){if(s=l.tag,s===13){if(s=f(l),s!==null){n.blockedOn=s,Ya(n.priority,function(){if(l.tag===13){var u=Ba();u=Ca(u);var d=gi(l,u);d!==null&&Fa(d,l,u),bf(l,u)}});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){n.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}n.blockedOn=null}function rc(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var l=Sf(n.nativeEvent);if(l===null){l=n.nativeEvent;var u=new l.constructor(l.type,l);oi=u,l.target.dispatchEvent(u),oi=null}else return s=pn(l),s!==null&&v0(s),n.blockedOn=l,!1;s.shift()}return!0}function E0(n,s,l){rc(n)&&l.delete(s)}function dv(){wf=!1,ws!==null&&rc(ws)&&(ws=null),As!==null&&rc(As)&&(As=null),Ts!==null&&rc(Ts)&&(Ts=null),Ll.forEach(E0),Ul.forEach(E0)}function sc(n,s){n.blockedOn===s&&(n.blockedOn=null,wf||(wf=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,dv)))}var ic=null;function w0(n){ic!==n&&(ic=n,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){ic===n&&(ic=null);for(var s=0;s<n.length;s+=3){var l=n[s],u=n[s+1],d=n[s+2];if(typeof u!="function"){if(Ef(u||l)===null)continue;break}var g=pn(l);g!==null&&(n.splice(s,3),s-=3,Su(g,{pending:!0,data:d,method:l.method,action:u},u,d))}}))}function Fl(n){function s(V){return sc(V,n)}ws!==null&&sc(ws,n),As!==null&&sc(As,n),Ts!==null&&sc(Ts,n),Ll.forEach(s),Ul.forEach(s);for(var l=0;l<Cs.length;l++){var u=Cs[l];u.blockedOn===n&&(u.blockedOn=null)}for(;0<Cs.length&&(l=Cs[0],l.blockedOn===null);)S0(l),l.blockedOn===null&&Cs.shift();if(l=(n.ownerDocument||n).$$reactFormReplay,l!=null)for(u=0;u<l.length;u+=3){var d=l[u],g=l[u+1],A=d[xn]||null;if(typeof g=="function")A||w0(l);else if(A){var R=null;if(g&&g.hasAttribute("formAction")){if(d=g,A=g[xn]||null)R=A.formAction;else if(Ef(d)!==null)continue}else R=A.action;typeof R=="function"?l[u+1]=R:(l.splice(u,3),u-=3),w0(l)}}}function Af(n){this._internalRoot=n}lc.prototype.render=Af.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(i(409));var l=s.current,u=Ba();g0(l,u,n,s,null,null)},lc.prototype.unmount=Af.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;g0(n.current,2,null,n,null,null),Go(),s[_n]=null}};function lc(n){this._internalRoot=n}lc.prototype.unstable_scheduleHydration=function(n){if(n){var s=oa();n={blockedOn:null,target:n,priority:s};for(var l=0;l<Cs.length&&s!==0&&s<Cs[l].priority;l++);Cs.splice(l,0,n),l===0&&S0(n)}};var A0=e.version;if(A0!=="19.1.1")throw Error(i(527,A0,"19.1.1"));z.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=p(s),n=n!==null?y(n):null,n=n===null?null:n.stateNode,n};var pv={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oc.isDisabled&&oc.supportsFiber)try{Ye=oc.inject(pv),At=oc}catch{}}return Pl.createRoot=function(n,s){if(!o(n))throw Error(i(299));var l=!1,u="",d=Pp,g=zp,A=Gp,R=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(g=s.onCaughtError),s.onRecoverableError!==void 0&&(A=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(R=s.unstable_transitionCallbacks)),s=h0(n,1,!1,null,null,l,u,d,g,A,R,null),n[_n]=s.current,sf(n),new Af(s)},Pl.hydrateRoot=function(n,s,l){if(!o(n))throw Error(i(299));var u=!1,d="",g=Pp,A=zp,R=Gp,V=null,fe=null;return l!=null&&(l.unstable_strictMode===!0&&(u=!0),l.identifierPrefix!==void 0&&(d=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(A=l.onCaughtError),l.onRecoverableError!==void 0&&(R=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(V=l.unstable_transitionCallbacks),l.formState!==void 0&&(fe=l.formState)),s=h0(n,1,!0,s,l??null,u,d,g,A,R,V,fe),s.context=m0(null),l=s.current,u=Ba(),u=Ca(u),d=cs(u),d.callback=null,us(l,d,u),l=u,s.current.lanes=l,Dr(s,l),Tr(s),n[_n]=s.current,sf(n),new lc(s)},Pl.version="19.1.1",Pl}var I0;function Ev(){if(I0)return Mf.exports;I0=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Mf.exports=Sv(),Mf.exports}var wv=Ev();const Av=nd(wv),Tv="modulepreload",Cv=function(a,e){return new URL(a,e).href},L0={},U0=function(e,r,i){let o=Promise.resolve();if(r&&r.length>0){let y=function(v){return Promise.all(v.map(x=>Promise.resolve(x).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};const f=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");o=y(r.map(v=>{if(v=Cv(v,i),v in L0)return;L0[v]=!0;const x=v.endsWith(".css"),b=x?'[rel="stylesheet"]':"";if(i)for(let E=f.length-1;E>=0;E--){const C=f[E];if(C.href===v&&(!x||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${b}`))return;const S=document.createElement("link");if(S.rel=x?"stylesheet":Tv,x||(S.as="script"),S.crossOrigin="",S.href=v,p&&S.setAttribute("nonce",p),document.head.appendChild(S),x)return new Promise((E,C)=>{S.addEventListener("load",E),S.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${v}`)))})}))}function c(f){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=f,window.dispatchEvent(h),!h.defaultPrevented)throw f}return o.then(f=>{for(const h of f||[])h.status==="rejected"&&c(h.reason);return e().catch(c)})};class ur{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,r,i={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==ur.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof r!="function")throw new TypeError("The callback must be a function.");const o=new B0(e,this,r,i);return this.eventMap[e]||(this.eventMap[e]=[]),i.prepend?this.eventMap[e].unshift(o):this.eventMap[e].push(o),o}addOneTimeListener(e,r,i={}){i.remaining=1,this.addListener(e,r,i)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,r){return e===void 0?this.eventMap[ur.ANY_EVENT]&&this.eventMap[ur.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,i])=>i.length>0):this.eventMap[e]&&this.eventMap[e].length>0?r instanceof B0?this.eventMap[e].filter(o=>o===r).length>0:typeof r=="function"?this.eventMap[e].filter(o=>o.callback===r).length>0:r==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(r=>{r.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(r=>{r.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...r){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let i=[],o=this.eventMap[ur.ANY_EVENT]||[];return this.eventMap[e]&&(o=o.concat(this.eventMap[e])),o.forEach(c=>{if(c.suspended)return;let f=[...r];Array.isArray(c.arguments)&&(f=f.concat(c.arguments)),c.remaining>0&&(i.push(c.callback.apply(c.context,f)),c.count++),--c.remaining<1&&c.remove()}),i}removeListener(e,r,i={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let o=this.eventMap[e].filter(c=>r&&c.callback!==r||i.remaining&&i.remaining!==c.remaining||i.context&&i.context!==c.context);o.length?this.eventMap[e]=o:delete this.eventMap[e]}async waitFor(e,r={}){return r.duration=parseInt(r.duration),(isNaN(r.duration)||r.duration<=0)&&(r.duration=1/0),new Promise((i,o)=>{let c,f=this.addListener(e,()=>{clearTimeout(c),i()},{remaining:1});r.duration!==1/0&&(c=setTimeout(()=>{f.remove(),o("The duration expired before the event was emitted.")},r.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class B0{constructor(e,r,i,o={}){if(typeof e!="string"&&!(e instanceof String)&&e!==ur.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!r)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof i!="function")throw new TypeError("The 'callback' must be a function.");o.arguments!==void 0&&!Array.isArray(o.arguments)&&(o.arguments=[o.arguments]),o=Object.assign({context:r,remaining:1/0,arguments:void 0,duration:1/0},o),o.duration!==1/0&&setTimeout(()=>this.remove(),o.duration),this.arguments=o.arguments,this.callback=i,this.context=o.context,this.count=0,this.event=e,this.remaining=parseInt(o.remaining)>=1?parseInt(o.remaining):1/0,this.suspended=!1,this.target=r}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class Ae{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Ae.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Ae.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Ae.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Ae.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class Gi{constructor(e,r={}){this.duration=Ne.defaults.note.duration,this.attack=Ne.defaults.note.attack,this.release=Ne.defaults.note.release,r.duration!=null&&(this.duration=r.duration),r.attack!=null&&(this.attack=r.attack),r.rawAttack!=null&&(this.attack=je.from7bitToFloat(r.rawAttack)),r.release!=null&&(this.release=r.release),r.rawRelease!=null&&(this.release=je.from7bitToFloat(r.rawRelease)),Number.isInteger(e)?this.identifier=je.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const r=je.getNoteDetails(e);if(Ne.validation&&!e)throw new Error("Invalid note identifier");this._name=r.name,this._accidental=r.accidental,this._octave=r.octave}get name(){return this._name}set name(e){if(Ne.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(Ne.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(Ne.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(Ne.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(Ne.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(Ne.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return je.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=je.from7bitToFloat(e)}get rawRelease(){return je.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=je.from7bitToFloat(e)}get number(){return je.toNoteNumber(this.identifier)}getOffsetNumber(e=0,r=0){return Ne.validation&&(e=parseInt(e)||0,r=parseInt(r)||0),Math.min(Math.max(this.number+e*12+r,0),127)}}class je{static toNoteNumber(e,r=0){if(r=r==null?0:parseInt(r),isNaN(r))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const i=this.getNoteDetails(e);if(!i)throw new TypeError("Invalid note identifier");const o={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let c=(i.octave+1+r)*12;if(c+=o[i.name],i.accidental&&(i.accidental.startsWith("b")?c-=i.accidental.length:c+=i.accidental.length),c<0||c>127)throw new RangeError("Invalid octaveOffset value");return c}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const r=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!r)throw new TypeError("Invalid note identifier");const i=r[1].toUpperCase(),o=parseInt(r[3]);let c=r[2].toLowerCase();return c=c===""?void 0:c,{accidental:c,identifier:i+(c||"")+o,name:i,octave:o}}static sanitizeChannels(e){let r;if(Ne.validation){if(e==="all")r=["all"];else if(e==="none")return[]}return Array.isArray(e)?r=e:r=[e],r.indexOf("all")>-1&&(r=Ae.MIDI_CHANNEL_NUMBERS),r.map(function(i){return parseInt(i)}).filter(function(i){return i>=1&&i<=16})}static toTimestamp(e){let r=!1;const i=parseFloat(e);return isNaN(i)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?i>=0&&(r=Ne.time+i):i>=0&&(r=i),r)}static guessNoteNumber(e,r){r=parseInt(r)||0;let i=!1;if(Number.isInteger(e)&&e>=0&&e<=127)i=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)i=parseInt(e);else if(typeof e=="string"||e instanceof String)try{i=this.toNoteNumber(e.trim(),r)}catch{return!1}return i}static toNoteIdentifier(e,r){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(r=r==null?0:parseInt(r),isNaN(r))throw new RangeError("Invalid octaveOffset value");const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o=Math.floor(e/12-1)+r;return i[e%12]+o.toString()}static buildNote(e,r={}){if(r.octaveOffset=parseInt(r.octaveOffset)||0,e instanceof Gi)return e;let i=this.guessNoteNumber(e,r.octaveOffset);if(i===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return r.octaveOffset=void 0,new Gi(i,r)}static buildNoteArray(e,r={}){let i=[];return Array.isArray(e)||(e=[e]),e.forEach(o=>{i.push(this.buildNote(o,r))}),i}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,r=0){Ne.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),r=Math.min(Math.max(parseInt(r)||0,0),127));const i=((e<<7)+r)/16383;return Math.min(Math.max(i,0),1)}static fromFloatToMsbLsb(e){Ne.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const r=Math.round(e*16383);return{msb:r>>7,lsb:r&127}}static offsetNumber(e,r=0,i=0){if(Ne.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");r=parseInt(r)||0,i=parseInt(i)||0}return Math.min(Math.max(e+r*12+i,0),127)}static getPropertyByValue(e,r){return Object.keys(e).find(i=>e[i]===r)}static getCcNameByNumber(e){if(!(Ne.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return Ae.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let r=Ae.CONTROL_CHANGE_MESSAGES.find(i=>i.name===e);return r?r.number:Ae.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let r in Ae.CHANNEL_MODE_MESSAGES)if(Ae.CHANNEL_MODE_MESSAGES.hasOwnProperty(r)&&e===Ae.CHANNEL_MODE_MESSAGES[r])return r;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}class Mv extends ur{constructor(e,r){super(),this._output=e,this._number=r,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,r={time:0}){return this.output.send(e,r),this}sendKeyAftertouch(e,r,i={}){if(Ne.validation){if(i.useRawValue&&(i.rawValue=i.useRawValue),isNaN(parseFloat(r)))throw new RangeError("Invalid key aftertouch value.");if(i.rawValue){if(!(r>=0&&r<=127&&Number.isInteger(r)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(r>=0&&r<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}i.rawValue||(r=je.fromFloatTo7Bit(r));const o=Ne.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),je.buildNoteArray(e).forEach(c=>{this.send([(Ae.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),c.getOffsetNumber(o),r],{time:je.toTimestamp(i.time)})}),this}sendControlChange(e,r,i={}){if(typeof e=="string"&&(e=je.getCcNumberByName(e)),Array.isArray(r)||(r=[r]),Ne.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(r=r.map(o=>{const c=Math.min(Math.max(parseInt(o),0),127);if(isNaN(c))throw new TypeError("Values must be integers between 0 and 127");return c}),r.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return r.forEach((o,c)=>{this.send([(Ae.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+c*32,r[c]],{time:je.toTimestamp(i.time)})}),this}_selectNonRegisteredParameter(e,r={}){return this.sendControlChange(99,e[0],r),this.sendControlChange(98,e[1],r),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,r={}){return this.sendControlChange(101,e[0],r),this.sendControlChange(100,e[1],r),this}_setCurrentParameter(e,r={}){return e=[].concat(e),this.sendControlChange(6,e[0],r),e.length<2?this:(this.sendControlChange(38,e[1],r),this)}sendRpnDecrement(e,r={}){if(Array.isArray(e)||(e=Ae.REGISTERED_PARAMETERS[e]),Ne.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(Ae.REGISTERED_PARAMETERS).forEach(o=>{Ae.REGISTERED_PARAMETERS[o][0]===e[0]&&Ae.REGISTERED_PARAMETERS[o][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,r),this.sendControlChange(97,0,r),this._deselectRegisteredParameter(r),this}sendRpnIncrement(e,r={}){if(Array.isArray(e)||(e=Ae.REGISTERED_PARAMETERS[e]),Ne.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(Ae.REGISTERED_PARAMETERS).forEach(o=>{Ae.REGISTERED_PARAMETERS[o][0]===e[0]&&Ae.REGISTERED_PARAMETERS[o][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,r),this.sendControlChange(96,0,r),this._deselectRegisteredParameter(r),this}playNote(e,r={}){this.sendNoteOn(e,r);const i=Array.isArray(e)?e:[e];for(let o of i)if(parseInt(o.duration)>0){const c={time:(je.toTimestamp(r.time)||Ne.time)+parseInt(o.duration),release:o.release,rawRelease:o.rawRelease};this.sendNoteOff(o,c)}else if(parseInt(r.duration)>0){const c={time:(je.toTimestamp(r.time)||Ne.time)+parseInt(r.duration),release:r.release,rawRelease:r.rawRelease};this.sendNoteOff(o,c)}return this}sendNoteOff(e,r={}){if(Ne.validation){if(r.rawRelease!=null&&!(r.rawRelease>=0&&r.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(r.release!=null&&!(r.release>=0&&r.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");r.rawVelocity&&(r.rawRelease=r.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),r.velocity&&(r.release=r.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;r.rawRelease!=null?i=r.rawRelease:isNaN(r.release)||(i=Math.round(r.release*127));const o=Ne.octaveOffset+this.output.octaveOffset+this.octaveOffset;return je.buildNoteArray(e,{rawRelease:parseInt(i)}).forEach(c=>{this.send([(Ae.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),c.getOffsetNumber(o),c.rawRelease],{time:je.toTimestamp(r.time)})}),this}stopNote(e,r={}){return this.sendNoteOff(e,r)}sendNoteOn(e,r={}){if(Ne.validation){if(r.rawAttack!=null&&!(r.rawAttack>=0&&r.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(r.attack!=null&&!(r.attack>=0&&r.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");r.rawVelocity&&(r.rawAttack=r.velocity,r.rawRelease=r.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),r.velocity&&(r.attack=r.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;r.rawAttack!=null?i=r.rawAttack:isNaN(r.attack)||(i=Math.round(r.attack*127));const o=Ne.octaveOffset+this.output.octaveOffset+this.octaveOffset;return je.buildNoteArray(e,{rawAttack:i}).forEach(c=>{this.send([(Ae.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),c.getOffsetNumber(o),c.rawAttack],{time:je.toTimestamp(r.time)})}),this}sendChannelMode(e,r=0,i={}){if(typeof e=="string"&&(e=Ae.CHANNEL_MODE_MESSAGES[e]),Ne.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(r))||r<0||r>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Ae.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,r],{time:je.toTimestamp(i.time)}),this}sendOmniMode(e,r={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,r):this.sendChannelMode("omnimodeoff",0,r),this}sendChannelAftertouch(e,r={}){if(Ne.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(r.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return r.rawValue||(e=je.fromFloatTo7Bit(e)),this.send([(Ae.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:je.toTimestamp(r.time)}),this}sendMasterTuning(e,r={}){if(e=parseFloat(e)||0,Ne.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let i=Math.floor(e)+64,o=e-Math.floor(e);o=Math.round((o+1)/2*16383);let c=o>>7&127,f=o&127;return this.sendRpnValue("channelcoarsetuning",i,r),this.sendRpnValue("channelfinetuning",[c,f],r),this}sendModulationRange(e,r,i={}){if(Ne.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(r!=null&&(!Number.isInteger(r)||!(r>=0&&r<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return r>=0&&r<=127||(r=0),this.sendRpnValue("modulationrange",[e,r],i),this}sendNrpnValue(e,r,i={}){if(r=[].concat(r),Ne.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");r.forEach(o=>{if(!(o>=0&&o<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,i),this._setCurrentParameter(r,i),this._deselectNonRegisteredParameter(i),this}sendPitchBend(e,r={}){if(Ne.validation)if(r.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(r.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let i=0,o=0;if(r.rawValue&&Array.isArray(e))i=e[0],o=e[1];else if(r.rawValue&&!Array.isArray(e))i=e;else{const c=je.fromFloatToMsbLsb((e+1)/2);i=c.msb,o=c.lsb}return this.send([(Ae.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),o,i],{time:je.toTimestamp(r.time)}),this}sendPitchBendRange(e,r,i={}){if(Ne.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(r)||!(r>=0&&r<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,r],i),this}sendProgramChange(e,r={}){if(e=parseInt(e)||0,Ne.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Ae.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:je.toTimestamp(r.time)}),this}sendRpnValue(e,r,i={}){if(Array.isArray(e)||(e=Ae.REGISTERED_PARAMETERS[e]),Ne.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(r).forEach(o=>{if(!(o>=0&&o<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,i),this._setCurrentParameter(r,i),this._deselectRegisteredParameter(i),this}sendTuningBank(e,r={}){if(Ne.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,r),this}sendTuningProgram(e,r={}){if(Ne.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,r),this}sendLocalControl(e,r={}){return e?this.sendChannelMode("localcontrol",127,r):this.sendChannelMode("localcontrol",0,r)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,r={}){return e==="mono"?this.sendChannelMode("monomodeon",0,r):this.sendChannelMode("polymodeon",0,r)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class Hf extends ur{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let r=1;r<=16;r++)this.channels[r]=new Mv(this,r);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let r={timestamp:Ne.time};e.port.connection==="open"?(r.type="opened",r.target=this,r.port=r.target,this.emit("opened",r)):e.port.connection==="closed"&&e.port.state==="connected"?(r.type="closed",r.target=this,r.port=r.target,this.emit("closed",r)):e.port.connection==="closed"&&e.port.state==="disconnected"?(r.type="disconnected",r.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",r)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,r={time:0},i=0){if(e instanceof Fm&&(e=je.isNode?e.data:e.rawData),e instanceof Uint8Array&&je.isNode&&(e=Array.from(e)),Ne.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(r)&&(e=e.concat(r)),r=isNaN(i)?{time:0}:{time:i}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(o=>{if(o=parseInt(o),!(o>=0&&o<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),r||(r={time:0})}return this._midiOutput.send(e,je.toTimestamp(r.time)),this}sendSysex(e,r=[],i={}){if(e=[].concat(e),r instanceof Uint8Array){const o=new Uint8Array(1+e.length+r.length+1);o[0]=Ae.SYSTEM_MESSAGES.sysex,o.set(Uint8Array.from(e),1),o.set(r,1+e.length),o[o.length-1]=Ae.SYSTEM_MESSAGES.sysexend,this.send(o,{time:i.time})}else{const o=e.concat(r,Ae.SYSTEM_MESSAGES.sysexend);this.send([Ae.SYSTEM_MESSAGES.sysex].concat(o),{time:i.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():Ne.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,r={}){if(Ne.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Ae.SYSTEM_MESSAGES.timecode,e],{time:r.time}),this}sendSongPosition(e=0,r={}){e=Math.floor(e)||0;var i=e>>7&127,o=e&127;return this.send([Ae.SYSTEM_MESSAGES.songposition,i,o],{time:r.time}),this}sendSongSelect(e=0,r={}){if(Ne.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Ae.SYSTEM_MESSAGES.songselect,e],{time:r.time}),this}sendTuneRequest(e={}){return this.send([Ae.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Ae.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Ae.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Ae.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Ae.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Ae.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Ae.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return Ne.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,r,i={}){return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendKeyAftertouch(e,r,i)}),this}sendControlChange(e,r,i={},o={}){if(Ne.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const c=i;i=o,i.channels=c,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(c=>{this.channels[c].sendControlChange(e,r,i)}),this}sendPitchBendRange(e=0,r=0,i={}){return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendPitchBendRange(e,r,i)}),this}setPitchBendRange(e=0,r=0,i="all",o={}){return Ne.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,r,o)}sendRpnValue(e,r,i={}){return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendRpnValue(e,r,i)}),this}setRegisteredParameter(e,r=[],i="all",o={}){return Ne.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,r,o)}sendChannelAftertouch(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendChannelAftertouch(e,r)}),this}sendPitchBend(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendPitchBend(e,r)}),this}sendProgramChange(e=0,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendProgramChange(e,r)}),this}sendModulationRange(e,r,i={}){return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendModulationRange(e,r,i)}),this}setModulationRange(e=0,r=0,i="all",o={}){return Ne.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,r,o)}sendMasterTuning(e,r={}){return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendMasterTuning(e,r)}),this}setMasterTuning(e,r={},i={}){return Ne.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,i)}sendTuningProgram(e,r={}){return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendTuningProgram(e,r)}),this}setTuningProgram(e,r="all",i={}){return Ne.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,i)}sendTuningBank(e=0,r={}){return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendTuningBank(e,r)}),this}setTuningBank(e,r="all",i={}){return Ne.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,i)}sendChannelMode(e,r=0,i={},o={}){if(Ne.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const c=i;i=o,i.channels=c,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(c=>{this.channels[c].sendChannelMode(e,r,i)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(e.channels).forEach(r=>{this.channels[r].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(e.channels).forEach(r=>{this.channels[r].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},r={}){if(Ne.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const i=e;e=r,e.channels=i,e.channels==="all"&&(e.channels=Ae.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(e.channels).forEach(i=>{this.channels[i].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendPolyphonicMode(e,r)}),this}sendLocalControl(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendLocalControl(e,r)}),this}sendOmniMode(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendOmniMode(e,r)}),this}sendNrpnValue(e,r,i={}){return i.channels==null&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].sendNrpnValue(e,r,i)}),this}setNonRegisteredParameter(e,r=[],i="all",o={}){return Ne.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),o.channels=i,o.channels==="all"&&(o.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,r,o)}sendRpnIncrement(e,r={}){return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendRpnIncrement(e,r)}),this}incrementRegisteredParameter(e,r="all",i={}){return Ne.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,i)}sendRpnDecrement(e,r={}){return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(i=>{this.channels[i].sendRpnDecrement(e,r)}),this}decrementRegisteredParameter(e,r="all",i={}){return Ne.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),i.channels=r,i.channels==="all"&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,i)}sendNoteOff(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendNoteOff(e,r)}),this}stopNote(e,r){return this.sendNoteOff(e,r)}playNote(e,r={},i={}){if(Ne.validation&&(r.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),r.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].playNote(e,r)}),this}sendNoteOn(e,r={},i={}){if(Ne.validation&&(Array.isArray(r)||Number.isInteger(r)||r==="all")){const o=r;r=i,r.channels=o,r.channels==="all"&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS)}return r.channels==null&&(r.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(r.channels).forEach(o=>{this.channels[o].sendNoteOn(e,r)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class F0{constructor(e=[],r={}){this.destinations=[],this.types=[...Object.keys(Ae.SYSTEM_MESSAGES),...Object.keys(Ae.CHANNEL_MESSAGES)],this.channels=Ae.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),r.types&&!Array.isArray(r.types)&&(r.types=[r.types]),r.channels&&!Array.isArray(r.channels)&&(r.channels=[r.channels]),Ne.validation&&(e.forEach(i=>{if(!(i instanceof Hf))throw new TypeError("Destinations must be of type 'Output'.")}),r.types!==void 0&&r.types.forEach(i=>{if(!Ae.SYSTEM_MESSAGES.hasOwnProperty(i)&&!Ae.CHANNEL_MESSAGES.hasOwnProperty(i))throw new TypeError("Type must be a valid message type.")}),r.channels!==void 0&&r.channels.forEach(i=>{if(!Ae.MIDI_CHANNEL_NUMBERS.includes(i))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,r.types&&(this.types=r.types),r.channels&&(this.channels=r.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(r=>{Ne.validation&&!(r instanceof Hf)||r.send(e)}))}}class Nv extends ur{constructor(e,r){super(),this._input=e,this._number=r,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const r=Object.assign({},e);r.port=this.input,r.target=this,r.type="midimessage",this.emit(r.type,r),this._parseEventForStandardMessages(r)}_parseEventForStandardMessages(e){const r=Object.assign({},e);r.type=r.message.type||"unknownmessage";const i=e.message.dataBytes[0],o=e.message.dataBytes[1];if(r.type==="noteoff"||r.type==="noteon"&&o===0)this.notesState[i]=!1,r.type="noteoff",r.note=new Gi(je.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+Ne.octaveOffset),{rawAttack:0,rawRelease:o}),r.value=je.from7bitToFloat(o),r.rawValue=o,r.velocity=r.note.release,r.rawVelocity=r.note.rawRelease;else if(r.type==="noteon")this.notesState[i]=!0,r.note=new Gi(je.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+Ne.octaveOffset),{rawAttack:o}),r.value=je.from7bitToFloat(o),r.rawValue=o,r.velocity=r.note.attack,r.rawVelocity=r.note.rawAttack;else if(r.type==="keyaftertouch")r.note=new Gi(je.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+Ne.octaveOffset)),r.value=je.from7bitToFloat(o),r.rawValue=o,r.identifier=r.note.identifier,r.key=r.note.number,r.rawKey=i;else if(r.type==="controlchange"){r.controller={number:i,name:Ae.CONTROL_CHANGE_MESSAGES[i].name,description:Ae.CONTROL_CHANGE_MESSAGES[i].description,position:Ae.CONTROL_CHANGE_MESSAGES[i].position},r.subtype=r.controller.name||"controller"+i,r.value=je.from7bitToFloat(o),r.rawValue=o;const c=Object.assign({},r);c.type=`${r.type}-controller${i}`,delete c.subtype,this.emit(c.type,c);const f=Object.assign({},r);f.type=`${r.type}-`+Ae.CONTROL_CHANGE_MESSAGES[i].name,delete f.subtype,f.type.indexOf("controller")!==0&&this.emit(f.type,f),r.message.dataBytes[0]>=120&&this._parseChannelModeMessage(r),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(r.message.dataBytes[0])&&this._parseEventForParameterNumber(r)}else r.type==="programchange"?(r.value=i,r.rawValue=r.value):r.type==="channelaftertouch"?(r.value=je.from7bitToFloat(i),r.rawValue=i):r.type==="pitchbend"?(r.value=((o<<7)+i-8192)/8192,r.rawValue=(o<<7)+i):r.type="unknownmessage";this.emit(r.type,r)}_parseChannelModeMessage(e){const r=Object.assign({},e);r.type=r.controller.name,r.type==="localcontrol"&&(r.value=r.message.data[2]===127,r.rawValue=r.message.data[2]),r.type==="omnimodeon"?(r.type="omnimode",r.value=!0,r.rawValue=r.message.data[2]):r.type==="omnimodeoff"&&(r.type="omnimode",r.value=!1,r.rawValue=r.message.data[2]),r.type==="monomodeon"?(r.type="monomode",r.value=!0,r.rawValue=r.message.data[2]):r.type==="polymodeon"&&(r.type="monomode",r.value=!1,r.rawValue=r.message.data[2]),this.emit(r.type,r)}_parseEventForParameterNumber(e){const r=e.message.dataBytes[0],i=e.message.dataBytes[1];r===99||r===101?(this._nrpnBuffer=[],this._rpnBuffer=[],r===99?this._nrpnBuffer=[e.message]:i!==127&&(this._rpnBuffer=[e.message])):r===98||r===100?r===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&i!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(r===6||r===38||r===96||r===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,r,i,o){e=e==="nrpn"?"nrpn":"rpn";const c={target:o.target,timestamp:o.timestamp,message:o.message,parameterMsb:r,parameterLsb:i,value:je.from7bitToFloat(o.message.dataBytes[1]),rawValue:o.message.dataBytes[1]};e==="rpn"?c.parameter=Object.keys(Ae.REGISTERED_PARAMETERS).find(p=>Ae.REGISTERED_PARAMETERS[p][0]===r&&Ae.REGISTERED_PARAMETERS[p][1]===i):c.parameter=(r<<7)+i;const f=Ae.CONTROL_CHANGE_MESSAGES[o.message.dataBytes[0]].name;c.type=`${e}-${f}`,this.emit(c.type,c);const h=Object.assign({},c);h.type==="nrpn-dataincrement"?h.type="nrpn-databuttonincrement":h.type==="nrpn-datadecrement"?h.type="nrpn-databuttondecrement":h.type==="rpn-dataincrement"?h.type="rpn-databuttonincrement":h.type==="rpn-datadecrement"&&(h.type="rpn-databuttondecrement"),this.emit(h.type,h),c.type=e,c.subtype=f,this.emit(c.type,c)}getChannelModeByNumber(e){return Ne.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),je.getChannelModeByNumber(e)}getCcNameByNumber(e){if(Ne.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return je.getCcNameByNumber(e)}getNoteState(e){e instanceof Gi&&(e=e.identifier);const r=je.guessNoteNumber(e,Ne.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[r]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class Fm{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=je.getPropertyByValue(Ae.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=je.getPropertyByValue(Ae.SYSTEM_MESSAGES,this.command)),this.statusByte===Ae.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class Rv extends ur{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let r=1;r<=16;r++)this.channels[r]=new Nv(this,r);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let r={timestamp:Ne.time,target:this,port:this};e.port.connection==="open"?(r.type="opened",this.emit("opened",r)):e.port.connection==="closed"&&e.port.state==="connected"?(r.type="closed",this.emit("closed",r)):e.port.connection==="closed"&&e.port.state==="disconnected"?(r.type="disconnected",r.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",r)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const r=new Fm(e.data),i={port:this,target:this,message:r,timestamp:e.timeStamp,type:"midimessage",data:r.data,rawData:r.data,statusByte:r.data[0],dataBytes:r.dataBytes};this.emit("midimessage",i),r.isSystemMessage?this._parseEvent(i):r.isChannelMessage&&this.channels[r.channel]._processMidiMessageEvent(i),this._forwarders.forEach(o=>o.forward(r))}_parseEvent(e){const r=Object.assign({},e);r.type=r.message.type||"unknownmidimessage",r.type==="songselect"&&(r.song=e.data[1]+1,r.value=e.data[1],r.rawValue=r.value),this.emit(r.type,r)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){Ne.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,r,i={}){if(Ne.validation&&typeof i=="function"){let o=r!=null?[].concat(r):void 0;r=i,i={channels:o}}if(Ae.CHANNEL_EVENTS.includes(e)){i.channels===void 0&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS);let o=[];return je.sanitizeChannels(i.channels).forEach(c=>{o.push(this.channels[c].addListener(e,r,i))}),o}else return super.addListener(e,r,i)}addOneTimeListener(e,r,i={}){return i.remaining=1,this.addListener(e,r,i)}on(e,r,i,o){return this.addListener(e,r,i,o)}hasListener(e,r,i={}){if(Ne.validation&&typeof i=="function"){let o=[].concat(r);r=i,i={channels:o}}return Ae.CHANNEL_EVENTS.includes(e)?(i.channels===void 0&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),je.sanitizeChannels(i.channels).every(o=>this.channels[o].hasListener(e,r))):super.hasListener(e,r)}removeListener(e,r,i={}){if(Ne.validation&&typeof i=="function"){let o=[].concat(r);r=i,i={channels:o}}if(i.channels===void 0&&(i.channels=Ae.MIDI_CHANNEL_NUMBERS),e==null)return je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o]&&this.channels[o].removeListener()}),super.removeListener();Ae.CHANNEL_EVENTS.includes(e)?je.sanitizeChannels(i.channels).forEach(o=>{this.channels[o].removeListener(e,r,i)}):super.removeListener(e,r,i)}addForwarder(e,r={}){let i;return e instanceof F0?i=e:i=new F0(e,r),this._forwarders.push(i),i}removeForwarder(e){this._forwarders=this._forwarders.filter(r=>r!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return Ne.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class kv extends ur{constructor(){super(),this.defaults={note:{attack:je.from7bitToFloat(64),release:je.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},r=!1){if(je.isNode)try{window.navigator}catch{let h=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,h)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:r}),r&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const i={timestamp:this.time,target:this,type:"error",error:void 0},o={timestamp:this.time,target:this,type:"midiaccessgranted"},c={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(f){return i.error=f,this.emit("error",i),typeof e.callback=="function"&&e.callback(f),Promise.reject(f)}this.emit("midiaccessgranted",o),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(f){return i.error=f,this.emit("error",i),typeof e.callback=="function"&&e.callback(f),Promise.reject(f)}return this.emit("enabled",c),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(r.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(this._disconnectedInputs[i]._midiInput&&this._disconnectedInputs[i].id===e.toString())return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(this.inputs[i]._midiInput&&this.inputs[i].id===e.toString())return this.inputs[i]}getInputByName(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(r.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(~this._disconnectedInputs[i].name.indexOf(e))return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(e))return this.inputs[i]}getOutputByName(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(r.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(~this._disconnectedOutputs[i].name.indexOf(e))return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(e))return this.outputs[i]}getOutputById(e,r={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(r.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(this._disconnectedOutputs[i]._midiOutput&&this._disconnectedOutputs[i].id===e.toString())return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(this.outputs[i]._midiOutput&&this.outputs[i].id===e.toString())return this.outputs[i]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),je.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?je.getNoteDetails(je.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),je.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),je.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),je.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,r={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),je.buildNoteArray(e,r)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),je.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(r=>e.push(r.destroy())),this.outputs.forEach(r=>e.push(r.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let r={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?r.port=this.getOutputById(e.port.id):e.port.type==="input"&&(r.port=this.getInputById(e.port.id)),this.emit(e.port.state,r);const i=Object.assign({},r);i.type="portschanged",this.emit(i.type,i)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?r.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(r.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,r);const i=Object.assign({},r);i.type="portschanged",this.emit(i.type,i)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let r=this._inputs.length-1;r>=0;r--){const i=this._inputs[r];Array.from(this.interface.inputs.values()).find(c=>c===i._midiInput)||(this._disconnectedInputs.push(i),this._inputs.splice(r,1))}let e=[];return this.interface.inputs.forEach(r=>{if(!this._inputs.find(i=>i._midiInput===r)){let i=this._disconnectedInputs.find(o=>o._midiInput===r);i||(i=new Rv(r)),this._inputs.push(i),e.push(i.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let r=this._outputs.length-1;r>=0;r--){const i=this._outputs[r];Array.from(this.interface.outputs.values()).find(c=>c===i._midiOutput)||(this._disconnectedOutputs.push(i),this._outputs.splice(r,1))}let e=[];return this.interface.outputs.forEach(r=>{if(!this._outputs.find(i=>i._midiOutput===r)){let i=this._disconnectedOutputs.find(o=>o._midiOutput===r);i||(i=new Hf(r)),this._outputs.push(i),e.push(i.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),je.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),je.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Ae.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Ae.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Ae.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Ae.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Ae.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const Ne=new kv;Ne.constructor=null;const Dv=async()=>{if(Ne.enabled)return Ne;try{return await Ne.enable({sysex:!0}),console.log("WebMidi is enabled with SysEx support!"),Ne}catch(a){throw console.error("WebMidi could not be enabled.",a),a}},j0=()=>Ne.enabled?Ne.inputs.map(a=>({id:a.id,name:a.name})):[],_v=(a,e)=>{if(Ne.enabled){const r=Ne.getInputById(a);if(r){const i=f=>{e({type:"noteon",note:f.note.identifier,velocity:f.velocity,controller:null,channel:f.message.channel})},o=f=>{e({type:"noteoff",note:f.note.identifier,velocity:0,controller:null,channel:f.message.channel})},c=f=>{e({type:"controlchange",controller:f.controller.number,value:f.rawValue,note:null,channel:f.message.channel})};return r.addListener("noteon",i),r.addListener("noteoff",o),r.addListener("controlchange",c),()=>{r.removeListener("noteon",i),r.removeListener("noteoff",o),r.removeListener("controlchange",c)}}}return()=>{}},Ov=a=>{if(Ne.enabled){const e=r=>{a(r)};return Ne.addListener("connected",e),Ne.addListener("disconnected",e),()=>{Ne.removeListener("connected",e),Ne.removeListener("disconnected",e)}}return()=>{}},Iv=(a,e)=>{if(Ne.enabled){const r=Ne.getInputById(a);if(r){const i=Ne.outputs.find(o=>o.name===r.name);i?(i.sendSysex(71,e),console.log(`Sent SysEx to ${i.name}`)):console.warn("Could not find matching MIDI Output for SysEx")}}},gc=(a,e,r,i)=>{if(Ne.enabled){const o=Ne.getInputById(a);if(o){const c=Ne.outputs.find(f=>f.name===o.name);c&&c.sendNoteOn(e,{attack:r/127,channels:i})}}},jm=T.createContext(null),Cc=()=>T.useContext(jm),Lv=({children:a,onMidiCommand:e})=>{const[r,i]=T.useState(!1),[o,c]=T.useState([]),[f,h]=T.useState(""),[p,y]=T.useState(!1),[v,x]=T.useState(null),[b,S]=T.useState({}),[E,C]=T.useState(null),[_,I]=T.useState(!1),M=T.useRef(!1),N=T.useRef(e);T.useEffect(()=>{N.current=e},[e]),T.useEffect(()=>{(async()=>{try{if(await Dv(),i(!0),c(j0()),Ov(()=>{console.log("MIDI Device change detected, refreshing inputs..."),c(j0())}),window.electronAPI&&window.electronAPI.getMidiMappings){const F=await window.electronAPI.getMidiMappings();F&&(console.log("Loaded saved MIDI mappings:",F),S(F))}}catch(F){console.error("MIDI Init Failed:",F)}})()},[]),T.useEffect(()=>{(async()=>{if(!r||o.length===0)return;let F=f;if(!F&&window.electronAPI?.getSelectedMidiInput){const z=await window.electronAPI.getSelectedMidiInput();z&&o.some(ie=>ie.id===z)&&(F=z)}(!F||!o.some(z=>z.id===F))&&(F=o[0].id),F!==f&&(console.log(`MIDI: Auto-selecting input: ${F}`),h(F))})()},[r,o,f]);const D=async()=>{window.electronAPI&&window.electronAPI.saveMidiMappings&&(await window.electronAPI.saveMidiMappings(b),console.log("MIDI mappings saved to default."))},k=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(b,"midi")},G=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const K=await window.electronAPI.importMappings("midi");K.success&&K.mappings&&(S(K.mappings),console.log("MIDI mappings imported."))}},P=K=>{const F=o.find(z=>z.id===K);F&&F.name.toLowerCase().includes("apc40")&&(console.log("Detected APC40, sending initialization SysEx..."),Iv(K,[127,41,96,0,4,65,1,1,1]))};T.useEffect(()=>{f&&window.electronAPI&&window.electronAPI.saveSelectedMidiInput&&window.electronAPI.saveSelectedMidiInput(f),f&&r&&P(f)},[f,r,o]);const q=T.useCallback((K,F,z=null)=>{if(!f||!r)return;const ie=b[K];if(ie&&ie.type==="note"){let be=0;typeof F=="number"?be=F:be=F?127:0;const U=z!==null?z:ie.channel;gc(f,ie.address,be,U)}},[f,r,b]);T.useEffect(()=>{let K=()=>{};return f&&(console.log(`(Re)binding MIDI listener for: ${f}`),K=_v(f,F=>{Y.current&&C(F),te(F)})),K},[f,p,v,b,o]);const Y=T.useRef(p);T.useEffect(()=>{Y.current=p},[p]);const te=K=>{if(K.channel===1&&K.note==="D7"){const z=K.type==="noteon";I(z),M.current=z,console.log(`Shift ${z?"Down":"Up"}`);return}if(p&&v){if(K.type==="noteoff")return;const z=K.note||K.controller,ie=M.current,be={type:K.type==="noteon"||K.type==="noteoff"?"note":"cc",channel:K.channel,address:z,requiresShift:ie,label:`${ie?"":""}CH${K.channel}:${z}`};console.log(`Mapped ${v} to:`,be),S(U=>({...U,[v]:be})),x(null);return}Object.entries(b).forEach(([z,ie])=>{const be=(K.type==="noteon"||K.type==="noteoff")&&ie.type==="note"&&K.note===ie.address&&K.channel===ie.channel,U=K.type==="controlchange"&&ie.type==="cc"&&K.controller===ie.address&&K.channel===ie.channel,ee=ie.type==="cc"||!!ie.requiresShift===M.current;if((be||U)&&ee&&N.current){let ve;K.type==="controlchange"?ve=K.value??0:K.type==="noteoff"?ve=0:ve=K.velocity??0,N.current(z,ve,127,K.type)}})},X={midiInitialized:r,midiInputs:o,selectedMidiInputId:f,setSelectedMidiInputId:h,isMapping:p,startMapping:()=>y(!0),stopMapping:()=>{y(!1),x(null)},learningId:v,setLearningId:x,mappings:b,setMappings:S,removeMapping:K=>{S(F=>{const z={...F};return delete z[K],z})},saveMappings:D,exportMappings:k,importMappings:G,initializeApc40:P,sendFeedback:q,lastMidiEvent:E,isShiftDown:_};return m.jsx(jm.Provider,{value:X,children:a})},Pm=T.createContext(null),rd=()=>T.useContext(Pm),Uv=({children:a,onArtnetCommand:e})=>{const[r,i]=T.useState(!1),[o,c]=T.useState(!1),[f,h]=T.useState(null),[p,y]=T.useState({}),[v,x]=T.useState(null),b=T.useRef(e);T.useEffect(()=>{b.current=e},[e]),T.useEffect(()=>{(async()=>{try{if(window.electronAPI&&window.electronAPI.initializeArtnet&&(await window.electronAPI.initializeArtnet()).success&&(i(!0),console.log("Art-Net initialized for mapping")),window.electronAPI&&window.electronAPI.getArtnetMappings){const G=await window.electronAPI.getArtnetMappings();G&&(console.log("Loaded saved Art-Net mappings:",G),y(G))}}catch(G){console.error("Art-Net Init Failed:",G)}})()},[]);const S=async()=>{window.electronAPI&&window.electronAPI.saveArtnetMappings&&(await window.electronAPI.saveArtnetMappings(p),console.log("Art-Net mappings saved."))},E=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(p,"artnet")},C=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const k=await window.electronAPI.importMappings("artnet");k.success&&k.mappings&&(y(k.mappings),console.log("Art-Net mappings imported."))}};T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onArtnetDataReceived)return window.electronAPI.onArtnetDataReceived(G=>{_.current&&x(G),I(G)})},[o,f,p]);const _=T.useRef(o);T.useEffect(()=>{_.current=o},[o]);const I=k=>{const{universe:G,channel:P,value:q}=k;if(o&&f){if(q===0)return;const Y={universe:G,channel:P,label:`U${G}:CH${P+1}`};console.log(`Mapped ${f} to Art-Net:`,Y),y(te=>({...te,[f]:Y})),h(null);return}Object.entries(p).forEach(([Y,te])=>{te.universe===G&&te.channel===P&&b.current&&b.current(Y,q)})},D={artnetInitialized:r,isMapping:o,startMapping:()=>c(!0),stopMapping:()=>{c(!1),h(null)},learningId:f,setLearningId:h,mappings:p,setMappings:y,saveMappings:S,exportMappings:E,importMappings:C,lastDmxEvent:v};return m.jsx(Pm.Provider,{value:D,children:a})},zm=T.createContext(null),sd=()=>T.useContext(zm),Bv=({children:a,onCommand:e,enabled:r=!1})=>{const[i,o]=T.useState(!1),[c,f]=T.useState(null),[h,p]=T.useState({}),y=T.useRef(e);T.useEffect(()=>{y.current=e},[e]),T.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getKeyboardMappings){const C=await window.electronAPI.getKeyboardMappings();C&&p(C)}})()},[]);const v=async()=>{window.electronAPI&&window.electronAPI.saveKeyboardMappings&&await window.electronAPI.saveKeyboardMappings(h)},x=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(h,"keyboard")},b=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const E=await window.electronAPI.importMappings("keyboard");E.success&&E.mappings&&p(E.mappings)}};T.useEffect(()=>{const E=C=>{if(r&&!(C.target.tagName==="INPUT"||C.target.tagName==="TEXTAREA"||C.target.isContentEditable)){if(i&&c){C.preventDefault();const _={key:C.code,label:C.code.replace("Key","").replace("Digit","")};p(I=>({...I,[c]:_})),f(null);return}Object.entries(h).forEach(([_,I])=>{C.code===I.key&&(C.preventDefault(),y.current&&y.current(_,1,1,"keydown"))})}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[r,i,c,h]);const S={isMapping:i,startMapping:()=>o(!0),stopMapping:()=>{o(!1),f(null)},learningId:c,setLearningId:f,mappings:h,setMappings:p,saveMappings:v,exportMappings:x,importMappings:b,removeMapping:E=>p(C=>{const _={...C};return delete _[E],_})};return m.jsx(zm.Provider,{value:S,children:a})},rn=({id:a,children:e})=>{const{isMapping:r,setLearningId:i,removeMapping:o}=Cc(),{isMapping:c,setLearningId:f,removeMapping:h}=rd()||{},{isMapping:p,setLearningId:y,removeMapping:v}=sd()||{},x=r||c||p,b=C=>{x&&(C.preventDefault(),C.stopPropagation(),r&&i(a),c&&f(a),p&&y(a))},S=C=>{x&&(C.preventDefault(),C.stopPropagation(),r&&o(a),c&&h(a),p&&v(a))},E=ha.Children.only(e);return ha.cloneElement(E,{"data-mappable-id":a,onClickCapture:x?b:E.props.onClickCapture,onContextMenu:x?S:E.props.onContextMenu,className:`${E.props.className||""} ${x?"mappable-target":""}`.trim()})},Fv=({masterIntensity:a,onMasterIntensityChange:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_intensity",targetType:"global",label:"MASTER",min:0,max:1,step:.01}))};return m.jsx("div",{className:"master-intensity-slider",draggable:!0,onDragStart:r,children:m.jsx(rn,{id:"master_intensity",children:m.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,className:"slider_hor",id:"masterIntensityRange",onChange:i=>e(parseFloat(i.target.value))})})})},jv=({masterIntensity:a,onMasterIntensityChange:e,onClearAllActive:r,isGlobalBlackout:i,onToggleGlobalBlackout:o})=>{const c=(f,h)=>{f.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"global",label:h.toUpperCase()}))};return m.jsxs("div",{className:"composition-controls",children:[m.jsx("span",{className:"layer-control-button",children:"Comp"}),m.jsx(rn,{id:"comp_clear",children:m.jsx("span",{className:"layer-control-button",onClick:r,style:{cursor:"pointer"},draggable:!0,onDragStart:f=>c(f,"clear"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),m.jsx(rn,{id:"comp_blackout",style:{width:"100%",display:"flex"},children:m.jsx("span",{className:"layer-control-button",onClick:o,style:{cursor:"pointer",backgroundColor:i?"red":""},draggable:!0,onDragStart:f=>c(f,"blackout"),children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),m.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),m.jsx(Fv,{masterIntensity:a,onMasterIntensityChange:e})]})},Pv=({name:a,index:e,onTrigger:r,onShowColumnHeaderContextMenu:i})=>{const o=f=>{f.preventDefault(),i&&i(e)},c=f=>{f.button===0&&r&&r()};return m.jsx(rn,{id:`column_${e}`,children:m.jsx("div",{className:"column-header trigger-button",onClick:c,onContextMenu:o,style:{cursor:"pointer"},children:a})})},Yi=[{id:"rotate",name:"Rotate",type:"transform",description:"Rotates the shape around its center.",defaultParams:{angle:0,speed:0,direction:"CW"},paramControls:[{id:"angle",label:"Angle",type:"range",min:0,max:360,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["CW","CCW"]}]},{id:"scale",name:"Scale",type:"transform",description:"Scales the shape.",defaultParams:{scaleX:1,scaleY:1},paramControls:[{id:"scaleX",label:"Scale X",type:"range",min:.01,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"range",min:.01,max:5,step:.01}]},{id:"translate",name:"Translate",type:"transform",description:"Moves the shape.",defaultParams:{translateX:0,translateY:0},paramControls:[{id:"translateX",label:"Translate X",type:"range",min:-1,max:1,step:.01},{id:"translateY",label:"Translate Y",type:"range",min:-1,max:1,step:.01}]},{id:"color",name:"Color",type:"color",description:"Changes the color of the shape with solid, rainbow or custom palette modes.",defaultParams:{mode:"solid",color:"#ffffff",r:255,g:255,b:255,cycleSpeed:0,rainbowSpread:1,rainbowOffset:0,rainbowPalette:"rainbow",paletteColors:["#ff0000","#00ff00","#0000ff","#ffff00"],paletteSize:4,paletteSpread:1,hue:0,saturation:0,brightness:1,enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["solid","rainbow","palette"]},{id:"color",label:"Color",type:"color",showIf:{mode:"solid"}},{id:"hue",label:"Hue",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"saturation",label:"Saturation",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"brightness",label:"Brightness",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"paletteSize",label:"Palette Size",type:"range",min:2,max:16,step:1,showIf:{mode:"palette"}},{id:"paletteSpread",label:"Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"palette"}},{id:"cycleSpeed",label:"Cycle Speed",type:"range",min:0,max:10,step:.1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowSpread",label:"Rainbow Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"rainbow"}},{id:"rainbowOffset",label:"Offset",type:"range",min:0,max:360,step:1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowPalette",label:"Preset",type:"select",options:["rainbow","fire","ice","cyber"],showIf:{mode:"rainbow"}}]},{id:"wave",name:"Wave",type:"animation",description:"Applies a wave distortion to the shape.",defaultParams:{amplitude:.1,frequency:10,speed:1,direction:"x"},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:.01,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["x","y"]}]},{id:"warp",name:"Warp",type:"animation",description:"Symmetrical chaotic wave distortion.",defaultParams:{amount:.1,chaos:.5,speed:1},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1}]},{id:"distortion",name:"Distortion",type:"transform",description:"Distorts the point data.",defaultParams:{amount:.1,scale:10,speed:.5},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"scale",label:"Scale",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:5,step:.1}]},{id:"move",name:"Move (Bounce)",type:"transform",description:"Moves points and bounces them off the borders.",defaultParams:{speedX:.1,speedY:.1},paramControls:[{id:"speedX",label:"Speed X",type:"range",min:0,max:2,step:.01},{id:"speedY",label:"Speed Y",type:"range",min:0,max:2,step:.01}]},{id:"delay",name:"Delay",type:"effect",description:"Frame or Channel based delay effect.",defaultParams:{mode:"frame",playstyle:"repeat",useCustomOrder:!1,delayDirection:"left_to_right",delayAmount:5,decay:.8,steps:10,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat"]},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"delayDirection",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}},{id:"steps",label:"Steps",type:"range",min:2,max:20,step:1,showIf:{mode:"frame"}},{id:"delayAmount",label:"Delay Time",type:"range",min:1,max:60,step:1},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01}]},{id:"chase",name:"Chase",type:"effect",description:"Frame or Channel based chase effect.",defaultParams:{mode:"frame",playstyle:"repeat",steps:4,decay:.8,speed:1,overlap:1,direction:"left_to_right",useCustomOrder:!1,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat","bounce"]},{id:"steps",label:"Steps",type:"range",min:2,max:16,step:1,showIf:{mode:"frame"}},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:5,step:.1},{id:"overlap",label:"Overlap",type:"range",min:1,max:4,step:1},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"direction",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}}]},{id:"blanking",name:"Blanking",type:"animation",description:"Controls the blanking of the laser output.",defaultParams:{blankingInterval:0,spacing:0},paramControls:[{id:"blankingInterval",label:"Blanking Interval",type:"range",min:0,max:10,step:1},{id:"spacing",label:"Spacing",type:"range",min:0,max:20,step:1}]},{id:"strobe",name:"Strobe",type:"animation",description:"Applies a strobe effect to the laser output.",defaultParams:{strobeSpeed:100,strobeAmount:.5},paramControls:[{id:"strobeSpeed",label:"Strobe Speed (ms)",type:"range",min:10,max:1e3,step:10},{id:"strobeAmount",label:"Strobe Amount (0-1)",type:"range",min:0,max:1,step:.01}]},{id:"mirror",name:"Mirror",type:"transform",description:"Mirrors the shape from the center.",defaultParams:{mode:"none",additive:!0},paramControls:[{id:"mode",label:"Mirror Mode",type:"select",options:["none","x+","x-","y+","y-"]},{id:"additive",label:"Additive",type:"checkbox"}]}],zv=Yi.reduce((a,e)=>(a[e.id]=e,a),{});function P0(a,e,r,i){const o=e.style||"loop",c=e.direction||"forward";if(c==="pause")return r;let f=a;o==="bounce"&&(f*=2);let h=0;if(o==="once")h=Math.min(f,1),c==="backward"&&(h=1-h);else if(o==="bounce"){let p=f%1;Math.floor(f)%2===1?h=1-p:h=p,c==="backward"&&(h=1-h)}else h=f%1,c==="backward"&&(h=1-h);return i&&Array.isArray(i)&&i.length===2?i[0]+(i[1]-i[0])*h:r}function bc(a,e,r,i,o,c){if(!r)return e;const f=typeof r=="string"?{syncMode:r}:r;if(!f.syncMode)return e;const{time:h,progress:p=0,bpm:y=120,clipDuration:v=0,fftLevels:x={low:0,mid:0,high:0},activationTime:b=0}=i;let S=f.range;(!S||!Array.isArray(S)||S.length!==2)&&o!==void 0&&c!==void 0&&(S=[o,c]);let E=0;const C=f.speedMultiplier||1;if((f.style||"loop")==="once"&&b>0){const I=(h-b)*.001;let M=1;if(f.syncMode==="timeline")M=Math.max(.01,f.duration||1);else if(f.syncMode==="bpm"){const N=Math.max(.1,f.beats||4),D=y/60;M=N/(D||2)}else if(f.syncMode==="fps")return E=I*C,P0(E,f,e,S);E=I/M*C}else if(f.syncMode==="fps")E=h*.001*C;else if(f.syncMode==="timeline"){const I=Math.max(.01,f.duration||1);v>0?E=p*v/I*C:E=0}else if(f.syncMode==="bpm"){const I=Math.max(.1,f.beats||4),M=y/60,N=I/(M||2);v>0?E=p*v/N*C:E=0}else if(f.syncMode==="fft"){const I=x[f.fftRange||"low"]||0;return S?S[0]+(S[1]-S[0])*I:e}return P0(E,f,e,S)}let Yf=new Float32Array(1024*8);function Gv(a){Yf.length<a*8&&(Yf=new Float32Array(a*8*2))}function Xl(a,e,r={}){const{progress:i=0,time:o=performance.now(),effectStates:c,syncSettings:f={},fftLevels:h}=r;if(!e||e.length===0)return a;const p=a.points,y=a.isTypedArray||p instanceof Float32Array,v=y?p.length/8:p.length;Gv(v);const x=Yf.subarray(0,v*8);if(y)x.set(p);else for(let E=0;E<v;E++){const C=p[E],_=E*8;x[_]=C.x,x[_+1]=C.y,x[_+2]=C.z||0,x[_+3]=C.r,x[_+4]=C.g,x[_+5]=C.b,x[_+6]=C.blanking?1:0,x[_+7]=C.lastPoint?1:0}let b=x;for(const E of e){const C=E.params;if(C.enabled===!1||!zv[E.id])continue;const I=b.length/8;let M=C;const N=E.instanceId?`${E.instanceId}.`:`${E.id}.`;let D=!1;for(const k in C)if(f[N+k]){D=!0;break}if(D){M={...C};for(const k in M){const G=N+k;f[G]&&(M[k]=bc(k,M[k],f[G],r))}}switch(E.id){case"rotate":Hv(b,I,M,i,o);break;case"scale":Yv(b,I,M);break;case"translate":qv(b,I,M);break;case"color":Xv(b,I,M,o);break;case"wave":Zv(b,I,M,o);break;case"blanking":Qv(b,I,M);break;case"strobe":Wv(b,I,M,o);break;case"mirror":b=Kv(b,I,M);break;case"warp":Jv(b,I,M,o);break;case"distortion":e1(b,I,M,o);break;case"move":t1(b,I,M,o);break;case"delay":c&&E.instanceId&&(b=n1(b,I,M,c,E.instanceId,r));break;case"chase":b=a1(b,I,M,o,r);break}}const S=new Float32Array(b);return b._channelDistributions&&(S._channelDistributions=b._channelDistributions),{...a,points:S,isTypedArray:!0}}function Hv(a,e,r,i,o){const{angle:c,speed:f,direction:h}=r,p=h==="CCW"?-1:1,y=o*.001*f*p,v=c*Math.PI/180+y,x=Math.sin(v),b=Math.cos(v);for(let S=0;S<e;S++){const E=S*8,C=a[E],_=a[E+1];a[E]=C*b-_*x,a[E+1]=C*x+_*b}}function Yv(a,e,r){const{scaleX:i,scaleY:o}=r;for(let c=0;c<e;c++){const f=c*8;a[f]*=i,a[f+1]*=o}}function qv(a,e,r){const{translateX:i,translateY:o}=r;for(let c=0;c<e;c++){const f=c*8;a[f]+=i,a[f+1]+=o}}function z0(a){if(!a)return{r:255,g:255,b:255};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function Vv(a,e,r){let i,o,c;const f=Math.floor(a*6),h=a*6-f,p=r*(1-e),y=r*(1-h*e),v=r*(1-(1-h)*e);switch(f%6){case 0:i=r,o=v,c=p;break;case 1:i=y,o=r,c=p;break;case 2:i=p,o=r,c=v;break;case 3:i=p,o=y,c=r;break;case 4:i=v,o=p,c=r;break;case 5:i=r,o=p,c=y;break}return[Math.round(i*255),Math.round(o*255),Math.round(c*255)]}function Xv(a,e,r,i){const{mode:o,r:c,g:f,b:h,color:p,hue:y,saturation:v,brightness:x,cycleSpeed:b,rainbowSpread:S,rainbowOffset:E,rainbowPalette:C,paletteColors:_=[],paletteSize:I=4,paletteSpread:M=1}=r,N=i*.001*b;if(o==="palette"){const D=Math.min(_.length,I),k=_.slice(0,D).map(z0);k.length===0&&k.push({r:255,g:255,b:255});for(let G=0;G<e;G++){const P=G*8,Y=(G/e*M+N*.5+E/360)%1*k.length,te=Math.floor(Y)%k.length,H=(te+1)%k.length,Z=Y-Math.floor(Y),W=k[te],X=k[H];a[P+3]=Math.round(W.r+(X.r-W.r)*Z),a[P+4]=Math.round(W.g+(X.g-W.g)*Z),a[P+5]=Math.round(W.b+(X.b-W.b)*Z)}}else if(o==="rainbow"){const D=C||"rainbow";for(let k=0;k<e;k++){const G=k*8,P=(k/e*S+N*.5+E/360)%1;let q,Y,te;D==="rainbow"?[q,Y,te]=G0(P,1,.5):[q,Y,te]=$v(D,P),a[G+3]=q,a[G+4]=Y,a[G+5]=te}}else{let D=c,k=f,G=h;if(y!==void 0&&v!==void 0&&x!==void 0)[D,k,G]=Vv(y,v,x);else if(p){const P=z0(p);D=P.r,k=P.g,G=P.b}if(b>0){const P=N*50%360,[q,Y,te]=G0(P/360,1,.5);for(let H=0;H<e;H++){const Z=H*8;a[Z+3]=q,a[Z+4]=Y,a[Z+5]=te}}else for(let P=0;P<e;P++){const q=P*8;a[q+3]=D,a[q+4]=k,a[q+5]=G}}}function $v(a,e){const r={fire:[{r:255,g:0,b:0},{r:255,g:128,b:0},{r:255,g:255,b:0},{r:255,g:0,b:0}],ice:[{r:0,g:0,b:255},{r:0,g:255,b:255},{r:255,g:255,b:255},{r:0,g:0,b:255}],cyber:[{r:255,g:0,b:255},{r:0,g:255,b:255},{r:0,g:0,b:255},{r:255,g:0,b:255}]},i=r[a]||r.fire,o=e*(i.length-1),c=Math.floor(o),f=o-c,h=i[c],p=i[c+1]||i[c];return[Math.round(h.r+(p.r-h.r)*f),Math.round(h.g+(p.g-h.g)*f),Math.round(h.b+(p.b-h.b)*f)]}function G0(a,e,r){let i,o,c;{const f=(y,v,x)=>(x<0&&(x+=1),x>1&&(x-=1),x<.16666666666666666?y+(v-y)*6*x:x<.5?v:x<.6666666666666666?y+(v-y)*(.6666666666666666-x)*6:y),h=r+e-r*e,p=2*r-h;i=f(p,h,a+1/3),o=f(p,h,a),c=f(p,h,a-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(c*255)]}function Zv(a,e,r,i){const{amplitude:o,frequency:c,speed:f,direction:h}=r,p=i*.001*f;for(let y=0;y<e;y++){const v=y*8;h==="x"?a[v+1]+=o*Math.sin(a[v]*c+p):h==="y"&&(a[v]+=o*Math.sin(a[v+1]*c+p))}}function Qv(a,e,r){const{blankingInterval:i,spacing:o=0}=r;if(i<=0)return;const c=i+1+o;for(let f=0;f<e;f++)f%c>=i&&(a[f*8+6]=1)}function Wv(a,e,r,i){const{strobeSpeed:o,strobeAmount:c}=r;if(i%o/o<c)for(let h=0;h<e;h++)a[h*8+6]=1}function Kv(a,e,r){const{mode:i,additive:o=!0}=r;if(i==="none"||e===0)return a;let c;const f=a._channelDistributions,h=(p,y,v)=>o?!0:v==="x+"?p>=0:v==="x-"?p<=0:v==="y+"?y>=0:v==="y-"?y<=0:!0;if(f){c=new Float32Array((e*2+f.size)*8);const p=new Map;let y=0;for(const[x,b]of f){const S=b.length/8,E=b.start,C=y;let _=0;for(let I=0;I<S;I++){const M=E+I*8;h(a[M],a[M+1],i)&&(c.set(a.subarray(M,M+8),y),y+=8,_++)}if(_>0){const I=y-8;c.set(c.subarray(I,I+8),y),c[y+6]=1,c[y+3]=0,c[y+4]=0,c[y+5]=0,y+=8;for(let M=0;M<S;M++){const N=E+M*8;h(a[N],a[N+1],i)&&(c.set(a.subarray(N,N+8),y),i==="x-"||i==="x+"?c[y]=-c[y]:(i==="y-"||i==="y+")&&(c[y+1]=-c[y+1]),y+=8)}p.set(x,{start:C,length:(_*2+1)*8})}}const v=new Float32Array(y);return v.set(c.subarray(0,y)),v._channelDistributions=p,v}else{c=new Float32Array((e*2+1)*8);let p=0,y=0;for(let v=0;v<e;v++){const x=v*8;h(a[x],a[x+1],i)&&(c.set(a.subarray(x,x+8),p),p+=8,y++)}if(y>0){const v=p-8;c.set(c.subarray(v,v+8),p),c[p+6]=1,c[p+3]=0,c[p+4]=0,c[p+5]=0,p+=8;for(let x=0;x<e;x++){const b=x*8;h(a[b],a[b+1],i)&&(c.set(a.subarray(b,b+8),p),i==="x-"||i==="x+"?c[p]=-c[p]:(i==="y-"||i==="y+")&&(c[p+1]=-c[p+1]),p+=8)}return c.slice(0,p)}}return a}function Jv(a,e,r,i){const{amount:o,chaos:c,speed:f}=r,h=i*.001*f;for(let p=0;p<e;p++){const y=p*8,v=a[y],x=a[y+1],b=Math.abs(x);a[y]+=Math.sin(b*10*(1+c)+h)*o*Math.cos(h*c),a[y+1]+=Math.cos(Math.abs(v)*10*(1+c)+h)*o*Math.sin(h*c)}}function e1(a,e,r,i){const{amount:o,scale:c,speed:f}=r,h=i*.001*f;for(let p=0;p<e;p++){const y=p*8,v=Math.sin(a[y]*c+h)*Math.cos(a[y+1]*c-h),x=Math.cos(a[y]*c-h)*Math.sin(a[y+1]*c+h);a[y]+=v*o,a[y+1]+=x*o}}function t1(a,e,r,i){const{speedX:o,speedY:c}=r,f=i*.001,h=f*o,p=f*c,y=4;for(let v=0;v<e;v++){const x=v*8;let b=a[x]+h,S=a[x+1]+p,E=(b+1)%y;E<0&&(E+=y),E>2&&(E=4-E),b=E-1;let C=(S+1)%y;C<0&&(C+=y),C>2&&(C=4-C),S=C-1,a[x]=b,a[x+1]=S}}function n1(a,e,r,i,o,c){const{mode:f="frame",delayAmount:h,decay:p,delayDirection:y,useCustomOrder:v,customOrder:x,playstyle:b="repeat",steps:S=10}=r;i.has(o)||i.set(o,[]);const E=i.get(o);if(E.unshift(new Float32Array(a)),f==="frame"){const C=h*S+1;E.length>C&&(E.length=C);const _=new Float32Array(a.length);for(let I=0;I<e;I++){let M=0;const N=I/e;y==="left_to_right"?M=Math.floor(N*(S-1)):y==="right_to_left"?M=Math.floor((1-N)*(S-1)):y==="center_to_out"?M=Math.floor(Math.abs(N-.5)*2*(S-1)):y==="out_to_center"&&(M=Math.floor((1-Math.abs(N-.5)*2)*(S-1)));const D=M*h,k=D<E.length?E[D]:null,G=Math.pow(p,M),P=I*8;if(k&&k.length>0){let q;if(k.length===a.length)q=P;else{const Y=k.length/8;let te=Math.floor(N*Y);te>=Y&&(te=Y-1),q=te*8}if(_[P]=k[q],_[P+1]=k[q+1],_[P+2]=k[q+2],_[P+3]=k[q+3]*G,_[P+4]=k[q+4]*G,_[P+5]=k[q+5]*G,_[P+6]=k[q+6],_[P+7]=k[q+7],I<e-1){const Y=(I+1)/e;let te=0;y==="left_to_right"?te=Math.floor(Y*(S-1)):y==="right_to_left"?te=Math.floor((1-Y)*(S-1)):y==="center_to_out"?te=Math.floor(Math.abs(Y-.5)*2*(S-1)):y==="out_to_center"&&(te=Math.floor((1-Math.abs(Y-.5)*2)*(S-1))),te!==M&&(_[P+6]=1)}}else _.set(a.subarray(P,P+8),P),_[P+3]=0,_[P+4]=0,_[P+5]=0,_[P+6]=1}return a._channelDistributions&&(_._channelDistributions=a._channelDistributions),_}else{const{assignedDacs:C}=c||{};let _=new Map,I=0;if(v||r.delayMode==="channel")(x&&x.length>0?x.map(Z=>Z.originalIndex):C?C.map((Z,W)=>W):[0]).forEach((Z,W)=>{_.set(Z,W),I=Math.max(I,W)});else{const Z=(C||[]).length||1;for(let W=0;W<Z;W++){let X=W;y==="right_to_left"?X=Z-1-W:y==="center_to_out"?X=Math.floor(Math.abs(W-(Z-1)/2)):y==="out_to_center"&&(X=Math.min(W,Z-1-W)),_.set(W,X),I=Math.max(I,X)}}const N=I+1,D=h*N+1;E.length>D&&(E.length=D);const k=[];for(let H=0;H<N;H++){const Z=H*h;k.push({points:Z<E.length?E[Z]:null,factor:Math.pow(p,H),index:H})}const G=k.reduce((H,Z)=>H+(Z.points?Z.points.length/8:a.length/8),0),P=new Float32Array(G*8);let q=0;const Y=new Array(k.length);for(let H=0;H<k.length;H++){const Z=k[H],W=Z.points,X=W?W.length/8:a.length/8;Y[H]=q;for(let K=0;K<X;K++){const F=K*8,z=q+K*8;W?(P[z]=W[F],P[z+1]=W[F+1],P[z+2]=W[F+2],P[z+3]=W[F+3]*Z.factor,P[z+4]=W[F+4]*Z.factor,P[z+5]=W[F+5]*Z.factor,P[z+6]=W[F+6],P[z+7]=W[F+7]):P[z+6]=1}q+=X*8}const te=new Map;return _.forEach((H,Z)=>{H<k.length&&te.set(Z,{start:Y[H],length:k[H].points?k[H].points.length:a.length})}),P._channelDistributions=te,P}}function a1(a,e,r,i,o={}){const{mode:c="frame",steps:f,decay:h,speed:p,overlap:y,direction:v,useCustomOrder:x,customOrder:b,playstyle:S="loop"}=r,{progress:E=0,clipDuration:C=1,syncSettings:_={}}=o,I=r.instanceId?`${r.instanceId}.`:"chase.",M=!!_[I+"speed"],N=E!==void 0&&C>0||M;if(c==="frame"){const D=f;let k=(N?E*D:i*.001)*p;if(S==="bounce"){const P=D,q=k%(P*2);k=q>P?P*2-q:q}else S==="once"?k=Math.min(k,D):k=k%D;const G=new Float32Array(a.length);for(let P=0;P<e;P++){const q=P/e;let Y=0;v==="left_to_right"?Y=Math.min(D-1,Math.floor(q*D)):v==="right_to_left"?Y=Math.min(D-1,Math.floor((1-q)*D)):v==="center_to_out"?Y=Math.min(D-1,Math.floor(Math.abs(q-.5)*2*D)):v==="out_to_center"&&(Y=Math.min(D-1,Math.floor((1-Math.abs(q-.5)*2)*D)));let te=Math.abs(k-Y);te>D/2&&(te=D-te);let H=te<y?1-te/y:0;h>0&&(H=Math.pow(H,1-h));const Z=P*8;if(G.set(a.subarray(Z,Z+8),Z),G[Z+3]*=H,G[Z+4]*=H,G[Z+5]*=H,H<.05&&(G[Z+6]=1),P<e-1){const W=(P+1)/e;let X=0;v==="left_to_right"?X=Math.min(D-1,Math.floor(W*D)):v==="right_to_left"?X=Math.min(D-1,Math.floor((1-W)*D)):v==="center_to_out"?X=Math.min(D-1,Math.floor(Math.abs(W-.5)*2*D)):v==="out_to_center"&&(X=Math.min(D-1,Math.floor((1-Math.abs(W-.5)*2)*D))),X!==Y&&(G[Z+6]=1)}}return a._channelDistributions&&(G._channelDistributions=a._channelDistributions),G}else{const{assignedDacs:D}=o||{};let k=new Map,G=0;if(x)(b&&b.length>0?b.map(K=>K.originalIndex):D?D.map((K,F)=>F):[0]).forEach((K,F)=>{k.set(K,F),G++});else{G=(D?D.length:1)||1;for(let X=0;X<G;X++){let K=X;v==="right_to_left"?K=G-1-X:v==="center_to_out"?K=Math.floor(Math.abs(X-(G-1)/2)):v==="out_to_center"&&(K=Math.min(X,G-1-X)),k.set(X,K)}}const P=G;let q=(N?E*P:i*.001)*p;if(S==="bounce"){const X=P,K=q%(X*2);q=K>X?X*2-K:K}else S==="once"?q=Math.min(q,P):q=q%P;const Y=e*G,te=new Float32Array(Y*8),H=new Map;let Z=0;const W=Array.from(k.keys());W.length===0&&W.push(0);for(const X of W){const K=k.get(X)||0;let F=Math.abs(q-K);F>P/2&&(F=P-F);let z=F<y?1-F/y:0;h>0&&(z=Math.pow(z,1-h));const ie=Z;for(let be=0;be<e;be++){const U=be*8,ee=Z+be*8;te.set(a.subarray(U,U+8),ee),te[ee+3]*=z,te[ee+4]*=z,te[ee+5]*=z,z<.05&&(te[ee+6]=1)}H.set(X,{start:ie,length:e*8}),Z+=e*8}return te._channelDistributions=H,te}}function qf(a,e,r=!1){if(!e||!a||!a.points)return a;const{safetyZones:i,outputArea:o,transformationEnabled:c,transformationMode:f,flipX:h,flipY:p}=e;let y=a.points;const v=a.isTypedArray||y instanceof Float32Array,x=v?y.length/8:y.length;let b=r?y:v?new Float32Array(y):y.map(S=>({...S}));for(let S=0;S<x;S++){let E,C,_,I,M,N;if(v?(E=b[S*8],C=b[S*8+1],_=b[S*8+3],I=b[S*8+4],M=b[S*8+5],N=b[S*8+6]):(E=b[S].x,C=b[S].y,_=b[S].r,I=b[S].g,M=b[S].b,N=b[S].blanking?1:0),c&&o){let D=(E+1)/2,k=(1-C)/2;f==="crop"?(D<o.x||D>o.x+o.w||k<o.y||k>o.y+o.h)&&(_=0,I=0,M=0,N=1):f==="scale"&&(D=o.x+D*o.w,k=o.y+k*o.h,E=D*2-1,C=1-k*2)}if(i&&i.length>0){let D=(E+1)/2,k=(1-C)/2;for(const G of i)if(D>=G.x&&D<=G.x+G.w&&k>=G.y&&k<=G.y+G.h){_=0,I=0,M=0,N=1;break}}h&&(E=-E),p&&(C=-C),E=Math.max(-1,Math.min(1,E)),C=Math.max(-1,Math.min(1,C)),v?(b[S*8]=E,b[S*8+1]=C,b[S*8+3]=_,b[S*8+4]=I,b[S*8+5]=M,b[S*8+6]=N):(b[S].x=E,b[S].y=C,b[S].r=_,b[S].g=I,b[S].b=M,b[S].blanking=N>.5)}return{...a,points:b,isTypedArray:v}}const cc=.08,H0=4,Y0=.5;function id(a){if(!a)return new Float32Array(0);const e=a instanceof Float32Array||a.isTypedArray,r=e?a.length/8:a.length;if(r>4e3){if(a instanceof Float32Array)return a;const S=new Float32Array(r*8);for(let E=0;E<r;E++){const C=a[E];S[E*8]=C.x,S[E*8+1]=C.y,S[E*8+2]=C.z||0,S[E*8+3]=C.r,S[E*8+4]=C.g,S[E*8+5]=C.b,S[E*8+6]=C.blanking?1:0,S[E*8+7]=C.lastPoint?1:0}return S}const i=[],o=(S,E,C,_,I,M,N)=>{i.push(S,E,C,_,I,M,N?1:0,0)},c=S=>{if(e){const E=S*8;return{x:a[E],y:a[E+1],z:a[E+2],r:a[E+3],g:a[E+4],b:a[E+5],blanking:a[E+6]>.5}}else{const E=a[S];return{x:E.x||0,y:E.y||0,z:E.z||0,r:E.r||0,g:E.g||0,b:E.b||0,blanking:!!E.blanking}}};if(r===0)return new Float32Array(0);let f=c(0);for(let S=0;S<r;S++){const E=c(S),C=E.x-f.x,_=E.y-f.y,I=Math.sqrt(C*C+_*_),M=E.blanking||f.blanking||I>Y0;if(M&&!f.blanking&&(o(f.x,f.y,f.z,0,0,0,!0),o(f.x,f.y,f.z,0,0,0,!0)),I>cc){const N=Math.floor(I/cc);for(let D=1;D<N;D++){const k=D/N,G=f.x+C*k,P=f.y+_*k,q=f.z+(E.z-f.z)*k,Y=M?0:E.r,te=M?0:E.g,H=M?0:E.b,Z=M||E.blanking;o(G,P,q,Y,te,H,Z)}}if(f.blanking!==E.blanking){const N=I<.01?1:H0;for(let D=0;D<N;D++)o(E.x,E.y,E.z,0,0,0,!0)}o(E.x,E.y,E.z,E.r,E.g,E.b,E.blanking),f=E}const h=c(0),p=h.x-f.x,y=h.y-f.y,v=Math.sqrt(p*p+y*y);if(h.blanking||f.blanking||v>Y0){if(o(f.x,f.y,f.z,0,0,0,!0),o(f.x,f.y,f.z,0,0,0,!0),v>cc){const S=Math.floor(v/cc);for(let E=1;E<S;E++){const C=E/S;o(f.x+p*C,f.y+y*C,f.z+(h.z-f.z)*C,0,0,0,!0)}}for(let S=0;S<H0;S++)o(h.x,h.y,h.z,0,0,0,!0)}const b=new Float32Array(i);return a._channelDistributions&&(b._channelDistributions=a._channelDistributions),b}class r1{constructor(e,r){if(this.canvas=e,this.type=r,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.animationFrameId=null,this.frameIndexes=Array(10).fill(0),this.pointIndexes=Array(10).fill(0),this.showBeamEffect=!1,this.beamAlpha=.5,this.fadeAlpha=.13,this.beamRenderMode="both",this.positionBuffer=null,this.colorBuffer=null,this.alphaBuffer=null,this.alphaBufferData=new Float32Array(131072),this.lastPointDrawTime=0,!this.gl){console.error("WebGL not supported");return}this.setup()}setup(){const e=this.gl,r=`
      attribute vec2 aPosition;
      attribute vec3 aColor;
      attribute float aAlpha;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        gl_PointSize = 2.0;
        vColor = aColor;
        vAlpha = aAlpha;
      }
    `,i=`
      precision mediump float;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_FragColor = vec4(vColor, vAlpha);
      }
    `,o=this.createShader(e.VERTEX_SHADER,r),c=this.createShader(e.FRAGMENT_SHADER,i),f=this.createProgram(o,c);this.program=f,this.positionAttributeLocation=e.getAttribLocation(f,"aPosition"),this.colorAttributeLocation=e.getAttribLocation(f,"aColor"),this.alphaAttributeLocation=e.getAttribLocation(f,"aAlpha"),this.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer);const h=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(h),e.STATIC_DRAW),this.quadColorUniformLocation=e.getUniformLocation(f,"uColor"),this.quadAlphaUniformLocation=e.getUniformLocation(f,"uAlpha");const p=`
      attribute vec2 aPosition;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `,y=`
      precision mediump float;
      uniform vec4 uColor;
      void main() {
        gl_FragColor = uColor;
      }
    `,v=this.createShader(e.VERTEX_SHADER,p),x=this.createShader(e.FRAGMENT_SHADER,y);this.fadeProgram=this.createProgram(v,x),this.fadePositionAttributeLocation=e.getAttribLocation(this.fadeProgram,"aPosition"),this.fadeColorUniformLocation=e.getUniformLocation(this.fadeProgram,"uColor"),e.useProgram(f);const b=131072;this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,b*2*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,b*3*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.alphaBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.alphaBuffer),e.bufferData(e.ARRAY_BUFFER,b*1*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1)}reset(){this.frameIndexes.fill(0),this.pointIndexes.fill(0),this.clearCanvas()}createShader(e,r){const i=this.gl,o=i.createShader(e);if(i.shaderSource(o,r),i.compileShader(o),i.getShaderParameter(o,i.COMPILE_STATUS))return o;console.error(i.getShaderInfoLog(o)),i.deleteShader(o)}createProgram(e,r){const i=this.gl,o=i.createProgram();if(i.attachShader(o,e),i.attachShader(o,r),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS))return o;console.error(i.getProgramInfoLog(o)),i.deleteProgram(o)}render(e){e.showBeamEffect!==void 0&&this.setBeamEffect(e.showBeamEffect),e.beamAlpha!==void 0&&this.setBeamAlpha(e.beamAlpha),e.fadeAlpha!==void 0&&this.setFadeAlpha(e.fadeAlpha),e.beamRenderMode!==void 0&&(this.beamRenderMode=e.beamRenderMode),this.type==="world"?this.renderWorld(e.worldData,e.previewScanRate,e.layerIntensities,e.masterIntensity,e.dacSettings,e.previewTime,e.fftLevels,e.optimizationEnabled):this.renderSingle(e.ildaFrames,e.previewScanRate,e.intensity,e.effects,e.syncSettings,e.bpm,e.clipDuration,e.progress,e.previewTime,e.fftLevels,e.effectStates,e.optimizationEnabled)}renderSingle(e,r,i,o,c={},f=120,h=1,p=null,y=null,v={low:0,mid:0,high:0},x=null,b=!0){const S=this.gl;if(S.viewport(0,0,S.canvas.width,S.canvas.height),this.drawFadeQuad(),!e||e.length===0)return;const E=this.frameIndexes[0]%e.length,C=e[E],_=p!==null?p:E/e.length,I=y!==null?y:performance.now();this.draw(C,o,this.showBeamEffect,this.beamAlpha,r,this.beamRenderMode,i,0,_,I,c,f,h,v,x,b),this.frameIndexes[0]++,this.frameIndexes[0]>=e.length&&(this.frameIndexes[0]=0)}renderWorld(e,r,i,o,c,f=null,h={low:0,mid:0,high:0},p=!0){const y=this.gl;y.viewport(0,0,y.canvas.width,y.canvas.height),this.drawFadeQuad();const v=f!==null?f:performance.now();e.forEach(x=>{if(x&&x.frames&&x.frames.length>0){const b=x.frames[0];if(b){const S=x.layerIndex||0;if(x.syncSettings,x.bpm,S>=this.frameIndexes.length){const _=S+5;for(;this.frameIndexes.length<_;)this.frameIndexes.push(0),this.pointIndexes.push(0)}const C=(i[S]!==void 0?i[S]:1)*o;if(C>.001){const _=x.progress!==void 0?x.progress:this.frameIndexes[S]%x.frames.length/x.frames.length,{syncSettings:I={},bpm:M=120,clipDuration:N=1,effectStates:D=null}=x;let k=b;if(c){let G=b;if(c.dimmer!==void 0&&c.dimmer<1){const P=b.points,q=b.isTypedArray||P instanceof Float32Array,Y=q?P.length/8:P.length,te=q?new Float32Array(P):P.map(H=>({...H}));for(let H=0;H<Y;H++)q?(te[H*8+3]*=c.dimmer,te[H*8+4]*=c.dimmer,te[H*8+5]*=c.dimmer):(te[H].r*=c.dimmer,te[H].g*=c.dimmer,te[H].b*=c.dimmer);G={...b,points:te,isTypedArray:t}}k=qf(G,c)}this.draw(k,x.effects,this.showBeamEffect,this.beamAlpha,r,this.beamRenderMode,C,S,_,v,I,M,N,h,D,p)}}}}),e.forEach(x=>{if(x&&x.frames){const b=x.layerIndex||0;this.frameIndexes[b]++,this.frameIndexes[b]>=x.frames.length&&(this.frameIndexes[b]=0)}})}drawFadeQuad(){const e=this.gl;this.fadeProgram&&(e.useProgram(this.fadeProgram),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer),e.enableVertexAttribArray(this.fadePositionAttributeLocation),e.vertexAttribPointer(this.fadePositionAttributeLocation,2,e.FLOAT,!1,0,0),e.uniform4f(this.fadeColorUniformLocation,0,0,0,this.fadeAlpha),e.drawArrays(e.TRIANGLES,0,6))}setBeamEffect(e){this.showBeamEffect=e}setBeamAlpha(e){this.beamAlpha=e}setFadeAlpha(e){this.fadeAlpha=e}draw(e,r,i,o,c,f,h=1,p=0,y=0,v=performance.now(),x={},b=120,S=1,E={low:0,mid:0,high:0},C=null,_=!0){if(this.gl,!e||!e.points)return;let I=e;if(_){const Z=id(e.points);I={...e,points:Z,isTypedArray:!0}}const M=Xl(I,r,{progress:y,time:v,syncSettings:x,bpm:b,clipDuration:S,fftLevels:E,effectStates:C}),N=M.points,D=M.isTypedArray,k=D?N.length/8:N.length;if(k===0)return;const G=Math.max(1,Math.floor(k/c));let P=this.pointIndexes[p]||0;P>=k&&(P=0);const q=Z=>{const W=(P+Z)%k;if(D){const X=W*8;return{x:N[X],y:N[X+1],r:N[X+3],g:N[X+4],b:N[X+5],blanking:N[X+6]===1}}else{const X=N[W];return{x:X.x,y:X.y,r:X.r,g:X.g,b:X.b,blanking:X.blanking}}},Y=()=>{const Z=f==="points"||f==="both",W=f==="lines"||f==="both";let X=[],K=[];for(let F=0;F<G;F++){const z=q(F);if(z.blanking){X.length>0&&(W&&this._drawSegment(new Float32Array(X),new Float32Array(K),1,X.length/2,!1),Z&&this._drawSegment(new Float32Array(X),new Float32Array(K),1,X.length/2,!0),X=[],K=[]);continue}X.push(z.x,z.y),K.push(z.r/255*h,z.g/255*h,z.b/255*h)}X.length>0&&(W&&this._drawSegment(new Float32Array(X),new Float32Array(K),1,X.length/2,!1),Z&&this._drawSegment(new Float32Array(X),new Float32Array(K),1,X.length/2,!0))},te=()=>{const Z=[],W=[];for(let X=0;X<G;X++){const K=q(X);if(!K.blanking){Z.push(0,0,K.x,K.y);const F=[K.r/255*h,K.g/255*h,K.b/255*h];W.push(...F,...F)}}Z.length>0&&this._drawLines(new Float32Array(Z),new Float32Array(W),o,Z.length/2)},H=()=>{const Z=[],W=[];let X=q(0);for(let K=1;K<G;K++){const F=q(K);if(!X.blanking&&!F.blanking){Z.push(0,0,X.x,X.y,F.x,F.y);const z=[X.r/255*h,X.g/255*h,X.b/255*h],ie=[F.r/255*h,F.g/255*h,F.b/255*h],be=[(z[0]+ie[0])/2,(z[1]+ie[1])/2,(z[2]+ie[2])/2],U=.3,ee=[z[0]*U,z[1]*U,z[2]*U],ve=[ie[0]*U,ie[1]*U,ie[2]*U];W.push(...be,...ee,...ve)}X=F}Z.length>0&&this._drawTriangles(new Float32Array(Z),new Float32Array(W),o,Z.length/2)};Y(),i&&(f==="points"?te():f==="lines"?H():f==="both"&&(H(),te())),this.pointIndexes[p]=(P+G)%k}_drawSegment(e,r,i,o,c=!1){const f=this.gl;f.useProgram(this.program),f.bindBuffer(f.ARRAY_BUFFER,this.positionBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,e),f.enableVertexAttribArray(this.positionAttributeLocation),f.vertexAttribPointer(this.positionAttributeLocation,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,r),f.enableVertexAttribArray(this.colorAttributeLocation),f.vertexAttribPointer(this.colorAttributeLocation,3,f.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const h=this.alphaBufferData.subarray(0,o);f.bindBuffer(f.ARRAY_BUFFER,this.alphaBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,h),f.enableVertexAttribArray(this.alphaAttributeLocation),f.vertexAttribPointer(this.alphaAttributeLocation,1,f.FLOAT,!1,0,0),f.drawArrays(c?f.POINTS:f.LINE_STRIP,0,o)}_drawLines(e,r,i,o){const c=this.gl;c.useProgram(this.program),c.bindBuffer(c.ARRAY_BUFFER,this.positionBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,e),c.enableVertexAttribArray(this.positionAttributeLocation),c.vertexAttribPointer(this.positionAttributeLocation,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,r),c.enableVertexAttribArray(this.colorAttributeLocation),c.vertexAttribPointer(this.colorAttributeLocation,3,c.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const f=this.alphaBufferData.subarray(0,o);c.bindBuffer(c.ARRAY_BUFFER,this.alphaBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,f),c.enableVertexAttribArray(this.alphaAttributeLocation),c.vertexAttribPointer(this.alphaAttributeLocation,1,c.FLOAT,!1,0,0),c.drawArrays(c.LINES,0,o)}_drawTriangles(e,r,i,o){const c=this.gl;c.useProgram(this.program),c.bindBuffer(c.ARRAY_BUFFER,this.positionBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,e),c.enableVertexAttribArray(this.positionAttributeLocation),c.vertexAttribPointer(this.positionAttributeLocation,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,r),c.enableVertexAttribArray(this.colorAttributeLocation),c.vertexAttribPointer(this.colorAttributeLocation,3,c.FLOAT,!1,0,0),this.alphaBufferData.length<o&&(this.alphaBufferData=new Float32Array(o*2)),this.alphaBufferData.fill(i,0,o);const f=this.alphaBufferData.subarray(0,o);c.bindBuffer(c.ARRAY_BUFFER,this.alphaBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,f),c.enableVertexAttribArray(this.alphaAttributeLocation),c.vertexAttribPointer(this.alphaAttributeLocation,1,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,o)}clearCanvas(){const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}destroy(){if(cancelAnimationFrame(this.animationFrameId),this.gl){const e=this.gl.getExtension("WEBGL_losing_context");e&&e.loseContext()}}}const Gm=({frame:a,effects:e,width:r=100,height:i=100})=>{const o=T.useRef(null),c=T.useRef(null),[f,h]=T.useState(null);return T.useEffect(()=>(o.current&&!c.current&&(c.current=new r1(o.current,"single")),()=>{c.current&&(c.current.destroy(),c.current=null)}),[]),T.useEffect(()=>{if(!a){h(null);return}let p=a;if(e&&e.length>0){const y=a.points,v=a.isTypedArray||y instanceof Float32Array;let x;v?x=new Float32Array(y):x=y.map(S=>({...S}));const b={...a,points:x,isTypedArray:v};p=Xl(b,e,{time:performance.now(),progress:0,effectStates:new Map})}h(p)},[a,e]),T.useEffect(()=>{c.current&&f?c.current.render({ildaFrames:[f],previewScanRate:1,intensity:1,effects:[],syncSettings:{}}):c.current&&c.current.clearCanvas()},[f]),m.jsx("div",{className:"clip-thumbnail",style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"black"},children:m.jsx("canvas",{ref:o,width:r,height:i,style:{width:"100%",height:"100%",backgroundColor:"black"}})})},s1=({frame:a,bitmap:e,width:r=50,height:i=50})=>{const o=T.useRef(null);return T.useEffect(()=>{const c=o.current;if(!c)return;const f=c.getContext("2d");if(e){f.clearRect(0,0,r,i),f.drawImage(e,0,0,r,i);return}if(!a||!a.points)return;f.fillStyle="#000000",f.fillRect(0,0,r,i);const h=a.points,p=a.isTypedArray||h instanceof Float32Array,y=p?h.length/8:h.length;f.lineWidth=1.5,f.lineCap="round";let v=null,x=null;for(let b=0;b<y;b++){let S,E,C,_,I,M;if(p)S=h[b*8],E=h[b*8+1],C=h[b*8+3],_=h[b*8+4],I=h[b*8+5],M=h[b*8+6]>.5;else{const k=h[b];S=k.x,E=k.y,C=k.r,_=k.g,I=k.b,M=k.blanking}const N=(S+1)*.5*r,D=(1-(E+1)*.5)*i;if(M){v=null,x=null;continue}else if(v!==null){f.beginPath(),f.moveTo(v,x),f.lineTo(N,D);const k=Math.floor(Math.max(0,Math.min(255,C))),G=Math.floor(Math.max(0,Math.min(255,_))),P=Math.floor(Math.max(0,Math.min(255,I)));f.strokeStyle=`rgb(${k},${G},${P})`,f.stroke()}v=N,x=D}},[a,r,i]),m.jsx("canvas",{ref:o,width:r,height:i,style:{width:"50px",height:"50px",backgroundColor:"black",display:"block",borderRadius:"5px"}})},ld=ha.memo(s1),i1=({layerName:a,index:e,onDropEffect:r,onDropDac:i,layerEffects:o,activeClipData:c,onDeactivateLayerClips:f,onShowLayerFullContextMenu:h,thumbnailRenderMode:p,intensity:y,onIntensityChange:v,liveFrame:x,isBlackout:b,isSolo:S,onToggleBlackout:E,onToggleSolo:C,onLayerSelect:_})=>{const[I,M]=T.useState(o||[]),[N,D]=T.useState(!1),[k,G]=T.useState(!1);T.useEffect(()=>{M(o||[])},[o]);const P=T.useMemo(()=>[...c?.effects||[],...o||[]],[c?.effects,o]),q=(X,K,F,z,ie)=>{X.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:K,paramName:F,targetType:z,layerIndex:e,label:ie}))},Y=X=>{X.preventDefault(),console.log(`Right-clicked LayerControls at index: ${e}`),h&&h(e)},te=X=>{X.preventDefault(),X.stopPropagation(),D(!0),X.dataTransfer.dropEffect="copy"},H=X=>{X.preventDefault(),X.stopPropagation(),D(!1)},Z=X=>{X.preventDefault(),X.stopPropagation(),D(!1);const K=X.dataTransfer.getData("application/json");if(K)try{const z=JSON.parse(K);if(z.type==="transform"||z.type==="animation"||z.type==="color"||z.type==="effect"){if(r){r(z.id||z.name);return}}else if(z.ip&&(typeof z.channel=="number"||z.allChannels)&&i){i(e,z);return}}catch(z){console.error("Error parsing drop data in LayerControls:",z)}const F=X.dataTransfer.getData("text/plain");if(F.startsWith("effect_")){const z=F.replace("effect_","");r&&r(z)}},W=p==="active"||p==="hover"&&k;return m.jsxs("div",{className:`layer-controls ${N?"dragging":""}`,onContextMenu:Y,onDragOver:te,onDragLeave:H,onDrop:Z,children:[m.jsxs("div",{className:"grid-layer",children:[m.jsx(rn,{id:`layer_${e}_clear`,children:m.jsx("span",{className:"layer-control-button full-height",onClick:()=>f(e),draggable:!0,onDragStart:X=>q(X,"toggle","clear","layer",`L${e+1} Clear`),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),m.jsxs("div",{className:"layer-control-group",children:[m.jsx(rn,{id:`layer_${e}_blackout`,children:m.jsx("span",{className:"layer-control-button half-height",onClick:E,style:{backgroundColor:b?"red":""},draggable:!0,onDragStart:X=>q(X,"toggle","blackout","layer",`L${e+1} Blackout`),children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),m.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),m.jsx(rn,{id:`layer_${e}_solo`,children:m.jsx("span",{className:"layer-control-button half-height",onClick:C,style:{backgroundColor:S?"var(--theme-color)":"",color:S?"black":""},draggable:!0,onDragStart:X=>q(X,"toggle","solo","layer",`L${e+1} Solo`),children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-1-square",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M9.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z"}),m.jsx("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"})]})})})]}),m.jsxs("select",{className:"layer-blend-dropdown",children:[m.jsx("option",{children:"Normal"}),m.jsx("option",{children:"Add"}),m.jsx("option",{children:"Subtract"})]})]}),m.jsx("div",{className:"layer-control-row",children:m.jsx(rn,{id:`layer_${e}_intensity`,children:m.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:y,className:"slider_ver",id:"layer-intensity-slider",onChange:X=>v(parseFloat(X.target.value))})})}),m.jsx("div",{className:"layer-preview-thumbnail",onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),style:{overflow:"hidden"},children:c?W?m.jsx(Gm,{frame:x||c.stillFrame,effects:P}):c.thumbnailPath?m.jsx("img",{src:`file://${c.thumbnailPath}?t=${c.thumbnailVersion||Date.now()}`,alt:"layer-thumbnail",style:{width:"100%",height:"100%",objectFit:"contain"}}):m.jsx(ld,{frame:c.stillFrame}):I.length>0&&m.jsx("div",{className:"applied-effects",children:I.map((X,K)=>m.jsx("span",{className:"effect-tag",children:(X.name||X.id||"???").substring(0,3).toUpperCase()},X.instanceId||K))})}),m.jsx("span",{className:"layer-name-label",onClick:()=>_&&_(e),children:a})]})},l1=({clipName:a,layerIndex:e,colIndex:r,onDropGenerator:i,onDropEffect:o,clipContent:c,thumbnailFrameIndex:f,onUnsupportedFile:h,onActivateClick:p,onLabelClick:y,isSelected:v,isActive:x,ildaParserWorker:b,onDropDac:S,thumbnailRenderMode:E,liveFrame:C,stillFrame:_,onClipHover:I,onThumbnailError:M})=>{const[N,D]=T.useState(!1),[k,G]=T.useState(!1),P=a,q=E==="active"||E==="hover"&&N,Y=ie=>{ie.preventDefault(),ie.stopPropagation(),G(!0),ie.dataTransfer.dropEffect="copy"},te=ie=>{ie.preventDefault(),ie.stopPropagation(),ie.currentTarget.contains(ie.relatedTarget)||G(!1)},H=()=>{D(!0),I&&I(e,r,!0)},Z=()=>{D(!1),p(!1),I&&I(e,r,!1)},W=async ie=>{const be=ie.name;if(!b){h("ILDA parser not available.");return}if(be.toLowerCase().endsWith(".ild"))try{const U=await ie.arrayBuffer();console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFileDrop): ${U.byteLength}`),b.postMessage({type:"parse-ilda",arrayBuffer:U,fileName:be,filePath:ie.path,layerIndex:e,colIndex:r},[U])}catch(U){console.error("[Clip.jsx] handleFileDrop - Error reading file:",U),h(`Error reading file: ${U.message}`)}else h("Please drop a valid .ild file")},X=async(ie,be)=>{if(!be.toLowerCase().endsWith(".ild")){console.log("Unsupported file type:",be),h("Please drop a valid .ild file");return}if(!b){h("ILDA parser not available.");return}try{if(window.electronAPI&&window.electronAPI.readFileAsBinary){const U=await window.electronAPI.readFileAsBinary(ie);if(!U||!(U instanceof ArrayBuffer)){console.error("[Clip.jsx] readFileAsBinary did not return an ArrayBuffer:",U),h("Error reading file: Invalid data format received.");return}console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFilePathDrop): ${U.byteLength}`),b.postMessage({type:"parse-ilda",arrayBuffer:U,fileName:be,filePath:ie,layerIndex:e,colIndex:r},[U])}else h("Binary file access not available")}catch(U){console.error("Error processing file path:",U),console.error("Error stack:",U.stack),h(`Error processing file: ${U.message}`)}},K=ie=>{ie.preventDefault(),ie.stopPropagation(),G(!1);const be=ie.dataTransfer.getData("application/json");if(be)try{const ee=JSON.parse(be);if(ee.filePath&&ee.fileName){X(ee.filePath,ee.fileName);return}if(ee.type==="transform"||ee.type==="animation"||ee.type==="color"||ee.type==="effect"){if(o){o(ee),y();return}}else if(ee.ip&&(typeof ee.channel=="number"||ee.allChannels)){if(S){S(e,r,ee);return}}else if(ee.name&&i){i(e,r,ee);return}}catch(ee){console.error("Error parsing dropped data:",ee)}const U=ie.dataTransfer.files;if(U&&U.length>0){W(U[0]);return}console.log("No recognized data format found in drop"),h("No valid ILD file, effect, or generator dropped.")},F=ie=>{ie.preventDefault(),ie.stopPropagation()},z=ie=>{ie.preventDefault(),window.electronAPI&&window.electronAPI.showClipContextMenu&&window.electronAPI.showClipContextMenu(e,r,c?.triggerStyle||"normal")};return m.jsxs("div",{className:`clip ${k?"dragging":""} ${x?"active-clip":""} `,onDragEnter:F,onDragOver:Y,onDragLeave:te,onDrop:K,onContextMenu:z,children:[m.jsx(rn,{id:`clip_${e}_${r}`,children:m.jsx("div",{className:"clip-thumbnail",onMouseDown:ie=>{ie.button===0&&p(!0)},onMouseUp:ie=>{ie.button===0&&p(!1)},onMouseEnter:H,onMouseLeave:Z,style:{overflow:"hidden"},children:c&&c.parsing?m.jsx("div",{className:"clip-loading-spinner"}):m.jsxs(m.Fragment,{children:[q&&c?m.jsx(Gm,{frame:C||_,effects:c?.effects}):c?.thumbnailPath?m.jsx("img",{src:`file://${c.thumbnailPath}?t=${c.thumbnailVersion||Date.now()}`,alt:"thumbnail",onError:()=>M&&M(e,r),style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"}}):_&&m.jsx(ld,{frame:_}),c?.triggerStyle&&c.triggerStyle!=="normal"&&m.jsxs("p",{className:"clip_icons",children:[c.triggerStyle==="toggle"&&m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-toggles",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7"})}),c.triggerStyle==="flash"&&m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-lightning-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"})})]})]})})}),m.jsx(rn,{id:`clip_${e}_${r}_preview`,children:m.jsx("span",{className:`clip-label ${v?"selected-clip":""}`,onClick:y,children:P})})]})},o1=ha.memo(l1),Hm=T.createContext(null),Ym=()=>T.useContext(Hm),c1=({children:a})=>{const[e,r]=T.useState(null);return T.useEffect(()=>{if(!e){const i=new Worker(new URL(""+new URL("ilda-parser.worker-XXY4JEks.js",import.meta.url).href,import.meta.url));r(i)}return()=>{e&&e.terminate()}},[e]),m.jsx(Hm.Provider,{value:e,children:a})},u1=({onDropIld:a,viewMode:e="list",onViewModeChange:r,path:i,onPathChange:o})=>{const[c,f]=T.useState([]),[h,p]=T.useState({}),[y,v]=T.useState(new Set),x=Ym(),b=T.useRef(new Set),S=T.useRef([]),E=T.useRef(!1),C=i,_=o,I=T.useCallback(()=>{if(E.current||S.current.length===0||!x)return;E.current=!0;const N=S.current.shift(),D=N.split(/[/\\]/).pop();x.postMessage({type:"load-and-parse-ilda",fileName:D,filePath:N,browserFile:!0,stopAtFirstFrame:!0})},[x]);T.useEffect(()=>{if(!x)return;const N=D=>{D.data.browserFile&&(D.data.type==="parse-ilda"?D.data.success?x.postMessage({type:"get-frame",workerId:D.data.workerId,frameIndex:0,browserFile:!0,filePath:D.data.filePath}):(console.warn(`[FileBrowser] Skipping invalid ILDA file: ${D.data.filePath}. Reason: ${D.data.error}`),v(k=>new Set(k).add(D.data.filePath)),E.current=!1,I()):D.data.type==="get-frame"&&(D.data.success&&p(k=>({...k,[D.data.filePath]:D.data.bitmap||D.data.frame})),E.current=!1,I()))};return x.addEventListener("message",N),()=>x.removeEventListener("message",N)},[x,I]),T.useEffect(()=>{if(e==="thumbnails"&&c.length>0&&x){let N=!1;c.forEach(D=>{!h[D]&&!b.current.has(D)&&(b.current.add(D),S.current.push(D),N=!0)}),N&&!E.current&&I()}},[e,c,x,h,I]),T.useEffect(()=>{(async()=>{if(i){const D=await window.electronAPI.readIldFiles(i);f(D),b.current.clear(),S.current=[],E.current=!1,p({});return}if(window.electronAPI&&window.electronAPI.getUserIldaPath){const D=await window.electronAPI.getUserIldaPath();if(D){_(D);const k=await window.electronAPI.readIldFiles(D);f(k),b.current.clear(),S.current=[],E.current=!1,p({})}}})()},[i]);const M=async()=>{if(window.electronAPI){const N=await window.electronAPI.openFileExplorer();if(N){_(N);const D=await window.electronAPI.readIldFiles(N);f(D),b.current.clear(),S.current=[],E.current=!1,p({})}}};return m.jsxs("div",{className:"file-browser",children:[m.jsx("button",{onClick:M,children:"Open Folder"}),m.jsxs("div",{className:"list_switcher",children:[m.jsx("button",{className:e==="list"?"active":"",onClick:()=>r&&r("list"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-list",viewBox:"0 0 16 16",children:m.jsx("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"})})}),m.jsx("button",{className:e==="thumbnails"?"active":"",onClick:()=>r&&r("thumbnails"),children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),m.jsx("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})]})})]}),C&&m.jsxs("p",{className:"fileBrowser",children:["Selected Directory: ",C.split(/[/\\]/).filter(Boolean).pop()]}),m.jsx("div",{className:"ild-file-grid",style:{display:e==="thumbnails"?null:"none"},children:c.filter(N=>!y.has(N)).length>0?c.filter(N=>!y.has(N)).map((N,D)=>{const k=N.split(/[/\\]/).pop(),G=h[N];return m.jsxs("div",{className:"ild-file-preview",draggable:!0,onDragStart:P=>P.dataTransfer.setData("application/json",JSON.stringify({filePath:N,fileName:k})),children:[m.jsx("div",{className:"file_thumbnail",children:G?m.jsx(ld,{bitmap:G instanceof ImageBitmap?G:null,frame:G instanceof ImageBitmap?null:G}):m.jsx("div",{className:"clip-loading-spinner"})}),m.jsx("div",{className:"file_name",children:k})]},D)}):m.jsx("p",{children:"No valid ILD files found in selected directory."})}),m.jsx("div",{className:"ild-file-list",style:{display:e==="list"?null:"none"},children:c.filter(N=>!y.has(N)).length>0?c.filter(N=>!y.has(N)).map((N,D)=>{const k=N.split(/[/\\]/).pop();return m.jsx("div",{className:"ild-file-item",draggable:!0,onDragStart:G=>G.dataTransfer.setData("application/json",JSON.stringify({filePath:N,fileName:k})),children:k},D)}):m.jsx("p",{children:"No valid ILD files found in selected directory."})})]})},Vf=[{id:"circle",name:"Circle",description:"Generates a simple circle.",defaultParams:{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"radius",label:"Radius",type:"range",min:.01,max:1,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:3,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"square",name:"Square",description:"Generates a simple square.",defaultParams:{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"width",label:"Width",type:"range",min:.01,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"line",name:"Line",description:"Generates a straight line.",defaultParams:{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"x1",label:"X1",type:"range",min:-1,max:1,step:.01},{id:"y1",label:"Y1",type:"range",min:-1,max:1,step:.01},{id:"x2",label:"X2",type:"range",min:-1,max:1,step:.01},{id:"y2",label:"Y2",type:"range",min:-1,max:1,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:2,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"text",name:"Text",description:"Generates text.",defaultParams:{text:"TrueLazer",x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"text",label:"Text Content",type:"text"},{id:"fontUrl",label:"Fonts",type:"text"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:300,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"star",name:"Star",description:"Generates a star shape.",defaultParams:{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"outerRadius",label:"Outer Radius",type:"range",min:.01,max:1,step:.01},{id:"innerRadius",label:"Inner Radius",type:"range",min:.01,max:1,step:.01},{id:"numSpikes",label:"Number of Spikes",type:"range",min:3,max:20,step:1},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:20,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"ndi-source",name:"NDI Source",description:"Placeholder for NDI Video Input.",defaultParams:{sourceName:"No Source",threshold:128,edgeDetection:!1,captureWidth:640,captureHeight:360,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Source Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"spout-receiver",name:"Spout Receiver",description:"Placeholder for Spout Video Input.",defaultParams:{sourceName:"Spout Input",threshold:128,edgeDetection:!1,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Sender Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"sinewave",name:"Sine Wave",description:"Generates a customizable sine wave.",defaultParams:{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:0,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:.1,max:10,step:.1},{id:"phase",label:"Phase",type:"range",min:0,max:Math.PI*2,step:.01},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:10,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:a=>a.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:a=>a.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]}],f1=()=>{const[a,e]=T.useState([]);T.useEffect(()=>{const o=async()=>{if(window.electronAPI&&window.electronAPI.ndiFindSources){const f=await window.electronAPI.ndiFindSources();e(f||[])}};o();const c=setInterval(o,5e3);return()=>clearInterval(c)},[]);const r=(o,c)=>{o.dataTransfer.setData("application/json",JSON.stringify(c))},i=(o,c)=>{const f=Vf.find(p=>p.id==="ndi-source"),h={...f,defaultParams:{...f.defaultParams,sourceName:c.name}};o.dataTransfer.setData("application/json",JSON.stringify(h))};return m.jsxs("div",{className:"generator-panel",children:[m.jsx("div",{className:"generator-list",children:Vf.filter(o=>o.id!=="ndi-source"&&o.id!=="spout-receiver").map(o=>m.jsx("div",{className:"generator-item",draggable:!0,onDragStart:c=>r(c,o),children:o.name},o.id))}),m.jsx("h3",{style:{marginTop:"10px"},children:"NDI Sources"}),m.jsx("div",{className:"generator-list",children:a.length>0?a.map((o,c)=>m.jsx("div",{className:"generator-item ndi-item",draggable:!0,onDragStart:f=>i(f,o),children:o.name},`${o.name}-${c}`)):m.jsx("div",{className:"empty-msg",children:"No NDI sources found"})})]})},d1=()=>{const a=(e,r)=>{e.dataTransfer.setData("application/json",JSON.stringify(r))};return m.jsx("div",{className:"effect-panel",children:Yi.map(e=>m.jsx("div",{draggable:!0,onDragStart:r=>a(r,e),className:"effect-item",children:e.name},e.id))})},ri=({value:a,onChange:e,label:r,onDrop:i,size:o=40,isAssigned:c,className:f,...h})=>{const p=T.useRef(null),y=S=>{i&&(S.preventDefault(),S.dataTransfer.dropEffect="link")},v=S=>{if(i){S.preventDefault();try{const E=S.dataTransfer.getData("application/x-truelazer-param");console.log("[RadialKnob] Dropped Data Raw:",E);const C=JSON.parse(E);console.log("[RadialKnob] Dropped Data Parsed:",C),C&&(C.type==="range"||C.type==="number")?i(C):console.warn("[RadialKnob] Invalid data type for knob:",C?.type)}catch(E){console.error("[RadialKnob] Drop Error:",E)}}},x=-135+a*270,b=S=>{if(!c||S.button!==0)return;S.preventDefault();const E=S.clientY,C=a,_=M=>{const D=(E-M.clientY)/200;let k=Math.max(0,Math.min(1,C+D));e(k)},I=()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",I)};window.addEventListener("mousemove",_),window.addEventListener("mouseup",I)};return T.useEffect(()=>{const S=p.current;if(!S)return;const E=C=>{if(!c)return;C.preventDefault(),C.stopPropagation();const _=C.deltaY*-.001;let I=Math.max(0,Math.min(1,a+_));e(I)};return S.addEventListener("wheel",E,{passive:!1}),()=>{S.removeEventListener("wheel",E)}},[a,e,c]),m.jsxs("div",{className:`quick-assign-knob ${c?"":"unassigned"} ${f||""}`.trim(),ref:p,style:{cursor:c?"ns-resize":"default",userSelect:"none",opacity:c?1:.5},onDragOver:y,onDrop:v,onMouseDown:b,...h,children:[m.jsx("div",{className:"knob-label",title:r,children:r}),m.jsx("div",{className:"knob-circle",children:m.jsx("div",{className:"knob-indicator",style:{transform:`rotate(${x}deg)`}})}),m.jsxs("div",{className:"knob-value",style:{fontSize:"9px",color:"#888",marginTop:"2px"},children:[Math.round(a*100),"%"]})]})},p1=({dacs:a=[],onDacSelected:e,onDacsDiscovered:r,dacSettings:i={},onUpdateDacSettings:o})=>{const[c,f]=T.useState(!1),[h,p]=T.useState(null),[y,v]=T.useState([]),[x,b]=T.useState(null),S=ha.useRef(!1);T.useEffect(()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(M=>{v(M),M.length>0&&b(M[0])})},[]),T.useEffect(()=>{c&&!S.current&&(S.current=!0,console.log("Starting DAC scan on:",x?.address),window.electronAPI?window.electronAPI.discoverDacs(2e3,x?.address).then(async M=>{console.log("DACs discovered:",M);const N=await Promise.all(M.map(async D=>{try{const k=await window.electronAPI.getDacServices(D.ip,x?.address,D.type),G=D.type&&D.type.toLowerCase()==="etherdream"?k:k.filter(P=>P.serviceID!==0);return{...D,channels:G}}catch(k){return console.error(`Error fetching services for DAC ${D.ip}:`,k),{...D,channels:[]}}}));r&&r(N)}).catch(M=>{console.error("Error discovering DACs:",M)}).finally(()=>{f(!1),S.current=!1}):(console.warn("electronAPI is not available. Cannot discover DACs."),f(!1),S.current=!1))},[c,x,r]);const E=(M,N)=>{const D={...M,channel:N};p(D),e&&e(D)},C=(M,N,D)=>{M.stopPropagation();const k={...N,channel:D};M.dataTransfer.setData("application/json",JSON.stringify(k))},_=M=>{const N=M.target.value,D=y.find(k=>k.address===N);b(D)},I=(M,N)=>{M.stopPropagation();const D={...N,allChannels:!0};M.dataTransfer.setData("application/json",JSON.stringify(D))};return m.jsxs("div",{className:"dac-panel",children:[m.jsx("div",{className:"settings-card-header",children:m.jsx("h4",{children:"DACs"})}),m.jsxs("div",{className:"network-interface-selector",style:{display:"flex",gap:5,padding:"5px 10px"},children:[m.jsxs("div",{style:{flex:1,display:"flex"},children:[m.jsx("select",{onChange:_,value:x?.address||"",style:{width:"100%",height:"100%",background:"#2a2a2a",color:"#aaa",borderRadius:"5px",cursor:"pointer",marginBottom:2},children:y.map(M=>m.jsxs("option",{value:M.address,children:[M.name," (",M.address,")"]},M.address))}),m.jsx("button",{onClick:()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(M=>{v(M),M.length>0&&!x&&b(M[0])})},style:{fontSize:"9px",padding:"2px",background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",borderRadius:"5px"},children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-clockwise",viewBox:"0 0 16 16",children:[m.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"}),m.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"})]})})]}),m.jsx("label",{style:{display:"flex",alignItems:"center",fontSize:"10px"},children:m.jsx("input",{type:"checkbox",checked:c,onChange:M=>f(M.target.checked),disabled:c,style:{height:"100%"}})})]}),m.jsx("div",{className:"dac-list",children:a.map(M=>m.jsxs("div",{className:"dac-group",draggable:!0,onDragStart:N=>I(N,M),children:[m.jsxs("div",{className:"dac-ip",children:[M.hostName||M.ip," (",M.ip,")"]}),m.jsx("div",{className:"dac-channels",children:M.channels&&M.channels.length>0?M.channels.map(N=>m.jsxs("div",{className:`dac-channel-item ${h&&(h.unitID===M.unitID||h.ip===M.ip)&&h.channel===N.serviceID?"selected":""}`,onClick:()=>E(M,N.serviceID),draggable:!0,onDragStart:D=>C(D,M,N.serviceID),children:["Channel ",N.serviceID," (",N.name,")"]},`${M.unitID||M.ip}-${N.serviceID}`)):m.jsx("div",{className:"dac-channel-item no-channels",children:"No channels found"})})]},M.unitID||M.ip))}),a.length>0&&m.jsxs("div",{className:"dac-dimmers-section",children:[m.jsx("h4",{children:"Channel Dimmers"}),m.jsx("div",{className:"dac-dimmers-grid",children:a.flatMap(M=>(M.channels||[]).map(N=>({dac:M,ch:N}))).map(({dac:M,ch:N})=>{const D=`${M.ip}:${N.serviceID}`,k=i[D]||{},G=k.dimmer!==void 0?k.dimmer:1;return m.jsx(rn,{id:`dimmer_${D.replace(/\./g,"_")}`,children:m.jsx(ri,{label:`${M.hostName||M.ip} Ch${N.serviceID}`,value:G,onChange:P=>{o&&o(D,{...k,dimmer:P})}})},`dimmer_${D}`)})})]})]})},qm=({min:a,max:e,step:r,value:i,rangeValue:o,onChange:c,onRangeChange:f,showRange:h=!1,disabled:p=!1,animSettings:y,progressRef:v,workerId:x,clipDuration:b,bpm:S,getFftLevels:E})=>{const C=T.useRef(null),_=T.useRef(null),I=T.useRef(null),[M,N]=T.useState(null),D=a!==void 0?a:0,k=e!==void 0?e:1,G=o&&o[0]!==void 0?o[0]:D,P=o&&o[1]!==void 0?o[1]:k,q=i!==void 0?i:D,Y=H=>{const Z=k-D;return Z===0?0:(H-D)/Z*100};T.useEffect(()=>{let H;const Z=()=>{if(M==="value"){H=requestAnimationFrame(Z);return}let W=q;if(y&&y.syncMode&&v&&v.current){const F={progress:x&&v.current[x]!==void 0?v.current[x]:0,time:performance.now(),clipDuration:b||1,bpm:S||120,fftLevels:E?E():{low:0,mid:0,high:0}};W=bc(null,q,y,F,D,k)}const X=Y(W);_.current&&(_.current.style.left=`${X}%`),I.current&&(I.current.style.width=`${X}%`),H=requestAnimationFrame(Z)};return H=requestAnimationFrame(Z),()=>cancelAnimationFrame(H)},[y,v,x,q,M,D,k,S,E,b]);const te=(H,Z)=>{if(p)return;H.preventDefault(),H.stopPropagation(),N(Z);const W=K=>{if(!C.current)return;const F=C.current.getBoundingClientRect(),z=K.clientX-F.left;let ie=Math.max(0,Math.min(100,z/F.width*100)),be=D+ie/100*(k-D);r&&(be=Math.round(be/r)*r,ie=(be-D)/(k-D)*100),Z==="value"?(be=Math.max(G,Math.min(P,be)),_.current&&(_.current.style.left=`${Y(be)}%`),I.current&&!h&&(I.current.style.width=`${Y(be)}%`),c&&c(be)):Z==="min"?(be=Math.max(D,Math.min(P,be)),f&&f([be,P])):Z==="max"&&(be=Math.max(G,Math.min(k,be)),f&&f([G,be]))},X=()=>{N(null),window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",X)};window.addEventListener("mousemove",W),window.addEventListener("mouseup",X)};return m.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:m.jsxs("div",{className:"range-slider-track",ref:C,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[h&&m.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:`${Y(G)}%`,width:`${Y(P)-Y(G)}%`}}),!h&&m.jsx("div",{className:"value-slider-fill",ref:I,style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:"0%",borderRadius:"2px"}}),h&&m.jsx("div",{className:"range-slider-handle min-handle",style:{left:`${Y(G)}%`},onMouseDown:H=>te(H,"min"),title:`Min: ${G.toFixed(2)}`}),h&&m.jsx("div",{className:"range-slider-handle max-handle",style:{left:`${Y(P)}%`},onMouseDown:H=>te(H,"max"),title:`Max: ${P.toFixed(2)}`}),m.jsx("div",{className:"range-slider-handle value-handle",ref:_,style:{position:"absolute",width:"6px",height:"16px",top:"-50%",transform:"translate(-50%, -25%)",cursor:"pointer",zIndex:20,boxShadow:"0 0 2px rgba(0,0,0,0.5)"},onMouseDown:H=>te(H,"value"),title:`Value: ${q.toFixed(2)}`})]})})},la=({title:a,children:e,icon:r,defaultCollapsed:i=!1,headerActions:o,onToggle:c,isCollapsed:f,dragHandle:h})=>{const[p,y]=T.useState(i),v=c!==void 0?f:p,x=()=>{c?c(!v):y(!v)};return m.jsxs("div",{className:`settings-card ${v?"collapsed":""}`,children:[m.jsxs("div",{className:"settings-card-header",onClick:x,style:{userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer",flex:1,overflow:"hidden"},children:[h&&m.jsx("div",{onClick:b=>b.stopPropagation(),style:{display:"flex",alignItems:"center"},children:h}),m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",style:{transform:v?"rotate(0deg)":"rotate(90deg)",transition:"transform 0.2s",flexShrink:0},children:m.jsx("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})}),r&&m.jsx("span",{className:`bi ${r}`,style:{flexShrink:0}}),m.jsx("h4",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",margin:0},children:a})]}),o&&m.jsx("div",{onClick:b=>b.stopPropagation(),style:{flexShrink:0,marginLeft:"5px"},children:o})]}),!v&&m.jsx("div",{className:"settings-card-content",children:e})]})},Vm=({animSettings:a,onChange:e})=>{const{direction:r="forward",style:i="loop",syncMode:o=null,duration:c=1,beats:f=8,speedMultiplier:h=1}=a||{},p=(v,x)=>e({...a,[v]:x}),y=(v,x,b=!1)=>{let E=a?.[v]||(v==="beats"?8:1);b?E=x>1?E*2:E/2:E+=x,E<.01&&(E=.01),!b&&v!=="beats"&&(E=Math.round(E*100)/100),p(v,E)};return m.jsxs("div",{className:"anim-controls-container",children:[m.jsxs("div",{className:"anim-row controls-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"5px"},children:[m.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:`speed-control-button ${r==="backward"?"active":""}`,onClick:()=>p("direction","backward"),title:"Backward",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",transform:"scale(-1 1)",children:m.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})}),m.jsx("button",{className:`speed-control-button ${r==="pause"?"active":""}`,onClick:()=>p("direction","pause"),title:"Pause",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsx("svg",{width:"25",height:"20",viewBox:"0 0 16 16",className:"icon flat-color",children:m.jsx("path",{d:"M3 1h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m7 0h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m0 0"})})}),m.jsx("button",{className:`speed-control-button ${r==="forward"?"active":""}`,onClick:()=>p("direction","forward"),title:"Forward",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",children:m.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})})]}),m.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:`speed-control-button ${i==="once"?"active":""}`,onClick:()=>p("style","once"),title:"Once",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[m.jsx("path",{d:"M43.8233 25.2305C43.7019 25.9889 43.5195 26.727 43.2814 27.4395 42.763 28.9914 41.9801 30.4222 40.9863 31.6785 38.4222 34.9201 34.454 37 30 37H16C9.39697 37 4 31.6785 4 25 4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M24 19V31",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M24 19 21 22 19.5 23.5",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsx("button",{className:`speed-control-button ${i==="bounce"?"active":""}`,onClick:()=>p("style","bounce"),title:"Bounce",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[m.jsx("path",{d:"M42 19H5.99998",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M30 7 42 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M6.79897 29H42.799",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M6.79895 29 18.799 41",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsx("button",{className:`speed-control-button ${i==="loop"?"active":""}`,onClick:()=>p("style","loop"),title:"Loop",style:{flex:1,padding:0,fontSize:"10px"},children:m.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[m.jsx("path",{d:"M4 25C4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M44 23C44 29.6498 38.6038 35 32 35H4",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M10 41 4 35 10 29",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),m.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:`speed-control-button ${o==="fps"?"active":""}`,onClick:()=>p("syncMode",o==="fps"?null:"fps"),style:{flex:1,padding:0,fontSize:"10px"},children:"F"}),m.jsx("button",{className:`speed-control-button ${o==="timeline"?"active":""}`,onClick:()=>p("syncMode",o==="timeline"?null:"timeline"),style:{flex:1,padding:0,fontSize:"10px"},children:"T"}),m.jsx("button",{className:`speed-control-button ${o==="bpm"?"active":""}`,onClick:()=>p("syncMode",o==="bpm"?null:"bpm"),style:{flex:1,padding:0,fontSize:"10px"},children:"B"}),m.jsx("button",{className:`speed-control-button ${o==="fft"?"active":""}`,onClick:()=>p("syncMode",o==="fft"?null:"fft"),style:{flex:1,padding:0,fontSize:"10px"},children:"FFT"})]})]}),o==="fft"&&m.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:m.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[m.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Range"}),m.jsxs("select",{value:a?.fftRange||"low",onChange:v=>p("fftRange",v.target.value),style:{fontSize:"10px",background:"#333",border:"1px solid #555",color:"white"},children:[m.jsx("option",{value:"low",children:"Low"}),m.jsx("option",{value:"mid",children:"Mid"}),m.jsx("option",{value:"high",children:"High"})]})]})}),o==="timeline"&&m.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:m.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[m.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Duration (s)"}),m.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:"tiny-btn",onClick:()=>y("duration",-1),children:"-1"}),m.jsx("input",{type:"number",value:typeof c=="number"?c.toFixed(2):c,onChange:v=>p("duration",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("duration",1),children:"+1"}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("duration",.5,!0),children:"/2"}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("duration",2,!0),children:"*2"})]})]})}),o==="bpm"&&m.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:m.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[m.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Beats"}),m.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:"tiny-btn",onClick:()=>y("beats",-1),children:"-1"}),m.jsx("input",{type:"number",value:f,onChange:v=>p("beats",parseInt(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("beats",1),children:"+1"}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("beats",.5,!0),children:"/2"}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("beats",2,!0),children:"*2"})]})]})}),(o==="timeline"||o==="bpm"||o==="fps")&&m.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:m.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[m.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Speed"}),m.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[m.jsx("button",{className:"tiny-btn",onClick:()=>y("speedMultiplier",-.1),children:"-0.1"}),m.jsx("input",{type:"number",value:typeof h=="number"?h.toFixed(2):h,onChange:v=>p("speedMultiplier",parseFloat(v.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),m.jsx("button",{className:"tiny-btn",onClick:()=>y("speedMultiplier",.1),children:"+0.1"})]})]})})]})},zl=(a,e,r)=>{let i,o,c;const f=Math.floor(a*6),h=a*6-f,p=r*(1-e),y=r*(1-h*e),v=r*(1-(1-h)*e);switch(f%6){case 0:i=r,o=v,c=p;break;case 1:i=y,o=r,c=p;break;case 2:i=p,o=r,c=v;break;case 3:i=p,o=y,c=r;break;case 4:i=v,o=p,c=r;break;case 5:i=r,o=p,c=y;break}const x=b=>{const S=Math.round(b*255).toString(16);return S.length===1?"0"+S:S};return`#${x(i)}${x(o)}${x(c)}`},q0=a=>{let e=parseInt(a.slice(1,3),16)/255,r=parseInt(a.slice(3,5),16)/255,i=parseInt(a.slice(5,7),16)/255,o=Math.max(e,r,i),c=Math.min(e,r,i),f,h,p=o,y=o-c;if(h=o===0?0:y/o,o===c)f=0;else{switch(o){case e:f=(r-i)/y+(r<i?6:0);break;case r:f=(i-e)/y+2;break;case i:f=(e-r)/y+4;break}f/=6}return{h:f,s:h,v:p}},V0=({color:a="#ffffff",onChange:e})=>{const r=T.useRef(null),[i,o]=T.useState(()=>q0(a)),[c,f]=T.useState(!1);T.useEffect(()=>{const v=q0(a);zl(v.h,v.s,v.v)!==zl(i.h,i.s,i.v)&&o(v)},[a]);const h=T.useCallback(()=>{const v=r.current;if(!v)return;const x=v.getContext("2d"),b=v.width,S=v.height;x.fillStyle=zl(i.h,1,1),x.fillRect(0,0,b,S);const E=x.createLinearGradient(0,0,b,0);E.addColorStop(0,"rgba(255,255,255,1)"),E.addColorStop(1,"rgba(255,255,255,0)"),x.fillStyle=E,x.fillRect(0,0,b,S);const C=x.createLinearGradient(0,0,0,S);C.addColorStop(0,"rgba(0,0,0,0)"),C.addColorStop(1,"rgba(0,0,0,1)"),x.fillStyle=C,x.fillRect(0,0,b,S);const _=i.s*b,I=(1-i.v)*S;x.strokeStyle=i.v>.5?"#000":"#fff",x.lineWidth=2,x.beginPath(),x.arc(_,I,5,0,Math.PI*2),x.stroke()},[i]);T.useEffect(()=>{h()},[h]);const p=v=>{const b=r.current.getBoundingClientRect(),S=Math.max(0,Math.min(1,(v.clientX-b.left)/b.width)),E=Math.max(0,Math.min(1,(v.clientY-b.top)/b.height)),C={...i,s:S,v:1-E};o(C),e&&e(zl(C.h,C.s,C.v))},y=v=>{f(!0),p(v)};return T.useEffect(()=>{if(!c)return;const v=b=>p(b),x=()=>f(!1);return window.addEventListener("mousemove",v),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",x)}},[c,i]),m.jsxs("div",{className:"custom-color-picker",style:{padding:"5px",background:"#222",borderRadius:"4px"},children:[m.jsx("canvas",{ref:r,width:150,height:100,style:{width:"100%",height:"100px",cursor:"crosshair",borderRadius:"2px"},onMouseDown:y}),m.jsx("div",{className:"hue-slider-container",style:{marginTop:"8px"},children:m.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:i.h,onChange:v=>{const x={...i,h:parseFloat(v.target.value)};o(x),e&&e(zl(x.h,x.s,x.v))},style:{width:"100%",height:"10px",appearance:"none",background:"linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)",borderRadius:"5px"}})})]})},Xm=({control:a,value:e,onChange:r,animSettings:i,onAnimChange:o,effectId:c,context:f,progressRef:h,workerId:p,clipDuration:y,bpm:v,getFftLevels:x,uiState:b,onUpdateUiState:S,paramKey:E})=>{const[C,_]=T.useState(!1),I=!!b?.expandedParams?.[E],M=P=>{S&&S({expandedParams:{...b?.expandedParams||{},[E]:P}})},N=P=>{P.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:a.type,paramName:a.id,effectId:c,min:a.min,max:a.max,step:a.step,...f}))},D=i?.range||[a.min,a.max],k=P=>{o({...i,range:P})},G=P=>{o({range:D,...P})};return m.jsxs("div",{className:`param-editor ${I?"expanded":""}`,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),style:{marginBottom:"8px",display:"grid",gridTemplateColumns:"1fr",gap:"2px"},children:[m.jsx("div",{className:"param-row-label",style:{width:"100%"},children:m.jsx("label",{className:"param-label",draggable:!0,onDragStart:N,style:{fontSize:"11px",color:"#aaa"},children:a.label})}),m.jsxs("div",{className:"param-row-control",style:{display:"grid",gridTemplateColumns:"20px 1fr 60px",gap:"5px",alignItems:"center"},children:[m.jsx("button",{className:`anim-toggle-btn ${I?"active":""}`,style:{visibility:C||I||i?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>M(!I),title:"Animate",children:""}),m.jsx("div",{className:"control-input-wrapper",style:{display:"flex",alignItems:"center",height:"100%"},children:a.type==="range"?m.jsx(rn,{id:`${c}_${a.id}`,style:{width:"100%"},children:m.jsx(qm,{min:a.min,max:a.max,step:a.step,value:e,rangeValue:D,onChange:r,onRangeChange:k,showRange:I,animSettings:i,progressRef:h,workerId:p,clipDuration:y,bpm:v,getFftLevels:x})}):a.type==="text"?m.jsx("input",{type:"text",value:e,onChange:P=>r(P.target.value),className:"param-text-input"}):a.type==="checkbox"?m.jsx(rn,{id:`${c}_${a.id}`,children:m.jsx("input",{type:"checkbox",checked:e,onChange:P=>r(P.target.checked),className:"param-checkbox"})}):a.type==="select"?m.jsx("select",{value:e,onChange:P=>r(P.target.value),className:"param-select",children:a.options.map(P=>m.jsx("option",{value:P,children:P},P))}):null}),a.type==="range"&&m.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:P=>r(parseFloat(P.target.value)||0),className:"param-number-input",step:a.step,style:{fontSize:"10px"}})]}),I&&a.type==="range"&&m.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:m.jsx(Vm,{animSettings:i,onChange:G})})]})},h1=({customOrder:a=[],assignedDacs:e=[],onChange:r})=>{const[i,o]=T.useState(null),c=a&&a.length>0?a:e.map((p,y)=>({ip:p.ip,channel:p.channel,label:`Ch ${p.channel} (${p.hostName||p.ip})`,originalIndex:y})),f=(p,y)=>{o(c[y])},h=(p,y)=>{p.preventDefault();const v=c[y];if(i===v)return;const x=c.filter(b=>b!==i);x.splice(y,0,i),r(x)};return m.jsxs("div",{className:"custom-order-editor",style:{marginBottom:"10px",padding:"5px",background:"#222",borderRadius:"4px"},children:[m.jsx("label",{style:{fontSize:"10px",color:"#888"},children:"Channel Order (Drag to Sort)"}),m.jsx("ul",{style:{listStyle:"none",padding:0,margin:"5px 0"},children:c.map((p,y)=>m.jsxs("li",{draggable:!0,onDragStart:v=>f(v,y),onDragOver:v=>h(v,y),style:{background:"#333",border:"1px solid #444",padding:"4px",marginBottom:"2px",fontSize:"10px",cursor:"grab",display:"flex",alignItems:"center"},children:[m.jsx("span",{style:{marginRight:"5px",color:"#666"},children:""}),p.label||`Ch ${p.channel} ${p.ip?`(${p.ip})`:""}`]},y))})]})},m1=({effect:a,onParamChange:e,syncSettings:r,onSetParamSync:i,context:o,progressRef:c,workerId:f,clipDuration:h,bpm:p,getFftLevels:y,uiState:v,onUpdateUiState:x})=>{const{mode:b,color:S,paletteColors:E=[],paletteSize:C=4}=a.params,[_,I]=T.useState(0),M=!!v?.showHsv?.[a.instanceId],N=te=>{x&&x({showHsv:{...v?.showHsv||{},[a.instanceId]:te}})},D=te=>{const H=[...E];for(;H.length<16;)H.push("#ffffff");H[_]=te,e("paletteColors",H)},k=Yi.find(te=>te.id==="color"),G=te=>{if(!te)return{h:0,s:0,v:1};const H=parseInt(te.slice(1,3),16)/255,Z=parseInt(te.slice(3,5),16)/255,W=parseInt(te.slice(5,7),16)/255,X=Math.max(H,Z,W),K=Math.min(H,Z,W);let F,z,ie=X;const be=X-K;if(z=X===0?0:be/X,X===K)F=0;else{switch(X){case H:F=(Z-W)/be+(Z<W?6:0);break;case Z:F=(W-H)/be+2;break;case W:F=(H-Z)/be+4;break}F/=6}return{h:F,s:z,v:ie}},P=te=>{e("color",te);const H=G(te);e("hue",H.h),e("saturation",H.s),e("brightness",H.v)},q=[{name:"RGBY",colors:["#ff0000","#00ff00","#0000ff","#ffff00"]},{name:"CYBER",colors:["#ff00ff","#00ffff","#ffffff","#0000ff"]},{name:"FIRE",colors:["#ff8800","#ff0000","#ffff00","#880000"]},{name:"ICE",colors:["#0000ff","#0088ff","#00ffff","#ffffff"]}],Y=te=>{const H=k.paramControls.find(W=>W.id===te);if(!H)return null;const Z=`${a.instanceId||a.id}.${H.id}`;return m.jsx(Xm,{control:H,value:a.params[te],onChange:W=>e(te,W),animSettings:r[Z],onAnimChange:W=>i(Z,W),effectId:a.id,context:o,progressRef:c,workerId:f,clipDuration:h,bpm:p,getFftLevels:y,uiState:v,onUpdateUiState:x,paramKey:Z},te)};return m.jsxs("div",{className:"color-effect-editor",children:[Y("mode"),b==="solid"&&m.jsxs("div",{style:{marginTop:"10px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[m.jsx("label",{style:{fontSize:"11px",color:"#aaa"},children:"Pick Color"}),m.jsx("button",{className:`anim-toggle-btn ${M?"active":""}`,style:{background:"none",border:"none",color:M?"var(--theme-color)":"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>N(!M),title:"Advanced HSV Controls",children:""})]}),!M&&m.jsx(V0,{color:S||"#ffffff",onChange:P}),M&&m.jsxs("div",{className:"hsv-sliders",style:{padding:"5px",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[Y("hue"),Y("saturation"),Y("brightness"),m.jsx("div",{style:{marginTop:"5px",height:"10px",borderRadius:"2px",background:S||"#ffffff",border:"1px solid #444"}})]})]}),b==="palette"&&m.jsxs("div",{style:{marginTop:"10px"},children:[Y("paletteSize"),Y("paletteSpread"),Y("cycleSpeed"),Y("rainbowOffset"),m.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Presets"}),m.jsx("div",{className:"preset-row",style:{display:"flex",gap:"4px",marginBottom:"10px"},children:q.map(te=>m.jsx("button",{onClick:()=>e("paletteColors",te.colors),style:{fontSize:"9px",padding:"2px 5px",background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:"3px",cursor:"pointer"},children:te.name},te.name))}),m.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Palette Colors"}),m.jsx("div",{className:"palette-grid",style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"10px"},children:Array.from({length:C}).map((te,H)=>m.jsx("div",{onClick:()=>I(H),style:{width:"20px",height:"20px",background:E[H]||"#ffffff",border:_===H?"2px solid white":"1px solid #444",borderRadius:"3px",cursor:"pointer",boxSizing:"border-box"}},H))}),m.jsx(V0,{color:E[_]||"#ffffff",onChange:D})]}),b==="rainbow"&&m.jsxs("div",{style:{marginTop:"10px"},children:[Y("cycleSpeed"),Y("rainbowSpread"),Y("rainbowOffset"),Y("rainbowPalette")]})]})},$m=({effect:a,assignedDacs:e=[],onParamChange:r,onRemove:i,syncSettings:o={},onSetParamSync:c,context:f={},progressRef:h,clipDuration:p,bpm:y,getFftLevels:v,uiState:x,onUpdateUiState:b,dragHandle:S})=>{if(!a)return null;const E=Yi.find(q=>q.id===a.id);if(!E)return null;const C=a.id==="delay",_=a.id==="chase",I=a.id==="color",M=a.params.enabled!==!1,N=a.params.mode==="channel",D=x?.collapsedEffects||{},k=!!D[a.instanceId],G=q=>{b&&b({collapsedEffects:{...D,[a.instanceId]:q}})},P=q=>{q.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"enabled",label:`${a.name} ON`,...f}))};return m.jsx(la,{title:a.name,isCollapsed:k,onToggle:G,dragHandle:S,headerActions:m.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[(C||_)&&m.jsx("button",{className:"mode-toggle-btn",onClick:()=>r("mode",N?"frame":"channel"),style:{fontSize:"9px",padding:"2px 5px",background:N?"#444":"var(--theme-color)",border:"none",color:"white",borderRadius:"3px",cursor:"pointer"},children:N?"CHANNEL":"FRAME"}),m.jsx(rn,{id:`${a.id}_blackout`,children:m.jsx("button",{className:`layer-control-button ${M?"":"active"}`,onClick:()=>r("enabled",!M),draggable:!0,onDragStart:P,style:{padding:"2px",background:M?"none":"red",border:"none",color:"white",cursor:"pointer",display:"flex"},title:"Toggle Effect",children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),m.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),m.jsx("button",{className:"remove-effect-btn",onClick:i,children:""})]}),children:I?m.jsx(m1,{effect:a,onParamChange:r,syncSettings:o,onSetParamSync:c,context:f,progressRef:h,workerId:f.workerId,clipDuration:p,bpm:y,getFftLevels:v,uiState:x,onUpdateUiState:b}):m.jsxs(m.Fragment,{children:[C&&m.jsx(m.Fragment,{children:a.params.useCustomOrder&&m.jsx(h1,{customOrder:a.params.customOrder,assignedDacs:e,onChange:q=>r("customOrder",q)})}),E.paramControls.map(q=>{if(C&&["customOrder"].includes(q.id)||q.showIf&&!Object.entries(q.showIf).every(([Z,W])=>a.params[Z]===W))return null;const Y=`${a.instanceId||a.id}.${q.id}`,te=typeof o[Y]=="object"?o[Y]:{syncMode:o[Y]};return m.jsx(Xm,{control:q,value:a.params[q.id],onChange:H=>r(q.id,H),animSettings:te,onAnimChange:H=>c(Y,H),effectId:a.id,context:f,progressRef:h,workerId:f.workerId,clipDuration:p,bpm:y,getFftLevels:v,uiState:x,onUpdateUiState:b,paramKey:Y},q.id)})]})})},g1=({control:a,value:e,onChange:r,syncSettings:i,onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:h,workerId:p,generatorId:y,clipDuration:v,uiState:x,onUpdateUiState:b})=>{const[S,E]=T.useState(!1),C=`${y}.${a.id}`,_=!!x?.expandedParams?.[C],I=G=>{b&&b({expandedParams:{...x?.expandedParams||{},[C]:G}})},M=G=>{G.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:a.type,paramName:a.id,targetType:"generator",layerIndex:c,colIndex:f,min:a.min,max:a.max,step:a.step}))},N=typeof i[C]=="object"?i[C]:{syncMode:i[C]},D=N?.range||[a.min,a.max],k=G=>{o(C,{...N,range:G})};return m.jsxs("div",{className:`param-editor ${_?"expanded":""}`,onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),style:{marginBottom:"8px"},children:[m.jsx("div",{className:"param-label-row",style:{display:"flex",alignItems:"center"},children:m.jsx("label",{draggable:!0,onDragStart:M,className:"param-label",style:{fontSize:"11px",color:"#aaa",cursor:"grab"},children:a.label})}),m.jsxs("div",{className:"control-row",style:{display:"grid",gridTemplateColumns:"20px 1fr 50px",gap:"5px",alignItems:"center"},children:[m.jsx("button",{className:`anim-toggle-btn ${_?"active":""}`,style:{visibility:S||_||N?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>I(!_),title:"Animate",children:""}),m.jsx("div",{className:"control-input-wrapper",children:a.type==="range"?m.jsx(qm,{min:a.min,max:a.max,step:a.step,value:e,rangeValue:D,onChange:G=>r(a.id,G),onRangeChange:k,showRange:_,animSettings:N,progressRef:h,workerId:p,clipDuration:v}):a.type==="number"?m.jsx("input",{type:"number",value:e,onChange:G=>r(a.id,parseFloat(G.target.value)||0),className:"param-number-input",step:a.step}):a.type==="text"?m.jsx("input",{type:"text",value:e,onChange:G=>r(a.id,G.target.value),className:"param-text-input"}):a.type==="checkbox"?m.jsx("input",{type:"checkbox",checked:e,onChange:G=>r(a.id,G.target.checked),className:"param-checkbox"}):a.type==="select"?m.jsx("select",{value:e,onChange:G=>r(a.id,G.target.value),className:"param-select",style:{width:"100%",fontSize:"11px",background:"#333",color:"#fff",border:"1px solid #555"},children:a.options.map(G=>m.jsx("option",{value:G.value,children:G.label},G.value))}):null}),a.type==="range"&&m.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:G=>r(a.id,parseFloat(G.target.value)||0),className:"param-number-input",step:a.step,style:{width:"100%",fontSize:"10px"}})]}),_&&a.type==="range"&&m.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:m.jsx(Vm,{animSettings:N,onChange:G=>o(C,G)})})]})},y1=({selectedGeneratorId:a,selectedGeneratorParams:e,onParameterChange:r,syncSettings:i={},onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:h,workerId:p,clipDuration:y,uiState:v,onUpdateUiState:x})=>{const[b,S]=T.useState([]),[E,C]=T.useState([]),[_,I]=T.useState(!1);if(!a)return m.jsx("div",{className:"generator-settings-panel",children:"No generator selected."});const M=Vf.find(G=>G.id===a);if(!M)return m.jsxs("div",{className:"generator-settings-panel",children:["Generator definition not found for ID: ",a]});const N=v?.collapsedPanels||{},D=G=>{x&&x({collapsedPanels:{...N,generator:G}})};T.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getProjectFonts)try{const P=await window.electronAPI.getProjectFonts();C(P)}catch(P){console.error("Failed to load project fonts:",P)}})()},[]);const k=async G=>{const P=G.target.value;if(P==="browse")if(window.electronAPI&&window.electronAPI.showFontFileDialog){const q=await window.electronAPI.showFontFileDialog();q&&r("fontUrl",q)}else console.error("Font file dialog API not available.");else if(P==="load-system"){I(!0);try{const Y=(await window.electronAPI.getSystemFonts()).map(te=>({name:te.split(/[\\/]/).pop(),path:te})).sort((te,H)=>te.name.localeCompare(H.name));S(Y)}catch(q){console.error("Failed to load system fonts:",q)}I(!1)}else r("fontUrl",P)};return m.jsx(la,{title:`${M.name} Settings`,isCollapsed:!!N.generator,onToggle:D,children:M.paramControls.filter(G=>!G.condition||G.condition(e)).map(G=>{if(G.id==="fontUrl"){const P=e[G.id]||"src/fonts/Geometr415 Blk BT Black.ttf";return m.jsxs("div",{className:"param-editor",children:[m.jsx("label",{className:"param-label",children:G.label}),m.jsxs("div",{className:"font-selector-container",children:[m.jsxs("select",{className:"param-select",onChange:k,value:P,children:[E.length>0?m.jsx("optgroup",{label:"Project Fonts",children:E.map(q=>m.jsx("option",{value:q.path,children:q.name},q.path))}):m.jsx("optgroup",{label:"Default Fonts",children:m.jsx("option",{value:"src/fonts/Geometr415 Blk BT Black.ttf",children:"Geometr415"})}),b.length>0?m.jsx("optgroup",{label:"System Fonts",children:b.map(q=>m.jsx("option",{value:q.path,children:q.name},q.path))}):m.jsx("option",{value:"load-system",children:_?"Loading...":"Load System Fonts..."}),m.jsx("optgroup",{label:"Actions",children:m.jsx("option",{value:"browse",children:"Browse File..."})})]}),m.jsx("span",{className:"font-path-tiny",title:P,children:P.split(/[\\/]/).pop()})]})]},G.id)}return m.jsx(g1,{control:G,value:e[G.id],onChange:r,syncSettings:i,onSetParamSync:o,layerIndex:c,colIndex:f,progressRef:h,workerId:p,generatorId:a,clipDuration:y,uiState:v,onUpdateUiState:x},G.id)})})},v1=({settings:a,onUpdate:e,uiState:r,onUpdateUiState:i})=>{const{mode:o="fps",duration:c=1,beats:f=8,speedMultiplier:h=1,fps:p=60}=a||{},y=r?.collapsedPanels||{},v=S=>{i&&i({collapsedPanels:{...y,playback:S}})},x=S=>{e({mode:S})},b=(S,E,C=!1)=>{let _=a[S]||(S==="beats"?8:S==="fps"?60:1);C?_=E>1?_*2:_/2:_+=E,_<.01&&(_=.01),e({[S]:_})};return m.jsxs(la,{title:"Clip Playback",isCollapsed:!!y.playback,onToggle:v,children:[m.jsxs("div",{className:"playback-mode-selector",children:[m.jsx("button",{className:o==="fps"?"active":"button_inactive",onClick:()=>x("fps"),children:"FPS"}),m.jsx("button",{className:o==="timeline"?"active":"button_inactive",onClick:()=>x("timeline"),children:"Timeline"}),m.jsx("button",{className:o==="bpm"?"active":"button_inactive",onClick:()=>x("bpm"),children:"BPM Sync"})]}),m.jsxs("div",{className:"playback-controls",children:[o==="fps"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"control-group",children:[m.jsx("label",{children:"Speed (FPS)"}),m.jsxs("div",{className:"value-adjuster",children:[m.jsx("button",{onClick:()=>b("fps",-1),children:"-1"}),m.jsx("input",{type:"number",value:p,onChange:S=>e({fps:parseInt(S.target.value)||60})}),m.jsx("button",{onClick:()=>b("fps",1),children:"+1"}),m.jsx("button",{onClick:()=>b("fps",.5,!0),children:"/2"}),m.jsx("button",{onClick:()=>b("fps",2,!0),children:"*2"})]})]}),m.jsxs("div",{className:"control-group",children:[m.jsx("label",{children:"Duration (s) (for effects)"}),m.jsx("div",{className:"value-adjuster",children:m.jsx("input",{type:"number",value:c.toFixed(2),onChange:S=>e({duration:parseFloat(S.target.value)||1})})})]})]}),o==="timeline"&&m.jsxs("div",{className:"control-group",children:[m.jsx("label",{children:"Duration (s)"}),m.jsxs("div",{className:"value-adjuster",children:[m.jsx("button",{onClick:()=>b("duration",-1),children:"-1"}),m.jsx("input",{type:"number",value:c.toFixed(2),onChange:S=>e({duration:parseFloat(S.target.value)||1})}),m.jsx("button",{onClick:()=>b("duration",1),children:"+1"}),m.jsx("button",{onClick:()=>b("duration",.5,!0),children:"/2"}),m.jsx("button",{onClick:()=>b("duration",2,!0),children:"*2"})]})]}),o==="bpm"&&m.jsxs("div",{className:"control-group",children:[m.jsx("label",{children:"Beats"}),m.jsxs("div",{className:"value-adjuster",children:[m.jsx("button",{onClick:()=>b("beats",-1),children:"-1"}),m.jsx("input",{type:"number",value:f,onChange:S=>e({beats:parseInt(S.target.value)||1})}),m.jsx("button",{onClick:()=>b("beats",1),children:"+1"}),m.jsx("button",{onClick:()=>b("beats",.5,!0),children:"/2"}),m.jsx("button",{onClick:()=>b("beats",2,!0),children:"*2"})]})]}),(o==="timeline"||o==="bpm")&&m.jsxs("div",{className:"control-group",children:[m.jsx("label",{children:"Speed Multiplier"}),m.jsxs("div",{className:"value-adjuster",children:[m.jsx("button",{onClick:()=>b("speedMultiplier",-.1),children:"-0.1"}),m.jsx("input",{type:"number",value:h.toFixed(2),onChange:S=>e({speedMultiplier:parseFloat(S.target.value)||1})}),m.jsx("button",{onClick:()=>b("speedMultiplier",.1),children:"+0.1"})]})]})]})]})},Zm=T.createContext(),Kl=()=>T.useContext(Zm),b1=({children:a})=>{const[e,r]=T.useState(null),[i,o]=T.useState(null),[c,f]=T.useState(null),[h,p]=T.useState({source:"external",lowRange:[20,250],midRange:[250,4e3],highRange:[4e3,2e4],gain:1,holdTime:100,fallTime:500,calculationMode:"average",smoothingTimeConstant:.8}),[y,v]=T.useState({low:0,mid:0,high:0}),x=T.useRef(new Uint8Array(0)),b=T.useRef({low:0,mid:0,high:0}),S=T.useRef({low:0,mid:0,high:0,lastUpdateTime:Date.now(),peakTimes:{low:0,mid:0,high:0}}),[E,C]=T.useState([]),[_,I]=T.useState("default"),[M,N]=T.useState(1),D=T.useRef({}),k=T.useRef({}),G=T.useRef({}),P=T.useCallback(async()=>{try{const Ce=(await navigator.mediaDevices.enumerateDevices()).filter(Oe=>Oe.kind==="audiooutput");if(C(Ce),window.electronAPI&&window.electronAPI.setAudioDevices){const Oe=Ce.map(at=>({deviceId:at.deviceId,label:at.label,groupId:at.groupId}));window.electronAPI.setAudioDevices(Oe)}}catch(me){console.error("Error enumerating audio devices:",me)}},[]);T.useEffect(()=>{P();let me;return window.electronAPI&&window.electronAPI.onUpdateAudioDeviceId&&(me=window.electronAPI.onUpdateAudioDeviceId(Ce=>{I(Ce)})),navigator.mediaDevices.addEventListener("devicechange",P),()=>{navigator.mediaDevices.removeEventListener("devicechange",P),me&&me()}},[P]);const q=T.useCallback(me=>{if(!e||!i)return null;try{const Ce=e.createMediaElementSource(me);return Ce.connect(i),Ce.connect(e.destination),Ce}catch(Ce){return console.warn("MediaElementSource already connected?",Ce),null}},[e,i]),Y=T.useCallback(async(me,Ce,Oe=1,at=!0)=>{if(D.current[me]&&(D.current[me].pause(),D.current[me].src=""),G.current[me]=Oe,!Ce)return;if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(Ce))throw new Error(`Audio file not found: ${Ce}`);const tt=new Audio(`file:///${Ce}`);if(tt.volume=Oe*M,_&&tt.setSinkId)try{await tt.setSinkId(_)}catch(bt){console.error("Error setting audio sink ID:",bt)}if(D.current[me]=tt,e){e.state==="suspended"&&await e.resume();const bt=q(tt);bt&&(k.current[me]=bt)}if(at)try{await tt.play()}catch(bt){throw console.error("Error playing audio:",bt),bt}return tt},[_,q,M,e]),te=T.useCallback(me=>{N(me),Object.keys(D.current).forEach(Ce=>{const Oe=D.current[Ce],at=G.current[Ce]??1;Oe&&(Oe.volume=me*at)})},[]),H=T.useCallback((me,Ce)=>{G.current[me]=Ce;const Oe=D.current[me];Oe&&(Oe.volume=Ce*M)},[M]),Z=T.useCallback(me=>{if(D.current[me]&&(D.current[me].pause(),D.current[me].src="",delete D.current[me],k.current[me])){try{k.current[me].disconnect()}catch{}delete k.current[me]}},[]),W=T.useCallback(me=>{D.current[me]&&D.current[me].pause()},[]),X=T.useCallback(async me=>{if(D.current[me]&&D.current[me].paused)try{await D.current[me].play()}catch(Ce){console.error("Error resuming:",Ce)}},[]),K=T.useCallback(me=>{const Ce=Math.max(.0625,Math.min(me,16));Object.values(D.current).forEach(Oe=>{try{Oe.playbackRate=Ce}catch(at){console.warn("Failed to set playbackRate:",at)}})},[]),F=T.useCallback(me=>{D.current[me]&&(D.current[me].currentTime=0)},[]),z=T.useCallback((me,Ce)=>{D.current[me]&&(D.current[me].currentTime=Ce)},[]),ie=T.useCallback(()=>Object.keys(D.current).forEach(Z),[Z]),be=T.useCallback(()=>Object.keys(D.current).forEach(W),[W]),U=T.useCallback(()=>Object.keys(D.current).forEach(X),[X]),ee=T.useCallback(()=>Object.keys(D.current).forEach(F),[F]),ve=T.useCallback(me=>{const Ce=D.current[me];return Ce?{currentTime:Ce.currentTime,duration:Ce.duration,paused:Ce.paused}:null},[]),Me=T.useCallback(async()=>{if(e)return;const me=new(window.AudioContext||window.webkitAudioContext),Ce=me.createAnalyser();Ce.fftSize=2048,Ce.smoothingTimeConstant=h.smoothingTimeConstant,x.current=new Uint8Array(Ce.frequencyBinCount),me.state==="suspended"&&await me.resume(),r(me),o(Ce)},[e,h.smoothingTimeConstant]);return T.useEffect(()=>{const me=()=>{Me(),window.removeEventListener("mousedown",me),window.removeEventListener("keydown",me)};return window.addEventListener("mousedown",me),window.addEventListener("keydown",me),()=>{window.removeEventListener("mousedown",me),window.removeEventListener("keydown",me)}},[Me]),T.useEffect(()=>{i&&(i.smoothingTimeConstant=h.smoothingTimeConstant)},[i,h.smoothingTimeConstant]),T.useEffect(()=>{if(!e||!i||h.source!=="external"){c&&(c.disconnect(),f(null));return}let me=null;return(async()=>{try{e.state==="suspended"&&await e.resume(),me=await navigator.mediaDevices.getUserMedia({audio:!0});const Oe=e.createMediaStreamSource(me);Oe.connect(i),f(Oe)}catch(Oe){console.error("Failed to get external audio stream:",Oe)}})(),()=>{me&&me.getTracks().forEach(Oe=>Oe.stop())}},[e,i,h.source]),T.useEffect(()=>{if(!i)return;let me;const Ce=()=>{i.getByteFrequencyData(x.current);const Oe=e.sampleRate,at=i.frequencyBinCount,tt=Oe/i.fftSize,bt=Re=>{const wt=Math.floor(Re[0]/tt),nn=Math.floor(Re[1]/tt);if(h.calculationMode==="peak"){let Ue=0;for(let le=wt;le<=nn&&le<at;le++)x.current[le]>Ue&&(Ue=x.current[le]);return Ue/255}else{let Ue=0,le=0;for(let ln=wt;ln<=nn&&ln<at;ln++)Ue+=x.current[ln],le++;return le>0?Ue/le/255:0}},sn=bt(h.lowRange),Jt=bt(h.midRange),en=bt(h.highRange),xt=Date.now(),tn=Math.max(0,xt-S.current.lastUpdateTime);S.current.lastUpdateTime=xt;const Ie=(Re,wt)=>{let nn=Re*h.gain;const Ue=S.current[wt],le=S.current.peakTimes[wt]||0;if(nn>=Ue)return S.current.peakTimes[wt]=xt,nn;{if(xt-le<h.holdTime)return Ue;if(h.fallTime<=0)return 0;const It=tn/h.fallTime,qt=Ue-It;return Math.max(0,isNaN(qt)?0:qt)}},rt={low:Ie(sn,"low"),mid:Ie(Jt,"mid"),high:Ie(en,"high")};b.current=rt,S.current={...rt,lastUpdateTime:xt,peakTimes:S.current.peakTimes},me=requestAnimationFrame(Ce)};return Ce(),()=>cancelAnimationFrame(me)},[e,i,h]),m.jsx(Zm.Provider,{value:{audioCtx:e,analyser:i,fftSettings:h,setFftSettings:p,fftLevels:b.current,fftLevelsRef:b,getFftLevels:()=>b.current,connectMediaElement:q,initAudio:Me,devices:E,selectedDeviceId:_,setSelectedDeviceId:I,globalVolume:M,setVolume:te,setClipVolume:H,playAudio:Y,stopAudio:Z,pauseAudio:W,resumeAudio:X,setPlaybackRate:K,resetAudio:F,seekAudio:z,stopAllAudio:ie,pauseAllAudio:be,resumeAllAudio:U,resetAllAudio:ee,getAudioInfo:ve},children:a})},x1=({audioFile:a,layerIndex:e,onSeek:r,onLoadError:i})=>{const o=T.useRef(null),c=T.useRef(null),{audioCtx:f,getAudioInfo:h}=Kl(),[p,y]=T.useState(null),[v,x]=T.useState("rgb(255, 94, 0)"),b=T.useRef(null),S=T.useRef(!1),E=T.useRef([]),C=T.useRef(null),_=T.useCallback(()=>{const k=document.createElement("div");k.style.display="none",k.style.color="var(--theme-color)",document.body.appendChild(k);const G=getComputedStyle(k).color;document.body.removeChild(k),G&&G!=="rgba(0, 0, 0, 0)"&&x(G)},[]);T.useEffect(()=>{_();const k=new MutationObserver(_);return k.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class"]}),()=>k.disconnect()},[_]),T.useEffect(()=>{if(!a?.path||!f)return;let k=!0;const G=async()=>{try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(a.path))throw new Error(`File not found: ${a.path}`);const P=await fetch(`file:///${a.path}`);if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);const q=await P.arrayBuffer();if(!k)return;const Y=await f.decodeAudioData(q);if(k){const te=Y.getChannelData(0),H=[],Z=Math.max(1,Math.floor(te.length/500));for(let W=0;W<te.length;W+=Z){let X=1,K=-1;for(let F=0;F<Z&&W+F<te.length;F++){const z=te[W+F];z<X&&(X=z),z>K&&(K=z)}H.push({min:X,max:K})}E.current=H,C.current=null,y(Y)}}catch(P){if(!k)return;console.error("Failed to load/decode audio for waveform:",P),i&&i(P)}};return y(null),G(),()=>{k=!1}},[a,f,i]);const I=T.useCallback((k,G,P,q)=>{const Y=E.current;if(!Y||Y.length===0)return;const te=P/2,H=2,W=H+1;if(!C.current||C.current.width!==G||C.current.height!==P){const K=document.createElement("canvas");K.width=G,K.height=P;const F=K.getContext("2d");let z=v;v.startsWith("rgb(")&&(z=v.replace("rgb","rgba").replace(")",", 0.2)")),F.fillStyle=z;const ie=Math.ceil(G/W);for(let be=0;be<ie;be++){const U=Math.floor(be/ie*Y.length),ee=Y[U],ve=(1+ee.min)*te,Me=Math.max(1,(ee.max-ee.min)*te);F.fillRect(be*W,ve,H,Me)}C.current=K}k.clearRect(0,0,G,P),k.drawImage(C.current,0,0);const X=G*q;if(X>0){k.save(),k.beginPath(),k.rect(0,0,X,P),k.clip(),k.fillStyle=v;const K=Math.ceil(G/W);for(let F=0;F<K;F++){const z=F*W;if(z>X)break;const ie=Math.floor(F/K*Y.length),be=Y[ie],U=(1+be.min)*te,ee=Math.max(1,(be.max-be.min)*te);k.fillRect(z,U,H,ee)}k.restore()}k.fillStyle="#ffffff",k.fillRect(X,0,1,P)},[v]);T.useEffect(()=>{const k=o.current;if(!k||!p)return;const G=k.getContext("2d"),P=()=>{const q=k.getBoundingClientRect();(k.width!==q.width||k.height!==q.height)&&(k.width=q.width,k.height=q.height,C.current=null);const Y=k.width,te=k.height;let H=0;if(e!=null){const Z=h(e);Z&&Z.duration>0&&(H=Z.currentTime/Z.duration)}I(G,Y,te,Math.max(0,Math.min(1,H))),b.current=requestAnimationFrame(P)};return P(),()=>{b.current&&cancelAnimationFrame(b.current)}},[p,e,h,I]);const M=k=>{S.current=!0,D(k),window.addEventListener("mouseup",N),window.addEventListener("mousemove",D)},N=()=>{S.current=!1,window.removeEventListener("mouseup",N),window.removeEventListener("mousemove",D)},D=k=>{if(!o.current||!p)return;const G=o.current.getBoundingClientRect(),P=k.clientX-G.left,q=G.width,te=Math.max(0,Math.min(1,P/q))*p.duration;r&&r(te)};return m.jsx("div",{ref:c,className:"wave-player-container",style:{width:"100%",height:"35px",marginBottom:"10px",background:"transparent",borderRadius:"4px",overflow:"hidden"},onMouseDown:M,children:m.jsx("canvas",{ref:o,style:{width:"100%",height:"100%",display:"block",cursor:"pointer"}})})},S1=({selectedLayerIndex:a,selectedColIndex:e,clip:r,audioInfo:i,bpm:o,getFftLevels:c,onAssignAudio:f,onRemoveAudio:h,onUpdateAudioVolume:p,onUpdatePlaybackSettings:y,onSetParamSync:v,onToggleDacMirror:x,onRemoveDac:b,onRemoveEffect:S,onReorderEffects:E,onAddEffect:C,onParameterChange:_,onGeneratorParameterChange:I,onUpdateClipUiState:M,progressRef:N,onAudioError:D})=>{const[k,G]=T.useState({}),[P,q]=T.useState(null),{seekAudio:Y}=Kl(),te=T.useRef(0),H=r?.uiState||{},Z=H.collapsedPanels||{},W=(Ie,rt)=>{M&&M(a,e,{collapsedPanels:{...Z,[Ie]:rt}})},X=ha.useCallback(Ie=>{D&&D(a,e)},[D,a,e]);if(T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(rt=>{G(Re=>({...Re,[rt.ip]:rt.status}))})},[]),a===null||e===null)return m.jsx("div",{className:"clip-settings-panel settings-panel-base",children:m.jsx("p",{className:"info-text",children:"Select a clip to view settings."})});const K=Ie=>{Ie.preventDefault(),Ie.stopPropagation();try{const rt=Ie.dataTransfer.getData("application/json");if(!rt)return;const Re=JSON.parse(rt);Re&&Re.type&&C&&C(Re)}catch(rt){console.error("Failed to drop effect in ClipSettingsPanel:",rt)}},F=Ie=>{Ie.preventDefault(),Ie.dataTransfer.dropEffect="copy"},z=Ie=>{q(Ie)},ie=(Ie,rt)=>{if(Ie.preventDefault(),P===null||P===rt)return;const Re=Date.now();Re-te.current<200||(te.current=Re,E&&(E(a,e,P,rt),q(rt)))},be=Ie=>{q(null)},{effects:U=[],assignedDacs:ee=[],playbackSettings:ve={},syncSettings:Me={},audioFile:me=null,audioVolume:Ce=1,type:Oe=null,generatorDefinition:at=null,currentParams:tt={},workerId:bt=null}=r||{},sn=U.length>0,Jt=Oe==="generator"&&!!at,en=ee.length>0;let xt=1;if(ve.mode==="timeline")xt=ve.duration||1;else if(ve.mode==="bpm"){const Ie=o||120;xt=(ve.beats||8)*60/Ie}else{const Ie=ve.fps||r?.fps||30;xt=(r?.totalFrames||30)/Ie}const tn=bt||(Oe==="ilda"?`ilda-${a}-${e}`:Oe==="generator"?`generator-${a}-${e}`:null);return i&&i.duration&&i.currentTime/i.duration*100,m.jsxs("div",{className:"clip-settings-panel settings-panel-base",onDrop:K,onDragOver:F,children:[m.jsx(la,{title:"Audio",isCollapsed:!!Z.audio,onToggle:Ie=>W("audio",Ie),children:me?m.jsxs("div",{className:"assigned-audio-info",style:{position:"relative"},children:[m.jsx("button",{className:"remove-effect-btn",onClick:h,style:{position:"absolute",top:"-5px",right:"-5px",fontSize:"14px"},children:""}),m.jsx("div",{className:"audio-file-name",title:me.path,style:{paddingRight:"15px",marginBottom:"8px",fontSize:"11px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:me.name}),m.jsx(x1,{audioFile:me,audioInfo:i,layerIndex:a,onSeek:Ie=>Y(a,Ie),onLoadError:X}),m.jsxs("div",{className:"audio-volume-control",style:{marginTop:"10px"},children:[m.jsxs("label",{style:{fontSize:"10px",display:"block",marginBottom:"2px"},children:["Volume: ",Math.round(Ce*100),"%"]}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ce,onChange:Ie=>p(a,e,parseFloat(Ie.target.value)),className:"slider_hor",style:{width:"100%",height:"4px"}})]})]}):m.jsx("button",{className:"assign-audio-btn",onClick:f,children:"Assign Audio File"})}),m.jsx(v1,{settings:ve,onUpdate:Ie=>y(a,e,Ie),uiState:H,onUpdateUiState:Ie=>M(a,e,Ie)}),en&&m.jsx(la,{title:"Assigned DACs",isCollapsed:!!Z.dacs,onToggle:Ie=>W("dacs",Ie),children:m.jsx("ul",{className:"assigned-dacs-list",children:ee.map((Ie,rt)=>{const Re=k[Ie.ip];return m.jsxs("li",{className:"assigned-dac-item",children:[m.jsxs("div",{className:"dac-info-block",children:[m.jsxs("span",{className:"dac-name-tiny",children:[Ie.hostName||Ie.ip," - Ch ",Ie.channel]}),Re&&m.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",Re.playback_state===2?"PLAYING":Re.playback_state===1?"PREPARED":"IDLE"," | Buf: ",Re.buffer_fullness,Re.buffer_capacity?`/${Re.buffer_capacity}`:""," | PPS: ",Re.point_rate]})]}),m.jsxs("div",{className:"dac-mirror-controls",children:[m.jsx("button",{className:`mirror-btn ${Ie.mirrorX?"active":""}`,onClick:()=>x(a,e,rt,"x"),title:"Mirror X Axis",children:"X"}),m.jsx("button",{className:`mirror-btn ${Ie.mirrorY?"active":""}`,onClick:()=>x(a,e,rt,"y"),title:"Mirror Y Axis",children:"Y"})]}),m.jsx("button",{className:"remove-dac-btn",onClick:()=>b(rt),children:""})]},`${Ie.unitID||Ie.ip}-${Ie.channel}-${rt}`)})})}),Jt&&m.jsx(y1,{selectedGeneratorId:at.id,selectedGeneratorParams:tt,onParameterChange:I,syncSettings:Me,onSetParamSync:v,layerIndex:a,colIndex:e,progressRef:N,workerId:tn,clipDuration:xt,bpm:o,getFftLevels:c,uiState:H,onUpdateUiState:Ie=>M(a,e,Ie)}),m.jsx(la,{title:"Clip Effects",isCollapsed:!!Z.effects,onToggle:Ie=>W("effects",Ie),children:m.jsx("div",{className:"clip-effects-list",style:{minHeight:"50px"},onDrop:be,children:sn?U.map((Ie,rt)=>m.jsx("div",{onDragOver:Re=>ie(Re,rt),style:{marginBottom:"4px"},children:m.jsx($m,{effect:Ie,assignedDacs:ee,syncSettings:Me,onSetParamSync:v,context:{layerIndex:a,colIndex:e,effectIndex:rt,targetType:"effect",workerId:tn},onParamChange:(Re,wt)=>_(a,e,rt,Re,wt),onRemove:()=>S(a,e,rt),progressRef:N,clipDuration:xt,bpm:o,getFftLevels:c,uiState:H,onUpdateUiState:Re=>M(a,e,Re),dragHandle:m.jsx("div",{draggable:!0,onDragStart:()=>z(rt),style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},Ie.instanceId||Ie.id+rt)):m.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},E1=({selectedLayerIndex:a,autopilotMode:e,onAutopilotChange:r,layerEffects:i,assignedDacs:o=[],onToggleDacMirror:c,onRemoveDac:f,onAddEffect:h,onRemoveEffect:p,onParamChange:y,uiState:v,onUpdateUiState:x})=>{const[b,S]=T.useState({}),E=v?.collapsedPanels||{},C=(M,N)=>{x&&x({collapsedPanels:{...E,[M]:N}})};if(T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(N=>{S(D=>({...D,[N.ip]:N.status}))})},[]),a===null)return m.jsx("div",{className:"settings-panel-base",children:m.jsx("p",{className:"info-text",children:"Select a layer to edit settings"})});const _=M=>{M.preventDefault(),M.stopPropagation();try{const N=JSON.parse(M.dataTransfer.getData("application/json"));N&&N.id&&h(N)}catch(N){console.error("Failed to drop effect:",N)}},I=M=>{M.preventDefault(),M.dataTransfer.dropEffect="copy"};return m.jsxs("div",{className:"settings-panel-base",onDrop:_,onDragOver:I,children:[o&&o.length>0&&m.jsx(la,{title:"Assigned DACs",isCollapsed:!!E.dacs,onToggle:M=>C("dacs",M),children:m.jsx("ul",{className:"assigned-dacs-list",children:o.map((M,N)=>{const D=b[M.ip];return m.jsxs("li",{className:"assigned-dac-item",children:[m.jsxs("div",{className:"dac-info-block",children:[m.jsxs("span",{className:"dac-name-tiny",children:[M.hostName||M.ip," - Ch ",M.channel]}),D&&m.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",D.playback_state===2?"PLAYING":D.playback_state===1?"PREPARED":"IDLE"," | Buf: ",D.buffer_fullness,D.buffer_capacity?`/${D.buffer_capacity}`:""," | PPS: ",D.point_rate]})]}),m.jsxs("div",{className:"dac-mirror-controls",children:[m.jsx("button",{className:`mirror-btn ${M.mirrorX?"active":""}`,onClick:()=>c(a,N,"x"),title:"Mirror X Axis",children:"X"}),m.jsx("button",{className:`mirror-btn ${M.mirrorY?"active":""}`,onClick:()=>c(a,N,"y"),title:"Mirror Y Axis",children:"Y"})]}),m.jsx("button",{className:"remove-dac-btn",onClick:()=>f(a,N),children:""})]},`${M.unitID||M.ip}-${M.channel}-${N}`)})})}),m.jsx(la,{title:`Layer ${a+1} Autopilot`,isCollapsed:!!E.autopilot,onToggle:M=>C("autopilot",M),children:m.jsxs("div",{className:"param-editor",children:[m.jsx("label",{children:"Mode"}),m.jsx("div",{className:"clip-playback-settings",children:m.jsxs("div",{className:"playback-mode-selector",children:[m.jsx("button",{className:e==="off"?"active":"",onClick:()=>r("off"),children:"OFF"}),m.jsx("button",{className:e==="forward"?"active":"",onClick:()=>r("forward"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-forward-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"m9.77 12.11 4.012-2.953a.647.647 0 0 0 0-1.114L9.771 5.09a.644.644 0 0 0-.971.557V6.65H2v3.9h6.8v1.003c0 .505.545.808.97.557"})})}),m.jsx("button",{className:e==="random"?"active":"",onClick:()=>r("random"),children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[m.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),m.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})})]})})]})}),m.jsx(la,{title:"Layer Effects",isCollapsed:!!E.effects,onToggle:M=>C("effects",M),children:m.jsx("div",{className:"layer-effects-list",style:{minHeight:"50px"},children:i&&i.length>0?i.map((M,N)=>m.jsx("div",{style:{marginBottom:"4px"},children:m.jsx($m,{effect:M,onRemove:()=>p(N),onParamChange:(D,k)=>y(N,D,k),syncSettings:{},onSetParamSync:()=>{},context:{layerIndex:a,colIndex:null,effectIndex:N,targetType:"layerEffect"},uiState:v,onUpdateUiState:x,dragHandle:m.jsx("div",{draggable:!0,onDragStart:D=>{D.dataTransfer.setData("application/json",JSON.stringify({type:"effect-reorder",index:N,layerIndex:a}))},style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},M.instanceId||N)):m.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},w1=({message:a,visible:e})=>e?m.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#333",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:1e3,opacity:e?1:0,transition:"opacity 0.5s ease-in-out"},children:a}):null,Qm=T.createContext(null),Wm=()=>T.useContext(Qm),A1=({children:a,onWorkerMessage:e})=>{const r=T.useRef(null);return r.current===null&&(r.current=new Worker(new URL(""+new URL("rendering.worker-Bxc2wDv4.js",import.meta.url).href,import.meta.url),{type:"module"})),T.useEffect(()=>{const i=r.current;return e&&(i.onmessage=e),()=>{i.terminate(),e&&(i.onmessage=null)}},[e]),m.jsx(Qm.Provider,{value:r.current,children:a})},T1=({frame:a,effects:e,showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:h,syncSettings:p={},bpm:y=120,clipDuration:v=1,progress:x=0,previewTime:b=0,fftLevels:S={low:0,mid:0,high:0},effectStates:E=null,optimizationEnabled:C=!0,onToggleBeamEffect:_,onCycleDisplayMode:I})=>{const M=T.useRef(null),N=Wm(),D=T.useRef(`ilda-player-${Math.random()}`);return T.useEffect(()=>{const k=M.current;if(!k||!N)return;const G=k.transferControlToOffscreen();return N.postMessage({action:"register",payload:{id:D.current,canvas:G,type:"single",data:{showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:h,syncSettings:p,bpm:y,clipDuration:v,progress:x,previewTime:b,fftLevels:S,effectStates:E,optimizationEnabled:C}}},[G]),()=>{N.postMessage({action:"deregister",payload:{id:D.current}})}},[]),T.useEffect(()=>{if(!N)return;const k=a?[a]:[];N.postMessage({action:"update",payload:{id:D.current,data:{ildaFrames:k,effects:e,showBeamEffect:r,beamAlpha:i,fadeAlpha:o,previewScanRate:c,beamRenderMode:f,intensity:h,syncSettings:p,bpm:y,clipDuration:v,progress:x,previewTime:b,fftLevels:S,effectStates:E,optimizationEnabled:C}}})},[N,a,e,r,i,o,c,f,h,p,y,v,x,b,S,E,C]),m.jsxs("div",{className:"ilda-player",children:[m.jsx("h3",{children:"Selected Preview"}),m.jsxs("div",{className:"renderSettingToggle",children:[m.jsx("button",{onClick:_,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),m.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),m.jsx("button",{onClick:I,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),m.jsx("canvas",{ref:M,width:"300",height:"300",style:{backgroundColor:"black"}})]})},C1=ha.memo(T1),M1=({activeFrames:a,showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,layerIntensities:f,masterIntensity:h,dacSettings:p,previewTime:y=0,fftLevels:v={low:0,mid:0,high:0},optimizationEnabled:x=!0,onToggleBeamEffect:b,onCycleDisplayMode:S})=>{const E=T.useRef(null),C=Wm(),_=T.useRef(`world-preview-${Math.random()}`);return T.useEffect(()=>{const I=E.current;if(!I||!C)return;const M=I.transferControlToOffscreen();return C.postMessage({action:"register",payload:{id:_.current,canvas:M,type:"world",data:{showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,previewTime:y,fftLevels:v,optimizationEnabled:x}}},[M]),()=>{C.postMessage({action:"deregister",payload:{id:_.current}})}},[]),T.useEffect(()=>{if(!C)return;const I=Object.entries(a).map(([M,{frame:N,effects:D,layerIndex:k,syncSettings:G,bpm:P,clipDuration:q,progress:Y,effectStates:te}])=>({frames:[N],effects:D,workerId:M,layerIndex:k,syncSettings:G,bpm:P,clipDuration:q,progress:Y,effectStates:te}));C.postMessage({action:"update",payload:{id:_.current,data:{worldData:I,showBeamEffect:e,beamAlpha:r,fadeAlpha:i,previewScanRate:o,beamRenderMode:c,layerIntensities:f,masterIntensity:h,dacSettings:p,previewTime:y,fftLevels:v,optimizationEnabled:x}}})},[C,a,e,r,i,o,c,f,h,p,y,v,x]),m.jsxs("div",{className:"world-preview",children:[m.jsx("h3",{children:"World Preview"}),m.jsxs("div",{className:"renderSettingToggle",children:[m.jsx("button",{onClick:b,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),m.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),m.jsx("button",{onClick:S,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),m.jsx("canvas",{ref:E,width:"300",height:"300",style:{backgroundColor:"black"}})]})},N1=({bpm:a,onBpmChange:e})=>{const[r,i]=T.useState([]),[o,c]=T.useState(a);T.useEffect(()=>{c(a)},[a]);const f=()=>{const p=Date.now(),y=[...r,p].slice(-4);if(i(y),y.length>=2){const v=[];for(let S=1;S<y.length;S++)v.push(y[S]-y[S-1]);const x=v.reduce((S,E)=>S+E)/v.length,b=Math.round(6e4/x);e(b)}},h=p=>{const y=parseFloat(p.target.value);c(p.target.value),!isNaN(y)&&y>0&&y<999&&e(y)};return m.jsx("div",{className:"bpm-controls",children:m.jsxs("div",{className:"bpm-display",children:[m.jsx(rn,{id:"bpm_tap",children:m.jsx("button",{className:"bpm-tap-btn",onClick:f,children:"TAP"})}),m.jsxs("div",{className:"bpm-fine-controls",children:[m.jsx(rn,{id:"bpm_fine_down",children:m.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.max(1,a-.1)),children:"-"})}),m.jsx(rn,{id:"bpm_value",children:m.jsx("input",{type:"number",className:"bpm-input",value:o,onChange:h,min:"1",max:"999",step:"0.1"})}),m.jsx(rn,{id:"bpm_fine_up",children:m.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.min(999,a+.1)),children:"+"})})]}),m.jsx("span",{className:"bpm-label",children:"BPM"})]})})},R1=({onPlay:a,onPause:e,onStop:r,isPlaying:i,isStopped:o})=>{const c=(f,h)=>{f.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"transport",label:h.toUpperCase()}))};return m.jsxs("div",{className:"transport-controls",children:[m.jsx(rn,{id:"transport_play",children:m.jsx("button",{className:`speed-control-button ${i?"active":""}`,onClick:a,draggable:!0,onDragStart:f=>c(f,"play"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-play-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"})})})}),m.jsx(rn,{id:"transport_pause",children:m.jsx("button",{className:`speed-control-button ${!i&&!o?"active":""}`,onClick:e,draggable:!0,onDragStart:f=>c(f,"pause"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pause-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"})})})}),m.jsx(rn,{id:"transport_stop",children:m.jsx("button",{className:`speed-control-button ${o?"active":""}`,onClick:r,draggable:!0,onDragStart:f=>c(f,"stop"),children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-stop-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5"})})})})]})},k1=({value:a,onToggle:e,label:r,onDrop:i,isAssigned:o,onContextMenu:c,className:f,...h})=>{const p=v=>{v.preventDefault(),v.dataTransfer.dropEffect="link"},y=v=>{v.preventDefault();try{const x=v.dataTransfer.getData("application/x-truelazer-param");console.log("[QuickButton] Dropped Data Raw:",x);const b=JSON.parse(x);console.log("[QuickButton] Dropped Data Parsed:",b),b&&(b.type==="toggle"||b.type==="checkbox")?i(b):console.warn("[QuickButton] Invalid data type for button:",b?.type)}catch(x){console.error("[QuickButton] Drop Error:",x)}};return m.jsx("div",{className:`quick-assign-button ${a?"active":""} ${o?"":"unassigned"} ${f||""}`.trim(),style:{cursor:o?"pointer":"default",userSelect:"none",width:"90%",opacity:o?1:.5},onDragOver:p,onDrop:y,onContextMenu:c,...h,onClick:o?e:v=>v.preventDefault(),children:m.jsx("div",{className:"button-label",title:r||"Empty",children:r||"Assign"})})},D1=({assigns:a,onUpdateKnob:e,onToggleButton:r,onAssign:i})=>{const o=(c,f,h)=>{c.preventDefault(),window.electronAPI&&window.electronAPI.showQuickAssignContextMenu&&window.electronAPI.showQuickAssignContextMenu(f,h)};return m.jsxs("div",{className:"global-quick-assigns-panel",children:[m.jsx("div",{className:"quick-assigns-row knobs-row",children:Array.from({length:8}).map((c,f)=>{const h=!!a.knobs[f].link;return m.jsx(rn,{id:`quick_knob_${f}`,children:m.jsx(ri,{value:a.knobs[f]?.value||0,label:a.knobs[f]?.label,isAssigned:h,onChange:p=>h&&e(f,p),onContextMenu:p=>o(p,"knob",f),onDrop:p=>{console.log(`[GlobalQuickAssigns] Knob ${f} Drop Data:`,p),i("knob",f,p)}})},`knob-${f}`)})}),m.jsx("div",{className:"quick-assigns-row buttons-row",children:Array.from({length:8}).map((c,f)=>{const h=!!a.buttons[f].link;return m.jsx(rn,{id:`quick_btn_${f}`,children:m.jsx(k1,{value:a.buttons[f]?.value||!1,label:a.buttons[f]?.label,isAssigned:h,onToggle:()=>r(f),onContextMenu:p=>o(p,"button",f),onDrop:p=>{console.log(`[GlobalQuickAssigns] Button ${f} Drop Data:`,p),i("button",f,p)}})},`btn-${f}`)})})]})},_1=({enabledShortcuts:a={},onOpenOutputSettings:e,quickAssigns:r,onUpdateKnob:i,onToggleButton:o,onAssign:c,renderSettings:f={},onSetRenderSetting:h})=>{const{midiInitialized:p,midiInputs:y,selectedMidiInputId:v,setSelectedMidiInputId:x,isMapping:b,startMapping:S,stopMapping:E,learningId:C,lastMidiEvent:_,setMappings:I,saveMappings:M,exportMappings:N,importMappings:D}=Cc(),k=f.settingsPanelCollapsed||{},G=(le,ln)=>{h&&h("settingsPanelCollapsed",{...k,[le]:ln})},{artnetInitialized:P,isMapping:q,startMapping:Y,stopMapping:te,setMappings:H,saveMappings:Z,exportMappings:W,importMappings:X,lastDmxEvent:K}=rd()||{},{isMapping:F,startMapping:z,stopMapping:ie,setMappings:be,saveMappings:U,exportMappings:ee,importMappings:ve}=sd()||{},[Me,me]=T.useState([]),[Ce,Oe]=T.useState(""),[at,tt]=T.useState(!1),[bt,sn]=T.useState(57121),[Jt,en]=T.useState("127.0.0.1"),[xt,tn]=T.useState(57120),[Ie,rt]=T.useState(null);T.useEffect(()=>{const le=async()=>{if(a.artnet)try{const qt=await window.electronAPI.getArtnetUniverses();me(qt),qt.length>0&&Oe(qt[0].id)}catch(qt){console.error("Failed to fetch Art-Net universes:",qt)}},ln=async()=>{if(a.osc)try{if((await window.electronAPI.initializeOsc({localPort:bt,remoteAddress:Jt,remotePort:xt})).success)return tt(!0),window.electronAPI.onOscMessageReceived(({oscMessage:Ye})=>{rt(Ye)})}catch(qt){console.error("Failed to initialize OSC:",qt)}};let It=()=>{};return le(),ln().then(qt=>{typeof qt=="function"&&(It=qt)}),()=>{typeof It=="function"&&It()}},[a]);const Re=le=>x(le.target.value),wt=()=>b?E():S(),nn=()=>q?te():Y(),Ue=()=>F?ie():z();return m.jsxs("div",{className:"settings-panel settings-panel-base",children:[m.jsx("div",{className:"settings-card-header",children:m.jsx("h4",{children:"Global Settings"})}),r&&m.jsx(la,{title:"Quick Assigns",isCollapsed:!!k.quickAssigns,onToggle:le=>G("quickAssigns",le),children:m.jsx(D1,{assigns:r,onUpdateKnob:i,onToggleButton:o,onAssign:c})}),m.jsxs(la,{title:"Channel/DAC Settings",isCollapsed:!!k.dacSettings,onToggle:le=>G("dacSettings",le),children:[m.jsx("p",{className:"info-text",children:"Output routing and safety zones configuration."}),m.jsx("button",{className:"small-btn",style:{width:"100%",marginTop:"5px"},onClick:e,children:"Open Output Settings"})]}),m.jsxs(la,{title:"Processing",isCollapsed:!!k.processing,onToggle:le=>G("processing",le),children:[m.jsxs("div",{className:"param-editor",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx("label",{className:"param-label",style:{fontSize:"11px"},children:"Point Optimization"}),m.jsx("input",{type:"checkbox",checked:f.optimizationEnabled,onChange:le=>h("optimizationEnabled",le.target.checked)})]}),m.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:"Optimizes geometry (interpolation/dwell) before applying effects. Fixes lines in Delay effect but increases point count."})]}),(a.midi||a.artnet||a.osc||a.keyboard)&&m.jsxs("div",{className:"shortcuts-settings-panel",children:[a.keyboard&&m.jsx(la,{title:"Keyboard Shortcuts",isCollapsed:!!k.keyboard,onToggle:le=>G("keyboard",le),children:m.jsxs("div",{className:"keyboard-config",children:[m.jsxs("div",{className:"button-grid",children:[m.jsx("button",{className:`mapping-btn ${F?"active":""}`,onClick:Ue,style:{backgroundColor:F?"var(--theme-color)":"",gridColumn:"span 2"},children:F?"Stop Mapping":"Start Mapping"}),m.jsx("button",{className:"small-btn",onClick:U,children:"Save Default"}),m.jsx("button",{className:"small-btn",onClick:ee,children:"Export"}),m.jsx("button",{className:"small-btn",onClick:ve,children:"Import"}),m.jsx("button",{className:"small-btn clear",onClick:()=>be({}),children:"Clear"})]}),m.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:'Assign keys to buttons/sliders by activating "Start Mapping" and clicking a control.'})]})}),a.midi&&m.jsx(la,{title:"MIDI Shortcuts",isCollapsed:!!k.midi,onToggle:le=>G("midi",le),children:p?m.jsxs("div",{className:"midi-config",children:[m.jsx("select",{className:"param-select",value:v,onChange:Re,style:{marginBottom:"8px",width:"100%"},children:y.map(le=>m.jsx("option",{value:le.id,children:le.name},le.id))}),m.jsxs("div",{className:"button-grid",children:[m.jsx("button",{className:`mapping-btn ${b?"active":""}`,onClick:wt,style:{backgroundColor:b?"var(--theme-color)":"",gridColumn:"span 2"},children:b?"Stop Mapping":"Start Mapping"}),m.jsx("button",{className:"small-btn",onClick:M,children:"Save Default"}),m.jsx("button",{className:"small-btn",onClick:N,children:"Export"}),m.jsx("button",{className:"small-btn",onClick:D,children:"Import"}),m.jsx("button",{className:"small-btn clear",onClick:()=>I({}),children:"Clear"})]}),_&&m.jsxs("div",{className:"last-event-status",children:[_.type," ",_.note||_.controller," (CH",_.channel,")"]})]}):m.jsx("p",{className:"loading-text",children:"Initializing MIDI..."})}),a.artnet&&m.jsx(la,{title:"ArtNet Shortcuts",isCollapsed:!!k.artnet,onToggle:le=>G("artnet",le),children:P?m.jsxs("div",{className:"artnet-config",children:[m.jsx("select",{className:"param-select",value:Ce,onChange:le=>{Oe(le.target.value);const ln=parseInt(le.target.value.replace("universe-",""));window.electronAPI&&window.electronAPI.listenArtnetUniverse&&window.electronAPI.listenArtnetUniverse(ln)},style:{marginBottom:"8px",width:"100%"},children:Me.map(le=>m.jsx("option",{value:le.id,children:le.name},le.id))}),m.jsxs("div",{className:"button-grid",children:[m.jsx("button",{className:`mapping-btn ${q?"active":""}`,onClick:nn,style:{backgroundColor:q?"var(--theme-color)":"",gridColumn:"span 2"},children:q?"Stop Mapping":"Start Mapping"}),m.jsx("button",{className:"small-btn",onClick:Z,children:"Save Default"}),m.jsx("button",{className:"small-btn",onClick:W,children:"Export"}),m.jsx("button",{className:"small-btn",onClick:X,children:"Import"}),m.jsx("button",{className:"small-btn clear",onClick:()=>H({}),children:"Clear"})]}),K&&m.jsxs("div",{className:"last-event-status",children:["UNIV ",K.universe," CH ",K.channel+1," (Val: ",K.value,")"]})]}):m.jsx("p",{className:"loading-text",children:"Initializing Art-Net..."})}),a.osc&&m.jsx(la,{title:"OSC Shortcuts",isCollapsed:!!k.osc,onToggle:le=>G("osc",le),children:m.jsx("div",{className:"osc-config",children:m.jsxs("p",{className:"info-text",children:["Listening on port: ",bt]})})})]})]})},O1=({show:a,title:e,initialValue:r,onSave:i,onClose:o})=>{const[c,f]=T.useState(r||"");if(T.useEffect(()=>{a&&f(r||"")},[a,r]),!a)return null;const h=()=>{i(c),o()},p=y=>{y.key==="Enter"&&h(),y.key==="Escape"&&o()};return m.jsx("div",{className:"shortcuts-modal-overlay",style:{pointerEvents:"auto"},children:m.jsxs("div",{className:"shortcuts-modal-content",style:{maxWidth:"400px"},children:[m.jsx("h3",{children:e||"Rename"}),m.jsxs("div",{className:"settings-section",style:{border:"none"},children:[m.jsx("input",{type:"text",value:c,onChange:y=>f(y.target.value),onKeyDown:p,autoFocus:!0,style:{width:"100%",padding:"8px",backgroundColor:"#1a1a1a",color:"white",border:"1px solid var(--theme-color)",borderRadius:"4px",marginBottom:"15px"}}),m.jsxs("div",{className:"button-row",style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[m.jsx("button",{onClick:o,children:"Cancel"}),m.jsx("button",{onClick:h,style:{backgroundColor:"var(--theme-color)",color:"black"},children:"Save"})]})]})]})})},I1=({safetyZones:a,outputArea:e,testLineY:r,testLineEnabled:i,transformationEnabled:o,transformationMode:c,flipX:f,flipY:h,onUpdateSafetyZones:p,onUpdateOutputArea:y,selectedZoneIndex:v,onSelectZone:x,gridSize:b=20,snapToGrid:S=!1})=>{const E=T.useRef(null),[C,_]=T.useState(null),I=(H,Z,W)=>{H.strokeStyle="#333",H.lineWidth=1,H.beginPath();for(let X=0;X<=b;X++){const K=X/b,F=K*Z,z=K*W;H.moveTo(F,0),H.lineTo(F,W),H.moveTo(0,z),H.lineTo(Z,z)}H.stroke(),H.strokeStyle="#666",H.lineWidth=2,H.beginPath(),H.moveTo(Z/2,0),H.lineTo(Z/2,W),H.moveTo(0,W/2),H.lineTo(Z,W/2),H.stroke(),H.fillStyle="#aaa",H.font="10px monospace",H.fillText("0,0",5,12),H.fillText("1,0",Z-25,12),H.fillText("0,1",5,W-5),H.fillText("1,1",Z-25,W-5)},M=(H,Z,W,X=!1,K=!1)=>{const{x:F,y:z,w:ie,h:be}=Z;if(H.fillStyle=W,H.fillRect(F,z,ie,be),H.strokeStyle=X?"#fff":K?"#0089ff":"#ff0000",H.lineWidth=X?2:1,H.strokeRect(F,z,ie,be),X||K){H.fillStyle="#fff";const ee=(me,Ce)=>H.fillRect(me-6/2,Ce-6/2,6,6);ee(F,z),ee(F+ie,z),ee(F,z+be),ee(F+ie,z+be);const ve=4;H.fillStyle="#ccc";const Me=(me,Ce)=>H.fillRect(me-ve/2,Ce-ve/2,ve,ve);Me(F+ie/2,z),Me(F+ie/2,z+be),Me(F,z+be/2),Me(F+ie,z+be/2)}},N=()=>{const H=E.current;if(!H)return;const Z=H.getContext("2d"),{width:W,height:X}=H;if(Z.clearRect(0,0,W,X),I(Z,W,X),o&&e&&M(Z,{x:e.x*W,y:e.y*X,w:e.w*W,h:e.h*X},"rgba(0, 137, 255, 0.2)",!1,!0),a.forEach((K,F)=>{M(Z,{x:K.x*W,y:K.y*X,w:K.w*W,h:K.h*X},"rgba(255, 0, 0, 0.3)",F===v)}),i){let K=r,F=0,z=1;if(o&&e){if(c==="scale")F=e.x,z=e.x+e.w,K=e.y+K*e.h;else if(c==="crop"){if(K<e.y||K>e.y+e.h)return;F=Math.max(0,e.x),z=Math.min(1,e.x+e.w)}}const ie=K*X,be=F*W,U=z*W;let ee=[[be,U]];a&&a.length>0&&a.forEach(ve=>{const Me=ve.y*X,me=ve.h*X,Ce=ve.x*W,Oe=ve.w*W;if(ie>=Me&&ie<=Me+me){const at=[];ee.forEach(tt=>{const[bt,sn]=tt,Jt=Ce,en=Ce+Oe;en<=bt||Jt>=sn?at.push(tt):(Jt>bt&&at.push([bt,Jt]),en<sn&&at.push([en,sn]))}),ee=at}}),Z.strokeStyle="#00ff00",Z.lineWidth=2,Z.beginPath(),ee.forEach(ve=>{Z.moveTo(ve[0],ie),Z.lineTo(ve[1],ie)}),Z.stroke()}};T.useEffect(()=>{N()},[a,e,r,i,o,v,b,f,h]);const D=H=>{const Z=E.current.getBoundingClientRect();return{x:(H.clientX-Z.left)/Z.width,y:(H.clientY-Z.top)/Z.height}},k=(H,Z,W)=>{if(!W)return null;const X=.03;return Math.abs(H-W.x)<X&&Math.abs(Z-W.y)<X?"nw":Math.abs(H-(W.x+W.w))<X&&Math.abs(Z-W.y)<X?"ne":Math.abs(H-W.x)<X&&Math.abs(Z-(W.y+W.h))<X?"sw":Math.abs(H-(W.x+W.w))<X&&Math.abs(Z-(W.y+W.h))<X?"se":Math.abs(Z-W.y)<X&&H>=W.x&&H<=W.x+W.w?"n":Math.abs(Z-(W.y+W.h))<X&&H>=W.x&&H<=W.x+W.w?"s":Math.abs(H-W.x)<X&&Z>=W.y&&Z<=W.y+W.h?"w":Math.abs(H-(W.x+W.w))<X&&Z>=W.y&&Z<=W.y+W.h?"e":null},G=(H,Z,W)=>W?H>=W.x&&H<=W.x+W.w&&Z>=W.y&&Z<=W.y+W.h:!1,P=H=>{const{x:Z,y:W}=D(H);if(v!==null&&a[v]){const X=a[v],K=k(Z,W,X);if(K){_({type:"zone",index:v,handle:K,startX:Z,startY:W,originalRect:{...X}});return}}for(let X=a.length-1;X>=0;X--){const K=a[X];if(K&&G(Z,W,K)){x(X);const F=k(Z,W,K);_({type:"zone",index:X,handle:F||"move",startX:Z,startY:W,originalRect:{...K}});return}}if(o&&e){const X=k(Z,W,e);if(X){_({type:"output",handle:X,startX:Z,startY:W,originalRect:{...e}}),x(null);return}if(G(Z,W,e)){_({type:"output",handle:"move",startX:Z,startY:W,originalRect:{...e}}),x(null);return}}x(null)},q=H=>{if(!S)return H;const Z=1/b;return Math.round(H/Z)*Z},Y=H=>{if(!C)return;const{x:Z,y:W}=D(H),X=Z-C.startX,K=W-C.startY,F=(z,ie,be,U)=>{let ee={...z};if(ie==="move")ee.x=q(z.x+be),ee.y=q(z.y+U);else{if(ie.includes("w")){const ve=q(z.x+be);ee.w=z.x+z.w-ve,ee.x=ve}if(ie.includes("e")){const ve=q(z.x+z.w+be);ee.w=ve-ee.x}if(ie.includes("n")){const ve=q(z.y+U);ee.h=z.y+z.h-ve,ee.y=ve}if(ie.includes("s")){const ve=q(z.y+z.h+U);ee.h=ve-ee.y}}return ee.w<.01&&(ee.w=.01),ee.h<.01&&(ee.h=.01),ee};if(C.type==="zone"){const z=F(C.originalRect,C.handle,X,K);p(C.index,z)}else if(C.type==="output"){const z=F(C.originalRect,C.handle,X,K);y(z)}},te=()=>{_(null)};return m.jsx("div",{className:"output-canvas-container",style:{width:"100%",height:"100%"},children:m.jsx("canvas",{ref:E,width:600,height:600,style:{width:"100%",height:"100%",display:"block"},className:"output-canvas",onMouseDown:P,onMouseMove:Y,onMouseUp:te,onMouseLeave:te})})},L1=({show:a,onClose:e,dacs:r=[],dacSettings:i={},onUpdateDacSettings:o})=>{const[c,f]=T.useState(null),[h,p]=T.useState(null),[y,v]=T.useState(20),[x,b]=T.useState(!1),S=T.useMemo(()=>{const N=[];return r.forEach(D=>{D.channels&&D.channels.length>0?D.channels.forEach(k=>{N.push({id:`${D.ip}:${k.serviceID}`,displayName:`${D.hostName||D.unitID||"DAC"} : ${k.name||`CH ${k.serviceID}`}`,ip:D.ip,channel:k.serviceID,dacName:D.hostName||D.unitID})}):N.push({id:`${D.ip}:0`,displayName:D.hostName||D.unitID||`DAC ${D.ip}`,ip:D.ip,channel:0,dacName:D.hostName||D.unitID})}),N},[r]);if(T.useEffect(()=>{S.length>0&&!c&&f(S[0].id)},[S,c]),!a)return null;const E=i[c]||{safetyZones:[],outputArea:{x:.1,y:.1,w:.8,h:.8},transformationEnabled:!1,transformationMode:"crop",testLineEnabled:!1,testLineY:.5,flipX:!1,flipY:!1},C=N=>{c&&o(c,{...E,...N})},_=()=>{const N={x:.4,y:.4,w:.2,h:.2};C({safetyZones:[...E.safetyZones,N]}),p(E.safetyZones.length)},I=()=>{C({safetyZones:[]}),p(null)},M=(N,D)=>{const k=[...E.safetyZones];k[N]=D,C({safetyZones:k})};return m.jsx("div",{className:"output-settings-modal-overlay",children:m.jsxs("div",{className:"output-settings-modal-content",children:[m.jsxs("div",{className:"output-settings-header",children:[m.jsx("h2",{children:"Output Settings"}),m.jsx("button",{className:"close-btn",onClick:e,children:"Close"})]}),m.jsxs("div",{className:"output-settings-body",children:[m.jsx("div",{className:"output-settings-col",children:m.jsxs("div",{className:"settings-group",children:[m.jsx("h4",{children:"Available Outputs"}),m.jsxs("ul",{className:"dac-list",children:[S.length===0?m.jsx("li",{style:{color:"#666",fontStyle:"italic"},children:"No Outputs detected"}):null,S.map((N,D)=>m.jsxs("li",{className:`dac-list-item ${c===N.id?"selected":""}`,onClick:()=>f(N.id),children:[m.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9em"},children:N.displayName}),m.jsx("span",{style:{fontSize:"0.7em",color:"#888"},children:N.ip})]},N.id))]})]})}),m.jsxs("div",{className:"output-settings-col canvas-col",children:[m.jsxs("div",{className:"canvas-toolbar",children:[m.jsx("button",{className:"tool-btn",onClick:_,title:"Add Safety Zone",children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus-square",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),m.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})]})}),m.jsx("button",{className:`tool-btn ${E.transformationEnabled?"active":""}`,onClick:()=>C({transformationEnabled:!E.transformationEnabled}),title:"Toggle Output Transformation",children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-border-outer",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M7.5 1.906v.938h1v-.938zm0 1.875v.938h1V3.78h-1zm0 1.875v.938h1v-.938zM1.906 8.5h.938v-1h-.938zm1.875 0h.938v-1H3.78v1zm1.875 0h.938v-1h-.938zm2.813 0v-.031H8.5V7.53h-.031V7.5H7.53v.031H7.5v.938h.031V8.5zm.937 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zM7.5 9.406v.938h1v-.938zm0 1.875v.938h1v-.938zm0 1.875v.938h1v-.938z"}),m.jsx("path",{d:"M0 0v16h16V0zm1 1h14v14H1z"})]})}),m.jsx("button",{className:`tool-btn ${E.testLineEnabled?"active":""}`,onClick:()=>C({testLineEnabled:!E.testLineEnabled}),title:"Toggle Test Line",children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[m.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),m.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})]})}),m.jsx("span",{style:{width:1,background:"#555",margin:"0 5px"}}),m.jsx("button",{className:`tool-btn ${x?"active":""}`,onClick:()=>b(!x),title:"Snap to Grid",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-magnet-fill",viewBox:"0 0 16 16",children:m.jsx("path",{d:"M15 12h-4v3h4zM5 12H1v3h4zM0 8a8 8 0 1 1 16 0v8h-6V8a2 2 0 1 0-4 0v8H0z"})})}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:5},children:[m.jsx("span",{style:{fontSize:10,color:"#aaa"},children:"Grid:"}),m.jsx("input",{type:"number",min:"5",max:"100",value:y,onChange:N=>v(parseInt(N.target.value)),className:"param-number-input",style:{width:40}})]})]}),m.jsx(I1,{safetyZones:E.safetyZones,outputArea:E.outputArea,testLineY:E.testLineY,testLineEnabled:E.testLineEnabled,transformationEnabled:E.transformationEnabled,transformationMode:E.transformationMode,flipX:E.flipX,flipY:E.flipY,onUpdateSafetyZones:M,onUpdateOutputArea:N=>C({outputArea:N}),selectedZoneIndex:h,onSelectZone:p,gridSize:y,snapToGrid:x})]}),m.jsx("div",{className:"output-settings-col",children:c?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"settings-group",children:[m.jsx("h4",{children:"Output Transformation"}),m.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[m.jsx("label",{style:{flex:1},children:"Enable Editing"}),m.jsx("input",{type:"checkbox",checked:E.transformationEnabled,onChange:N=>C({transformationEnabled:N.target.checked})})]}),m.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[m.jsx("label",{style:{flex:1},children:"Flip X"}),m.jsx("input",{type:"checkbox",checked:E.flipX||!1,onChange:N=>C({flipX:N.target.checked})})]}),m.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[m.jsx("label",{style:{flex:1},children:"Flip Y"}),m.jsx("input",{type:"checkbox",checked:E.flipY||!1,onChange:N=>C({flipY:N.target.checked})})]}),E.transformationEnabled&&m.jsxs("div",{className:"control-row",children:[m.jsx("label",{style:{flex:1},children:"Mode"}),m.jsxs("select",{className:"param-select",value:E.transformationMode,onChange:N=>C({transformationMode:N.target.value}),children:[m.jsx("option",{value:"crop",children:"Crop"}),m.jsx("option",{value:"scale",children:"Scale"})]})]})]}),m.jsxs("div",{className:"settings-group",children:[m.jsx("h4",{children:"Safety Zones"}),m.jsxs("div",{className:"control-row",style:{justifyContent:"space-between",marginBottom:5},children:[m.jsx("button",{className:"small-btn",onClick:_,children:"Add New"}),m.jsx("button",{className:"small-btn clear",onClick:I,children:"Clear All"})]}),m.jsx("div",{className:"zone-list",children:E.safetyZones.map((N,D)=>m.jsxs("div",{className:`zone-item ${h===D?"selected":""}`,onClick:()=>p(D),children:[m.jsxs("span",{children:["Zone ",D+1]}),m.jsx("button",{className:"delete-zone-btn",onClick:k=>{k.stopPropagation(),h===D&&p(null);const G=E.safetyZones.filter((P,q)=>q!==D);C({safetyZones:G})},children:""})]},D))}),h!==null&&m.jsxs("div",{style:{marginTop:10,borderTop:"1px solid #333",paddingTop:5},children:[m.jsx("label",{children:"Selected Zone Properties"}),m.jsx("div",{style:{fontSize:"0.8em",color:"#aaa"},children:"Select and drag zone on canvas to resize."})]})]}),m.jsxs("div",{className:"settings-group",children:[m.jsx("h4",{children:"Test Output"}),m.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[m.jsx("label",{style:{flex:1},children:"Enable Test Line"}),m.jsx("input",{type:"checkbox",checked:E.testLineEnabled,onChange:N=>C({testLineEnabled:N.target.checked})})]}),E.testLineEnabled&&m.jsxs("div",{className:"control-row",children:[m.jsx("label",{children:"Y Position"}),m.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:E.testLineY,onChange:N=>C({testLineY:parseFloat(N.target.value)}),className:"param-slider"})]})]})]}):m.jsx("div",{style:{padding:20,textAlign:"center",color:"#666"},children:"Select an Output to configure settings"})})]})]})})},Km=()=>{const a=Kl();return a||{}},U1=({show:a,onClose:e,initialTab:r="output"})=>{const i=Kl(),{fftSettings:o,setFftSettings:c}=i||{},{devices:f,selectedDeviceId:h,setSelectedDeviceId:p,globalVolume:y,setVolume:v}=Km(),[x,b]=T.useState(r);if(ha.useEffect(()=>{a&&b(r)},[a,r]),!a)return null;if(!o)return m.jsxs("div",{className:"modal-overlay",children:[m.jsxs("div",{className:"modal-content",style:{padding:"20px",color:"red",border:"1px solid red",background:"#222"},children:[m.jsx("h3",{children:"Error"}),m.jsx("p",{children:"Audio Context is not available."}),m.jsx("p",{children:"Please restart the application or report this bug."}),m.jsx("button",{onClick:e,style:{marginTop:"10px",padding:"5px 10px"},children:"Close"})]}),m.jsx("style",{children:`
                    .modal-overlay {
                        position: fixed;
                        top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 10000;
                    }
                `})]});const S=(E,C,_)=>{const I={...o},M=`${E}Range`;I[M][C]=parseFloat(_),c(I)};return m.jsxs("div",{className:"modal-overlay",children:[m.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h3",{children:"Audio Settings"}),m.jsx("button",{className:"close-btn",onClick:e,children:""})]}),m.jsxs("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"},children:[m.jsx("button",{className:`tab-btn ${x==="output"?"active":""}`,onClick:()=>b("output"),style:{padding:"8px 15px",background:"none",border:"none",color:x==="output"?"var(--theme-color)":"#888",borderBottom:x==="output"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"Audio Output"}),m.jsx("button",{className:`tab-btn ${x==="fft"?"active":""}`,onClick:()=>b("fft"),style:{padding:"8px 15px",background:"none",border:"none",color:x==="fft"?"var(--theme-color)":"#888",borderBottom:x==="fft"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"FFT Settings"})]}),m.jsxs("div",{className:"modal-body",children:[x==="output"&&m.jsxs("div",{className:"audio-output-settings",children:[m.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[m.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Device"}),m.jsx("select",{className:"param-select",value:h,onChange:E=>p(E.target.value),style:{width:"100%",padding:"5px"},children:f.map(E=>m.jsx("option",{value:E.deviceId,children:E.label||`Device ${E.deviceId.slice(0,5)}`},E.deviceId))})]}),m.jsxs("div",{className:"settings-row",style:{textAlign:"center"},children:[m.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Volume"}),m.jsx("div",{style:{display:"flex",justifyContent:"center"},children:m.jsx(ri,{value:y,onChange:v,label:"MASTER",isAssigned:!0,size:60})})]})]}),x==="fft"&&m.jsxs("div",{className:"fft-settings",children:[m.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[m.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Source"}),m.jsxs("select",{className:"param-select",value:o.source,onChange:E=>c({...o,source:E.target.value}),style:{width:"100%",padding:"5px"},children:[m.jsx("option",{value:"external",children:"External (Microphone/Loopback)"}),m.jsx("option",{value:"clip",children:"Clip FFT (Audio from active clips)"})]})]}),m.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[m.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Calculation Mode"}),m.jsxs("select",{className:"param-select",value:o.calculationMode||"average",onChange:E=>c({...o,calculationMode:E.target.value}),style:{width:"100%",padding:"5px"},children:[m.jsx("option",{value:"average",children:"Average (Smooth)"}),m.jsx("option",{value:"peak",children:"Peak (Transient/Punchy)"})]})]}),m.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[m.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Ranges (Hz)"}),m.jsxs("div",{className:"range-controls",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"10px",alignItems:"center"},children:[m.jsx("span",{children:"Low:"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("input",{type:"number",value:o.lowRange[0],onChange:E=>S("low",0,E.target.value),style:{width:"60px"}}),m.jsx("span",{children:"-"}),m.jsx("input",{type:"number",value:o.lowRange[1],onChange:E=>S("low",1,E.target.value),style:{width:"60px"}})]}),m.jsx("span",{children:"Mid:"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("input",{type:"number",value:o.midRange[0],onChange:E=>S("mid",0,E.target.value),style:{width:"60px"}}),m.jsx("span",{children:"-"}),m.jsx("input",{type:"number",value:o.midRange[1],onChange:E=>S("mid",1,E.target.value),style:{width:"60px"}})]}),m.jsx("span",{children:"High:"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("input",{type:"number",value:o.highRange[0],onChange:E=>S("high",0,E.target.value),style:{width:"60px"}}),m.jsx("span",{children:"-"}),m.jsx("input",{type:"number",value:o.highRange[1],onChange:E=>S("high",1,E.target.value),style:{width:"60px"}})]})]})]}),m.jsxs("div",{className:"settings-row",style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"GAIN"}),m.jsx(ri,{value:o.gain/5,onChange:E=>c({...o,gain:E*5}),isAssigned:!0,size:40})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"SMOOTH"}),m.jsx(ri,{value:o.smoothingTimeConstant||.8,onChange:E=>c({...o,smoothingTimeConstant:E}),isAssigned:!0,size:40})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"HOLD"}),m.jsx(ri,{value:o.holdTime/1e3,onChange:E=>c({...o,holdTime:E*1e3}),isAssigned:!0,size:40})]}),m.jsxs("div",{children:[m.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"FALL"}),m.jsx(ri,{value:o.fallTime/2e3,onChange:E=>c({...o,fallTime:E*2e3}),isAssigned:!0,size:40})]})]})]})]})]}),m.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]})},B1=({missingFiles:a,onRelocate:e,onClose:r})=>!a||a.length===0?null:m.jsxs("div",{className:"modal-overlay",children:[m.jsxs("div",{className:"modal-content",style:{width:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h3",{children:"Missing Files"}),m.jsx("button",{className:"close-btn",onClick:r,children:""})]}),m.jsxs("div",{className:"modal-body",style:{overflowY:"auto",flex:1},children:[m.jsx("p",{style:{marginBottom:"15px",color:"#ccc",fontSize:"0.9em"},children:"The following files could not be found. Please locate one of them to update the path for all matching files in the same directory."}),m.jsx("ul",{style:{listStyle:"none",padding:0},children:a.map((i,o)=>m.jsxs("li",{style:{background:"#333",padding:"10px",marginBottom:"5px",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{overflow:"hidden"},children:[m.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9em"},children:i.fileName}),m.jsx("div",{style:{fontSize:"0.8em",color:"#888",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"350px"},children:i.filePath})]}),m.jsx("button",{className:"small-btn",onClick:()=>e(i),style:{marginLeft:"10px",whiteSpace:"nowrap"},children:"Locate"})]},o))})]})]}),m.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex; justify-content: center; align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .small-btn {
                    background: var(--theme-color);
                    color: black;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: bold;
                }
                .small-btn:hover {
                    opacity: 0.9;
                }
            `})]});class F1 extends ha.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,r){console.error("Uncaught error:",e,r)}render(){return this.state.hasError?m.jsx("h1",{children:"Something went wrong."}):this.props.children}}const X0=32,$0=8;function Df(a,e,r,i){for(let o=0;o<i;o++)a.setUint8(e+o,o<r.length?r.charCodeAt(o):0)}function Jm(a){let e=0;a.forEach(c=>{e+=X0;const f=c.points?c.points.length:0;e+=f*$0});const r=new ArrayBuffer(e),i=new DataView(r);let o=0;return a.forEach((c,f)=>{const h=c.points||[],p=h.length;Df(i,o,"ILDA",4),i.setUint8(o+4,0),i.setUint8(o+5,0),i.setUint8(o+6,0),i.setUint8(o+7,5),Df(i,o+8,c.frameName||"TrueLazr",8),Df(i,o+16,c.companyName||"Gemini",8),i.setUint16(o+24,p,!1),i.setUint16(o+26,f,!1),i.setUint16(o+28,a.length,!1),i.setUint8(o+30,c.scannerHead||0),i.setUint8(o+31,0),o+=X0;for(let y=0;y<p;y++){const v=h[y];let x=Math.max(-32768,Math.min(32767,Math.round((v.x||0)*32767))),b=Math.max(-32768,Math.min(32767,Math.round((v.y||0)*32767)));i.setInt16(o,x,!1),i.setInt16(o+2,b,!1);let S=0;v.blanking&&(S|=64),y===p-1&&(S|=128),i.setUint8(o+4,S);let E=v.r||0,C=v.g||0,_=v.b||0;E<=1&&C<=1&&_<=1&&(E>0||C>0||_>0||v.blanking),E<=1&&C<=1&&_<=1?(E=Math.round(E*255),C=Math.round(C*255),_=Math.round(_*255)):(E=Math.round(E),C=Math.round(C),_=Math.round(_)),i.setUint8(o+5,_),i.setUint8(o+6,C),i.setUint8(o+7,E),o+=$0}}),r}const Z0=Object.freeze(Object.defineProperty({__proto__:null,framesToIlda:Jm},Symbol.toStringTag,{value:"Module"})),_f=[{r:255,g:0,b:0},{r:255,g:17,b:0},{r:255,g:34,b:0},{r:255,g:51,b:0},{r:255,g:68,b:0},{r:255,g:85,b:0},{r:255,g:102,b:0},{r:255,g:119,b:0},{r:255,g:136,b:0},{r:255,g:153,b:0},{r:255,g:170,b:0},{r:255,g:187,b:0},{r:255,g:204,b:0},{r:255,g:221,b:0},{r:255,g:238,b:0},{r:255,g:255,b:0},{r:255,g:255,b:0},{r:238,g:255,b:0},{r:204,g:255,b:0},{r:170,g:255,b:0},{r:136,g:255,b:0},{r:102,g:255,b:0},{r:68,g:255,b:0},{r:34,g:255,b:0},{r:0,g:255,b:0},{r:0,g:255,b:34},{r:0,g:255,b:68},{r:0,g:255,b:102},{r:0,g:255,b:136},{r:0,g:255,b:170},{r:0,g:255,b:204},{r:0,g:255,b:238},{r:0,g:136,b:255},{r:0,g:119,b:255},{r:0,g:102,b:255},{r:0,g:102,b:255},{r:0,g:85,b:255},{r:0,g:68,b:255},{r:0,g:68,b:255},{r:0,g:34,b:255},{r:0,g:0,b:255},{r:34,g:0,b:255},{r:68,g:0,b:255},{r:102,g:0,b:255},{r:136,g:0,b:255},{r:170,g:0,b:255},{r:204,g:0,b:255},{r:238,g:0,b:255},{r:255,g:0,b:255},{r:255,g:34,b:255},{r:255,g:68,b:255},{r:255,g:102,b:255},{r:255,g:136,b:255},{r:255,g:170,b:255},{r:255,g:204,b:255},{r:255,g:238,b:255},{r:255,g:255,b:255},{r:255,g:238,b:238},{r:255,g:204,b:204},{r:255,g:170,b:170},{r:255,g:136,b:136},{r:255,g:102,b:102},{r:255,g:68,b:68},{r:0,g:34,b:34}];function j1(a,e,r,i,o=_f){const c=[],f=new DataView(a);let h=0;try{for(let p=0;p<i;p++){if(e===2){h+=r;continue}let y,v,x=0,b,S,E,C;e===0||e===4?(y=f.getInt16(h,!1)/32768,v=f.getInt16(h+2,!1)/32768,x=f.getInt16(h+4,!1)/32768,C=f.getUint8(h+6)):(y=f.getInt16(h,!1)/32768,v=f.getInt16(h+2,!1)/32768,C=f.getUint8(h+4));const _=(C&64)!==0,I=(C&128)!==0;if(_)b=0,S=0,E=0;else if(e===0||e===1){const M=f.getUint8(h+(e===0?7:5)),N=o||_f,D=N[M%N.length]||_f[0];b=D.r,S=D.g,E=D.b}else(e===4||e===5)&&(E=f.getUint8(h+(e===4?7:5)),S=f.getUint8(h+(e===4?8:6)),b=f.getUint8(h+(e===4?9:7)));if(c.push({x:y,y:v,z:x,r:b===void 0?255:b,g:S===void 0?255:S,b:E===void 0?255:E,blanking:_,lastPoint:I}),h+=r,I)break}}catch(p){console.warn("Parser: Error reading points:",p)}return c}const P1=a=>{const e=[],r=new DataView(a);let i=0,o=null,c=null;for(;i+32<=r.byteLength;){if(String.fromCharCode(r.getUint8(i),r.getUint8(i+1),r.getUint8(i+2),r.getUint8(i+3))!=="ILDA"){i++;continue}const h=r.getUint8(i+7);c===null&&(c=h);const p=String.fromCharCode(...new Uint8Array(a,i+8,8)).trim(),y=String.fromCharCode(...new Uint8Array(a,i+16,8)).trim();let v=r.getUint16(i+24,!1);const x=r.getUint16(i+26,!1),b=r.getUint16(i+28,!1),S=r.getUint8(i+30);let E;switch(h){case 0:E=8;break;case 1:E=6;break;case 2:E=4;break;case 4:E=10;break;case 5:E=8;break;default:i+=32;continue}if(h===2){o=[];const I=i+32;for(let M=0;M<v;M++){const N=r.getUint8(I+M*4),D=r.getUint8(I+M*4+1),k=r.getUint8(I+M*4+2);o.push({r:N,g:D,b:k})}}let C=v*E,_=32+C;if(i+_>a.byteLength)break;if(v>0&&h!==2){const I=a.slice(i+32,i+32+C),M=j1(I,h,E,v,o);e.push({frameName:p,companyName:y,frameNumber:x,totalFrames:b,scannerHead:S,points:M,formatCode:h})}i+=_}return{frames:e,firstFormatCode:c,colorPalette:o}},z1=({onBack:a})=>{const[e,r]=T.useState("select"),[i,o]=T.useState("#00ff00"),[c,f]=T.useState("simple"),[h,p]=T.useState(!1),[y,v]=T.useState(1),[x,b]=T.useState(0),[S,E]=T.useState(!1),[C,_]=T.useState(!0),[I,M]=T.useState([[]]),[N,D]=T.useState(null),[k,G]=T.useState([[[]]]),[P,q]=T.useState(0),[Y,te]=T.useState([]),[H,Z]=T.useState([]),[W,X]=T.useState(null),[K,F]=T.useState(null),[z,ie]=T.useState(.6),[be,U]=T.useState({x:0,y:0}),[ee,ve]=T.useState(!0),[Me,me]=T.useState(!1),[Ce,Oe]=T.useState(25),[at,tt]=T.useState(!1),[bt,sn]=T.useState(!1),[Jt,en]=T.useState(!1),[xt,tn]=T.useState({visible:!1,x:0,y:0,target:null}),Ie=T.useRef(null),rt=T.useRef(null),Re=T.useRef({x:0,y:0}),wt=T.useRef(!1),nn=T.useRef(!1),Ue=T.useRef(!1),le=T.useRef(!1),ln=T.useRef(!1),It=T.useRef(null),qt=T.useRef(null),mt=1e3,Ye=I[x]||[],At=w=>{const O=k.slice(0,P+1);O.push(JSON.parse(JSON.stringify(w))),O.length>30&&O.shift(),G(O),q(O.length-1)},Bn=w=>{const O=gt(w);if(O.length===0)return{x:0,y:0,w:0,h:0};const J=Math.min(...O.map(ye=>ye.x)),Q=Math.max(...O.map(ye=>ye.x)),ne=Math.min(...O.map(ye=>ye.y)),ue=Math.max(...O.map(ye=>ye.y));return{x:J,y:ne,w:Q-J,h:ue-ne}},on=()=>{if(Y.length<2)return;const w=[...I],O=[...w[x]],J=Y.sort((Q,ne)=>ne-Q).map(Q=>O.splice(Q,1)[0]);O.push({type:"group",shapes:J.reverse(),color:J[0].color,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0}),w[x]=O,M(w),At(w),te([O.length-1])},es=()=>{if(Y.length!==1)return;const w=Ye[Y[0]];if(w.type!=="group")return;const O=[...I],J=[...O[x]];J.splice(Y[0],1),J.push(...w.shapes),O[x]=J,M(O),At(O),te([])},Fn=(w,O)=>Math.sqrt(Math.pow(O.x-w.x,2)+Math.pow(O.y-w.y,2)),kr=w=>{if(w.startsWith("rgb")){const J=w.match(/\d+/g);return{r:parseInt(J[0]),g:parseInt(J[1]),b:parseInt(J[2])}}const O=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(w);return O?{r:parseInt(O[1],16),g:parseInt(O[2],16),b:parseInt(O[3],16)}:{r:0,g:0,b:0}},Kn=(w,O,J)=>{const Q=Math.pow(Fn(O,J),2);if(Q===0)return Fn(w,O);let ne=((w.x-O.x)*(J.x-O.x)+(w.y-O.y)*(J.y-O.y))/Q;return ne=Math.max(0,Math.min(1,ne)),Fn(w,{x:O.x+ne*(J.x-O.x),y:O.y+ne*(J.y-O.y)})},Ta=(w,O)=>{let J=!1;for(let Q=0,ne=O.length-1;Q<O.length;ne=Q++)O[Q].y>w.y!=O[ne].y>w.y&&w.x<(O[ne].x-O[Q].x)*(w.y-O[Q].y)/(O[ne].y-O[Q].y)+O[Q].x&&(J=!J);return J},jn=w=>{if(!w)return{x:500,y:500};if(w.type==="rect")return{x:w.start.x+w.width/2,y:w.start.y+w.height/2};if(w.type==="circle"||w.type==="star")return w.start;if(w.type==="line")return{x:(w.start.x+w.end.x)/2,y:(w.start.y+w.end.y)/2};if(w.type==="group"){if(!w.shapes||w.shapes.length===0)return{x:500,y:500};const O=w.shapes.map(jn).filter(J=>!!J);return O.length===0?{x:500,y:500}:{x:O.reduce((J,Q)=>J+(Q.x||0),0)/O.length,y:O.reduce((J,Q)=>J+(Q.y||0),0)/O.length}}if(w.points&&w.points.length>0){const O=w.points.filter(Q=>!!Q);if(O.length===0)return{x:500,y:500};const J=O.reduce((Q,ne)=>({x:Q.x+(ne.x||0),y:Q.y+(ne.y||0)}),{x:0,y:0});return{x:J.x/O.length,y:J.y/O.length}}return{x:500,y:500}},Jn=T.useCallback((w,O)=>{if(!w||w.length===0||!O)return w;const J=jn(O),Q=O.scaleX??1,ne=O.scaleY??1,ue=O.rotationX||0,ye=O.rotationY||0,oe=O.rotationZ||O.rotation||0;return Q===1&&ne===1&&ue===0&&ye===0&&oe===0?w:w.map(_e=>{let De=_e.x-J.x,ze=_e.y-J.y,ke=_e.z||0;if(De*=Q,ze*=ne,oe!==0){const ot=De*Math.cos(oe)-ze*Math.sin(oe),Tt=De*Math.sin(oe)+ze*Math.cos(oe);De=ot,ze=Tt}if(ue!==0){const ot=ze*Math.cos(ue)-ke*Math.sin(ue),Tt=ze*Math.sin(ue)+ke*Math.cos(ue);ze=ot,ke=Tt}if(ye!==0){const ot=De*Math.cos(ye)+ke*Math.sin(ye),Tt=-De*Math.sin(ye)+ke*Math.cos(ye);De=ot,ke=Tt}return{..._e,x:J.x+De,y:J.y+ze,z:ke}})},[]),qe=T.useCallback(w=>{if(!w)return[];let O=[];if(w.type==="pen"||w.type==="polygon"||w.type==="polyline")O=w.points||[];else if(w.type==="bezier"){const J=(w.points||[]).filter(Q=>!!Q);if(J.length>=3)for(let Q=0;Q<=J.length-3;Q+=2){const ne=J[Q],ue=J[Q+1],ye=J[Q+2];if(ne&&ue&&ye){const oe=Q===0?0:1;for(let _e=oe;_e<=20;_e++){const De=_e/20,ze=1-De;O.push({x:ze*ze*ne.x+2*ze*De*ue.x+De*De*ye.x,y:ze*ze*ne.y+2*ze*De*ue.y+De*De*ye.y,color:ne.color})}}}else O=J}else if(w.type==="line")O=[{x:w.start.x,y:w.start.y,color:w.startColor||w.color},{x:w.end.x,y:w.end.y,color:w.endColor||w.color}];else if(w.type==="rect"){const J=w.color,Q=w.cornerColors||[J,J,J,J];O=[{x:w.start.x,y:w.start.y,color:Q[0]},{x:w.start.x+w.width,y:w.start.y,color:Q[1]},{x:w.start.x+w.width,y:w.start.y+w.height,color:Q[2]},{x:w.start.x,y:w.start.y+w.height,color:Q[3]}]}else if(w.type==="circle"){const J=Math.abs(w.end.x-w.start.x),Q=Math.abs(w.end.y-w.start.y),ne=w.color;for(let ue=0;ue<=32;ue++){const ye=ue/32*Math.PI*2;O.push({x:w.start.x+Math.cos(ye)*J,y:w.start.y+Math.sin(ye)*Q,color:ne})}}else if(w.type==="star"){const J=Math.abs(w.end.x-w.start.x),Q=Math.abs(w.end.y-w.start.y),ne=w.color,ue=5,ye=J,oe=J/2.5;let _e=Math.PI/2*3;const De=Math.PI/ue;for(let ze=0;ze<ue;ze++)O.push({x:w.start.x+Math.cos(_e)*ye,y:w.start.y+Math.sin(_e)*Q,color:ne}),_e+=De,O.push({x:w.start.x+Math.cos(_e)*oe,y:w.start.y+Math.sin(_e)*(Q/2.5),color:ne}),_e+=De;O.push({...O[0]})}else w.type==="group"&&w.shapes.forEach(J=>O.push(...qe(J)));return Jn(O,w)},[Jn]),gt=T.useCallback(w=>{if(!w)return[];let O=[];if(w.type==="pen"||w.type==="polygon"||w.type==="polyline"||w.type==="bezier")O=w.points||[];else if(w.type==="line")O=[{x:w.start.x,y:w.start.y,color:w.startColor||w.color},{x:w.end.x,y:w.end.y,color:w.endColor||w.color}];else if(w.type==="rect"){const J=w.color,Q=w.cornerColors||[J,J,J,J];O=[{x:w.start.x,y:w.start.y,color:Q[0]},{x:w.start.x+w.width,y:w.start.y,color:Q[1]},{x:w.start.x+w.width,y:w.start.y+w.height,color:Q[2]},{x:w.start.x,y:w.start.y+w.height,color:Q[3]}]}else w.type==="circle"||w.type==="star"?O=[w.start,{x:w.end.x,y:w.start.y},{x:w.start.x,y:w.end.y}]:w.type==="group"&&w.shapes.forEach(J=>O.push(...gt(J)));return Jn(O,w)},[Jn]),ts=(w,O,J)=>{const Q=15/z,ne=jn(w);if(J&&Fn(ne,O)<20/z)return{type:"shape"};const ue=gt(w);for(let oe=0;oe<ue.length;oe++)if(Fn(ue[oe],O)<Q)return{type:"point",index:oe};const ye=qe(w);if(w.type==="rect"){for(let oe=0;oe<ye.length-1;oe++)if(Kn(O,ye[oe],ye[oe+1])<Q)return{type:"segment",index:oe};if(Ta(O,ye))return{type:"shape"}}else if(w.type==="circle"||w.type==="star"||w.type==="polyline"||w.type==="polygon"||w.type==="group"||w.type==="pen"||w.type==="bezier"){for(let oe=0;oe<ye.length-1;oe++)if(Kn(O,ye[oe],ye[oe+1])<Q)return{type:"segment",index:oe};if(w.type==="polygon"&&ye.length>2&&Kn(O,ye[ye.length-1],ye[0])<Q)return{type:"segment",index:ye.length-1};if(Fn(ne,O)<Q*1.5)return{type:"shape"}}else if(w.type==="line"&&Kn(O,ye[0],ye[1])<Q)return{type:"segment",index:0};return null},Ga=T.useCallback((w,O)=>{if(!Ie.current)return{x:500,y:500};const J=Ie.current.getBoundingClientRect(),Q=w-J.left,ne=O-J.top;return{x:(Q-J.width/2)/z+mt/2-be.x,y:(ne-J.height/2)/z+mt/2-be.y}},[z,be]),Pn=T.useCallback(w=>Me?Math.round(w/Ce)*Ce:w,[Me,Ce]),Dr=w=>{w.preventDefault();const O=Math.pow(1.1,-w.deltaY/100);ie(J=>Math.max(.1,Math.min(10,J*O)))},gr=w=>{if(w.preventDefault(),h&&N){pn();return}const O=Ga(w.clientX,w.clientY);for(let J=Ye.length-1;J>=0;J--){const Q=ts(Ye[J],O,Y.includes(J));if(Q){tn({visible:!0,x:w.clientX,y:w.clientY,target:{...Q,shapeIndex:J}}),Y.includes(J)||te([J]);return}}tn({visible:!0,x:w.clientX,y:w.clientY,target:{type:"canvas"}})},ns=()=>{if(!xt.target||xt.target.type!=="point")return;const{shapeIndex:w,index:O}=xt.target,J=[...I],Q=[...J[x]],ne={...Q[w]};if(ne.points){let ue=[...ne.points];ne.type==="bezier"?O%2===0&&O===0?ue.splice(0,2):ue.splice(O-1,2):ue=ne.points.filter((ye,oe)=>oe!==O),ue.length<2?(Q.splice(w,1),te([])):(ne.points=ue,Q[w]=ne)}else Q.splice(w,1),te([]);J[x]=Q,M(J),At(J),tn({visible:!1,x:0,y:0,target:null})},Ha=()=>{if(!xt.target||xt.target.type!=="segment")return;const{shapeIndex:w,index:O}=xt.target,J=[...I],Q=[...J[x]],ne={...Q[w]};if(ne.type==="line"||ne.type==="rect"||ne.type==="circle"||ne.type==="star")Q.splice(w,1),te([]);else if(ne.points){if(ne.type==="polygon"){const ue=[];for(let ye=0;ye<ne.points.length;ye++)ue.push(ne.points[(O+1+ye)%ne.points.length]);ne.points=ue,ne.type="polyline",Q[w]=ne}else if(ne.type==="polyline"||ne.type==="pen"){const ue=ne.points.slice(0,O+1),ye=ne.points.slice(O+1);Q.splice(w,1),ue.length>1&&Q.push({...ne,points:ue}),ye.length>1&&Q.push({...ne,points:ye}),te([])}else if(ne.type==="bezier"){const ue=[...ne.points];ue.splice(O,2),ue.length<3?Q.splice(w,1):(ne.points=ue,Q[w]=ne),te([])}}J[x]=Q,M(J),At(J),tn({visible:!1,x:0,y:0,target:null})},Ca=()=>{if(!xt.target||xt.target.type!=="segment")return;const{shapeIndex:w,segmentIndex:O,pos:J}=xt.target,Q=[...I],ne={...Q[x][w]};if(ne.points){const ue=[...ne.points];ue.splice(O+1,0,{...J,color:i}),ne.points=ue,Q[x][w]=ne}else ne.type==="line"&&(Q[x][w]={type:"polyline",color:ne.color,renderMode:ne.renderMode,points:[{x:ne.start.x,y:ne.start.y,color:ne.startColor||ne.color},{x:J.x,y:J.y,color:i},{x:ne.end.x,y:ne.end.y,color:ne.endColor||ne.color}],rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1});M(Q),At(Q),tn({visible:!1,x:0,y:0,target:null})},Ma=async()=>{if(!window.electronAPI)return;const w=await window.electronAPI.showOpenDialog({title:"Select Background Image",filters:[{name:"Images",extensions:["jpg","png","png","webp","bmp"]}],properties:["openFile"]});if(!w)return;const O=new Image;O.onload=()=>{X(O)},O.src=`file://${w}`},oa=()=>{if(H.length!==2){alert("Select exactly 2 points to join them (Shift+Click)");return}if(Y.length===1){const w=Y[0],O=[...I],J={...O[x][w]};if(J.type==="polyline"||J.type==="pen"||J.type==="polygon"){const Q=H[0],ne=H[1];if((Q===0&&ne===J.points.length-1||ne===0&&Q===J.points.length-1)&&J.type!=="polygon"){J.type="polygon",O[x][w]=J,M(O),At(O);return}}}else if(Y.length===2){const w=Y[0],O=Y[1],J=[...I],Q=[...J[x]],ne=Q[w],ue=Q[O];if((ne.type==="polyline"||ne.type==="pen")&&(ue.type==="polyline"||ue.type==="pen")){const ye=ne.points[0],oe=ne.points[ne.points.length-1],_e=ue.points[0],De=ue.points[ue.points.length-1],ze=Fn(oe,_e),ke=Fn(oe,De),ot=Fn(ye,_e),Tt=Fn(ye,De);let cn=[];ze<=ke&&ze<=ot&&ze<=Tt?cn=[...ne.points,...ue.points]:ke<=ze&&ke<=ot&&ke<=Tt?cn=[...ne.points,...[...ue.points].reverse()]:ot<=ze&&ot<=ke&&ot<=Tt?cn=[...[...ne.points].reverse(),...ue.points]:cn=[...ue.points,...ne.points];const ea={...ne,points:cn},Xa=Math.max(w,O),ua=Math.min(w,O);Q.splice(Xa,1),Q.splice(ua,1),Q.push(ea),J[x]=Q,M(J),At(J),te([Q.length-1]),Z([])}}},Ya=async()=>{if(!window.electronAPI)return;const w=await window.electronAPI.showOpenDialog({title:"Import ILDA",filters:[{name:"ILDA Files",extensions:["ild"]}],properties:["openFile"]});if(w){en(!0);try{const O=await window.electronAPI.readFileAsBinary(w),{frames:J}=P1(O);if(J&&J.length>0){const Q=J.map(ne=>{const ue=[];let ye=[];return ne.points.forEach(oe=>{const _e=oe.x*500+500,De=(1-oe.y)*500,ze=`rgb(${oe.r},${oe.g},${oe.b})`;oe.blanking?(ye.length>1&&ue.push({type:"polyline",points:ye,color:ye[0].color,renderMode:"simple",rotation:0}),ye=[]):ye.push({x:_e,y:De,color:ze})}),ye.length>1&&ue.push({type:"polyline",points:ye,color:ye[0].color,renderMode:"simple",rotation:0}),ue});M(Q),At(Q),v(Q.length),b(0)}}catch(O){console.error(O)}finally{en(!1)}}},Mn=async()=>{if(!window.electronAPI)return;const w=await window.electronAPI.showOpenDialog({title:"Import SVG",filters:[{name:"SVG Files",extensions:["svg"]}],properties:["openFile"]});if(w){en(!0);try{const O=await window.electronAPI.readFileContent(w),J=new DOMParser,Q=new TextDecoder().decode(O),ue=J.parseFromString(Q,"image/svg+xml").querySelector("svg");if(!ue)throw new Error("Invalid SVG");let ye=ue.getAttribute("viewBox")?.split(/[\s,]+/).map(parseFloat);if(!ye||ye.length!==4){const Rt=parseFloat(ue.getAttribute("width"))||1e3,Ra=parseFloat(ue.getAttribute("height"))||1e3;ye=[0,0,Rt,Ra]}const[oe,_e,De,ze]=ye,ke=Math.min(mt/De,mt/ze)*.8,ot=(mt-De*ke)/2-oe*ke,Tt=(mt-ze*ke)/2-_e*ke,cn=[],ea=document.createElement("div");ea.style.display="none",ea.innerHTML=Q,document.body.appendChild(ea);const Xa=ea.querySelector("svg"),ua=(Rt,Ra=new DOMMatrix)=>{let un="";const fa=Rt.tagName.toLowerCase();let Ls=new DOMMatrix(Rt.getAttribute("transform")||"");const ya=Ra.multiply(Ls);if(fa==="g"){Array.from(Rt.children).forEach(ta=>ua(ta,ya));return}if(fa==="path")un=Rt.getAttribute("d");else if(fa==="rect"){const ta=parseFloat(Rt.getAttribute("x"))||0,Xn=parseFloat(Rt.getAttribute("y"))||0,Sn=parseFloat(Rt.getAttribute("width"))||0,On=parseFloat(Rt.getAttribute("height"))||0;un=`M${ta},${Xn} h${Sn} v${On} h${-Sn} z`}else if(fa==="circle"||fa==="ellipse"){const ta=parseFloat(Rt.getAttribute("cx"))||0,Xn=parseFloat(Rt.getAttribute("cy"))||0,Sn=parseFloat(Rt.getAttribute("rx"))||parseFloat(Rt.getAttribute("r"))||0,On=parseFloat(Rt.getAttribute("ry"))||parseFloat(Rt.getAttribute("r"))||0;un=`M${ta-Sn},${Xn} a${Sn},${On} 0 1,0 ${Sn*2},0 a${Sn},${On} 0 1,0 ${-Sn*2},0 z`}else fa==="line"?un=`M${Rt.getAttribute("x1")},${Rt.getAttribute("y1")} L${Rt.getAttribute("x2")},${Rt.getAttribute("y2")}`:(fa==="polyline"||fa==="polygon")&&(un=`M${Rt.getAttribute("points")}${fa==="polygon"?" z":""}`);if(!un)return;const da=document.createElementNS("http://www.w3.org/2000/svg","path");da.setAttribute("d",un),Xa.appendChild(da);const yr=da.getTotalLength();if(yr>0){const ta=[],Xn=yr*ke*Math.max(ya.a,ya.d),Sn=Math.min(1e3,Math.max(10,Math.floor(Xn/5)));for(let On=0;On<=Sn;On++){const vr=da.getPointAtLength(On/Sn*yr),ka=new DOMPoint(vr.x,vr.y).matrixTransform(ya);ta.push({x:ka.x*ke+ot,y:ka.y*ke+Tt,color:i})}cn.push({type:"polyline",points:ta,color:i,renderMode:"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1})}};if(Array.from(ue.children).forEach(Rt=>ua(Rt)),document.body.removeChild(ea),cn.length>0){const Rt=[...I];Rt[x]=[...Rt[x]||[],...cn],M(Rt),At(Rt)}}catch(O){console.error("SVG Import Error:",O),alert("Error importing SVG: "+O.message)}finally{en(!1)}}},bn=()=>{if(confirm("Clear all shapes in this frame?")){const w=[...I];w[x]=[],M(w),At(w),te([]),Z([])}},xn=()=>{if(Y.length===0)return;let w;if(H.length>0&&Y.length===1){const O=Ye[Y[0]],J=gt(O);w={type:"polyline",points:H.map(ne=>({...J[ne]})),color:O.color,renderMode:O.renderMode||"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else w=Y.map(O=>JSON.parse(JSON.stringify(Ye[O])));F({data:w,sourceFrameIndex:x}),tn({visible:!1})},_n=()=>{if(!K)return;const{data:w,sourceFrameIndex:O}=K,J=Array.isArray(w)?JSON.parse(JSON.stringify(w)):[JSON.parse(JSON.stringify(w))],Q=[...I],ne=[...Q[x]||[]];J.forEach(ue=>{O===x&&(ue.points?ue.points.forEach(ye=>{ye.x+=20,ye.y+=20}):ue.start&&(ue.start.x+=20,ue.start.y+=20,ue.end.x+=20,ue.end.y+=20)),ne.push(ue)}),Q[x]=ne,M(Q),At(Q),te(J.map((ue,ye)=>ne.length-J.length+ye)),Z([]),tn({visible:!1})},dn=()=>{const w=[...I];w.splice(x+1,0,JSON.parse(JSON.stringify(I[x]))),M(w),At(w),v(O=>O+1),b(O=>O+1)},ar=()=>{if(P>0&&k[P-1]){const w=P-1;q(w),M(JSON.parse(JSON.stringify(k[w])))}},ma=()=>{if(P<k.length-1&&k[P+1]){const w=P+1;q(w),M(JSON.parse(JSON.stringify(k[w])))}},qa=w=>{if(Y.length===0)return;const O=(J,Q)=>{let ne={...J,...Q};return Q.color&&(ne.points&&(ne.points=ne.points.map(ue=>({...ue,color:Q.color}))),ne.startColor&&(ne.startColor=Q.color),ne.endColor&&(ne.endColor=Q.color),ne.cornerColors&&(ne.cornerColors=ne.cornerColors.map(()=>Q.color)),ne.centerColor&&(ne.centerColor=Q.color),ne.outerColor&&(ne.outerColor=Q.color)),ne.type==="group"&&ne.shapes&&(ne.shapes=ne.shapes.map(ue=>O(ue,Q))),ne};M(J=>{const Q=[...J],ne=[...Q[x]];return Y.forEach(ue=>{ne[ue]&&(ne[ue]=O(ne[ue],w))}),Q[x]=ne,At(Q),Q})},as=w=>{Y.length!==1||H.length===0||M(O=>{const J=[...O],Q=[...J[x]],ne=Y[0];if(!Q[ne])return O;const ue={...Q[ne]};return H.forEach(ye=>{if(ue.points)ue.points=[...ue.points],ue.points[ye]&&(ue.points[ye]={...ue.points[ye],color:w});else if(ue.type==="line")ye===0?ue.startColor=w:ue.endColor=w;else if(ue.type==="rect"){ue.cornerColors=ue.cornerColors||[ue.color,ue.color,ue.color,ue.color];const oe=[...ue.cornerColors];oe[ye]=w,ue.cornerColors=oe}else(ue.type==="circle"||ue.type==="star")&&(ye===0?ue.centerColor=w:ue.outerColor=w)}),Q[ne]=ue,J[x]=Q,At(J),J})},rs=async()=>{if(!I.every(w=>w.length===0)){sn(!0);try{const w=I.map(J=>{const Q=[];return J.forEach(ne=>{const ue=ne.renderMode||"simple",ye=qe(ne),oe=_e=>({..._e,x:(_e.x-500)/500,y:1-_e.y/500});if(ne.type==="pen"||ne.type==="polyline"||ne.type==="polygon"||ne.type==="bezier"||ne.type==="rect"||ne.type==="line"){const _e=ye.map(oe);for(let De=0;De<_e.length-1;De++)Q.push(...ga(_e[De],_e[De+1],ue));(ne.type==="polygon"||ne.type==="rect")&&Q.push(...ga(_e[_e.length-1],_e[0],ue))}else if(ne.type==="circle"||ne.type==="star"){const _e=ye.map(oe);for(let De=0;De<_e.length-1;De++){const ze=_e[De],ke=kr(ze.color||ne.color);Q.push({...ze,r:ke.r,g:ke.g,b:ke.b,blanking:ue==="dotted"&&De%2!==0})}}Q.length>0&&(Q[Q.length-1].blanking=!0)}),{points:Q,frameName:"SHAPE"}}),O=Jm(w);await window.electronAPI.saveIldaFile(O,"built_shape.ild")}catch(w){console.error(w)}finally{sn(!1)}}},ga=(w,O,J,Q=.01)=>{const ne=Fn(w,O),ue=[],ye=Math.max(2,Math.floor(ne/Q)),oe=kr(w.color||i),_e=kr(O.color||i);for(let De=0;De<ye;De++){const ze=De/(ye-1);let ke=!1;J==="dotted"?ke=De%2!==0:J==="dashed"?ke=Math.floor(De/4)%2!==0:J==="points"&&(ke=De>0&&De<ye-1),ue.push({x:w.x+(O.x-w.x)*ze,y:w.y+(O.y-w.y)*ze,r:oe.r+(_e.r-oe.r)*ze,g:oe.g+(_e.g-oe.g)*ze,b:oe.b+(_e.b-oe.b)*ze,blanking:ke})}return ue},pn=()=>{if(N&&(N.type==="polygon"||N.type==="polyline"||N.type==="bezier")){let w={...N};if(N.type==="polygon"||N.type==="polyline"?w.points=N.points.slice(0,-1):N.type,w.points.length>1){const O=[...I];O[x]=[...O[x]||[],w],M(O),At(O),te([O[x].length-1])}}p(!1),D(null)},ca=w=>{if(w.button===1||w.button===0&&w.altKey){le.current=!0,Re.current={x:w.clientX,y:w.clientY};return}if(w.button!==0)return;const O=Ga(w.clientX,w.clientY),J=Pn(O.x),Q=Pn(O.y);if(tn({visible:!1}),e==="select"){let ne=-1,ue=null,ye=-1;for(let oe=Ye.length-1;oe>=0;oe--){const _e=ts(Ye[oe],O,Y.includes(oe));if(_e){ne=oe,ue=_e.type,ye=_e.index;break}}ne!==-1?(ue==="point"?(w.shiftKey?Y.includes(ne)?Z(oe=>oe.includes(ye)?oe.filter(_e=>_e!==ye):[...oe,ye]):(te([ne]),Z([ye])):(Z([ye]),te([ne])),wt.current=!0):(!w.shiftKey&&!Y.includes(ne)?te([ne]):w.shiftKey&&te(oe=>oe.includes(ne)?oe.filter(_e=>_e!==ne):[...oe,ne]),nn.current=!0),Re.current=O):(ln.current=!0,Re.current=O,It.current={x:O.x,y:O.y,w:0,h:0});return}if(p(!0),Re.current=O,e==="polygon"||e==="polyline"||(e==="line"||e==="bezier")&&at)D(N?e==="bezier"?ne=>({...ne,points:[...ne.points,{x:J,y:Q,color:i},{x:J,y:Q,color:i}]}):ne=>({...ne,points:[...ne.points,{x:J,y:Q,color:i}]}):e==="bezier"?{type:"bezier",color:i,renderMode:c,points:[{x:J,y:Q,color:i},{x:J,y:Q,color:i},{x:J,y:Q,color:i}],rotation:0}:{type:e==="polygon"?"polygon":"polyline",color:i,renderMode:c,points:[{x:J,y:Q,color:i},{x:J,y:Q,color:i}],rotation:0});else{const ne={type:e,color:i,renderMode:c,start:{x:J,y:Q},end:{x:J,y:Q},width:0,height:0,rotation:0,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0};e==="pen"?ne.points=[{x:J,y:Q,color:i},{x:J,y:Q,color:i}]:e==="bezier"&&(ne.points=[{x:J,y:Q,color:i},{x:J,y:Q,color:i},{x:J,y:Q,color:i}]),D(ne)}},Pt=T.useCallback((w,O,J)=>(w.type==="group"?w.shapes=w.shapes.map(Q=>Pt({...Q},O,J)):(w.points&&(w.points=w.points.map(Q=>({...Q,x:Q.x+O,y:Q.y+J}))),w.start&&(w.start.x+=O,w.start.y+=J),w.end&&(w.end.x+=O,w.end.y+=J)),w),[]),it=w=>{const O=Ga(w.clientX,w.clientY);if(le.current){const ne=(w.clientX-Re.current.x)/z,ue=(w.clientY-Re.current.y)/z;U(ye=>({x:ye.x+ne,y:ye.y+ue})),Re.current={x:w.clientX,y:w.clientY};return}if(Ue.current&&Y.length>0){const ne=jn(Ye[Y[0]]);qa({rotationZ:Math.atan2(O.y-ne.y,O.x-ne.x)+Math.PI/2});return}if(ln.current){It.current={x:Math.min(Re.current.x,O.x),y:Math.min(Re.current.y,O.y),w:Math.abs(O.x-Re.current.x),h:Math.abs(O.y-Re.current.y)};return}if(nn.current){const ne=O.x-Re.current.x,ue=O.y-Re.current.y;let ye=0,oe=0;Me?(ye=Math.round(ne/Ce)*Ce,oe=Math.round(ue/Ce)*Ce):(ye=ne,oe=ue),(ye!==0||oe!==0)&&(M(_e=>{const De=[..._e],ze=[...De[x]];return Y.forEach(ke=>{ze[ke]=Pt({...ze[ke]},ye,oe)}),De[x]=ze,De}),Me?(Re.current.x+=ye,Re.current.y+=oe):Re.current=O);return}if(wt.current&&Y.length===1){const ne=O.x-Re.current.x,ue=O.y-Re.current.y;let ye=0,oe=0;Me?(ye=Math.round(ne/Ce)*Ce,oe=Math.round(ue/Ce)*Ce):(ye=ne,oe=ue),(ye!==0||oe!==0)&&(M(_e=>{const De=[..._e],ze=[...De[x]],ke={...ze[Y[0]]};return H.forEach(ot=>{ke.type==="line"?ot===0?(ke.start.x+=ye,ke.start.y+=oe):(ke.end.x+=ye,ke.end.y+=oe):ke.type==="rect"?ot===0?(ke.start.x+=ye,ke.start.y+=oe,ke.width-=ye,ke.height-=oe):ot===1?(ke.start.y+=oe,ke.width+=ye,ke.height-=oe):ot===2?(ke.width+=ye,ke.height+=oe):ot===3&&(ke.start.x+=ye,ke.width-=ye,ke.height+=oe):ke.type==="circle"||ke.type==="star"?ot===0?(ke.start.x+=ye,ke.start.y+=oe):ot===1?ke.end.x+=ye:ot===2&&(ke.end.y+=oe):ke.points&&(ke.points=[...ke.points],ke.points[ot]&&(ke.points[ot]={...ke.points[ot],x:ke.points[ot].x+ye,y:ke.points[ot].y+oe}))}),ze[Y[0]]=ke,De[x]=ze,De}),Me?(Re.current.x+=ye,Re.current.y+=oe):Re.current=O);return}if(!h)return;const J=Pn(O.x),Q=Pn(O.y);D(ne=>{if(!ne)return null;const ue={...ne},ye=w.shiftKey;if(e==="pen")ue.points=[...ne.points,{x:J,y:Q,color:i}];else if(e==="bezier"){const oe=[...ue.points];if(oe.length>=3){const _e=oe[oe.length-3],De={x:(_e.x+J)/2,y:(_e.y+Q)/2};oe[oe.length-2]={x:De.x,y:De.y,color:i},oe[oe.length-1]={x:J,y:Q,color:i}}ue.points=oe}else if(ue.type==="polyline"||ue.type==="polygon"){const oe=[...ue.points];let _e=J,De=Q;if(ye){const ze=oe[oe.length-2];Math.abs(J-ze.x)>Math.abs(Q-ze.y)?De=ze.y:_e=ze.x}oe[oe.length-1]={x:_e,y:De,color:i},ue.points=oe}else if(e==="line"){let oe=J,_e=Q;ye&&(Math.abs(J-Re.current.x)>Math.abs(Q-Re.current.y)?_e=Re.current.y:oe=Re.current.x),ue.end={x:oe,y:_e}}else if(e==="circle"||e==="star"){let oe=J,_e=Q;if(ye){const De=Math.max(Math.abs(J-Re.current.x),Math.abs(Q-Re.current.y));oe=Re.current.x+(J>=Re.current.x?De:-De),_e=Re.current.y+(Q>=Re.current.y?De:-De)}ue.end={x:oe,y:_e}}else if(e==="rect"){let oe=J-Re.current.x,_e=Q-Re.current.y;if(ye){const De=Math.max(Math.abs(oe),Math.abs(_e));oe=oe>0?De:-De,_e=_e>0?De:-De}ue.width=oe,ue.height=_e}return ue})},Na=()=>{if(ln.current&&It.current){const J=It.current;if(J.w<5/z&&J.h<5/z)te([]),Z([]);else{const Q=[];Ye.forEach((ne,ue)=>{const ye=Bn(ne);ye.x<J.x+J.w&&ye.x+ye.w>J.x&&ye.y<J.y+J.h&&ye.y+ye.h>J.y&&Q.push(ue)}),te(Q)}}if((wt.current||nn.current)&&At(I),wt.current=!1,nn.current=!1,Ue.current=!1,ln.current=!1,le.current=!1,It.current=null,!h)return;const w=N.type==="polygon"||N.type==="polyline",O=N.type==="bezier"&&at;if(N&&!w&&!O){const J=[...I];J[x]=[...J[x]||[],N],M(J),At(J),te([J[x].length-1]),p(!1),D(null)}},Vn=(w,O,J,Q=!1)=>{if(!O)return;if(w.save(),O.type==="group"){O.shapes.forEach(oe=>Vn(w,oe,J,Q)),w.restore();return}const ne=jn(O);w.lineWidth=(J?2.5:1.5)/z;const ue=(oe,_e)=>{if(!oe||oe.length<2)return;let De=!1;w.beginPath(),oe[0]&&w.moveTo(oe[0].x,oe[0].y);for(let ze=0;ze<oe.length-1;ze++){const ke=oe[ze],ot=oe[ze+1];if(!ke||!ot)continue;const Tt=Q?"#444":ke.color||O.color,cn=Q?"#444":ot.color||O.color;if(Tt!==cn){De&&(w.stroke(),De=!1);const ea=w.createLinearGradient(ke.x,ke.y,ot.x,ot.y);ea.addColorStop(0,Tt),ea.addColorStop(1,cn),w.strokeStyle=ea,w.beginPath(),w.moveTo(ke.x,ke.y),w.lineTo(ot.x,ot.y),w.stroke(),w.beginPath(),w.moveTo(ot.x,ot.y)}else w.strokeStyle!==Tt&&(De&&(w.stroke(),w.beginPath(),w.moveTo(ke.x,ke.y)),w.strokeStyle=Tt),w.lineTo(ot.x,ot.y),De=!0}if(_e&&oe.length>2){const ze=oe[oe.length-1],ke=oe[0],ot=Q?"#444":ze.color||O.color,Tt=Q?"#444":ke.color||O.color;if(ot!==Tt){De&&w.stroke();const cn=w.createLinearGradient(ze.x,ze.y,ke.x,ke.y);cn.addColorStop(0,ot),cn.addColorStop(1,Tt),w.strokeStyle=cn,w.beginPath(),w.moveTo(ze.x,ze.y),w.lineTo(ke.x,ke.y),w.stroke()}else w.strokeStyle!==ot&&De&&(w.stroke(),w.beginPath(),w.moveTo(ze.x,ze.y),w.strokeStyle=ot),w.lineTo(ke.x,ke.y),w.stroke(),De=!1}else De&&w.stroke()},ye=(oe,_e)=>{if(!oe||!_e)return;const De=Q?"#444":oe.color||O.color,ze=Q?"#444":_e.color||O.color;if(De===ze)w.strokeStyle=De;else{const ke=w.createLinearGradient(oe.x,oe.y,_e.x,_e.y);ke.addColorStop(0,De),ke.addColorStop(1,ze),w.strokeStyle=ke}w.beginPath(),w.moveTo(oe.x,oe.y),w.lineTo(_e.x,_e.y),w.stroke()};if(O.renderMode==="points"){qe({...O,rotation:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}).forEach(oe=>{w.fillStyle=Q?"#444":oe.color||O.color,w.beginPath(),w.arc(oe.x,oe.y,3/z,0,Math.PI*2),w.fill()}),w.restore();return}switch(O.type){case"pen":case"polyline":case"bezier":{const oe=qe(O);ue(oe,!1);break}case"polygon":{const oe=qe(O);ue(oe,!0);break}case"line":{const oe=qe(O);ye(oe[0],oe[1]);break}case"rect":{const oe=qe(O);ue(oe,!0);break}case"circle":{const oe=qe(O);ue(oe,!0);break}case"star":{const oe=qe(O);ue(oe,!0);break}}if(J&&!Q){const oe=gt(O);oe.forEach((De,ze)=>{const ke=H.includes(ze);w.fillStyle=ke?"var(--theme-color)":"white",w.beginPath(),w.arc(De.x,De.y,5/z,0,Math.PI*2),w.fill(),w.strokeStyle=ke?"white":"black",w.lineWidth=1/z,w.stroke()});const _e=Math.min(...oe.map(De=>De.y));w.beginPath(),w.moveTo(ne.x,_e),w.lineTo(ne.x,_e-30/z),w.strokeStyle="white",w.stroke(),w.beginPath(),w.arc(ne.x,_e-30/z,6/z,0,Math.PI*2),w.fillStyle="#0089ff",w.fill(),w.stroke()}w.restore()};T.useEffect(()=>{const w=Ie.current;if(!w)return;const O=w.getContext("2d");(()=>{if(Ie.current){if(O.save(),O.clearRect(0,0,w.width,w.height),O.translate(w.width/2,w.height/2),O.scale(z,z),O.translate(-mt/2+be.x,-mt/2+be.y),O.fillStyle="#000",O.fillRect(0,0,mt,mt),ee){O.beginPath(),O.strokeStyle="#222",O.lineWidth=.5/z;for(let Q=0;Q<=mt;Q+=Ce)O.moveTo(Q,0),O.lineTo(Q,mt);for(let Q=0;Q<=mt;Q+=Ce)O.moveTo(0,Q),O.lineTo(mt,Q);O.stroke(),O.beginPath(),O.strokeStyle="#444",O.lineWidth=1/z,O.moveTo(mt/2,0),O.lineTo(mt/2,mt),O.moveTo(0,mt/2),O.lineTo(mt,mt/2),O.stroke()}W&&(O.globalAlpha=.3,O.drawImage(W,0,0,mt,mt),O.globalAlpha=1),C&&x>0&&!S&&(O.globalAlpha=.15,I[x-1].forEach(Q=>Vn(O,Q,!1,!0)),O.globalAlpha=1),Ye.length>0&&Ye.forEach((Q,ne)=>Vn(O,Q,Y.includes(ne))),h&&N&&Vn(O,N,!1),ln.current&&It.current&&(O.fillStyle="rgba(0, 137, 255, 0.15)",O.fillRect(It.current.x,It.current.y,It.current.w,It.current.h),O.strokeStyle="#0089ff",O.lineWidth=1/z,O.setLineDash([]),O.strokeRect(It.current.x,It.current.y,It.current.w,It.current.h)),O.restore()}})()},[I,x,N,h,W,ee,Ce,Y,H,C,S,z,be]),T.useEffect(()=>{const w=rt.current;if(w)return w.addEventListener("wheel",Dr,{passive:!1}),()=>w.removeEventListener("wheel",Dr)},[z]),T.useEffect(()=>{M(w=>{const O=[...w];if(y>w.length)for(let J=w.length;J<y;J++)O.push([]);else if(y<w.length)return O.slice(0,y);return O})},[y]),T.useEffect(()=>(S?qt.current=setInterval(()=>b(w=>(w+1)%y),1e3/12):clearInterval(qt.current),()=>clearInterval(qt.current)),[S,y]),T.useEffect(()=>{const w=O=>{tn({visible:!1,x:0,y:0,target:null}),h&&N&&O.target!==Ie.current&&pn()};return window.addEventListener("click",w),()=>window.removeEventListener("click",w)},[h,N]),T.useEffect(()=>{te([]),Z([])},[x]),T.useEffect(()=>{const w=O=>{if((O.ctrlKey||O.metaKey)&&O.key==="z")O.preventDefault(),ar();else if((O.ctrlKey||O.metaKey)&&O.key==="y")O.preventDefault(),ma();else if((O.ctrlKey||O.metaKey)&&O.key==="c")O.preventDefault(),xn();else if((O.ctrlKey||O.metaKey)&&O.key==="v")O.preventDefault(),_n();else if((O.key==="Delete"||O.key==="Backspace")&&Y.length>0&&document.activeElement.tagName!=="INPUT"){const J=[...I];J[x]=J[x].filter((Q,ne)=>!Y.includes(ne)),M(J),At(J),te([]),Z([])}};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[I,x,Y,K,k,P]);const Nn=({active:w,onClick:O,icon:J})=>m.jsx("button",{onClick:O,style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:w?"var(--theme-color)":"#222",color:w?"black":"#888",border:"none",borderRadius:"4px",fontSize:"1.2rem",padding:0},children:m.jsx("i",{className:`bi ${J}`})}),Va=({active:w,onClick:O,children:J})=>m.jsx("button",{onClick:O,style:{background:w?"#444":"#222",color:w?"var(--theme-color)":"#888",border:w?"1px solid var(--theme-color)":"1px solid #333",fontSize:"0.7rem",padding:"5px"},children:J}),Is=Y.length===1&&Ye[Y[0]]&&H.length>0?gt(Ye[Y[0]])[H[0]]?.color||Ye[Y[0]].color:"#000000";return m.jsxs("div",{className:"shape-builder",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column",userSelect:"none"},children:[Jt&&m.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e4,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsx("h3",{children:"WORKING..."})}),m.jsxs("header",{style:{height:"50px",padding:"0 20px",background:"#1a1a1a",borderBottom:"1px solid #333",display:"flex",alignItems:"center",gap:"15px"},children:[m.jsx("h2",{style:{margin:0,fontSize:"1rem",color:"var(--theme-color)",width:"180px"},children:"SHAPE BUILDER"}),m.jsxs("div",{className:"action-group",style:{display:"flex",gap:"8px"},children:[m.jsx("button",{onClick:ar,title:"Undo",children:m.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),m.jsx("button",{onClick:ma,title:"Redo",children:m.jsx("i",{className:"bi bi-arrow-clockwise"})}),m.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),m.jsx("button",{onClick:xn,title:"Copy",children:m.jsx("i",{className:"bi bi-clipboard"})}),m.jsx("button",{onClick:_n,title:"Paste",children:m.jsx("i",{className:"bi bi-clipboard-check"})}),m.jsx("button",{onClick:oa,title:"Join Points / Shapes",children:m.jsx("i",{className:"bi bi-share"})}),m.jsx("button",{onClick:on,title:"Group",disabled:Y.length<2,children:m.jsx("i",{className:"bi bi-intersect"})}),m.jsx("button",{onClick:es,title:"Ungroup",disabled:Y.length!==1||Ye[Y[0]]?.type!=="group",children:m.jsx("i",{className:"bi bi-exclude"})}),m.jsx("button",{onClick:Mn,title:"Import SVG",children:m.jsx("i",{className:"bi bi-vector-pen"})}),m.jsx("button",{onClick:Ya,title:"Import ILDA",children:m.jsx("i",{className:"bi bi-folder2-open"})}),m.jsx("button",{onClick:Ma,title:"Import Background Image",children:m.jsx("i",{className:"bi bi-image"})}),m.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),m.jsx("button",{onClick:bn,title:"Clear All",children:m.jsx("i",{className:"bi bi-trash"})}),m.jsx("button",{onClick:()=>{ie(.6),U({x:0,y:0})},title:"Recenter",children:m.jsx("i",{className:"bi bi-aspect-ratio"})})]}),m.jsxs("div",{className:"grid-controls",style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.8rem",marginLeft:"15px"},children:[m.jsxs("label",{children:[m.jsx("input",{type:"checkbox",checked:ee,onChange:w=>ve(w.target.checked)})," Grid"]}),m.jsxs("label",{children:[m.jsx("input",{type:"checkbox",checked:Me,onChange:w=>me(w.target.checked)})," Snap"]}),(e==="line"||e==="bezier")&&m.jsxs("label",{children:[m.jsx("input",{type:"checkbox",checked:at,onChange:w=>tt(w.target.checked)})," Continuous"]}),m.jsxs("select",{value:Ce,onChange:w=>Oe(parseInt(w.target.value)),style:{background:"#222",color:"white",border:"1px solid #444",borderRadius:"3px"},children:[m.jsx("option",{value:"10",children:"10px"}),m.jsx("option",{value:"25",children:"25px"}),m.jsx("option",{value:"50",children:"50px"}),m.jsx("option",{value:"100",children:"100px"})]})]}),m.jsx("button",{onClick:a,style:{marginLeft:"auto"},children:"Back to Show Control"})]}),m.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[m.jsxs("aside",{style:{width:"60px",background:"#1a1a1a",borderRight:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 0",gap:"10px"},children:[m.jsx(Nn,{active:e==="select",onClick:()=>{r("select"),p(!1),D(null)},icon:"bi-cursor"}),m.jsx(Nn,{active:e==="pen",onClick:()=>{r("pen"),p(!1),D(null)},icon:"bi-pencil"}),m.jsx(Nn,{active:e==="bezier",onClick:()=>{r("bezier"),p(!1),D(null)},icon:"bi-bezier2"}),m.jsx(Nn,{active:e==="line",onClick:()=>{r("line"),p(!1),D(null)},icon:"bi-slash-lg"}),m.jsx(Nn,{active:e==="rect",onClick:()=>{r("rect"),p(!1),D(null)},icon:"bi-square"}),m.jsx(Nn,{active:e==="circle",onClick:()=>{r("circle"),p(!1),D(null)},icon:"bi-circle"}),m.jsx(Nn,{active:e==="polygon",onClick:()=>{r("polygon"),p(!1),D(null)},icon:"bi-pentagon"}),m.jsx(Nn,{active:e==="star",onClick:()=>{r("star"),p(!1),D(null)},icon:"bi-star"}),m.jsx("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:m.jsx("input",{type:"color",value:i,onChange:w=>{o(w.target.value),Y.length>0&&qa({color:w.target.value})},style:{width:"30px",height:"30px",border:"none",background:"none",cursor:"pointer"}})})]}),m.jsxs("main",{style:{flex:1,background:"#050505",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[m.jsxs("div",{ref:rt,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[m.jsx("canvas",{ref:Ie,width:window.innerWidth-300,height:window.innerHeight-130,onMouseDown:ca,onMouseMove:it,onMouseUp:Na,onContextMenu:gr,onDoubleClick:pn,style:{background:"transparent"}}),xt.visible&&m.jsxs("div",{className:"context-menu",style:{position:"fixed",top:xt.y,left:xt.x,background:"#222",border:"1px solid #444",borderRadius:"4px",padding:"5px 0",zIndex:1e4},children:[xt.target?.type==="point"&&m.jsx("div",{className:"menu-item",onClick:ns,children:"Delete Point"}),xt.target?.type==="segment"&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"menu-item",onClick:Ha,children:"Delete Line"}),m.jsx("div",{className:"menu-item",onClick:Ca,children:"Split Line"})]}),xt.target?.type==="shape"&&m.jsx("div",{className:"menu-item",onClick:()=>{M(w=>{const O=[...w];return O[x]=O[x].filter((J,Q)=>Q!==xt.target.shapeIndex),O}),tn({visible:!1})},children:"Delete Shape"}),W&&m.jsx("div",{className:"menu-item",onClick:()=>{X(null),tn({visible:!1})},children:"Clear Background"}),m.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),m.jsx("div",{className:"menu-item",onClick:xn,children:"Copy"}),m.jsx("div",{className:"menu-item",onClick:_n,children:"Paste"})]})]}),m.jsxs("div",{className:"timeline-bar",style:{height:"80px",background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",alignItems:"center",padding:"0 20px",gap:"20px"},children:[m.jsxs("div",{className:"playback-controls",style:{display:"flex",gap:"10px"},children:[m.jsx("button",{onClick:()=>E(!S),style:{width:"40px",height:"40px",borderRadius:"50%",background:S?"var(--theme-color)":"#333",color:S?"black":"white"},children:m.jsx("i",{className:`bi ${S?"bi-pause-fill":"bi-play-fill"}`})}),m.jsx("button",{onClick:()=>b(w=>Math.max(0,w-1)),children:m.jsx("i",{className:"bi bi-chevron-left"})}),m.jsx("button",{onClick:()=>b(w=>Math.min(y-1,w+1)),children:m.jsx("i",{className:"bi bi-chevron-right"})}),m.jsx("button",{onClick:dn,title:"Duplicate Frame",children:m.jsx("i",{className:"bi bi-layers-half"})})]}),m.jsxs("div",{className:"frame-slider-container",style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#666"},children:[m.jsxs("span",{children:["FRAME ",x+1," / ",y]}),m.jsxs("label",{children:[m.jsx("input",{type:"checkbox",checked:C,onChange:w=>_(w.target.checked)})," Onion Skin"]})]}),m.jsx("input",{type:"range",min:"0",max:y-1,value:x,onChange:w=>b(parseInt(w.target.value))})]}),m.jsxs("div",{className:"timeline-settings",style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"LENGTH:"}),m.jsx("input",{type:"number",min:"1",max:"999",value:y,onChange:w=>v(Math.max(1,parseInt(w.target.value)||1)),style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]})]})]}),m.jsxs("aside",{style:{width:"240px",background:"#1a1a1a",borderLeft:"1px solid #333",padding:"15px",display:"flex",flexDirection:"column",gap:"20px"},children:[m.jsx("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",borderBottom:"1px solid #333",paddingBottom:"5px"},children:"PROPERTIES"}),Y.length>1&&m.jsx("div",{className:"group-actions",style:{marginBottom:"15px"},children:m.jsxs("button",{className:"primary-btn",style:{width:"100%"},onClick:on,children:["GROUP SELECTED (",Y.length,")"]})}),Y.length===1&&Ye[Y[0]]?.type==="group"&&m.jsx("div",{className:"group-actions",style:{marginBottom:"15px"},children:m.jsx("button",{onClick:es,style:{width:"100%"},children:"UNGROUP"})}),Y.length>0?m.jsxs("div",{className:"shape-properties",style:{display:"flex",flexDirection:"column",gap:"15px"},children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#666",display:"block"},children:Y.length===1?`TYPE: ${Ye[Y[0]]?.type?.toUpperCase()}`:`${Y.length} SHAPES SELECTED`}),m.jsxs("div",{className:"property-group",children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"COLOR"}),m.jsx("input",{type:"color",value:Ye[Y[0]]?.color||"#ffffff",onChange:w=>qa({color:w.target.value}),style:{width:"100%",height:"30px",background:"none",border:"1px solid #444",cursor:"pointer"}})]}),m.jsxs("div",{className:"property-group",children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"SCALE X / Y"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("input",{type:"number",step:"0.1",value:Ye[Y[0]]?.scaleX||1,onChange:w=>qa({scaleX:parseFloat(w.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}}),m.jsx("input",{type:"number",step:"0.1",value:Ye[Y[0]]?.scaleY||1,onChange:w=>qa({scaleY:parseFloat(w.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}})]})]}),m.jsxs("div",{className:"property-group",children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"ROTATION X / Y / Z (DEG)"}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:["rotationX","rotationY","rotationZ"].map(w=>{const O=Ye[Y[0]]?.[w]||0,J=Math.round(O*180/Math.PI*100)/100;return m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("span",{style:{fontSize:"0.7rem",color:"#555",width:"10px"},children:w.slice(-1)}),m.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:J,onChange:Q=>qa({[w]:parseFloat(Q.target.value)*Math.PI/180}),style:{flex:1}}),m.jsx("input",{type:"number",value:J,onChange:Q=>qa({[w]:(parseFloat(Q.target.value)||0)*Math.PI/180}),style:{width:"50px",background:"#111",border:"1px solid #444",color:"white",padding:"2px",fontSize:"0.7rem"}})]},w)})})]}),m.jsxs("div",{className:"property-group",children:[m.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"RENDER MODE"}),m.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:["simple","dotted","dashed","points"].map(w=>m.jsx(Va,{active:Ye[Y[0]]?.renderMode===w,onClick:()=>qa({renderMode:w}),children:w},w))})]})]}):m.jsx("p",{style:{fontSize:"0.8rem",color:"#555",textAlign:"center",marginTop:"20px"},children:"Select shapes or drag a box to begin."}),H.length>0&&Y.length===1&&m.jsxs("div",{className:"point-properties",style:{background:"#222",padding:"10px",borderRadius:"4px",border:"1px solid var(--theme-color)"},children:[m.jsxs("label",{style:{fontSize:"0.8rem",color:"var(--theme-color)",display:"block",marginBottom:"5px"},children:[H.length," POINTS SELECTED"]}),m.jsx("input",{type:"color",value:Is,onChange:w=>as(w.target.value),style:{width:"100%",height:"40px",background:"none",border:"1px solid #444",cursor:"pointer"}})]}),m.jsx("div",{style:{marginTop:"auto"},children:m.jsx("button",{className:"primary-btn",style:{width:"100%",padding:"12px"},onClick:rs,disabled:I.every(w=>w.length===0)||bt,children:bt?"EXPORTING...":"SAVE AS CLIP"})})]})]}),m.jsx("style",{children:`
        button { padding: 4px 10px; background: #333; border: 1px solid #444; color: #ccc; border-radius: 3px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; }
        button:hover:not(:disabled) { background: #444; color: white; }
        .primary-btn { background: var(--theme-color) !important; color: black !important; font-weight: bold; border: none !important; }
        .context-menu { background: #222; border: 1px solid #444; border-radius: 4px; padding: 5px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-width: 120px; }
        .context-menu .menu-item { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; color: #ccc; }
        .context-menu .menu-item:hover { background: var(--theme-color); color: black; }
        input[type="range"] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--theme-color); border-radius: 50%; cursor: pointer; }
      `})]})},G1=({onBack:a})=>m.jsxs("div",{className:"timeline-editor-page",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column"},children:[m.jsxs("header",{style:{padding:"10px 20px",borderBottom:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx("h2",{children:"Timeline Editor (Coming Soon)"}),m.jsx("button",{onClick:a,style:{padding:"8px 16px",background:"#ff5e00",border:"none",color:"white",borderRadius:"4px",cursor:"pointer"},children:"Back to Show Control"})]}),m.jsx("main",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:m.jsxs("div",{style:{textAlign:"center"},children:[m.jsx("p",{children:"This is the Timeline Editor placeholder."}),m.jsx("p",{children:"Goal: Arrange clips on a timeline for synchronized playback."})]})})]}),H1=({show:a,onClose:e,initialTab:r="output"})=>{const[i,o]=T.useState(r);return ha.useEffect(()=>{a&&o(r)},[a,r]),a?m.jsxs("div",{className:"modal-overlay",children:[m.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[m.jsxs("div",{className:"modal-header",children:[m.jsx("h3",{children:"About"}),m.jsx("button",{className:"close-btn",onClick:e,children:""})]}),m.jsx("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"}}),m.jsx("div",{className:"modal-body",children:m.jsx("div",{className:"audio-output-settings"})})]}),m.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]}):null},eg=T.createContext(null),Y1=()=>T.useContext(eg),q1=({children:a})=>{const[e,r]=T.useState(null);return T.useEffect(()=>{if(!e){const i=new Worker(new URL(""+new URL("ilda-parser.worker-XXY4JEks.js",import.meta.url).href,import.meta.url));r(i)}return()=>{e&&e.terminate()}},[e]),m.jsx(eg.Provider,{value:e,children:a})},tg=T.createContext(null),V1=({children:a})=>{const e=T.useMemo(()=>{try{const r=new Worker(new URL(""+new URL("generators.worker-Ccw3pDxU.js",import.meta.url).href,import.meta.url),{type:"module"});return r.onerror=i=>{console.error("Generator Worker instantiation or internal error:",i)},r}catch(r){return console.error("Failed to create Generator Worker:",r),null}},[]);return T.useEffect(()=>{if(e)return()=>{e.terminate()}},[e]),m.jsx(tg.Provider,{value:e,children:a})},X1=()=>{const a=T.useContext(tg);if(a===void 0)throw new Error("useGeneratorWorker must be used within a GeneratorWorkerProvider");return a};var $1=Bm();const Z1=nd($1),Q1=()=>{const{isMapping:a,mappings:e,learningId:r}=Cc(),{isMapping:i,mappings:o,learningId:c}=rd()||{},{isMapping:f,mappings:h,learningId:p}=sd()||{},y=a||i||f,[v,x]=T.useState([]),b=T.useCallback(()=>{if(!y)return;const S=document.querySelectorAll("[data-mappable-id]"),E=Array.from(S).map(C=>{const _=C.getBoundingClientRect();return{id:C.getAttribute("data-mappable-id"),rect:{top:_.top,left:_.left,width:_.width,height:_.height}}});x(E)},[y]);return T.useEffect(()=>{if(y){b(),window.addEventListener("resize",b);const S=setTimeout(b,100);return()=>{window.removeEventListener("resize",b),clearTimeout(S)}}else x([])},[y,b]),y?Z1.createPortal(m.jsx("div",{className:"midi-mapping-global-overlay-container",children:v.map(S=>{const E=e[S.id],C=o?o[S.id]:null,_=h?h[S.id]:null,I=a&&r===S.id||i&&c===S.id||f&&p===S.id;let M=null;return a?M=E?E.label:null:i?M=C?C.label:null:f&&(M=_?_.label:null),m.jsx("div",{className:`midi-mapping-label-box ${I?"learning":""} ${M?"mapped":""} ${i?"artnet-mapping":""} ${f?"keyboard-mapping":""}`,style:{position:"fixed",top:S.rect.top,left:S.rect.left,width:S.rect.width,height:S.rect.height,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:m.jsx("div",{className:"mapping-label",children:M||"+"})},S.id)})}),document.body):null};String.prototype.codePointAt||(function(){var a=(function(){try{var r={},i=Object.defineProperty,o=i(r,r,r)&&i}catch{}return o})(),e=function(r){if(this==null)throw TypeError();var i=String(this),o=i.length,c=r?Number(r):0;if(c!=c&&(c=0),!(c<0||c>=o)){var f=i.charCodeAt(c),h;return f>=55296&&f<=56319&&o>c+1&&(h=i.charCodeAt(c+1),h>=56320&&h<=57343)?(f-55296)*1024+h-56320+65536:f}};a?a(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var od=0,ng=-3;function $l(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function W1(a,e){this.source=a,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new $l,this.dtree=new $l}var ag=new $l,rg=new $l,cd=new Uint8Array(30),ud=new Uint16Array(30),sg=new Uint8Array(30),ig=new Uint16Array(30),K1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Q0=new $l,Cr=new Uint8Array(320);function lg(a,e,r,i){var o,c;for(o=0;o<r;++o)a[o]=0;for(o=0;o<30-r;++o)a[o+r]=o/r|0;for(c=i,o=0;o<30;++o)e[o]=c,c+=1<<a[o]}function J1(a,e){var r;for(r=0;r<7;++r)a.table[r]=0;for(a.table[7]=24,a.table[8]=152,a.table[9]=112,r=0;r<24;++r)a.trans[r]=256+r;for(r=0;r<144;++r)a.trans[24+r]=r;for(r=0;r<8;++r)a.trans[168+r]=280+r;for(r=0;r<112;++r)a.trans[176+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}var W0=new Uint16Array(16);function Of(a,e,r,i){var o,c;for(o=0;o<16;++o)a.table[o]=0;for(o=0;o<i;++o)a.table[e[r+o]]++;for(a.table[0]=0,c=0,o=0;o<16;++o)W0[o]=c,c+=a.table[o];for(o=0;o<i;++o)e[r+o]&&(a.trans[W0[e[r+o]]++]=o)}function eb(a){a.bitcount--||(a.tag=a.source[a.sourceIndex++],a.bitcount=7);var e=a.tag&1;return a.tag>>>=1,e}function Mr(a,e,r){if(!e)return r;for(;a.bitcount<24;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var i=a.tag&65535>>>16-e;return a.tag>>>=e,a.bitcount-=e,i+r}function Xf(a,e){for(;a.bitcount<24;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var r=0,i=0,o=0,c=a.tag;do i=2*i+(c&1),c>>>=1,++o,r+=e.table[o],i-=e.table[o];while(i>=0);return a.tag=c,a.bitcount-=o,e.trans[r+i]}function tb(a,e,r){var i,o,c,f,h,p;for(i=Mr(a,5,257),o=Mr(a,5,1),c=Mr(a,4,4),f=0;f<19;++f)Cr[f]=0;for(f=0;f<c;++f){var y=Mr(a,3,0);Cr[K1[f]]=y}for(Of(Q0,Cr,0,19),h=0;h<i+o;){var v=Xf(a,Q0);switch(v){case 16:var x=Cr[h-1];for(p=Mr(a,2,3);p;--p)Cr[h++]=x;break;case 17:for(p=Mr(a,3,3);p;--p)Cr[h++]=0;break;case 18:for(p=Mr(a,7,11);p;--p)Cr[h++]=0;break;default:Cr[h++]=v;break}}Of(e,Cr,0,i),Of(r,Cr,i,o)}function K0(a,e,r){for(;;){var i=Xf(a,e);if(i===256)return od;if(i<256)a.dest[a.destLen++]=i;else{var o,c,f,h;for(i-=257,o=Mr(a,cd[i],ud[i]),c=Xf(a,r),f=a.destLen-Mr(a,sg[c],ig[c]),h=f;h<f+o;++h)a.dest[a.destLen++]=a.dest[h]}}}function nb(a){for(var e,r,i;a.bitcount>8;)a.sourceIndex--,a.bitcount-=8;if(e=a.source[a.sourceIndex+1],e=256*e+a.source[a.sourceIndex],r=a.source[a.sourceIndex+3],r=256*r+a.source[a.sourceIndex+2],e!==(~r&65535))return ng;for(a.sourceIndex+=4,i=e;i;--i)a.dest[a.destLen++]=a.source[a.sourceIndex++];return a.bitcount=0,od}function ab(a,e){var r=new W1(a,e),i,o,c;do{switch(i=eb(r),o=Mr(r,2,0),o){case 0:c=nb(r);break;case 1:c=K0(r,ag,rg);break;case 2:tb(r,r.ltree,r.dtree),c=K0(r,r.ltree,r.dtree);break;default:c=ng}if(c!==od)throw new Error("Data error")}while(!i);return r.destLen<r.dest.length?typeof r.dest.slice=="function"?r.dest.slice(0,r.destLen):r.dest.subarray(0,r.destLen):r.dest}J1(ag,rg);lg(cd,ud,4,3);lg(sg,ig,2,1);cd[28]=0;ud[28]=258;var rb=ab;function zi(a,e,r,i,o){return Math.pow(1-o,3)*a+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*i}function Jr(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Jr.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Jr.prototype.addPoint=function(a,e){typeof a=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Jr.prototype.addX=function(a){this.addPoint(a,null)};Jr.prototype.addY=function(a){this.addPoint(null,a)};Jr.prototype.addBezier=function(a,e,r,i,o,c,f,h){var p=[a,e],y=[r,i],v=[o,c],x=[f,h];this.addPoint(a,e),this.addPoint(f,h);for(var b=0;b<=1;b++){var S=6*p[b]-12*y[b]+6*v[b],E=-3*p[b]+9*y[b]-9*v[b]+3*x[b],C=3*y[b]-3*p[b];if(E===0){if(S===0)continue;var _=-C/S;0<_&&_<1&&(b===0&&this.addX(zi(p[b],y[b],v[b],x[b],_)),b===1&&this.addY(zi(p[b],y[b],v[b],x[b],_)));continue}var I=Math.pow(S,2)-4*C*E;if(!(I<0)){var M=(-S+Math.sqrt(I))/(2*E);0<M&&M<1&&(b===0&&this.addX(zi(p[b],y[b],v[b],x[b],M)),b===1&&this.addY(zi(p[b],y[b],v[b],x[b],M)));var N=(-S-Math.sqrt(I))/(2*E);0<N&&N<1&&(b===0&&this.addX(zi(p[b],y[b],v[b],x[b],N)),b===1&&this.addY(zi(p[b],y[b],v[b],x[b],N)))}}};Jr.prototype.addQuad=function(a,e,r,i,o,c){var f=a+.6666666666666666*(r-a),h=e+2/3*(i-e),p=f+1/3*(o-a),y=h+1/3*(c-e);this.addBezier(a,e,f,h,p,y,o,c)};function Dn(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Dn.prototype.moveTo=function(a,e){this.commands.push({type:"M",x:a,y:e})};Dn.prototype.lineTo=function(a,e){this.commands.push({type:"L",x:a,y:e})};Dn.prototype.curveTo=Dn.prototype.bezierCurveTo=function(a,e,r,i,o,c){this.commands.push({type:"C",x1:a,y1:e,x2:r,y2:i,x:o,y:c})};Dn.prototype.quadTo=Dn.prototype.quadraticCurveTo=function(a,e,r,i){this.commands.push({type:"Q",x1:a,y1:e,x:r,y:i})};Dn.prototype.close=Dn.prototype.closePath=function(){this.commands.push({type:"Z"})};Dn.prototype.extend=function(a){if(a.commands)a=a.commands;else if(a instanceof Jr){var e=a;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,a)};Dn.prototype.getBoundingBox=function(){for(var a=new Jr,e=0,r=0,i=0,o=0,c=0;c<this.commands.length;c++){var f=this.commands[c];switch(f.type){case"M":a.addPoint(f.x,f.y),e=i=f.x,r=o=f.y;break;case"L":a.addPoint(f.x,f.y),i=f.x,o=f.y;break;case"Q":a.addQuad(i,o,f.x1,f.y1,f.x,f.y),i=f.x,o=f.y;break;case"C":a.addBezier(i,o,f.x1,f.y1,f.x2,f.y2,f.x,f.y),i=f.x,o=f.y;break;case"Z":i=e,o=r;break;default:throw new Error("Unexpected path command "+f.type)}}return a.isEmpty()&&a.addPoint(0,0),a};Dn.prototype.draw=function(a){a.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?a.moveTo(r.x,r.y):r.type==="L"?a.lineTo(r.x,r.y):r.type==="C"?a.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?a.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&a.closePath()}this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.stroke())};Dn.prototype.toPathData=function(a){a=a!==void 0?a:2;function e(f){return Math.round(f)===f?""+Math.round(f):f.toFixed(a)}function r(){for(var f=arguments,h="",p=0;p<arguments.length;p+=1){var y=f[p];y>=0&&p>0&&(h+=" "),h+=e(y)}return h}for(var i="",o=0;o<this.commands.length;o+=1){var c=this.commands[o];c.type==="M"?i+="M"+r(c.x,c.y):c.type==="L"?i+="L"+r(c.x,c.y):c.type==="C"?i+="C"+r(c.x1,c.y1,c.x2,c.y2,c.x,c.y):c.type==="Q"?i+="Q"+r(c.x1,c.y1,c.x,c.y):c.type==="Z"&&(i+="Z")}return i};Dn.prototype.toSVG=function(a){var e='<path d="';return e+=this.toPathData(a),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Dn.prototype.toDOMElement=function(a){var e=this.toPathData(a),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function og(a){throw new Error(a)}function J0(a,e){a||og(e)}var ut={fail:og,argument:J0,assert:J0},em=32768,tm=2147483648,qi={},He={},pt={};function hr(a){return function(){return a}}He.BYTE=function(a){return ut.argument(a>=0&&a<=255,"Byte value should be between 0 and 255."),[a]};pt.BYTE=hr(1);He.CHAR=function(a){return[a.charCodeAt(0)]};pt.CHAR=hr(1);He.CHARARRAY=function(a){typeof a>"u"&&(a="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<a.length;r+=1)e[r]=a.charCodeAt(r);return e};pt.CHARARRAY=function(a){return typeof a>"u"?0:a.length};He.USHORT=function(a){return[a>>8&255,a&255]};pt.USHORT=hr(2);He.SHORT=function(a){return a>=em&&(a=-(2*em-a)),[a>>8&255,a&255]};pt.SHORT=hr(2);He.UINT24=function(a){return[a>>16&255,a>>8&255,a&255]};pt.UINT24=hr(3);He.ULONG=function(a){return[a>>24&255,a>>16&255,a>>8&255,a&255]};pt.ULONG=hr(4);He.LONG=function(a){return a>=tm&&(a=-(2*tm-a)),[a>>24&255,a>>16&255,a>>8&255,a&255]};pt.LONG=hr(4);He.FIXED=He.ULONG;pt.FIXED=pt.ULONG;He.FWORD=He.SHORT;pt.FWORD=pt.SHORT;He.UFWORD=He.USHORT;pt.UFWORD=pt.USHORT;He.LONGDATETIME=function(a){return[0,0,0,0,a>>24&255,a>>16&255,a>>8&255,a&255]};pt.LONGDATETIME=hr(8);He.TAG=function(a){return ut.argument(a.length===4,"Tag should be exactly 4 ASCII characters."),[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]};pt.TAG=hr(4);He.Card8=He.BYTE;pt.Card8=pt.BYTE;He.Card16=He.USHORT;pt.Card16=pt.USHORT;He.OffSize=He.BYTE;pt.OffSize=pt.BYTE;He.SID=He.USHORT;pt.SID=pt.USHORT;He.NUMBER=function(a){return a>=-107&&a<=107?[a+139]:a>=108&&a<=1131?(a=a-108,[(a>>8)+247,a&255]):a>=-1131&&a<=-108?(a=-a-108,[(a>>8)+251,a&255]):a>=-32768&&a<=32767?He.NUMBER16(a):He.NUMBER32(a)};pt.NUMBER=function(a){return He.NUMBER(a).length};He.NUMBER16=function(a){return[28,a>>8&255,a&255]};pt.NUMBER16=hr(3);He.NUMBER32=function(a){return[29,a>>24&255,a>>16&255,a>>8&255,a&255]};pt.NUMBER32=hr(5);He.REAL=function(a){var e=a.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var i=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(a*i)/i).toString()}for(var o="",c=0,f=e.length;c<f;c+=1){var h=e[c];h==="e"?o+=e[++c]==="-"?"c":"b":h==="."?o+="a":h==="-"?o+="e":o+=h}o+=o.length&1?"f":"ff";for(var p=[30],y=0,v=o.length;y<v;y+=2)p.push(parseInt(o.substr(y,2),16));return p};pt.REAL=function(a){return He.REAL(a).length};He.NAME=He.CHARARRAY;pt.NAME=pt.CHARARRAY;He.STRING=He.CHARARRAY;pt.STRING=pt.CHARARRAY;qi.UTF8=function(a,e,r){for(var i=[],o=r,c=0;c<o;c++,e+=1)i[c]=a.getUint8(e);return String.fromCharCode.apply(null,i)};qi.UTF16=function(a,e,r){for(var i=[],o=r/2,c=0;c<o;c++,e+=2)i[c]=a.getUint16(e);return String.fromCharCode.apply(null,i)};He.UTF16=function(a){for(var e=[],r=0;r<a.length;r+=1){var i=a.charCodeAt(r);e[e.length]=i>>8&255,e[e.length]=i&255}return e};pt.UTF16=function(a){return a.length*2};var $f={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};qi.MACSTRING=function(a,e,r,i){var o=$f[i];if(o!==void 0){for(var c="",f=0;f<r;f++){var h=a.getUint8(e+f);h<=127?c+=String.fromCharCode(h):c+=o[h&127]}return c}};var uc=typeof WeakMap=="function"&&new WeakMap,fc,sb=function(a){if(!fc){fc={};for(var e in $f)fc[e]=new String(e)}var r=fc[a];if(r!==void 0){if(uc){var i=uc.get(r);if(i!==void 0)return i}var o=$f[a];if(o!==void 0){for(var c={},f=0;f<o.length;f++)c[o.charCodeAt(f)]=f+128;return uc&&uc.set(r,c),c}}};He.MACSTRING=function(a,e){var r=sb(e);if(r!==void 0){for(var i=[],o=0;o<a.length;o++){var c=a.charCodeAt(o);if(c>=128&&(c=r[c],c===void 0))return;i[o]=c}return i}};pt.MACSTRING=function(a,e){var r=He.MACSTRING(a,e);return r!==void 0?r.length:0};function Zf(a){return a>=-128&&a<=127}function ib(a,e,r){for(var i=0,o=a.length;e<o&&i<64&&a[e]===0;)++e,++i;return r.push(128|i-1),e}function lb(a,e,r){for(var i=0,o=a.length,c=e;c<o&&i<64;){var f=a[c];if(!Zf(f)||f===0&&c+1<o&&a[c+1]===0)break;++c,++i}r.push(i-1);for(var h=e;h<c;++h)r.push(a[h]+256&255);return c}function ob(a,e,r){for(var i=0,o=a.length,c=e;c<o&&i<64;){var f=a[c];if(f===0||Zf(f)&&c+1<o&&Zf(a[c+1]))break;++c,++i}r.push(64|i-1);for(var h=e;h<c;++h){var p=a[h];r.push(p+65536>>8&255,p+256&255)}return c}He.VARDELTAS=function(a){for(var e=0,r=[];e<a.length;){var i=a[e];i===0?e=ib(a,e,r):i>=-128&&i<=127?e=lb(a,e,r):e=ob(a,e,r)}return r};He.INDEX=function(a){for(var e=1,r=[e],i=[],o=0;o<a.length;o+=1){var c=He.OBJECT(a[o]);Array.prototype.push.apply(i,c),e+=c.length,r.push(e)}if(i.length===0)return[0,0];for(var f=[],h=1+Math.floor(Math.log(e)/Math.log(2))/8|0,p=[void 0,He.BYTE,He.USHORT,He.UINT24,He.ULONG][h],y=0;y<r.length;y+=1){var v=p(r[y]);Array.prototype.push.apply(f,v)}return Array.prototype.concat(He.Card16(a.length),He.OffSize(h),f,i)};pt.INDEX=function(a){return He.INDEX(a).length};He.DICT=function(a){for(var e=[],r=Object.keys(a),i=r.length,o=0;o<i;o+=1){var c=parseInt(r[o],0),f=a[c];e=e.concat(He.OPERAND(f.value,f.type)),e=e.concat(He.OPERATOR(c))}return e};pt.DICT=function(a){return He.DICT(a).length};He.OPERATOR=function(a){return a<1200?[a]:[12,a-1200]};He.OPERAND=function(a,e){var r=[];if(Array.isArray(e))for(var i=0;i<e.length;i+=1)ut.argument(a.length===e.length,"Not enough arguments given for type"+e),r=r.concat(He.OPERAND(a[i],e[i]));else if(e==="SID")r=r.concat(He.NUMBER(a));else if(e==="offset")r=r.concat(He.NUMBER32(a));else if(e==="number")r=r.concat(He.NUMBER(a));else if(e==="real")r=r.concat(He.REAL(a));else throw new Error("Unknown operand type "+e);return r};He.OP=He.BYTE;pt.OP=pt.BYTE;var dc=typeof WeakMap=="function"&&new WeakMap;He.CHARSTRING=function(a){if(dc){var e=dc.get(a);if(e!==void 0)return e}for(var r=[],i=a.length,o=0;o<i;o+=1){var c=a[o];r=r.concat(He[c.type](c.value))}return dc&&dc.set(a,r),r};pt.CHARSTRING=function(a){return He.CHARSTRING(a).length};He.OBJECT=function(a){var e=He[a.type];return ut.argument(e!==void 0,"No encoding function for type "+a.type),e(a.value)};pt.OBJECT=function(a){var e=pt[a.type];return ut.argument(e!==void 0,"No sizeOf function for type "+a.type),e(a.value)};He.TABLE=function(a){for(var e=[],r=a.fields.length,i=[],o=[],c=0;c<r;c+=1){var f=a.fields[c],h=He[f.type];ut.argument(h!==void 0,"No encoding function for field type "+f.type+" ("+f.name+")");var p=a[f.name];p===void 0&&(p=f.value);var y=h(p);f.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),i.push(y)):e=e.concat(y)}for(var v=0;v<i.length;v+=1){var x=o[v],b=e.length;ut.argument(b<65536,"Table "+a.tableName+" too big."),e[x]=b>>8,e[x+1]=b&255,e=e.concat(i[v])}return e};pt.TABLE=function(a){for(var e=0,r=a.fields.length,i=0;i<r;i+=1){var o=a.fields[i],c=pt[o.type];ut.argument(c!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var f=a[o.name];f===void 0&&(f=o.value),e+=c(f),o.type==="TABLE"&&(e+=2)}return e};He.RECORD=He.TABLE;pt.RECORD=pt.TABLE;He.LITERAL=function(a){return a};pt.LITERAL=function(a){return a.length};function qn(a,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var i=0;i<e.length;i+=1){var o=e[i];this[o.name]=o.value}if(this.tableName=a,this.fields=e,r)for(var c=Object.keys(r),f=0;f<c.length;f+=1){var h=c[f],p=r[h];this[h]!==void 0&&(this[h]=p)}}qn.prototype.encode=function(){return He.TABLE(this)};qn.prototype.sizeOf=function(){return pt.TABLE(this)};function Zl(a,e,r){r===void 0&&(r=e.length);var i=new Array(e.length+1);i[0]={name:a+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)i[o+1]={name:a+o,type:"USHORT",value:e[o]};return i}function Qf(a,e,r){var i=e.length,o=new Array(i+1);o[0]={name:a+"Count",type:"USHORT",value:i};for(var c=0;c<i;c++)o[c+1]={name:a+c,type:"TABLE",value:r(e[c],c)};return o}function Ql(a,e,r){var i=e.length,o=[];o[0]={name:a+"Count",type:"USHORT",value:i};for(var c=0;c<i;c++)o=o.concat(r(e[c],c));return o}function xc(a){a.format===1?qn.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Zl("glyph",a.glyphs))):a.format===2?qn.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Ql("rangeRecord",a.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):ut.assert(!1,"Coverage format must be 1 or 2.")}xc.prototype=Object.create(qn.prototype);xc.prototype.constructor=xc;function Sc(a){qn.call(this,"scriptListTable",Ql("scriptRecord",a,function(e,r){var i=e.script,o=i.defaultLangSys;return ut.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new qn("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new qn("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Zl("featureIndex",o.featureIndexes)))}].concat(Ql("langSys",i.langSysRecords,function(c,f){var h=c.langSys;return[{name:"langSysTag"+f,type:"TAG",value:c.tag},{name:"langSys"+f,type:"TABLE",value:new qn("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:h.reqFeatureIndex}].concat(Zl("featureIndex",h.featureIndexes)))}]})))}]}))}Sc.prototype=Object.create(qn.prototype);Sc.prototype.constructor=Sc;function Ec(a){qn.call(this,"featureListTable",Ql("featureRecord",a,function(e,r){var i=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new qn("featureTable",[{name:"featureParams",type:"USHORT",value:i.featureParams}].concat(Zl("lookupListIndex",i.lookupListIndexes)))}]}))}Ec.prototype=Object.create(qn.prototype);Ec.prototype.constructor=Ec;function wc(a,e){qn.call(this,"lookupListTable",Qf("lookup",a,function(r){var i=e[r.lookupType];return ut.assert(!!i,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new qn("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Qf("subtable",r.subtables,i)))}))}wc.prototype=Object.create(qn.prototype);wc.prototype.constructor=wc;var Ve={Table:qn,Record:qn,Coverage:xc,ScriptList:Sc,FeatureList:Ec,LookupList:wc,ushortList:Zl,tableList:Qf,recordList:Ql};function nm(a,e){return a.getUint8(e)}function Ac(a,e){return a.getUint16(e,!1)}function cb(a,e){return a.getInt16(e,!1)}function fd(a,e){return a.getUint32(e,!1)}function cg(a,e){var r=a.getInt16(e,!1),i=a.getUint16(e+2,!1);return r+i/65535}function ub(a,e){for(var r="",i=e;i<e+4;i+=1)r+=String.fromCharCode(a.getInt8(i));return r}function fb(a,e,r){for(var i=0,o=0;o<r;o+=1)i<<=8,i+=a.getUint8(e+o);return i}function db(a,e,r){for(var i=[],o=e;o<r;o+=1)i.push(a.getUint8(o));return i}function pb(a){for(var e="",r=0;r<a.length;r+=1)e+=String.fromCharCode(a[r]);return e}var hb={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function he(a,e){this.data=a,this.offset=e,this.relativeOffset=0}he.prototype.parseByte=function(){var a=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,a};he.prototype.parseChar=function(){var a=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,a};he.prototype.parseCard8=he.prototype.parseByte;he.prototype.parseUShort=function(){var a=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,a};he.prototype.parseCard16=he.prototype.parseUShort;he.prototype.parseSID=he.prototype.parseUShort;he.prototype.parseOffset16=he.prototype.parseUShort;he.prototype.parseShort=function(){var a=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,a};he.prototype.parseF2Dot14=function(){var a=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,a};he.prototype.parseULong=function(){var a=fd(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,a};he.prototype.parseOffset32=he.prototype.parseULong;he.prototype.parseFixed=function(){var a=cg(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,a};he.prototype.parseString=function(a){var e=this.data,r=this.offset+this.relativeOffset,i="";this.relativeOffset+=a;for(var o=0;o<a;o++)i+=String.fromCharCode(e.getUint8(r+o));return i};he.prototype.parseTag=function(){return this.parseString(4)};he.prototype.parseLongDateTime=function(){var a=fd(this.data,this.offset+this.relativeOffset+4);return a-=2082844800,this.relativeOffset+=8,a};he.prototype.parseVersion=function(a){var e=Ac(this.data,this.offset+this.relativeOffset),r=Ac(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,a===void 0&&(a=4096),e+r/a/10};he.prototype.skip=function(a,e){e===void 0&&(e=1),this.relativeOffset+=hb[a]*e};he.prototype.parseULongList=function(a){a===void 0&&(a=this.parseULong());for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint32(i),i+=4;return this.relativeOffset+=a*4,e};he.prototype.parseOffset16List=he.prototype.parseUShortList=function(a){a===void 0&&(a=this.parseUShort());for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint16(i),i+=2;return this.relativeOffset+=a*2,e};he.prototype.parseShortList=function(a){for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getInt16(i),i+=2;return this.relativeOffset+=a*2,e};he.prototype.parseByteList=function(a){for(var e=new Array(a),r=this.data,i=this.offset+this.relativeOffset,o=0;o<a;o++)e[o]=r.getUint8(i++);return this.relativeOffset+=a,e};he.prototype.parseList=function(a,e){e||(e=a,a=this.parseUShort());for(var r=new Array(a),i=0;i<a;i++)r[i]=e.call(this);return r};he.prototype.parseList32=function(a,e){e||(e=a,a=this.parseULong());for(var r=new Array(a),i=0;i<a;i++)r[i]=e.call(this);return r};he.prototype.parseRecordList=function(a,e){e||(e=a,a=this.parseUShort());for(var r=new Array(a),i=Object.keys(e),o=0;o<a;o++){for(var c={},f=0;f<i.length;f++){var h=i[f],p=e[h];c[h]=p.call(this)}r[o]=c}return r};he.prototype.parseRecordList32=function(a,e){e||(e=a,a=this.parseULong());for(var r=new Array(a),i=Object.keys(e),o=0;o<a;o++){for(var c={},f=0;f<i.length;f++){var h=i[f],p=e[h];c[h]=p.call(this)}r[o]=c}return r};he.prototype.parseStruct=function(a){if(typeof a=="function")return a.call(this);for(var e=Object.keys(a),r={},i=0;i<e.length;i++){var o=e[i],c=a[o];r[o]=c.call(this)}return r};he.prototype.parseValueRecord=function(a){if(a===void 0&&(a=this.parseUShort()),a!==0){var e={};return a&1&&(e.xPlacement=this.parseShort()),a&2&&(e.yPlacement=this.parseShort()),a&4&&(e.xAdvance=this.parseShort()),a&8&&(e.yAdvance=this.parseShort()),a&16&&(e.xPlaDevice=void 0,this.parseShort()),a&32&&(e.yPlaDevice=void 0,this.parseShort()),a&64&&(e.xAdvDevice=void 0,this.parseShort()),a&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};he.prototype.parseValueRecordList=function(){for(var a=this.parseUShort(),e=this.parseUShort(),r=new Array(e),i=0;i<e;i++)r[i]=this.parseValueRecord(a);return r};he.prototype.parsePointer=function(a){var e=this.parseOffset16();if(e>0)return new he(this.data,this.offset+e).parseStruct(a)};he.prototype.parsePointer32=function(a){var e=this.parseOffset32();if(e>0)return new he(this.data,this.offset+e).parseStruct(a)};he.prototype.parseListOfLists=function(a){for(var e=this.parseOffset16List(),r=e.length,i=this.relativeOffset,o=new Array(r),c=0;c<r;c++){var f=e[c];if(f===0){o[c]=void 0;continue}if(this.relativeOffset=f,a){for(var h=this.parseOffset16List(),p=new Array(h.length),y=0;y<h.length;y++)this.relativeOffset=f+h[y],p[y]=a.call(this);o[c]=p}else o[c]=this.parseUShortList()}return this.relativeOffset=i,o};he.prototype.parseCoverage=function(){var a=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var i=new Array(r),o=0;o<r;o++)i[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+a.toString(16)+": Coverage format must be 1 or 2.")};he.prototype.parseClassDef=function(){var a=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:he.uShort,end:he.uShort,classId:he.uShort})};throw new Error("0x"+a.toString(16)+": ClassDef format must be 1 or 2.")};he.list=function(a,e){return function(){return this.parseList(a,e)}};he.list32=function(a,e){return function(){return this.parseList32(a,e)}};he.recordList=function(a,e){return function(){return this.parseRecordList(a,e)}};he.recordList32=function(a,e){return function(){return this.parseRecordList32(a,e)}};he.pointer=function(a){return function(){return this.parsePointer(a)}};he.pointer32=function(a){return function(){return this.parsePointer32(a)}};he.tag=he.prototype.parseTag;he.byte=he.prototype.parseByte;he.uShort=he.offset16=he.prototype.parseUShort;he.uShortList=he.prototype.parseUShortList;he.uLong=he.offset32=he.prototype.parseULong;he.uLongList=he.prototype.parseULongList;he.struct=he.prototype.parseStruct;he.coverage=he.prototype.parseCoverage;he.classDef=he.prototype.parseClassDef;var am={reserved:he.uShort,reqFeatureIndex:he.uShort,featureIndexes:he.uShortList};he.prototype.parseScriptList=function(){return this.parsePointer(he.recordList({tag:he.tag,script:he.pointer({defaultLangSys:he.pointer(am),langSysRecords:he.recordList({tag:he.tag,langSys:he.pointer(am)})})}))||[]};he.prototype.parseFeatureList=function(){return this.parsePointer(he.recordList({tag:he.tag,feature:he.pointer({featureParams:he.offset16,lookupListIndexes:he.uShortList})}))||[]};he.prototype.parseLookupList=function(a){return this.parsePointer(he.list(he.pointer(function(){var e=this.parseUShort();ut.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),i=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(he.pointer(a[e])),markFilteringSet:i?this.parseUShort():void 0}})))||[]};he.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var a=this.parseUShort(),e=this.parseUShort();ut.argument(a===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:he.offset32,featureTableSubstitutionOffset:he.offset32});return r})||[]};var We={getByte:nm,getCard8:nm,getUShort:Ac,getCard16:Ac,getShort:cb,getULong:fd,getFixed:cg,getTag:ub,getOffset:fb,getBytes:db,bytesToString:pb,Parser:he};function mb(a,e){e.parseUShort(),a.length=e.parseULong(),a.language=e.parseULong();var r;a.groupCount=r=e.parseULong(),a.glyphIndexMap={};for(var i=0;i<r;i+=1)for(var o=e.parseULong(),c=e.parseULong(),f=e.parseULong(),h=o;h<=c;h+=1)a.glyphIndexMap[h]=f,f++}function gb(a,e,r,i,o){a.length=e.parseUShort(),a.language=e.parseUShort();var c;a.segCount=c=e.parseUShort()>>1,e.skip("uShort",3),a.glyphIndexMap={};for(var f=new We.Parser(r,i+o+14),h=new We.Parser(r,i+o+16+c*2),p=new We.Parser(r,i+o+16+c*4),y=new We.Parser(r,i+o+16+c*6),v=i+o+16+c*8,x=0;x<c-1;x+=1)for(var b=void 0,S=f.parseUShort(),E=h.parseUShort(),C=p.parseShort(),_=y.parseUShort(),I=E;I<=S;I+=1)_!==0?(v=y.offset+y.relativeOffset-2,v+=_,v+=(I-E)*2,b=We.getUShort(r,v),b!==0&&(b=b+C&65535)):b=I+C&65535,a.glyphIndexMap[I]=b}function yb(a,e){var r={};r.version=We.getUShort(a,e),ut.argument(r.version===0,"cmap table version should be 0."),r.numTables=We.getUShort(a,e+2);for(var i=-1,o=r.numTables-1;o>=0;o-=1){var c=We.getUShort(a,e+4+o*8),f=We.getUShort(a,e+4+o*8+2);if(c===3&&(f===0||f===1||f===10)||c===0&&(f===0||f===1||f===2||f===3||f===4)){i=We.getULong(a,e+4+o*8+4);break}}if(i===-1)throw new Error("No valid cmap sub-tables found.");var h=new We.Parser(a,e+i);if(r.format=h.parseUShort(),r.format===12)mb(r,h);else if(r.format===4)gb(r,h,a,e,i);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function vb(a,e,r){a.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function bb(a){a.segments.push({end:65535,start:65535,delta:1,offset:0})}function xb(a){var e=!0,r;for(r=a.length-1;r>0;r-=1){var i=a.get(r);if(i.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var c=new Ve.Table("cmap",o);for(c.segments=[],r=0;r<a.length;r+=1){for(var f=a.get(r),h=0;h<f.unicodes.length;h+=1)vb(c,f.unicodes[h],r);c.segments=c.segments.sort(function(M,N){return M.start-N.start})}bb(c);var p=c.segments.length,y=0,v=[],x=[],b=[],S=[],E=[],C=[];for(r=0;r<p;r+=1){var _=c.segments[r];_.end<=65535&&_.start<=65535?(v=v.concat({name:"end_"+r,type:"USHORT",value:_.end}),x=x.concat({name:"start_"+r,type:"USHORT",value:_.start}),b=b.concat({name:"idDelta_"+r,type:"SHORT",value:_.delta}),S=S.concat({name:"idRangeOffset_"+r,type:"USHORT",value:_.offset}),_.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:_.glyphId}))):y+=1,!e&&_.glyphIndex!==void 0&&(C=C.concat({name:"cmap12Start_"+r,type:"ULONG",value:_.start}),C=C.concat({name:"cmap12End_"+r,type:"ULONG",value:_.end}),C=C.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:_.glyphIndex}))}if(c.segCountX2=(p-y)*2,c.searchRange=Math.pow(2,Math.floor(Math.log(p-y)/Math.log(2)))*2,c.entrySelector=Math.log(c.searchRange/2)/Math.log(2),c.rangeShift=c.segCountX2-c.searchRange,c.fields=c.fields.concat(v),c.fields.push({name:"reservedPad",type:"USHORT",value:0}),c.fields=c.fields.concat(x),c.fields=c.fields.concat(b),c.fields=c.fields.concat(S),c.fields=c.fields.concat(E),c.cmap4Length=14+v.length*2+2+x.length*2+b.length*2+S.length*2+E.length*2,!e){var I=16+C.length*4;c.cmap12Offset=20+c.cmap4Length,c.fields=c.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:I},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:C.length/3}]),c.fields=c.fields.concat(C)}return c}var ug={parse:yb,make:xb},yc=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Sb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Eb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],si=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function fg(a){this.font=a}fg.prototype.charToGlyphIndex=function(a){var e=a.codePointAt(0),r=this.font.glyphs;if(r){for(var i=0;i<r.length;i+=1)for(var o=r.get(i),c=0;c<o.unicodes.length;c+=1)if(o.unicodes[c]===e)return i}return null};function dg(a){this.cmap=a}dg.prototype.charToGlyphIndex=function(a){return this.cmap.glyphIndexMap[a.codePointAt(0)]||0};function Tc(a,e){this.encoding=a,this.charset=e}Tc.prototype.charToGlyphIndex=function(a){var e=a.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function dd(a){switch(a.version){case 1:this.names=si.slice();break;case 2:this.names=new Array(a.numberOfGlyphs);for(var e=0;e<a.numberOfGlyphs;e++)a.glyphNameIndex[e]<si.length?this.names[e]=si[a.glyphNameIndex[e]]:this.names[e]=a.names[a.glyphNameIndex[e]-si.length];break;case 2.5:this.names=new Array(a.numberOfGlyphs);for(var r=0;r<a.numberOfGlyphs;r++)this.names[r]=si[r+a.glyphNameIndex[r]];break;case 3:this.names=[];break;default:this.names=[];break}}dd.prototype.nameToGlyphIndex=function(a){return this.names.indexOf(a)};dd.prototype.glyphIndexToName=function(a){return this.names[a]};function wb(a){for(var e,r=a.tables.cmap.glyphIndexMap,i=Object.keys(r),o=0;o<i.length;o+=1){var c=i[o],f=r[c];e=a.glyphs.get(f),e.addUnicode(parseInt(c))}for(var h=0;h<a.glyphs.length;h+=1)e=a.glyphs.get(h),a.cffEncoding?a.isCIDFont?e.name="gid"+h:e.name=a.cffEncoding.charset[h]:a.glyphNames.names&&(e.name=a.glyphNames.glyphIndexToName(h))}function Ab(a){a._IndexToUnicodeMap={};for(var e=a.tables.cmap.glyphIndexMap,r=Object.keys(e),i=0;i<r.length;i+=1){var o=r[i],c=e[o];a._IndexToUnicodeMap[c]===void 0?a._IndexToUnicodeMap[c]={unicodes:[parseInt(o)]}:a._IndexToUnicodeMap[c].unicodes.push(parseInt(o))}}function Tb(a,e){e.lowMemory?Ab(a):wb(a)}function Cb(a,e,r,i,o){a.beginPath(),a.moveTo(e,r),a.lineTo(i,o),a.stroke()}var ai={line:Cb};function Mb(a,e){var r=e||new Dn;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(i){r=i}}}function ja(a){this.bindConstructorValues(a)}ja.prototype.bindConstructorValues=function(a){this.index=a.index||0,this.name=a.name||null,this.unicode=a.unicode||void 0,this.unicodes=a.unicodes||a.unicode!==void 0?[a.unicode]:[],"xMin"in a&&(this.xMin=a.xMin),"yMin"in a&&(this.yMin=a.yMin),"xMax"in a&&(this.xMax=a.xMax),"yMax"in a&&(this.yMax=a.yMax),"advanceWidth"in a&&(this.advanceWidth=a.advanceWidth),Object.defineProperty(this,"path",Mb(this,a.path))};ja.prototype.addUnicode=function(a){this.unicodes.length===0&&(this.unicode=a),this.unicodes.push(a)};ja.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};ja.prototype.getPath=function(a,e,r,i,o){a=a!==void 0?a:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var c,f;i||(i={});var h=i.xScale,p=i.yScale;if(i.hinting&&o&&o.hinting&&(f=this.path&&o.hinting.exec(this,r)),f)c=o.hinting.getCommands(f),a=Math.round(a),e=Math.round(e),h=p=1;else{c=this.path.commands;var y=1/(this.path.unitsPerEm||1e3)*r;h===void 0&&(h=y),p===void 0&&(p=y)}for(var v=new Dn,x=0;x<c.length;x+=1){var b=c[x];b.type==="M"?v.moveTo(a+b.x*h,e+-b.y*p):b.type==="L"?v.lineTo(a+b.x*h,e+-b.y*p):b.type==="Q"?v.quadraticCurveTo(a+b.x1*h,e+-b.y1*p,a+b.x*h,e+-b.y*p):b.type==="C"?v.curveTo(a+b.x1*h,e+-b.y1*p,a+b.x2*h,e+-b.y2*p,a+b.x*h,e+-b.y*p):b.type==="Z"&&v.closePath()}return v};ja.prototype.getContours=function(){if(this.points===void 0)return[];for(var a=[],e=[],r=0;r<this.points.length;r+=1){var i=this.points[r];e.push(i),i.lastPointOfContour&&(a.push(e),e=[])}return ut.argument(e.length===0,"There are still points left in the current contour."),a};ja.prototype.getMetrics=function(){for(var a=this.path.commands,e=[],r=[],i=0;i<a.length;i+=1){var o=a[i];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var c={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(c.xMin)||(c.xMin=0),isFinite(c.xMax)||(c.xMax=this.advanceWidth),isFinite(c.yMin)||(c.yMin=0),isFinite(c.yMax)||(c.yMax=0),c.rightSideBearing=this.advanceWidth-c.leftSideBearing-(c.xMax-c.xMin),c};ja.prototype.draw=function(a,e,r,i,o){this.getPath(e,r,i,o).draw(a)};ja.prototype.drawPoints=function(a,e,r,i){function o(x,b,S,E){a.beginPath();for(var C=0;C<x.length;C+=1)a.moveTo(b+x[C].x*E,S+x[C].y*E),a.arc(b+x[C].x*E,S+x[C].y*E,2,0,Math.PI*2,!1);a.closePath(),a.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:24;for(var c=1/this.path.unitsPerEm*i,f=[],h=[],p=this.path,y=0;y<p.commands.length;y+=1){var v=p.commands[y];v.x!==void 0&&f.push({x:v.x,y:-v.y}),v.x1!==void 0&&h.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&h.push({x:v.x2,y:-v.y2})}a.fillStyle="blue",o(f,e,r,c),a.fillStyle="red",o(h,e,r,c)};ja.prototype.drawMetrics=function(a,e,r,i){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:24,o=1/this.path.unitsPerEm*i,a.lineWidth=1,a.strokeStyle="black",ai.line(a,e,-1e4,e,1e4),ai.line(a,-1e4,r,1e4,r);var c=this.xMin||0,f=this.yMin||0,h=this.xMax||0,p=this.yMax||0,y=this.advanceWidth||0;a.strokeStyle="blue",ai.line(a,e+c*o,-1e4,e+c*o,1e4),ai.line(a,e+h*o,-1e4,e+h*o,1e4),ai.line(a,-1e4,r+-f*o,1e4,r+-f*o),ai.line(a,-1e4,r+-p*o,1e4,r+-p*o),a.strokeStyle="green",ai.line(a,e+y*o,-1e4,e+y*o,1e4)};function pc(a,e,r){Object.defineProperty(a,e,{get:function(){return a.path,a[r]},set:function(i){a[r]=i},enumerable:!0,configurable:!0})}function pd(a,e){if(this.font=a,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var i=e[r];i.path.unitsPerEm=a.unitsPerEm,this.glyphs[r]=i}this.length=e&&e.length||0}pd.prototype.get=function(a){if(this.glyphs[a]===void 0){this.font._push(a),typeof this.glyphs[a]=="function"&&(this.glyphs[a]=this.glyphs[a]());var e=this.glyphs[a],r=this.font._IndexToUnicodeMap[a];if(r)for(var i=0;i<r.unicodes.length;i++)e.addUnicode(r.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+a:e.name=this.font.cffEncoding.charset[a]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(a)),this.glyphs[a].advanceWidth=this.font._hmtxTableData[a].advanceWidth,this.glyphs[a].leftSideBearing=this.font._hmtxTableData[a].leftSideBearing}else typeof this.glyphs[a]=="function"&&(this.glyphs[a]=this.glyphs[a]());return this.glyphs[a]};pd.prototype.push=function(a,e){this.glyphs[a]=e,this.length++};function Nb(a,e){return new ja({index:e,font:a})}function Rb(a,e,r,i,o,c){return function(){var f=new ja({index:e,font:a});return f.path=function(){r(f,i,o);var h=c(a.glyphs,f);return h.unitsPerEm=a.unitsPerEm,h},pc(f,"xMin","_xMin"),pc(f,"xMax","_xMax"),pc(f,"yMin","_yMin"),pc(f,"yMax","_yMax"),f}}function kb(a,e,r,i){return function(){var o=new ja({index:e,font:a});return o.path=function(){var c=r(a,o,i);return c.unitsPerEm=a.unitsPerEm,c},o}}var Rr={GlyphSet:pd,glyphLoader:Nb,ttfGlyphLoader:Rb,cffGlyphLoader:kb};function pg(a,e){if(a===e)return!0;if(Array.isArray(a)&&Array.isArray(e)){if(a.length!==e.length)return!1;for(var r=0;r<a.length;r+=1)if(!pg(a[r],e[r]))return!1;return!0}else return!1}function Wf(a){var e;return a.length<1240?e=107:a.length<33900?e=1131:e=32768,e}function ks(a,e,r){var i=[],o=[],c=We.getCard16(a,e),f,h;if(c!==0){var p=We.getByte(a,e+2);f=e+(c+1)*p+2;for(var y=e+3,v=0;v<c+1;v+=1)i.push(We.getOffset(a,y,p)),y+=p;h=f+i[c]}else h=e+2;for(var x=0;x<i.length-1;x+=1){var b=We.getBytes(a,f+i[x],f+i[x+1]);r&&(b=r(b)),o.push(b)}return{objects:o,startOffset:e,endOffset:h}}function Db(a,e){var r=[],i=We.getCard16(a,e),o,c;if(i!==0){var f=We.getByte(a,e+2);o=e+(i+1)*f+2;for(var h=e+3,p=0;p<i+1;p+=1)r.push(We.getOffset(a,h,f)),h+=f;c=o+r[i]}else c=e+2;return{offsets:r,startOffset:e,endOffset:c}}function _b(a,e,r,i,o){var c=We.getCard16(r,i),f=0;if(c!==0){var h=We.getByte(r,i+2);f=i+(c+1)*h+2}var p=We.getBytes(r,f+e[a],f+e[a+1]);return p}function Ob(a){for(var e="",r=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=a.parseByte(),c=o>>4,f=o&15;if(c===r||(e+=i[c],f===r))break;e+=i[f]}return parseFloat(e)}function Ib(a,e){var r,i,o,c;if(e===28)return r=a.parseByte(),i=a.parseByte(),r<<8|i;if(e===29)return r=a.parseByte(),i=a.parseByte(),o=a.parseByte(),c=a.parseByte(),r<<24|i<<16|o<<8|c;if(e===30)return Ob(a);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=a.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=a.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function Lb(a){for(var e={},r=0;r<a.length;r+=1){var i=a[r][0],o=a[r][1],c=void 0;if(o.length===1?c=o[0]:c=o,e.hasOwnProperty(i)&&!isNaN(e[i]))throw new Error("Object "+e+" already has key "+i);e[i]=c}return e}function hg(a,e,r){e=e!==void 0?e:0;var i=new We.Parser(a,e),o=[],c=[];for(r=r!==void 0?r:a.length;i.relativeOffset<r;){var f=i.parseByte();f<=21?(f===12&&(f=1200+i.parseByte()),o.push([f,c]),c=[]):c.push(Ib(i,f))}return Lb(o)}function Yl(a,e){return e<=390?e=yc[e]:e=a[e-391],e}function mg(a,e,r){for(var i={},o,c=0;c<e.length;c+=1){var f=e[c];if(Array.isArray(f.type)){var h=[];h.length=f.type.length;for(var p=0;p<f.type.length;p++)o=a[f.op]!==void 0?a[f.op][p]:void 0,o===void 0&&(o=f.value!==void 0&&f.value[p]!==void 0?f.value[p]:null),f.type[p]==="SID"&&(o=Yl(r,o)),h[p]=o;i[f.name]=h}else o=a[f.op],o===void 0&&(o=f.value!==void 0?f.value:null),f.type==="SID"&&(o=Yl(r,o)),i[f.name]=o}return i}function Ub(a,e){var r={};return r.formatMajor=We.getCard8(a,e),r.formatMinor=We.getCard8(a,e+1),r.size=We.getCard8(a,e+2),r.offsetSize=We.getCard8(a,e+3),r.startOffset=e,r.endOffset=e+4,r}var gg=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],yg=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Bb(a,e){var r=hg(a,0,a.byteLength);return mg(r,gg,e)}function vg(a,e,r,i){var o=hg(a,e,r);return mg(o,yg,i)}function rm(a,e,r,i){for(var o=[],c=0;c<r.length;c+=1){var f=new DataView(new Uint8Array(r[c]).buffer),h=Bb(f,i);h._subrs=[],h._subrsBias=0,h._defaultWidthX=0,h._nominalWidthX=0;var p=h.private[0],y=h.private[1];if(p!==0&&y!==0){var v=vg(a,y+e,p,i);if(h._defaultWidthX=v.defaultWidthX,h._nominalWidthX=v.nominalWidthX,v.subrs!==0){var x=y+v.subrs,b=ks(a,x+e);h._subrs=b.objects,h._subrsBias=Wf(h._subrs)}h._privateDict=v}o.push(h)}return o}function Fb(a,e,r,i){var o,c,f=new We.Parser(a,e);r-=1;var h=[".notdef"],p=f.parseCard8();if(p===0)for(var y=0;y<r;y+=1)o=f.parseSID(),h.push(Yl(i,o));else if(p===1)for(;h.length<=r;){o=f.parseSID(),c=f.parseCard8();for(var v=0;v<=c;v+=1)h.push(Yl(i,o)),o+=1}else if(p===2)for(;h.length<=r;){o=f.parseSID(),c=f.parseCard16();for(var x=0;x<=c;x+=1)h.push(Yl(i,o)),o+=1}else throw new Error("Unknown charset format "+p);return h}function jb(a,e,r){var i,o={},c=new We.Parser(a,e),f=c.parseCard8();if(f===0)for(var h=c.parseCard8(),p=0;p<h;p+=1)i=c.parseCard8(),o[i]=p;else if(f===1){var y=c.parseCard8();i=1;for(var v=0;v<y;v+=1)for(var x=c.parseCard8(),b=c.parseCard8(),S=x;S<=x+b;S+=1)o[S]=i,i+=1}else throw new Error("Unknown encoding format "+f);return new Tc(o,r)}function sm(a,e,r){var i,o,c,f,h=new Dn,p=[],y=0,v=!1,x=!1,b=0,S=0,E,C,_,I;if(a.isCIDFont){var M=a.tables.cff.topDict._fdSelect[e.index],N=a.tables.cff.topDict._fdArray[M];E=N._subrs,C=N._subrsBias,_=N._defaultWidthX,I=N._nominalWidthX}else E=a.tables.cff.topDict._subrs,C=a.tables.cff.topDict._subrsBias,_=a.tables.cff.topDict._defaultWidthX,I=a.tables.cff.topDict._nominalWidthX;var D=_;function k(q,Y){x&&h.closePath(),h.moveTo(q,Y),x=!0}function G(){var q;q=p.length%2!==0,q&&!v&&(D=p.shift()+I),y+=p.length>>1,p.length=0,v=!0}function P(q){for(var Y,te,H,Z,W,X,K,F,z,ie,be,U,ee=0;ee<q.length;){var ve=q[ee];switch(ee+=1,ve){case 1:G();break;case 3:G();break;case 4:p.length>1&&!v&&(D=p.shift()+I,v=!0),S+=p.pop(),k(b,S);break;case 5:for(;p.length>0;)b+=p.shift(),S+=p.shift(),h.lineTo(b,S);break;case 6:for(;p.length>0&&(b+=p.shift(),h.lineTo(b,S),p.length!==0);)S+=p.shift(),h.lineTo(b,S);break;case 7:for(;p.length>0&&(S+=p.shift(),h.lineTo(b,S),p.length!==0);)b+=p.shift(),h.lineTo(b,S);break;case 8:for(;p.length>0;)i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f+p.shift(),h.curveTo(i,o,c,f,b,S);break;case 10:W=p.pop()+C,X=E[W],X&&P(X);break;case 11:return;case 12:switch(ve=q[ee],ee+=1,ve){case 35:i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),K=c+p.shift(),F=f+p.shift(),z=K+p.shift(),ie=F+p.shift(),be=z+p.shift(),U=ie+p.shift(),b=be+p.shift(),S=U+p.shift(),p.shift(),h.curveTo(i,o,c,f,K,F),h.curveTo(z,ie,be,U,b,S);break;case 34:i=b+p.shift(),o=S,c=i+p.shift(),f=o+p.shift(),K=c+p.shift(),F=f,z=K+p.shift(),ie=f,be=z+p.shift(),U=S,b=be+p.shift(),h.curveTo(i,o,c,f,K,F),h.curveTo(z,ie,be,U,b,S);break;case 36:i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),K=c+p.shift(),F=f,z=K+p.shift(),ie=f,be=z+p.shift(),U=ie+p.shift(),b=be+p.shift(),h.curveTo(i,o,c,f,K,F),h.curveTo(z,ie,be,U,b,S);break;case 37:i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),K=c+p.shift(),F=f+p.shift(),z=K+p.shift(),ie=F+p.shift(),be=z+p.shift(),U=ie+p.shift(),Math.abs(be-b)>Math.abs(U-S)?b=be+p.shift():S=U+p.shift(),h.curveTo(i,o,c,f,K,F),h.curveTo(z,ie,be,U,b,S);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+ve),p.length=0}break;case 14:p.length>0&&!v&&(D=p.shift()+I,v=!0),x&&(h.closePath(),x=!1);break;case 18:G();break;case 19:case 20:G(),ee+=y+7>>3;break;case 21:p.length>2&&!v&&(D=p.shift()+I,v=!0),S+=p.pop(),b+=p.pop(),k(b,S);break;case 22:p.length>1&&!v&&(D=p.shift()+I,v=!0),b+=p.pop(),k(b,S);break;case 23:G();break;case 24:for(;p.length>2;)i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f+p.shift(),h.curveTo(i,o,c,f,b,S);b+=p.shift(),S+=p.shift(),h.lineTo(b,S);break;case 25:for(;p.length>6;)b+=p.shift(),S+=p.shift(),h.lineTo(b,S);i=b+p.shift(),o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f+p.shift(),h.curveTo(i,o,c,f,b,S);break;case 26:for(p.length%2&&(b+=p.shift());p.length>0;)i=b,o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c,S=f+p.shift(),h.curveTo(i,o,c,f,b,S);break;case 27:for(p.length%2&&(S+=p.shift());p.length>0;)i=b+p.shift(),o=S,c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f,h.curveTo(i,o,c,f,b,S);break;case 28:Y=q[ee],te=q[ee+1],p.push((Y<<24|te<<16)>>16),ee+=2;break;case 29:W=p.pop()+a.gsubrsBias,X=a.gsubrs[W],X&&P(X);break;case 30:for(;p.length>0&&(i=b,o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f+(p.length===1?p.shift():0),h.curveTo(i,o,c,f,b,S),p.length!==0);)i=b+p.shift(),o=S,c=i+p.shift(),f=o+p.shift(),S=f+p.shift(),b=c+(p.length===1?p.shift():0),h.curveTo(i,o,c,f,b,S);break;case 31:for(;p.length>0&&(i=b+p.shift(),o=S,c=i+p.shift(),f=o+p.shift(),S=f+p.shift(),b=c+(p.length===1?p.shift():0),h.curveTo(i,o,c,f,b,S),p.length!==0);)i=b,o=S+p.shift(),c=i+p.shift(),f=o+p.shift(),b=c+p.shift(),S=f+(p.length===1?p.shift():0),h.curveTo(i,o,c,f,b,S);break;default:ve<32?console.log("Glyph "+e.index+": unknown operator "+ve):ve<247?p.push(ve-139):ve<251?(Y=q[ee],ee+=1,p.push((ve-247)*256+Y+108)):ve<255?(Y=q[ee],ee+=1,p.push(-(ve-251)*256-Y-108)):(Y=q[ee],te=q[ee+1],H=q[ee+2],Z=q[ee+3],ee+=4,p.push((Y<<24|te<<16|H<<8|Z)/65536))}}}return P(r),e.advanceWidth=D,h}function Pb(a,e,r,i){var o=[],c,f=new We.Parser(a,e),h=f.parseCard8();if(h===0)for(var p=0;p<r;p++){if(c=f.parseCard8(),c>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+c+" (FD count "+i+")");o.push(c)}else if(h===3){var y=f.parseCard16(),v=f.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var x,b=0;b<y;b++){if(c=f.parseCard8(),x=f.parseCard16(),c>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+c+" (FD count "+i+")");if(x>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+x);for(;v<x;v++)o.push(c);v=x}if(x!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+x)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+h);return o}function zb(a,e,r,i){r.tables.cff={};var o=Ub(a,e),c=ks(a,o.endOffset,We.bytesToString),f=ks(a,c.endOffset),h=ks(a,f.endOffset,We.bytesToString),p=ks(a,h.endOffset);r.gsubrs=p.objects,r.gsubrsBias=Wf(r.gsubrs);var y=rm(a,e,f.objects,h.objects);if(y.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+y.length);var v=y[0];if(r.tables.cff.topDict=v,v._privateDict&&(r.defaultWidthX=v._privateDict.defaultWidthX,r.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var x=v.fdArray,b=v.fdSelect;if(x===0||b===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");x+=e;var S=ks(a,x),E=rm(a,e,S.objects,h.objects);v._fdArray=E,b+=e,v._fdSelect=Pb(a,b,r.numGlyphs,E.length)}var C=e+v.private[1],_=vg(a,C,v.private[0],h.objects);if(r.defaultWidthX=_.defaultWidthX,r.nominalWidthX=_.nominalWidthX,_.subrs!==0){var I=C+_.subrs,M=ks(a,I);r.subrs=M.objects,r.subrsBias=Wf(r.subrs)}else r.subrs=[],r.subrsBias=0;var N;i.lowMemory?(N=Db(a,e+v.charStrings),r.nGlyphs=N.offsets.length):(N=ks(a,e+v.charStrings),r.nGlyphs=N.objects.length);var D=Fb(a,e+v.charset,r.nGlyphs,h.objects);if(v.encoding===0?r.cffEncoding=new Tc(Sb,D):v.encoding===1?r.cffEncoding=new Tc(Eb,D):r.cffEncoding=jb(a,e+v.encoding,D),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Rr.GlyphSet(r),i.lowMemory)r._push=function(P){var q=_b(P,N.offsets,a,e+v.charStrings);r.glyphs.push(P,Rr.cffGlyphLoader(r,P,sm,q))};else for(var k=0;k<r.nGlyphs;k+=1){var G=N.objects[k];r.glyphs.push(k,Rr.cffGlyphLoader(r,k,sm,G))}}function bg(a,e){var r,i=yc.indexOf(a);return i>=0&&(r=i),i=e.indexOf(a),i>=0?r=i+yc.length:(r=yc.length+e.length,e.push(a)),r}function Gb(){return new Ve.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Hb(a){var e=new Ve.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<a.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:a[r]});return e}function xg(a,e,r){for(var i={},o=0;o<a.length;o+=1){var c=a[o],f=e[c.name];f!==void 0&&!pg(f,c.value)&&(c.type==="SID"&&(f=bg(f,r)),i[c.op]={name:c.name,type:c.type,value:f})}return i}function im(a,e){var r=new Ve.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=xg(gg,a,e),r}function lm(a){var e=new Ve.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:a}],e}function Yb(a){var e=new Ve.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<a.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:a[r]});return e}function qb(){return new Ve.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Vb(a,e){for(var r=new Ve.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<a.length;i+=1){var o=a[i],c=bg(o,e);r.fields.push({name:"glyph_"+i,type:"SID",value:c})}return r}function Xb(a){var e=[],r=a.path;e.push({name:"width",type:"NUMBER",value:a.advanceWidth});for(var i=0,o=0,c=0;c<r.commands.length;c+=1){var f=void 0,h=void 0,p=r.commands[c];if(p.type==="Q"){var y=.3333333333333333,v=2/3;p={type:"C",x:p.x,y:p.y,x1:Math.round(y*i+v*p.x1),y1:Math.round(y*o+v*p.y1),x2:Math.round(y*p.x+v*p.x1),y2:Math.round(y*p.y+v*p.y1)}}if(p.type==="M")f=Math.round(p.x-i),h=Math.round(p.y-o),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(p.x),o=Math.round(p.y);else if(p.type==="L")f=Math.round(p.x-i),h=Math.round(p.y-o),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rlineto",type:"OP",value:5}),i=Math.round(p.x),o=Math.round(p.y);else if(p.type==="C"){var x=Math.round(p.x1-i),b=Math.round(p.y1-o),S=Math.round(p.x2-p.x1),E=Math.round(p.y2-p.y1);f=Math.round(p.x-p.x2),h=Math.round(p.y-p.y2),e.push({name:"dx1",type:"NUMBER",value:x}),e.push({name:"dy1",type:"NUMBER",value:b}),e.push({name:"dx2",type:"NUMBER",value:S}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(p.x),o=Math.round(p.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function $b(a){for(var e=new Ve.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<a.length;r+=1){var i=a.get(r),o=Xb(i);e.charStrings.push({name:i.name,type:"CHARSTRING",value:o})}return e}function Zb(a,e){var r=new Ve.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=xg(yg,a,e),r}function Qb(a,e){for(var r=new Ve.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},c={},f=[],h,p=1;p<a.length;p+=1)h=a.get(p),f.push(h.name);var y=[];r.header=Gb(),r.nameIndex=Hb([e.postScriptName]);var v=im(o,y);r.topDictIndex=lm(v),r.globalSubrIndex=qb(),r.charsets=Vb(f,y),r.charStringsIndex=$b(a),r.privateDict=Zb(c,y),r.stringIndex=Yb(y);var x=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=x,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),v=im(o,y),r.topDictIndex=lm(v),r}var Sg={parse:zb,make:Qb};function Wb(a,e){var r={},i=new We.Parser(a,e);return r.version=i.parseVersion(),r.fontRevision=Math.round(i.parseFixed()*1e3)/1e3,r.checkSumAdjustment=i.parseULong(),r.magicNumber=i.parseULong(),ut.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=i.parseUShort(),r.unitsPerEm=i.parseUShort(),r.created=i.parseLongDateTime(),r.modified=i.parseLongDateTime(),r.xMin=i.parseShort(),r.yMin=i.parseShort(),r.xMax=i.parseShort(),r.yMax=i.parseShort(),r.macStyle=i.parseUShort(),r.lowestRecPPEM=i.parseUShort(),r.fontDirectionHint=i.parseShort(),r.indexToLocFormat=i.parseShort(),r.glyphDataFormat=i.parseShort(),r}function Kb(a){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return a.createdTimestamp&&(r=a.createdTimestamp+2082844800),new Ve.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],a)}var Eg={parse:Wb,make:Kb};function Jb(a,e){var r={},i=new We.Parser(a,e);return r.version=i.parseVersion(),r.ascender=i.parseShort(),r.descender=i.parseShort(),r.lineGap=i.parseShort(),r.advanceWidthMax=i.parseUShort(),r.minLeftSideBearing=i.parseShort(),r.minRightSideBearing=i.parseShort(),r.xMaxExtent=i.parseShort(),r.caretSlopeRise=i.parseShort(),r.caretSlopeRun=i.parseShort(),r.caretOffset=i.parseShort(),i.relativeOffset+=8,r.metricDataFormat=i.parseShort(),r.numberOfHMetrics=i.parseUShort(),r}function ex(a){return new Ve.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],a)}var wg={parse:Jb,make:ex};function tx(a,e,r,i,o){for(var c,f,h=new We.Parser(a,e),p=0;p<i;p+=1){p<r&&(c=h.parseUShort(),f=h.parseShort());var y=o.get(p);y.advanceWidth=c,y.leftSideBearing=f}}function nx(a,e,r,i,o){a._hmtxTableData={};for(var c,f,h=new We.Parser(e,r),p=0;p<o;p+=1)p<i&&(c=h.parseUShort(),f=h.parseShort()),a._hmtxTableData[p]={advanceWidth:c,leftSideBearing:f}}function ax(a,e,r,i,o,c,f){f.lowMemory?nx(a,e,r,i,o):tx(e,r,i,o,c)}function rx(a){for(var e=new Ve.Table("hmtx",[]),r=0;r<a.length;r+=1){var i=a.get(r),o=i.advanceWidth||0,c=i.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:c})}return e}var Ag={parse:ax,make:rx};function sx(a){for(var e=new Ve.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:a.length}]),r="",i=12+a.length*4,o=0;o<a.length;++o){var c=r.indexOf(a[o]);c<0&&(c=r.length,r+=a[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:i+c}),e.fields.push({name:"length "+o,type:"USHORT",value:a[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function ix(a,e){var r=new We.Parser(a,e),i=r.parseULong();ut.argument(i===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),c=[],f=0;f<o;f++){for(var h="",p=e+r.parseUShort(),y=r.parseUShort(),v=p;v<p+y;++v)h+=String.fromCharCode(a.getInt8(v));c.push(h)}return c}var Tg={make:sx,parse:ix};function lx(a,e){var r={},i=new We.Parser(a,e);return r.version=i.parseVersion(),r.numGlyphs=i.parseUShort(),r.version===1&&(r.maxPoints=i.parseUShort(),r.maxContours=i.parseUShort(),r.maxCompositePoints=i.parseUShort(),r.maxCompositeContours=i.parseUShort(),r.maxZones=i.parseUShort(),r.maxTwilightPoints=i.parseUShort(),r.maxStorage=i.parseUShort(),r.maxFunctionDefs=i.parseUShort(),r.maxInstructionDefs=i.parseUShort(),r.maxStackElements=i.parseUShort(),r.maxSizeOfInstructions=i.parseUShort(),r.maxComponentElements=i.parseUShort(),r.maxComponentDepth=i.parseUShort()),r}function ox(a){return new Ve.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:a}])}var Cg={parse:lx,make:ox},Mg=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ng={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},cx={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Rg={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function ux(a,e,r){switch(a){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Ng[e];case 3:return Rg[e]}}var Kf="utf-16",fx={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},dx={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function kg(a,e,r){switch(a){case 0:return Kf;case 1:return dx[r]||fx[e];case 3:if(e===1||e===10)return Kf;break}}function px(a,e,r){for(var i={},o=new We.Parser(a,e),c=o.parseUShort(),f=o.parseUShort(),h=o.offset+o.parseUShort(),p=0;p<f;p++){var y=o.parseUShort(),v=o.parseUShort(),x=o.parseUShort(),b=o.parseUShort(),S=Mg[b]||b,E=o.parseUShort(),C=o.parseUShort(),_=ux(y,x,r),I=kg(y,v,x);if(I!==void 0&&_!==void 0){var M=void 0;if(I===Kf?M=qi.UTF16(a,h+C,E):M=qi.MACSTRING(a,h+C,E,I),M){var N=i[S];N===void 0&&(N=i[S]={}),N[_]=M}}}return c===1&&o.parseUShort(),i}function If(a){var e={};for(var r in a)e[a[r]]=parseInt(r);return e}function om(a,e,r,i,o,c){return new Ve.Record("NameRecord",[{name:"platformID",type:"USHORT",value:a},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:c}])}function hx(a,e){var r=a.length,i=e.length-r+1;e:for(var o=0;o<i;o++)for(;o<i;o++){for(var c=0;c<r;c++)if(e[o+c]!==a[c])continue e;return o}return-1}function cm(a,e){var r=hx(a,e);if(r<0){r=e.length;for(var i=0,o=a.length;i<o;++i)e.push(a[i])}return r}function mx(a,e){var r,i=[],o={},c=If(Mg);for(var f in a){var h=c[f];if(h===void 0&&(h=f),r=parseInt(h),isNaN(r))throw new Error('Name table entry "'+f+'" does not exist, see nameTableNames for complete list.');o[r]=a[f],i.push(r)}for(var p=If(Ng),y=If(Rg),v=[],x=[],b=0;b<i.length;b++){r=i[b];var S=o[r];for(var E in S){var C=S[E],_=1,I=p[E],M=cx[I],N=kg(_,M,I),D=He.MACSTRING(C,N);D===void 0&&(_=0,I=e.indexOf(E),I<0&&(I=e.length,e.push(E)),M=4,D=He.UTF16(C));var k=cm(D,x);v.push(om(_,M,I,r,D.length,k));var G=y[E];if(G!==void 0){var P=He.UTF16(C),q=cm(P,x);v.push(om(3,1,G,r,P.length,q))}}}v.sort(function(H,Z){return H.platformID-Z.platformID||H.encodingID-Z.encodingID||H.languageID-Z.languageID||H.nameID-Z.nameID});for(var Y=new Ve.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),te=0;te<v.length;te++)Y.fields.push({name:"record_"+te,type:"RECORD",value:v[te]});return Y.fields.push({name:"strings",type:"LITERAL",value:x}),Y}var Dg={parse:px,make:mx},Jf=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function gx(a){for(var e=0;e<Jf.length;e+=1){var r=Jf[e];if(a>=r.begin&&a<r.end)return e}return-1}function yx(a,e){var r={},i=new We.Parser(a,e);r.version=i.parseUShort(),r.xAvgCharWidth=i.parseShort(),r.usWeightClass=i.parseUShort(),r.usWidthClass=i.parseUShort(),r.fsType=i.parseUShort(),r.ySubscriptXSize=i.parseShort(),r.ySubscriptYSize=i.parseShort(),r.ySubscriptXOffset=i.parseShort(),r.ySubscriptYOffset=i.parseShort(),r.ySuperscriptXSize=i.parseShort(),r.ySuperscriptYSize=i.parseShort(),r.ySuperscriptXOffset=i.parseShort(),r.ySuperscriptYOffset=i.parseShort(),r.yStrikeoutSize=i.parseShort(),r.yStrikeoutPosition=i.parseShort(),r.sFamilyClass=i.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=i.parseByte();return r.ulUnicodeRange1=i.parseULong(),r.ulUnicodeRange2=i.parseULong(),r.ulUnicodeRange3=i.parseULong(),r.ulUnicodeRange4=i.parseULong(),r.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),r.fsSelection=i.parseUShort(),r.usFirstCharIndex=i.parseUShort(),r.usLastCharIndex=i.parseUShort(),r.sTypoAscender=i.parseShort(),r.sTypoDescender=i.parseShort(),r.sTypoLineGap=i.parseShort(),r.usWinAscent=i.parseUShort(),r.usWinDescent=i.parseUShort(),r.version>=1&&(r.ulCodePageRange1=i.parseULong(),r.ulCodePageRange2=i.parseULong()),r.version>=2&&(r.sxHeight=i.parseShort(),r.sCapHeight=i.parseShort(),r.usDefaultChar=i.parseUShort(),r.usBreakChar=i.parseUShort(),r.usMaxContent=i.parseUShort()),r}function vx(a){return new Ve.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],a)}var ed={parse:yx,make:vx,unicodeRanges:Jf,getUnicodeRange:gx};function bx(a,e){var r={},i=new We.Parser(a,e);switch(r.version=i.parseVersion(),r.italicAngle=i.parseFixed(),r.underlinePosition=i.parseShort(),r.underlineThickness=i.parseShort(),r.isFixedPitch=i.parseULong(),r.minMemType42=i.parseULong(),r.maxMemType42=i.parseULong(),r.minMemType1=i.parseULong(),r.maxMemType1=i.parseULong(),r.version){case 1:r.names=si.slice();break;case 2:r.numberOfGlyphs=i.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=i.parseUShort();r.names=[];for(var c=0;c<r.numberOfGlyphs;c++)if(r.glyphNameIndex[c]>=si.length){var f=i.parseChar();r.names.push(i.parseString(f))}break;case 2.5:r.numberOfGlyphs=i.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var h=0;h<r.numberOfGlyphs;h++)r.offset[h]=i.parseChar();break}return r}function xx(){return new Ve.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var _g={parse:bx,make:xx},fr=new Array(9);fr[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(he.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(he.coverage),substitute:this.parseOffset16List()};ut.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};fr[2]=function(){var e=this.parseUShort();return ut.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(he.coverage),sequences:this.parseListOfLists()}};fr[3]=function(){var e=this.parseUShort();return ut.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(he.coverage),alternateSets:this.parseListOfLists()}};fr[4]=function(){var e=this.parseUShort();return ut.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(he.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Hi={sequenceIndex:he.uShort,lookupListIndex:he.uShort};fr[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(he.coverage),ruleSets:this.parseListOfLists(function(){var c=this.parseUShort(),f=this.parseUShort();return{input:this.parseUShortList(c-1),lookupRecords:this.parseRecordList(f,Hi)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(he.coverage),classDef:this.parsePointer(he.classDef),classSets:this.parseListOfLists(function(){var c=this.parseUShort(),f=this.parseUShort();return{classes:this.parseUShortList(c-1),lookupRecords:this.parseRecordList(f,Hi)}})};if(r===3){var i=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(i,he.pointer(he.coverage)),lookupRecords:this.parseRecordList(o,Hi)}}ut.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};fr[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(he.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Hi)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(he.coverage),backtrackClassDef:this.parsePointer(he.classDef),inputClassDef:this.parsePointer(he.classDef),lookaheadClassDef:this.parsePointer(he.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Hi)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(he.pointer(he.coverage)),inputCoverage:this.parseList(he.pointer(he.coverage)),lookaheadCoverage:this.parseList(he.pointer(he.coverage)),lookupRecords:this.parseRecordList(Hi)};ut.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};fr[7]=function(){var e=this.parseUShort();ut.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),i=new he(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:fr[r].call(i)}};fr[8]=function(){var e=this.parseUShort();return ut.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(he.coverage),backtrackCoverage:this.parseList(he.pointer(he.coverage)),lookaheadCoverage:this.parseList(he.pointer(he.coverage)),substitutes:this.parseUShortList()}};function Sx(a,e){e=e||0;var r=new he(a,e),i=r.parseVersion(1);return ut.argument(i===1||i===1.1,"Unsupported GSUB table version."),i===1?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(fr)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(fr),variations:r.parseFeatureVariationsList()}}var Vi=new Array(9);Vi[1]=function(e){return e.substFormat===1?new Ve.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Ve.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)}].concat(Ve.ushortList("substitute",e.substitute)))};Vi[2]=function(e){return ut.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Ve.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)}].concat(Ve.tableList("seqSet",e.sequences,function(r){return new Ve.Table("sequenceSetTable",Ve.ushortList("sequence",r))})))};Vi[3]=function(e){return ut.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Ve.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)}].concat(Ve.tableList("altSet",e.alternateSets,function(r){return new Ve.Table("alternateSetTable",Ve.ushortList("alternate",r))})))};Vi[4]=function(e){return ut.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Ve.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)}].concat(Ve.tableList("ligSet",e.ligatureSets,function(r){return new Ve.Table("ligatureSetTable",Ve.tableList("ligature",r,function(i){return new Ve.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:i.ligGlyph}].concat(Ve.ushortList("component",i.components,i.components.length+1)))}))})))};Vi[6]=function(e){if(e.substFormat===1){var r=new Ve.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Ve.Coverage(e.coverage)}].concat(Ve.tableList("chainRuleSet",e.chainRuleSets,function(c){return new Ve.Table("chainRuleSetTable",Ve.tableList("chainRule",c,function(f){var h=Ve.ushortList("backtrackGlyph",f.backtrack,f.backtrack.length).concat(Ve.ushortList("inputGlyph",f.input,f.input.length+1)).concat(Ve.ushortList("lookaheadGlyph",f.lookahead,f.lookahead.length)).concat(Ve.ushortList("substitution",[],f.lookupRecords.length));return f.lookupRecords.forEach(function(p,y){h=h.concat({name:"sequenceIndex"+y,type:"USHORT",value:p.sequenceIndex}).concat({name:"lookupListIndex"+y,type:"USHORT",value:p.lookupListIndex})}),new Ve.Table("chainRuleTable",h)}))})));return r}else if(e.substFormat===2)ut.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var i=[{name:"substFormat",type:"USHORT",value:e.substFormat}];i.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(c,f){i.push({name:"backtrackCoverage"+f,type:"TABLE",value:new Ve.Coverage(c)})}),i.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(c,f){i.push({name:"inputCoverage"+f,type:"TABLE",value:new Ve.Coverage(c)})}),i.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(c,f){i.push({name:"lookaheadCoverage"+f,type:"TABLE",value:new Ve.Coverage(c)})}),i.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(c,f){i=i.concat({name:"sequenceIndex"+f,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+f,type:"USHORT",value:c.lookupListIndex})});var o=new Ve.Table("chainContextTable",i);return o}ut.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Ex(a){return new Ve.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Ve.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Ve.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Ve.LookupList(a.lookups,Vi)}])}var Og={parse:Sx,make:Ex};function wx(a,e){var r=new We.Parser(a,e),i=r.parseULong();ut.argument(i===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),c={},f=0;f<o;f++){var h=r.parseTag(),p=r.parseULong(),y=r.parseULong(),v=qi.UTF8(a,e+p,y);c[h]=v}return c}function Ax(a){var e=Object.keys(a).length,r="",i=16+e*12,o=new Ve.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:e}]);for(var c in a){var f=r.length;r+=a[c],o.fields.push({name:"tag "+c,type:"TAG",value:c}),o.fields.push({name:"offset "+c,type:"ULONG",value:i+f}),o.fields.push({name:"length "+c,type:"ULONG",value:a[c].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var Ig={parse:wx,make:Ax};function um(a){return Math.log(a)/Math.log(2)|0}function hd(a){for(;a.length%4!==0;)a.push(0);for(var e=0,r=0;r<a.length;r+=4)e+=(a[r]<<24)+(a[r+1]<<16)+(a[r+2]<<8)+a[r+3];return e%=Math.pow(2,32),e}function fm(a,e,r,i){return new Ve.Record("Table Record",[{name:"tag",type:"TAG",value:a!==void 0?a:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:i!==void 0?i:0}])}function Lg(a){var e=new Ve.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=a,e.numTables=a.length;var r=Math.pow(2,um(e.numTables));e.searchRange=16*r,e.entrySelector=um(r),e.rangeShift=e.numTables*16-e.searchRange;for(var i=[],o=[],c=e.sizeOf()+fm().sizeOf()*e.numTables;c%4!==0;)c+=1,o.push({name:"padding",type:"BYTE",value:0});for(var f=0;f<a.length;f+=1){var h=a[f];ut.argument(h.tableName.length===4,"Table name"+h.tableName+" is invalid.");var p=h.sizeOf(),y=fm(h.tableName,hd(h.encode()),c,p);for(i.push({name:y.tag+" Table Record",type:"RECORD",value:y}),o.push({name:h.tableName+" table",type:"RECORD",value:h}),c+=p,ut.argument(!isNaN(c),"Something went wrong calculating the offset.");c%4!==0;)c+=1,o.push({name:"padding",type:"BYTE",value:0})}return i.sort(function(v,x){return v.value.tag>x.value.tag?1:-1}),e.fields=e.fields.concat(i),e.fields=e.fields.concat(o),e}function dm(a,e,r){for(var i=0;i<e.length;i+=1){var o=a.charToGlyphIndex(e[i]);if(o>0){var c=a.glyphs.get(o);return c.getMetrics()}}return r}function Tx(a){for(var e=0,r=0;r<a.length;r+=1)e+=a[r];return e/a.length}function Cx(a){for(var e=[],r=[],i=[],o=[],c=[],f=[],h=[],p,y=0,v=0,x=0,b=0,S=0,E=0;E<a.glyphs.length;E+=1){var C=a.glyphs.get(E),_=C.unicode|0;if(isNaN(C.advanceWidth))throw new Error("Glyph "+C.name+" ("+E+"): advanceWidth is not a number.");(p>_||p===void 0)&&_>0&&(p=_),y<_&&(y=_);var I=ed.getUnicodeRange(_);if(I<32)v|=1<<I;else if(I<64)x|=1<<I-32;else if(I<96)b|=1<<I-64;else if(I<123)S|=1<<I-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(C.name!==".notdef"){var M=C.getMetrics();e.push(M.xMin),r.push(M.yMin),i.push(M.xMax),o.push(M.yMax),f.push(M.leftSideBearing),h.push(M.rightSideBearing),c.push(C.advanceWidth)}}var N={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,c),advanceWidthAvg:Tx(c),minLeftSideBearing:Math.min.apply(null,f),maxLeftSideBearing:Math.max.apply(null,f),minRightSideBearing:Math.min.apply(null,h)};N.ascender=a.ascender,N.descender=a.descender;var D=Eg.make({flags:3,unitsPerEm:a.unitsPerEm,xMin:N.xMin,yMin:N.yMin,xMax:N.xMax,yMax:N.yMax,lowestRecPPEM:3,createdTimestamp:a.createdTimestamp}),k=wg.make({ascender:N.ascender,descender:N.descender,advanceWidthMax:N.advanceWidthMax,minLeftSideBearing:N.minLeftSideBearing,minRightSideBearing:N.minRightSideBearing,xMaxExtent:N.maxLeftSideBearing+(N.xMax-N.xMin),numberOfHMetrics:a.glyphs.length}),G=Cg.make(a.glyphs.length),P=ed.make(Object.assign({xAvgCharWidth:Math.round(N.advanceWidthAvg),usFirstCharIndex:p,usLastCharIndex:y,ulUnicodeRange1:v,ulUnicodeRange2:x,ulUnicodeRange3:b,ulUnicodeRange4:S,sTypoAscender:N.ascender,sTypoDescender:N.descender,sTypoLineGap:0,usWinAscent:N.yMax,usWinDescent:Math.abs(N.yMin),ulCodePageRange1:1,sxHeight:dm(a,"xyvw",{yMax:Math.round(N.ascender/2)}).yMax,sCapHeight:dm(a,"HIKLEFJMNTZBDPRAGOQSUVWXY",N).yMax,usDefaultChar:a.hasChar(" ")?32:0,usBreakChar:a.hasChar(" ")?32:0},a.tables.os2)),q=Ag.make(a.glyphs),Y=ug.make(a.glyphs),te=a.getEnglishName("fontFamily"),H=a.getEnglishName("fontSubfamily"),Z=te+" "+H,W=a.getEnglishName("postScriptName");W||(W=te.replace(/\s/g,"")+"-"+H);var X={};for(var K in a.names)X[K]=a.names[K];X.uniqueID||(X.uniqueID={en:a.getEnglishName("manufacturer")+":"+Z}),X.postScriptName||(X.postScriptName={en:W}),X.preferredFamily||(X.preferredFamily=a.names.fontFamily),X.preferredSubfamily||(X.preferredSubfamily=a.names.fontSubfamily);var F=[],z=Dg.make(X,F),ie=F.length>0?Tg.make(F):void 0,be=_g.make(),U=Sg.make(a.glyphs,{version:a.getEnglishName("version"),fullName:Z,familyName:te,weightName:H,postScriptName:W,unitsPerEm:a.unitsPerEm,fontBBox:[0,N.yMin,N.ascender,N.advanceWidthMax]}),ee=a.metas&&Object.keys(a.metas).length>0?Ig.make(a.metas):void 0,ve=[D,k,G,P,z,Y,be,U,q];ie&&ve.push(ie),a.tables.gsub&&ve.push(Og.make(a.tables.gsub)),ee&&ve.push(ee);for(var Me=Lg(ve),me=Me.encode(),Ce=hd(me),Oe=Me.fields,at=!1,tt=0;tt<Oe.length;tt+=1)if(Oe[tt].name==="head table"){Oe[tt].value.checkSumAdjustment=2981146554-Ce,at=!0;break}if(!at)throw new Error("Could not find head table with checkSum to adjust.");return Me}var Mx={make:Lg,fontToTable:Cx,computeCheckSum:hd};function Lf(a,e){for(var r=0,i=a.length-1;r<=i;){var o=r+i>>>1,c=a[o].tag;if(c===e)return o;c<e?r=o+1:i=o-1}return-r-1}function pm(a,e){for(var r=0,i=a.length-1;r<=i;){var o=r+i>>>1,c=a[o];if(c===e)return o;c<e?r=o+1:i=o-1}return-r-1}function hm(a,e){for(var r,i=0,o=a.length-1;i<=o;){var c=i+o>>>1;r=a[c];var f=r.start;if(f===e)return r;f<e?i=c+1:o=c-1}if(i>0)return r=a[i-1],e>r.end?0:r}function Jl(a,e){this.font=a,this.tableName=e}Jl.prototype={searchTag:Lf,binSearch:pm,getTable:function(a){var e=this.font.tables[this.tableName];return!e&&a&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var a=this.getTable();return a?a.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var a=this.getTable();if(a){for(var e=!1,r=0;r<a.scripts.length;r++){var i=a.scripts[r].tag;if(i==="DFLT")return i;i==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(a,e){var r=this.getTable(e);if(r){a=a||"DFLT";var i=r.scripts,o=Lf(r.scripts,a);if(o>=0)return i[o].script;if(e){var c={tag:a,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-o,0,c),c.script}}},getLangSysTable:function(a,e,r){var i=this.getScriptTable(a,r);if(i){if(!e||e==="dflt"||e==="DFLT")return i.defaultLangSys;var o=Lf(i.langSysRecords,e);if(o>=0)return i.langSysRecords[o].langSys;if(r){var c={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-o,0,c),c.langSys}}},getFeatureTable:function(a,e,r,i){var o=this.getLangSysTable(a,e,i);if(o){for(var c,f=o.featureIndexes,h=this.font.tables[this.tableName].features,p=0;p<f.length;p++)if(c=h[f[p]],c.tag===r)return c.feature;if(i){var y=h.length;return ut.assert(y===0||r>=h[y-1].tag,"Features must be added in alphabetical order."),c={tag:r,feature:{params:0,lookupListIndexes:[]}},h.push(c),f.push(y),c.feature}}},getLookupTables:function(a,e,r,i,o){var c=this.getFeatureTable(a,e,r,o),f=[];if(c){for(var h,p=c.lookupListIndexes,y=this.font.tables[this.tableName].lookups,v=0;v<p.length;v++)h=y[p[v]],h.lookupType===i&&f.push(h);if(f.length===0&&o){h={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var x=y.length;return y.push(h),p.push(x),[h]}}return f},getGlyphClass:function(a,e){switch(a.format){case 1:return a.startGlyph<=e&&e<a.startGlyph+a.classes.length?a.classes[e-a.startGlyph]:0;case 2:var r=hm(a.ranges,e);return r?r.classId:0}},getCoverageIndex:function(a,e){switch(a.format){case 1:var r=pm(a.glyphs,e);return r>=0?r:-1;case 2:var i=hm(a.ranges,e);return i?i.index+e-i.start:-1}},expandCoverage:function(a){if(a.format===1)return a.glyphs;for(var e=[],r=a.ranges,i=0;i<r.length;i++)for(var o=r[i],c=o.start,f=o.end,h=c;h<=f;h++)e.push(h);return e}};function eo(a){Jl.call(this,a,"gpos")}eo.prototype=Jl.prototype;eo.prototype.init=function(){var a=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(a)};eo.prototype.getKerningValue=function(a,e,r){for(var i=0;i<a.length;i++)for(var o=a[i].subtables,c=0;c<o.length;c++){var f=o[c],h=this.getCoverageIndex(f.coverage,e);if(!(h<0))switch(f.posFormat){case 1:for(var p=f.pairSets[h],y=0;y<p.length;y++){var v=p[y];if(v.secondGlyph===r)return v.value1&&v.value1.xAdvance||0}break;case 2:var x=this.getGlyphClass(f.classDef1,e),b=this.getGlyphClass(f.classDef2,r),S=f.classRecords[x][b];return S.value1&&S.value1.xAdvance||0}}return 0};eo.prototype.getKerningTables=function(a,e){if(this.font.tables.gpos)return this.getLookupTables(a,e,"kern",2)};function Pa(a){Jl.call(this,a,"gsub")}function Nx(a,e){var r=a.length;if(r!==e.length)return!1;for(var i=0;i<r;i++)if(a[i]!==e[i])return!1;return!0}function md(a,e,r){for(var i=a.subtables,o=0;o<i.length;o++){var c=i[o];if(c.substFormat===e)return c}if(r)return i.push(r),r}Pa.prototype=Jl.prototype;Pa.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};Pa.prototype.getSingle=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,1),c=0;c<o.length;c++)for(var f=o[c].subtables,h=0;h<f.length;h++){var p=f[h],y=this.expandCoverage(p.coverage),v=void 0;if(p.substFormat===1){var x=p.deltaGlyphId;for(v=0;v<y.length;v++){var b=y[v];i.push({sub:b,by:b+x})}}else{var S=p.substitute;for(v=0;v<y.length;v++)i.push({sub:y[v],by:S[v]})}}return i};Pa.prototype.getMultiple=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,2),c=0;c<o.length;c++)for(var f=o[c].subtables,h=0;h<f.length;h++){var p=f[h],y=this.expandCoverage(p.coverage),v=void 0;for(v=0;v<y.length;v++){var x=y[v],b=p.sequences[v];i.push({sub:x,by:b})}}return i};Pa.prototype.getAlternates=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,3),c=0;c<o.length;c++)for(var f=o[c].subtables,h=0;h<f.length;h++)for(var p=f[h],y=this.expandCoverage(p.coverage),v=p.alternateSets,x=0;x<y.length;x++)i.push({sub:y[x],by:v[x]});return i};Pa.prototype.getLigatures=function(a,e,r){for(var i=[],o=this.getLookupTables(e,r,a,4),c=0;c<o.length;c++)for(var f=o[c].subtables,h=0;h<f.length;h++)for(var p=f[h],y=this.expandCoverage(p.coverage),v=p.ligatureSets,x=0;x<y.length;x++)for(var b=y[x],S=v[x],E=0;E<S.length;E++){var C=S[E];i.push({sub:[b].concat(C.components),by:C.ligGlyph})}return i};Pa.prototype.addSingle=function(a,e,r,i){var o=this.getLookupTables(r,i,a,1,!0)[0],c=md(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ut.assert(c.coverage.format===1,"Single: unable to modify coverage table format "+c.coverage.format);var f=e.sub,h=this.binSearch(c.coverage.glyphs,f);h<0&&(h=-1-h,c.coverage.glyphs.splice(h,0,f),c.substitute.splice(h,0,0)),c.substitute[h]=e.by};Pa.prototype.addMultiple=function(a,e,r,i){ut.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,i,a,2,!0)[0],c=md(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ut.assert(c.coverage.format===1,"Multiple: unable to modify coverage table format "+c.coverage.format);var f=e.sub,h=this.binSearch(c.coverage.glyphs,f);h<0&&(h=-1-h,c.coverage.glyphs.splice(h,0,f),c.sequences.splice(h,0,0)),c.sequences[h]=e.by};Pa.prototype.addAlternate=function(a,e,r,i){var o=this.getLookupTables(r,i,a,3,!0)[0],c=md(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ut.assert(c.coverage.format===1,"Alternate: unable to modify coverage table format "+c.coverage.format);var f=e.sub,h=this.binSearch(c.coverage.glyphs,f);h<0&&(h=-1-h,c.coverage.glyphs.splice(h,0,f),c.alternateSets.splice(h,0,0)),c.alternateSets[h]=e.by};Pa.prototype.addLigature=function(a,e,r,i){var o=this.getLookupTables(r,i,a,4,!0)[0],c=o.subtables[0];c||(c={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=c),ut.assert(c.coverage.format===1,"Ligature: unable to modify coverage table format "+c.coverage.format);var f=e.sub[0],h=e.sub.slice(1),p={ligGlyph:e.by,components:h},y=this.binSearch(c.coverage.glyphs,f);if(y>=0){for(var v=c.ligatureSets[y],x=0;x<v.length;x++)if(Nx(v[x].components,h))return;v.push(p)}else y=-1-y,c.coverage.glyphs.splice(y,0,f),c.ligatureSets.splice(y,0,[p])};Pa.prototype.getFeature=function(a,e,r){if(/ss\d\d/.test(a))return this.getSingle(a,e,r);switch(a){case"aalt":case"salt":return this.getSingle(a,e,r).concat(this.getAlternates(a,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(a,e,r);case"ccmp":return this.getMultiple(a,e,r).concat(this.getLigatures(a,e,r));case"stch":return this.getMultiple(a,e,r)}};Pa.prototype.add=function(a,e,r,i){if(/ss\d\d/.test(a))return this.addSingle(a,e,r,i);switch(a){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(a,e,r,i):this.addAlternate(a,e,r,i);case"dlig":case"liga":case"rlig":return this.addLigature(a,e,r,i);case"ccmp":return e.by instanceof Array?this.addMultiple(a,e,r,i):this.addLigature(a,e,r,i)}};function Rx(){return typeof window<"u"}function Ug(a){for(var e=new ArrayBuffer(a.length),r=new Uint8Array(e),i=0;i<a.length;++i)r[i]=a[i];return e}function kx(a){for(var e=new Buffer(a.byteLength),r=new Uint8Array(a),i=0;i<e.length;++i)e[i]=r[i];return e}function Gl(a,e){if(!a)throw e}function mm(a,e,r,i,o){var c;return(e&i)>0?(c=a.parseByte(),(e&o)===0&&(c=-c),c=r+c):(e&o)>0?c=r:c=r+a.parseShort(),c}function Bg(a,e,r){var i=new We.Parser(e,r);a.numberOfContours=i.parseShort(),a._xMin=i.parseShort(),a._yMin=i.parseShort(),a._xMax=i.parseShort(),a._yMax=i.parseShort();var o,c;if(a.numberOfContours>0){for(var f=a.endPointIndices=[],h=0;h<a.numberOfContours;h+=1)f.push(i.parseUShort());a.instructionLength=i.parseUShort(),a.instructions=[];for(var p=0;p<a.instructionLength;p+=1)a.instructions.push(i.parseByte());var y=f[f.length-1]+1;o=[];for(var v=0;v<y;v+=1)if(c=i.parseByte(),o.push(c),(c&8)>0)for(var x=i.parseByte(),b=0;b<x;b+=1)o.push(c),v+=1;if(ut.argument(o.length===y,"Bad flags."),f.length>0){var S=[],E;if(y>0){for(var C=0;C<y;C+=1)c=o[C],E={},E.onCurve=!!(c&1),E.lastPointOfContour=f.indexOf(C)>=0,S.push(E);for(var _=0,I=0;I<y;I+=1)c=o[I],E=S[I],E.x=mm(i,c,_,2,16),_=E.x;for(var M=0,N=0;N<y;N+=1)c=o[N],E=S[N],E.y=mm(i,c,M,4,32),M=E.y}a.points=S}else a.points=[]}else if(a.numberOfContours===0)a.points=[];else{a.isComposite=!0,a.points=[],a.components=[];for(var D=!0;D;){o=i.parseUShort();var k={glyphIndex:i.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(k.dx=i.parseShort(),k.dy=i.parseShort()):k.matchedPoints=[i.parseUShort(),i.parseUShort()]:(o&2)>0?(k.dx=i.parseChar(),k.dy=i.parseChar()):k.matchedPoints=[i.parseByte(),i.parseByte()],(o&8)>0?k.xScale=k.yScale=i.parseF2Dot14():(o&64)>0?(k.xScale=i.parseF2Dot14(),k.yScale=i.parseF2Dot14()):(o&128)>0&&(k.xScale=i.parseF2Dot14(),k.scale01=i.parseF2Dot14(),k.scale10=i.parseF2Dot14(),k.yScale=i.parseF2Dot14()),a.components.push(k),D=!!(o&32)}if(o&256){a.instructionLength=i.parseUShort(),a.instructions=[];for(var G=0;G<a.instructionLength;G+=1)a.instructions.push(i.parseByte())}}}function Uf(a,e){for(var r=[],i=0;i<a.length;i+=1){var o=a[i],c={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(c)}return r}function Dx(a){for(var e=[],r=[],i=0;i<a.length;i+=1){var o=a[i];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return ut.argument(r.length===0,"There are still points left in the current contour."),e}function Fg(a){var e=new Dn;if(!a)return e;for(var r=Dx(a),i=0;i<r.length;++i){var o=r[i],c=null,f=o[o.length-1],h=o[0];if(f.onCurve)e.moveTo(f.x,f.y);else if(h.onCurve)e.moveTo(h.x,h.y);else{var p={x:(f.x+h.x)*.5,y:(f.y+h.y)*.5};e.moveTo(p.x,p.y)}for(var y=0;y<o.length;++y)if(c=f,f=h,h=o[(y+1)%o.length],f.onCurve)e.lineTo(f.x,f.y);else{var v=h;c.onCurve||((f.x+c.x)*.5,(f.y+c.y)*.5),h.onCurve||(v={x:(f.x+h.x)*.5,y:(f.y+h.y)*.5}),e.quadraticCurveTo(f.x,f.y,v.x,v.y)}e.closePath()}return e}function jg(a,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var i=e.components[r],o=a.get(i.glyphIndex);if(o.getPath(),o.points){var c=void 0;if(i.matchedPoints===void 0)c=Uf(o.points,i);else{if(i.matchedPoints[0]>e.points.length-1||i.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var f=e.points[i.matchedPoints[0]],h=o.points[i.matchedPoints[1]],p={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};h=Uf([h],p)[0],p.dx=f.x-h.x,p.dy=f.y-h.y,c=Uf(o.points,p)}e.points=e.points.concat(c)}}return Fg(e.points)}function _x(a,e,r,i){for(var o=new Rr.GlyphSet(i),c=0;c<r.length-1;c+=1){var f=r[c],h=r[c+1];f!==h?o.push(c,Rr.ttfGlyphLoader(i,c,Bg,a,e+f,jg)):o.push(c,Rr.glyphLoader(i,c))}return o}function Ox(a,e,r,i){var o=new Rr.GlyphSet(i);return i._push=function(c){var f=r[c],h=r[c+1];f!==h?o.push(c,Rr.ttfGlyphLoader(i,c,Bg,a,e+f,jg)):o.push(c,Rr.glyphLoader(i,c))},o}function Ix(a,e,r,i,o){return o.lowMemory?Ox(a,e,r,i):_x(a,e,r,i)}var Pg={getPath:Fg,parse:Ix},zg,li,Gg,td;function Hg(a){this.font=a,this.getCommands=function(e){return Pg.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Lx(a){return a}function Yg(a){return Math.sign(a)*Math.round(Math.abs(a))}function Ux(a){return Math.sign(a)*Math.round(Math.abs(a*2))/2}function Bx(a){return Math.sign(a)*(Math.round(Math.abs(a)+.5)-.5)}function Fx(a){return Math.sign(a)*Math.ceil(Math.abs(a))}function jx(a){return Math.sign(a)*Math.floor(Math.abs(a))}var qg=function(a){var e=this.srPeriod,r=this.srPhase,i=this.srThreshold,o=1;return a<0&&(a=-a,o=-1),a+=i-r,a=Math.trunc(a/e)*e,a+=r,a<0?r*o:a*o},Nr={x:1,y:0,axis:"x",distance:function(a,e,r,i){return(r?a.xo:a.x)-(i?e.xo:e.x)},interpolate:function(a,e,r,i){var o,c,f,h,p,y,v;if(!i||i===this){if(o=a.xo-e.xo,c=a.xo-r.xo,p=e.x-e.xo,y=r.x-r.xo,f=Math.abs(o),h=Math.abs(c),v=f+h,v===0){a.x=a.xo+(p+y)/2;return}a.x=a.xo+(p*h+y*f)/v;return}if(o=i.distance(a,e,!0,!0),c=i.distance(a,r,!0,!0),p=i.distance(e,e,!1,!0),y=i.distance(r,r,!1,!0),f=Math.abs(o),h=Math.abs(c),v=f+h,v===0){Nr.setRelative(a,a,(p+y)/2,i,!0);return}Nr.setRelative(a,a,(p*h+y*f)/v,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(a,e,r,i,o){if(!i||i===this){a.x=(o?e.xo:e.x)+r;return}var c=o?e.xo:e.x,f=o?e.yo:e.y,h=c+r*i.x,p=f+r*i.y;a.x=h+(a.y-p)/i.normalSlope},slope:0,touch:function(a){a.xTouched=!0},touched:function(a){return a.xTouched},untouch:function(a){a.xTouched=!1}},Wr={x:0,y:1,axis:"y",distance:function(a,e,r,i){return(r?a.yo:a.y)-(i?e.yo:e.y)},interpolate:function(a,e,r,i){var o,c,f,h,p,y,v;if(!i||i===this){if(o=a.yo-e.yo,c=a.yo-r.yo,p=e.y-e.yo,y=r.y-r.yo,f=Math.abs(o),h=Math.abs(c),v=f+h,v===0){a.y=a.yo+(p+y)/2;return}a.y=a.yo+(p*h+y*f)/v;return}if(o=i.distance(a,e,!0,!0),c=i.distance(a,r,!0,!0),p=i.distance(e,e,!1,!0),y=i.distance(r,r,!1,!0),f=Math.abs(o),h=Math.abs(c),v=f+h,v===0){Wr.setRelative(a,a,(p+y)/2,i,!0);return}Wr.setRelative(a,a,(p*h+y*f)/v,i,!0)},normalSlope:0,setRelative:function(a,e,r,i,o){if(!i||i===this){a.y=(o?e.yo:e.y)+r;return}var c=o?e.xo:e.x,f=o?e.yo:e.y,h=c+r*i.x,p=f+r*i.y;a.y=p+i.normalSlope*(a.x-h)},slope:Number.POSITIVE_INFINITY,touch:function(a){a.yTouched=!0},touched:function(a){return a.yTouched},untouch:function(a){a.yTouched=!1}};Object.freeze(Nr);Object.freeze(Wr);function to(a,e){this.x=a,this.y=e,this.axis=void 0,this.slope=e/a,this.normalSlope=-a/e,Object.freeze(this)}to.prototype.distance=function(a,e,r,i){return this.x*Nr.distance(a,e,r,i)+this.y*Wr.distance(a,e,r,i)};to.prototype.interpolate=function(a,e,r,i){var o,c,f,h,p,y,v;if(f=i.distance(a,e,!0,!0),h=i.distance(a,r,!0,!0),o=i.distance(e,e,!1,!0),c=i.distance(r,r,!1,!0),p=Math.abs(f),y=Math.abs(h),v=p+y,v===0){this.setRelative(a,a,(o+c)/2,i,!0);return}this.setRelative(a,a,(o*y+c*p)/v,i,!0)};to.prototype.setRelative=function(a,e,r,i,o){i=i||this;var c=o?e.xo:e.x,f=o?e.yo:e.y,h=c+r*i.x,p=f+r*i.y,y=i.normalSlope,v=this.slope,x=a.x,b=a.y;a.x=(v*x-y*h+p-b)/(v-y),a.y=v*(a.x-x)+b};to.prototype.touch=function(a){a.xTouched=!0,a.yTouched=!0};function no(a,e){var r=Math.sqrt(a*a+e*e);return a/=r,e/=r,a===1&&e===0?Nr:a===0&&e===1?Wr:new to(a,e)}function Kr(a,e,r,i){this.x=this.xo=Math.round(a*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Kr.prototype.nextTouched=function(a){for(var e=this.nextPointOnContour;!a.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Kr.prototype.prevTouched=function(a){for(var e=this.prevPointOnContour;!a.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Wl=Object.freeze(new Kr(0,0)),Px={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Ds(a,e){switch(this.env=a,this.stack=[],this.prog=e,a){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Nr,this.round=Yg}}Hg.prototype.exec=function(a,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,i=this._prepState;if(!i||i.ppem!==e){var o=this._fpgmState;if(!o){Ds.prototype=Px,o=this._fpgmState=new Ds("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{li(o)}catch(y){console.log("Hinting error in FPGM:"+y),this._errorState=3;return}}Ds.prototype=o,i=this._prepState=new Ds("prep",r.tables.prep),i.ppem=e;var c=r.tables.cvt;if(c)for(var f=i.cvt=new Array(c.length),h=e/r.unitsPerEm,p=0;p<c.length;p++)f[p]=c[p]*h;else i.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{li(i)}catch(y){this._errorState<2&&console.log("Hinting error in PREP:"+y),this._errorState=2}}if(!(this._errorState>1))try{return Gg(a,i)}catch(y){this._errorState<1&&(console.log("Hinting error:"+y),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Gg=function(a,e){var r=e.ppem/e.font.unitsPerEm,i=r,o=a.components,c,f,h;if(Ds.prototype=e,!o)h=new Ds("glyf",a.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),h.step=-1),td(a,h,r,i),f=h.gZone;else{var p=e.font;f=[],c=[];for(var y=0;y<o.length;y++){var v=o[y],x=p.glyphs.get(v.glyphIndex);h=new Ds("glyf",x.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+y+"---"),h.step=-1),td(x,h,r,i);for(var b=Math.round(v.dx*r),S=Math.round(v.dy*i),E=h.gZone,C=h.contours,_=0;_<E.length;_++){var I=E[_];I.xTouched=I.yTouched=!1,I.xo=I.x=I.x+b,I.yo=I.y=I.y+S}var M=f.length;f.push.apply(f,E);for(var N=0;N<C.length;N++)c.push(C[N]+M)}a.instructions&&!h.inhibitGridFit&&(h=new Ds("glyf",a.instructions),h.gZone=h.z0=h.z1=h.z2=f,h.contours=c,f.push(new Kr(0,0),new Kr(Math.round(a.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),h.step=-1),li(h),f.length-=2)}return f};td=function(a,e,r,i){for(var o=a.points||[],c=o.length,f=e.gZone=e.z0=e.z1=e.z2=[],h=e.contours=[],p,y=0;y<c;y++)p=o[y],f[y]=new Kr(p.x*r,p.y*i,p.lastPointOfContour,p.onCurve);for(var v,x,b=0;b<c;b++)p=f[b],v||(v=p,h.push(b)),p.lastPointOfContour?(p.nextPointOnContour=v,v.prevPointOnContour=p,v=void 0):(x=f[b+1],p.nextPointOnContour=x,x.prevPointOnContour=p);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var S=0;S<c;S++)console.log(S,f[S].x,f[S].y)}if(f.push(new Kr(0,0),new Kr(Math.round(a.advanceWidth*r),0)),li(e),f.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<c;E++)console.log(E,f[E].x,f[E].y)}}};li=function(a){var e=a.prog;if(e){var r=e.length,i;for(a.ip=0;a.ip<r;a.ip++){if(exports.DEBUG&&a.step++,i=zg[e[a.ip]],!i)throw new Error("unknown instruction: 0x"+Number(e[a.ip]).toString(16));i(a)}}};function Mc(a){for(var e=a.tZone=new Array(a.gZone.length),r=0;r<e.length;r++)e[r]=new Kr(0,0)}function Vg(a,e){var r=a.prog,i=a.ip,o=1,c;do if(c=r[++i],c===88)o++;else if(c===89)o--;else if(c===64)i+=r[i+1]+1;else if(c===65)i+=2*r[i+1]+1;else if(c>=176&&c<=183)i+=c-176+1;else if(c>=184&&c<=191)i+=(c-184+1)*2;else if(e&&o===1&&c===27)break;while(o>0);a.ip=i}function gm(a,e){exports.DEBUG&&console.log(e.step,"SVTCA["+a.axis+"]"),e.fv=e.pv=e.dpv=a}function ym(a,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+a.axis+"]"),e.pv=e.dpv=a}function vm(a,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+a.axis+"]"),e.fv=a}function bm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log("SPVTL["+a+"]",i,o);var h,p;a?(h=c.y-f.y,p=f.x-c.x):(h=f.x-c.x,p=f.y-c.y),e.pv=e.dpv=no(h,p)}function xm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log("SFVTL["+a+"]",i,o);var h,p;a?(h=c.y-f.y,p=f.x-c.x):(h=f.x-c.x,p=f.y-c.y),e.fv=no(h,p)}function zx(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SPVFS[]",r,i),a.pv=a.dpv=no(i,r)}function Gx(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SPVFS[]",r,i),a.fv=no(i,r)}function Hx(a){var e=a.stack,r=a.pv;exports.DEBUG&&console.log(a.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Yx(a){var e=a.stack,r=a.fv;exports.DEBUG&&console.log(a.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function qx(a){a.fv=a.pv,exports.DEBUG&&console.log(a.step,"SFVTPV[]")}function Vx(a){var e=a.stack,r=e.pop(),i=e.pop(),o=e.pop(),c=e.pop(),f=e.pop(),h=a.z0,p=a.z1,y=h[r],v=h[i],x=p[o],b=p[c],S=a.z2[f];exports.DEBUG&&console.log("ISECT[], ",r,i,o,c,f);var E=y.x,C=y.y,_=v.x,I=v.y,M=x.x,N=x.y,D=b.x,k=b.y,G=(E-_)*(N-k)-(C-I)*(M-D),P=E*I-C*_,q=M*k-N*D;S.x=(P*(M-D)-q*(E-_))/G,S.y=(P*(N-k)-q*(C-I))/G}function Xx(a){a.rp0=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP0[]",a.rp0)}function $x(a){a.rp1=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP1[]",a.rp1)}function Zx(a){a.rp2=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SRP2[]",a.rp2)}function Qx(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP0[]",e),a.zp0=e,e){case 0:a.tZone||Mc(a),a.z0=a.tZone;break;case 1:a.z0=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function Wx(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP1[]",e),a.zp1=e,e){case 0:a.tZone||Mc(a),a.z1=a.tZone;break;case 1:a.z1=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function Kx(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZP2[]",e),a.zp2=e,e){case 0:a.tZone||Mc(a),a.z2=a.tZone;break;case 1:a.z2=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function Jx(a){var e=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"SZPS[]",e),a.zp0=a.zp1=a.zp2=e,e){case 0:a.tZone||Mc(a),a.z0=a.z1=a.z2=a.tZone;break;case 1:a.z0=a.z1=a.z2=a.gZone;break;default:throw new Error("Invalid zone pointer")}}function eS(a){a.loop=a.stack.pop(),exports.DEBUG&&console.log(a.step,"SLOOP[]",a.loop)}function tS(a){exports.DEBUG&&console.log(a.step,"RTG[]"),a.round=Yg}function nS(a){exports.DEBUG&&console.log(a.step,"RTHG[]"),a.round=Bx}function aS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SMD[]",e),a.minDis=e/64}function rS(a){exports.DEBUG&&console.log(a.step,"ELSE[]"),Vg(a,!1)}function sS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"JMPR[]",e),a.ip+=e-1}function iS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCVTCI[]",e),a.cvCutIn=e/64}function lS(a){var e=a.stack;exports.DEBUG&&console.log(a.step,"DUP[]"),e.push(e[e.length-1])}function Bf(a){exports.DEBUG&&console.log(a.step,"POP[]"),a.stack.pop()}function oS(a){exports.DEBUG&&console.log(a.step,"CLEAR[]"),a.stack.length=0}function cS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SWAP[]"),e.push(r),e.push(i)}function uS(a){var e=a.stack;exports.DEBUG&&console.log(a.step,"DEPTH[]"),e.push(e.length)}function fS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LOOPCALL[]",r,i);var o=a.ip,c=a.prog;a.prog=a.funcs[r];for(var f=0;f<i;f++)li(a),exports.DEBUG&&console.log(++a.step,f+1<i?"next loopcall":"done loopcall",f);a.ip=o,a.prog=c}function dS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"CALL[]",e);var r=a.ip,i=a.prog;a.prog=a.funcs[e],li(a),a.ip=r,a.prog=i,exports.DEBUG&&console.log(++a.step,"returning from",e)}function pS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"CINDEX[]",r),e.push(e[e.length-r])}function hS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function mS(a){if(a.env!=="fpgm")throw new Error("FDEF not allowed here");var e=a.stack,r=a.prog,i=a.ip,o=e.pop(),c=i;for(exports.DEBUG&&console.log(a.step,"FDEF[]",o);r[++i]!==45;);a.ip=i,a.funcs[o]=r.slice(c+1,i)}function Sm(a,e){var r=e.stack.pop(),i=e.z0[r],o=e.fv,c=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+a+"]",r);var f=c.distance(i,Wl);a&&(f=e.round(f)),o.setRelative(i,Wl,f,c),o.touch(i),e.rp0=e.rp1=r}function Em(a,e){var r=e.z2,i=r.length-2,o,c,f;exports.DEBUG&&console.log(e.step,"IUP["+a.axis+"]");for(var h=0;h<i;h++)o=r[h],!a.touched(o)&&(c=o.prevTouched(a),c!==o&&(f=o.nextTouched(a),c===f&&a.setRelative(o,o,a.distance(c,c,!1,!0),a,!0),a.interpolate(o,c,f,a)))}function wm(a,e){for(var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,h=e.loop,p=e.z2;h--;){var y=r.pop(),v=p[y],x=f.distance(o,o,!1,!0);c.setRelative(v,v,x,f),c.touch(v),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-h)+": ":"")+"SHP["+(a?"rp1":"rp2")+"]",y)}e.loop=1}function Am(a,e){var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,h=r.pop(),p=e.z2[e.contours[h]],y=p;exports.DEBUG&&console.log(e.step,"SHC["+a+"]",h);var v=f.distance(o,o,!1,!0);do y!==o&&c.setRelative(y,y,v,f),y=y.nextPointOnContour;while(y!==p)}function Tm(a,e){var r=e.stack,i=a?e.rp1:e.rp2,o=(a?e.z0:e.z1)[i],c=e.fv,f=e.pv,h=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+a+"]",h);var p;switch(h){case 0:p=e.tZone;break;case 1:p=e.gZone;break;default:throw new Error("Invalid zone")}for(var y,v=f.distance(o,o,!1,!0),x=p.length-2,b=0;b<x;b++)y=p[b],c.setRelative(y,y,v,f)}function gS(a){for(var e=a.stack,r=a.loop,i=a.fv,o=e.pop()/64,c=a.z2;r--;){var f=e.pop(),h=c[f];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-r)+": ":"")+"SHPIX[]",f,o),i.setRelative(h,h,o),i.touch(h)}a.loop=1}function yS(a){for(var e=a.stack,r=a.rp1,i=a.rp2,o=a.loop,c=a.z0[r],f=a.z1[i],h=a.fv,p=a.dpv,y=a.z2;o--;){var v=e.pop(),x=y[v];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-o)+": ":"")+"IP[]",v,r,"<->",i),h.interpolate(x,c,f,p),h.touch(x)}a.loop=1}function Cm(a,e){var r=e.stack,i=r.pop()/64,o=r.pop(),c=e.z1[o],f=e.z0[e.rp0],h=e.fv,p=e.pv;h.setRelative(c,f,i,p),h.touch(c),exports.DEBUG&&console.log(e.step,"MSIRP["+a+"]",i,o),e.rp1=e.rp0,e.rp2=o,a&&(e.rp0=o)}function vS(a){for(var e=a.stack,r=a.rp0,i=a.z0[r],o=a.loop,c=a.fv,f=a.pv,h=a.z1;o--;){var p=e.pop(),y=h[p];exports.DEBUG&&console.log(a.step,(a.loop>1?"loop "+(a.loop-o)+": ":"")+"ALIGNRP[]",p),c.setRelative(y,i,0,f),c.touch(y)}a.loop=1}function bS(a){exports.DEBUG&&console.log(a.step,"RTDG[]"),a.round=Ux}function Mm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z0[o],f=e.fv,h=e.pv,p=e.cvt[i];exports.DEBUG&&console.log(e.step,"MIAP["+a+"]",i,"(",p,")",o);var y=h.distance(c,Wl);a&&(Math.abs(y-p)<e.cvCutIn&&(y=p),y=e.round(y)),f.setRelative(c,Wl,y,h),e.zp0===0&&(c.xo=c.x,c.yo=c.y),f.touch(c),e.rp0=e.rp1=o}function xS(a){var e=a.prog,r=a.ip,i=a.stack,o=e[++r];exports.DEBUG&&console.log(a.step,"NPUSHB[]",o);for(var c=0;c<o;c++)i.push(e[++r]);a.ip=r}function SS(a){var e=a.ip,r=a.prog,i=a.stack,o=r[++e];exports.DEBUG&&console.log(a.step,"NPUSHW[]",o);for(var c=0;c<o;c++){var f=r[++e]<<8|r[++e];f&32768&&(f=-((f^65535)+1)),i.push(f)}a.ip=e}function ES(a){var e=a.stack,r=a.store;r||(r=a.store=[]);var i=e.pop(),o=e.pop();exports.DEBUG&&console.log(a.step,"WS",i,o),r[o]=i}function wS(a){var e=a.stack,r=a.store,i=e.pop();exports.DEBUG&&console.log(a.step,"RS",i);var o=r&&r[i]||0;e.push(o)}function AS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"WCVTP",r,i),a.cvt[i]=r/64}function TS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"RCVT",r),e.push(a.cvt[r]*64)}function Nm(a,e){var r=e.stack,i=r.pop(),o=e.z2[i];exports.DEBUG&&console.log(e.step,"GC["+a+"]",i),r.push(e.dpv.distance(o,Wl,a,!1)*64)}function Rm(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z1[i],f=e.z0[o],h=e.dpv.distance(f,c,a,a);exports.DEBUG&&console.log(e.step,"MD["+a+"]",i,o,"->",h),e.stack.push(Math.round(h*64))}function CS(a){exports.DEBUG&&console.log(a.step,"MPPEM[]"),a.stack.push(a.ppem)}function MS(a){exports.DEBUG&&console.log(a.step,"FLIPON[]"),a.autoFlip=!0}function NS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LT[]",r,i),e.push(i<r?1:0)}function RS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"LTEQ[]",r,i),e.push(i<=r?1:0)}function kS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"GT[]",r,i),e.push(i>r?1:0)}function DS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"GTEQ[]",r,i),e.push(i>=r?1:0)}function _S(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"EQ[]",r,i),e.push(r===i?1:0)}function OS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"NEQ[]",r,i),e.push(r!==i?1:0)}function IS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function LS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function US(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"IF[]",e),e||(Vg(a,!0),exports.DEBUG&&console.log(a.step,"EIF[]"))}function BS(a){exports.DEBUG&&console.log(a.step,"EIF[]")}function FS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"AND[]",r,i),e.push(r&&i?1:0)}function jS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"OR[]",r,i),e.push(r||i?1:0)}function PS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"NOT[]",r),e.push(r?0:1)}function Ff(a,e){var r=e.stack,i=r.pop(),o=e.fv,c=e.pv,f=e.ppem,h=e.deltaBase+(a-1)*16,p=e.deltaShift,y=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+a+"]",i,r);for(var v=0;v<i;v++){var x=r.pop(),b=r.pop(),S=h+((b&240)>>4);if(S===f){var E=(b&15)-8;E>=0&&E++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",x,"by",E*p);var C=y[x];o.setRelative(C,C,E*p,c)}}}function zS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"SDB[]",r),a.deltaBase=r}function GS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"SDS[]",r),a.deltaShift=Math.pow(.5,r)}function HS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"ADD[]",r,i),e.push(i+r)}function YS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"SUB[]",r,i),e.push(i-r)}function qS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"DIV[]",r,i),e.push(i*64/r)}function VS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MUL[]",r,i),e.push(i*r/64)}function XS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"ABS[]",r),e.push(Math.abs(r))}function $S(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"NEG[]",r),e.push(-r)}function ZS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function QS(a){var e=a.stack,r=e.pop();exports.DEBUG&&console.log(a.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function hc(a,e){var r=e.stack,i=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(i/64)*64)}function WS(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"WCVTF[]",r,i),a.cvt[i]=r*a.ppem/a.font.unitsPerEm}function jf(a,e){var r=e.stack,i=r.pop(),o=e.ppem,c=e.deltaBase+(a-1)*16,f=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+a+"]",i,r);for(var h=0;h<i;h++){var p=r.pop(),y=r.pop(),v=c+((y&240)>>4);if(v===o){var x=(y&15)-8;x>=0&&x++;var b=x*f;exports.DEBUG&&console.log(e.step,"DELTACFIX",p,"by",b),e.cvt[p]+=b}}}function KS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SROUND[]",e),a.round=qg;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(a.srPeriod=r,e&48){case 0:a.srPhase=0;break;case 16:a.srPhase=.25*r;break;case 32:a.srPhase=.5*r;break;case 48:a.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?a.srThreshold=0:a.srThreshold=(e/8-.5)*r}function JS(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"S45ROUND[]",e),a.round=qg;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(a.srPeriod=r,e&48){case 0:a.srPhase=0;break;case 16:a.srPhase=.25*r;break;case 32:a.srPhase=.5*r;break;case 48:a.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?a.srThreshold=0:a.srThreshold=(e/8-.5)*r}function e2(a){exports.DEBUG&&console.log(a.step,"ROFF[]"),a.round=Lx}function t2(a){exports.DEBUG&&console.log(a.step,"RUTG[]"),a.round=Fx}function n2(a){exports.DEBUG&&console.log(a.step,"RDTG[]"),a.round=jx}function a2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCANCTRL[]",e)}function km(a,e){var r=e.stack,i=r.pop(),o=r.pop(),c=e.z2[i],f=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+a+"]",i,o);var h,p;a?(h=c.y-f.y,p=f.x-c.x):(h=f.x-c.x,p=f.y-c.y),e.dpv=no(h,p)}function r2(a){var e=a.stack,r=e.pop(),i=0;exports.DEBUG&&console.log(a.step,"GETINFO[]",r),r&1&&(i=35),r&32&&(i|=4096),e.push(i)}function s2(a){var e=a.stack,r=e.pop(),i=e.pop(),o=e.pop();exports.DEBUG&&console.log(a.step,"ROLL[]"),e.push(i),e.push(r),e.push(o)}function i2(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MAX[]",r,i),e.push(Math.max(i,r))}function l2(a){var e=a.stack,r=e.pop(),i=e.pop();exports.DEBUG&&console.log(a.step,"MIN[]",r,i),e.push(Math.min(i,r))}function o2(a){var e=a.stack.pop();exports.DEBUG&&console.log(a.step,"SCANTYPE[]",e)}function c2(a){var e=a.stack.pop(),r=a.stack.pop();switch(exports.DEBUG&&console.log(a.step,"INSTCTRL[]",e,r),e){case 1:a.inhibitGridFit=!!r;return;case 2:a.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Ns(a,e){var r=e.stack,i=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+a+"]");for(var c=0;c<a;c++)r.push(i[++o]);e.ip=o}function Rs(a,e){var r=e.ip,i=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+a+"]");for(var c=0;c<a;c++){var f=i[++r]<<8|i[++r];f&32768&&(f=-((f^65535)+1)),o.push(f)}e.ip=r}function Qe(a,e,r,i,o,c){var f=c.stack,h=a&&f.pop(),p=f.pop(),y=c.rp0,v=c.z0[y],x=c.z1[p],b=c.minDis,S=c.fv,E=c.dpv,C,_,I,M;_=C=E.distance(x,v,!0,!0),I=_>=0?1:-1,_=Math.abs(_),a&&(M=c.cvt[h],i&&Math.abs(_-M)<c.cvCutIn&&(_=M)),r&&_<b&&(_=b),i&&(_=c.round(_)),S.setRelative(x,v,I*_,E),S.touch(x),exports.DEBUG&&console.log(c.step,(a?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(i?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",a?h+"("+c.cvt[h]+","+M+")":"",p,"(d =",C,"->",I*_,")"),c.rp1=c.rp0,c.rp2=p,e&&(c.rp0=p)}zg=[gm.bind(void 0,Wr),gm.bind(void 0,Nr),ym.bind(void 0,Wr),ym.bind(void 0,Nr),vm.bind(void 0,Wr),vm.bind(void 0,Nr),bm.bind(void 0,0),bm.bind(void 0,1),xm.bind(void 0,0),xm.bind(void 0,1),zx,Gx,Hx,Yx,qx,Vx,Xx,$x,Zx,Qx,Wx,Kx,Jx,eS,tS,nS,aS,rS,sS,iS,void 0,void 0,lS,Bf,oS,cS,uS,pS,hS,void 0,void 0,void 0,fS,dS,mS,void 0,Sm.bind(void 0,0),Sm.bind(void 0,1),Em.bind(void 0,Wr),Em.bind(void 0,Nr),wm.bind(void 0,0),wm.bind(void 0,1),Am.bind(void 0,0),Am.bind(void 0,1),Tm.bind(void 0,0),Tm.bind(void 0,1),gS,yS,Cm.bind(void 0,0),Cm.bind(void 0,1),vS,bS,Mm.bind(void 0,0),Mm.bind(void 0,1),xS,SS,ES,wS,AS,TS,Nm.bind(void 0,0),Nm.bind(void 0,1),void 0,Rm.bind(void 0,0),Rm.bind(void 0,1),CS,void 0,MS,void 0,void 0,NS,RS,kS,DS,_S,OS,IS,LS,US,BS,FS,jS,PS,Ff.bind(void 0,1),zS,GS,HS,YS,qS,VS,XS,$S,ZS,QS,hc.bind(void 0,0),hc.bind(void 0,1),hc.bind(void 0,2),hc.bind(void 0,3),void 0,void 0,void 0,void 0,WS,Ff.bind(void 0,2),Ff.bind(void 0,3),jf.bind(void 0,1),jf.bind(void 0,2),jf.bind(void 0,3),KS,JS,void 0,void 0,e2,void 0,t2,n2,Bf,Bf,void 0,void 0,void 0,void 0,void 0,a2,km.bind(void 0,0),km.bind(void 0,1),r2,void 0,s2,i2,l2,o2,c2,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ns.bind(void 0,1),Ns.bind(void 0,2),Ns.bind(void 0,3),Ns.bind(void 0,4),Ns.bind(void 0,5),Ns.bind(void 0,6),Ns.bind(void 0,7),Ns.bind(void 0,8),Rs.bind(void 0,1),Rs.bind(void 0,2),Rs.bind(void 0,3),Rs.bind(void 0,4),Rs.bind(void 0,5),Rs.bind(void 0,6),Rs.bind(void 0,7),Rs.bind(void 0,8),Qe.bind(void 0,0,0,0,0,0),Qe.bind(void 0,0,0,0,0,1),Qe.bind(void 0,0,0,0,0,2),Qe.bind(void 0,0,0,0,0,3),Qe.bind(void 0,0,0,0,1,0),Qe.bind(void 0,0,0,0,1,1),Qe.bind(void 0,0,0,0,1,2),Qe.bind(void 0,0,0,0,1,3),Qe.bind(void 0,0,0,1,0,0),Qe.bind(void 0,0,0,1,0,1),Qe.bind(void 0,0,0,1,0,2),Qe.bind(void 0,0,0,1,0,3),Qe.bind(void 0,0,0,1,1,0),Qe.bind(void 0,0,0,1,1,1),Qe.bind(void 0,0,0,1,1,2),Qe.bind(void 0,0,0,1,1,3),Qe.bind(void 0,0,1,0,0,0),Qe.bind(void 0,0,1,0,0,1),Qe.bind(void 0,0,1,0,0,2),Qe.bind(void 0,0,1,0,0,3),Qe.bind(void 0,0,1,0,1,0),Qe.bind(void 0,0,1,0,1,1),Qe.bind(void 0,0,1,0,1,2),Qe.bind(void 0,0,1,0,1,3),Qe.bind(void 0,0,1,1,0,0),Qe.bind(void 0,0,1,1,0,1),Qe.bind(void 0,0,1,1,0,2),Qe.bind(void 0,0,1,1,0,3),Qe.bind(void 0,0,1,1,1,0),Qe.bind(void 0,0,1,1,1,1),Qe.bind(void 0,0,1,1,1,2),Qe.bind(void 0,0,1,1,1,3),Qe.bind(void 0,1,0,0,0,0),Qe.bind(void 0,1,0,0,0,1),Qe.bind(void 0,1,0,0,0,2),Qe.bind(void 0,1,0,0,0,3),Qe.bind(void 0,1,0,0,1,0),Qe.bind(void 0,1,0,0,1,1),Qe.bind(void 0,1,0,0,1,2),Qe.bind(void 0,1,0,0,1,3),Qe.bind(void 0,1,0,1,0,0),Qe.bind(void 0,1,0,1,0,1),Qe.bind(void 0,1,0,1,0,2),Qe.bind(void 0,1,0,1,0,3),Qe.bind(void 0,1,0,1,1,0),Qe.bind(void 0,1,0,1,1,1),Qe.bind(void 0,1,0,1,1,2),Qe.bind(void 0,1,0,1,1,3),Qe.bind(void 0,1,1,0,0,0),Qe.bind(void 0,1,1,0,0,1),Qe.bind(void 0,1,1,0,0,2),Qe.bind(void 0,1,1,0,0,3),Qe.bind(void 0,1,1,0,1,0),Qe.bind(void 0,1,1,0,1,1),Qe.bind(void 0,1,1,0,1,2),Qe.bind(void 0,1,1,0,1,3),Qe.bind(void 0,1,1,1,0,0),Qe.bind(void 0,1,1,1,0,1),Qe.bind(void 0,1,1,1,0,2),Qe.bind(void 0,1,1,1,0,3),Qe.bind(void 0,1,1,1,1,0),Qe.bind(void 0,1,1,1,1,1),Qe.bind(void 0,1,1,1,1,2),Qe.bind(void 0,1,1,1,1,3)];function Xi(a){this.char=a,this.state={},this.activeState=null}function gd(a,e,r){this.contextName=r,this.startIndex=a,this.endOffset=e}function u2(a,e,r){this.contextName=a,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function dr(a,e){this.context=a,this.index=e,this.length=a.length,this.current=a[e],this.backtrack=a.slice(0,e),this.lookahead=a.slice(e+1)}function Nc(a){this.eventId=a,this.subscribers=[]}function f2(a){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Nc(o)})}),a&&r.forEach(function(o){var c=a[o];typeof c=="function"&&e.events[o].subscribe(c)});var i=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];i.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function vn(a){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],f2.call(this,a)}Xi.prototype.setState=function(a,e){return this.state[a]=e,this.activeState={key:a,value:this.state[a]},this.activeState};Xi.prototype.getState=function(a){return this.state[a]||null};vn.prototype.inboundIndex=function(a){return a>=0&&a<this.tokens.length};vn.prototype.composeRUD=function(a){var e=this,r=!0,i=a.map(function(c){return e[c[0]].apply(e,c.slice(1).concat(r))}),o=function(c){return typeof c=="object"&&c.hasOwnProperty("FAIL")};if(i.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(o)};this.dispatch("composeRUD",[i.filter(function(c){return!o(c)})])};vn.prototype.replaceRange=function(a,e,r,i){e=e!==null?e:this.tokens.length;var o=r.every(function(f){return f instanceof Xi});if(!isNaN(a)&&this.inboundIndex(a)&&o){var c=this.tokens.splice.apply(this.tokens,[a,e].concat(r));return i||this.dispatch("replaceToken",[a,e,r]),[c,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};vn.prototype.replaceToken=function(a,e,r){if(!isNaN(a)&&this.inboundIndex(a)&&e instanceof Xi){var i=this.tokens.splice(a,1,e);return r||this.dispatch("replaceToken",[a,e]),[i[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};vn.prototype.removeRange=function(a,e,r){e=isNaN(e)?this.tokens.length:e;var i=this.tokens.splice(a,e);return r||this.dispatch("removeRange",[i,a,e]),i};vn.prototype.removeToken=function(a,e){if(!isNaN(a)&&this.inboundIndex(a)){var r=this.tokens.splice(a,1);return e||this.dispatch("removeToken",[r,a]),r}else return{FAIL:"removeToken: invalid token index."}};vn.prototype.insertToken=function(a,e,r){var i=a.every(function(o){return o instanceof Xi});return i?(this.tokens.splice.apply(this.tokens,[e,0].concat(a)),r||this.dispatch("insertToken",[a,e]),a):{FAIL:"insertToken: invalid token(s)."}};vn.prototype.registerModifier=function(a,e,r){this.events.newToken.subscribe(function(i,o){var c=[i,o],f=e===null||e.apply(this,c)===!0,h=[i,o];if(f){var p=r.apply(this,h);i.setState(a,p)}}),this.registeredModifiers.push(a)};Nc.prototype.subscribe=function(a){return typeof a=="function"?this.subscribers.push(a)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Nc.prototype.unsubscribe=function(a){this.subscribers.splice(a,1)};dr.prototype.setCurrentIndex=function(a){this.index=a,this.current=this.context[a],this.backtrack=this.context.slice(0,a),this.lookahead=this.context.slice(a+1)};dr.prototype.get=function(a){switch(!0){case a===0:return this.current;case(a<0&&Math.abs(a)<=this.backtrack.length):return this.backtrack.slice(a)[0];case(a>0&&a<=this.lookahead.length):return this.lookahead[a-1];default:return null}};vn.prototype.rangeToText=function(a){if(a instanceof gd)return this.getRangeTokens(a).map(function(e){return e.char}).join("")};vn.prototype.getText=function(){return this.tokens.map(function(a){return a.char}).join("")};vn.prototype.getContext=function(a){var e=this.registeredContexts[a];return e||null};vn.prototype.on=function(a,e){var r=this.events[a];return r?r.subscribe(e):null};vn.prototype.dispatch=function(a,e){var r=this,i=this.events[a];i instanceof Nc&&i.subscribers.forEach(function(o){o.apply(r,e||[])})};vn.prototype.registerContextChecker=function(a,e,r){if(this.getContext(a))return{FAIL:"context name '"+a+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var i=new u2(a,e,r);return this.registeredContexts[a]=i,this.contextCheckers.push(i),i};vn.prototype.getRangeTokens=function(a){var e=a.startIndex+a.endOffset;return[].concat(this.tokens.slice(a.startIndex,e))};vn.prototype.getContextRanges=function(a){var e=this.getContext(a);return e?e.ranges:{FAIL:"context checker '"+a+"' is not registered."}};vn.prototype.resetContextsRanges=function(){var a=this.registeredContexts;for(var e in a)if(a.hasOwnProperty(e)){var r=a[e];r.ranges=[]}};vn.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var a=this.tokens.map(function(i){return i.char}),e=0;e<a.length;e++){var r=new dr(a,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};vn.prototype.setEndOffset=function(a,e){var r=this.getContext(e).openRange.startIndex,i=new gd(r,a,e),o=this.getContext(e).ranges;return i.rangeId=e+"."+o.length,o.push(i),this.getContext(e).openRange=null,i};vn.prototype.runContextCheck=function(a){var e=this,r=a.index;this.contextCheckers.forEach(function(i){var o=i.contextName,c=e.getContext(o).openRange;if(!c&&i.checkStart(a)&&(c=new gd(r,null,o),e.getContext(o).openRange=c,e.dispatch("contextStart",[o,r])),c&&i.checkEnd(a)){var f=r-c.startIndex+1,h=e.setEndOffset(f,o);e.dispatch("contextEnd",[o,h])}})};vn.prototype.tokenize=function(a){this.tokens=[],this.resetContextsRanges();var e=Array.from(a);this.dispatch("start");for(var r=0;r<e.length;r++){var i=e[r],o=new dr(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var c=new Xi(i);this.tokens.push(c),this.dispatch("newToken",[c,o])}return this.dispatch("end",[this.tokens]),this.tokens};function _s(a){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(a)}function Xg(a){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(a)}function Os(a){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(a)}function vc(a){return/[A-z]/.test(a)}function d2(a){return/\s/.test(a)}function za(a){this.font=a,this.features={}}function ii(a){this.id=a.id,this.tag=a.tag,this.substitution=a.substitution}function ao(a,e){if(!a)return-1;switch(e.format){case 1:return e.glyphs.indexOf(a);case 2:for(var r=e.ranges,i=0;i<r.length;i++){var o=r[i];if(a>=o.start&&a<=o.end){var c=a-o.start;return o.index+c}}break;default:return-1}return-1}function p2(a,e){var r=ao(a,e.coverage);return r===-1?null:a+e.deltaGlyphId}function h2(a,e){var r=ao(a,e.coverage);return r===-1?null:e.substitute[r]}function Pf(a,e){for(var r=[],i=0;i<a.length;i++){var o=a[i],c=e.current;c=Array.isArray(c)?c[0]:c;var f=ao(c,o);f!==-1&&r.push(f)}return r.length!==a.length?-1:r}function m2(a,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(a.context.length<r)return[];var i=Pf(e.inputCoverage,a);if(i===-1)return[];var o=e.inputCoverage.length-1;if(a.lookahead.length<e.lookaheadCoverage.length)return[];for(var c=a.lookahead.slice(o);c.length&&Os(c[0].char);)c.shift();var f=new dr(c,0),h=Pf(e.lookaheadCoverage,f),p=[].concat(a.backtrack);for(p.reverse();p.length&&Os(p[0].char);)p.shift();if(p.length<e.backtrackCoverage.length)return[];var y=new dr(p,0),v=Pf(e.backtrackCoverage,y),x=i.length===e.inputCoverage.length&&h.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,b=[];if(x)for(var S=0;S<e.lookupRecords.length;S++)for(var E=e.lookupRecords[S],C=E.lookupListIndex,_=this.getLookupByIndex(C),I=0;I<_.subtables.length;I++){var M=_.subtables[I],N=this.getLookupMethod(_,M),D=this.getSubstitutionType(_,M);if(D==="12")for(var k=0;k<i.length;k++){var G=a.get(k),P=N(G);P&&b.push(P)}}return b}function g2(a,e){var r=a.current,i=ao(r,e.coverage);if(i===-1)return null;for(var o,c=e.ligatureSets[i],f=0;f<c.length;f++){o=c[f];for(var h=0;h<o.components.length;h++){var p=a.lookahead[h],y=o.components[h];if(p!==y)break;if(h===o.components.length-1)return o}}return null}function y2(a,e){var r=ao(a,e.coverage);return r===-1?null:e.sequences[r]}za.prototype.getDefaultScriptFeaturesIndexes=function(){for(var a=this.font.tables.gsub.scripts,e=0;e<a.length;e++){var r=a[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};za.prototype.getScriptFeaturesIndexes=function(a){var e=this.font.tables;if(!e.gsub)return[];if(!a)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,i=0;i<r.length;i++){var o=r[i];if(o.tag===a&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var c=o.langSysRecords;if(c)for(var f=0;f<c.length;f++){var h=c[f];if(h.tag===a){var p=h.langSys;return p.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};za.prototype.mapTagsToFeatures=function(a,e){for(var r={},i=0;i<a.length;i++){var o=a[i].tag,c=a[i].feature;r[o]=c}this.features[e].tags=r};za.prototype.getScriptFeatures=function(a){var e=this.features[a];if(this.features.hasOwnProperty(a))return e;var r=this.getScriptFeaturesIndexes(a);if(!r)return null;var i=this.font.tables.gsub;return e=r.map(function(o){return i.features[o]}),this.features[a]=e,this.mapTagsToFeatures(e,a),e};za.prototype.getSubstitutionType=function(a,e){var r=a.lookupType.toString(),i=e.substFormat.toString();return r+i};za.prototype.getLookupMethod=function(a,e){var r=this,i=this.getSubstitutionType(a,e);switch(i){case"11":return function(o){return p2.apply(r,[o,e])};case"12":return function(o){return h2.apply(r,[o,e])};case"63":return function(o){return m2.apply(r,[o,e])};case"41":return function(o){return g2.apply(r,[o,e])};case"21":return function(o){return y2.apply(r,[o,e])};default:throw new Error("lookupType: "+a.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};za.prototype.lookupFeature=function(a){var e=a.contextParams,r=e.index,i=this.getFeature({tag:a.tag,script:a.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+a.tag+"' for script '"+a.script+"'.");for(var o=this.getFeatureLookups(i),c=[].concat(e.context),f=0;f<o.length;f++)for(var h=o[f],p=this.getLookupSubtables(h),y=0;y<p.length;y++){var v=p[y],x=this.getSubstitutionType(h,v),b=this.getLookupMethod(h,v),S=void 0;switch(x){case"11":S=b(e.current),S&&c.splice(r,1,new ii({id:11,tag:a.tag,substitution:S}));break;case"12":S=b(e.current),S&&c.splice(r,1,new ii({id:12,tag:a.tag,substitution:S}));break;case"63":S=b(e),Array.isArray(S)&&S.length&&c.splice(r,1,new ii({id:63,tag:a.tag,substitution:S}));break;case"41":S=b(e),S&&c.splice(r,1,new ii({id:41,tag:a.tag,substitution:S}));break;case"21":S=b(e.current),S&&c.splice(r,1,new ii({id:21,tag:a.tag,substitution:S}));break}e=new dr(c,r),!(Array.isArray(S)&&!S.length)&&(S=null)}return c.length?c:null};za.prototype.supports=function(a){if(!a.script)return!1;this.getScriptFeatures(a.script);var e=this.features.hasOwnProperty(a.script);if(!a.tag)return e;var r=this.features[a.script].some(function(i){return i.tag===a.tag});return e&&r};za.prototype.getLookupSubtables=function(a){return a.subtables||null};za.prototype.getLookupByIndex=function(a){var e=this.font.tables.gsub.lookups;return e[a]||null};za.prototype.getFeatureLookups=function(a){return a.lookupListIndexes.map(this.getLookupByIndex.bind(this))};za.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function v2(a){var e=a.current,r=a.get(-1);return r===null&&_s(e)||!_s(r)&&_s(e)}function b2(a){var e=a.get(1);return e===null||!_s(e)}var x2={startCheck:v2,endCheck:b2};function S2(a){var e=a.current,r=a.get(-1);return(_s(e)||Os(e))&&!_s(r)}function E2(a){var e=a.get(1);switch(!0){case e===null:return!0;case(!_s(e)&&!Os(e)):var r=d2(e);if(!r)return!0;if(r){var i=!1;if(i=a.lookahead.some(function(o){return _s(o)||Os(o)}),!i)return!0}break;default:return!1}}var w2={startCheck:S2,endCheck:E2};function A2(a,e,r){e[r].setState(a.tag,a.substitution)}function T2(a,e,r){e[r].setState(a.tag,a.substitution)}function C2(a,e,r){a.substitution.forEach(function(i,o){var c=e[r+o];c.setState(a.tag,i)})}function M2(a,e,r){var i=e[r];i.setState(a.tag,a.substitution.ligGlyph);for(var o=a.substitution.components.length,c=0;c<o;c++)i=e[r+c+1],i.setState("deleted",!0)}var Dm={11:A2,12:T2,63:C2,41:M2};function yd(a,e,r){a instanceof ii&&Dm[a.id]&&Dm[a.id](a,e,r)}function N2(a){for(var e=[].concat(a.backtrack),r=e.length-1;r>=0;r--){var i=e[r],o=Xg(i),c=Os(i);if(!o&&!c)return!0;if(o)return!1}return!1}function R2(a){if(Xg(a.current))return!1;for(var e=0;e<a.lookahead.length;e++){var r=a.lookahead[e],i=Os(r);if(!i)return!0}return!1}function k2(a){var e=this,r="arab",i=this.featuresTags[r],o=this.tokenizer.getRangeTokens(a);if(o.length!==1){var c=new dr(o.map(function(h){return h.getState("glyphIndex")}),0),f=new dr(o.map(function(h){return h.char}),0);o.forEach(function(h,p){if(!Os(h.char)){c.setCurrentIndex(p),f.setCurrentIndex(p);var y=0;N2(f)&&(y|=1),R2(f)&&(y|=2);var v;switch(y){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(i.indexOf(v)!==-1){var x=e.query.lookupFeature({tag:v,script:r,contextParams:c});if(x instanceof Error)return console.info(x.message);x.forEach(function(b,S){b instanceof ii&&(yd(b,o,S),c.context[S]=b.substitution)})}}})}}function _m(a,e){var r=a.map(function(i){return i.activeState.value});return new dr(r,0)}function D2(a){var e=this,r="arab",i=this.tokenizer.getRangeTokens(a),o=_m(i);o.context.forEach(function(c,f){o.setCurrentIndex(f);var h=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});h.length&&(h.forEach(function(p){return yd(p,i,f)}),o=_m(i))})}function _2(a){var e=a.current,r=a.get(-1);return r===null&&vc(e)||!vc(r)&&vc(e)}function O2(a){var e=a.get(1);return e===null||!vc(e)}var I2={startCheck:_2,endCheck:O2};function Om(a,e){var r=a.map(function(i){return i.activeState.value});return new dr(r,0)}function L2(a){var e=this,r="latn",i=this.tokenizer.getRangeTokens(a),o=Om(i);o.context.forEach(function(c,f){o.setCurrentIndex(f);var h=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});h.length&&(h.forEach(function(p){return yd(p,i,f)}),o=Om(i))})}function mr(a){this.baseDir=a||"ltr",this.tokenizer=new vn,this.featuresTags={}}mr.prototype.setText=function(a){this.text=a};mr.prototype.contextChecks={latinWordCheck:I2,arabicWordCheck:x2,arabicSentenceCheck:w2};function zf(a){var e=this.contextChecks[a+"Check"];return this.tokenizer.registerContextChecker(a,e.startCheck,e.endCheck)}function U2(){return zf.call(this,"latinWord"),zf.call(this,"arabicWord"),zf.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function B2(){var a=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var i=a.tokenizer.getRangeTokens(r);a.tokenizer.replaceRange(r.startIndex,r.endOffset,i.reverse())})}mr.prototype.registerFeatures=function(a,e){var r=this,i=e.filter(function(o){return r.query.supports({script:a,tag:o})});this.featuresTags.hasOwnProperty(a)?this.featuresTags[a]=this.featuresTags[a].concat(i):this.featuresTags[a]=i};mr.prototype.applyFeatures=function(a,e){if(!a)throw new Error("No valid font was provided to apply features");this.query||(this.query=new za(a));for(var r=0;r<e.length;r++){var i=e[r];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}};mr.prototype.registerModifier=function(a,e,r){this.tokenizer.registerModifier(a,e,r)};function vd(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function F2(){var a=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){vd.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(i){k2.call(a,i)})}}function j2(){var a=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){vd.call(this);var i=this.tokenizer.getContextRanges("arabicWord");i.forEach(function(o){D2.call(a,o)})}}}function P2(){var a=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){vd.call(this);var i=this.tokenizer.getContextRanges("latinWord");i.forEach(function(o){L2.call(a,o)})}}}mr.prototype.checkContextReady=function(a){return!!this.tokenizer.getContext(a)};mr.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(F2.call(this),j2.call(this)),this.checkContextReady("latinWord")&&P2.call(this),this.checkContextReady("arabicSentence")&&B2.call(this)};mr.prototype.processText=function(a){(!this.text||this.text!==a)&&(this.setText(a),U2.call(this),this.applyFeaturesToContexts())};mr.prototype.getBidiText=function(a){return this.processText(a),this.tokenizer.getText()};mr.prototype.getTextGlyphs=function(a){this.processText(a);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var i=this.tokenizer.tokens[r];if(!i.state.deleted){var o=i.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Yt(a){a=a||{},a.tables=a.tables||{},a.empty||(Gl(a.familyName,"When creating a new Font object, familyName is required."),Gl(a.styleName,"When creating a new Font object, styleName is required."),Gl(a.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Gl(a.ascender,"When creating a new Font object, ascender is required."),Gl(a.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:a.familyName||" "},fontSubfamily:{en:a.styleName||" "},fullName:{en:a.fullName||a.familyName+" "+a.styleName},postScriptName:{en:a.postScriptName||(a.familyName+a.styleName).replace(/\s/g,"")},designer:{en:a.designer||" "},designerURL:{en:a.designerURL||" "},manufacturer:{en:a.manufacturer||" "},manufacturerURL:{en:a.manufacturerURL||" "},license:{en:a.license||" "},licenseURL:{en:a.licenseURL||" "},version:{en:a.version||"Version 0.1"},description:{en:a.description||" "},copyright:{en:a.copyright||" "},trademark:{en:a.trademark||" "}},this.unitsPerEm=a.unitsPerEm||1e3,this.ascender=a.ascender,this.descender=a.descender,this.createdTimestamp=a.createdTimestamp,this.tables=Object.assign(a.tables,{os2:Object.assign({usWeightClass:a.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:a.widthClass||this.usWidthClasses.MEDIUM,fsSelection:a.fsSelection||this.fsSelectionValues.REGULAR},a.tables.os2)})),this.supported=!0,this.glyphs=new Rr.GlyphSet(this,a.glyphs||[]),this.encoding=new fg(this),this.position=new eo(this),this.substitution=new Pa(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hg(this)}})}Yt.prototype.hasChar=function(a){return this.encoding.charToGlyphIndex(a)!==null};Yt.prototype.charToGlyphIndex=function(a){return this.encoding.charToGlyphIndex(a)};Yt.prototype.charToGlyph=function(a){var e=this.charToGlyphIndex(a),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Yt.prototype.updateFeatures=function(a){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return a[r]})}:e})};Yt.prototype.stringToGlyphs=function(a,e){var r=this,i=new mr,o=function(x){return r.charToGlyphIndex(x.char)};i.registerModifier("glyphIndex",null,o);var c=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;i.applyFeatures(this,c);for(var f=i.getTextGlyphs(a),h=f.length,p=new Array(h),y=this.glyphs.get(0),v=0;v<h;v+=1)p[v]=this.glyphs.get(f[v])||y;return p};Yt.prototype.nameToGlyphIndex=function(a){return this.glyphNames.nameToGlyphIndex(a)};Yt.prototype.nameToGlyph=function(a){var e=this.nameToGlyphIndex(a),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Yt.prototype.glyphIndexToName=function(a){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(a):""};Yt.prototype.getKerningValue=function(a,e){a=a.index||a,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,a,e):this.kerningPairs[a+","+e]||0};Yt.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Yt.prototype.forEachGlyph=function(a,e,r,i,o,c){e=e!==void 0?e:0,r=r!==void 0?r:0,i=i!==void 0?i:72,o=Object.assign({},this.defaultRenderOptions,o);var f=1/this.unitsPerEm*i,h=this.stringToGlyphs(a,o),p;if(o.kerning){var y=o.script||this.position.getDefaultScriptName();p=this.position.getKerningTables(y,o.language)}for(var v=0;v<h.length;v+=1){var x=h[v];if(c.call(this,x,e,r,i,o),x.advanceWidth&&(e+=x.advanceWidth*f),o.kerning&&v<h.length-1){var b=p?this.position.getKerningValue(p,x.index,h[v+1].index):this.getKerningValue(x,h[v+1]);e+=b*f}o.letterSpacing?e+=o.letterSpacing*i:o.tracking&&(e+=o.tracking/1e3*i)}return e};Yt.prototype.getPath=function(a,e,r,i,o){var c=new Dn;return this.forEachGlyph(a,e,r,i,o,function(f,h,p,y){var v=f.getPath(h,p,y,o,this);c.extend(v)}),c};Yt.prototype.getPaths=function(a,e,r,i,o){var c=[];return this.forEachGlyph(a,e,r,i,o,function(f,h,p,y){var v=f.getPath(h,p,y,o,this);c.push(v)}),c};Yt.prototype.getAdvanceWidth=function(a,e,r){return this.forEachGlyph(a,0,0,e,r,function(){})};Yt.prototype.draw=function(a,e,r,i,o,c){this.getPath(e,r,i,o,c).draw(a)};Yt.prototype.drawPoints=function(a,e,r,i,o,c){this.forEachGlyph(e,r,i,o,c,function(f,h,p,y){f.drawPoints(a,h,p,y)})};Yt.prototype.drawMetrics=function(a,e,r,i,o,c){this.forEachGlyph(e,r,i,o,c,function(f,h,p,y){f.drawMetrics(a,h,p,y)})};Yt.prototype.getEnglishName=function(a){var e=this.names[a];if(e)return e.en};Yt.prototype.validate=function(){var a=this;function e(i,o){}function r(i){var o=a.getEnglishName(i);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Yt.prototype.toTables=function(){return Mx.fontToTable(this)};Yt.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Yt.prototype.toArrayBuffer=function(){for(var a=this.toTables(),e=a.encode(),r=new ArrayBuffer(e.length),i=new Uint8Array(r),o=0;o<e.length;o++)i[o]=e[o];return r};Yt.prototype.download=function(a){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");a=a||e.replace(/\s/g,"")+"-"+r+".otf";var i=this.toArrayBuffer();if(Rx())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(i),c=new Blob([o],{type:"font/opentype"}),f=document.createElement("a");f.href=window.URL.createObjectURL(c),f.download=a;var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!1),f.dispatchEvent(h)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var p=require("fs"),y=kx(i);p.writeFileSync(a,y)}};Yt.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Yt.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Yt.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function $g(a,e){var r=JSON.stringify(a),i=256;for(var o in e){var c=parseInt(o);if(!(!c||c<256)){if(JSON.stringify(e[o])===r)return c;i<=c&&(i=c+1)}}return e[i]=a,i}function z2(a,e,r){var i=$g(e.name,r);return[{name:"tag_"+a,type:"TAG",value:e.tag},{name:"minValue_"+a,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+a,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+a,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+a,type:"USHORT",value:0},{name:"nameID_"+a,type:"USHORT",value:i}]}function G2(a,e,r){var i={},o=new We.Parser(a,e);return i.tag=o.parseTag(),i.minValue=o.parseFixed(),i.defaultValue=o.parseFixed(),i.maxValue=o.parseFixed(),o.skip("uShort",1),i.name=r[o.parseUShort()]||{},i}function H2(a,e,r,i){for(var o=$g(e.name,i),c=[{name:"nameID_"+a,type:"USHORT",value:o},{name:"flags_"+a,type:"USHORT",value:0}],f=0;f<r.length;++f){var h=r[f].tag;c.push({name:"axis_"+a+" "+h,type:"FIXED",value:e.coordinates[h]<<16})}return c}function Y2(a,e,r,i){var o={},c=new We.Parser(a,e);o.name=i[c.parseUShort()]||{},c.skip("uShort",1),o.coordinates={};for(var f=0;f<r.length;++f)o.coordinates[r[f].tag]=c.parseFixed();return o}function q2(a,e){var r=new Ve.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:a.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:a.instances.length},{name:"instanceSize",type:"USHORT",value:4+a.axes.length*4}]);r.offsetToData=r.sizeOf();for(var i=0;i<a.axes.length;i++)r.fields=r.fields.concat(z2(i,a.axes[i],e));for(var o=0;o<a.instances.length;o++)r.fields=r.fields.concat(H2(o,a.instances[o],a.axes,e));return r}function V2(a,e,r){var i=new We.Parser(a,e),o=i.parseULong();ut.argument(o===65536,"Unsupported fvar table version.");var c=i.parseOffset16();i.skip("uShort",1);for(var f=i.parseUShort(),h=i.parseUShort(),p=i.parseUShort(),y=i.parseUShort(),v=[],x=0;x<f;x++)v.push(G2(a,e+c+x*h,r));for(var b=[],S=e+c+f*h,E=0;E<p;E++)b.push(Y2(a,S+E*y,v,r));return{axes:v,instances:b}}var X2={make:q2,parse:V2},$2=function(){return{coverage:this.parsePointer(he.coverage),attachPoints:this.parseList(he.pointer(he.uShortList))}},Z2=function(){var a=this.parseUShort();if(ut.argument(a===1||a===2||a===3,"Unsupported CaretValue table version."),a===1)return{coordinate:this.parseShort()};if(a===2)return{pointindex:this.parseShort()};if(a===3)return{coordinate:this.parseShort()}},Q2=function(){return this.parseList(he.pointer(Z2))},W2=function(){return{coverage:this.parsePointer(he.coverage),ligGlyphs:this.parseList(he.pointer(Q2))}},K2=function(){return this.parseUShort(),this.parseList(he.pointer(he.coverage))};function J2(a,e){e=e||0;var r=new he(a,e),i=r.parseVersion(1);ut.argument(i===1||i===1.2||i===1.3,"Unsupported GDEF table version.");var o={version:i,classDef:r.parsePointer(he.classDef),attachList:r.parsePointer($2),ligCaretList:r.parsePointer(W2),markAttachClassDef:r.parsePointer(he.classDef)};return i>=1.2&&(o.markGlyphSets=r.parsePointer(K2)),o}var eE={parse:J2},pr=new Array(10);pr[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(he.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(he.coverage),values:this.parseValueRecordList()};ut.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};pr[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();ut.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(he.coverage),o=this.parseUShort(),c=this.parseUShort();if(r===1)return{posFormat:r,coverage:i,valueFormat1:o,valueFormat2:c,pairSets:this.parseList(he.pointer(he.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(c)}})))};if(r===2){var f=this.parsePointer(he.classDef),h=this.parsePointer(he.classDef),p=this.parseUShort(),y=this.parseUShort();return{posFormat:r,coverage:i,valueFormat1:o,valueFormat2:c,classDef1:f,classDef2:h,class1Count:p,class2Count:y,classRecords:this.parseList(p,he.list(y,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(c)}}))}}};pr[3]=function(){return{error:"GPOS Lookup 3 not supported"}};pr[4]=function(){return{error:"GPOS Lookup 4 not supported"}};pr[5]=function(){return{error:"GPOS Lookup 5 not supported"}};pr[6]=function(){return{error:"GPOS Lookup 6 not supported"}};pr[7]=function(){return{error:"GPOS Lookup 7 not supported"}};pr[8]=function(){return{error:"GPOS Lookup 8 not supported"}};pr[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function tE(a,e){e=e||0;var r=new he(a,e),i=r.parseVersion(1);return ut.argument(i===1||i===1.1,"Unsupported GPOS table version "+i),i===1?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(pr)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(pr),variations:r.parseFeatureVariationsList()}}var nE=new Array(10);function aE(a){return new Ve.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Ve.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Ve.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Ve.LookupList(a.lookups,nE)}])}var rE={parse:tE,make:aE};function sE(a){var e={};a.skip("uShort");var r=a.parseUShort();ut.argument(r===0,"Unsupported kern sub-table version."),a.skip("uShort",2);var i=a.parseUShort();a.skip("uShort",3);for(var o=0;o<i;o+=1){var c=a.parseUShort(),f=a.parseUShort(),h=a.parseShort();e[c+","+f]=h}return e}function iE(a){var e={};a.skip("uShort");var r=a.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),a.skip("uLong");var i=a.parseUShort(),o=i&255;if(a.skip("uShort"),o===0){var c=a.parseUShort();a.skip("uShort",3);for(var f=0;f<c;f+=1){var h=a.parseUShort(),p=a.parseUShort(),y=a.parseShort();e[h+","+p]=y}}return e}function lE(a,e){var r=new We.Parser(a,e),i=r.parseUShort();if(i===0)return sE(r);if(i===1)return iE(r);throw new Error("Unsupported kern table version ("+i+").")}var oE={parse:lE};function cE(a,e,r,i){for(var o=new We.Parser(a,e),c=i?o.parseUShort:o.parseULong,f=[],h=0;h<r+1;h+=1){var p=c.call(o);i&&(p*=2),f.push(p)}return f}var uE={parse:cE};function fE(a,e){var r=require("fs");r.readFile(a,function(i,o){if(i)return e(i.message);e(null,Ug(o))})}function dE(a,e){var r=new XMLHttpRequest;r.open("get",a,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?e(null,r.response):e("Font could not be loaded: "+r.statusText)},r.onerror=function(){e("Font could not be loaded")},r.send()}function Im(a,e){for(var r=[],i=12,o=0;o<e;o+=1){var c=We.getTag(a,i),f=We.getULong(a,i+4),h=We.getULong(a,i+8),p=We.getULong(a,i+12);r.push({tag:c,checksum:f,offset:h,length:p,compression:!1}),i+=16}return r}function pE(a,e){for(var r=[],i=44,o=0;o<e;o+=1){var c=We.getTag(a,i),f=We.getULong(a,i+4),h=We.getULong(a,i+8),p=We.getULong(a,i+12),y=void 0;h<p?y="WOFF":y=!1,r.push({tag:c,offset:f,compression:y,compressedLength:h,length:p}),i+=20}return r}function Cn(a,e){if(e.compression==="WOFF"){var r=new Uint8Array(a.buffer,e.offset+2,e.compressedLength-2),i=new Uint8Array(e.length);if(rb(r,i),i.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var o=new DataView(i.buffer,0);return{data:o,offset:0}}else return{data:a,offset:e.offset}}function bd(a,e){e=e??{};var r,i,o=new Yt({empty:!0}),c=new DataView(a,0),f,h=[],p=We.getTag(c,0);if(p==="\0\0\0"||p==="true"||p==="typ1")o.outlinesFormat="truetype",f=We.getUShort(c,4),h=Im(c,f);else if(p==="OTTO")o.outlinesFormat="cff",f=We.getUShort(c,4),h=Im(c,f);else if(p==="wOFF"){var y=We.getTag(c,4);if(y==="\0\0\0")o.outlinesFormat="truetype";else if(y==="OTTO")o.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+p);f=We.getUShort(c,12),h=pE(c,f)}else throw new Error("Unsupported OpenType signature "+p);for(var v,x,b,S,E,C,_,I,M,N,D,k,G=0;G<f;G+=1){var P=h[G],q=void 0;switch(P.tag){case"cmap":q=Cn(c,P),o.tables.cmap=ug.parse(q.data,q.offset),o.encoding=new dg(o.tables.cmap);break;case"cvt ":q=Cn(c,P),k=new We.Parser(q.data,q.offset),o.tables.cvt=k.parseShortList(P.length/2);break;case"fvar":x=P;break;case"fpgm":q=Cn(c,P),k=new We.Parser(q.data,q.offset),o.tables.fpgm=k.parseByteList(P.length);break;case"head":q=Cn(c,P),o.tables.head=Eg.parse(q.data,q.offset),o.unitsPerEm=o.tables.head.unitsPerEm,r=o.tables.head.indexToLocFormat;break;case"hhea":q=Cn(c,P),o.tables.hhea=wg.parse(q.data,q.offset),o.ascender=o.tables.hhea.ascender,o.descender=o.tables.hhea.descender,o.numberOfHMetrics=o.tables.hhea.numberOfHMetrics;break;case"hmtx":_=P;break;case"ltag":q=Cn(c,P),i=Tg.parse(q.data,q.offset);break;case"maxp":q=Cn(c,P),o.tables.maxp=Cg.parse(q.data,q.offset),o.numGlyphs=o.tables.maxp.numGlyphs;break;case"name":N=P;break;case"OS/2":q=Cn(c,P),o.tables.os2=ed.parse(q.data,q.offset);break;case"post":q=Cn(c,P),o.tables.post=_g.parse(q.data,q.offset),o.glyphNames=new dd(o.tables.post);break;case"prep":q=Cn(c,P),k=new We.Parser(q.data,q.offset),o.tables.prep=k.parseByteList(P.length);break;case"glyf":b=P;break;case"loca":M=P;break;case"CFF ":v=P;break;case"kern":I=P;break;case"GDEF":S=P;break;case"GPOS":E=P;break;case"GSUB":C=P;break;case"meta":D=P;break}}var Y=Cn(c,N);if(o.tables.name=Dg.parse(Y.data,Y.offset,i),o.names=o.tables.name,b&&M){var te=r===0,H=Cn(c,M),Z=uE.parse(H.data,H.offset,o.numGlyphs,te),W=Cn(c,b);o.glyphs=Pg.parse(W.data,W.offset,Z,o,e)}else if(v){var X=Cn(c,v);Sg.parse(X.data,X.offset,o,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var K=Cn(c,_);if(Ag.parse(o,K.data,K.offset,o.numberOfHMetrics,o.numGlyphs,o.glyphs,e),Tb(o,e),I){var F=Cn(c,I);o.kerningPairs=oE.parse(F.data,F.offset)}else o.kerningPairs={};if(S){var z=Cn(c,S);o.tables.gdef=eE.parse(z.data,z.offset)}if(E){var ie=Cn(c,E);o.tables.gpos=rE.parse(ie.data,ie.offset),o.position.init()}if(C){var be=Cn(c,C);o.tables.gsub=Og.parse(be.data,be.offset)}if(x){var U=Cn(c,x);o.tables.fvar=X2.parse(U.data,U.offset,o.names)}if(D){var ee=Cn(c,D);o.tables.meta=Ig.parse(ee.data,ee.offset),o.metas=o.tables.meta}return o}function hE(a,e,r){r=r??{};var i=typeof window>"u",o=i&&!r.isUrl?fE:dE;return new Promise(function(c,f){o(a,function(h,p){if(h){if(e)return e(h);f(h)}var y;try{y=bd(p,r)}catch(v){if(e)return e(v,null);f(v)}if(e)return e(null,y);c(y)})})}function mE(a,e){var r=require("fs"),i=r.readFileSync(a);return bd(Ug(i),e)}var gE=Object.freeze({__proto__:null,Font:Yt,Glyph:ja,Path:Dn,BoundingBox:Jr,_parse:We,parse:bd,load:hE,loadSync:mE});const $i=(a,e)=>({...e,...a}),Hl=new Map;function ro(a,e){const{renderingStyle:r,thickness:i,blankingSize:o}=$i(e,{renderingStyle:"normal",thickness:1,blankingSize:3});if(r==="normal"||!a||a.length===0)return a;const c=[];if(r==="dotted")for(const f of a)for(let h=0;h<i;h++)c.push({...f});else if(r==="blanked"){const f=Math.max(1,Math.floor(o));for(let h=0;h<a.length;h++){const p=a[h];p.blanking?c.push({...p}):Math.floor(h/f)%2===0?c.push({...p}):c.push({...p,r:0,g:0,b:0,blanking:!0})}}else if(r==="dots")for(const f of a)c.push({...f,r:0,g:0,b:0,blanking:!0}),c.push({...f,blanking:!1}),c.push({...f,blanking:!1});return c}async function Lm(a,e){try{if(!e)throw new Error("A font buffer is required to generate text.");const r=`${e.byteLength}_${new Uint8Array(e.slice(0,100)).join("")}`;let i=Hl.get(r);if(!i&&(i=gE.parse(e),Hl.set(r,i),Hl.size>10)){const Y=Hl.keys().next().value;Hl.delete(Y)}const{text:o,x:c,y:f,r:h,g:p,b:y,fontSize:v,numPoints:x}=$i(a,{text:"TrueLazer",x:0,y:.3,r:255,g:255,b:255,fontSize:72,numPoints:100}),b=i.getPath(o,0,0,v),S=b.commands,E=b.getBoundingBox(),C=(E.x1+E.x2)/2,_=(E.y1+E.y2)/2;let I=0,M=0,N=0;S.forEach(Y=>{if(Y.type==="M")M=Y.x,N=Y.y;else if(Y.type==="L"||Y.type==="Q"||Y.type==="C"){const te=Y.x-M,H=Y.y-N;I+=Math.sqrt(te*te+H*H),M=Y.x,N=Y.y}});const D=x/(I||1),k=[];M=0,N=0;let G=0,P=0;const q=200;if(S.forEach(Y=>{if(Y.type==="M"){if(k.length>0){const Z=k[k.length-1];k.push({...Z,r:0,g:0,b:0,blanking:!0})}G=Y.x,P=Y.y;const te=(Y.x-C)/q+c,H=-(Y.y-_)/q+f;k.push({x:te,y:H,r:0,g:0,b:0,blanking:!0}),k.push({x:te,y:H,r:h,g:p,b:y,blanking:!1}),M=Y.x,N=Y.y}else if(Y.type==="L"){const te=Y.x-M,H=Y.y-N,Z=Math.sqrt(te*te+H*H),W=Math.max(1,Math.floor(Z*D));for(let X=1;X<=W;X++){const K=X/W;k.push({x:(M+te*K-C)/q+c,y:-(N+H*K-_)/q+f,r:h,g:p,b:y})}M=Y.x,N=Y.y}else if(Y.type==="Q"){const te=Y.x-M,H=Y.y-N,Z=Math.sqrt(te*te+H*H),W=Math.max(2,Math.floor(Z*D));for(let X=1;X<=W;X++){const K=X/W,F=Math.pow(1-K,2)*M+2*(1-K)*K*Y.x1+Math.pow(K,2)*Y.x,z=Math.pow(1-K,2)*N+2*(1-K)*K*Y.y1+Math.pow(K,2)*Y.y;k.push({x:(F-C)/q+c,y:-(z-_)/q+f,r:h,g:p,b:y})}M=Y.x,N=Y.y}else if(Y.type==="C"){const te=Y.x-M,H=Y.y-N,Z=Math.sqrt(te*te+H*H),W=Math.max(3,Math.floor(Z*D));for(let X=1;X<=W;X++){const K=X/W,F=Math.pow(1-K,3)*M+3*Math.pow(1-K,2)*K*Y.x1+3*(1-K)*Math.pow(K,2)*Y.x2+Math.pow(K,3)*Y.x,z=Math.pow(1-K,3)*N+3*Math.pow(1-K,2)*K*Y.y1+3*(1-K)*Math.pow(K,2)*Y.y2+Math.pow(K,3)*Y.y;k.push({x:(F-C)/q+c,y:-(z-_)/q+f,r:h,g:p,b:y})}M=Y.x,N=Y.y}else Y.type==="Z"&&(k.push({x:(G-C)/q+c,y:-(P-_)/q+f,r:h,g:p,b:y}),M=G,N=P)}),k.length>0){const Y=k[k.length-1];k.push({...Y,r:0,g:0,b:0,blanking:!0})}return{points:ro(k,a)}}catch(r){throw console.error("Error in generateText:",r),r}}function yE(a){try{const{radius:e,numPoints:r,x:i,y:o,r:c,g:f,b:h}=$i(a,{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255}),p=[];for(let y=0;y<=r;y++){const v=y/r*2*Math.PI;p.push({x:e*Math.cos(v)+i,y:e*Math.sin(v)+o,r:c,g:f,b:h})}return{points:ro(p,a)}}catch(e){throw console.error("Error in generateCircle:",e),e}}function vE(a){try{const{width:e,height:r,pointDensity:i,x:o,y:c,r:f,g:h,b:p}=$i(a,{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255}),y=[{x:-e/2+o,y:-r/2+c},{x:e/2+o,y:-r/2+c},{x:e/2+o,y:r/2+c},{x:-e/2+o,y:r/2+c},{x:-e/2+o,y:-r/2+c}],v=[];for(let x=0;x<y.length-1;x++){const b=y[x],S=y[x+1];for(let E=0;E<i;E++){const C=E/i;v.push({x:b.x+(S.x-b.x)*C,y:b.y+(S.y-b.y)*C,r:f,g:h,b:p})}}return v.push({...y[y.length-1],r:f,g:h,b:p}),{points:ro(v,a)}}catch(e){throw console.error("Error in generateSquare:",e),e}}function bE(a){try{const{x1:e,y1:r,x2:i,y2:o,pointDensity:c,r:f,g:h,b:p}=$i(a,{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255}),y=[];for(let v=0;v<=c;v++){const x=v/c;y.push({x:e+(i-e)*x,y:r+(o-r)*x,r:f,g:h,b:p})}return{points:ro(y,a)}}catch(e){throw console.error("Error in generateLine:",e),e}}function xE(a){try{const{outerRadius:e,innerRadius:r,numSpikes:i,pointDensity:o,x:c,y:f,r:h,g:p,b:y}=$i(a,{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255}),v=[];for(let b=0;b<i*2;b++){const S=b%2===0?e:r,E=b/(i*2)*2*Math.PI-Math.PI/2;v.push({x:S*Math.cos(E)+c,y:S*Math.sin(E)+f})}v.push({...v[0]});const x=[];for(let b=0;b<v.length-1;b++){const S=v[b],E=v[b+1];for(let C=0;C<o;C++){const _=C/o;x.push({x:S.x+(E.x-S.x)*_,y:S.y+(E.y-S.y)*_,r:h,g:p,b:y})}}return x.push({...v[v.length-1],r:h,g:p,b:y}),{points:ro(x,a)}}catch(e){throw console.error("Error in generateStar:",e),e}}const ql=()=>Math.random().toString(36).substr(2,9),SE=ha.memo(({playbackFps:a,onSpeedChange:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_speed",targetType:"global",label:"SPEED",min:1,max:120,step:1}))};return m.jsxs("div",{className:"master-speed-slider",children:[m.jsxs("label",{htmlFor:"masterSpeedRange",draggable:!0,onDragStart:r,children:[a," FPS"]}),m.jsx(rn,{id:"master_speed",children:m.jsx("input",{type:"range",min:"1",max:"120",value:a,className:"slider_hor",id:"masterSpeedRange",onChange:i=>e(parseInt(i.target.value))})})]})}),EE=ha.memo(({isWorldOutputActive:a,onToggleWorldOutput:e})=>{const r=i=>{i.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"laser_output",targetType:"global",label:"LASER"}))};return m.jsx("div",{className:"container",draggable:!0,onDragStart:r,children:m.jsx(rn,{id:"laser_output",children:m.jsx("input",{type:"checkbox",checked:a,onChange:e})})})}),Vl=(a,e,r,i)=>!Array.isArray(a)||a.length!==e?Array(e).fill(null).map((o,c)=>Array(r).fill(null).map((f,h)=>i(c,h))):a.map((o,c)=>!Array.isArray(o)||o.length!==r?Array(r).fill(null).map((f,h)=>i(c,h)):o),Zg=a=>({columns:Array.from({length:8},(e,r)=>`Col ${r+1}`),layers:Array.from({length:5},(e,r)=>`Layer ${r+1}`),clipContents:Vl(a?.clipContents,5,8,()=>({parsing:!1})),clipNames:Vl(a?.clipNames,5,8,(e,r)=>`Clip ${e+1}-${r+1}`),thumbnailFrameIndexes:Array(5).fill(null).map(()=>Array(8).fill(0)),layerEffects:Array.from({length:5},()=>[]),layerAssignedDacs:a?.layerAssignedDacs??Array(5).fill([]),layerIntensities:Array(5).fill(1),layerAutopilots:Array(5).fill("off"),layerBlackouts:Array(5).fill(!1),layerSolos:Array(5).fill(!1),masterIntensity:1,globalBlackout:!1,selectedLayerIndex:null,selectedColIndex:null,notification:{message:"",visible:!1},dacs:[],selectedDac:a?.dacAssignment?.selectedDac??a?.selectedDac??null,fileBrowserViewMode:"list",fileBrowserPath:"",layerUiStates:Array(6).fill({}),ildaFrames:[],selectedIldaWorkerId:null,selectedIldaTotalFrames:0,bpm:a?.bpm??120,showBeamEffect:a?.renderSettings?.showBeamEffect??!0,beamAlpha:a?.renderSettings?.beamAlpha??.1,fadeAlpha:a?.renderSettings?.fadeAlpha??.13,playbackFps:a?.renderSettings?.playbackFps??60,previewScanRate:a?.renderSettings?.previewScanRate??1,beamRenderMode:a?.renderSettings?.beamRenderMode??"both",worldShowBeamEffect:a?.renderSettings?.worldShowBeamEffect??!0,worldBeamRenderMode:a?.renderSettings?.worldBeamRenderMode??"both",optimizationEnabled:a?.renderSettings?.optimizationEnabled??!0,activeClipIndexes:Array(5).fill(null),isPlaying:!1,isStopped:!0,isWorldOutputActive:!1,thumbnailRenderMode:a?.thumbnailRenderMode??"still",theme:a?.theme??"orange",projectLoadTimestamp:null,clipClipboard:null,dacOutputSettings:a?.dacOutputSettings??{},quickAssigns:{knobs:Array(8).fill(null).map(()=>({value:0,label:null,link:null})),buttons:Array(8).fill(null).map(()=>({value:!1,label:null,link:null}))}});function wE(a,e){switch(e.type){case"SET_DAC_OUTPUT_SETTINGS":return{...a,dacOutputSettings:{...a.dacOutputSettings,[e.payload.id]:e.payload.settings}};case"SET_COLUMNS":return{...a,columns:e.payload};case"SET_COLUMN_NAME":{const r=[...a.columns];return r[e.payload.index]=e.payload.name,{...a,columns:r}}case"DUPLICATE_COLUMN":{const r=e.payload.index,i=[...a.columns];i.splice(r+1,0,`${i[r]} (Copy)`);const o=a.clipContents.map(h=>{const p=[...h],y=p[r];let v=null;if(y&&(v=JSON.parse(JSON.stringify(y)),v.type==="ilda"&&(v.workerId=null),v.effects)){const x=v.syncSettings||{};v.effects=v.effects.map(b=>{const S=b.instanceId,E=ql();return Object.keys(x).forEach(C=>{S&&C.startsWith(`${S}.`)&&(x[`${E}.${C.split(".")[1]}`]=x[C],delete x[C])}),{...b,instanceId:E}}),v.syncSettings=x}return p.splice(r+1,0,v),p}),c=a.clipNames.map(h=>{const p=[...h];return p.splice(r+1,0,`${p[r]} (Copy)`),p}),f=a.thumbnailFrameIndexes.map(h=>{const p=[...h];return p.splice(r+1,0,p[r]),p});return{...a,columns:i,clipContents:o,clipNames:c,thumbnailFrameIndexes:f}}case"SET_LAYERS":return{...a,layers:e.payload};case"SET_LAYER_NAME":{const r=[...a.layers];return r[e.payload.index]=e.payload.name,{...a,layers:r}}case"SET_CLIP_CONTENT":{const{layerIndex:r,colIndex:i,content:o}=e.payload;if(r===void 0||i===void 0)return a;const c=[...a.clipContents];if(!c[r])return console.error(`Reducer Error: Layer array at index ${r} is undefined. Action:`,e),a;c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,...o},{...a,clipContents:c}}case"SET_CLIP_NAME":{const{layerIndex:r,colIndex:i,name:o}=e.payload;if(r===void 0||i===void 0)return a;const c=[...a.clipNames];return c[r]&&(c[r]=[...c[r]],c[r][i]=o),{...a,clipNames:c}}case"SET_THUMBNAIL_FRAME_INDEX":{const r=[...a.thumbnailFrameIndexes];return r[e.payload.layerIndex][e.payload.colIndex]=e.payload.index,{...a,thumbnailFrameIndexes:r}}case"ADD_LAYER_EFFECT":{const r=[...a.layerEffects],i={...e.payload.effect,instanceId:ql(),params:{...e.payload.effect.defaultParams}};return r[e.payload.layerIndex].push(i),{...a,layerEffects:r}}case"ADD_CLIP_EFFECT":{const r=[...a.clipContents];if(!r[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),a;r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=r[e.payload.layerIndex][e.payload.colIndex]||{},o={...e.payload.effect,instanceId:ql(),params:{...e.payload.effect.defaultParams}},c={...i,effects:[...i.effects||[],o]};return r[e.payload.layerIndex][e.payload.colIndex]=c,{...a,clipContents:r}}case"SET_SELECTED_CLIP":return{...a,selectedLayerIndex:e.payload.layerIndex,selectedColIndex:e.payload.colIndex};case"SET_NOTIFICATION":return{...a,notification:e.payload};case"SET_ILDA_FRAMES":return{...a,ildaFrames:e.payload};case"SET_SELECTED_ILDA_DATA":return{...a,selectedIldaWorkerId:e.payload.workerId,selectedIldaTotalFrames:e.payload.totalFrames,selectedGeneratorId:e.payload.generatorId,selectedGeneratorParams:e.payload.generatorParams};case"SET_ACTIVE_CLIP":{const r=[...a.activeClipIndexes];return r[e.payload.layerIndex]=e.payload.colIndex,{...a,activeClipIndexes:r}}case"CLEAR_CLIP":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]],r[e.payload.layerIndex][e.payload.colIndex]=null;const i=[...a.clipNames];i[e.payload.layerIndex][e.payload.colIndex]=`Clip ${e.payload.layerIndex+1}-${e.payload.colIndex+1}`;const o=[...a.thumbnailFrameIndexes];o[e.payload.layerIndex][e.payload.colIndex]=0;const c=[...a.activeClipIndexes];return c[e.payload.layerIndex]===e.payload.colIndex&&(c[e.payload.layerIndex]=null),a.selectedLayerIndex===e.payload.layerIndex&&a.selectedColIndex===e.payload.colIndex?{...a,clipContents:r,clipNames:i,thumbnailFrameIndexes:o,activeClipIndexes:c,selectedLayerIndex:null,selectedColIndex:null,selectedIldaWorkerId:null,selectedIldaTotalFrames:0,selectedGeneratorId:null,selectedGeneratorParams:{}}:{...a,clipContents:r,clipNames:i,thumbnailFrameIndexes:o,activeClipIndexes:c}}case"DEACTIVATE_LAYER_CLIPS":{const r=[...a.activeClipIndexes];return r[e.payload.layerIndex]=null,{...a,activeClipIndexes:r}}case"CLEAR_ALL_ACTIVE_CLIPS":return{...a,activeClipIndexes:Array(a.layers.length).fill(null)};case"SET_LAYER_INTENSITY":{const r=[...a.layerIntensities];return r[e.payload.layerIndex]=e.payload.intensity,{...a,layerIntensities:r}}case"SET_LAYER_AUTOPILOT":{const r=[...a.layerAutopilots];return r[e.payload.layerIndex]=e.payload.mode,{...a,layerAutopilots:r}}case"TOGGLE_LAYER_BLACKOUT":{const r=[...a.layerBlackouts];return r[e.payload.layerIndex]=!r[e.payload.layerIndex],{...a,layerBlackouts:r}}case"TOGGLE_LAYER_SOLO":{const r=[...a.layerSolos],i=r[e.payload.layerIndex];return r.fill(!1),i||(r[e.payload.layerIndex]=!0),{...a,layerSolos:r}}case"SET_MASTER_INTENSITY":return{...a,masterIntensity:e.payload};case"TOGGLE_GLOBAL_BLACKOUT":return{...a,globalBlackout:!a.globalBlackout};case"SET_RENDER_SETTING":return{...a,[e.payload.setting]:e.payload.value};case"SET_FILE_BROWSER_VIEW_MODE":return{...a,fileBrowserViewMode:e.payload};case"SET_FILE_BROWSER_PATH":return{...a,fileBrowserPath:e.payload};case"UPDATE_CLIP_UI_STATE":{const{layerIndex:r,colIndex:i,uiState:o}=e.payload,c=[...a.clipContents];c[r]=[...c[r]];const f={...c[r][i]};return f&&(f.uiState={...f.uiState||{},...o},c[r][i]=f),{...a,clipContents:c}}case"UPDATE_LAYER_UI_STATE":{const{layerIndex:r,uiState:i}=e.payload,o=[...a.layerUiStates];return o[r]={...o[r],...i},{...a,layerUiStates:o}}case"REMOVE_CLIP_EFFECT":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};if(i&&i.effects){const o=[...i.effects];o.splice(e.payload.effectIndex,1),i.effects=o,r[e.payload.layerIndex][e.payload.colIndex]=i}return{...a,clipContents:r}}case"REORDER_CLIP_EFFECTS":{const{layerIndex:r,colIndex:i,oldIndex:o,newIndex:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const h={...f[r][i]};if(h&&h.effects){const p=[...h.effects],[y]=p.splice(o,1);p.splice(c,0,y),h.effects=p,f[r][i]=h}return{...a,clipContents:f}}case"REMOVE_LAYER_EFFECT":{const r=[...a.layerEffects];return r[e.payload.layerIndex]&&(r[e.payload.layerIndex]=[...r[e.payload.layerIndex]],r[e.payload.layerIndex].splice(e.payload.effectIndex,1)),{...a,layerEffects:r}}case"UPDATE_LAYER_EFFECT_PARAMETER":{const r=[...a.layerEffects];if(r[e.payload.layerIndex]){r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=e.payload.effectIndex;if(r[e.payload.layerIndex][i]){const o={...r[e.payload.layerIndex][i]};o.params={...o.params,[e.payload.paramName]:e.payload.newValue},r[e.payload.layerIndex][i]=o}}return{...a,layerEffects:r}}case"UPDATE_EFFECT_PARAMETER":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};if(i&&i.effects){const o=[...i.effects],c={...o[e.payload.effectIndex]};c.params={...c.params,[e.payload.paramName]:e.payload.newValue},o[e.payload.effectIndex]=c,i.effects=o,r[e.payload.layerIndex][e.payload.colIndex]=i}return{...a,clipContents:r}}case"UPDATE_CLIP_PLAYBACK_SETTINGS":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};return i&&(i.playbackSettings={...i.playbackSettings||{mode:"fps",duration:1,beats:8,speedMultiplier:1},...e.payload.settings},r[e.payload.layerIndex][e.payload.colIndex]=i),{...a,clipContents:r}}case"SET_CLIP_PARAM_SYNC":{const{layerIndex:r,colIndex:i,paramId:o,syncMode:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const h={...f[r][i]};if(h){const p=h.syncSettings||{},y=p[o]===c?null:c;h.syncSettings={...p,[o]:y},f[r][i]=h}return{...a,clipContents:f}}case"UPDATE_GENERATOR_PARAM":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i={...r[e.payload.layerIndex][e.payload.colIndex]};return i&&i.type==="generator"&&i.currentParams&&(i.currentParams={...i.currentParams,[e.payload.paramName]:e.payload.newValue},r[e.payload.layerIndex][e.payload.colIndex]=i,a.selectedLayerIndex===e.payload.layerIndex&&a.selectedColIndex===e.payload.colIndex)?{...a,clipContents:r,selectedGeneratorParams:i.currentParams}:{...a,clipContents:r}}case"SET_DACS":return{...a,dacs:e.payload};case"SET_BPM":return{...a,bpm:e.payload};case"SET_SELECTED_DAC":return{...a,selectedDac:e.payload};case"SET_IS_PLAYING":return{...a,isPlaying:e.payload};case"SET_IS_STOPPED":return{...a,isStopped:e.payload};case"SET_WORLD_OUTPUT_ACTIVE":return{...a,isWorldOutputActive:e.payload};case"SET_OPTIMIZATION_ENABLED":return{...a,optimizationEnabled:e.payload};case"TOGGLE_WORLD_OUTPUT_ACTIVE":return{...a,isWorldOutputActive:!a.isWorldOutputActive};case"SET_CLIPBOARD":return{...a,clipClipboard:e.payload};case"SET_CLIP_DAC":{const r=[...a.clipContents];if(!r[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),a;r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const i=r[e.payload.layerIndex][e.payload.colIndex]||{};let o=i.assignedDacs||[];const c=[],f=p=>{const{channels:y,allChannels:v,...x}=p;return x};if(e.payload.dac.allChannels&&e.payload.dac.channels)e.payload.dac.channels.forEach(p=>{o.some(y=>y.ip===e.payload.dac.ip&&y.channel===p.serviceID)||c.push({...f(e.payload.dac),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=e.payload.dac.channel;p!==void 0&&!o.some(y=>y.ip===e.payload.dac.ip&&y.channel===p)&&c.push({...f(e.payload.dac),channel:p,mirrorX:!1,mirrorY:!1})}if(c.length===0)return a;const h={...i,assignedDacs:[...o,...c]};return r[e.payload.layerIndex][e.payload.colIndex]=h,{...a,clipContents:r}}case"SET_LAYER_DAC":{const{layerIndex:r,dac:i}=e.payload,o=[...a.layerAssignedDacs],c=o[r]||[];let f=[];const h=p=>{const{channels:y,allChannels:v,...x}=p;return x};if(i.allChannels&&i.channels)i.channels.forEach(p=>{c.some(y=>y.ip===i.ip&&y.channel===p.serviceID)||f.push({...h(i),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=i.channel;p!==void 0&&!c.some(y=>y.ip===i.ip&&y.channel===p)&&f.push({...h(i),channel:p,mirrorX:!1,mirrorY:!1})}return f.length===0?a:(o[r]=[...c,...f],{...a,layerAssignedDacs:o})}case"TOGGLE_CLIP_DAC_MIRROR":{const{layerIndex:r,colIndex:i,dacIndex:o,axis:c}=e.payload,f=[...a.clipContents];f[r]=[...f[r]];const h={...f[r][i]};if(h&&h.assignedDacs){const p=[...h.assignedDacs],y={...p[o]};return c==="x"&&(y.mirrorX=!y.mirrorX),c==="y"&&(y.mirrorY=!y.mirrorY),p[o]=y,h.assignedDacs=p,f[r][i]=h,{...a,clipContents:f}}return a}case"REMOVE_CLIP_DAC":{const r=[...a.clipContents];r[e.payload.layerIndex]=[...r[e.payload.layerIndex]];const{layerIndex:i,colIndex:o,dacIndex:c}=e.payload,f=r[i][o];if(f&&f.assignedDacs){const h=[...f.assignedDacs];return h.splice(c,1),r[e.payload.layerIndex][e.payload.colIndex]={...f,assignedDacs:h},{...a,clipContents:r}}return a}case"TOGGLE_LAYER_DAC_MIRROR":{const{layerIndex:r,dacIndex:i,axis:o}=e.payload,c=[...a.layerAssignedDacs],f=c[r]?[...c[r]]:[];if(f[i]){const h={...f[i]};return o==="x"&&(h.mirrorX=!h.mirrorX),o==="y"&&(h.mirrorY=!h.mirrorY),f[i]=h,c[r]=f,{...a,layerAssignedDacs:c}}return a}case"REMOVE_LAYER_DAC":{const{layerIndex:r,dacIndex:i}=e.payload,o=[...a.layerAssignedDacs];if(o[r]){const c=[...o[r]];return c.splice(i,1),o[r]=c,{...a,layerAssignedDacs:o}}return a}case"SET_CLIP_AUDIO":{const r=[...a.clipContents],{layerIndex:i,colIndex:o,audioFile:c}=e.payload;r[i]=[...r[i]];const f=r[i][o];return f?(r[i][o]={...f,audioFile:c,audioVolume:f.audioVolume!==void 0?f.audioVolume:1},{...a,clipContents:r}):a}case"SET_CLIP_AUDIO_VOLUME":{const r=[...a.clipContents],{layerIndex:i,colIndex:o,volume:c}=e.payload;r[i]=[...r[i]];const f=r[i][o];return f?(r[i][o]={...f,audioVolume:c},{...a,clipContents:r}):a}case"REMOVE_CLIP_AUDIO":{const r=[...a.clipContents],{layerIndex:i,colIndex:o}=e.payload;r[i]=[...r[i]];const c=r[i][o];return c?(r[i][o]={...c,audioFile:null},{...a,clipContents:r}):a}case"SET_CLIP_PARSING_STATUS":{const{layerIndex:r,colIndex:i,status:o}=e.payload,c=[...a.clipContents];if(c[r]){c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,parsing:o},{...a,clipContents:c}}return a}case"SET_BULK_PARSING_STATUS":{const r=[...a.clipContents];return new Set(e.payload.map(o=>o.layerIndex)).forEach(o=>{r[o]&&(r[o]=[...r[o]])}),e.payload.forEach(({layerIndex:o,colIndex:c,status:f})=>{if(r[o]){const h=r[o][c]||{};r[o][c]={...h,parsing:f}}}),{...a,clipContents:r}}case"SET_THUMBNAIL_RENDER_MODE":return{...a,thumbnailRenderMode:e.payload};case"SET_CLIP_TRIGGER_STYLE":{const{layerIndex:r,colIndex:i,style:o}=e.payload,c=[...a.clipContents];c[r]=[...c[r]];const f=c[r][i]||{};return c[r][i]={...f,triggerStyle:o},{...a,clipContents:c}}case"SET_THEME":return{...a,theme:e.payload};case"UPDATE_THUMBNAIL":{const{layerIndex:r,colIndex:i,frameIndex:o}=e.payload,c=[...a.thumbnailFrameIndexes];return c[r]=[...c[r]],c[r][i]=o,{...a,thumbnailFrameIndexes:c}}case"RESET_STATE":return Zg({});case"LOAD_PROJECT":{const r={...a,...e.payload};return r.clipContents=Vl(r.clipContents,5,8,()=>({parsing:!1})),r.clipNames=Vl(r.clipNames,5,8,(i,o)=>`Clip ${i+1}-${o+1}`),r.clipContents=r.clipContents.map(i=>i.map(o=>o&&o.type==="ilda"?{...o,workerId:null,parsing:!1}:o)),r.activeClipIndexes=Array(a.layers.length).fill(null),r.selectedLayerIndex=null,r.selectedColIndex=null,r.selectedIldaWorkerId=null,r.selectedIldaTotalFrames=0,r.selectedGeneratorId=null,r.selectedGeneratorParams={},r.projectLoadTimestamp=Date.now(),r}case"LOAD_SETTINGS":return{...a,showBeamEffect:e.payload.renderSettings?.showBeamEffect??a.showBeamEffect,beamAlpha:e.payload.renderSettings?.beamAlpha??a.beamAlpha,fadeAlpha:e.payload.renderSettings?.fadeAlpha??a.fadeAlpha,playbackFps:e.payload.renderSettings?.playbackFps??a.playbackFps,previewScanRate:e.payload.renderSettings?.previewScanRate??a.previewScanRate,beamRenderMode:e.payload.renderSettings?.beamRenderMode??a.beamRenderMode,theme:e.payload.theme??a.theme,thumbnailRenderMode:e.payload.thumbnailRenderMode??a.thumbnailRenderMode,selectedDac:e.payload.selectedDac??a.selectedDac,clipNames:e.payload.clipNames?Vl(e.payload.clipNames,5,8,(r,i)=>`Clip ${r+1}-${i+1}`):a.clipNames,dacOutputSettings:e.payload.dacOutputSettings??a.dacOutputSettings};case"ASSIGN_QUICK_CONTROL":{const{type:r,index:i,link:o}=e.payload,c={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},f=r==="knob"?"knobs":"buttons";return c[f][i]={...c[f][i],label:o.paramName||o.paramId,link:o,min:o.min,max:o.max,step:o.step},{...a,quickAssigns:c}}case"CLEAR_QUICK_CONTROL":{const{type:r,index:i}=e.payload,o={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},c=r==="knob"?"knobs":"buttons";return o[c][i]={value:r==="knob"?0:!1,label:null,link:null},{...a,quickAssigns:o}}case"UPDATE_QUICK_CONTROL":{const{type:r,index:i,value:o}=e.payload,c={knobs:[...a.quickAssigns.knobs],buttons:[...a.quickAssigns.buttons]},f=r==="knob"?"knobs":"buttons",h=c[f][i];c[f][i]={...h,value:o};let p={...a,quickAssigns:c};if(h.link){const{layerIndex:y,colIndex:v,effectIndex:x,targetType:b}=h.link,S=h.link.paramName||h.link.paramId;let E=o;if(r==="knob"&&h.min!==void 0&&h.max!==void 0&&(E=h.min+o*(h.max-h.min),h.step&&(E=Math.round(E/h.step)*h.step),E=parseFloat(E.toFixed(5))),console.log(`Updating ${b} param ${S} to ${E} (Link: L${y} C${v} E${x})`),b==="layerEffect"){const C=[...p.layerEffects];if(C[y]&&(C[y]=[...C[y]],C[y][x])){const _={...C[y][x]};_.params={..._.params,[S]:E},C[y][x]=_,p={...p,layerEffects:C}}}else if(b==="global")S==="master_intensity"?p={...p,masterIntensity:E}:S==="master_speed"&&(p={...p,playbackFps:E});else{const C=[...p.clipContents];if(C[y]){C[y]=[...C[y]];const _=C[y][v];if(_)if(b==="effect"&&_.effects&&_.effects[x]){const I=[..._.effects],M={...I[x]};M.params={...M.params,[S]:E},I[x]=M,C[y][v]={..._,effects:I}}else b==="generator"&&(C[y][v]={..._,currentParams:{..._.currentParams,[S]:E}});p.clipContents=C}}}return p}case"TOGGLE_QUICK_BUTTON":{const{index:r}=e.payload,o=!a.quickAssigns.buttons[r].value,c={...a.quickAssigns,buttons:[...a.quickAssigns.buttons]};c.buttons[r]={...c.buttons[r],value:o};let f={...a,quickAssigns:c};const h=c.buttons[r];if(h.link){const{layerIndex:p,colIndex:y,effectIndex:v,targetType:x}=h.link,b=h.link.paramName||h.link.paramId;if(x==="global")b==="blackout"?f.globalBlackout=o:b==="laser_output"&&(f.isWorldOutputActive=o);else if(x==="layer"){if(b==="blackout"){const S=[...f.layerBlackouts];S[p]=o,f={...f,layerBlackouts:S}}else if(b==="solo"){const S=[...f.layerSolos];o?(S.fill(!1),S[p]=!0):S[p]=!1,f={...f,layerSolos:S}}else if(b==="clear"){if(o){const S=[...f.activeClipIndexes];S[p]=null,f={...f,activeClipIndexes:S},c.buttons[r].value=!1,f.quickAssigns=c}}else if(b==="autopilot"){const S=[...f.layerAutopilots];S[p]=o?"forward":"off",f={...f,layerAutopilots:S}}}else if(x==="layerEffect"){const S=[...f.layerEffects];if(S[p]&&(S[p]=[...S[p]],S[p][v])){const E={...S[p][v]};E.params={...E.params,[b]:o},S[p][v]=E,f={...f,layerEffects:S}}}else{const S=[...f.clipContents];if(S[p]){S[p]=[...S[p]];const E=S[p][y];if(E)if(x==="effect"&&E.effects&&E.effects[v]){const C=[...E.effects],_={...C[v]};_.params={..._.params,[b]:o},C[v]=_,S[p][y]={...E,effects:C}}else x==="generator"&&(S[p][y]={...E,currentParams:{...E.currentParams,[b]:o}});f.clipContents=S}}}return f}case"UPDATE_CLIP_FILE_PATH":{const{oldPath:r,newPath:i}=e.payload;console.log(`Reducer: Updating clip path from ${r} to ${i}`);const o=a.clipContents.map(c=>c.map(f=>{let h=f;return f&&f.filePath===r&&(h={...h,filePath:i,parsingFailed:!1}),f&&f.audioFile&&f.audioFile.path===r&&(h={...h,audioFile:{...f.audioFile,path:i}}),h}));return{...a,clipContents:o}}case"SET_CLIP_PARSING_FAILED":{const{layerIndex:r,colIndex:i,failed:o}=e.payload,c=[...a.clipContents];if(c[r]){c[r]=[...c[r]];const f=c[r][i];f&&(c[r][i]={...f,parsingFailed:o})}return{...a,clipContents:c}}default:return a}}const mc={orange:{full:60,dim:10},yellow:{full:74,dim:15},cyan:{full:36,dim:35},"light-blue":{full:41,dim:43},blue:{full:45,dim:47},magenta:{full:53,dim:55},red:{full:5,dim:7},green:{full:21,dim:23},white:{full:3,dim:1}},AE=({isPlaying:a,globalBlackout:e,layerBlackouts:r,layerSolos:i,isWorldOutputActive:o,clipContents:c,activeClipIndexes:f,theme:h,bpm:p,quickAssigns:y})=>{const{sendFeedback:v,mappings:x,selectedMidiInputId:b,midiInitialized:S}=Cc();return T.useEffect(()=>{if(!b||!S||!a){S&&b&&gc(b,"F#6",0,1);return}let E=!1;const C=6e4/(p||120),_=setInterval(()=>{E=!E,gc(b,"F#6",E?127:0,1)},C/2);return()=>{clearInterval(_),gc(b,"F#6",0,1)}},[a,p,b,S]),T.useEffect(()=>{v("transport_play",a),v("transport_stop",!a)},[a,v]),T.useEffect(()=>{v("comp_blackout",e)},[e,v]),T.useEffect(()=>{v("laser_output",o)},[o,v]),T.useEffect(()=>{r.forEach((E,C)=>{v(`layer_${C}_blackout`,E)})},[r,v]),T.useEffect(()=>{i.forEach((E,C)=>{v(`layer_${C}_solo`,E)})},[i,v]),T.useEffect(()=>{if(!c||!f)return;const E=mc[h]||mc.orange;c.forEach((C,_)=>{C.forEach((I,M)=>{const N=`clip_${_}_${M}`;if(x[N]){const D=f[_]===M,k=I!==null&&(I.type==="ilda"||I.type==="generator"),G=I?.triggerStyle||"normal";let P=0,q=null;D?(P=E.full,G==="toggle"&&(q=10)):k&&(P=E.dim),v(N,P,q)}})})},[c,f,h,x,v]),T.useEffect(()=>{if(!y)return;const E=mc[h]||mc.orange;y.buttons.forEach((C,_)=>{v(`quick_btn_${_}`,C.value?E.full:0)})},[y,h,v]),null},Gf=async(a,e,r,i,o=!0)=>{if(!a||!a.points)return null;let c=a;if(o)try{const I=id(a.points);c={...a,points:I,isTypedArray:!0}}catch(I){console.warn("Failed to optimize points for thumbnail:",I)}let f=c;try{e&&e.length>0&&(f=Xl(c,e,{progress:0,time:0,effectStates:{},assignedDacs:[]}))}catch(I){console.warn("Failed to apply effects for thumbnail:",I)}const h=128,p=128,y=document.createElement("canvas");y.width=h,y.height=p;const v=y.getContext("2d");v.fillStyle="#000000",v.fillRect(0,0,h,p);const x=f.points,b=f.isTypedArray||x instanceof Float32Array,S=b?x.length/8:x.length;v.lineWidth=1.5,v.lineCap="round";let E=null,C=null,_=!0;for(let I=0;I<S;I++){let M,N,D,k,G,P;if(b){const te=I*8;M=x[te],N=x[te+1],D=x[te+3],k=x[te+4],G=x[te+5],P=x[te+6]>.5}else{const te=x[I];M=te.x,N=te.y,D=te.r,k=te.g,G=te.b,P=!!te.blanking}const q=(M+1)*.5*h,Y=(1-(N+1)*.5)*p;if(!P&&!_&&E!==null){v.beginPath(),v.moveTo(E,C),v.lineTo(q,Y);const te=Math.floor(Math.max(0,Math.min(255,D))),H=Math.floor(Math.max(0,Math.min(255,k))),Z=Math.floor(Math.max(0,Math.min(255,G)));v.strokeStyle=`rgb(${te},${H},${Z})`,v.stroke()}E=q,C=Y,_=P}try{const M=await(await new Promise(N=>y.toBlob(N,"image/png"))).arrayBuffer();if(window.electronAPI&&window.electronAPI.saveThumbnail){const N=`thumb_L${r}_C${i}.png`;return await window.electronAPI.saveThumbnail(M,N)}}catch(I){console.error("Error generating/saving thumbnail:",I)}return null},Um=ha.memo(({type:a,previewFrameCountRef:e,totalPointsSentRef:r,activeChannelsCountRef:i,lastStatUpdateTimeRef:o})=>{const[c,f]=T.useState({cpu:"0.0",ram:"0",fps:0,pps:0,avgPps:0});return T.useEffect(()=>{const h=window.electronAPI?.onSystemStats(y=>{f(v=>({...v,...y}))});let p;return a==="performance"&&o&&e&&r&&i&&(p=setInterval(()=>{const y=performance.now(),v=(y-(o.current||0))/1e3;if(v>0){const x=Math.round((e.current||0)/v),b=Math.round((r.current||0)/v),S=(i.current||0)>0?Math.round(b/i.current):0;f(E=>({...E,fps:x,pps:b,avgPps:S})),e.current=0,r.current=0,o.current=y}},1e3)),()=>{h&&h(),p&&clearInterval(p)}},[a,e,r,i,o]),a==="system"?m.jsxs("div",{className:"systemStats",children:[m.jsxs("p",{className:"sysStats",children:["CPU: ",c.cpu,"%"]}),m.jsxs("p",{className:"sysStats",children:["RAM: ",c.ram,"MB"]})]}):m.jsxs("div",{className:"performanceStats",children:[m.jsxs("p",{className:"perfStats",children:["FPS: ",c.fps]}),m.jsxs("p",{className:"perfStats",children:["AnimPPS: ",c.avgPps," (Avg)"]})]})}),TE=ha.memo(({playbackFps:a,previewScanRate:e,previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c})=>m.jsxs("div",{className:"system-monitor-grid",children:[m.jsx(Um,{type:"performance",previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c}),m.jsx(Um,{type:"system",previewFrameCountRef:r,totalPointsSentRef:i,activeChannelsCountRef:o,lastStatUpdateTimeRef:c})]})),CE=ha.memo(({clipContents:a,activeClipIndexes:e,layerEffects:r,bpm:i,playbackFps:o,selectedLayerIndex:c,selectedColIndex:f,liveFramesRef:h,progressRef:p,selectedDac:y,liveDacOutputSettingsRef:v,dacOutputSettings:x,getAudioInfo:b,fftLevels:S,getFftLevels:E,effectStatesRef:C,clipActivationTimesRef:_,showBeamEffect:I,beamAlpha:M,fadeAlpha:N,previewScanRate:D,beamRenderMode:k,worldShowBeamEffect:G,worldBeamRenderMode:P,masterIntensity:q,layerIntensities:Y,globalBlackout:te,layerSolos:H,layerBlackouts:Z,handleToggleBeamEffect:W,handleCycleDisplayMode:X,previewFrameCountRef:K,totalPointsSentRef:F,activeChannelsCountRef:z,lastStatUpdateTimeRef:ie,liveClipContentsRef:be,optimizationEnabled:U})=>{const[ee,ve]=T.useState(0),Me=T.useRef(0),me=T.useRef(performance.now()),Ce=1e3/70;T.useEffect(()=>{let Ie;const rt=Re=>{Re-Me.current>Ce&&(K.current++,me.current=performance.now(),ve(wt=>wt+1),Me.current=Re),Ie=requestAnimationFrame(rt)};return Ie=requestAnimationFrame(rt),()=>cancelAnimationFrame(Ie)},[Ce,K]);const Oe=be?.current||a,at=c!==null&&f!==null?Oe[c][f]:null,tt=f!==null?at?.type==="ilda"?at?.workerId:`generator-${c}-${f}`:c!==null&&e[c]!==null?Oe[c][e[c]]?.type==="ilda"?Oe[c][e[c]]?.workerId:`generator-${c}-${e[c]}`:null,bt=tt?h.current[tt]:null,sn=tt&&p.current[tt]||0;let Jt=[],en=1;if(c!==null){const Ie=r[c]||[];if(f!==null)Jt=[...at?.effects||[],...Ie];else{const wt=e[c];wt!==null?Jt=[...Oe[c][wt]?.effects||[],...Ie]:Jt=Ie}const rt=H.some(wt=>wt);let Re=Y[c];te?Re=0:rt?Re=H[c]?Z[c]?0:Re:0:Z[c]&&(Re=0),en=Re*q}const xt=T.useMemo(()=>{const Ie={};return e.forEach((rt,Re)=>{if(rt!==null){const wt=Oe[Re][rt];if(wt){let nn=wt.type==="ilda"?wt.workerId:`generator-${Re}-${rt}`;nn&&h.current[nn]&&(Ie[nn]={frame:h.current[nn],effects:[...wt.effects||[],...r[Re]||[]],layerIndex:Re,syncSettings:wt.syncSettings||{},bpm:i,clipDuration:(()=>{const Ue=wt.playbackSettings||{};return Ue.mode==="timeline"?Ue.duration||1:Ue.mode==="bpm"?(Ue.beats||8)*60/(i||120):(wt.totalFrames||30)/(wt.fps||o||30)})(),progress:p.current[nn]||0,effectStates:C.current,clipActivationTime:_.current[Re]||0})}}}),Ie},[e,Oe,ee,i,r,o,h,p,C,_]),tn=T.useMemo(()=>{const Ie=H.some(rt=>rt);return Y.map((rt,Re)=>te?0:Ie?H[Re]?Z[Re]?0:rt:0:Z[Re]?0:rt)},[Y,Z,H,te]);return m.jsxs("div",{className:"side-panel",children:[m.jsx(C1,{frame:bt,effects:Jt,showBeamEffect:I,beamAlpha:M,fadeAlpha:N,previewScanRate:D,beamRenderMode:k,intensity:en,syncSettings:at?.syncSettings,bpm:i,clipDuration:(()=>{const Ie=at?.playbackSettings||{};return Ie.mode==="timeline"?Ie.duration||1:Ie.mode==="bpm"?(Ie.beats||8)*60/(i||120):(at?.totalFrames||30)/(at?.fps||o||30)})(),progress:sn,previewTime:me.current,fftLevels:E?E():S,effectStates:C.current,clipActivationTime:c!==null&&_.current[c]||0,optimizationEnabled:U,onToggleBeamEffect:()=>W("clip"),onCycleDisplayMode:()=>X("clip")}),m.jsx(M1,{activeFrames:xt,showBeamEffect:G,beamAlpha:M,fadeAlpha:N,previewScanRate:D,beamRenderMode:P,layerIntensities:tn,masterIntensity:q,dacSettings:y?v.current?v.current[`${y.ip}:${y.channel}`]:x[`${y.ip}:${y.channel}`]:null,previewTime:me.current,fftLevels:E?E():S,optimizationEnabled:U,onToggleBeamEffect:()=>W("world"),onCycleDisplayMode:()=>X("world")})]})});function ME(){const a=Y1(),e=Ym(),r=X1(),i=T.useRef(null),{fftLevels:o,getFftLevels:c}=Kl()||{};T.useEffect(()=>{const j=new Worker(new URL(""+new URL("ui-generators.worker-Ccw3pDxU.js",import.meta.url).href,import.meta.url),{type:"module"});i.current=j;const L=$=>{if(!$.data.browserFile){if($.data.layerIndex!==void 0&&$.data.colIndex!==void 0){const B=`${$.data.layerIndex}-${$.data.colIndex}`;if(ka.current.set(B,!1),_r.current.has(B)){const{message:re,transferables:xe}=_r.current.get(B);_r.current.delete(B),console.log(`[App.jsx] UI Generator ${B} free, processing pending seq ${re.seq}`),ka.current.set(B,!0),j.postMessage(re,xe)}}if($.data.success){const{layerIndex:B,colIndex:re,frames:xe,generatorDefinition:ge,currentParams:Le,isLive:Pe,isAutoUpdate:st,seq:Ee}=$.data;if(B===void 0||re===void 0)return;if(Ee!==void 0){if(Ee<vr.current)return;vr.current=Ee}const et=`generator-${B}-${re}`;if(M.current[et]=xe[0],!Pe&&!st){const Be=Pt.current[B][re]||{},Ge={...Be,type:"generator",generatorDefinition:ge,frames:xe,currentParams:Le,playbackSettings:Be.playbackSettings||{mode:"fps",duration:5,beats:8,speedMultiplier:1}};le({type:"SET_CLIP_CONTENT",payload:{layerIndex:B,colIndex:re,content:Ge}});const Xe=Ra.current[B][re],Fe=`Clip ${B+1}-${re+1}`;Xe===Fe&&le({type:"SET_CLIP_NAME",payload:{layerIndex:B,colIndex:re,name:ge.name}})}}else mn(`UI Generator error: ${$.data.error}`)}};return j.addEventListener("message",L),()=>{j.removeEventListener("message",L),j.terminate()}},[]);const{devices:f,selectedDeviceId:h,setSelectedDeviceId:p,playAudio:y,stopAudio:v,pauseAllAudio:x,resumeAllAudio:b,setPlaybackRate:S,resetAllAudio:E,stopAllAudio:C,getAudioInfo:_,setClipVolume:I}=Km();T.useRef(new Set),T.useRef(0);const M=T.useRef({}),N=T.useRef(new Map),D=T.useRef({}),k=T.useRef({}),G=T.useRef({}),P=T.useRef({}),[q,Y]=T.useState(null),[te,H]=T.useState(!1),[Z,W]=T.useState("main"),[X,K]=T.useState(!1),[F,z]=T.useState(!1),[ie,be]=T.useState({midi:!1,artnet:!1,osc:!1,keyboard:!1}),[U,ee]=T.useState(!1),[ve,Me]=T.useState(!1),[me,Ce]=T.useState(!1),[Oe,at]=T.useState(!1),[tt,bt]=T.useState({title:"",initialValue:"",onSave:()=>{}}),[sn,Jt]=T.useState("files"),[en,xt]=T.useState("clip"),[tn,Ie]=T.useState([]),rt=T.useRef(0),Re=T.useRef(0),wt=T.useRef(0),nn=T.useRef(performance.now()),[Ue,le]=T.useReducer(wE,Zg(te?q:{})),ln=T.useRef(new Map),It=T.useCallback((j,L,$=30)=>{ln.current.has(j)&&clearTimeout(ln.current.get(j));const B=setTimeout(()=>{le(L),ln.current.delete(j)},$);ln.current.set(j,B)},[]),{columns:qt,layers:mt,clipContents:Ye,clipNames:At,thumbnailFrameIndexes:Bn,layerEffects:on,layerAssignedDacs:es,layerIntensities:Fn,layerAutopilots:kr,layerBlackouts:Kn,layerSolos:Ta,masterIntensity:jn,globalBlackout:Jn,selectedLayerIndex:qe,selectedColIndex:gt,notification:ts,dacs:Ga,selectedDac:Pn,ildaFrames:Dr,selectedIldaWorkerId:gr,selectedIldaTotalFrames:ns,showBeamEffect:Ha,beamAlpha:Ca,fadeAlpha:Ma,playbackFps:oa,previewScanRate:Ya,beamRenderMode:Mn,worldShowBeamEffect:bn,worldBeamRenderMode:xn,optimizationEnabled:_n,activeClipIndexes:dn,isPlaying:ar,isWorldOutputActive:ma,selectedGeneratorId:qa,selectedGeneratorParams:as,thumbnailRenderMode:rs,theme:ga,dacOutputSettings:pn}=Ue,ca=T.useMemo(()=>mt.map((j,L)=>{const $=dn[L];if($!==null){const B=Ye[L][$];if(B){let re,xe=null;if(B.type==="ilda"&&B.workerId&&B.totalFrames)return re=B.workerId,xe=B.stillFrame,{type:"ilda",workerId:re,totalFrames:B.totalFrames,effects:B.effects||[],dac:B.dac||null,assignedDacs:B.assignedDacs||[],ildaFormat:B.ildaFormat||0,stillFrame:xe,layerIndex:L,syncSettings:B.syncSettings||{},fps:B.fps||null};if(B.type==="generator"&&B.frames&&B.generatorDefinition)return re=`generator-${L}-${$}`,xe=B.stillFrame||B.frames?.[0]||null,{type:"generator",workerId:re,totalFrames:B.frames.length,effects:B.effects||[],dac:B.dac||null,assignedDacs:B.assignedDacs||[],ildaFormat:0,stillFrame:xe,layerIndex:L,syncSettings:B.syncSettings||{},fps:B.fps||null}}}return null}).filter(Boolean),[mt,dn,Ye]),Pt=T.useRef(Ye),it=T.useRef(null),Na=T.useRef(!1),Vn=T.useRef(null),Nn=T.useRef(!1);T.useEffect(()=>{Ye&&(it.current=structuredClone(Ye))},[]),T.useEffect(()=>{pn&&(Vn.current=structuredClone(pn))},[]);const Va=T.useRef(Fn),Is=T.useRef(kr),w=T.useRef(on),O=T.useRef(jn),J=T.useRef(Kn),Q=T.useRef(Ta),ne=T.useRef(Jn),ue=T.useRef(ar),ye=T.useRef(ma),oe=T.useRef(Pn),_e=T.useRef(Ue.bpm),De=T.useRef(qe),ze=T.useRef(gt),ke=T.useRef(_),ot=T.useRef(_n);T.useEffect(()=>{ue.current=ar},[ar]),T.useEffect(()=>{ye.current=ma},[ma]),T.useEffect(()=>{oe.current=Pn},[Pn]),T.useEffect(()=>{_e.current=Ue.bpm},[Ue.bpm]),T.useEffect(()=>{De.current=qe},[qe]),T.useEffect(()=>{ze.current=gt},[gt]),T.useEffect(()=>{ke.current=_},[_]),T.useEffect(()=>{ot.current=_n},[_n]);const Tt=T.useRef(oa);T.useEffect(()=>{Tt.current=oa},[oa]);const cn=T.useRef(pn),ea=T.useRef(Ga),Xa=T.useRef([]),ua=T.useRef(dn),Rt=T.useRef(es),Ra=T.useRef(At),un=T.useRef(gr),fa=T.useRef(ns),Ls=T.useRef({}),ya=T.useRef(new Map),da=T.useRef(new Map),yr=T.useRef(new Map),ta=T.useRef(null),Xn=T.useRef({}),Sn=T.useRef(null),On=T.useRef(0),vr=T.useRef(0),ka=T.useRef(new Map),_r=T.useRef(new Map);T.useRef(performance.now()),T.useEffect(()=>{if(Na.current){Na.current=!1;return}Ye&&(it.current=structuredClone(Ye))},[Ye]),T.useEffect(()=>{if(Nn.current){Nn.current=!1;return}pn&&(Vn.current=structuredClone(pn))},[pn]),T.useEffect(()=>{Va.current=Fn,Is.current=kr,w.current=on,O.current=jn,J.current=Kn,Q.current=Ta,ne.current=Jn,Tt.current=oa,ea.current=Ga,Xa.current=ca,Pt.current=Ye,ua.current=dn,Rt.current=es,Ra.current=At,un.current=gr,fa.current=ns},[Fn,es,kr,on,jn,Kn,Ta,Jn,pn,Ga,ca,Ye,dn,At,gr,ns]);const Rc=T.useCallback(j=>{const L=1-j*2,$=[],B=100;for(let re=0;re<B;re++){const xe=re/(B-1)*2-1;$.push({x:xe,y:L,r:0,g:255,b:0,blanking:!1})}return{points:$,isTypedArray:!1}},[]),Us=T.useCallback((j,L)=>{Vn.current&&(Vn.current[j]=L,Nn.current=!0),le({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:j,settings:L}})},[]),oi=T.useCallback(j=>{le({type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:j}})},[]);T.useEffect(()=>{const j=oa/60;S(j)},[oa,S]);const mn=j=>{le({type:"SET_NOTIFICATION",payload:{message:j,visible:!0}}),setTimeout(()=>{le({type:"SET_NOTIFICATION",payload:{message:"",visible:!1}})},3e3)};T.useEffect(()=>{const j={orange:"#ff5e00",yellow:"#ffd400",cyan:"#00fff3","light-blue":"#0089ff",blue:"#005aff",magenta:"#fb00ff",red:"#ff0000",green:"#00ff00",white:"#ffffff"},L=j[ga]||j.orange;document.documentElement.style.setProperty("--theme-color",L);const $=parseInt(L.slice(1,3),16),B=parseInt(L.slice(3,5),16),re=parseInt(L.slice(5,7),16);document.documentElement.style.setProperty("--theme-color-transparent",`rgba(${$}, ${B}, ${re}, 0.3)`),window.electronAPI&&window.electronAPI.setTheme&&window.electronAPI.setTheme(ga)},[ga]),T.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedDac&&window.electronAPI.setSelectedDac(Pn)},[Pn]),T.useMemo(()=>{const j=new Set;return gr&&j.add(gr),ca.forEach(L=>{L&&L.type==="ilda"&&L.workerId&&j.add(L.workerId)}),Array.from(j)},[gr,ca]),T.useEffect(()=>{if(!a)return;const j=async Ee=>{if(!Ee.data.browserFile){if(Ee.data.type==="get-frame"&&Ee.data.success)if(Ee.data.isStillFrame){const{workerId:et,frame:Be,layerIndex:Ge,colIndex:Xe}=Ee.data;if(Ge===void 0||Xe===void 0)return;let Fe=null;const dt=(it.current?it.current:Pt.current)?.[Ge]?.[Xe],$e=dt?.effects||[];let Ke=null;const ht=dt?.assignedDacs||[];if(ht.length>0){const Ot=ht[0],Vt=`${Ot.ip}:${Ot.channel}`;Ke=cn.current[Vt]}else if(Pn){const Ot=`${Pn.ip}:${Pn.channel}`;Ke=cn.current[Ot]}let Dt=Be;Ke&&(Dt=qf(Be,Ke)),Fe=await Gf(Dt,$e,Ge,Xe,_n),le({type:"SET_CLIP_CONTENT",payload:{layerIndex:Ge,colIndex:Xe,content:{stillFrame:Be,parsing:!1,thumbnailPath:Fe,thumbnailVersion:Date.now()}}})}else M.current[Ee.data.workerId]=Ee.data.frame;else if(Ee.data.type==="parse-ilda"&&Ee.data.success){const{workerId:et,totalFrames:Be,ildaFormat:Ge,fileName:Xe,filePath:Fe,layerIndex:Je,colIndex:dt}=Ee.data;if(Je===void 0||dt===void 0)return;const $e={type:"ilda",workerId:et,totalFrames:Be,ildaFormat:Ge,fileName:Xe,filePath:Fe,parsing:!0,playbackSettings:{mode:"fps",duration:Be/60,beats:8,speedMultiplier:1}};le({type:"SET_CLIP_CONTENT",payload:{layerIndex:Je,colIndex:dt,content:$e}});const Ke=Ra.current[Je][dt],ht=`Clip ${Je+1}-${dt+1}`;Ke===ht&&le({type:"SET_CLIP_NAME",payload:{layerIndex:Je,colIndex:dt,name:Xe}})}else if(Ee.data.type==="get-all-frames"&&Ee.data.success){console.log("Received get-all-frames response:",Ee.data);const{frames:et,workerId:Be,layerIndex:Ge,colIndex:Xe}=Ee.data;if(Ge===void 0||Xe===void 0)return;U0(async()=>{const{framesToIlda:Fe}=await Promise.resolve().then(()=>Z0);return{framesToIlda:Fe}},void 0,import.meta.url).then(({framesToIlda:Fe})=>{const Je=Fe(et),$e=Pt.current[Ge][Xe].fileName||"export.ild";window.electronAPI&&window.electronAPI.saveIldaFile&&window.electronAPI.saveIldaFile(Je,$e).then(Ke=>{Ke.success?mn(`Exported to ${Ke.filePath}`):Ke.error&&mn(`Export failed: ${Ke.error}`)})}).catch(Fe=>console.error("Failed to load ilda-writer in response:",Fe))}else if(Ee.data.success===!1){mn(`Worker error: ${Ee.data.error}`);const{layerIndex:et,colIndex:Be}=Ee.data;et!==void 0&&Be!==void 0&&le({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:et,colIndex:Be,status:!1}})}}};a.addEventListener("message",j);let L,$,B=0;const re=60,xe=1e3/re,ge=Ee=>{if(Ee.length===0)return null;if(Ee.length===1){const Xe=Ee[0],Fe=Xe.points instanceof Float32Array||Xe.isTypedArray;return{...Xe,points:Fe?new Float32Array(Xe.points):Xe.points.map(Je=>({...Je})),isTypedArray:Fe}}let et=0;Ee.forEach((Xe,Fe)=>{const dt=Xe.points instanceof Float32Array||Xe.isTypedArray?Xe.points.length/8:Xe.points.length;et+=dt,Fe<Ee.length-1&&(et+=2)});const Be=new Float32Array(et*8);let Ge=0;return Ee.forEach((Xe,Fe)=>{const Je=Xe.points instanceof Float32Array||Xe.isTypedArray,dt=Je?Xe.points.length/8:Xe.points.length;for(let $e=0;$e<dt;$e++){const Ke=(Ge+$e)*8;if(Je){const ht=$e*8;Be.set(Xe.points.subarray(ht,ht+8),Ke)}else{const ht=Xe.points[$e];Be[Ke]=ht.x,Be[Ke+1]=ht.y,Be[Ke+2]=ht.z||0,Be[Ke+3]=ht.r,Be[Ke+4]=ht.g,Be[Ke+5]=ht.b,Be[Ke+6]=ht.blanking?1:0,Be[Ke+7]=ht.lastPoint?1:0}Be[Ke+7]=0}if(Ge+=dt,Fe<Ee.length-1){const $e=Ee[Fe+1],Ke=$e.points instanceof Float32Array||$e.isTypedArray,ht=Be[(Ge-1)*8],Dt=Be[(Ge-1)*8+1];let Ot,Vt;Ke?(Ot=$e.points[0],Vt=$e.points[1]):(Ot=$e.points[0].x,Vt=$e.points[0].y);let Xt=Ge*8;Be[Xt]=ht,Be[Xt+1]=Dt,Be[Xt+6]=1,Be[Xt+3]=0,Be[Xt+4]=0,Be[Xt+5]=0;let St=(Ge+1)*8;Be[St]=Ot,Be[St+1]=Vt,Be[St+6]=1,Be[St+3]=0,Be[St+4]=0,Be[St+5]=0,Ge+=2}}),Be[(et-1)*8+7]=1,{points:Be,isTypedArray:!0}},Le=Ee=>{if(!ye.current){cancelAnimationFrame($);return}if(Ee-B>xe){if(window.electronAPI&&ye.current){const et=new Map;Xa.current.forEach(Ge=>{if(Ge&&M.current[Ge.workerId]){const Xe=Rt.current[Ge.layerIndex]||[],Fe=Ge.assignedDacs||[];let Je=[...Xe,...Fe];Je.length===0&&oe.current&&(Je=[oe.current]);const dt=[],$e=new Set;if(Je.forEach(yt=>{const ba=yt.channel!==void 0?yt.channel:yt.channels&&yt.channels.length>0?yt.channels[0].serviceID:0,$n=`${yt.ip}:${ba}`;$e.has($n)||($e.add($n),dt.push({...yt,channel:ba}))}),dt.length===0)return;const ht=(it.current||Pt.current)[Ge.layerIndex][ua.current[Ge.layerIndex]],Dt=ht?ht.effects||[]:Ge.effects||[],Ot=Ge.layerIndex,Vt=w.current[Ot]||[],Xt=[...Dt,...Vt],St=M.current[Ge.workerId],Ps=Va.current[Ge.layerIndex],ra=ne.current,an=J.current[Ge.layerIndex],$t=Q.current[Ge.layerIndex],Bt=Q.current.some(yt=>yt);let In=Ps;ra?In=0:Bt?$t?an&&(In=0):In=0:an&&(In=0);const Qt=In*O.current;if(Qt<=0)return;const kt=D.current[Ge.workerId]||0;Ge.syncSettings;const Wt={...St,points:Pe(St.points)?St.points:St.points.map(yt=>({...yt,r:Math.round(yt.r*Qt),g:Math.round(yt.g*Qt),b:Math.round(yt.b*Qt)}))};if(Pe(Wt.points)){const yt=Wt.points,ba=yt.length/8,$n=new Float32Array(yt);for(let xa=0;xa<ba;xa++)$n[xa*8+3]*=Qt,$n[xa*8+4]*=Qt,$n[xa*8+5]*=Qt;Wt.points=$n}const En=ht?ht.playbackSettings:Ge.playbackSettings||{};let Br=1;if(En.mode==="timeline")Br=En.duration||1;else if(En.mode==="bpm"){const yt=_e.current||120;Br=(En.beats||8)*60/yt}else{const yt=En.fps||Ge.fps||Tt.current||30;Br=(Ge.totalFrames||30)/yt}const Za=En.speedMultiplier||1;Za!==0&&(Br/=Za);const wn=Xl(Wt,Xt,{progress:kt,time:Ee,effectStates:N.current,assignedDacs:dt,syncSettings:Ge.syncSettings||{},bpm:_e.current,clipDuration:Br,fftLevels:c?c():o});if(ot.current){const yt=id(wn.points);wn.points=yt,wn.isTypedArray=!0}dt.forEach((yt,ba)=>{const $n=yt.ip,xa=yt.channel||(yt.channels&&yt.channels.length>0?yt.channels[0].serviceID:0);if(xa!==void 0){const di=`${$n}:${xa}`;et.has(di)||et.set(di,{ip:$n,channel:xa,type:yt.type,frames:[]});let xr=wn;if(wn.points&&wn.points._channelDistributions){const sr=wn.points._channelDistributions.get(ba);if(sr){const zs=wn.points.subarray(sr.start,sr.start+sr.length);xr={...wn,points:zs}}else xr={...wn,points:new Float32Array(0)}}if(yt.mirrorX||yt.mirrorY){const sr=xr.points,zs=xr.isTypedArray,Lc=zs?sr.length/8:sr.length,ir=zs?new Float32Array(sr):sr.map(Sa=>({...Sa}));for(let Sa=0;Sa<Lc;Sa++)zs?(yt.mirrorX&&(ir[Sa*8]=-ir[Sa*8]),yt.mirrorY&&(ir[Sa*8+1]=-ir[Sa*8+1])):(yt.mirrorX&&(ir[Sa].x=-ir[Sa].x),yt.mirrorY&&(ir[Sa].y=-ir[Sa].y));xr={...xr,points:ir}}et.get(di).frames.push(xr)}})}}),ea.current.forEach(Ge=>{(Ge.channels&&Ge.channels.length>0?Ge.channels.map(Fe=>Fe.serviceID):[0]).forEach(Fe=>{const Je=`${Ge.ip}:${Fe}`,dt=Vn.current?Vn.current[Je]:cn.current[Je];if(dt){et.has(Je)||et.set(Je,{ip:Ge.ip,channel:Fe,type:Ge.type,frames:[]});const $e=et.get(Je);if(dt.testLineEnabled){const Ke=Rc(dt.testLineY!==void 0?dt.testLineY:.5);$e.frames=[Ke]}}})});let Be=0;et.forEach(Ge=>{let Xe=ge(Ge.frames);const Fe=`${Ge.ip}:${Ge.channel}`,Je=Vn.current?Vn.current[Fe]:cn.current[Fe];if(Xe&&Je){if(Je.dimmer!==void 0&&Je.dimmer<1){const dt=Je.dimmer,$e=Xe.points,Ke=Xe.isTypedArray,ht=Ke?$e.length/8:$e.length;for(let Dt=0;Dt<ht;Dt++)Ke?($e[Dt*8+3]*=dt,$e[Dt*8+4]*=dt,$e[Dt*8+5]*=dt):($e[Dt].r*=dt,$e[Dt].g*=dt,$e[Dt].b*=dt)}Xe=qf(Xe,Je,!1)}if(Xe){Be++;const dt=Pe(Xe.points)?Xe.points.length/8:Xe.points.length;Re.current+=dt,window.electronAPI.sendFrame(Ge.ip,Ge.channel,Xe.points,re,Ge.type,{skipOptimization:ot.current})}}),wt.current=Be}B=Ee}$=requestAnimationFrame(Le)};function Pe(Ee){return!!Ee&&(Ee instanceof Float32Array||Ee.buffer instanceof ArrayBuffer)}const st=Ee=>{const et=1e3/Tt.current,Be=_e.current||120,Ge=(Fe,Je,dt,$e)=>{G.current[$e]||(G.current[$e]=Ee);let Ke=Ee-G.current[$e];Ke>1e3&&(Ke=et),ue.current&&(Xn.current[$e]===void 0&&(Xn.current[$e]=0),Xn.current[$e]+=Ke);const ht=Xn.current[$e]||0,Dt=ua.current[Je]!==null?ke.current(Je):null;let Ot=P.current[$e]||0,Vt=0;const Xt=Fe.totalFrames||1,St=Fe.playbackSettings||{mode:"fps",duration:Xt/60,beats:8,speedMultiplier:1};if(Dt&&ue.current&&!Dt.paused)Vt=Dt.duration>0?Dt.currentTime/Dt.duration:0,Ot=Math.floor(Vt*Xt);else if(St.mode==="timeline"){const $t=St.duration*1e3/(St.speedMultiplier||1);$t>0&&(Vt=ht/$t%1,Ot=Math.floor(Vt*Xt))}else if(St.mode==="bpm"){const $t=6e4/Be,Bt=St.beats*$t/(St.speedMultiplier||1);Bt>0&&(Vt=ht/Bt%1,Ot=Math.floor(Vt*Xt))}else{const Bt=1e3/((St.fps||60)*(St.speedMultiplier||1));if(Ke>=Bt){const In=Math.floor(Ke/Bt);ue.current?(G.current[$e]=Ee-Ke%Bt,Ot=Ot+In):G.current[$e]=Ee,Vt=Xt>0?Ot%Xt/Xt:0}else return}St.mode!=="fps"&&(G.current[$e]=Ee),isNaN(Ot)&&(Ot=0),isNaN(Vt)&&(Vt=0);const ra=(Ls.current[$e]||0)>.9&&Vt<.1;if(Ls.current[$e]=Vt,D.current[$e]=Vt,Xt>0&&(Ot=Ot%Xt,Ot<0&&(Ot+=Xt)),ra&&ue.current){const $t=Is.current[Je];if($t&&$t!=="off"){const Bt=Pt.current[Je],In=ua.current[Je];let Qt=-1;if($t==="forward")for(let kt=1;kt<Bt.length;kt++){const Wt=(In+kt)%Bt.length,En=Bt[Wt];if(En&&(En.type==="ilda"||En.type==="generator")){Qt=Wt;break}}else if($t==="random"){const kt=Bt.map((Wt,En)=>Wt&&(Wt.type==="ilda"||Wt.type==="generator")?En:-1).filter(Wt=>Wt!==-1);if(kt.length>0){const Wt=Math.floor(Math.random()*kt.length);Qt=kt[Wt],Qt===In&&kt.length>1&&(Qt=kt[(Wt+1)%kt.length])}}Qt!==-1&&Qt!==In&&setTimeout(()=>{br(Je,Qt)},0)}}let an=1;if(St.mode==="timeline"?an=St.duration||1:St.mode==="bpm"?an=(St.beats||8)*60/Be:Fe.type==="generator"&&(!Fe.frames||Fe.frames.length<=1)?an=St.duration||1:an=Xt/(St.fps||60),Fe.type==="generator"){const $t=Fe.syncSettings||{},Bt=Fe.generatorDefinition?.id,In=Fe.generatorDefinition,Qt=Object.keys($t).filter(kt=>kt.startsWith(`${Bt}.`));if(Qt.length>0){const kt=Fe.currentParams||{},Wt={...kt};let En=!1;const Br={time:Ee,progress:Vt,bpm:Be,clipDuration:an,fftLevels:c?c():o,activationTime:k.current[Je]||0};for(const Za of Qt){const wn=Za.split(".")[1],yt=In?.paramControls?.find(xa=>xa.id===wn),ba=kt[wn]!==void 0?kt[wn]:Fe.generatorDefinition.defaultParams[wn],$n=bc(wn,ba,$t[Za],Br,yt?.min,yt?.max);$n!==Wt[wn]&&(Wt[wn]=$n,En=!0)}if(En){const Za=++On.current;$a(Je,dt,Fe.generatorDefinition,Wt,Za,!0)}}}(P.current[$e]!==Ot||!M.current[$e])&&(P.current[$e]=Ot,Fe.type==="ilda"?a.postMessage({type:"get-frame",workerId:$e,frameIndex:Ot}):Fe.type==="generator"&&(Fe.frames&&Fe.frames.length>1?Fe.frames[Ot%Fe.frames.length]&&(M.current[$e]=Fe.frames[Ot%Fe.frames.length]):!M.current[$e]&&Fe.frames&&Fe.frames.length>0&&(M.current[$e]=Fe.frames[0])))};mt.forEach((Fe,Je)=>{const dt=ua.current[Je];if(dt===null)return;const Ke=(it.current||Pt.current)[Je][dt];if(!Ke)return;let ht=Ke.type==="ilda"?Ke.workerId:Ke.type==="generator"?`generator-${Je}-${dt}`:null;ht&&Ge(Ke,Je,dt,ht)});const Xe=un.current;if(Xe&&!Xa.current.some(Fe=>Fe.workerId===Xe)){const Fe=De.current,Je=ze.current;if(Fe!==null&&Je!==null){const $e=(it.current||Pt.current)[Fe][Je];$e&&Ge($e,Fe,Je,Xe)}}if(Sn.current){const{layerIndex:Fe,colIndex:Je}=Sn.current,dt=ua.current[Fe]===Je;De.current===Fe&&ze.current;const $e=un.current;if(!dt){const ht=(it.current||Pt.current)[Fe]?.[Je];if(ht){let Dt=ht.type==="ilda"?ht.workerId:ht.type==="generator"?`generator-${Fe}-${Je}`:null;Dt&&Dt!==$e&&Ge(ht,Fe,Je,Dt)}}}L=requestAnimationFrame(st)};return L=requestAnimationFrame(st),ma?$=requestAnimationFrame(Le):cancelAnimationFrame($),()=>{a.removeEventListener("message",j),cancelAnimationFrame(L),cancelAnimationFrame($)}},[a,ma]),T.useEffect(()=>{let j,L,$;return window.electronAPI&&(j=window.electronAPI.onClipContextMenuCommand((B,re,xe)=>{if(console.log(`Clip context menu command received: ${B} for ${re}-${xe}`),B==="export-ilda"){const ge=Pt.current[re][xe];console.log("Exporting clip:",ge),ge&&(ge.type==="ilda"&&ge.workerId&&a?(mn("Preparing ILDA export..."),console.log("Requesting frames from worker:",ge.workerId),a.postMessage({type:"get-all-frames",workerId:ge.workerId,layerIndex:re,colIndex:xe})):ge.type==="generator"?(console.log("Exporting generator frames with parameter animation..."),(async()=>{const{framesToIlda:Pe}=await U0(async()=>{const{framesToIlda:Ke}=await Promise.resolve().then(()=>Z0);return{framesToIlda:Ke}},void 0,import.meta.url),st=oa||60;let Ee=2;const et=ge.playbackSettings||{};et.mode==="timeline"?Ee=et.duration||2:et.mode==="bpm"?Ee=(et.beats||8)*60/(Ue.bpm||120):ge.frames?.length>1&&(Ee=ge.frames.length/st);const Be=Math.ceil(Ee*st),Ge=[],Xe=new Map,Fe=ge.generatorDefinition?.id;let Je=null;if(["text","spout-receiver"].includes(Fe)){const Ke=ge.currentParams?.fontUrl||"src/fonts/Geometr415 Blk BT Black.ttf";try{Ke.startsWith("http")?Je=await window.electronAPI.fetchUrlAsArrayBuffer(Ke):Je=await window.electronAPI.readFileForWorker(Ke)}catch(ht){console.error("Failed to load font for export:",ht)}}for(let Ke=0;Ke<Be;Ke++){const ht=Ke*(1e3/st),Dt=Ke/Be,Ot=ge.syncSettings||{},Vt=ge.generatorDefinition,Xt=ge.currentParams||{},St={...Xt},Ps={time:ht,progress:Dt,bpm:Ue.bpm,clipDuration:Ee,fftLevels:{low:0,mid:0,high:0},activationTime:0};for(const an in Ot)if(an.startsWith(`${Fe}.`)){const $t=an.split(".")[1],Bt=Vt?.paramControls?.find(Qt=>Qt.id===$t),In=Xt[$t]!==void 0?Xt[$t]:Vt.defaultParams[$t];St[$t]=bc($t,In,Ot[an],Ps,Bt?.min,Bt?.max)}let ra=null;try{if(Fe==="circle")ra=yE(St);else if(Fe==="square")ra=vE(St);else if(Fe==="line")ra=bE(St);else if(Fe==="star")ra=xE(St);else if(Fe==="text")ra=await Lm(St,Je);else if(Fe==="spout-receiver")ra=await Lm({...St,text:St.sourceName},Je);else if(ge.frames){const an=Math.floor(Dt*ge.frames.length)%ge.frames.length;ra=ge.frames[an]}}catch(an){console.error("Generation failed during export:",an)}if(ra){const an=(ge.effects||[]).filter(kt=>!((kt.id==="delay"||kt.id==="chase")&&kt.params?.mode==="channel")),$t=Xl(ra,an,{time:ht,progress:Dt,effectStates:Xe,syncSettings:ge.syncSettings||{},bpm:Ue.bpm,clipDuration:Ee,assignedDacs:ge.assignedDacs||[]}),Bt=$t.points,In=Bt.length/8,Qt=[];for(let kt=0;kt<In;kt++)Qt.push({x:Bt[kt*8],y:Bt[kt*8+1],z:Bt[kt*8+2],r:Bt[kt*8+3],g:Bt[kt*8+4],b:Bt[kt*8+5],blanking:Bt[kt*8+6]>.5,lastPoint:Bt[kt*8+7]>.5});Ge.push({...$t,points:Qt,frameName:`Frame ${Ke}`,companyName:"TrueLazer"})}}const dt=Pe(Ge),$e=`${ge.generatorDefinition?.name||"generator"}_export.ild`;if(window.electronAPI&&window.electronAPI.saveIldaFile){const Ke=await window.electronAPI.saveIldaFile(dt,$e);Ke.success?mn(`Exported to ${Ke.filePath}`):Ke.error&&mn(`Export failed: ${Ke.error}`)}})().catch(Pe=>console.error("Failed to export generator:",Pe))):(console.warn("Clip type not supported for export or missing data:",ge.type,ge),ge.type==="ilda"&&!ge.workerId?mn("Clip data not loaded. Please play the clip to load it."):ge.type==="generator"&&!ge.frames&&mn("Generator not rendered yet.")))}else if(B==="update-thumbnail"){const ge=Ye[re][xe];if(ge){if(ge.type==="ilda"&&ge.workerId&&a){const Le=P.current[ge.workerId]||0;a.postMessage({type:"get-frame",workerId:ge.workerId,frameIndex:Le,isStillFrame:!0,layerIndex:re,colIndex:xe})}else if(ge.type==="generator"&&ge.generatorDefinition){const Le=P.current[`generator-${re}-${xe}`]||0,Pe=ge.frames?.[Le%ge.frames.length];if(Pe){const st=ge.effects||[];Gf(Pe,st,re,xe,_n).then(Ee=>{le({type:"SET_CLIP_CONTENT",payload:{layerIndex:re,colIndex:xe,content:{stillFrame:Pe,thumbnailPath:Ee,thumbnailVersion:Date.now()}}})})}}}}else if(B==="clear-clip")le({type:"CLEAR_CLIP",payload:{layerIndex:re,colIndex:xe}});else if(B==="rename-clip"){const ge=Ra.current[re][xe];bt({title:"Rename Clip",initialValue:ge,onSave:Le=>le({type:"SET_CLIP_NAME",payload:{layerIndex:re,colIndex:xe,name:Le}})}),ee(!0)}else if(B==="copy-clip"){const ge={content:Pt.current[re][xe],name:Ra.current[re][xe]};le({type:"SET_CLIPBOARD",payload:ge}),mn("Clip copied.")}else if(B==="cut-clip"){const ge={content:Pt.current[re][xe],name:Ra.current[re][xe]};le({type:"SET_CLIPBOARD",payload:ge}),le({type:"CLEAR_CLIP",payload:{layerIndex:re,colIndex:xe}}),mn("Clip cut.")}else if(B==="paste-clip")if(Ue.clipClipboard){const{content:ge,name:Le}=Ue.clipClipboard;let Pe=JSON.parse(JSON.stringify(ge));if(Pe.type==="ilda"&&(Pe.workerId=null),Pe.effects&&Pe.effects.length>0){const Ee={...Pe.syncSettings||{}};Pe.effects=Pe.effects.map(et=>{const Be=et.instanceId,Ge=ql();return Object.keys(Ee).forEach(Xe=>{if(Be&&Xe.startsWith(`${Be}.`)){const Fe=Xe.substring(Be.length);Ee[`${Ge}${Fe}`]=Ee[Xe],delete Ee[Xe]}}),{...et,instanceId:Ge}}),Pe.syncSettings=Ee}le({type:"SET_CLIP_CONTENT",payload:{layerIndex:re,colIndex:xe,content:Pe}}),le({type:"SET_CLIP_NAME",payload:{layerIndex:re,colIndex:xe,name:Le}}),mn("Clip pasted."),setTimeout(()=>{const st=Pe;if(st.type==="generator"&&st.generatorDefinition){const Ee=`${re}-${xe}`,et={...st.generatorDefinition.defaultParams,...st.currentParams};ya.current.set(Ee,JSON.stringify(et));const Be=++On.current;$a(re,xe,st.generatorDefinition,st.currentParams,Be)}},100)}else mn("Clipboard is empty.");else B==="set-trigger-style-normal"?le({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:xe,style:"normal"}}):B==="set-trigger-style-toggle"?le({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:xe,style:"toggle"}}):B==="set-trigger-style-flash"&&le({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:re,colIndex:xe,style:"flash"}})}),L=window.electronAPI.onLayerFullContextMenuCommand((B,re)=>{if(console.log(`Layer context menu command received: ${B} for ${re}`),B==="layer-rename"){const xe=mt[re];bt({title:"Rename Layer",initialValue:xe,onSave:ge=>le({type:"SET_LAYER_NAME",payload:{index:re,name:ge}})}),ee(!0)}else B==="layer-clear-clips"&&le({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:re}})}),$=window.electronAPI.onContextMenuActionFromMain(B=>{if(console.log("General context menu action received:",B),B.type==="rename-column"){const re=qt[B.index];bt({title:"Rename Column",initialValue:re,onSave:xe=>le({type:"SET_COLUMN_NAME",payload:{index:B.index,name:xe}})}),ee(!0)}else if(B.type==="rename-layer"){const re=mt[B.index];bt({title:"Rename Layer",initialValue:re,onSave:xe=>le({type:"SET_LAYER_NAME",payload:{index:B.index,name:xe}})}),ee(!0)}else if(B.type==="reset-quick-assign"){const re=B.controlType==="knob"?0:!1;le({type:"UPDATE_QUICK_CONTROL",payload:{type:B.controlType,index:B.index,value:re}})}else B.type==="clear-quick-assign"&&le({type:"CLEAR_QUICK_CONTROL",payload:{type:B.controlType,index:B.index}})})),()=>{j&&j(),L&&L(),$&&$()}},[Ye,At,mt,qt,a,r,Ue.clipClipboard]);const Or=T.useRef(Bn);T.useEffect(()=>{for(let j=0;j<mt.length;j++)for(let L=0;L<qt.length;L++){const $=Bn[j][L],B=Or.current[j][L],re=Ye[j][L],xe=re?.workerId,ge=da.current.get(`${j}-${L}`),Le=$!==B;(Le||xe&&!ge)&&re&&re.type==="ilda"&&xe&&(console.log(`[App.jsx] Fetching still frame for ${j}-${L} at index ${$}. Reason: ${Le?"index change":"worker ready"}`),a.postMessage({type:"get-frame",workerId:xe,frameIndex:$,isStillFrame:!0,layerIndex:j,colIndex:L})),xe?da.current.set(`${j}-${L}`,xe):da.current.delete(`${j}-${L}`)}Or.current=Bn},[Bn,Ye,mt.length,qt.length,a]),T.useEffect(()=>{r&&Ye.forEach((j,L)=>{j.forEach(($,B)=>{if($&&$.type==="generator"&&$.generatorDefinition){if($.generatorDefinition.id==="ndi-source")return;const re=`${L}-${B}`,xe={...$.generatorDefinition.defaultParams,...$.currentParams||{}},ge=JSON.stringify(xe);if(ya.current.get(re)!==ge){console.log(`[App.jsx] Generator ${re} params changed, regenerating...`);const Le=++On.current;$a(L,B,$.generatorDefinition,$.currentParams,Le),ya.current.set(re,ge)}}})})},[Ye,r]),T.useEffect(()=>{if(!Ue.projectLoadTimestamp||!a||!r)return;console.log("Project loaded, regenerating content...");const j=[];Ye.forEach((L,$)=>{L.forEach((B,re)=>{if(B){if(B.type==="ilda"&&B.filePath&&!B.workerId)console.log(`Reparsing ILDA file for clip ${$}-${re}: ${B.filePath}`),a.postMessage({type:"load-and-parse-ilda",fileName:B.fileName,filePath:B.filePath,layerIndex:$,colIndex:re});else if(B.type==="generator"&&B.generatorDefinition){console.log(`Regenerating generator clip ${$}-${re} on project load`);const xe=++On.current;$a($,re,B.generatorDefinition,B.currentParams,xe)}B.audioFile&&B.audioFile.path&&window.electronAPI&&window.electronAPI.checkFileExists&&j.push(window.electronAPI.checkFileExists(B.audioFile.path).then(xe=>{xe||Ie(ge=>{const Le=`audio-${$}-${re}`;return ge.some(Pe=>Pe.requestId===Le)?ge:[...ge,{filePath:B.audioFile.path,fileName:B.audioFile.name||B.audioFile.path.split(/[/\\]/).pop(),requestId:Le,type:"audio"}]})}))}})})},[Ue.projectLoadTimestamp,a,r]),T.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onUpdateThumbnailRenderMode){const j=window.electronAPI.onUpdateThumbnailRenderMode(L=>{console.log("App.jsx: Received thumbnail mode update:",L),le({type:"SET_THUMBNAIL_RENDER_MODE",payload:L})});return()=>j()}},[]);const Da=T.useRef(Ue);T.useEffect(()=>{Da.current=Ue},[Ue]),T.useEffect(()=>{let j,L,$,B,re;return window.electronAPI&&(j=window.electronAPI.on("new-project",()=>le({type:"RESET_STATE"})),L=window.electronAPI.on("open-project",()=>{}),$=window.electronAPI.on("save-project",()=>{console.log("Saving project with state:",Da.current),window.electronAPI.send("save-project",Da.current)}),B=window.electronAPI.on("save-project-as",()=>{console.log("Saving project AS with state:",Da.current),window.electronAPI.send("save-project-as",Da.current)}),re=window.electronAPI.on("load-project-data",xe=>{le({type:"LOAD_PROJECT",payload:xe})})),()=>{j&&j(),L&&L(),$&&$(),B&&B(),re&&re()}},[]),T.useEffect(()=>{let j,L;return(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const B=await window.electronAPI.getAllSettings();B&&(B.shortcutsState&&be(B.shortcutsState),le({type:"LOAD_SETTINGS",payload:B}))}})(),window.electronAPI&&(j=window.electronAPI.onMenuAction(B=>{if(console.log("Menu action received:",B),B==="output-settings")Me(!0);else if(B==="shapeBuilder")W("shapeBuilder"),le({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(B==="timeline")W("timeline"),le({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(B==="about")K(!0);else if(B==="settings-audio-output")Ce(!0);else if(B==="settings-audio-fft")at(!0);else if(B.startsWith("set-theme-")){const re=B.split("set-theme-")[1];le({type:"SET_THEME",payload:re})}else if(B==="shortcuts-window"||B.startsWith("open-")&&B.endsWith("-settings"))z(!0);else if(B==="column-duplicate")gt!==null&&(le({type:"DUPLICATE_COLUMN",payload:{index:gt}}),mn("Column duplicated."));else if(B==="column-clear-clips")gt!==null&&mt.forEach((re,xe)=>{le({type:"CLEAR_CLIP",payload:{layerIndex:xe,colIndex:gt}})});else if(B.startsWith("toggle-")){const re=B.split("-");if(re.length===3){const xe=re[1],ge=re[2]==="true";be(Le=>({...Le,[xe]:ge}))}}}),L=window.electronAPI.onRenderSettingsCommand(B=>{console.log("Render settings command received:",B),le({type:"SET_RENDER_SETTING",payload:{setting:B.setting,value:B.value}})})),()=>{j&&j(),L&&L()}},[]),T.useEffect(()=>{if(!a)return;const j=async L=>{if(L.data.type==="request-file-content"){const{filePath:$,requestId:B,maxBytes:re}=L.data;try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists($))throw new Error(`File not found: ${$}`);const xe=await window.electronAPI.readFileForWorker($,re);a.postMessage({type:"file-content-response",requestId:B,arrayBuffer:xe},[xe])}catch(xe){console.warn(`File missing or read error: ${$}`,xe.message);const ge=$.split(/[/\\]/).pop();Ie(Le=>Le.some(Pe=>Pe.requestId===B)?Le:[...Le,{filePath:$,fileName:ge,requestId:B}])}}else if(L.data.type==="parsing-status"){const{layerIndex:$,colIndex:B,status:re}=L.data;$!==void 0&&B!==void 0&&(le({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:$,colIndex:B,status:re}}),re||le({type:"SET_CLIP_PARSING_FAILED",payload:{layerIndex:$,colIndex:B,failed:!0}}))}};return a.addEventListener("message",j),()=>{a.removeEventListener("message",j)}},[a]),T.useEffect(()=>{if(!e)return;const j=async L=>{if(L.data.type==="request-file-content"){const{filePath:$,requestId:B,maxBytes:re}=L.data;try{const xe=await window.electronAPI.readFileForWorker($,re);e.postMessage({type:"file-content-response",requestId:B,arrayBuffer:xe},[xe])}catch(xe){console.error(`Thumbnail Worker: Error reading file: ${$}`,xe),e.postMessage({type:"file-content-response",requestId:B,error:xe.message})}}};return e.addEventListener("message",j),()=>{e.removeEventListener("message",j)}},[e]),T.useEffect(()=>{if(!a)return;const j=[];Ye.forEach((L,$)=>{L.forEach((B,re)=>{B&&B.type==="ilda"&&B.filePath&&!B.workerId&&!B.parsing&&!B.parsingFailed&&j.push({layerIndex:$,colIndex:re,fileName:B.fileName,filePath:B.filePath})})}),j.length>0&&(console.log(`Triggering re-parse for ${j.length} clips.`),le({type:"SET_BULK_PARSING_STATUS",payload:j.map(L=>({layerIndex:L.layerIndex,colIndex:L.colIndex,status:!0}))}),j.forEach(L=>{a.postMessage({type:"load-and-parse-ilda",fileName:L.fileName,filePath:L.filePath,layerIndex:L.layerIndex,colIndex:L.colIndex})}))},[Ye,a]);const Zi=it.current||Ye;if(qe!==null){const j=on[qe]||[];if(gt!==null)[...Zi[qe][gt]?.effects||[],...j];else{const L=dn[qe];L!==null&&[...Zi[qe][L]?.effects||[],...j]}}const Qi=T.useCallback((j,L,$,B,re)=>{if(it.current&&it.current[j]&&it.current[j][L]){const xe=it.current[j][L];xe&&xe.effects&&xe.effects[$]&&(xe.effects[$].params[B]=re,Na.current=!0)}It(`effect-${j}-${L}-${$}-${B}`,{type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:j,colIndex:L,effectIndex:$,paramName:B,newValue:re}})},[It]);T.useEffect(()=>{if(!r)return;const j=L=>{if(!L.data.browserFile){if(L.data.layerIndex!==void 0&&L.data.colIndex!==void 0){const $=`${L.data.layerIndex}-${L.data.colIndex}`;if(ka.current.set($,!1),_r.current.has($)){const{message:B,transferables:re}=_r.current.get($);_r.current.delete($),ka.current.set($,!0),r.postMessage(B,re)}}if(L.data.success){const{layerIndex:$,colIndex:B,frames:re,generatorDefinition:xe,currentParams:ge,isLive:Le,isAutoUpdate:Pe,seq:st}=L.data;if($===void 0||B===void 0)return;if(st!==void 0){if(st<vr.current)return;vr.current=st}const Ee=`generator-${$}-${B}`;if(M.current[Ee]=re[0],!Le&&!Pe&&st===On.current){const et=Pt.current[$][B]||{},Be={...et,type:"generator",generatorDefinition:xe,frames:re,stillFrame:re[0],currentParams:ge,playbackSettings:et.playbackSettings||{mode:"fps",duration:re.length/60,beats:8,speedMultiplier:1}};le({type:"SET_CLIP_CONTENT",payload:{layerIndex:$,colIndex:B,content:Be}});const Ge=Ra.current[$][B],Xe=`Clip ${$+1}-${B+1}`;Ge===Xe&&le({type:"SET_CLIP_NAME",payload:{layerIndex:$,colIndex:B,name:xe.name}})}else window.electronAPI&&window.electronAPI.ndiSignalReady&&window.electronAPI.ndiSignalReady()}else mn(`Error generating frames: ${L.data.error}`)}};return r.addEventListener("message",j),()=>{r.removeEventListener("message",j)}},[r]);const so=T.useCallback((j,L,$)=>{if(r){const B=`${j}-${L}`,re={...$.defaultParams};ya.current.set(B,JSON.stringify(re));const xe=++On.current;$a(j,L,$,$.defaultParams,xe)}},[r]),$a=async(j,L,$,B,re,xe=!1)=>{const ge={...$.defaultParams,...B},Le=`${j}-${L}`;let Pe=null;if(["text","ndi-source","spout-receiver"].includes($.id)){const et="src/fonts/Geometr415 Blk BT Black.ttf";let Be=ge.fontUrl||et;if(["https://raw.githubusercontent.com/google/fonts/main/ofl/roboto/Roboto-Regular.ttf","https://raw.githubusercontent.com/googlefonts/roboto-2/main/src/hinted/Roboto-Regular.ttf"].includes(Be)&&(Be=et),yr.current.has(Be))Pe=yr.current.get(Be);else try{if(Be.startsWith("http"))if(window.electronAPI&&window.electronAPI.fetchUrlAsArrayBuffer)Pe=await window.electronAPI.fetchUrlAsArrayBuffer(Be);else throw new Error("URL fetching API is not available.");else if(window.electronAPI&&window.electronAPI.readFileForWorker)Pe=await window.electronAPI.readFileForWorker(Be);else throw new Error("File reading API is not available.");Pe&&yr.current.set(Be,Pe)}catch(Xe){console.error(`Failed to load font for text generator at ${j}-${L}:`,Xe),mn(`Font error: ${Xe.message}`);return}}const st={type:"generate",layerIndex:j,colIndex:L,generator:$,params:ge,fontBuffer:Pe,seq:re,isAutoUpdate:xe},Ee=[];ka.current.get(Le)?(console.log(`[App.jsx] Generator ${Le} busy, queuing seq ${re}`),_r.current.set(Le,{message:st,transferables:Ee})):(ka.current.set(Le,!0),i.current&&i.current.postMessage(st,Ee))},zn=T.useCallback(j=>{v(j),le({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:j}})},[v]),Ir=T.useCallback(()=>{C(),le({type:"CLEAR_ALL_ACTIVE_CLIPS"})},[C]),rr=T.useCallback(()=>{b(),mt.forEach((j,L)=>{const $=dn[L];if($!==null){const B=Ye[L][$];B&&B.audioFile&&!_(L)&&y(L,B.audioFile.path,B.audioVolume??1,!0)}}),le({type:"SET_IS_PLAYING",payload:!0}),le({type:"SET_IS_STOPPED",payload:!1})},[b,mt,dn,Ye,_,y]),va=T.useCallback(()=>{x(),le({type:"SET_IS_PLAYING",payload:!1}),le({type:"SET_IS_STOPPED",payload:!1})},[x]),Lr=T.useCallback(()=>{E(),x(),le({type:"SET_IS_PLAYING",payload:!1}),le({type:"SET_IS_STOPPED",payload:!0}),P.current={}},[E,x]),ss=T.useCallback(()=>{const j=!ma;le({type:"SET_WORLD_OUTPUT_ACTIVE",payload:j}),window.electronAPI&&(j?Ue.dacs.forEach(L=>{window.electronAPI.startDacOutput(L.ip,L.type)}):Ue.dacs.forEach(L=>{window.electronAPI.stopDacOutput(L.ip,L.type)}))},[ma,Ue.dacs]),is=T.useCallback((j,L)=>{le({type:"SET_SELECTED_CLIP",payload:{layerIndex:j,colIndex:L}});const $=Ye[j][L];if($&&$.type==="ilda")le({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:$.workerId,totalFrames:$.totalFrames,generatorId:null,generatorParams:{}}});else if($&&$.type==="generator"){const B=`generator-${j}-${L}`;le({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:B,generatorId:$.generatorDefinition.id,generatorParams:$.currentParams,totalFrames:$.frames.length}})}else le({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:null,totalFrames:0,generatorId:null,generatorParams:{}}})},[Ye]),ci=T.useCallback((j,L,$)=>{$?Sn.current={layerIndex:j,colIndex:L}:Sn.current&&Sn.current.layerIndex===j&&Sn.current.colIndex===L&&(Sn.current=null)},[]),br=T.useCallback((j,L,$=!0)=>{const B=Ye[j][L];if(!B){$&&(is(j,L),zn(j));return}const re=B.triggerStyle||"normal",xe=dn[j];if(re==="normal"){if(!$)return}else if(re==="toggle"){if(!$)return;if(xe===L){zn(j);return}}else if(re==="flash"&&!$){xe===L&&zn(j);return}if(B&&B.type==="generator"&&B.frames&&B.frames.length>0){const ge=`generator-${j}-${L}`;M.current[ge]=B.frames[0],G.current[ge]=performance.now(),P.current[ge]=0}else B&&B.type==="ilda"&&B.workerId&&(G.current[B.workerId]=performance.now(),P.current[B.workerId]=0);if(B&&B.audioFile?y(j,B.audioFile.path,B.audioVolume??1,ue.current).catch(ge=>{console.warn(`Failed to play audio for clip ${j}-${L}:`,ge),Ie(Le=>{const Pe=`audio-${j}-${L}`;return Le.some(st=>st.requestId===Pe)?Le:[...Le,{filePath:B.audioFile.path,fileName:B.audioFile.name||B.audioFile.path.split(/[/\\]/).pop(),requestId:Pe,type:"audio"}]})}):v(j),k.current[j]=performance.now(),le({type:"SET_ACTIVE_CLIP",payload:{layerIndex:j,colIndex:L}}),B){if(B.type==="ilda"&&B.workerId){const ge=P.current[B.workerId]||0;le({type:"UPDATE_THUMBNAIL",payload:{layerIndex:j,colIndex:L,frameIndex:ge}})}else if(B.type==="generator"&&B.frames){const ge=P.current[`generator-${j}-${L}`]||0,Le=B.frames[ge%B.frames.length];Le&&le({type:"SET_CLIP_CONTENT",payload:{layerIndex:j,colIndex:L,content:{stillFrame:Le}}})}}},[Ye,dn,zn,y,ar,v,is]),io=T.useCallback((j,L,$)=>{if(it.current&&it.current[j]&&it.current[j][L]){const B=it.current[j][L];if(B){const re={...$,instanceId:ql(),params:{...$.defaultParams}};B.effects=[...B.effects||[],re],Na.current=!0}}le({type:"ADD_CLIP_EFFECT",payload:{layerIndex:j,colIndex:L,effect:$}})},[]),na=T.useCallback((j,L)=>{const $=Yi.find(B=>(B.id||B.name)===L);$&&le({type:"ADD_LAYER_EFFECT",payload:{layerIndex:j,effect:$}})},[]),Ur=T.useCallback((j,L,$)=>{Na.current=!0,le({type:"SET_CLIP_DAC",payload:{layerIndex:j,colIndex:L,dac:$}})},[]),ui=T.useCallback((j,L)=>{le({type:"SET_LAYER_DAC",payload:{layerIndex:j,dac:L}})},[]),Bs=j=>{window.electronAPI&&window.electronAPI.showLayerFullContextMenu&&window.electronAPI.showLayerFullContextMenu(j)},kc=j=>{window.electronAPI&&window.electronAPI.showColumnContextMenu&&window.electronAPI.showColumnContextMenu(j)},Fs=j=>{mt.forEach((L,$)=>{const B=Ye[$][j];B&&(B.type==="ilda"||B.type==="generator")?br($,j):zn($)})},Wi=T.useCallback(j=>{le({type:"SET_SELECTED_DAC",payload:j})},[]),js=T.useCallback(j=>{le({type:"SET_DACS",payload:j})},[]),fi=(j,L)=>{if(qe!==null&&gt!==null){let $=null,B={};if(it.current&&it.current[qe]&&it.current[qe][gt]){const Le=it.current[qe][gt];Le&&Le.currentParams&&(Le.currentParams[j]=L,Na.current=!0,$=Le,B=Le.currentParams)}if($||($=Ye[qe][gt],$&&$.currentParams&&(B={...$.currentParams,[j]:L})),!$||!$.generatorDefinition)return;It(`generator-${qe}-${gt}-${j}`,{type:"UPDATE_GENERATOR_PARAM",payload:{layerIndex:qe,colIndex:gt,paramName:j,newValue:L}});const re=`${qe}-${gt}`,xe={...$.generatorDefinition.defaultParams,...B};ya.current.set(re,JSON.stringify(xe));const ge=++On.current;$a(qe,gt,$.generatorDefinition,B,ge,!1)}},aa=qe!==null&&gt!==null?Ye[qe][gt]:null;T.useEffect(()=>{if(!window.electronAPI||!r)return;(async()=>{let L=null;mt.forEach((B,re)=>{const xe=dn[re];if(xe!==null){const ge=Ye[re][xe];ge&&ge.type==="generator"&&ge.generatorDefinition?.id==="ndi-source"&&(L=ge)}}),!L&&aa?.type==="generator"&&aa?.generatorDefinition?.id==="ndi-source"&&(L=aa);const $=L?.currentParams?.sourceName;$&&$!=="No Source"?$!==ta.current&&(console.log(`[NDI] Switching to source: ${$}`),await window.electronAPI.ndiCreateReceiver($),ta.current=$):ta.current&&(console.log("[NDI] Destroying receiver"),await window.electronAPI.ndiDestroyReceiver(),ta.current=null)})()},[dn,Ye,aa,mt]),T.useEffect(()=>{const j=[...ca,aa].find(L=>L?.type==="generator"&&L?.generatorDefinition?.id==="ndi-source");if(j&&window.electronAPI?.ndiUpdateSettings){const{captureWidth:L,captureHeight:$}=j.currentParams||{};L&&$&&window.electronAPI.ndiUpdateSettings({width:L,height:$})}},[ca,aa]),T.useEffect(()=>{if(!window.electronAPI||!r)return;const j=window.electronAPI.onNdiFrame(L=>{ua.current.forEach(($,B)=>{if($===null)return;const re=Pt.current[B][$];re&&re.type==="generator"&&re.generatorDefinition?.id==="ndi-source"&&r.postMessage({type:"generate",layerIndex:B,colIndex:$,generator:re.generatorDefinition,params:{...re.generatorDefinition.defaultParams,...re.currentParams},ndiFrame:L,isLive:!0})}),aa?.type==="generator"&&aa?.generatorDefinition?.id==="ndi-source"&&r.postMessage({type:"generate",layerIndex:qe,colIndex:gt,generator:aa.generatorDefinition,params:{...aa.generatorDefinition.defaultParams,...aa.currentParams},ndiFrame:L,isLive:!0})});return()=>j()},[dn,Ye,aa,qe,gt,mt,r]);const lo=T.useCallback((j,L,$)=>{const B=j==="knob"?"knobs":"buttons",re=Ue.quickAssigns[B][L];if(re.link){const{layerIndex:xe,colIndex:ge,effectIndex:Le,targetType:Pe}=re.link,st=re.link.paramName||re.link.paramId;let Ee=$;if(j==="knob"&&re.min!==void 0&&re.max!==void 0&&(Ee=re.min+$*(re.max-re.min),re.step&&(Ee=Math.round(Ee/re.step)*re.step),Ee=parseFloat(Ee.toFixed(5))),Pe==="global")st==="master_intensity"?O.current=Ee:st==="master_speed"&&(Tt.current=Ee);else if(Pe==="layerEffect")w.current[xe]&&w.current[xe][Le]&&(w.current[xe][Le].params[st]=Ee);else if((Pe==="effect"||Pe==="generator")&&it.current&&it.current[xe]&&it.current[xe][ge]){const et=it.current[xe][ge];Pe==="effect"&&et.effects&&et.effects[Le]?et.effects[Le].params[st]=Ee:Pe==="generator"&&et.currentParams&&(et.currentParams[st]=Ee),Na.current=!0}}It(`quick-${j}-${L}`,{type:"UPDATE_QUICK_CONTROL",payload:{type:j,index:L,value:$}})},[Ue.quickAssigns,It]),oo=T.useCallback(j=>{const L=Ue.quickAssigns.buttons[j],$=L.link,B=!L.value;if($){const{layerIndex:re,colIndex:xe,effectIndex:ge,targetType:Le}=$,Pe=$.paramName||$.paramId;if(Le==="transport"){Pe==="play"?rr():Pe==="pause"?va():Pe==="stop"&&Lr();return}if(Le==="global"){if(Pe==="blackout")ne.current=B;else if(Pe==="laser_output"){ss();return}else if(Pe==="clear"){Ir();return}}else if(Le==="layer")Pe==="blackout"?J.current[re]=B:Pe==="solo"?(Q.current.fill(!1),Q.current[re]=B):Pe==="autopilot"&&(Is.current[re]=B?"forward":"off");else if(Le==="layerEffect")w.current[re]&&w.current[re][ge]&&(w.current[re][ge].params[Pe]=B);else if((Le==="effect"||Le==="generator")&&it.current&&it.current[re]&&it.current[re][xe]){const st=it.current[re][xe];Le==="effect"&&st.effects&&st.effects[ge]?st.effects[ge].params[Pe]=B:Le==="generator"&&st.currentParams&&(st.currentParams[Pe]=B),Na.current=!0}}le({type:"TOGGLE_QUICK_BUTTON",payload:{index:j}})},[Ue.quickAssigns,rr,va,Lr,ss,Ir]),Ki=T.useCallback((j,L,$=127,B="noteon")=>{if(L===0&&!j.endsWith("_intensity")&&j!=="master_intensity"&&j!=="master_speed"&&!j.startsWith("clip_")&&j!=="bpm_value"&&j!=="bpm_fine_up"&&j!=="bpm_fine_down"&&!j.startsWith("quick_")&&!j.startsWith("dimmer_"))return;const re=L/$;switch(j){case"transport_play":L>0&&rr();break;case"transport_pause":L>0&&va();break;case"transport_stop":L>0&&Lr();break;case"comp_blackout":L>0&&le({type:"TOGGLE_GLOBAL_BLACKOUT"});break;case"comp_clear":L>0&&Ir();break;case"master_intensity":O.current=re,It("master_intensity",{type:"SET_MASTER_INTENSITY",payload:re});break;case"master_speed":const xe=Math.max(1,Math.round(re*120));It("master_speed",{type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:xe}});break;case"laser_output":L>0&&le({type:"TOGGLE_WORLD_OUTPUT_ACTIVE"});break;case"bpm_value":if(B==="controlchange"){let ge=0;L<=10?ge=L:L>=118&&(ge=L-128),ge!==0&&le({type:"SET_BPM",payload:Math.max(1,Math.min(999,(Ue.bpm||120)+ge))})}break;case"bpm_fine_up":L>0&&le({type:"SET_BPM",payload:Math.min(999,(Ue.bpm||120)+.1)});break;case"bpm_fine_down":L>0&&le({type:"SET_BPM",payload:Math.max(1,(Ue.bpm||120)-.1)});break;case"bpm_tap":break;default:if(j.startsWith("layer_")){const ge=j.split("_"),Le=parseInt(ge[1]),Pe=ge[2];Pe==="blackout"&&L>0?le({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:Le}}):Pe==="solo"&&L>0?le({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:Le}}):Pe==="intensity"?(Va.current[Le]=re,It(`layer_${Le}_intensity`,{type:"SET_LAYER_INTENSITY",payload:{layerIndex:Le,intensity:re}})):Pe==="clear"&&L>0&&zn(Le)}else if(j.startsWith("clip_")){const ge=j.split("_"),Le=parseInt(ge[1]),Pe=parseInt(ge[2]);ge[3]==="preview"?L>0&&is(Le,Pe):br(Le,Pe,L>0)}else if(j.startsWith("column_")){const ge=j.split("_"),Le=parseInt(ge[1]);L>0&&Fs(Le)}else if(j.startsWith("quick_knob_")){const ge=parseInt(j.split("_")[2]);lo("knob",ge,re)}else if(j.startsWith("quick_btn_")){const ge=parseInt(j.split("_")[2]);L>0&&oo(ge)}else if(j.startsWith("dimmer_")){const ge=j.replace("dimmer_","").replace(/_/g,"."),Le=pn[ge]||{};le({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:ge,settings:{...Le,dimmer:re}}})}else{const ge=j.split("_");if(ge.length>=2&&qe!==null&&gt!==null){const Le=Ye[qe][gt];if(Le&&Le.effects){const Pe=ge[0],st=ge.slice(1).join("_"),Ee=Le.effects.findIndex(et=>et.id===Pe);if(Ee!==-1){const Be=Yi.find(Ge=>Ge.id===Pe)?.paramControls.find(Ge=>Ge.id===st);if(Be){let Ge=re;Be.type==="range"||Be.type==="number"?Ge=Be.min+(Be.max-Be.min)*re:Be.type==="checkbox"&&(Ge=re>.5),le({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:qe,colIndex:gt,effectIndex:Ee,paramName:st,newValue:Ge}})}}}}}}},[rr,va,Lr,Ir,zn,oi,Ue.bpm,is,br,Fs,Ye,qe,gt,pn]),Ji=T.useCallback(j=>{if(j==="world"){const $=!(Ue.worldShowBeamEffect??!0);if(le({type:"SET_RENDER_SETTING",payload:{setting:"worldShowBeamEffect",value:$}}),window.electronAPI&&window.electronAPI.setRenderSettings){const B={...Ue.renderSettings,showBeamEffect:Ue.showBeamEffect,beamRenderMode:Ue.beamRenderMode,previewScanRate:Ue.previewScanRate,beamAlpha:Ue.beamAlpha,fadeAlpha:Ue.fadeAlpha,worldShowBeamEffect:$,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(B)}}else{const L=!Ha;if(le({type:"SET_RENDER_SETTING",payload:{setting:"showBeamEffect",value:L}}),window.electronAPI&&window.electronAPI.setRenderSettings){const $={showBeamEffect:L,beamRenderMode:Mn,previewScanRate:Ya,beamAlpha:Ca,fadeAlpha:Ma,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings($)}}},[Ha,Mn,Ya,Ca,Ma,Ue.worldShowBeamEffect,Ue.worldBeamRenderMode]),Dc=T.useCallback(j=>{if(j==="world"){const L=Ue.worldBeamRenderMode??"both";let $="points";if(L==="both"?$="points":L==="points"?$="lines":L==="lines"&&($="both"),le({type:"SET_RENDER_SETTING",payload:{setting:"worldBeamRenderMode",value:$}}),window.electronAPI&&window.electronAPI.setRenderSettings){const B={showBeamEffect:Ha,beamRenderMode:Mn,previewScanRate:Ya,beamAlpha:Ca,fadeAlpha:Ma,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:$};window.electronAPI.setRenderSettings(B)}}else{let L="points";if(Mn==="both"?L="points":Mn==="points"?L="lines":Mn==="lines"&&(L="both"),le({type:"SET_RENDER_SETTING",payload:{setting:"beamRenderMode",value:L}}),window.electronAPI&&window.electronAPI.setRenderSettings){const $={showBeamEffect:Ha,beamRenderMode:L,previewScanRate:Ya,beamAlpha:Ca,fadeAlpha:Ma,worldShowBeamEffect:Ue.worldShowBeamEffect??!0,worldBeamRenderMode:Ue.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings($)}}},[Ha,Mn,Ya,Ca,Ma,Ue.worldShowBeamEffect,Ue.worldBeamRenderMode]),_c=async j=>{if(!(!window.electronAPI||!window.electronAPI.showOpenDialog))try{const L=await window.electronAPI.showOpenDialog({title:`Locate missing file: ${j.fileName}`,defaultPath:j.filePath,filters:[{name:"ILDA Files",extensions:["ild"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(L){const $=L,B=window.electronAPI.pathSeparator||($.includes("/")?"/":"\\");if(le({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:j.filePath,newPath:$}}),j.type!=="audio"){const Ee=await window.electronAPI.readFileForWorker($);a&&a.postMessage({type:"file-content-response",requestId:j.requestId,arrayBuffer:Ee},[Ee])}Ie(Ee=>Ee.filter(et=>et.requestId!==j.requestId));const re=Ee=>Ee.substring(0,Ee.lastIndexOf(B)),xe=Ee=>Ee.substring(Ee.lastIndexOf(B)+1),ge=re(j.filePath),Le=re($);console.log(`[Relocate] Scanning for other files moving from [${ge}] to [${Le}]`);const Pe=Da.current.clipContents.flat().filter(Ee=>Ee),st=new Set([j.filePath]);for(const Ee of Pe){if(Ee.type==="ilda"&&Ee.filePath&&!st.has(Ee.filePath)&&re(Ee.filePath)===ge){const et=xe(Ee.filePath),Be=`${Le}${B}${et}`;Ee.filePath!==Be&&await window.electronAPI.checkFileExists(Be)&&(console.log(`[Relocate] Auto-resolving ILDA: ${et}`),le({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:Ee.filePath,newPath:Be}}),st.add(Ee.filePath),a&&Ie(Xe=>Xe.filter(Fe=>Fe.filePath!==Ee.filePath)))}if(Ee.audioFile&&Ee.audioFile.path&&!st.has(Ee.audioFile.path)&&re(Ee.audioFile.path)===ge){const et=xe(Ee.audioFile.path),Be=`${Le}${B}${et}`;Ee.audioFile.path!==Be&&await window.electronAPI.checkFileExists(Be)&&(console.log(`[Relocate] Auto-resolving Audio: ${et}`),le({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:Ee.audioFile.path,newPath:Be}}),st.add(Ee.audioFile.path),Ie(Xe=>Xe.filter(Fe=>Fe.filePath!==Ee.audioFile.path)))}}}}catch(L){console.error("Relocation failed:",L),mn(`Relocation failed: ${L.message}`)}},Oc=T.useCallback((j,L)=>{console.log(`Thumbnail load error for ${j}-${L}, requesting regeneration...`);const $=Pt.current[j][L];if($)if($.type==="ilda"&&$.workerId&&a){const B=Bn[j][L]||0;a.postMessage({type:"get-frame",workerId:$.workerId,frameIndex:B,isStillFrame:!0,layerIndex:j,colIndex:L})}else $.type==="generator"&&$.stillFrame&&Gf($.stillFrame,$.effects,j,L,_n).then(B=>{B&&le({type:"SET_CLIP_CONTENT",payload:{layerIndex:j,colIndex:L,content:{thumbnailPath:B,thumbnailVersion:Date.now()}}})})},[Pt,Bn,a,_n]),Ic=T.useCallback((j,L)=>{const $=Pt.current[j][L];$&&$.audioFile&&Ie(B=>{const re=`audio-${j}-${L}`;return B.some(xe=>xe.requestId===re)?B:[...B,{filePath:$.audioFile.path,fileName:$.audioFile.name||$.audioFile.path.split(/[/\\]/).pop(),requestId:re,type:"audio"}]})},[Pt]);return m.jsx(Lv,{onMidiCommand:Ki,children:m.jsx(Uv,{onArtnetCommand:(j,L)=>Ki(j,L,255),children:m.jsxs(Bv,{onCommand:Ki,enabled:ie.keyboard,children:[m.jsx(AE,{isPlaying:ar,globalBlackout:Jn,layerBlackouts:Kn,layerSolos:Ta,isWorldOutputActive:ma,clipContents:Ye,activeClipIndexes:dn,theme:ga,bpm:Ue.bpm,quickAssigns:Ue.quickAssigns}),m.jsx(Q1,{}),Z==="main"?m.jsx("div",{className:"app",children:m.jsxs(F1,{children:[m.jsx(w1,{message:ts.message,visible:ts.visible}),m.jsx(H1,{show:X,onClose:()=>K(!1)}),m.jsx(L1,{show:ve,onClose:()=>Me(!1),dacs:Ga,dacSettings:pn,onUpdateDacSettings:Us}),m.jsx(U1,{show:me||Oe,onClose:()=>{Ce(!1),at(!1)},initialTab:Oe?"fft":"output"}),m.jsx(O1,{show:U,title:tt.title,initialValue:tt.initialValue,onSave:tt.onSave,onClose:()=>z(!1)||ee(!1)}),m.jsx(B1,{missingFiles:tn,onRelocate:_c,onClose:()=>Ie([])}),m.jsxs("div",{className:"main-content",children:[m.jsxs("div",{className:"top-bar-left-area",children:[m.jsx(jv,{masterIntensity:Ue.masterIntensity,onMasterIntensityChange:j=>le({type:"SET_MASTER_INTENSITY",payload:j}),onClearAllActive:Ir,isGlobalBlackout:Jn,onToggleGlobalBlackout:()=>le({type:"TOGGLE_GLOBAL_BLACKOUT"})}),m.jsx(EE,{isWorldOutputActive:ma,onToggleWorldOutput:ss})]}),m.jsxs("div",{className:"layer-controls-container",children:[mt.map((j,L)=>{const $=ca.find(re=>{const xe=dn[L];if(xe===null)return!1;const ge=Ye[L][xe];return ge?ge.type==="ilda"?re.workerId===ge.workerId:ge.type==="generator"?re.workerId===`generator-${L}-${xe}`:!1:!1})||null,B=$?M.current[$.workerId]:null;return m.jsx(i1,{layerName:j,index:L,onDropEffect:re=>na(L,re),onDropDac:(re,xe)=>ui(re,xe),layerEffects:on[L],activeClipData:$,liveFrame:B,thumbnailRenderMode:rs,intensity:Ue.layerIntensities[L],onIntensityChange:re=>le({type:"SET_LAYER_INTENSITY",payload:{layerIndex:L,intensity:re}}),onDeactivateLayerClips:()=>zn(L),onShowLayerFullContextMenu:()=>Bs(L),isBlackout:Kn[L],isSolo:Ta[L],onToggleBlackout:()=>le({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:L}}),onToggleSolo:()=>le({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:L}}),onLayerSelect:re=>le({type:"SET_SELECTED_CLIP",payload:{layerIndex:re,colIndex:null}})},L)}),"          "]}),m.jsx("div",{className:"clip-deck-container",children:m.jsxs("div",{className:"clip-deck",children:[m.jsx("div",{className:"column-headers-container",children:qt.map((j,L)=>m.jsx(Pv,{name:j,index:L,onTrigger:()=>Fs(L),onShowColumnHeaderContextMenu:()=>kc(L)},L))}),mt.map((j,L)=>m.jsx("div",{className:"layer-row",children:qt.map(($,B)=>{const re=Ye?.[L]?.[B];let xe=null;re&&re.type==="ilda"?xe=re.workerId:re&&re.type==="generator"&&(xe=`generator-${L}-${B}`);const ge=xe?M.current[xe]:null,Le=re?.stillFrame||(re?.type==="generator"?re.frames?.[0]:null);return m.jsx(o1,{layerIndex:L,colIndex:B,clipName:At?.[L]?.[B]||`Clip ${L+1}-${B+1}`,clipContent:re,thumbnailFrameIndex:Bn[L][B],thumbnailRenderMode:rs,liveFrame:ge,stillFrame:Le,onActivateClick:Pe=>br(L,B,Pe),isActive:dn[L]===B,onUnsupportedFile:mn,onDropEffect:Pe=>io(L,B,Pe),onDropGenerator:so,onDropDac:(Pe,st,Ee)=>{Ur(Pe,st,Ee)},onLabelClick:()=>is(L,B),isSelected:qe===L&&gt===B,ildaParserWorker:a,onClipHover:ci,onThumbnailError:Oc},B)})},L))]})}),m.jsx(CE,{clipContents:Ye,activeClipIndexes:dn,layerEffects:on,bpm:Ue.bpm,playbackFps:oa,selectedLayerIndex:qe,selectedColIndex:gt,liveFramesRef:M,progressRef:D,selectedDac:Pn,liveDacOutputSettingsRef:Vn,dacOutputSettings:pn,getAudioInfo:_,fftLevels:o,getFftLevels:c,effectStatesRef:N,clipActivationTimesRef:k,showBeamEffect:Ha,beamAlpha:Ca,fadeAlpha:Ma,previewScanRate:Ya,beamRenderMode:Mn,worldShowBeamEffect:bn,worldBeamRenderMode:xn,masterIntensity:jn,layerIntensities:Fn,globalBlackout:Jn,layerSolos:Ta,layerBlackouts:Kn,handleToggleBeamEffect:Ji,handleCycleDisplayMode:Dc,previewFrameCountRef:rt,totalPointsSentRef:Re,activeChannelsCountRef:wt,lastStatUpdateTimeRef:nn,liveClipContentsRef:it,optimizationEnabled:_n}),m.jsxs("div",{className:"middle-bar",children:[m.jsx("div",{className:"middle-bar-left-area",children:m.jsx(N1,{bpm:Ue.bpm,onBpmChange:j=>le({type:"SET_BPM",payload:j})})}),m.jsxs("div",{className:"middle-bar-mid-area",children:[m.jsx(R1,{onPlay:rr,onPause:va,onStop:Lr,isPlaying:ar,isStopped:Ue.isStopped}),m.jsx(SE,{playbackFps:oa,onSpeedChange:oi})]}),m.jsx("div",{className:"middle-bar-right-area"})]}),m.jsxs("div",{className:"bottom-panel",children:[m.jsxs("div",{className:"bottom-panel-tabs-container-1",children:[m.jsxs("div",{className:"bottom-panel-tabs-1",children:[m.jsx("button",{className:`tab-button-1 ${sn==="files"?"active":""}`,onClick:()=>Jt("files"),children:"Files"}),m.jsx("button",{className:`tab-button-1 ${sn==="generators"?"active":""}`,onClick:()=>Jt("generators"),children:"Generators"}),m.jsx("button",{className:`tab-button-1 ${sn==="effects"?"active":""}`,onClick:()=>Jt("effects"),children:"Effects"})]}),m.jsxs("div",{className:"bottom-panel-tab-content-1",children:[sn==="files"&&m.jsx(u1,{viewMode:Ue.fileBrowserViewMode,onViewModeChange:j=>le({type:"SET_FILE_BROWSER_VIEW_MODE",payload:j}),path:Ue.fileBrowserPath,onPathChange:j=>le({type:"SET_FILE_BROWSER_PATH",payload:j}),onDropIld:(j,L,$)=>a.postMessage({type:"parse-ilda",file:$,layerIndex:j,colIndex:L})}),sn==="generators"&&m.jsx(f1,{}),sn==="effects"&&m.jsx(d1,{})]})]}),m.jsxs("div",{className:"bottom-panel-tabs-container-2",children:[m.jsxs("div",{className:"bottom-panel-tabs-2",children:[m.jsx("button",{className:`tab-button-2 ${en==="clip"?"active":""}`,onClick:()=>xt("clip"),children:"Clip-Settings"}),m.jsx("button",{className:`tab-button-2 ${en==="layer"?"active":""}`,onClick:()=>xt("layer"),children:"Layer-Settings"})]}),m.jsxs("div",{className:"bottom-panel-tab-content-2",children:[en==="clip"&&m.jsx(S1,{selectedLayerIndex:qe,selectedColIndex:gt,clip:aa,audioInfo:_(qe),bpm:Ue.bpm,getFftLevels:c,onAssignAudio:async()=>{const j=await window.electronAPI.showAudioFileDialog();if(j){const L=j.split(/[\\/]/).pop();le({type:"SET_CLIP_AUDIO",payload:{layerIndex:qe,colIndex:gt,audioFile:{path:j,name:L}}})}},onRemoveAudio:()=>{v(qe),le({type:"REMOVE_CLIP_AUDIO",payload:{layerIndex:qe,colIndex:gt}})},onUpdateAudioVolume:(j,L,$)=>{le({type:"SET_CLIP_AUDIO_VOLUME",payload:{layerIndex:j,colIndex:L,volume:$}}),I(j,$)},onUpdatePlaybackSettings:(j,L,$)=>le({type:"UPDATE_CLIP_PLAYBACK_SETTINGS",payload:{layerIndex:j,colIndex:L,settings:$}}),onSetParamSync:(j,L)=>le({type:"SET_CLIP_PARAM_SYNC",payload:{layerIndex:qe,colIndex:gt,paramId:j,syncMode:L}}),onToggleDacMirror:(j,L,$,B)=>le({type:"TOGGLE_CLIP_DAC_MIRROR",payload:{layerIndex:j,colIndex:L,dacIndex:$,axis:B}}),onRemoveDac:j=>le({type:"REMOVE_CLIP_DAC",payload:{layerIndex:qe,colIndex:gt,dacIndex:j}}),onRemoveEffect:(j,L,$)=>le({type:"REMOVE_CLIP_EFFECT",payload:{layerIndex:j,colIndex:L,effectIndex:$}}),onReorderEffects:(j,L,$,B)=>le({type:"REORDER_CLIP_EFFECTS",payload:{layerIndex:j,colIndex:L,oldIndex:$,newIndex:B}}),onAddEffect:j=>le({type:"ADD_CLIP_EFFECT",payload:{layerIndex:qe,colIndex:gt,effect:j}}),onUpdateClipUiState:(j,L,$)=>le({type:"UPDATE_CLIP_UI_STATE",payload:{layerIndex:j,colIndex:L,uiState:$}}),onParameterChange:Qi,onGeneratorParameterChange:fi,progressRef:D,onAudioError:Ic}),en==="layer"&&m.jsx(E1,{selectedLayerIndex:qe,autopilotMode:qe!==null?Ue.layerAutopilots[qe]:"off",onAutopilotChange:j=>le({type:"SET_LAYER_AUTOPILOT",payload:{layerIndex:qe,mode:j}}),layerEffects:qe!==null?on[qe]:[],assignedDacs:qe!==null&&Ue.layerAssignedDacs?Ue.layerAssignedDacs[qe]:[],onToggleDacMirror:(j,L,$)=>le({type:"TOGGLE_LAYER_DAC_MIRROR",payload:{layerIndex:j,dacIndex:L,axis:$}}),onRemoveDac:(j,L)=>le({type:"REMOVE_LAYER_DAC",payload:{layerIndex:j,dacIndex:L}}),onAddEffect:j=>qe!==null&&le({type:"ADD_LAYER_EFFECT",payload:{layerIndex:qe,effect:j}}),onRemoveEffect:j=>qe!==null&&le({type:"REMOVE_LAYER_EFFECT",payload:{layerIndex:qe,effectIndex:j}}),onParamChange:(j,L,$)=>qe!==null&&le({type:"UPDATE_LAYER_EFFECT_PARAMETER",payload:{layerIndex:qe,effectIndex:j,paramName:L,newValue:$}}),uiState:qe!==null?Ue.layerUiStates[qe]:{},onUpdateUiState:j=>le({type:"UPDATE_LAYER_UI_STATE",payload:{layerIndex:qe,uiState:j}})})]})]}),m.jsx(p1,{dacs:Ga,onDacSelected:Wi,onDacsDiscovered:js,dacSettings:pn,onUpdateDacSettings:Us}),m.jsx(_1,{enabledShortcuts:ie,onOpenOutputSettings:()=>Me(!0),onOpenShortcutsSettings:()=>z(!0),quickAssigns:Ue.quickAssigns,renderSettings:{showBeamEffect:Ha,beamAlpha:Ca,fadeAlpha:Ma,previewScanRate:Ya,beamRenderMode:Mn,worldShowBeamEffect:bn,worldBeamRenderMode:xn,settingsPanelCollapsed:Ue.settingsPanelCollapsed,optimizationEnabled:Ue.optimizationEnabled},onSetRenderSetting:(j,L)=>{le(j==="optimizationEnabled"?{type:"SET_OPTIMIZATION_ENABLED",payload:L}:{type:"SET_RENDER_SETTING",payload:{setting:j,value:L}})},onUpdateKnob:(j,L)=>{lo("knob",j,L)},onToggleButton:j=>{oo(j)},onAssign:(j,L,$)=>le({type:"ASSIGN_QUICK_CONTROL",payload:{type:j,index:L,link:$}})})]}),m.jsx("div",{className:"SystemMonitor",children:m.jsx(TE,{playbackFps:oa,previewScanRate:Ya,previewFrameCountRef:rt,totalPointsSentRef:Re,activeChannelsCountRef:wt,lastStatUpdateTimeRef:nn})})]})]})}):Z==="shapeBuilder"?m.jsx(z1,{onBack:()=>W("main")}):m.jsx(G1,{onBack:()=>W("main")})]})})})}Av.createRoot(document.getElementById("root")).render(m.jsx(A1,{children:m.jsx(q1,{children:m.jsxs(V1,{children:[" ",m.jsx(c1,{children:m.jsx(b1,{children:m.jsx(ME,{})})})]})})}));

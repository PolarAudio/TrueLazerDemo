function c(l,r,h,n){for(let t=0;t<n;t++)l.setUint8(r+t,t<h.length?h.charCodeAt(t):0)}function d(l){let r=0;l.forEach(s=>{r+=32;const _=s.points?s.points.length:0;r+=_*8});const h=new ArrayBuffer(r),n=new DataView(h);let t=0;return l.forEach((s,_)=>{const A=s.points||[],f=A.length;c(n,t,"ILDA",4),n.setUint8(t+4,0),n.setUint8(t+5,0),n.setUint8(t+6,0),n.setUint8(t+7,5),c(n,t+8,s.frameName||"TrueLazr",8),c(n,t+16,s.companyName||"Gemini",8),n.setUint16(t+24,f,!1),n.setUint16(t+26,_,!1),n.setUint16(t+28,l.length,!1),n.setUint8(t+30,s.scannerHead||0),n.setUint8(t+31,0),t+=32;for(let I=0;I<f;I++){const a=A[I];let M=Math.max(-32768,Math.min(32767,Math.round((a.x||0)*32767))),E=Math.max(-32768,Math.min(32767,Math.round((a.y||0)*32767)));n.setInt16(t,M,!1),n.setInt16(t+2,E,!1);let u=0;a.blanking&&(u|=64),I===f-1&&(u|=128),n.setUint8(t+4,u);let e=a.r||0,i=a.g||0,o=a.b||0;e<=1&&i<=1&&o<=1&&(e>0||i>0||o>0||a.blanking),e<=1&&i<=1&&o<=1?(e=Math.round(e*255),i=Math.round(i*255),o=Math.round(o*255)):(e=Math.round(e),i=Math.round(i),o=Math.round(o)),n.setUint8(t+5,o),n.setUint8(t+6,i),n.setUint8(t+7,e),t+=8}}),h}export{d as framesToIlda};

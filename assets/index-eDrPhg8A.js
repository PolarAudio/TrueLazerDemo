(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(l){if(l.ep)return;l.ep=!0;const o=a(l);fetch(l.href,o)}})();function ad(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cf={exports:{}},Jl={};var T0;function b1(){if(T0)return Jl;T0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function a(s,l,o){var u=null;if(o!==void 0&&(u=""+o),l.key!==void 0&&(u=""+l.key),"key"in l){o={};for(var h in l)h!=="key"&&(o[h]=l[h])}else o=l;return l=o.ref,{$$typeof:n,type:s,key:u,ref:l!==void 0?l:null,props:o}}return Jl.Fragment=e,Jl.jsx=a,Jl.jsxs=a,Jl}var C0;function x1(){return C0||(C0=1,Cf.exports=b1()),Cf.exports}var f=x1(),Mf={exports:{}},pt={};var M0;function S1(){if(M0)return pt;M0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),C=Symbol.iterator;function w($){return $===null||typeof $!="object"?null:($=C&&$[C]||$["@@iterator"],typeof $=="function"?$:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,R={};function I($,Q,ve){this.props=$,this.context=Q,this.refs=R,this.updater=ve||x}I.prototype.isReactComponent={},I.prototype.setState=function($,Q){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,Q,"setState")},I.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function H(){}H.prototype=I.prototype;function B($,Q,ve){this.props=$,this.context=Q,this.refs=R,this.updater=ve||x}var D=B.prototype=new H;D.constructor=B,M(D,I.prototype),D.isPureReactComponent=!0;var j=Array.isArray,_={H:null,A:null,T:null,S:null,V:null},G=Object.prototype.hasOwnProperty;function Y($,Q,ve,Re,Ue,we){return ve=we.ref,{$$typeof:n,type:$,key:Q,ref:ve!==void 0?ve:null,props:we}}function J($,Q){return Y($.type,Q,void 0,void 0,void 0,$.props)}function ae($){return typeof $=="object"&&$!==null&&$.$$typeof===n}function re($){var Q={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(ve){return Q[ve]})}var O=/\/+/g;function W($,Q){return typeof $=="object"&&$!==null&&$.key!=null?re(""+$.key):Q.toString(36)}function K(){}function Z($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(K,K):($.status="pending",$.then(function(Q){$.status==="pending"&&($.status="fulfilled",$.value=Q)},function(Q){$.status==="pending"&&($.status="rejected",$.reason=Q)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function ee($,Q,ve,Re,Ue){var we=typeof $;(we==="undefined"||we==="boolean")&&($=null);var Me=!1;if($===null)Me=!0;else switch(we){case"bigint":case"string":case"number":Me=!0;break;case"object":switch($.$$typeof){case n:case e:Me=!0;break;case b:return Me=$._init,ee(Me($._payload),Q,ve,Re,Ue)}}if(Me)return Ue=Ue($),Me=Re===""?"."+W($,0):Re,j(Ue)?(ve="",Me!=null&&(ve=Me.replace(O,"$&/")+"/"),ee(Ue,Q,ve,"",function(ot){return ot})):Ue!=null&&(ae(Ue)&&(Ue=J(Ue,ve+(Ue.key==null||$&&$.key===Ue.key?"":(""+Ue.key).replace(O,"$&/")+"/")+Me)),Q.push(Ue)),1;Me=0;var ze=Re===""?".":Re+":";if(j($))for(var Xe=0;Xe<$.length;Xe++)Re=$[Xe],we=ze+W(Re,Xe),Me+=ee(Re,Q,ve,we,Ue);else if(Xe=w($),typeof Xe=="function")for($=Xe.call($),Xe=0;!(Re=$.next()).done;)Re=Re.value,we=ze+W(Re,Xe++),Me+=ee(Re,Q,ve,we,Ue);else if(we==="object"){if(typeof $.then=="function")return ee(Z($),Q,ve,Re,Ue);throw Q=String($),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return Me}function V($,Q,ve){if($==null)return $;var Re=[],Ue=0;return ee($,Re,"","",function(we){return Q.call(ve,we,Ue++)}),Re}function te($){if($._status===-1){var Q=$._result;Q=Q(),Q.then(function(ve){($._status===0||$._status===-1)&&($._status=1,$._result=ve)},function(ve){($._status===0||$._status===-1)&&($._status=2,$._result=ve)}),$._status===-1&&($._status=0,$._result=Q)}if($._status===1)return $._result.default;throw $._result}var ce=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",$);return}console.error($)};function xe(){}return pt.Children={map:V,forEach:function($,Q,ve){V($,function(){Q.apply(this,arguments)},ve)},count:function($){var Q=0;return V($,function(){Q++}),Q},toArray:function($){return V($,function(Q){return Q})||[]},only:function($){if(!ae($))throw Error("React.Children.only expected to receive a single React element child.");return $}},pt.Component=I,pt.Fragment=a,pt.Profiler=l,pt.PureComponent=B,pt.StrictMode=s,pt.Suspense=p,pt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_,pt.__COMPILER_RUNTIME={__proto__:null,c:function($){return _.H.useMemoCache($)}},pt.cache=function($){return function(){return $.apply(null,arguments)}},pt.cloneElement=function($,Q,ve){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var Re=M({},$.props),Ue=$.key,we=void 0;if(Q!=null)for(Me in Q.ref!==void 0&&(we=void 0),Q.key!==void 0&&(Ue=""+Q.key),Q)!G.call(Q,Me)||Me==="key"||Me==="__self"||Me==="__source"||Me==="ref"&&Q.ref===void 0||(Re[Me]=Q[Me]);var Me=arguments.length-2;if(Me===1)Re.children=ve;else if(1<Me){for(var ze=Array(Me),Xe=0;Xe<Me;Xe++)ze[Xe]=arguments[Xe+2];Re.children=ze}return Y($.type,Ue,void 0,void 0,we,Re)},pt.createContext=function($){return $={$$typeof:u,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:o,_context:$},$},pt.createElement=function($,Q,ve){var Re,Ue={},we=null;if(Q!=null)for(Re in Q.key!==void 0&&(we=""+Q.key),Q)G.call(Q,Re)&&Re!=="key"&&Re!=="__self"&&Re!=="__source"&&(Ue[Re]=Q[Re]);var Me=arguments.length-2;if(Me===1)Ue.children=ve;else if(1<Me){for(var ze=Array(Me),Xe=0;Xe<Me;Xe++)ze[Xe]=arguments[Xe+2];Ue.children=ze}if($&&$.defaultProps)for(Re in Me=$.defaultProps,Me)Ue[Re]===void 0&&(Ue[Re]=Me[Re]);return Y($,we,void 0,void 0,null,Ue)},pt.createRef=function(){return{current:null}},pt.forwardRef=function($){return{$$typeof:h,render:$}},pt.isValidElement=ae,pt.lazy=function($){return{$$typeof:b,_payload:{_status:-1,_result:$},_init:te}},pt.memo=function($,Q){return{$$typeof:g,type:$,compare:Q===void 0?null:Q}},pt.startTransition=function($){var Q=_.T,ve={};_.T=ve;try{var Re=$(),Ue=_.S;Ue!==null&&Ue(ve,Re),typeof Re=="object"&&Re!==null&&typeof Re.then=="function"&&Re.then(xe,ce)}catch(we){ce(we)}finally{_.T=Q}},pt.unstable_useCacheRefresh=function(){return _.H.useCacheRefresh()},pt.use=function($){return _.H.use($)},pt.useActionState=function($,Q,ve){return _.H.useActionState($,Q,ve)},pt.useCallback=function($,Q){return _.H.useCallback($,Q)},pt.useContext=function($){return _.H.useContext($)},pt.useDebugValue=function(){},pt.useDeferredValue=function($,Q){return _.H.useDeferredValue($,Q)},pt.useEffect=function($,Q,ve){var Re=_.H;if(typeof ve=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Re.useEffect($,Q)},pt.useId=function(){return _.H.useId()},pt.useImperativeHandle=function($,Q,ve){return _.H.useImperativeHandle($,Q,ve)},pt.useInsertionEffect=function($,Q){return _.H.useInsertionEffect($,Q)},pt.useLayoutEffect=function($,Q){return _.H.useLayoutEffect($,Q)},pt.useMemo=function($,Q){return _.H.useMemo($,Q)},pt.useOptimistic=function($,Q){return _.H.useOptimistic($,Q)},pt.useReducer=function($,Q,ve){return _.H.useReducer($,Q,ve)},pt.useRef=function($){return _.H.useRef($)},pt.useState=function($){return _.H.useState($)},pt.useSyncExternalStore=function($,Q,ve){return _.H.useSyncExternalStore($,Q,ve)},pt.useTransition=function(){return _.H.useTransition()},pt.version="19.1.1",pt}var N0;function rd(){return N0||(N0=1,Mf.exports=S1()),Mf.exports}var N=rd();const Yn=ad(N);var Nf={exports:{}},eo={},kf={exports:{}},Rf={};var k0;function w1(){return k0||(k0=1,(function(n){function e(V,te){var ce=V.length;V.push(te);e:for(;0<ce;){var xe=ce-1>>>1,$=V[xe];if(0<l($,te))V[xe]=te,V[ce]=$,ce=xe;else break e}}function a(V){return V.length===0?null:V[0]}function s(V){if(V.length===0)return null;var te=V[0],ce=V.pop();if(ce!==te){V[0]=ce;e:for(var xe=0,$=V.length,Q=$>>>1;xe<Q;){var ve=2*(xe+1)-1,Re=V[ve],Ue=ve+1,we=V[Ue];if(0>l(Re,ce))Ue<$&&0>l(we,Re)?(V[xe]=we,V[Ue]=ce,xe=Ue):(V[xe]=Re,V[ve]=ce,xe=ve);else if(Ue<$&&0>l(we,ce))V[xe]=we,V[Ue]=ce,xe=Ue;else break e}}return te}function l(V,te){var ce=V.sortIndex-te.sortIndex;return ce!==0?ce:V.id-te.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var u=Date,h=u.now();n.unstable_now=function(){return u.now()-h}}var p=[],g=[],b=1,C=null,w=3,x=!1,M=!1,R=!1,I=!1,H=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function j(V){for(var te=a(g);te!==null;){if(te.callback===null)s(g);else if(te.startTime<=V)s(g),te.sortIndex=te.expirationTime,e(p,te);else break;te=a(g)}}function _(V){if(R=!1,j(V),!M)if(a(p)!==null)M=!0,G||(G=!0,W());else{var te=a(g);te!==null&&ee(_,te.startTime-V)}}var G=!1,Y=-1,J=5,ae=-1;function re(){return I?!0:!(n.unstable_now()-ae<J)}function O(){if(I=!1,G){var V=n.unstable_now();ae=V;var te=!0;try{e:{M=!1,R&&(R=!1,B(Y),Y=-1),x=!0;var ce=w;try{t:{for(j(V),C=a(p);C!==null&&!(C.expirationTime>V&&re());){var xe=C.callback;if(typeof xe=="function"){C.callback=null,w=C.priorityLevel;var $=xe(C.expirationTime<=V);if(V=n.unstable_now(),typeof $=="function"){C.callback=$,j(V),te=!0;break t}C===a(p)&&s(p),j(V)}else s(p);C=a(p)}if(C!==null)te=!0;else{var Q=a(g);Q!==null&&ee(_,Q.startTime-V),te=!1}}break e}finally{C=null,w=ce,x=!1}te=void 0}}finally{te?W():G=!1}}}var W;if(typeof D=="function")W=function(){D(O)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,Z=K.port2;K.port1.onmessage=O,W=function(){Z.postMessage(null)}}else W=function(){H(O,0)};function ee(V,te){Y=H(function(){V(n.unstable_now())},te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return w},n.unstable_next=function(V){switch(w){case 1:case 2:case 3:var te=3;break;default:te=w}var ce=w;w=te;try{return V()}finally{w=ce}},n.unstable_requestPaint=function(){I=!0},n.unstable_runWithPriority=function(V,te){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var ce=w;w=V;try{return te()}finally{w=ce}},n.unstable_scheduleCallback=function(V,te,ce){var xe=n.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?xe+ce:xe):ce=xe,V){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=ce+$,V={id:b++,callback:te,priorityLevel:V,startTime:ce,expirationTime:$,sortIndex:-1},ce>xe?(V.sortIndex=ce,e(g,V),a(p)===null&&V===a(g)&&(R?(B(Y),Y=-1):R=!0,ee(_,ce-xe))):(V.sortIndex=$,e(p,V),M||x||(M=!0,G||(G=!0,W()))),V},n.unstable_shouldYield=re,n.unstable_wrapCallback=function(V){var te=w;return function(){var ce=w;w=te;try{return V.apply(this,arguments)}finally{w=ce}}}})(Rf)),Rf}var R0;function E1(){return R0||(R0=1,kf.exports=w1()),kf.exports}var Df={exports:{}},Jn={};var D0;function A1(){if(D0)return Jn;D0=1;var n=rd();function e(p){var g="https://react.dev/errors/"+p;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(e(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},l=Symbol.for("react.portal");function o(p,g,b){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:C==null?null:""+C,children:p,containerInfo:g,implementation:b}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,g){if(p==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Jn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Jn.createPortal=function(p,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(e(299));return o(p,g,null,b)},Jn.flushSync=function(p){var g=u.T,b=s.p;try{if(u.T=null,s.p=2,p)return p()}finally{u.T=g,s.p=b,s.d.f()}},Jn.preconnect=function(p,g){typeof p=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,s.d.C(p,g))},Jn.prefetchDNS=function(p){typeof p=="string"&&s.d.D(p)},Jn.preinit=function(p,g){if(typeof p=="string"&&g&&typeof g.as=="string"){var b=g.as,C=h(b,g.crossOrigin),w=typeof g.integrity=="string"?g.integrity:void 0,x=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;b==="style"?s.d.S(p,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:C,integrity:w,fetchPriority:x}):b==="script"&&s.d.X(p,{crossOrigin:C,integrity:w,fetchPriority:x,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Jn.preinitModule=function(p,g){if(typeof p=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var b=h(g.as,g.crossOrigin);s.d.M(p,{crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&s.d.M(p)},Jn.preload=function(p,g){if(typeof p=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var b=g.as,C=h(b,g.crossOrigin);s.d.L(p,b,{crossOrigin:C,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Jn.preloadModule=function(p,g){if(typeof p=="string")if(g){var b=h(g.as,g.crossOrigin);s.d.m(p,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else s.d.m(p)},Jn.requestFormReset=function(p){s.d.r(p)},Jn.unstable_batchedUpdates=function(p,g){return p(g)},Jn.useFormState=function(p,g,b){return u.H.useFormState(p,g,b)},Jn.useFormStatus=function(){return u.H.useHostTransitionStatus()},Jn.version="19.1.1",Jn}var _0;function Pm(){if(_0)return Df.exports;_0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Df.exports=A1(),Df.exports}var O0;function T1(){if(O0)return eo;O0=1;var n=E1(),e=rd(),a=Pm();function s(t){var r="https://react.dev/errors/"+t;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)r+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function o(t){var r=t,i=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,(r.flags&4098)!==0&&(i=r.return),t=r.return;while(t)}return r.tag===3?i:null}function u(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function h(t){if(o(t)!==t)throw Error(s(188))}function p(t){var r=t.alternate;if(!r){if(r=o(t),r===null)throw Error(s(188));return r!==t?null:t}for(var i=t,c=r;;){var d=i.return;if(d===null)break;var m=d.alternate;if(m===null){if(c=d.return,c!==null){i=c;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===i)return h(d),t;if(m===c)return h(d),r;m=m.sibling}throw Error(s(188))}if(i.return!==c.return)i=d,c=m;else{for(var k=!1,U=d.child;U;){if(U===i){k=!0,i=d,c=m;break}if(U===c){k=!0,c=d,i=m;break}U=U.sibling}if(!k){for(U=m.child;U;){if(U===i){k=!0,i=m,c=d;break}if(U===c){k=!0,c=m,i=d;break}U=U.sibling}if(!k)throw Error(s(189))}}if(i.alternate!==c)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?t:r}function g(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t;for(t=t.child;t!==null;){if(r=g(t),r!==null)return r;t=t.sibling}return null}var b=Object.assign,C=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),H=Symbol.for("react.provider"),B=Symbol.for("react.consumer"),D=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ae=Symbol.for("react.activity"),re=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function W(t){return t===null||typeof t!="object"?null:(t=O&&t[O]||t["@@iterator"],typeof t=="function"?t:null)}var K=Symbol.for("react.client.reference");function Z(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===K?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case M:return"Fragment";case I:return"Profiler";case R:return"StrictMode";case _:return"Suspense";case G:return"SuspenseList";case ae:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case x:return"Portal";case D:return(t.displayName||"Context")+".Provider";case B:return(t._context.displayName||"Context")+".Consumer";case j:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Y:return r=t.displayName||null,r!==null?r:Z(t.type)||"Memo";case J:r=t._payload,t=t._init;try{return Z(t(r))}catch{}}return null}var ee=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ce={pending:!1,data:null,method:null,action:null},xe=[],$=-1;function Q(t){return{current:t}}function ve(t){0>$||(t.current=xe[$],xe[$]=null,$--)}function Re(t,r){$++,xe[$]=t.current,t.current=r}var Ue=Q(null),we=Q(null),Me=Q(null),ze=Q(null);function Xe(t,r){switch(Re(Me,r),Re(we,t),Re(Ue,null),r.nodeType){case 9:case 11:t=(t=r.documentElement)&&(t=t.namespaceURI)?Jh(t):0;break;default:if(t=r.tagName,r=r.namespaceURI)r=Jh(r),t=e0(r,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}ve(Ue),Re(Ue,t)}function ot(){ve(Ue),ve(we),ve(Me)}function At(t){t.memoizedState!==null&&Re(ze,t);var r=Ue.current,i=e0(r,t.type);r!==i&&(Re(we,t),Re(Ue,i))}function Ct(t){we.current===t&&(ve(Ue),ve(we)),ze.current===t&&(ve(ze),$l._currentValue=ce)}var on=Object.prototype.hasOwnProperty,Qt=n.unstable_scheduleCallback,cn=n.unstable_cancelCallback,je=n.unstable_shouldYield,Ve=n.unstable_requestPaint,Le=n.unstable_now,rt=n.unstable_getCurrentPriorityLevel,Wt=n.unstable_ImmediatePriority,pn=n.unstable_UserBlockingPriority,ke=n.unstable_NormalPriority,Se=n.unstable_LowPriority,Kt=n.unstable_IdlePriority,zt=n.log,On=n.unstable_setDisableYieldValue,Gt=null,Ke=null;function qn(t){if(typeof zt=="function"&&On(t),Ke&&typeof Ke.setStrictMode=="function")try{Ke.setStrictMode(Gt,t)}catch{}}var Xt=Math.clz32?Math.clz32:zr,tr=Math.log,nr=Math.LN2;function zr(t){return t>>>=0,t===0?32:31-(tr(t)/nr|0)|0}var wn=256,va=4194304;function hn(t){var r=t&42;if(r!==0)return r;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function ar(t,r,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,k=t.pingedLanes;t=t.warmLanes;var U=c&134217727;return U!==0?(c=U&~m,c!==0?d=hn(c):(k&=U,k!==0?d=hn(k):i||(i=U&~t,i!==0&&(d=hn(i))))):(U=c&~m,U!==0?d=hn(U):k!==0?d=hn(k):i||(i=c&~t,i!==0&&(d=hn(i)))),d===0?0:r!==0&&r!==d&&(r&m)===0&&(m=d&-d,i=r&-r,m>=i||m===32&&(i&4194048)!==0)?r:d}function En(t,r){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&r)===0}function Ze(t,r){switch(t){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ct(){var t=wn;return wn<<=1,(wn&4194048)===0&&(wn=256),t}function ds(){var t=va;return va<<=1,(va&62914560)===0&&(va=4194304),t}function Vn(t){for(var r=[],i=0;31>i;i++)r.push(t);return r}function In(t,r){t.pendingLanes|=r,r!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Gr(t,r,i,c,d,m){var k=t.pendingLanes;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=i,t.entangledLanes&=i,t.errorRecoveryDisabledLanes&=i,t.shellSuspendCounter=0;var U=t.entanglements,ne=t.expirationTimes,pe=t.hiddenUpdates;for(i=k&~i;0<i;){var Ee=31-Xt(i),Ne=1<<Ee;U[Ee]=0,ne[Ee]=-1;var he=pe[Ee];if(he!==null)for(pe[Ee]=null,Ee=0;Ee<he.length;Ee++){var me=he[Ee];me!==null&&(me.lane&=-536870913)}i&=~Ne}c!==0&&ja(t,c,0),m!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=m&~(k&~r))}function ja(t,r,i){t.pendingLanes|=r,t.suspendedLanes&=~r;var c=31-Xt(r);t.entangledLanes|=r,t.entanglements[c]=t.entanglements[c]|1073741824|i&4194090}function Hr(t,r){var i=t.entangledLanes|=r;for(t=t.entanglements;i;){var c=31-Xt(i),d=1<<c;d&r|t[c]&r&&(t[c]|=r),i&=~d}}function ca(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function ua(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ba(){var t=te.p;return t!==0?t:(t=window.event,t===void 0?32:b0(t.type))}function ta(t,r){var i=te.p;try{return te.p=t,r()}finally{te.p=i}}var mn=Math.random().toString(36).slice(2),kt="__reactFiber$"+mn,gn="__reactProps$"+mn,Xn="__reactContainer$"+mn,na="__reactEvents$"+mn,et="__reactListeners$"+mn,xa="__reactHandles$"+mn,Mn="__reactResources$"+mn,rr="__reactMarker$"+mn;function Qs(t){delete t[kt],delete t[gn],delete t[na],delete t[et],delete t[xa]}function Sa(t){var r=t[kt];if(r)return r;for(var i=t.parentNode;i;){if(r=i[Xn]||i[kt]){if(i=r.alternate,r.child!==null||i!==null&&i.child!==null)for(t=r0(t);t!==null;){if(i=t[kt])return i;t=r0(t)}return r}t=i,i=t.parentNode}return null}function Ln(t){if(t=t[kt]||t[Xn]){var r=t.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return t}return null}function Et(t){var r=t.tag;if(r===5||r===26||r===27||r===6)return t.stateNode;throw Error(s(33))}function Nn(t){var r=t[Mn];return r||(r=t[Mn]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function ut(t){t[rr]=!0}var Qe=new Set,Pe={};function nt(t,r){fa(t,r),fa(t+"Capture",r)}function fa(t,r){for(Pe[t]=r,t=0;t<r.length;t++)Qe.add(r[t])}var ps=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Yr={},Lt={};function Un(t){return on.call(Lt,t)?!0:on.call(Yr,t)?!1:ps.test(t)?Lt[t]=!0:(Yr[t]=!0,!1)}function wa(t,r,i){if(Un(r))if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":t.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){t.removeAttribute(r);return}}t.setAttribute(r,""+i)}}function da(t,r,i){if(i===null)t.removeAttribute(r);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(r);return}t.setAttribute(r,""+i)}}function $n(t,r,i,c){if(c===null)t.removeAttribute(i);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttributeNS(r,i,""+c)}}var jn,qr;function Wn(t){if(jn===void 0)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);jn=r&&r[1]||"",qr=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+jn+t+qr}var pa=!1;function Ut(t,r){if(!t||pa)return"";pa=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(me){var he=me}Reflect.construct(t,[],Ne)}else{try{Ne.call()}catch(me){he=me}t.call(Ne.prototype)}}else{try{throw Error()}catch(me){he=me}(Ne=t())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(me){if(me&&he&&typeof me.stack=="string")return[me.stack,he.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=c.DetermineComponentFrameRoot(),k=m[0],U=m[1];if(k&&U){var ne=k.split(`
`),pe=U.split(`
`);for(d=c=0;c<ne.length&&!ne[c].includes("DetermineComponentFrameRoot");)c++;for(;d<pe.length&&!pe[d].includes("DetermineComponentFrameRoot");)d++;if(c===ne.length||d===pe.length)for(c=ne.length-1,d=pe.length-1;1<=c&&0<=d&&ne[c]!==pe[d];)d--;for(;1<=c&&0<=d;c--,d--)if(ne[c]!==pe[d]){if(c!==1||d!==1)do if(c--,d--,0>d||ne[c]!==pe[d]){var Ee=`
`+ne[c].replace(" at new "," at ");return t.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",t.displayName)),Ee}while(1<=c&&0<=d);break}}}finally{pa=!1,Error.prepareStackTrace=i}return(i=t?t.displayName||t.name:"")?Wn(i):""}function Bn(t){switch(t.tag){case 26:case 27:case 5:return Wn(t.type);case 16:return Wn("Lazy");case 13:return Wn("Suspense");case 19:return Wn("SuspenseList");case 0:case 15:return Ut(t.type,!1);case 11:return Ut(t.type.render,!1);case 1:return Ut(t.type,!0);case 31:return Wn("Activity");default:return""}}function Ba(t){try{var r="";do r+=Bn(t),t=t.return;while(t);return r}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}function An(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Fa(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Er(t){var r=Fa(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),c=""+t[r];if(!t.hasOwnProperty(r)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,m=i.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return d.call(this)},set:function(k){c=""+k,m.call(this,k)}}),Object.defineProperty(t,r,{enumerable:i.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function sr(t){t._valueTracker||(t._valueTracker=Er(t))}function Ks(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var i=r.getValue(),c="";return t&&(c=Fa(t)?t.checked?"true":"false":t.value),t=c,t!==i?(r.setValue(t),!0):!1}function Ar(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var ir=/[\n"\\]/g;function Fn(t){return t.replace(ir,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Pa(t,r,i,c,d,m,k,U){t.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?t.type=k:t.removeAttribute("type"),r!=null?k==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+An(r)):t.value!==""+An(r)&&(t.value=""+An(r)):k!=="submit"&&k!=="reset"||t.removeAttribute("value"),r!=null?Vr(t,k,An(r)):i!=null?Vr(t,k,An(i)):c!=null&&t.removeAttribute("value"),d==null&&m!=null&&(t.defaultChecked=!!m),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?t.name=""+An(U):t.removeAttribute("name")}function hs(t,r,i,c,d,m,k,U){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(t.type=m),r!=null||i!=null){if(!(m!=="submit"&&m!=="reset"||r!=null))return;i=i!=null?""+An(i):"",r=r!=null?""+An(r):i,U||r===t.value||(t.value=r),t.defaultValue=r}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,t.checked=U?t.checked:!!c,t.defaultChecked=!!c,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(t.name=k)}function Vr(t,r,i){r==="number"&&Ar(t.ownerDocument)===t||t.defaultValue===""+i||(t.defaultValue=""+i)}function lr(t,r,i,c){if(t=t.options,r){r={};for(var d=0;d<i.length;d++)r["$"+i[d]]=!0;for(i=0;i<t.length;i++)d=r.hasOwnProperty("$"+t[i].value),t[i].selected!==d&&(t[i].selected=d),d&&c&&(t[i].defaultSelected=!0)}else{for(i=""+An(i),r=null,d=0;d<t.length;d++){if(t[d].value===i){t[d].selected=!0,c&&(t[d].defaultSelected=!0);return}r!==null||t[d].disabled||(r=t[d])}r!==null&&(r.selected=!0)}}function Tr(t,r,i){if(r!=null&&(r=""+An(r),r!==t.value&&(t.value=r),i==null)){t.defaultValue!==r&&(t.defaultValue=r);return}t.defaultValue=i!=null?""+An(i):""}function ms(t,r,i,c){if(r==null){if(c!=null){if(i!=null)throw Error(s(92));if(ee(c)){if(1<c.length)throw Error(s(93));c=c[0]}i=c}i==null&&(i=""),r=i}i=An(r),t.defaultValue=i,c=t.textContent,c===i&&c!==""&&c!==null&&(t.value=c)}function za(t,r){if(r){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=r;return}}t.textContent=r}var or=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ga(t,r,i){var c=r.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?c?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="":c?t.setProperty(r,i):typeof i!="number"||i===0||or.has(r)?r==="float"?t.cssFloat=i:t[r]=(""+i).trim():t[r]=i+"px"}function Ha(t,r,i){if(r!=null&&typeof r!="object")throw Error(s(62));if(t=t.style,i!=null){for(var c in i)!i.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?t.setProperty(c,""):c==="float"?t.cssFloat="":t[c]="");for(var d in r)c=r[d],r.hasOwnProperty(d)&&i[d]!==c&&Ga(t,d,c)}else for(var m in r)r.hasOwnProperty(m)&&Ga(t,m,r[m])}function aa(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ai=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function cr(t){return gs.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var Js=null;function ys(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ur=null,qt=null;function ei(t){var r=Ln(t);if(r&&(t=r.stateNode)){var i=t[gn]||null;e:switch(t=r.stateNode,r.type){case"input":if(Pa(t,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),r=i.name,i.type==="radio"&&r!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+Fn(""+r)+'"][type="radio"]'),r=0;r<i.length;r++){var c=i[r];if(c!==t&&c.form===t.form){var d=c[gn]||null;if(!d)throw Error(s(90));Pa(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(r=0;r<i.length;r++)c=i[r],c.form===t.form&&Ks(c)}break e;case"textarea":Tr(t,i.value,i.defaultValue);break e;case"select":r=i.value,r!=null&&lr(t,!!i.multiple,r,!1)}}}var Ya=!1;function ti(t,r,i){if(Ya)return t(r,i);Ya=!0;try{var c=t(r);return c}finally{if(Ya=!1,(ur!==null||qt!==null)&&(Qo(),ur&&(r=ur,t=qt,qt=ur=null,ei(r),t)))for(r=0;r<t.length;r++)ei(t[r])}}function Xr(t,r){var i=t.stateNode;if(i===null)return null;var c=i[gn]||null;if(c===null)return null;i=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(s(231,r,typeof i));return i}var Ea=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vs=!1;if(Ea)try{var Zn={};Object.defineProperty(Zn,"passive",{get:function(){vs=!0}}),window.addEventListener("test",Zn,Zn),window.removeEventListener("test",Zn,Zn)}catch{vs=!1}var tn=null,qa=null,Aa=null;function Cr(){if(Aa)return Aa;var t,r=qa,i=r.length,c,d="value"in tn?tn.value:tn.textContent,m=d.length;for(t=0;t<i&&r[t]===d[t];t++);var k=i-t;for(c=1;c<=k&&r[i-c]===d[m-c];c++);return Aa=d.slice(t,1<c?1-c:void 0)}function Va(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function Mr(){return!0}function Nr(){return!1}function yn(t){function r(i,c,d,m,k){this._reactName=i,this._targetInst=d,this.type=c,this.nativeEvent=m,this.target=k,this.currentTarget=null;for(var U in t)t.hasOwnProperty(U)&&(i=t[U],this[U]=i?i(m):m[U]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Mr:Nr,this.isPropagationStopped=Nr,this}return b(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Mr)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Mr)},persist:function(){},isPersistent:Mr}),r}var Pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bs=yn(Pn),kr=b({},Pn,{view:0,detail:0}),Ti=yn(kr),vn,xs,$r,fr=b({},kr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:E,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==$r&&($r&&t.type==="mousemove"?(vn=t.screenX-$r.screenX,xs=t.screenY-$r.screenY):xs=vn=0,$r=t),vn)},movementY:function(t){return"movementY"in t?t.movementY:xs}}),Ss=yn(fr),dl=b({},fr,{dataTransfer:0}),Rr=yn(dl),ha=b({},kr,{relatedTarget:0}),ws=yn(ha),Ci=b({},Pn,{animationName:0,elapsedTime:0,pseudoElement:0}),Dr=yn(Ci),pl=b({},Pn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ta=yn(pl),Es=b({},Pn,{data:0}),Mi=yn(Es),y={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},v={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},S={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function A(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=S[t])?!!r[t]:!1}function E(){return A}var T=b({},kr,{key:function(t){if(t.key){var r=y[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=Va(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?v[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:E,charCode:function(t){return t.type==="keypress"?Va(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Va(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),L=yn(T),P=b({},fr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),z=yn(P),F=b({},kr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:E}),X=yn(F),q=b({},Pn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ie=yn(q),le=b({},fr,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),oe=yn(le),ge=b({},Pn,{newState:0,oldState:0}),fe=yn(ge),be=[9,13,27,32],Ae=Ea&&"CompositionEvent"in window,De=null;Ea&&"documentMode"in document&&(De=document.documentMode);var Ie=Ea&&"TextEvent"in window&&!De,Ge=Ea&&(!Ae||De&&8<De&&11>=De),ft=" ",it=!1;function ht(t,r){switch(t){case"keyup":return be.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xt(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var $e=!1;function ra(t,r){switch(t){case"compositionend":return xt(r);case"keypress":return r.which!==32?null:(it=!0,ft);case"textInput":return t=r.data,t===ft&&it?null:t;default:return null}}function Ht(t,r){if($e)return t==="compositionend"||!Ae&&ht(t,r)?(t=Cr(),Aa=qa=tn=null,$e=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Ge&&r.locale!=="ko"?null:r.data;default:return null}}var Rt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mt(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!Rt[t.type]:r==="textarea"}function St(t,r,i,c){ur?qt?qt.push(c):qt=[c]:ur=c,r=ac(r,"onChange"),0<r.length&&(i=new bs("onChange","change",null,i,c),t.push({event:i,listeners:r}))}var Jt=null,Dt=null;function mt(t){$h(t,0)}function _t(t){var r=Et(t);if(Ks(r))return t}function nn(t,r){if(t==="change")return r}var Xa=!1;if(Ea){var dr;if(Ea){var an="oninput"in document;if(!an){var dt=document.createElement("div");dt.setAttribute("oninput","return;"),an=typeof dt.oninput=="function"}dr=an}else dr=!1;Xa=dr&&(!document.documentMode||9<document.documentMode)}function Ca(){Jt&&(Jt.detachEvent("onpropertychange",Qn),Dt=Jt=null)}function Qn(t){if(t.propertyName==="value"&&_t(Dt)){var r=[];St(r,Dt,t,ys(t)),ti(mt,r)}}function Ma(t,r,i){t==="focusin"?(Ca(),Jt=r,Dt=i,Jt.attachEvent("onpropertychange",Qn)):t==="focusout"&&Ca()}function hl(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return _t(Dt)}function Wr(t,r){if(t==="click")return _t(r)}function pr(t,r){if(t==="input"||t==="change")return _t(r)}function ni(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var sa=typeof Object.is=="function"?Object.is:ni;function ia(t,r){if(sa(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var i=Object.keys(t),c=Object.keys(r);if(i.length!==c.length)return!1;for(c=0;c<i.length;c++){var d=i[c];if(!on.call(r,d)||!sa(t[d],r[d]))return!1}return!0}function la(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sd(t,r){var i=la(t);t=0;for(var c;i;){if(i.nodeType===3){if(c=t+i.textContent.length,t<=r&&c>=r)return{node:i,offset:r-t};t=c}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=la(i)}}function wd(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?wd(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function Ed(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var r=Ar(t.document);r instanceof t.HTMLIFrameElement;){try{var i=typeof r.contentWindow.location.href=="string"}catch{i=!1}if(i)t=r.contentWindow;else break;r=Ar(t.document)}return r}function jc(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}var ey=Ea&&"documentMode"in document&&11>=document.documentMode,Ni=null,Bc=null,ml=null,Fc=!1;function Ad(t,r,i){var c=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Fc||Ni==null||Ni!==Ar(c)||(c=Ni,"selectionStart"in c&&jc(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ml&&ia(ml,c)||(ml=c,c=ac(Bc,"onSelect"),0<c.length&&(r=new bs("onSelect","select",null,r,i),t.push({event:r,listeners:c}),r.target=Ni)))}function ai(t,r){var i={};return i[t.toLowerCase()]=r.toLowerCase(),i["Webkit"+t]="webkit"+r,i["Moz"+t]="moz"+r,i}var ki={animationend:ai("Animation","AnimationEnd"),animationiteration:ai("Animation","AnimationIteration"),animationstart:ai("Animation","AnimationStart"),transitionrun:ai("Transition","TransitionRun"),transitionstart:ai("Transition","TransitionStart"),transitioncancel:ai("Transition","TransitionCancel"),transitionend:ai("Transition","TransitionEnd")},Pc={},Td={};Ea&&(Td=document.createElement("div").style,"AnimationEvent"in window||(delete ki.animationend.animation,delete ki.animationiteration.animation,delete ki.animationstart.animation),"TransitionEvent"in window||delete ki.transitionend.transition);function ri(t){if(Pc[t])return Pc[t];if(!ki[t])return t;var r=ki[t],i;for(i in r)if(r.hasOwnProperty(i)&&i in Td)return Pc[t]=r[i];return t}var Cd=ri("animationend"),Md=ri("animationiteration"),Nd=ri("animationstart"),ty=ri("transitionrun"),ny=ri("transitionstart"),ay=ri("transitioncancel"),kd=ri("transitionend"),Rd=new Map,zc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zc.push("scrollEnd");function hr(t,r){Rd.set(t,r),nt(r,[t])}var Dd=new WeakMap;function $a(t,r){if(typeof t=="object"&&t!==null){var i=Dd.get(t);return i!==void 0?i:(r={value:t,source:r,stack:Ba(r)},Dd.set(t,r),r)}return{value:t,source:r,stack:Ba(r)}}var Wa=[],Ri=0,Gc=0;function bo(){for(var t=Ri,r=Gc=Ri=0;r<t;){var i=Wa[r];Wa[r++]=null;var c=Wa[r];Wa[r++]=null;var d=Wa[r];Wa[r++]=null;var m=Wa[r];if(Wa[r++]=null,c!==null&&d!==null){var k=c.pending;k===null?d.next=d:(d.next=k.next,k.next=d),c.pending=d}m!==0&&_d(i,d,m)}}function xo(t,r,i,c){Wa[Ri++]=t,Wa[Ri++]=r,Wa[Ri++]=i,Wa[Ri++]=c,Gc|=c,t.lanes|=c,t=t.alternate,t!==null&&(t.lanes|=c)}function Hc(t,r,i,c){return xo(t,r,i,c),So(t)}function Di(t,r){return xo(t,null,null,r),So(t)}function _d(t,r,i){t.lanes|=i;var c=t.alternate;c!==null&&(c.lanes|=i);for(var d=!1,m=t.return;m!==null;)m.childLanes|=i,c=m.alternate,c!==null&&(c.childLanes|=i),m.tag===22&&(t=m.stateNode,t===null||t._visibility&1||(d=!0)),t=m,m=m.return;return t.tag===3?(m=t.stateNode,d&&r!==null&&(d=31-Xt(i),t=m.hiddenUpdates,c=t[d],c===null?t[d]=[r]:c.push(r),r.lane=i|536870912),m):null}function So(t){if(50<Pl)throw Pl=0,Wu=null,Error(s(185));for(var r=t.return;r!==null;)t=r,r=t.return;return t.tag===3?t.stateNode:null}var _i={};function ry(t,r,i,c){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Na(t,r,i,c){return new ry(t,r,i,c)}function Yc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Zr(t,r){var i=t.alternate;return i===null?(i=Na(t.tag,r,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=r,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&65011712,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,r=t.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i.refCleanup=t.refCleanup,i}function Od(t,r){t.flags&=65011714;var i=t.alternate;return i===null?(t.childLanes=0,t.lanes=r,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,t.type=i.type,r=i.dependencies,t.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t}function wo(t,r,i,c,d,m){var k=0;if(c=t,typeof t=="function")Yc(t)&&(k=1);else if(typeof t=="string")k=i1(t,i,Ue.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case ae:return t=Na(31,i,r,d),t.elementType=ae,t.lanes=m,t;case M:return si(i.children,d,m,r);case R:k=8,d|=24;break;case I:return t=Na(12,i,r,d|2),t.elementType=I,t.lanes=m,t;case _:return t=Na(13,i,r,d),t.elementType=_,t.lanes=m,t;case G:return t=Na(19,i,r,d),t.elementType=G,t.lanes=m,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case H:case D:k=10;break e;case B:k=9;break e;case j:k=11;break e;case Y:k=14;break e;case J:k=16,c=null;break e}k=29,i=Error(s(130,t===null?"null":typeof t,"")),c=null}return r=Na(k,i,r,d),r.elementType=t,r.type=c,r.lanes=m,r}function si(t,r,i,c){return t=Na(7,t,c,r),t.lanes=i,t}function qc(t,r,i){return t=Na(6,t,null,r),t.lanes=i,t}function Vc(t,r,i){return r=Na(4,t.children!==null?t.children:[],t.key,r),r.lanes=i,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}var Oi=[],Ii=0,Eo=null,Ao=0,Za=[],Qa=0,ii=null,Qr=1,Kr="";function li(t,r){Oi[Ii++]=Ao,Oi[Ii++]=Eo,Eo=t,Ao=r}function Id(t,r,i){Za[Qa++]=Qr,Za[Qa++]=Kr,Za[Qa++]=ii,ii=t;var c=Qr;t=Kr;var d=32-Xt(c)-1;c&=~(1<<d),i+=1;var m=32-Xt(r)+d;if(30<m){var k=d-d%5;m=(c&(1<<k)-1).toString(32),c>>=k,d-=k,Qr=1<<32-Xt(r)+d|i<<d|c,Kr=m+t}else Qr=1<<m|i<<d|c,Kr=t}function Xc(t){t.return!==null&&(li(t,1),Id(t,1,0))}function $c(t){for(;t===Eo;)Eo=Oi[--Ii],Oi[Ii]=null,Ao=Oi[--Ii],Oi[Ii]=null;for(;t===ii;)ii=Za[--Qa],Za[Qa]=null,Kr=Za[--Qa],Za[Qa]=null,Qr=Za[--Qa],Za[Qa]=null}var oa=null,rn=null,Nt=!1,oi=null,_r=!1,Wc=Error(s(519));function ci(t){var r=Error(s(418,""));throw vl($a(r,t)),Wc}function Ld(t){var r=t.stateNode,i=t.type,c=t.memoizedProps;switch(r[kt]=t,r[gn]=c,i){case"dialog":bt("cancel",r),bt("close",r);break;case"iframe":case"object":case"embed":bt("load",r);break;case"video":case"audio":for(i=0;i<Gl.length;i++)bt(Gl[i],r);break;case"source":bt("error",r);break;case"img":case"image":case"link":bt("error",r),bt("load",r);break;case"details":bt("toggle",r);break;case"input":bt("invalid",r),hs(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),sr(r);break;case"select":bt("invalid",r);break;case"textarea":bt("invalid",r),ms(r,c.value,c.defaultValue,c.children),sr(r)}i=c.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||r.textContent===""+i||c.suppressHydrationWarning===!0||Kh(r.textContent,i)?(c.popover!=null&&(bt("beforetoggle",r),bt("toggle",r)),c.onScroll!=null&&bt("scroll",r),c.onScrollEnd!=null&&bt("scrollend",r),c.onClick!=null&&(r.onclick=rc),r=!0):r=!1,r||ci(t)}function Ud(t){for(oa=t.return;oa;)switch(oa.tag){case 5:case 13:_r=!1;return;case 27:case 3:_r=!0;return;default:oa=oa.return}}function gl(t){if(t!==oa)return!1;if(!Nt)return Ud(t),Nt=!0,!1;var r=t.tag,i;if((i=r!==3&&r!==27)&&((i=r===5)&&(i=t.type,i=!(i!=="form"&&i!=="button")||df(t.type,t.memoizedProps)),i=!i),i&&rn&&ci(t),Ud(t),r===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8)if(i=t.data,i==="/$"){if(r===0){rn=gr(t.nextSibling);break e}r--}else i!=="$"&&i!=="$!"&&i!=="$?"||r++;t=t.nextSibling}rn=null}}else r===27?(r=rn,Fs(t.type)?(t=gf,gf=null,rn=t):rn=r):rn=oa?gr(t.stateNode.nextSibling):null;return!0}function yl(){rn=oa=null,Nt=!1}function jd(){var t=oi;return t!==null&&(ya===null?ya=t:ya.push.apply(ya,t),oi=null),t}function vl(t){oi===null?oi=[t]:oi.push(t)}var Zc=Q(null),ui=null,Jr=null;function As(t,r,i){Re(Zc,r._currentValue),r._currentValue=i}function es(t){t._currentValue=Zc.current,ve(Zc)}function Qc(t,r,i){for(;t!==null;){var c=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),t===i)break;t=t.return}}function Kc(t,r,i,c){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var m=d.dependencies;if(m!==null){var k=d.child;m=m.firstContext;e:for(;m!==null;){var U=m;m=d;for(var ne=0;ne<r.length;ne++)if(U.context===r[ne]){m.lanes|=i,U=m.alternate,U!==null&&(U.lanes|=i),Qc(m.return,i,t),c||(k=null);break e}m=U.next}}else if(d.tag===18){if(k=d.return,k===null)throw Error(s(341));k.lanes|=i,m=k.alternate,m!==null&&(m.lanes|=i),Qc(k,i,t),k=null}else k=d.child;if(k!==null)k.return=d;else for(k=d;k!==null;){if(k===t){k=null;break}if(d=k.sibling,d!==null){d.return=k.return,k=d;break}k=k.return}d=k}}function bl(t,r,i,c){t=null;for(var d=r,m=!1;d!==null;){if(!m){if((d.flags&524288)!==0)m=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var k=d.alternate;if(k===null)throw Error(s(387));if(k=k.memoizedProps,k!==null){var U=d.type;sa(d.pendingProps.value,k.value)||(t!==null?t.push(U):t=[U])}}else if(d===ze.current){if(k=d.alternate,k===null)throw Error(s(387));k.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push($l):t=[$l])}d=d.return}t!==null&&Kc(r,t,i,c),r.flags|=262144}function To(t){for(t=t.firstContext;t!==null;){if(!sa(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function fi(t){ui=t,Jr=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Kn(t){return Bd(ui,t)}function Co(t,r){return ui===null&&fi(t),Bd(t,r)}function Bd(t,r){var i=r._currentValue;if(r={context:r,memoizedValue:i,next:null},Jr===null){if(t===null)throw Error(s(308));Jr=r,t.dependencies={lanes:0,firstContext:r},t.flags|=524288}else Jr=Jr.next=r;return i}var sy=typeof AbortController<"u"?AbortController:function(){var t=[],r=this.signal={aborted:!1,addEventListener:function(i,c){t.push(c)}};this.abort=function(){r.aborted=!0,t.forEach(function(i){return i()})}},iy=n.unstable_scheduleCallback,ly=n.unstable_NormalPriority,Tn={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jc(){return{controller:new sy,data:new Map,refCount:0}}function xl(t){t.refCount--,t.refCount===0&&iy(ly,function(){t.controller.abort()})}var Sl=null,eu=0,Li=0,Ui=null;function oy(t,r){if(Sl===null){var i=Sl=[];eu=0,Li=nf(),Ui={status:"pending",value:void 0,then:function(c){i.push(c)}}}return eu++,r.then(Fd,Fd),r}function Fd(){if(--eu===0&&Sl!==null){Ui!==null&&(Ui.status="fulfilled");var t=Sl;Sl=null,Li=0,Ui=null;for(var r=0;r<t.length;r++)(0,t[r])()}}function cy(t,r){var i=[],c={status:"pending",value:null,reason:null,then:function(d){i.push(d)}};return t.then(function(){c.status="fulfilled",c.value=r;for(var d=0;d<i.length;d++)(0,i[d])(r)},function(d){for(c.status="rejected",c.reason=d,d=0;d<i.length;d++)(0,i[d])(void 0)}),c}var Pd=V.S;V.S=function(t,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&oy(t,r),Pd!==null&&Pd(t,r)};var di=Q(null);function tu(){var t=di.current;return t!==null?t:Vt.pooledCache}function Mo(t,r){r===null?Re(di,di.current):Re(di,r.pool)}function zd(){var t=tu();return t===null?null:{parent:Tn._currentValue,pool:t}}var wl=Error(s(460)),Gd=Error(s(474)),No=Error(s(542)),nu={then:function(){}};function Hd(t){return t=t.status,t==="fulfilled"||t==="rejected"}function ko(){}function Yd(t,r,i){switch(i=t[i],i===void 0?t.push(r):i!==r&&(r.then(ko,ko),r=i),r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Vd(t),t;default:if(typeof r.status=="string")r.then(ko,ko);else{if(t=Vt,t!==null&&100<t.shellSuspendCounter)throw Error(s(482));t=r,t.status="pending",t.then(function(c){if(r.status==="pending"){var d=r;d.status="fulfilled",d.value=c}},function(c){if(r.status==="pending"){var d=r;d.status="rejected",d.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw t=r.reason,Vd(t),t}throw El=r,wl}}var El=null;function qd(){if(El===null)throw Error(s(459));var t=El;return El=null,t}function Vd(t){if(t===wl||t===No)throw Error(s(483))}var Ts=!1;function au(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ru(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Cs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ms(t,r,i){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,(Ot&2)!==0){var d=c.pending;return d===null?r.next=r:(r.next=d.next,d.next=r),c.pending=r,r=So(t),_d(t,null,i),r}return xo(t,c,r,i),So(t)}function Al(t,r,i){if(r=r.updateQueue,r!==null&&(r=r.shared,(i&4194048)!==0)){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Hr(t,i)}}function su(t,r){var i=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,i===c)){var d=null,m=null;if(i=i.firstBaseUpdate,i!==null){do{var k={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};m===null?d=m=k:m=m.next=k,i=i.next}while(i!==null);m===null?d=m=r:m=m.next=r}else d=m=r;i={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:c.shared,callbacks:c.callbacks},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=r:t.next=r,i.lastBaseUpdate=r}var iu=!1;function Tl(){if(iu){var t=Ui;if(t!==null)throw t}}function Cl(t,r,i,c){iu=!1;var d=t.updateQueue;Ts=!1;var m=d.firstBaseUpdate,k=d.lastBaseUpdate,U=d.shared.pending;if(U!==null){d.shared.pending=null;var ne=U,pe=ne.next;ne.next=null,k===null?m=pe:k.next=pe,k=ne;var Ee=t.alternate;Ee!==null&&(Ee=Ee.updateQueue,U=Ee.lastBaseUpdate,U!==k&&(U===null?Ee.firstBaseUpdate=pe:U.next=pe,Ee.lastBaseUpdate=ne))}if(m!==null){var Ne=d.baseState;k=0,Ee=pe=ne=null,U=m;do{var he=U.lane&-536870913,me=he!==U.lane;if(me?(wt&he)===he:(c&he)===he){he!==0&&he===Li&&(iu=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var st=t,Je=U;he=r;var Ft=i;switch(Je.tag){case 1:if(st=Je.payload,typeof st=="function"){Ne=st.call(Ft,Ne,he);break e}Ne=st;break e;case 3:st.flags=st.flags&-65537|128;case 0:if(st=Je.payload,he=typeof st=="function"?st.call(Ft,Ne,he):st,he==null)break e;Ne=b({},Ne,he);break e;case 2:Ts=!0}}he=U.callback,he!==null&&(t.flags|=64,me&&(t.flags|=8192),me=d.callbacks,me===null?d.callbacks=[he]:me.push(he))}else me={lane:he,tag:U.tag,payload:U.payload,callback:U.callback,next:null},Ee===null?(pe=Ee=me,ne=Ne):Ee=Ee.next=me,k|=he;if(U=U.next,U===null){if(U=d.shared.pending,U===null)break;me=U,U=me.next,me.next=null,d.lastBaseUpdate=me,d.shared.pending=null}}while(!0);Ee===null&&(ne=Ne),d.baseState=ne,d.firstBaseUpdate=pe,d.lastBaseUpdate=Ee,m===null&&(d.shared.lanes=0),Ls|=k,t.lanes=k,t.memoizedState=Ne}}function Xd(t,r){if(typeof t!="function")throw Error(s(191,t));t.call(r)}function $d(t,r){var i=t.callbacks;if(i!==null)for(t.callbacks=null,t=0;t<i.length;t++)Xd(i[t],r)}var ji=Q(null),Ro=Q(0);function Wd(t,r){t=ls,Re(Ro,t),Re(ji,r),ls=t|r.baseLanes}function lu(){Re(Ro,ls),Re(ji,ji.current)}function ou(){ls=Ro.current,ve(ji),ve(Ro)}var Ns=0,gt=null,jt=null,bn=null,Do=!1,Bi=!1,pi=!1,_o=0,Ml=0,Fi=null,uy=0;function un(){throw Error(s(321))}function cu(t,r){if(r===null)return!1;for(var i=0;i<r.length&&i<t.length;i++)if(!sa(t[i],r[i]))return!1;return!0}function uu(t,r,i,c,d,m){return Ns=m,gt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,V.H=t===null||t.memoizedState===null?_p:Op,pi=!1,m=i(c,d),pi=!1,Bi&&(m=Qd(r,i,c,d)),Zd(t),m}function Zd(t){V.H=Bo;var r=jt!==null&&jt.next!==null;if(Ns=0,bn=jt=gt=null,Do=!1,Ml=0,Fi=null,r)throw Error(s(300));t===null||kn||(t=t.dependencies,t!==null&&To(t)&&(kn=!0))}function Qd(t,r,i,c){gt=t;var d=0;do{if(Bi&&(Fi=null),Ml=0,Bi=!1,25<=d)throw Error(s(301));if(d+=1,bn=jt=null,t.updateQueue!=null){var m=t.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}V.H=yy,m=r(i,c)}while(Bi);return m}function fy(){var t=V.H,r=t.useState()[0];return r=typeof r.then=="function"?Nl(r):r,t=t.useState()[0],(jt!==null?jt.memoizedState:null)!==t&&(gt.flags|=1024),r}function fu(){var t=_o!==0;return _o=0,t}function du(t,r,i){r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~i}function pu(t){if(Do){for(t=t.memoizedState;t!==null;){var r=t.queue;r!==null&&(r.pending=null),t=t.next}Do=!1}Ns=0,bn=jt=gt=null,Bi=!1,Ml=_o=0,Fi=null}function ma(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?gt.memoizedState=bn=t:bn=bn.next=t,bn}function xn(){if(jt===null){var t=gt.alternate;t=t!==null?t.memoizedState:null}else t=jt.next;var r=bn===null?gt.memoizedState:bn.next;if(r!==null)bn=r,jt=t;else{if(t===null)throw gt.alternate===null?Error(s(467)):Error(s(310));jt=t,t={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},bn===null?gt.memoizedState=bn=t:bn=bn.next=t}return bn}function hu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Nl(t){var r=Ml;return Ml+=1,Fi===null&&(Fi=[]),t=Yd(Fi,t,r),r=gt,(bn===null?r.memoizedState:bn.next)===null&&(r=r.alternate,V.H=r===null||r.memoizedState===null?_p:Op),t}function Oo(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Nl(t);if(t.$$typeof===D)return Kn(t)}throw Error(s(438,String(t)))}function mu(t){var r=null,i=gt.updateQueue;if(i!==null&&(r=i.memoCache),r==null){var c=gt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(d){return d.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),i===null&&(i=hu(),gt.updateQueue=i),i.memoCache=r,i=r.data[r.index],i===void 0)for(i=r.data[r.index]=Array(t),c=0;c<t;c++)i[c]=re;return r.index++,i}function ts(t,r){return typeof r=="function"?r(t):r}function Io(t){var r=xn();return gu(r,jt,t)}function gu(t,r,i){var c=t.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=i;var d=t.baseQueue,m=c.pending;if(m!==null){if(d!==null){var k=d.next;d.next=m.next,m.next=k}r.baseQueue=d=m,c.pending=null}if(m=t.baseState,d===null)t.memoizedState=m;else{r=d.next;var U=k=null,ne=null,pe=r,Ee=!1;do{var Ne=pe.lane&-536870913;if(Ne!==pe.lane?(wt&Ne)===Ne:(Ns&Ne)===Ne){var he=pe.revertLane;if(he===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),Ne===Li&&(Ee=!0);else if((Ns&he)===he){pe=pe.next,he===Li&&(Ee=!0);continue}else Ne={lane:0,revertLane:pe.revertLane,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},ne===null?(U=ne=Ne,k=m):ne=ne.next=Ne,gt.lanes|=he,Ls|=he;Ne=pe.action,pi&&i(m,Ne),m=pe.hasEagerState?pe.eagerState:i(m,Ne)}else he={lane:Ne,revertLane:pe.revertLane,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null},ne===null?(U=ne=he,k=m):ne=ne.next=he,gt.lanes|=Ne,Ls|=Ne;pe=pe.next}while(pe!==null&&pe!==r);if(ne===null?k=m:ne.next=U,!sa(m,t.memoizedState)&&(kn=!0,Ee&&(i=Ui,i!==null)))throw i;t.memoizedState=m,t.baseState=k,t.baseQueue=ne,c.lastRenderedState=m}return d===null&&(c.lanes=0),[t.memoizedState,c.dispatch]}function yu(t){var r=xn(),i=r.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=t;var c=i.dispatch,d=i.pending,m=r.memoizedState;if(d!==null){i.pending=null;var k=d=d.next;do m=t(m,k.action),k=k.next;while(k!==d);sa(m,r.memoizedState)||(kn=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),i.lastRenderedState=m}return[m,c]}function Kd(t,r,i){var c=gt,d=xn(),m=Nt;if(m){if(i===void 0)throw Error(s(407));i=i()}else i=r();var k=!sa((jt||d).memoizedState,i);k&&(d.memoizedState=i,kn=!0),d=d.queue;var U=tp.bind(null,c,d,t);if(kl(2048,8,U,[t]),d.getSnapshot!==r||k||bn!==null&&bn.memoizedState.tag&1){if(c.flags|=2048,Pi(9,Lo(),ep.bind(null,c,d,i,r),null),Vt===null)throw Error(s(349));m||(Ns&124)!==0||Jd(c,r,i)}return i}function Jd(t,r,i){t.flags|=16384,t={getSnapshot:r,value:i},r=gt.updateQueue,r===null?(r=hu(),gt.updateQueue=r,r.stores=[t]):(i=r.stores,i===null?r.stores=[t]:i.push(t))}function ep(t,r,i,c){r.value=i,r.getSnapshot=c,np(r)&&ap(t)}function tp(t,r,i){return i(function(){np(r)&&ap(t)})}function np(t){var r=t.getSnapshot;t=t.value;try{var i=r();return!sa(t,i)}catch{return!0}}function ap(t){var r=Di(t,2);r!==null&&Oa(r,t,2)}function vu(t){var r=ma();if(typeof t=="function"){var i=t;if(t=i(),pi){qn(!0);try{i()}finally{qn(!1)}}}return r.memoizedState=r.baseState=t,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:t},r}function rp(t,r,i,c){return t.baseState=i,gu(t,jt,typeof c=="function"?c:ts)}function dy(t,r,i,c,d){if(jo(t))throw Error(s(485));if(t=r.action,t!==null){var m={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){m.listeners.push(k)}};V.T!==null?i(!0):m.isTransition=!1,c(m),i=r.pending,i===null?(m.next=r.pending=m,sp(r,m)):(m.next=i.next,r.pending=i.next=m)}}function sp(t,r){var i=r.action,c=r.payload,d=t.state;if(r.isTransition){var m=V.T,k={};V.T=k;try{var U=i(d,c),ne=V.S;ne!==null&&ne(k,U),ip(t,r,U)}catch(pe){bu(t,r,pe)}finally{V.T=m}}else try{m=i(d,c),ip(t,r,m)}catch(pe){bu(t,r,pe)}}function ip(t,r,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(c){lp(t,r,c)},function(c){return bu(t,r,c)}):lp(t,r,i)}function lp(t,r,i){r.status="fulfilled",r.value=i,op(r),t.state=i,r=t.pending,r!==null&&(i=r.next,i===r?t.pending=null:(i=i.next,r.next=i,sp(t,i)))}function bu(t,r,i){var c=t.pending;if(t.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=i,op(r),r=r.next;while(r!==c)}t.action=null}function op(t){t=t.listeners;for(var r=0;r<t.length;r++)(0,t[r])()}function cp(t,r){return r}function up(t,r){if(Nt){var i=Vt.formState;if(i!==null){e:{var c=gt;if(Nt){if(rn){t:{for(var d=rn,m=_r;d.nodeType!==8;){if(!m){d=null;break t}if(d=gr(d.nextSibling),d===null){d=null;break t}}m=d.data,d=m==="F!"||m==="F"?d:null}if(d){rn=gr(d.nextSibling),c=d.data==="F!";break e}}ci(c)}c=!1}c&&(r=i[0])}}return i=ma(),i.memoizedState=i.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cp,lastRenderedState:r},i.queue=c,i=kp.bind(null,gt,c),c.dispatch=i,c=vu(!1),m=Au.bind(null,gt,!1,c.queue),c=ma(),d={state:r,dispatch:null,action:t,pending:null},c.queue=d,i=dy.bind(null,gt,d,m,i),d.dispatch=i,c.memoizedState=t,[r,i,!1]}function fp(t){var r=xn();return dp(r,jt,t)}function dp(t,r,i){if(r=gu(t,r,cp)[0],t=Io(ts)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Nl(r)}catch(k){throw k===wl?No:k}else c=r;r=xn();var d=r.queue,m=d.dispatch;return i!==r.memoizedState&&(gt.flags|=2048,Pi(9,Lo(),py.bind(null,d,i),null)),[c,m,t]}function py(t,r){t.action=r}function pp(t){var r=xn(),i=jt;if(i!==null)return dp(r,i,t);xn(),r=r.memoizedState,i=xn();var c=i.queue.dispatch;return i.memoizedState=t,[r,c,!1]}function Pi(t,r,i,c){return t={tag:t,create:i,deps:c,inst:r,next:null},r=gt.updateQueue,r===null&&(r=hu(),gt.updateQueue=r),i=r.lastEffect,i===null?r.lastEffect=t.next=t:(c=i.next,i.next=t,t.next=c,r.lastEffect=t),t}function Lo(){return{destroy:void 0,resource:void 0}}function hp(){return xn().memoizedState}function Uo(t,r,i,c){var d=ma();c=c===void 0?null:c,gt.flags|=t,d.memoizedState=Pi(1|r,Lo(),i,c)}function kl(t,r,i,c){var d=xn();c=c===void 0?null:c;var m=d.memoizedState.inst;jt!==null&&c!==null&&cu(c,jt.memoizedState.deps)?d.memoizedState=Pi(r,m,i,c):(gt.flags|=t,d.memoizedState=Pi(1|r,m,i,c))}function mp(t,r){Uo(8390656,8,t,r)}function gp(t,r){kl(2048,8,t,r)}function yp(t,r){return kl(4,2,t,r)}function vp(t,r){return kl(4,4,t,r)}function bp(t,r){if(typeof r=="function"){t=t();var i=r(t);return function(){typeof i=="function"?i():r(null)}}if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function xp(t,r,i){i=i!=null?i.concat([t]):null,kl(4,4,bp.bind(null,r,t),i)}function xu(){}function Sp(t,r){var i=xn();r=r===void 0?null:r;var c=i.memoizedState;return r!==null&&cu(r,c[1])?c[0]:(i.memoizedState=[t,r],t)}function wp(t,r){var i=xn();r=r===void 0?null:r;var c=i.memoizedState;if(r!==null&&cu(r,c[1]))return c[0];if(c=t(),pi){qn(!0);try{t()}finally{qn(!1)}}return i.memoizedState=[c,r],c}function Su(t,r,i){return i===void 0||(Ns&1073741824)!==0?t.memoizedState=r:(t.memoizedState=i,t=Th(),gt.lanes|=t,Ls|=t,i)}function Ep(t,r,i,c){return sa(i,r)?i:ji.current!==null?(t=Su(t,i,c),sa(t,r)||(kn=!0),t):(Ns&42)===0?(kn=!0,t.memoizedState=i):(t=Th(),gt.lanes|=t,Ls|=t,r)}function Ap(t,r,i,c,d){var m=te.p;te.p=m!==0&&8>m?m:8;var k=V.T,U={};V.T=U,Au(t,!1,r,i);try{var ne=d(),pe=V.S;if(pe!==null&&pe(U,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Ee=cy(ne,c);Rl(t,r,Ee,_a(t))}else Rl(t,r,c,_a(t))}catch(Ne){Rl(t,r,{then:function(){},status:"rejected",reason:Ne},_a())}finally{te.p=m,V.T=k}}function hy(){}function wu(t,r,i,c){if(t.tag!==5)throw Error(s(476));var d=Tp(t).queue;Ap(t,d,r,ce,i===null?hy:function(){return Cp(t),i(c)})}function Tp(t){var r=t.memoizedState;if(r!==null)return r;r={memoizedState:ce,baseState:ce,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:ce},next:null};var i={};return r.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:i},next:null},t.memoizedState=r,t=t.alternate,t!==null&&(t.memoizedState=r),r}function Cp(t){var r=Tp(t).next.queue;Rl(t,r,{},_a())}function Eu(){return Kn($l)}function Mp(){return xn().memoizedState}function Np(){return xn().memoizedState}function my(t){for(var r=t.return;r!==null;){switch(r.tag){case 24:case 3:var i=_a();t=Cs(i);var c=Ms(r,t,i);c!==null&&(Oa(c,r,i),Al(c,r,i)),r={cache:Jc()},t.payload=r;return}r=r.return}}function gy(t,r,i){var c=_a();i={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null},jo(t)?Rp(r,i):(i=Hc(t,r,i,c),i!==null&&(Oa(i,t,c),Dp(i,r,c)))}function kp(t,r,i){var c=_a();Rl(t,r,i,c)}function Rl(t,r,i,c){var d={lane:c,revertLane:0,action:i,hasEagerState:!1,eagerState:null,next:null};if(jo(t))Rp(r,d);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var k=r.lastRenderedState,U=m(k,i);if(d.hasEagerState=!0,d.eagerState=U,sa(U,k))return xo(t,r,d,0),Vt===null&&bo(),!1}catch{}if(i=Hc(t,r,d,c),i!==null)return Oa(i,t,c),Dp(i,r,c),!0}return!1}function Au(t,r,i,c){if(c={lane:2,revertLane:nf(),action:c,hasEagerState:!1,eagerState:null,next:null},jo(t)){if(r)throw Error(s(479))}else r=Hc(t,i,c,2),r!==null&&Oa(r,t,2)}function jo(t){var r=t.alternate;return t===gt||r!==null&&r===gt}function Rp(t,r){Bi=Do=!0;var i=t.pending;i===null?r.next=r:(r.next=i.next,i.next=r),t.pending=r}function Dp(t,r,i){if((i&4194048)!==0){var c=r.lanes;c&=t.pendingLanes,i|=c,r.lanes=i,Hr(t,i)}}var Bo={readContext:Kn,use:Oo,useCallback:un,useContext:un,useEffect:un,useImperativeHandle:un,useLayoutEffect:un,useInsertionEffect:un,useMemo:un,useReducer:un,useRef:un,useState:un,useDebugValue:un,useDeferredValue:un,useTransition:un,useSyncExternalStore:un,useId:un,useHostTransitionStatus:un,useFormState:un,useActionState:un,useOptimistic:un,useMemoCache:un,useCacheRefresh:un},_p={readContext:Kn,use:Oo,useCallback:function(t,r){return ma().memoizedState=[t,r===void 0?null:r],t},useContext:Kn,useEffect:mp,useImperativeHandle:function(t,r,i){i=i!=null?i.concat([t]):null,Uo(4194308,4,bp.bind(null,r,t),i)},useLayoutEffect:function(t,r){return Uo(4194308,4,t,r)},useInsertionEffect:function(t,r){Uo(4,2,t,r)},useMemo:function(t,r){var i=ma();r=r===void 0?null:r;var c=t();if(pi){qn(!0);try{t()}finally{qn(!1)}}return i.memoizedState=[c,r],c},useReducer:function(t,r,i){var c=ma();if(i!==void 0){var d=i(r);if(pi){qn(!0);try{i(r)}finally{qn(!1)}}}else d=r;return c.memoizedState=c.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},c.queue=t,t=t.dispatch=gy.bind(null,gt,t),[c.memoizedState,t]},useRef:function(t){var r=ma();return t={current:t},r.memoizedState=t},useState:function(t){t=vu(t);var r=t.queue,i=kp.bind(null,gt,r);return r.dispatch=i,[t.memoizedState,i]},useDebugValue:xu,useDeferredValue:function(t,r){var i=ma();return Su(i,t,r)},useTransition:function(){var t=vu(!1);return t=Ap.bind(null,gt,t.queue,!0,!1),ma().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,r,i){var c=gt,d=ma();if(Nt){if(i===void 0)throw Error(s(407));i=i()}else{if(i=r(),Vt===null)throw Error(s(349));(wt&124)!==0||Jd(c,r,i)}d.memoizedState=i;var m={value:i,getSnapshot:r};return d.queue=m,mp(tp.bind(null,c,m,t),[t]),c.flags|=2048,Pi(9,Lo(),ep.bind(null,c,m,i,r),null),i},useId:function(){var t=ma(),r=Vt.identifierPrefix;if(Nt){var i=Kr,c=Qr;i=(c&~(1<<32-Xt(c)-1)).toString(32)+i,r=""+r+"R"+i,i=_o++,0<i&&(r+="H"+i.toString(32)),r+=""}else i=uy++,r=""+r+"r"+i.toString(32)+"";return t.memoizedState=r},useHostTransitionStatus:Eu,useFormState:up,useActionState:up,useOptimistic:function(t){var r=ma();r.memoizedState=r.baseState=t;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=i,r=Au.bind(null,gt,!0,i),i.dispatch=r,[t,r]},useMemoCache:mu,useCacheRefresh:function(){return ma().memoizedState=my.bind(null,gt)}},Op={readContext:Kn,use:Oo,useCallback:Sp,useContext:Kn,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:wp,useReducer:Io,useRef:hp,useState:function(){return Io(ts)},useDebugValue:xu,useDeferredValue:function(t,r){var i=xn();return Ep(i,jt.memoizedState,t,r)},useTransition:function(){var t=Io(ts)[0],r=xn().memoizedState;return[typeof t=="boolean"?t:Nl(t),r]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:Eu,useFormState:fp,useActionState:fp,useOptimistic:function(t,r){var i=xn();return rp(i,jt,t,r)},useMemoCache:mu,useCacheRefresh:Np},yy={readContext:Kn,use:Oo,useCallback:Sp,useContext:Kn,useEffect:gp,useImperativeHandle:xp,useInsertionEffect:yp,useLayoutEffect:vp,useMemo:wp,useReducer:yu,useRef:hp,useState:function(){return yu(ts)},useDebugValue:xu,useDeferredValue:function(t,r){var i=xn();return jt===null?Su(i,t,r):Ep(i,jt.memoizedState,t,r)},useTransition:function(){var t=yu(ts)[0],r=xn().memoizedState;return[typeof t=="boolean"?t:Nl(t),r]},useSyncExternalStore:Kd,useId:Mp,useHostTransitionStatus:Eu,useFormState:pp,useActionState:pp,useOptimistic:function(t,r){var i=xn();return jt!==null?rp(i,jt,t,r):(i.baseState=t,[t,i.queue.dispatch])},useMemoCache:mu,useCacheRefresh:Np},zi=null,Dl=0;function Fo(t){var r=Dl;return Dl+=1,zi===null&&(zi=[]),Yd(zi,t,r)}function _l(t,r){r=r.props.ref,t.ref=r!==void 0?r:null}function Po(t,r){throw r.$$typeof===C?Error(s(525)):(t=Object.prototype.toString.call(r),Error(s(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t)))}function Ip(t){var r=t._init;return r(t._payload)}function Lp(t){function r(ue,se){if(t){var de=ue.deletions;de===null?(ue.deletions=[se],ue.flags|=16):de.push(se)}}function i(ue,se){if(!t)return null;for(;se!==null;)r(ue,se),se=se.sibling;return null}function c(ue){for(var se=new Map;ue!==null;)ue.key!==null?se.set(ue.key,ue):se.set(ue.index,ue),ue=ue.sibling;return se}function d(ue,se){return ue=Zr(ue,se),ue.index=0,ue.sibling=null,ue}function m(ue,se,de){return ue.index=de,t?(de=ue.alternate,de!==null?(de=de.index,de<se?(ue.flags|=67108866,se):de):(ue.flags|=67108866,se)):(ue.flags|=1048576,se)}function k(ue){return t&&ue.alternate===null&&(ue.flags|=67108866),ue}function U(ue,se,de,Te){return se===null||se.tag!==6?(se=qc(de,ue.mode,Te),se.return=ue,se):(se=d(se,de),se.return=ue,se)}function ne(ue,se,de,Te){var He=de.type;return He===M?Ee(ue,se,de.props.children,Te,de.key):se!==null&&(se.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===J&&Ip(He)===se.type)?(se=d(se,de.props),_l(se,de),se.return=ue,se):(se=wo(de.type,de.key,de.props,null,ue.mode,Te),_l(se,de),se.return=ue,se)}function pe(ue,se,de,Te){return se===null||se.tag!==4||se.stateNode.containerInfo!==de.containerInfo||se.stateNode.implementation!==de.implementation?(se=Vc(de,ue.mode,Te),se.return=ue,se):(se=d(se,de.children||[]),se.return=ue,se)}function Ee(ue,se,de,Te,He){return se===null||se.tag!==7?(se=si(de,ue.mode,Te,He),se.return=ue,se):(se=d(se,de),se.return=ue,se)}function Ne(ue,se,de){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=qc(""+se,ue.mode,de),se.return=ue,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case w:return de=wo(se.type,se.key,se.props,null,ue.mode,de),_l(de,se),de.return=ue,de;case x:return se=Vc(se,ue.mode,de),se.return=ue,se;case J:var Te=se._init;return se=Te(se._payload),Ne(ue,se,de)}if(ee(se)||W(se))return se=si(se,ue.mode,de,null),se.return=ue,se;if(typeof se.then=="function")return Ne(ue,Fo(se),de);if(se.$$typeof===D)return Ne(ue,Co(ue,se),de);Po(ue,se)}return null}function he(ue,se,de,Te){var He=se!==null?se.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return He!==null?null:U(ue,se,""+de,Te);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case w:return de.key===He?ne(ue,se,de,Te):null;case x:return de.key===He?pe(ue,se,de,Te):null;case J:return He=de._init,de=He(de._payload),he(ue,se,de,Te)}if(ee(de)||W(de))return He!==null?null:Ee(ue,se,de,Te,null);if(typeof de.then=="function")return he(ue,se,Fo(de),Te);if(de.$$typeof===D)return he(ue,se,Co(ue,de),Te);Po(ue,de)}return null}function me(ue,se,de,Te,He){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return ue=ue.get(de)||null,U(se,ue,""+Te,He);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case w:return ue=ue.get(Te.key===null?de:Te.key)||null,ne(se,ue,Te,He);case x:return ue=ue.get(Te.key===null?de:Te.key)||null,pe(se,ue,Te,He);case J:var yt=Te._init;return Te=yt(Te._payload),me(ue,se,de,Te,He)}if(ee(Te)||W(Te))return ue=ue.get(de)||null,Ee(se,ue,Te,He,null);if(typeof Te.then=="function")return me(ue,se,de,Fo(Te),He);if(Te.$$typeof===D)return me(ue,se,de,Co(se,Te),He);Po(se,Te)}return null}function st(ue,se,de,Te){for(var He=null,yt=null,We=se,tt=se=0,Dn=null;We!==null&&tt<de.length;tt++){We.index>tt?(Dn=We,We=null):Dn=We.sibling;var Tt=he(ue,We,de[tt],Te);if(Tt===null){We===null&&(We=Dn);break}t&&We&&Tt.alternate===null&&r(ue,We),se=m(Tt,se,tt),yt===null?He=Tt:yt.sibling=Tt,yt=Tt,We=Dn}if(tt===de.length)return i(ue,We),Nt&&li(ue,tt),He;if(We===null){for(;tt<de.length;tt++)We=Ne(ue,de[tt],Te),We!==null&&(se=m(We,se,tt),yt===null?He=We:yt.sibling=We,yt=We);return Nt&&li(ue,tt),He}for(We=c(We);tt<de.length;tt++)Dn=me(We,ue,tt,de[tt],Te),Dn!==null&&(t&&Dn.alternate!==null&&We.delete(Dn.key===null?tt:Dn.key),se=m(Dn,se,tt),yt===null?He=Dn:yt.sibling=Dn,yt=Dn);return t&&We.forEach(function(Ys){return r(ue,Ys)}),Nt&&li(ue,tt),He}function Je(ue,se,de,Te){if(de==null)throw Error(s(151));for(var He=null,yt=null,We=se,tt=se=0,Dn=null,Tt=de.next();We!==null&&!Tt.done;tt++,Tt=de.next()){We.index>tt?(Dn=We,We=null):Dn=We.sibling;var Ys=he(ue,We,Tt.value,Te);if(Ys===null){We===null&&(We=Dn);break}t&&We&&Ys.alternate===null&&r(ue,We),se=m(Ys,se,tt),yt===null?He=Ys:yt.sibling=Ys,yt=Ys,We=Dn}if(Tt.done)return i(ue,We),Nt&&li(ue,tt),He;if(We===null){for(;!Tt.done;tt++,Tt=de.next())Tt=Ne(ue,Tt.value,Te),Tt!==null&&(se=m(Tt,se,tt),yt===null?He=Tt:yt.sibling=Tt,yt=Tt);return Nt&&li(ue,tt),He}for(We=c(We);!Tt.done;tt++,Tt=de.next())Tt=me(We,ue,tt,Tt.value,Te),Tt!==null&&(t&&Tt.alternate!==null&&We.delete(Tt.key===null?tt:Tt.key),se=m(Tt,se,tt),yt===null?He=Tt:yt.sibling=Tt,yt=Tt);return t&&We.forEach(function(v1){return r(ue,v1)}),Nt&&li(ue,tt),He}function Ft(ue,se,de,Te){if(typeof de=="object"&&de!==null&&de.type===M&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case w:e:{for(var He=de.key;se!==null;){if(se.key===He){if(He=de.type,He===M){if(se.tag===7){i(ue,se.sibling),Te=d(se,de.props.children),Te.return=ue,ue=Te;break e}}else if(se.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===J&&Ip(He)===se.type){i(ue,se.sibling),Te=d(se,de.props),_l(Te,de),Te.return=ue,ue=Te;break e}i(ue,se);break}else r(ue,se);se=se.sibling}de.type===M?(Te=si(de.props.children,ue.mode,Te,de.key),Te.return=ue,ue=Te):(Te=wo(de.type,de.key,de.props,null,ue.mode,Te),_l(Te,de),Te.return=ue,ue=Te)}return k(ue);case x:e:{for(He=de.key;se!==null;){if(se.key===He)if(se.tag===4&&se.stateNode.containerInfo===de.containerInfo&&se.stateNode.implementation===de.implementation){i(ue,se.sibling),Te=d(se,de.children||[]),Te.return=ue,ue=Te;break e}else{i(ue,se);break}else r(ue,se);se=se.sibling}Te=Vc(de,ue.mode,Te),Te.return=ue,ue=Te}return k(ue);case J:return He=de._init,de=He(de._payload),Ft(ue,se,de,Te)}if(ee(de))return st(ue,se,de,Te);if(W(de)){if(He=W(de),typeof He!="function")throw Error(s(150));return de=He.call(de),Je(ue,se,de,Te)}if(typeof de.then=="function")return Ft(ue,se,Fo(de),Te);if(de.$$typeof===D)return Ft(ue,se,Co(ue,de),Te);Po(ue,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,se!==null&&se.tag===6?(i(ue,se.sibling),Te=d(se,de),Te.return=ue,ue=Te):(i(ue,se),Te=qc(de,ue.mode,Te),Te.return=ue,ue=Te),k(ue)):i(ue,se)}return function(ue,se,de,Te){try{Dl=0;var He=Ft(ue,se,de,Te);return zi=null,He}catch(We){if(We===wl||We===No)throw We;var yt=Na(29,We,null,ue.mode);return yt.lanes=Te,yt.return=ue,yt}}}var Gi=Lp(!0),Up=Lp(!1),Ka=Q(null),Or=null;function ks(t){var r=t.alternate;Re(Cn,Cn.current&1),Re(Ka,t),Or===null&&(r===null||ji.current!==null||r.memoizedState!==null)&&(Or=t)}function jp(t){if(t.tag===22){if(Re(Cn,Cn.current),Re(Ka,t),Or===null){var r=t.alternate;r!==null&&r.memoizedState!==null&&(Or=t)}}else Rs()}function Rs(){Re(Cn,Cn.current),Re(Ka,Ka.current)}function ns(t){ve(Ka),Or===t&&(Or=null),ve(Cn)}var Cn=Q(0);function zo(t){for(var r=t;r!==null;){if(r.tag===13){var i=r.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||mf(i)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function Tu(t,r,i,c){r=t.memoizedState,i=i(c,r),i=i==null?r:b({},r,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Cu={enqueueSetState:function(t,r,i){t=t._reactInternals;var c=_a(),d=Cs(c);d.payload=r,i!=null&&(d.callback=i),r=Ms(t,d,c),r!==null&&(Oa(r,t,c),Al(r,t,c))},enqueueReplaceState:function(t,r,i){t=t._reactInternals;var c=_a(),d=Cs(c);d.tag=1,d.payload=r,i!=null&&(d.callback=i),r=Ms(t,d,c),r!==null&&(Oa(r,t,c),Al(r,t,c))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var i=_a(),c=Cs(i);c.tag=2,r!=null&&(c.callback=r),r=Ms(t,c,i),r!==null&&(Oa(r,t,i),Al(r,t,i))}};function Bp(t,r,i,c,d,m,k){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,m,k):r.prototype&&r.prototype.isPureReactComponent?!ia(i,c)||!ia(d,m):!0}function Fp(t,r,i,c){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(i,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(i,c),r.state!==t&&Cu.enqueueReplaceState(r,r.state,null)}function hi(t,r){var i=r;if("ref"in r){i={};for(var c in r)c!=="ref"&&(i[c]=r[c])}if(t=t.defaultProps){i===r&&(i=b({},i));for(var d in t)i[d]===void 0&&(i[d]=t[d])}return i}var Go=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)};function Pp(t){Go(t)}function zp(t){console.error(t)}function Gp(t){Go(t)}function Ho(t,r){try{var i=t.onUncaughtError;i(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function Hp(t,r,i){try{var c=t.onCaughtError;c(i.value,{componentStack:i.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function Mu(t,r,i){return i=Cs(i),i.tag=3,i.payload={element:null},i.callback=function(){Ho(t,r)},i}function Yp(t){return t=Cs(t),t.tag=3,t}function qp(t,r,i,c){var d=i.type.getDerivedStateFromError;if(typeof d=="function"){var m=c.value;t.payload=function(){return d(m)},t.callback=function(){Hp(r,i,c)}}var k=i.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(t.callback=function(){Hp(r,i,c),typeof d!="function"&&(Us===null?Us=new Set([this]):Us.add(this));var U=c.stack;this.componentDidCatch(c.value,{componentStack:U!==null?U:""})})}function vy(t,r,i,c,d){if(i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=i.alternate,r!==null&&bl(r,i,d,!0),i=Ka.current,i!==null){switch(i.tag){case 13:return Or===null?Qu():i.alternate===null&&sn===0&&(sn=3),i.flags&=-257,i.flags|=65536,i.lanes=d,c===nu?i.flags|=16384:(r=i.updateQueue,r===null?i.updateQueue=new Set([c]):r.add(c),Ju(t,c,d)),!1;case 22:return i.flags|=65536,c===nu?i.flags|=16384:(r=i.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},i.updateQueue=r):(i=r.retryQueue,i===null?r.retryQueue=new Set([c]):i.add(c)),Ju(t,c,d)),!1}throw Error(s(435,i.tag))}return Ju(t,c,d),Qu(),!1}if(Nt)return r=Ka.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=d,c!==Wc&&(t=Error(s(422),{cause:c}),vl($a(t,i)))):(c!==Wc&&(r=Error(s(423),{cause:c}),vl($a(r,i))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,c=$a(c,i),d=Mu(t.stateNode,c,d),su(t,d),sn!==4&&(sn=2)),!1;var m=Error(s(520),{cause:c});if(m=$a(m,i),Fl===null?Fl=[m]:Fl.push(m),sn!==4&&(sn=2),r===null)return!0;c=$a(c,i),i=r;do{switch(i.tag){case 3:return i.flags|=65536,t=d&-d,i.lanes|=t,t=Mu(i.stateNode,c,t),su(i,t),!1;case 1:if(r=i.type,m=i.stateNode,(i.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Us===null||!Us.has(m))))return i.flags|=65536,d&=-d,i.lanes|=d,d=Yp(d),qp(d,t,i,c),su(i,d),!1}i=i.return}while(i!==null);return!1}var Vp=Error(s(461)),kn=!1;function zn(t,r,i,c){r.child=t===null?Up(r,null,i,c):Gi(r,t.child,i,c)}function Xp(t,r,i,c,d){i=i.render;var m=r.ref;if("ref"in c){var k={};for(var U in c)U!=="ref"&&(k[U]=c[U])}else k=c;return fi(r),c=uu(t,r,i,k,m,d),U=fu(),t!==null&&!kn?(du(t,r,d),as(t,r,d)):(Nt&&U&&Xc(r),r.flags|=1,zn(t,r,c,d),r.child)}function $p(t,r,i,c,d){if(t===null){var m=i.type;return typeof m=="function"&&!Yc(m)&&m.defaultProps===void 0&&i.compare===null?(r.tag=15,r.type=m,Wp(t,r,m,c,d)):(t=wo(i.type,null,c,r,r.mode,d),t.ref=r.ref,t.return=r,r.child=t)}if(m=t.child,!Lu(t,d)){var k=m.memoizedProps;if(i=i.compare,i=i!==null?i:ia,i(k,c)&&t.ref===r.ref)return as(t,r,d)}return r.flags|=1,t=Zr(m,c),t.ref=r.ref,t.return=r,r.child=t}function Wp(t,r,i,c,d){if(t!==null){var m=t.memoizedProps;if(ia(m,c)&&t.ref===r.ref)if(kn=!1,r.pendingProps=c=m,Lu(t,d))(t.flags&131072)!==0&&(kn=!0);else return r.lanes=t.lanes,as(t,r,d)}return Nu(t,r,i,c,d)}function Zp(t,r,i){var c=r.pendingProps,d=c.children,m=t!==null?t.memoizedState:null;if(c.mode==="hidden"){if((r.flags&128)!==0){if(c=m!==null?m.baseLanes|i:i,t!==null){for(d=r.child=t.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;r.childLanes=m&~c}else r.childLanes=0,r.child=null;return Qp(t,r,c,i)}if((i&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},t!==null&&Mo(r,m!==null?m.cachePool:null),m!==null?Wd(r,m):lu(),jp(r);else return r.lanes=r.childLanes=536870912,Qp(t,r,m!==null?m.baseLanes|i:i,i)}else m!==null?(Mo(r,m.cachePool),Wd(r,m),Rs(),r.memoizedState=null):(t!==null&&Mo(r,null),lu(),Rs());return zn(t,r,d,i),r.child}function Qp(t,r,i,c){var d=tu();return d=d===null?null:{parent:Tn._currentValue,pool:d},r.memoizedState={baseLanes:i,cachePool:d},t!==null&&Mo(r,null),lu(),jp(r),t!==null&&bl(t,r,c,!0),null}function Yo(t,r){var i=r.ref;if(i===null)t!==null&&t.ref!==null&&(r.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(s(284));(t===null||t.ref!==i)&&(r.flags|=4194816)}}function Nu(t,r,i,c,d){return fi(r),i=uu(t,r,i,c,void 0,d),c=fu(),t!==null&&!kn?(du(t,r,d),as(t,r,d)):(Nt&&c&&Xc(r),r.flags|=1,zn(t,r,i,d),r.child)}function Kp(t,r,i,c,d,m){return fi(r),r.updateQueue=null,i=Qd(r,c,i,d),Zd(t),c=fu(),t!==null&&!kn?(du(t,r,m),as(t,r,m)):(Nt&&c&&Xc(r),r.flags|=1,zn(t,r,i,m),r.child)}function Jp(t,r,i,c,d){if(fi(r),r.stateNode===null){var m=_i,k=i.contextType;typeof k=="object"&&k!==null&&(m=Kn(k)),m=new i(c,m),r.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Cu,r.stateNode=m,m._reactInternals=r,m=r.stateNode,m.props=c,m.state=r.memoizedState,m.refs={},au(r),k=i.contextType,m.context=typeof k=="object"&&k!==null?Kn(k):_i,m.state=r.memoizedState,k=i.getDerivedStateFromProps,typeof k=="function"&&(Tu(r,i,k,c),m.state=r.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(k=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),k!==m.state&&Cu.enqueueReplaceState(m,m.state,null),Cl(r,c,m,d),Tl(),m.state=r.memoizedState),typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(t===null){m=r.stateNode;var U=r.memoizedProps,ne=hi(i,U);m.props=ne;var pe=m.context,Ee=i.contextType;k=_i,typeof Ee=="object"&&Ee!==null&&(k=Kn(Ee));var Ne=i.getDerivedStateFromProps;Ee=typeof Ne=="function"||typeof m.getSnapshotBeforeUpdate=="function",U=r.pendingProps!==U,Ee||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(U||pe!==k)&&Fp(r,m,c,k),Ts=!1;var he=r.memoizedState;m.state=he,Cl(r,c,m,d),Tl(),pe=r.memoizedState,U||he!==pe||Ts?(typeof Ne=="function"&&(Tu(r,i,Ne,c),pe=r.memoizedState),(ne=Ts||Bp(r,i,ne,c,he,pe,k))?(Ee||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(r.flags|=4194308)):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=pe),m.props=c,m.state=pe,m.context=k,c=ne):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{m=r.stateNode,ru(t,r),k=r.memoizedProps,Ee=hi(i,k),m.props=Ee,Ne=r.pendingProps,he=m.context,pe=i.contextType,ne=_i,typeof pe=="object"&&pe!==null&&(ne=Kn(pe)),U=i.getDerivedStateFromProps,(pe=typeof U=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(k!==Ne||he!==ne)&&Fp(r,m,c,ne),Ts=!1,he=r.memoizedState,m.state=he,Cl(r,c,m,d),Tl();var me=r.memoizedState;k!==Ne||he!==me||Ts||t!==null&&t.dependencies!==null&&To(t.dependencies)?(typeof U=="function"&&(Tu(r,i,U,c),me=r.memoizedState),(Ee=Ts||Bp(r,i,Ee,c,he,me,ne)||t!==null&&t.dependencies!==null&&To(t.dependencies))?(pe||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(c,me,ne),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(c,me,ne)),typeof m.componentDidUpdate=="function"&&(r.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof m.componentDidUpdate!="function"||k===t.memoizedProps&&he===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||k===t.memoizedProps&&he===t.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=me),m.props=c,m.state=me,m.context=ne,c=Ee):(typeof m.componentDidUpdate!="function"||k===t.memoizedProps&&he===t.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||k===t.memoizedProps&&he===t.memoizedState||(r.flags|=1024),c=!1)}return m=c,Yo(t,r),c=(r.flags&128)!==0,m||c?(m=r.stateNode,i=c&&typeof i.getDerivedStateFromError!="function"?null:m.render(),r.flags|=1,t!==null&&c?(r.child=Gi(r,t.child,null,d),r.child=Gi(r,null,i,d)):zn(t,r,i,d),r.memoizedState=m.state,t=r.child):t=as(t,r,d),t}function eh(t,r,i,c){return yl(),r.flags|=256,zn(t,r,i,c),r.child}var ku={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ru(t){return{baseLanes:t,cachePool:zd()}}function Du(t,r,i){return t=t!==null?t.childLanes&~i:0,r&&(t|=Ja),t}function th(t,r,i){var c=r.pendingProps,d=!1,m=(r.flags&128)!==0,k;if((k=m)||(k=t!==null&&t.memoizedState===null?!1:(Cn.current&2)!==0),k&&(d=!0,r.flags&=-129),k=(r.flags&32)!==0,r.flags&=-33,t===null){if(Nt){if(d?ks(r):Rs(),Nt){var U=rn,ne;if(ne=U){e:{for(ne=U,U=_r;ne.nodeType!==8;){if(!U){U=null;break e}if(ne=gr(ne.nextSibling),ne===null){U=null;break e}}U=ne}U!==null?(r.memoizedState={dehydrated:U,treeContext:ii!==null?{id:Qr,overflow:Kr}:null,retryLane:536870912,hydrationErrors:null},ne=Na(18,null,null,0),ne.stateNode=U,ne.return=r,r.child=ne,oa=r,rn=null,ne=!0):ne=!1}ne||ci(r)}if(U=r.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return mf(U)?r.lanes=32:r.lanes=536870912,null;ns(r)}return U=c.children,c=c.fallback,d?(Rs(),d=r.mode,U=qo({mode:"hidden",children:U},d),c=si(c,d,i,null),U.return=r,c.return=r,U.sibling=c,r.child=U,d=r.child,d.memoizedState=Ru(i),d.childLanes=Du(t,k,i),r.memoizedState=ku,c):(ks(r),_u(r,U))}if(ne=t.memoizedState,ne!==null&&(U=ne.dehydrated,U!==null)){if(m)r.flags&256?(ks(r),r.flags&=-257,r=Ou(t,r,i)):r.memoizedState!==null?(Rs(),r.child=t.child,r.flags|=128,r=null):(Rs(),d=c.fallback,U=r.mode,c=qo({mode:"visible",children:c.children},U),d=si(d,U,i,null),d.flags|=2,c.return=r,d.return=r,c.sibling=d,r.child=c,Gi(r,t.child,null,i),c=r.child,c.memoizedState=Ru(i),c.childLanes=Du(t,k,i),r.memoizedState=ku,r=d);else if(ks(r),mf(U)){if(k=U.nextSibling&&U.nextSibling.dataset,k)var pe=k.dgst;k=pe,c=Error(s(419)),c.stack="",c.digest=k,vl({value:c,source:null,stack:null}),r=Ou(t,r,i)}else if(kn||bl(t,r,i,!1),k=(i&t.childLanes)!==0,kn||k){if(k=Vt,k!==null&&(c=i&-i,c=(c&42)!==0?1:ca(c),c=(c&(k.suspendedLanes|i))!==0?0:c,c!==0&&c!==ne.retryLane))throw ne.retryLane=c,Di(t,c),Oa(k,t,c),Vp;U.data==="$?"||Qu(),r=Ou(t,r,i)}else U.data==="$?"?(r.flags|=192,r.child=t.child,r=null):(t=ne.treeContext,rn=gr(U.nextSibling),oa=r,Nt=!0,oi=null,_r=!1,t!==null&&(Za[Qa++]=Qr,Za[Qa++]=Kr,Za[Qa++]=ii,Qr=t.id,Kr=t.overflow,ii=r),r=_u(r,c.children),r.flags|=4096);return r}return d?(Rs(),d=c.fallback,U=r.mode,ne=t.child,pe=ne.sibling,c=Zr(ne,{mode:"hidden",children:c.children}),c.subtreeFlags=ne.subtreeFlags&65011712,pe!==null?d=Zr(pe,d):(d=si(d,U,i,null),d.flags|=2),d.return=r,c.return=r,c.sibling=d,r.child=c,c=d,d=r.child,U=t.child.memoizedState,U===null?U=Ru(i):(ne=U.cachePool,ne!==null?(pe=Tn._currentValue,ne=ne.parent!==pe?{parent:pe,pool:pe}:ne):ne=zd(),U={baseLanes:U.baseLanes|i,cachePool:ne}),d.memoizedState=U,d.childLanes=Du(t,k,i),r.memoizedState=ku,c):(ks(r),i=t.child,t=i.sibling,i=Zr(i,{mode:"visible",children:c.children}),i.return=r,i.sibling=null,t!==null&&(k=r.deletions,k===null?(r.deletions=[t],r.flags|=16):k.push(t)),r.child=i,r.memoizedState=null,i)}function _u(t,r){return r=qo({mode:"visible",children:r},t.mode),r.return=t,t.child=r}function qo(t,r){return t=Na(22,t,null,r),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function Ou(t,r,i){return Gi(r,t.child,null,i),t=_u(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function nh(t,r,i){t.lanes|=r;var c=t.alternate;c!==null&&(c.lanes|=r),Qc(t.return,r,i)}function Iu(t,r,i,c,d){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:i,tailMode:d}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=i,m.tailMode=d)}function ah(t,r,i){var c=r.pendingProps,d=c.revealOrder,m=c.tail;if(zn(t,r,c.children,i),c=Cn.current,(c&2)!==0)c=c&1|2,r.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&nh(t,i,r);else if(t.tag===19)nh(t,i,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}switch(Re(Cn,c),d){case"forwards":for(i=r.child,d=null;i!==null;)t=i.alternate,t!==null&&zo(t)===null&&(d=i),i=i.sibling;i=d,i===null?(d=r.child,r.child=null):(d=i.sibling,i.sibling=null),Iu(r,!1,d,i,m);break;case"backwards":for(i=null,d=r.child,r.child=null;d!==null;){if(t=d.alternate,t!==null&&zo(t)===null){r.child=d;break}t=d.sibling,d.sibling=i,i=d,d=t}Iu(r,!0,i,null,m);break;case"together":Iu(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function as(t,r,i){if(t!==null&&(r.dependencies=t.dependencies),Ls|=r.lanes,(i&r.childLanes)===0)if(t!==null){if(bl(t,r,i,!1),(i&r.childLanes)===0)return null}else return null;if(t!==null&&r.child!==t.child)throw Error(s(153));if(r.child!==null){for(t=r.child,i=Zr(t,t.pendingProps),r.child=i,i.return=r;t.sibling!==null;)t=t.sibling,i=i.sibling=Zr(t,t.pendingProps),i.return=r;i.sibling=null}return r.child}function Lu(t,r){return(t.lanes&r)!==0?!0:(t=t.dependencies,!!(t!==null&&To(t)))}function by(t,r,i){switch(r.tag){case 3:Xe(r,r.stateNode.containerInfo),As(r,Tn,t.memoizedState.cache),yl();break;case 27:case 5:At(r);break;case 4:Xe(r,r.stateNode.containerInfo);break;case 10:As(r,r.type,r.memoizedProps.value);break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ks(r),r.flags|=128,null):(i&r.child.childLanes)!==0?th(t,r,i):(ks(r),t=as(t,r,i),t!==null?t.sibling:null);ks(r);break;case 19:var d=(t.flags&128)!==0;if(c=(i&r.childLanes)!==0,c||(bl(t,r,i,!1),c=(i&r.childLanes)!==0),d){if(c)return ah(t,r,i);r.flags|=128}if(d=r.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Re(Cn,Cn.current),c)break;return null;case 22:case 23:return r.lanes=0,Zp(t,r,i);case 24:As(r,Tn,t.memoizedState.cache)}return as(t,r,i)}function rh(t,r,i){if(t!==null)if(t.memoizedProps!==r.pendingProps)kn=!0;else{if(!Lu(t,i)&&(r.flags&128)===0)return kn=!1,by(t,r,i);kn=(t.flags&131072)!==0}else kn=!1,Nt&&(r.flags&1048576)!==0&&Id(r,Ao,r.index);switch(r.lanes=0,r.tag){case 16:e:{t=r.pendingProps;var c=r.elementType,d=c._init;if(c=d(c._payload),r.type=c,typeof c=="function")Yc(c)?(t=hi(c,t),r.tag=1,r=Jp(null,r,c,t,i)):(r.tag=0,r=Nu(null,r,c,t,i));else{if(c!=null){if(d=c.$$typeof,d===j){r.tag=11,r=Xp(null,r,c,t,i);break e}else if(d===Y){r.tag=14,r=$p(null,r,c,t,i);break e}}throw r=Z(c)||c,Error(s(306,r,""))}}return r;case 0:return Nu(t,r,r.type,r.pendingProps,i);case 1:return c=r.type,d=hi(c,r.pendingProps),Jp(t,r,c,d,i);case 3:e:{if(Xe(r,r.stateNode.containerInfo),t===null)throw Error(s(387));c=r.pendingProps;var m=r.memoizedState;d=m.element,ru(t,r),Cl(r,c,null,i);var k=r.memoizedState;if(c=k.cache,As(r,Tn,c),c!==m.cache&&Kc(r,[Tn],i,!0),Tl(),c=k.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:k.cache},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){r=eh(t,r,c,i);break e}else if(c!==d){d=$a(Error(s(424)),r),vl(d),r=eh(t,r,c,i);break e}else for(t=r.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,rn=gr(t.firstChild),oa=r,Nt=!0,oi=null,_r=!0,i=Up(r,null,c,i),r.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(yl(),c===d){r=as(t,r,i);break e}zn(t,r,c,i)}r=r.child}return r;case 26:return Yo(t,r),t===null?(i=o0(r.type,null,r.pendingProps,null))?r.memoizedState=i:Nt||(i=r.type,t=r.pendingProps,c=sc(Me.current).createElement(i),c[kt]=r,c[gn]=t,Hn(c,i,t),ut(c),r.stateNode=c):r.memoizedState=o0(r.type,t.memoizedProps,r.pendingProps,t.memoizedState),null;case 27:return At(r),t===null&&Nt&&(c=r.stateNode=s0(r.type,r.pendingProps,Me.current),oa=r,_r=!0,d=rn,Fs(r.type)?(gf=d,rn=gr(c.firstChild)):rn=d),zn(t,r,r.pendingProps.children,i),Yo(t,r),t===null&&(r.flags|=4194304),r.child;case 5:return t===null&&Nt&&((d=c=rn)&&(c=Xy(c,r.type,r.pendingProps,_r),c!==null?(r.stateNode=c,oa=r,rn=gr(c.firstChild),_r=!1,d=!0):d=!1),d||ci(r)),At(r),d=r.type,m=r.pendingProps,k=t!==null?t.memoizedProps:null,c=m.children,df(d,m)?c=null:k!==null&&df(d,k)&&(r.flags|=32),r.memoizedState!==null&&(d=uu(t,r,fy,null,null,i),$l._currentValue=d),Yo(t,r),zn(t,r,c,i),r.child;case 6:return t===null&&Nt&&((t=i=rn)&&(i=$y(i,r.pendingProps,_r),i!==null?(r.stateNode=i,oa=r,rn=null,t=!0):t=!1),t||ci(r)),null;case 13:return th(t,r,i);case 4:return Xe(r,r.stateNode.containerInfo),c=r.pendingProps,t===null?r.child=Gi(r,null,c,i):zn(t,r,c,i),r.child;case 11:return Xp(t,r,r.type,r.pendingProps,i);case 7:return zn(t,r,r.pendingProps,i),r.child;case 8:return zn(t,r,r.pendingProps.children,i),r.child;case 12:return zn(t,r,r.pendingProps.children,i),r.child;case 10:return c=r.pendingProps,As(r,r.type,c.value),zn(t,r,c.children,i),r.child;case 9:return d=r.type._context,c=r.pendingProps.children,fi(r),d=Kn(d),c=c(d),r.flags|=1,zn(t,r,c,i),r.child;case 14:return $p(t,r,r.type,r.pendingProps,i);case 15:return Wp(t,r,r.type,r.pendingProps,i);case 19:return ah(t,r,i);case 31:return c=r.pendingProps,i=r.mode,c={mode:c.mode,children:c.children},t===null?(i=qo(c,i),i.ref=r.ref,r.child=i,i.return=r,r=i):(i=Zr(t.child,c),i.ref=r.ref,r.child=i,i.return=r,r=i),r;case 22:return Zp(t,r,i);case 24:return fi(r),c=Kn(Tn),t===null?(d=tu(),d===null&&(d=Vt,m=Jc(),d.pooledCache=m,m.refCount++,m!==null&&(d.pooledCacheLanes|=i),d=m),r.memoizedState={parent:c,cache:d},au(r),As(r,Tn,d)):((t.lanes&i)!==0&&(ru(t,r),Cl(r,null,null,i),Tl()),d=t.memoizedState,m=r.memoizedState,d.parent!==c?(d={parent:c,cache:c},r.memoizedState=d,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=d),As(r,Tn,c)):(c=m.cache,As(r,Tn,c),c!==d.cache&&Kc(r,[Tn],i,!0))),zn(t,r,r.pendingProps.children,i),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function rs(t){t.flags|=4}function sh(t,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!p0(r)){if(r=Ka.current,r!==null&&((wt&4194048)===wt?Or!==null:(wt&62914560)!==wt&&(wt&536870912)===0||r!==Or))throw El=nu,Gd;t.flags|=8192}}function Vo(t,r){r!==null&&(t.flags|=4),t.flags&16384&&(r=t.tag!==22?ds():536870912,t.lanes|=r,Vi|=r)}function Ol(t,r){if(!Nt)switch(t.tailMode){case"hidden":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function en(t){var r=t.alternate!==null&&t.alternate.child===t.child,i=0,c=0;if(r)for(var d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)i|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=c,t.childLanes=i,r}function xy(t,r,i){var c=r.pendingProps;switch($c(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(r),null;case 1:return en(r),null;case 3:return i=r.stateNode,c=null,t!==null&&(c=t.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),es(Tn),ot(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(gl(r)?rs(r):t===null||t.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,jd())),en(r),null;case 26:return i=r.memoizedState,t===null?(rs(r),i!==null?(en(r),sh(r,i)):(en(r),r.flags&=-16777217)):i?i!==t.memoizedState?(rs(r),en(r),sh(r,i)):(en(r),r.flags&=-16777217):(t.memoizedProps!==c&&rs(r),en(r),r.flags&=-16777217),null;case 27:Ct(r),i=Me.current;var d=r.type;if(t!==null&&r.stateNode!=null)t.memoizedProps!==c&&rs(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return en(r),null}t=Ue.current,gl(r)?Ld(r):(t=s0(d,c,i),r.stateNode=t,rs(r))}return en(r),null;case 5:if(Ct(r),i=r.type,t!==null&&r.stateNode!=null)t.memoizedProps!==c&&rs(r);else{if(!c){if(r.stateNode===null)throw Error(s(166));return en(r),null}if(t=Ue.current,gl(r))Ld(r);else{switch(d=sc(Me.current),t){case 1:t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":t=d.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":t=d.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof c.is=="string"?d.createElement("select",{is:c.is}):d.createElement("select"),c.multiple?t.multiple=!0:c.size&&(t.size=c.size);break;default:t=typeof c.is=="string"?d.createElement(i,{is:c.is}):d.createElement(i)}}t[kt]=r,t[gn]=c;e:for(d=r.child;d!==null;){if(d.tag===5||d.tag===6)t.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r.stateNode=t;e:switch(Hn(t,i,c),i){case"button":case"input":case"select":case"textarea":t=!!c.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&rs(r)}}return en(r),r.flags&=-16777217,null;case 6:if(t&&r.stateNode!=null)t.memoizedProps!==c&&rs(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(s(166));if(t=Me.current,gl(r)){if(t=r.stateNode,i=r.memoizedProps,c=null,d=oa,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}t[kt]=r,t=!!(t.nodeValue===i||c!==null&&c.suppressHydrationWarning===!0||Kh(t.nodeValue,i)),t||ci(r)}else t=sc(t).createTextNode(c),t[kt]=r,r.stateNode=t}return en(r),null;case 13:if(c=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=gl(r),c!==null&&c.dehydrated!==null){if(t===null){if(!d)throw Error(s(318));if(d=r.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[kt]=r}else yl(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),d=!1}else d=jd(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=d),d=!0;if(!d)return r.flags&256?(ns(r),r):(ns(r),null)}if(ns(r),(r.flags&128)!==0)return r.lanes=i,r;if(i=c!==null,t=t!==null&&t.memoizedState!==null,i){c=r.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool);var m=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==d&&(c.flags|=2048)}return i!==t&&i&&(r.child.flags|=8192),Vo(r,r.updateQueue),en(r),null;case 4:return ot(),t===null&&lf(r.stateNode.containerInfo),en(r),null;case 10:return es(r.type),en(r),null;case 19:if(ve(Cn),d=r.memoizedState,d===null)return en(r),null;if(c=(r.flags&128)!==0,m=d.rendering,m===null)if(c)Ol(d,!1);else{if(sn!==0||t!==null&&(t.flags&128)!==0)for(t=r.child;t!==null;){if(m=zo(t),m!==null){for(r.flags|=128,Ol(d,!1),t=m.updateQueue,r.updateQueue=t,Vo(r,t),r.subtreeFlags=0,t=i,i=r.child;i!==null;)Od(i,t),i=i.sibling;return Re(Cn,Cn.current&1|2),r.child}t=t.sibling}d.tail!==null&&Le()>Wo&&(r.flags|=128,c=!0,Ol(d,!1),r.lanes=4194304)}else{if(!c)if(t=zo(m),t!==null){if(r.flags|=128,c=!0,t=t.updateQueue,r.updateQueue=t,Vo(r,t),Ol(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!Nt)return en(r),null}else 2*Le()-d.renderingStartTime>Wo&&i!==536870912&&(r.flags|=128,c=!0,Ol(d,!1),r.lanes=4194304);d.isBackwards?(m.sibling=r.child,r.child=m):(t=d.last,t!==null?t.sibling=m:r.child=m,d.last=m)}return d.tail!==null?(r=d.tail,d.rendering=r,d.tail=r.sibling,d.renderingStartTime=Le(),r.sibling=null,t=Cn.current,Re(Cn,c?t&1|2:t&1),r):(en(r),null);case 22:case 23:return ns(r),ou(),c=r.memoizedState!==null,t!==null?t.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(i&536870912)!==0&&(r.flags&128)===0&&(en(r),r.subtreeFlags&6&&(r.flags|=8192)):en(r),i=r.updateQueue,i!==null&&Vo(r,i.retryQueue),i=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==i&&(r.flags|=2048),t!==null&&ve(di),null;case 24:return i=null,t!==null&&(i=t.memoizedState.cache),r.memoizedState.cache!==i&&(r.flags|=2048),es(Tn),en(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function Sy(t,r){switch($c(r),r.tag){case 1:return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return es(Tn),ot(),t=r.flags,(t&65536)!==0&&(t&128)===0?(r.flags=t&-65537|128,r):null;case 26:case 27:case 5:return Ct(r),null;case 13:if(ns(r),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(s(340));yl()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return ve(Cn),null;case 4:return ot(),null;case 10:return es(r.type),null;case 22:case 23:return ns(r),ou(),t!==null&&ve(di),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 24:return es(Tn),null;case 25:return null;default:return null}}function ih(t,r){switch($c(r),r.tag){case 3:es(Tn),ot();break;case 26:case 27:case 5:Ct(r);break;case 4:ot();break;case 13:ns(r);break;case 19:ve(Cn);break;case 10:es(r.type);break;case 22:case 23:ns(r),ou(),t!==null&&ve(di);break;case 24:es(Tn)}}function Il(t,r){try{var i=r.updateQueue,c=i!==null?i.lastEffect:null;if(c!==null){var d=c.next;i=d;do{if((i.tag&t)===t){c=void 0;var m=i.create,k=i.inst;c=m(),k.destroy=c}i=i.next}while(i!==d)}}catch(U){Yt(r,r.return,U)}}function Ds(t,r,i){try{var c=r.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var m=d.next;c=m;do{if((c.tag&t)===t){var k=c.inst,U=k.destroy;if(U!==void 0){k.destroy=void 0,d=r;var ne=i,pe=U;try{pe()}catch(Ee){Yt(d,ne,Ee)}}}c=c.next}while(c!==m)}}catch(Ee){Yt(r,r.return,Ee)}}function lh(t){var r=t.updateQueue;if(r!==null){var i=t.stateNode;try{$d(r,i)}catch(c){Yt(t,t.return,c)}}}function oh(t,r,i){i.props=hi(t.type,t.memoizedProps),i.state=t.memoizedState;try{i.componentWillUnmount()}catch(c){Yt(t,r,c)}}function Ll(t,r){try{var i=t.ref;if(i!==null){switch(t.tag){case 26:case 27:case 5:var c=t.stateNode;break;case 30:c=t.stateNode;break;default:c=t.stateNode}typeof i=="function"?t.refCleanup=i(c):i.current=c}}catch(d){Yt(t,r,d)}}function Ir(t,r){var i=t.ref,c=t.refCleanup;if(i!==null)if(typeof c=="function")try{c()}catch(d){Yt(t,r,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(d){Yt(t,r,d)}else i.current=null}function ch(t){var r=t.type,i=t.memoizedProps,c=t.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":i.autoFocus&&c.focus();break e;case"img":i.src?c.src=i.src:i.srcSet&&(c.srcset=i.srcSet)}}catch(d){Yt(t,t.return,d)}}function Uu(t,r,i){try{var c=t.stateNode;Gy(c,t.type,i,r),c[gn]=r}catch(d){Yt(t,t.return,d)}}function uh(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Fs(t.type)||t.tag===4}function ju(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||uh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Fs(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Bu(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(t,r):(r=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,r.appendChild(t),i=i._reactRootContainer,i!=null||r.onclick!==null||(r.onclick=rc));else if(c!==4&&(c===27&&Fs(t.type)&&(i=t.stateNode,r=null),t=t.child,t!==null))for(Bu(t,r,i),t=t.sibling;t!==null;)Bu(t,r,i),t=t.sibling}function Xo(t,r,i){var c=t.tag;if(c===5||c===6)t=t.stateNode,r?i.insertBefore(t,r):i.appendChild(t);else if(c!==4&&(c===27&&Fs(t.type)&&(i=t.stateNode),t=t.child,t!==null))for(Xo(t,r,i),t=t.sibling;t!==null;)Xo(t,r,i),t=t.sibling}function fh(t){var r=t.stateNode,i=t.memoizedProps;try{for(var c=t.type,d=r.attributes;d.length;)r.removeAttributeNode(d[0]);Hn(r,c,i),r[kt]=t,r[gn]=i}catch(m){Yt(t,t.return,m)}}var ss=!1,fn=!1,Fu=!1,dh=typeof WeakSet=="function"?WeakSet:Set,Rn=null;function wy(t,r){if(t=t.containerInfo,uf=fc,t=Ed(t),jc(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var c=i.getSelection&&i.getSelection();if(c&&c.rangeCount!==0){i=c.anchorNode;var d=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{i.nodeType,m.nodeType}catch{i=null;break e}var k=0,U=-1,ne=-1,pe=0,Ee=0,Ne=t,he=null;t:for(;;){for(var me;Ne!==i||d!==0&&Ne.nodeType!==3||(U=k+d),Ne!==m||c!==0&&Ne.nodeType!==3||(ne=k+c),Ne.nodeType===3&&(k+=Ne.nodeValue.length),(me=Ne.firstChild)!==null;)he=Ne,Ne=me;for(;;){if(Ne===t)break t;if(he===i&&++pe===d&&(U=k),he===m&&++Ee===c&&(ne=k),(me=Ne.nextSibling)!==null)break;Ne=he,he=Ne.parentNode}Ne=me}i=U===-1||ne===-1?null:{start:U,end:ne}}else i=null}i=i||{start:0,end:0}}else i=null;for(ff={focusedElem:t,selectionRange:i},fc=!1,Rn=r;Rn!==null;)if(r=Rn,t=r.child,(r.subtreeFlags&1024)!==0&&t!==null)t.return=r,Rn=t;else for(;Rn!==null;){switch(r=Rn,m=r.alternate,t=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((t&1024)!==0&&m!==null){t=void 0,i=r,d=m.memoizedProps,m=m.memoizedState,c=i.stateNode;try{var st=hi(i.type,d,i.elementType===i.type);t=c.getSnapshotBeforeUpdate(st,m),c.__reactInternalSnapshotBeforeUpdate=t}catch(Je){Yt(i,i.return,Je)}}break;case 3:if((t&1024)!==0){if(t=r.stateNode.containerInfo,i=t.nodeType,i===9)hf(t);else if(i===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":hf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(s(163))}if(t=r.sibling,t!==null){t.return=r.return,Rn=t;break}Rn=r.return}}function ph(t,r,i){var c=i.flags;switch(i.tag){case 0:case 11:case 15:_s(t,i),c&4&&Il(5,i);break;case 1:if(_s(t,i),c&4)if(t=i.stateNode,r===null)try{t.componentDidMount()}catch(k){Yt(i,i.return,k)}else{var d=hi(i.type,r.memoizedProps);r=r.memoizedState;try{t.componentDidUpdate(d,r,t.__reactInternalSnapshotBeforeUpdate)}catch(k){Yt(i,i.return,k)}}c&64&&lh(i),c&512&&Ll(i,i.return);break;case 3:if(_s(t,i),c&64&&(t=i.updateQueue,t!==null)){if(r=null,i.child!==null)switch(i.child.tag){case 27:case 5:r=i.child.stateNode;break;case 1:r=i.child.stateNode}try{$d(t,r)}catch(k){Yt(i,i.return,k)}}break;case 27:r===null&&c&4&&fh(i);case 26:case 5:_s(t,i),r===null&&c&4&&ch(i),c&512&&Ll(i,i.return);break;case 12:_s(t,i);break;case 13:_s(t,i),c&4&&gh(t,i),c&64&&(t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(i=Dy.bind(null,i),Wy(t,i))));break;case 22:if(c=i.memoizedState!==null||ss,!c){r=r!==null&&r.memoizedState!==null||fn,d=ss;var m=fn;ss=c,(fn=r)&&!m?Os(t,i,(i.subtreeFlags&8772)!==0):_s(t,i),ss=d,fn=m}break;case 30:break;default:_s(t,i)}}function hh(t){var r=t.alternate;r!==null&&(t.alternate=null,hh(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&Qs(r)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Zt=null,ga=!1;function is(t,r,i){for(i=i.child;i!==null;)mh(t,r,i),i=i.sibling}function mh(t,r,i){if(Ke&&typeof Ke.onCommitFiberUnmount=="function")try{Ke.onCommitFiberUnmount(Gt,i)}catch{}switch(i.tag){case 26:fn||Ir(i,r),is(t,r,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:fn||Ir(i,r);var c=Zt,d=ga;Fs(i.type)&&(Zt=i.stateNode,ga=!1),is(t,r,i),Yl(i.stateNode),Zt=c,ga=d;break;case 5:fn||Ir(i,r);case 6:if(c=Zt,d=ga,Zt=null,is(t,r,i),Zt=c,ga=d,Zt!==null)if(ga)try{(Zt.nodeType===9?Zt.body:Zt.nodeName==="HTML"?Zt.ownerDocument.body:Zt).removeChild(i.stateNode)}catch(m){Yt(i,r,m)}else try{Zt.removeChild(i.stateNode)}catch(m){Yt(i,r,m)}break;case 18:Zt!==null&&(ga?(t=Zt,a0(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,i.stateNode),Kl(t)):a0(Zt,i.stateNode));break;case 4:c=Zt,d=ga,Zt=i.stateNode.containerInfo,ga=!0,is(t,r,i),Zt=c,ga=d;break;case 0:case 11:case 14:case 15:fn||Ds(2,i,r),fn||Ds(4,i,r),is(t,r,i);break;case 1:fn||(Ir(i,r),c=i.stateNode,typeof c.componentWillUnmount=="function"&&oh(i,r,c)),is(t,r,i);break;case 21:is(t,r,i);break;case 22:fn=(c=fn)||i.memoizedState!==null,is(t,r,i),fn=c;break;default:is(t,r,i)}}function gh(t,r){if(r.memoizedState===null&&(t=r.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Kl(t)}catch(i){Yt(r,r.return,i)}}function Ey(t){switch(t.tag){case 13:case 19:var r=t.stateNode;return r===null&&(r=t.stateNode=new dh),r;case 22:return t=t.stateNode,r=t._retryCache,r===null&&(r=t._retryCache=new dh),r;default:throw Error(s(435,t.tag))}}function Pu(t,r){var i=Ey(t);r.forEach(function(c){var d=_y.bind(null,t,c);i.has(c)||(i.add(c),c.then(d,d))})}function ka(t,r){var i=r.deletions;if(i!==null)for(var c=0;c<i.length;c++){var d=i[c],m=t,k=r,U=k;e:for(;U!==null;){switch(U.tag){case 27:if(Fs(U.type)){Zt=U.stateNode,ga=!1;break e}break;case 5:Zt=U.stateNode,ga=!1;break e;case 3:case 4:Zt=U.stateNode.containerInfo,ga=!0;break e}U=U.return}if(Zt===null)throw Error(s(160));mh(m,k,d),Zt=null,ga=!1,m=d.alternate,m!==null&&(m.return=null),d.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)yh(r,t),r=r.sibling}var mr=null;function yh(t,r){var i=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:ka(r,t),Ra(t),c&4&&(Ds(3,t,t.return),Il(3,t),Ds(5,t,t.return));break;case 1:ka(r,t),Ra(t),c&512&&(fn||i===null||Ir(i,i.return)),c&64&&ss&&(t=t.updateQueue,t!==null&&(c=t.callbacks,c!==null&&(i=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=i===null?c:i.concat(c))));break;case 26:var d=mr;if(ka(r,t),Ra(t),c&512&&(fn||i===null||Ir(i,i.return)),c&4){var m=i!==null?i.memoizedState:null;if(c=t.memoizedState,i===null)if(c===null)if(t.stateNode===null){e:{c=t.type,i=t.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":m=d.getElementsByTagName("title")[0],(!m||m[rr]||m[kt]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=d.createElement(c),d.head.insertBefore(m,d.querySelector("head > title"))),Hn(m,c,i),m[kt]=t,ut(m),c=m;break e;case"link":var k=f0("link","href",d).get(c+(i.href||""));if(k){for(var U=0;U<k.length;U++)if(m=k[U],m.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&m.getAttribute("rel")===(i.rel==null?null:i.rel)&&m.getAttribute("title")===(i.title==null?null:i.title)&&m.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){k.splice(U,1);break t}}m=d.createElement(c),Hn(m,c,i),d.head.appendChild(m);break;case"meta":if(k=f0("meta","content",d).get(c+(i.content||""))){for(U=0;U<k.length;U++)if(m=k[U],m.getAttribute("content")===(i.content==null?null:""+i.content)&&m.getAttribute("name")===(i.name==null?null:i.name)&&m.getAttribute("property")===(i.property==null?null:i.property)&&m.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&m.getAttribute("charset")===(i.charSet==null?null:i.charSet)){k.splice(U,1);break t}}m=d.createElement(c),Hn(m,c,i),d.head.appendChild(m);break;default:throw Error(s(468,c))}m[kt]=t,ut(m),c=m}t.stateNode=c}else d0(d,t.type,t.stateNode);else t.stateNode=u0(d,c,t.memoizedProps);else m!==c?(m===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):m.count--,c===null?d0(d,t.type,t.stateNode):u0(d,c,t.memoizedProps)):c===null&&t.stateNode!==null&&Uu(t,t.memoizedProps,i.memoizedProps)}break;case 27:ka(r,t),Ra(t),c&512&&(fn||i===null||Ir(i,i.return)),i!==null&&c&4&&Uu(t,t.memoizedProps,i.memoizedProps);break;case 5:if(ka(r,t),Ra(t),c&512&&(fn||i===null||Ir(i,i.return)),t.flags&32){d=t.stateNode;try{za(d,"")}catch(me){Yt(t,t.return,me)}}c&4&&t.stateNode!=null&&(d=t.memoizedProps,Uu(t,d,i!==null?i.memoizedProps:d)),c&1024&&(Fu=!0);break;case 6:if(ka(r,t),Ra(t),c&4){if(t.stateNode===null)throw Error(s(162));c=t.memoizedProps,i=t.stateNode;try{i.nodeValue=c}catch(me){Yt(t,t.return,me)}}break;case 3:if(oc=null,d=mr,mr=ic(r.containerInfo),ka(r,t),mr=d,Ra(t),c&4&&i!==null&&i.memoizedState.isDehydrated)try{Kl(r.containerInfo)}catch(me){Yt(t,t.return,me)}Fu&&(Fu=!1,vh(t));break;case 4:c=mr,mr=ic(t.stateNode.containerInfo),ka(r,t),Ra(t),mr=c;break;case 12:ka(r,t),Ra(t);break;case 13:ka(r,t),Ra(t),t.child.flags&8192&&t.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Vu=Le()),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Pu(t,c)));break;case 22:d=t.memoizedState!==null;var ne=i!==null&&i.memoizedState!==null,pe=ss,Ee=fn;if(ss=pe||d,fn=Ee||ne,ka(r,t),fn=Ee,ss=pe,Ra(t),c&8192)e:for(r=t.stateNode,r._visibility=d?r._visibility&-2:r._visibility|1,d&&(i===null||ne||ss||fn||mi(t)),i=null,r=t;;){if(r.tag===5||r.tag===26){if(i===null){ne=i=r;try{if(m=ne.stateNode,d)k=m.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{U=ne.stateNode;var Ne=ne.memoizedProps.style,he=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;U.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(me){Yt(ne,ne.return,me)}}}else if(r.tag===6){if(i===null){ne=r;try{ne.stateNode.nodeValue=d?"":ne.memoizedProps}catch(me){Yt(ne,ne.return,me)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;i===r&&(i=null),r=r.return}i===r&&(i=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=t.updateQueue,c!==null&&(i=c.retryQueue,i!==null&&(c.retryQueue=null,Pu(t,i))));break;case 19:ka(r,t),Ra(t),c&4&&(c=t.updateQueue,c!==null&&(t.updateQueue=null,Pu(t,c)));break;case 30:break;case 21:break;default:ka(r,t),Ra(t)}}function Ra(t){var r=t.flags;if(r&2){try{for(var i,c=t.return;c!==null;){if(uh(c)){i=c;break}c=c.return}if(i==null)throw Error(s(160));switch(i.tag){case 27:var d=i.stateNode,m=ju(t);Xo(t,m,d);break;case 5:var k=i.stateNode;i.flags&32&&(za(k,""),i.flags&=-33);var U=ju(t);Xo(t,U,k);break;case 3:case 4:var ne=i.stateNode.containerInfo,pe=ju(t);Bu(t,pe,ne);break;default:throw Error(s(161))}}catch(Ee){Yt(t,t.return,Ee)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function vh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var r=t;vh(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),t=t.sibling}}function _s(t,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)ph(t,r.alternate,r),r=r.sibling}function mi(t){for(t=t.child;t!==null;){var r=t;switch(r.tag){case 0:case 11:case 14:case 15:Ds(4,r,r.return),mi(r);break;case 1:Ir(r,r.return);var i=r.stateNode;typeof i.componentWillUnmount=="function"&&oh(r,r.return,i),mi(r);break;case 27:Yl(r.stateNode);case 26:case 5:Ir(r,r.return),mi(r);break;case 22:r.memoizedState===null&&mi(r);break;case 30:mi(r);break;default:mi(r)}t=t.sibling}}function Os(t,r,i){for(i=i&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,d=t,m=r,k=m.flags;switch(m.tag){case 0:case 11:case 15:Os(d,m,i),Il(4,m);break;case 1:if(Os(d,m,i),c=m,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(pe){Yt(c,c.return,pe)}if(c=m,d=c.updateQueue,d!==null){var U=c.stateNode;try{var ne=d.shared.hiddenCallbacks;if(ne!==null)for(d.shared.hiddenCallbacks=null,d=0;d<ne.length;d++)Xd(ne[d],U)}catch(pe){Yt(c,c.return,pe)}}i&&k&64&&lh(m),Ll(m,m.return);break;case 27:fh(m);case 26:case 5:Os(d,m,i),i&&c===null&&k&4&&ch(m),Ll(m,m.return);break;case 12:Os(d,m,i);break;case 13:Os(d,m,i),i&&k&4&&gh(d,m);break;case 22:m.memoizedState===null&&Os(d,m,i),Ll(m,m.return);break;case 30:break;default:Os(d,m,i)}r=r.sibling}}function zu(t,r){var i=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(i=t.memoizedState.cachePool.pool),t=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(t=r.memoizedState.cachePool.pool),t!==i&&(t!=null&&t.refCount++,i!=null&&xl(i))}function Gu(t,r){t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&xl(t))}function Lr(t,r,i,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)bh(t,r,i,c),r=r.sibling}function bh(t,r,i,c){var d=r.flags;switch(r.tag){case 0:case 11:case 15:Lr(t,r,i,c),d&2048&&Il(9,r);break;case 1:Lr(t,r,i,c);break;case 3:Lr(t,r,i,c),d&2048&&(t=null,r.alternate!==null&&(t=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==t&&(r.refCount++,t!=null&&xl(t)));break;case 12:if(d&2048){Lr(t,r,i,c),t=r.stateNode;try{var m=r.memoizedProps,k=m.id,U=m.onPostCommit;typeof U=="function"&&U(k,r.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(ne){Yt(r,r.return,ne)}}else Lr(t,r,i,c);break;case 13:Lr(t,r,i,c);break;case 23:break;case 22:m=r.stateNode,k=r.alternate,r.memoizedState!==null?m._visibility&2?Lr(t,r,i,c):Ul(t,r):m._visibility&2?Lr(t,r,i,c):(m._visibility|=2,Hi(t,r,i,c,(r.subtreeFlags&10256)!==0)),d&2048&&zu(k,r);break;case 24:Lr(t,r,i,c),d&2048&&Gu(r.alternate,r);break;default:Lr(t,r,i,c)}}function Hi(t,r,i,c,d){for(d=d&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var m=t,k=r,U=i,ne=c,pe=k.flags;switch(k.tag){case 0:case 11:case 15:Hi(m,k,U,ne,d),Il(8,k);break;case 23:break;case 22:var Ee=k.stateNode;k.memoizedState!==null?Ee._visibility&2?Hi(m,k,U,ne,d):Ul(m,k):(Ee._visibility|=2,Hi(m,k,U,ne,d)),d&&pe&2048&&zu(k.alternate,k);break;case 24:Hi(m,k,U,ne,d),d&&pe&2048&&Gu(k.alternate,k);break;default:Hi(m,k,U,ne,d)}r=r.sibling}}function Ul(t,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var i=t,c=r,d=c.flags;switch(c.tag){case 22:Ul(i,c),d&2048&&zu(c.alternate,c);break;case 24:Ul(i,c),d&2048&&Gu(c.alternate,c);break;default:Ul(i,c)}r=r.sibling}}var jl=8192;function Yi(t){if(t.subtreeFlags&jl)for(t=t.child;t!==null;)xh(t),t=t.sibling}function xh(t){switch(t.tag){case 26:Yi(t),t.flags&jl&&t.memoizedState!==null&&o1(mr,t.memoizedState,t.memoizedProps);break;case 5:Yi(t);break;case 3:case 4:var r=mr;mr=ic(t.stateNode.containerInfo),Yi(t),mr=r;break;case 22:t.memoizedState===null&&(r=t.alternate,r!==null&&r.memoizedState!==null?(r=jl,jl=16777216,Yi(t),jl=r):Yi(t));break;default:Yi(t)}}function Sh(t){var r=t.alternate;if(r!==null&&(t=r.child,t!==null)){r.child=null;do r=t.sibling,t.sibling=null,t=r;while(t!==null)}}function Bl(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];Rn=c,Eh(c,t)}Sh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)wh(t),t=t.sibling}function wh(t){switch(t.tag){case 0:case 11:case 15:Bl(t),t.flags&2048&&Ds(9,t,t.return);break;case 3:Bl(t);break;case 12:Bl(t);break;case 22:var r=t.stateNode;t.memoizedState!==null&&r._visibility&2&&(t.return===null||t.return.tag!==13)?(r._visibility&=-3,$o(t)):Bl(t);break;default:Bl(t)}}function $o(t){var r=t.deletions;if((t.flags&16)!==0){if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];Rn=c,Eh(c,t)}Sh(t)}for(t=t.child;t!==null;){switch(r=t,r.tag){case 0:case 11:case 15:Ds(8,r,r.return),$o(r);break;case 22:i=r.stateNode,i._visibility&2&&(i._visibility&=-3,$o(r));break;default:$o(r)}t=t.sibling}}function Eh(t,r){for(;Rn!==null;){var i=Rn;switch(i.tag){case 0:case 11:case 15:Ds(8,i,r);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var c=i.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:xl(i.memoizedState.cache)}if(c=i.child,c!==null)c.return=i,Rn=c;else e:for(i=t;Rn!==null;){c=Rn;var d=c.sibling,m=c.return;if(hh(c),c===i){Rn=null;break e}if(d!==null){d.return=m,Rn=d;break e}Rn=m}}}var Ay={getCacheForType:function(t){var r=Kn(Tn),i=r.data.get(t);return i===void 0&&(i=t(),r.data.set(t,i)),i}},Ty=typeof WeakMap=="function"?WeakMap:Map,Ot=0,Vt=null,vt=null,wt=0,It=0,Da=null,Is=!1,qi=!1,Hu=!1,ls=0,sn=0,Ls=0,gi=0,Yu=0,Ja=0,Vi=0,Fl=null,ya=null,qu=!1,Vu=0,Wo=1/0,Zo=null,Us=null,Gn=0,js=null,Xi=null,$i=0,Xu=0,$u=null,Ah=null,Pl=0,Wu=null;function _a(){if((Ot&2)!==0&&wt!==0)return wt&-wt;if(V.T!==null){var t=Li;return t!==0?t:nf()}return ba()}function Th(){Ja===0&&(Ja=(wt&536870912)===0||Nt?ct():536870912);var t=Ka.current;return t!==null&&(t.flags|=32),Ja}function Oa(t,r,i){(t===Vt&&(It===2||It===9)||t.cancelPendingCommit!==null)&&(Wi(t,0),Bs(t,wt,Ja,!1)),In(t,i),((Ot&2)===0||t!==Vt)&&(t===Vt&&((Ot&2)===0&&(gi|=i),sn===4&&Bs(t,wt,Ja,!1)),Ur(t))}function Ch(t,r,i){if((Ot&6)!==0)throw Error(s(327));var c=!i&&(r&124)===0&&(r&t.expiredLanes)===0||En(t,r),d=c?Ny(t,r):Ku(t,r,!0),m=c;do{if(d===0){qi&&!c&&Bs(t,r,0,!1);break}else{if(i=t.current.alternate,m&&!Cy(i)){d=Ku(t,r,!1),m=!1;continue}if(d===2){if(m=r,t.errorRecoveryDisabledLanes&m)var k=0;else k=t.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){r=k;e:{var U=t;d=Fl;var ne=U.current.memoizedState.isDehydrated;if(ne&&(Wi(U,k).flags|=256),k=Ku(U,k,!1),k!==2){if(Hu&&!ne){U.errorRecoveryDisabledLanes|=m,gi|=m,d=4;break e}m=ya,ya=d,m!==null&&(ya===null?ya=m:ya.push.apply(ya,m))}d=k}if(m=!1,d!==2)continue}}if(d===1){Wi(t,0),Bs(t,r,0,!0);break}e:{switch(c=t,m=d,m){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:Bs(c,r,Ja,!Is);break e;case 2:ya=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(d=Vu+300-Le(),10<d)){if(Bs(c,r,Ja,!Is),ar(c,0,!0)!==0)break e;c.timeoutHandle=t0(Mh.bind(null,c,i,ya,Zo,qu,r,Ja,gi,Vi,Is,m,2,-0,0),d);break e}Mh(c,i,ya,Zo,qu,r,Ja,gi,Vi,Is,m,0,-0,0)}}break}while(!0);Ur(t)}function Mh(t,r,i,c,d,m,k,U,ne,pe,Ee,Ne,he,me){if(t.timeoutHandle=-1,Ne=r.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(Xl={stylesheets:null,count:0,unsuspend:l1},xh(r),Ne=c1(),Ne!==null)){t.cancelPendingCommit=Ne(Ih.bind(null,t,r,m,i,c,d,k,U,ne,Ee,1,he,me)),Bs(t,m,k,!pe);return}Ih(t,r,m,i,c,d,k,U,ne)}function Cy(t){for(var r=t;;){var i=r.tag;if((i===0||i===11||i===15)&&r.flags&16384&&(i=r.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var c=0;c<i.length;c++){var d=i[c],m=d.getSnapshot;d=d.value;try{if(!sa(m(),d))return!1}catch{return!1}}if(i=r.child,r.subtreeFlags&16384&&i!==null)i.return=r,r=i;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Bs(t,r,i,c){r&=~Yu,r&=~gi,t.suspendedLanes|=r,t.pingedLanes&=~r,c&&(t.warmLanes|=r),c=t.expirationTimes;for(var d=r;0<d;){var m=31-Xt(d),k=1<<m;c[m]=-1,d&=~k}i!==0&&ja(t,i,r)}function Qo(){return(Ot&6)===0?(zl(0),!1):!0}function Zu(){if(vt!==null){if(It===0)var t=vt.return;else t=vt,Jr=ui=null,pu(t),zi=null,Dl=0,t=vt;for(;t!==null;)ih(t.alternate,t),t=t.return;vt=null}}function Wi(t,r){var i=t.timeoutHandle;i!==-1&&(t.timeoutHandle=-1,Yy(i)),i=t.cancelPendingCommit,i!==null&&(t.cancelPendingCommit=null,i()),Zu(),Vt=t,vt=i=Zr(t.current,null),wt=r,It=0,Da=null,Is=!1,qi=En(t,r),Hu=!1,Vi=Ja=Yu=gi=Ls=sn=0,ya=Fl=null,qu=!1,(r&8)!==0&&(r|=r&32);var c=t.entangledLanes;if(c!==0)for(t=t.entanglements,c&=r;0<c;){var d=31-Xt(c),m=1<<d;r|=t[d],c&=~m}return ls=r,bo(),i}function Nh(t,r){gt=null,V.H=Bo,r===wl||r===No?(r=qd(),It=3):r===Gd?(r=qd(),It=4):It=r===Vp?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Da=r,vt===null&&(sn=1,Ho(t,$a(r,t.current)))}function kh(){var t=V.H;return V.H=Bo,t===null?Bo:t}function Rh(){var t=V.A;return V.A=Ay,t}function Qu(){sn=4,Is||(wt&4194048)!==wt&&Ka.current!==null||(qi=!0),(Ls&134217727)===0&&(gi&134217727)===0||Vt===null||Bs(Vt,wt,Ja,!1)}function Ku(t,r,i){var c=Ot;Ot|=2;var d=kh(),m=Rh();(Vt!==t||wt!==r)&&(Zo=null,Wi(t,r)),r=!1;var k=sn;e:do try{if(It!==0&&vt!==null){var U=vt,ne=Da;switch(It){case 8:Zu(),k=6;break e;case 3:case 2:case 9:case 6:Ka.current===null&&(r=!0);var pe=It;if(It=0,Da=null,Zi(t,U,ne,pe),i&&qi){k=0;break e}break;default:pe=It,It=0,Da=null,Zi(t,U,ne,pe)}}My(),k=sn;break}catch(Ee){Nh(t,Ee)}while(!0);return r&&t.shellSuspendCounter++,Jr=ui=null,Ot=c,V.H=d,V.A=m,vt===null&&(Vt=null,wt=0,bo()),k}function My(){for(;vt!==null;)Dh(vt)}function Ny(t,r){var i=Ot;Ot|=2;var c=kh(),d=Rh();Vt!==t||wt!==r?(Zo=null,Wo=Le()+500,Wi(t,r)):qi=En(t,r);e:do try{if(It!==0&&vt!==null){r=vt;var m=Da;t:switch(It){case 1:It=0,Da=null,Zi(t,r,m,1);break;case 2:case 9:if(Hd(m)){It=0,Da=null,_h(r);break}r=function(){It!==2&&It!==9||Vt!==t||(It=7),Ur(t)},m.then(r,r);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:Hd(m)?(It=0,Da=null,_h(r)):(It=0,Da=null,Zi(t,r,m,7));break;case 5:var k=null;switch(vt.tag){case 26:k=vt.memoizedState;case 5:case 27:var U=vt;if(!k||p0(k)){It=0,Da=null;var ne=U.sibling;if(ne!==null)vt=ne;else{var pe=U.return;pe!==null?(vt=pe,Ko(pe)):vt=null}break t}}It=0,Da=null,Zi(t,r,m,5);break;case 6:It=0,Da=null,Zi(t,r,m,6);break;case 8:Zu(),sn=6;break e;default:throw Error(s(462))}}ky();break}catch(Ee){Nh(t,Ee)}while(!0);return Jr=ui=null,V.H=c,V.A=d,Ot=i,vt!==null?0:(Vt=null,wt=0,bo(),sn)}function ky(){for(;vt!==null&&!je();)Dh(vt)}function Dh(t){var r=rh(t.alternate,t,ls);t.memoizedProps=t.pendingProps,r===null?Ko(t):vt=r}function _h(t){var r=t,i=r.alternate;switch(r.tag){case 15:case 0:r=Kp(i,r,r.pendingProps,r.type,void 0,wt);break;case 11:r=Kp(i,r,r.pendingProps,r.type.render,r.ref,wt);break;case 5:pu(r);default:ih(i,r),r=vt=Od(r,ls),r=rh(i,r,ls)}t.memoizedProps=t.pendingProps,r===null?Ko(t):vt=r}function Zi(t,r,i,c){Jr=ui=null,pu(r),zi=null,Dl=0;var d=r.return;try{if(vy(t,d,r,i,wt)){sn=1,Ho(t,$a(i,t.current)),vt=null;return}}catch(m){if(d!==null)throw vt=d,m;sn=1,Ho(t,$a(i,t.current)),vt=null;return}r.flags&32768?(Nt||c===1?t=!0:qi||(wt&536870912)!==0?t=!1:(Is=t=!0,(c===2||c===9||c===3||c===6)&&(c=Ka.current,c!==null&&c.tag===13&&(c.flags|=16384))),Oh(r,t)):Ko(r)}function Ko(t){var r=t;do{if((r.flags&32768)!==0){Oh(r,Is);return}t=r.return;var i=xy(r.alternate,r,ls);if(i!==null){vt=i;return}if(r=r.sibling,r!==null){vt=r;return}vt=r=t}while(r!==null);sn===0&&(sn=5)}function Oh(t,r){do{var i=Sy(t.alternate,t);if(i!==null){i.flags&=32767,vt=i;return}if(i=t.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!r&&(t=t.sibling,t!==null)){vt=t;return}vt=t=i}while(t!==null);sn=6,vt=null}function Ih(t,r,i,c,d,m,k,U,ne){t.cancelPendingCommit=null;do Jo();while(Gn!==0);if((Ot&6)!==0)throw Error(s(327));if(r!==null){if(r===t.current)throw Error(s(177));if(m=r.lanes|r.childLanes,m|=Gc,Gr(t,i,m,k,U,ne),t===Vt&&(vt=Vt=null,wt=0),Xi=r,js=t,$i=i,Xu=m,$u=d,Ah=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Oy(ke,function(){return Fh(),null})):(t.callbackNode=null,t.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=V.T,V.T=null,d=te.p,te.p=2,k=Ot,Ot|=4;try{wy(t,r,i)}finally{Ot=k,te.p=d,V.T=c}}Gn=1,Lh(),Uh(),jh()}}function Lh(){if(Gn===1){Gn=0;var t=js,r=Xi,i=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||i){i=V.T,V.T=null;var c=te.p;te.p=2;var d=Ot;Ot|=4;try{yh(r,t);var m=ff,k=Ed(t.containerInfo),U=m.focusedElem,ne=m.selectionRange;if(k!==U&&U&&U.ownerDocument&&wd(U.ownerDocument.documentElement,U)){if(ne!==null&&jc(U)){var pe=ne.start,Ee=ne.end;if(Ee===void 0&&(Ee=pe),"selectionStart"in U)U.selectionStart=pe,U.selectionEnd=Math.min(Ee,U.value.length);else{var Ne=U.ownerDocument||document,he=Ne&&Ne.defaultView||window;if(he.getSelection){var me=he.getSelection(),st=U.textContent.length,Je=Math.min(ne.start,st),Ft=ne.end===void 0?Je:Math.min(ne.end,st);!me.extend&&Je>Ft&&(k=Ft,Ft=Je,Je=k);var ue=Sd(U,Je),se=Sd(U,Ft);if(ue&&se&&(me.rangeCount!==1||me.anchorNode!==ue.node||me.anchorOffset!==ue.offset||me.focusNode!==se.node||me.focusOffset!==se.offset)){var de=Ne.createRange();de.setStart(ue.node,ue.offset),me.removeAllRanges(),Je>Ft?(me.addRange(de),me.extend(se.node,se.offset)):(de.setEnd(se.node,se.offset),me.addRange(de))}}}}for(Ne=[],me=U;me=me.parentNode;)me.nodeType===1&&Ne.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<Ne.length;U++){var Te=Ne[U];Te.element.scrollLeft=Te.left,Te.element.scrollTop=Te.top}}fc=!!uf,ff=uf=null}finally{Ot=d,te.p=c,V.T=i}}t.current=r,Gn=2}}function Uh(){if(Gn===2){Gn=0;var t=js,r=Xi,i=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||i){i=V.T,V.T=null;var c=te.p;te.p=2;var d=Ot;Ot|=4;try{ph(t,r.alternate,r)}finally{Ot=d,te.p=c,V.T=i}}Gn=3}}function jh(){if(Gn===4||Gn===3){Gn=0,Ve();var t=js,r=Xi,i=$i,c=Ah;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Gn=5:(Gn=0,Xi=js=null,Bh(t,t.pendingLanes));var d=t.pendingLanes;if(d===0&&(Us=null),ua(i),r=r.stateNode,Ke&&typeof Ke.onCommitFiberRoot=="function")try{Ke.onCommitFiberRoot(Gt,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=V.T,d=te.p,te.p=2,V.T=null;try{for(var m=t.onRecoverableError,k=0;k<c.length;k++){var U=c[k];m(U.value,{componentStack:U.stack})}}finally{V.T=r,te.p=d}}($i&3)!==0&&Jo(),Ur(t),d=t.pendingLanes,(i&4194090)!==0&&(d&42)!==0?t===Wu?Pl++:(Pl=0,Wu=t):Pl=0,zl(0)}}function Bh(t,r){(t.pooledCacheLanes&=r)===0&&(r=t.pooledCache,r!=null&&(t.pooledCache=null,xl(r)))}function Jo(t){return Lh(),Uh(),jh(),Fh()}function Fh(){if(Gn!==5)return!1;var t=js,r=Xu;Xu=0;var i=ua($i),c=V.T,d=te.p;try{te.p=32>i?32:i,V.T=null,i=$u,$u=null;var m=js,k=$i;if(Gn=0,Xi=js=null,$i=0,(Ot&6)!==0)throw Error(s(331));var U=Ot;if(Ot|=4,wh(m.current),bh(m,m.current,k,i),Ot=U,zl(0,!1),Ke&&typeof Ke.onPostCommitFiberRoot=="function")try{Ke.onPostCommitFiberRoot(Gt,m)}catch{}return!0}finally{te.p=d,V.T=c,Bh(t,r)}}function Ph(t,r,i){r=$a(i,r),r=Mu(t.stateNode,r,2),t=Ms(t,r,2),t!==null&&(In(t,2),Ur(t))}function Yt(t,r,i){if(t.tag===3)Ph(t,t,i);else for(;r!==null;){if(r.tag===3){Ph(r,t,i);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Us===null||!Us.has(c))){t=$a(i,t),i=Yp(2),c=Ms(r,i,2),c!==null&&(qp(i,c,r,t),In(c,2),Ur(c));break}}r=r.return}}function Ju(t,r,i){var c=t.pingCache;if(c===null){c=t.pingCache=new Ty;var d=new Set;c.set(r,d)}else d=c.get(r),d===void 0&&(d=new Set,c.set(r,d));d.has(i)||(Hu=!0,d.add(i),t=Ry.bind(null,t,r,i),r.then(t,t))}function Ry(t,r,i){var c=t.pingCache;c!==null&&c.delete(r),t.pingedLanes|=t.suspendedLanes&i,t.warmLanes&=~i,Vt===t&&(wt&i)===i&&(sn===4||sn===3&&(wt&62914560)===wt&&300>Le()-Vu?(Ot&2)===0&&Wi(t,0):Yu|=i,Vi===wt&&(Vi=0)),Ur(t)}function zh(t,r){r===0&&(r=ds()),t=Di(t,r),t!==null&&(In(t,r),Ur(t))}function Dy(t){var r=t.memoizedState,i=0;r!==null&&(i=r.retryLane),zh(t,i)}function _y(t,r){var i=0;switch(t.tag){case 13:var c=t.stateNode,d=t.memoizedState;d!==null&&(i=d.retryLane);break;case 19:c=t.stateNode;break;case 22:c=t.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(r),zh(t,i)}function Oy(t,r){return Qt(t,r)}var ec=null,Qi=null,ef=!1,tc=!1,tf=!1,yi=0;function Ur(t){t!==Qi&&t.next===null&&(Qi===null?ec=Qi=t:Qi=Qi.next=t),tc=!0,ef||(ef=!0,Ly())}function zl(t,r){if(!tf&&tc){tf=!0;do for(var i=!1,c=ec;c!==null;){if(t!==0){var d=c.pendingLanes;if(d===0)var m=0;else{var k=c.suspendedLanes,U=c.pingedLanes;m=(1<<31-Xt(42|t)+1)-1,m&=d&~(k&~U),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(i=!0,qh(c,m))}else m=wt,m=ar(c,c===Vt?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(m&3)===0||En(c,m)||(i=!0,qh(c,m));c=c.next}while(i);tf=!1}}function Iy(){Gh()}function Gh(){tc=ef=!1;var t=0;yi!==0&&(Hy()&&(t=yi),yi=0);for(var r=Le(),i=null,c=ec;c!==null;){var d=c.next,m=Hh(c,r);m===0?(c.next=null,i===null?ec=d:i.next=d,d===null&&(Qi=i)):(i=c,(t!==0||(m&3)!==0)&&(tc=!0)),c=d}zl(t)}function Hh(t,r){for(var i=t.suspendedLanes,c=t.pingedLanes,d=t.expirationTimes,m=t.pendingLanes&-62914561;0<m;){var k=31-Xt(m),U=1<<k,ne=d[k];ne===-1?((U&i)===0||(U&c)!==0)&&(d[k]=Ze(U,r)):ne<=r&&(t.expiredLanes|=U),m&=~U}if(r=Vt,i=wt,i=ar(t,t===r?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c=t.callbackNode,i===0||t===r&&(It===2||It===9)||t.cancelPendingCommit!==null)return c!==null&&c!==null&&cn(c),t.callbackNode=null,t.callbackPriority=0;if((i&3)===0||En(t,i)){if(r=i&-i,r===t.callbackPriority)return r;switch(c!==null&&cn(c),ua(i)){case 2:case 8:i=pn;break;case 32:i=ke;break;case 268435456:i=Kt;break;default:i=ke}return c=Yh.bind(null,t),i=Qt(i,c),t.callbackPriority=r,t.callbackNode=i,r}return c!==null&&c!==null&&cn(c),t.callbackPriority=2,t.callbackNode=null,2}function Yh(t,r){if(Gn!==0&&Gn!==5)return t.callbackNode=null,t.callbackPriority=0,null;var i=t.callbackNode;if(Jo()&&t.callbackNode!==i)return null;var c=wt;return c=ar(t,t===Vt?c:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),c===0?null:(Ch(t,c,r),Hh(t,Le()),t.callbackNode!=null&&t.callbackNode===i?Yh.bind(null,t):null)}function qh(t,r){if(Jo())return null;Ch(t,r,!0)}function Ly(){qy(function(){(Ot&6)!==0?Qt(Wt,Iy):Gh()})}function nf(){return yi===0&&(yi=ct()),yi}function Vh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:cr(""+t)}function Xh(t,r){var i=r.ownerDocument.createElement("input");return i.name=r.name,i.value=r.value,t.id&&i.setAttribute("form",t.id),r.parentNode.insertBefore(i,r),t=new FormData(t),i.parentNode.removeChild(i),t}function Uy(t,r,i,c,d){if(r==="submit"&&i&&i.stateNode===d){var m=Vh((d[gn]||null).action),k=c.submitter;k&&(r=(r=k[gn]||null)?Vh(r.formAction):k.getAttribute("formAction"),r!==null&&(m=r,k=null));var U=new bs("action","action",null,c,d);t.push({event:U,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(yi!==0){var ne=k?Xh(d,k):new FormData(d);wu(i,{pending:!0,data:ne,method:d.method,action:m},null,ne)}}else typeof m=="function"&&(U.preventDefault(),ne=k?Xh(d,k):new FormData(d),wu(i,{pending:!0,data:ne,method:d.method,action:m},m,ne))},currentTarget:d}]})}}for(var af=0;af<zc.length;af++){var rf=zc[af],jy=rf.toLowerCase(),By=rf[0].toUpperCase()+rf.slice(1);hr(jy,"on"+By)}hr(Cd,"onAnimationEnd"),hr(Md,"onAnimationIteration"),hr(Nd,"onAnimationStart"),hr("dblclick","onDoubleClick"),hr("focusin","onFocus"),hr("focusout","onBlur"),hr(ty,"onTransitionRun"),hr(ny,"onTransitionStart"),hr(ay,"onTransitionCancel"),hr(kd,"onTransitionEnd"),fa("onMouseEnter",["mouseout","mouseover"]),fa("onMouseLeave",["mouseout","mouseover"]),fa("onPointerEnter",["pointerout","pointerover"]),fa("onPointerLeave",["pointerout","pointerover"]),nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gl));function $h(t,r){r=(r&4)!==0;for(var i=0;i<t.length;i++){var c=t[i],d=c.event;c=c.listeners;e:{var m=void 0;if(r)for(var k=c.length-1;0<=k;k--){var U=c[k],ne=U.instance,pe=U.currentTarget;if(U=U.listener,ne!==m&&d.isPropagationStopped())break e;m=U,d.currentTarget=pe;try{m(d)}catch(Ee){Go(Ee)}d.currentTarget=null,m=ne}else for(k=0;k<c.length;k++){if(U=c[k],ne=U.instance,pe=U.currentTarget,U=U.listener,ne!==m&&d.isPropagationStopped())break e;m=U,d.currentTarget=pe;try{m(d)}catch(Ee){Go(Ee)}d.currentTarget=null,m=ne}}}}function bt(t,r){var i=r[na];i===void 0&&(i=r[na]=new Set);var c=t+"__bubble";i.has(c)||(Wh(r,t,2,!1),i.add(c))}function sf(t,r,i){var c=0;r&&(c|=4),Wh(i,t,c,r)}var nc="_reactListening"+Math.random().toString(36).slice(2);function lf(t){if(!t[nc]){t[nc]=!0,Qe.forEach(function(i){i!=="selectionchange"&&(Fy.has(i)||sf(i,!1,t),sf(i,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[nc]||(r[nc]=!0,sf("selectionchange",!1,r))}}function Wh(t,r,i,c){switch(b0(r)){case 2:var d=d1;break;case 8:d=p1;break;default:d=Sf}i=d.bind(null,r,i,t),d=void 0,!vs||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(d=!0),c?d!==void 0?t.addEventListener(r,i,{capture:!0,passive:d}):t.addEventListener(r,i,!0):d!==void 0?t.addEventListener(r,i,{passive:d}):t.addEventListener(r,i,!1)}function of(t,r,i,c,d){var m=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var k=c.tag;if(k===3||k===4){var U=c.stateNode.containerInfo;if(U===d)break;if(k===4)for(k=c.return;k!==null;){var ne=k.tag;if((ne===3||ne===4)&&k.stateNode.containerInfo===d)return;k=k.return}for(;U!==null;){if(k=Sa(U),k===null)return;if(ne=k.tag,ne===5||ne===6||ne===26||ne===27){c=m=k;continue e}U=U.parentNode}}c=c.return}ti(function(){var pe=m,Ee=ys(i),Ne=[];e:{var he=Rd.get(t);if(he!==void 0){var me=bs,st=t;switch(t){case"keypress":if(Va(i)===0)break e;case"keydown":case"keyup":me=L;break;case"focusin":st="focus",me=ws;break;case"focusout":st="blur",me=ws;break;case"beforeblur":case"afterblur":me=ws;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=Ss;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=Rr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=X;break;case Cd:case Md:case Nd:me=Dr;break;case kd:me=ie;break;case"scroll":case"scrollend":me=Ti;break;case"wheel":me=oe;break;case"copy":case"cut":case"paste":me=Ta;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=z;break;case"toggle":case"beforetoggle":me=fe}var Je=(r&4)!==0,Ft=!Je&&(t==="scroll"||t==="scrollend"),ue=Je?he!==null?he+"Capture":null:he;Je=[];for(var se=pe,de;se!==null;){var Te=se;if(de=Te.stateNode,Te=Te.tag,Te!==5&&Te!==26&&Te!==27||de===null||ue===null||(Te=Xr(se,ue),Te!=null&&Je.push(Hl(se,Te,de))),Ft)break;se=se.return}0<Je.length&&(he=new me(he,st,null,i,Ee),Ne.push({event:he,listeners:Je}))}}if((r&7)===0){e:{if(he=t==="mouseover"||t==="pointerover",me=t==="mouseout"||t==="pointerout",he&&i!==Js&&(st=i.relatedTarget||i.fromElement)&&(Sa(st)||st[Xn]))break e;if((me||he)&&(he=Ee.window===Ee?Ee:(he=Ee.ownerDocument)?he.defaultView||he.parentWindow:window,me?(st=i.relatedTarget||i.toElement,me=pe,st=st?Sa(st):null,st!==null&&(Ft=o(st),Je=st.tag,st!==Ft||Je!==5&&Je!==27&&Je!==6)&&(st=null)):(me=null,st=pe),me!==st)){if(Je=Ss,Te="onMouseLeave",ue="onMouseEnter",se="mouse",(t==="pointerout"||t==="pointerover")&&(Je=z,Te="onPointerLeave",ue="onPointerEnter",se="pointer"),Ft=me==null?he:Et(me),de=st==null?he:Et(st),he=new Je(Te,se+"leave",me,i,Ee),he.target=Ft,he.relatedTarget=de,Te=null,Sa(Ee)===pe&&(Je=new Je(ue,se+"enter",st,i,Ee),Je.target=de,Je.relatedTarget=Ft,Te=Je),Ft=Te,me&&st)t:{for(Je=me,ue=st,se=0,de=Je;de;de=Ki(de))se++;for(de=0,Te=ue;Te;Te=Ki(Te))de++;for(;0<se-de;)Je=Ki(Je),se--;for(;0<de-se;)ue=Ki(ue),de--;for(;se--;){if(Je===ue||ue!==null&&Je===ue.alternate)break t;Je=Ki(Je),ue=Ki(ue)}Je=null}else Je=null;me!==null&&Zh(Ne,he,me,Je,!1),st!==null&&Ft!==null&&Zh(Ne,Ft,st,Je,!0)}}e:{if(he=pe?Et(pe):window,me=he.nodeName&&he.nodeName.toLowerCase(),me==="select"||me==="input"&&he.type==="file")var He=nn;else if(Mt(he))if(Xa)He=pr;else{He=hl;var yt=Ma}else me=he.nodeName,!me||me.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?pe&&aa(pe.elementType)&&(He=nn):He=Wr;if(He&&(He=He(t,pe))){St(Ne,He,i,Ee);break e}yt&&yt(t,he,pe),t==="focusout"&&pe&&he.type==="number"&&pe.memoizedProps.value!=null&&Vr(he,"number",he.value)}switch(yt=pe?Et(pe):window,t){case"focusin":(Mt(yt)||yt.contentEditable==="true")&&(Ni=yt,Bc=pe,ml=null);break;case"focusout":ml=Bc=Ni=null;break;case"mousedown":Fc=!0;break;case"contextmenu":case"mouseup":case"dragend":Fc=!1,Ad(Ne,i,Ee);break;case"selectionchange":if(ey)break;case"keydown":case"keyup":Ad(Ne,i,Ee)}var We;if(Ae)e:{switch(t){case"compositionstart":var tt="onCompositionStart";break e;case"compositionend":tt="onCompositionEnd";break e;case"compositionupdate":tt="onCompositionUpdate";break e}tt=void 0}else $e?ht(t,i)&&(tt="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(tt="onCompositionStart");tt&&(Ge&&i.locale!=="ko"&&($e||tt!=="onCompositionStart"?tt==="onCompositionEnd"&&$e&&(We=Cr()):(tn=Ee,qa="value"in tn?tn.value:tn.textContent,$e=!0)),yt=ac(pe,tt),0<yt.length&&(tt=new Mi(tt,t,null,i,Ee),Ne.push({event:tt,listeners:yt}),We?tt.data=We:(We=xt(i),We!==null&&(tt.data=We)))),(We=Ie?ra(t,i):Ht(t,i))&&(tt=ac(pe,"onBeforeInput"),0<tt.length&&(yt=new Mi("onBeforeInput","beforeinput",null,i,Ee),Ne.push({event:yt,listeners:tt}),yt.data=We)),Uy(Ne,t,pe,i,Ee)}$h(Ne,r)})}function Hl(t,r,i){return{instance:t,listener:r,currentTarget:i}}function ac(t,r){for(var i=r+"Capture",c=[];t!==null;){var d=t,m=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||m===null||(d=Xr(t,i),d!=null&&c.unshift(Hl(t,d,m)),d=Xr(t,r),d!=null&&c.push(Hl(t,d,m))),t.tag===3)return c;t=t.return}return[]}function Ki(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Zh(t,r,i,c,d){for(var m=r._reactName,k=[];i!==null&&i!==c;){var U=i,ne=U.alternate,pe=U.stateNode;if(U=U.tag,ne!==null&&ne===c)break;U!==5&&U!==26&&U!==27||pe===null||(ne=pe,d?(pe=Xr(i,m),pe!=null&&k.unshift(Hl(i,pe,ne))):d||(pe=Xr(i,m),pe!=null&&k.push(Hl(i,pe,ne)))),i=i.return}k.length!==0&&t.push({event:r,listeners:k})}var Py=/\r\n?/g,zy=/\u0000|\uFFFD/g;function Qh(t){return(typeof t=="string"?t:""+t).replace(Py,`
`).replace(zy,"")}function Kh(t,r){return r=Qh(r),Qh(t)===r}function rc(){}function Bt(t,r,i,c,d,m){switch(i){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||za(t,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&za(t,""+c);break;case"className":da(t,"class",c);break;case"tabIndex":da(t,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":da(t,i,c);break;case"style":Ha(t,c,m);break;case"data":if(r!=="object"){da(t,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||i!=="href")){t.removeAttribute(i);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=cr(""+c),t.setAttribute(i,c);break;case"action":case"formAction":if(typeof c=="function"){t.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(i==="formAction"?(r!=="input"&&Bt(t,r,"name",d.name,d,null),Bt(t,r,"formEncType",d.formEncType,d,null),Bt(t,r,"formMethod",d.formMethod,d,null),Bt(t,r,"formTarget",d.formTarget,d,null)):(Bt(t,r,"encType",d.encType,d,null),Bt(t,r,"method",d.method,d,null),Bt(t,r,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){t.removeAttribute(i);break}c=cr(""+c),t.setAttribute(i,c);break;case"onClick":c!=null&&(t.onclick=rc);break;case"onScroll":c!=null&&bt("scroll",t);break;case"onScrollEnd":c!=null&&bt("scrollend",t);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"multiple":t.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":t.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){t.removeAttribute("xlink:href");break}i=cr(""+c),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""+c):t.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,""):t.removeAttribute(i);break;case"capture":case"download":c===!0?t.setAttribute(i,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?t.setAttribute(i,c):t.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?t.setAttribute(i,c):t.removeAttribute(i);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?t.removeAttribute(i):t.setAttribute(i,c);break;case"popover":bt("beforetoggle",t),bt("toggle",t),wa(t,"popover",c);break;case"xlinkActuate":$n(t,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":$n(t,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":$n(t,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":$n(t,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":$n(t,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":$n(t,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":$n(t,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":$n(t,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":$n(t,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":wa(t,"is",c);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=Ai.get(i)||i,wa(t,i,c))}}function cf(t,r,i,c,d,m){switch(i){case"style":Ha(t,c,m);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(i=c.__html,i!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=i}}break;case"children":typeof c=="string"?za(t,c):(typeof c=="number"||typeof c=="bigint")&&za(t,""+c);break;case"onScroll":c!=null&&bt("scroll",t);break;case"onScrollEnd":c!=null&&bt("scrollend",t);break;case"onClick":c!=null&&(t.onclick=rc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pe.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(d=i.endsWith("Capture"),r=i.slice(2,d?i.length-7:void 0),m=t[gn]||null,m=m!=null?m[i]:null,typeof m=="function"&&t.removeEventListener(r,m,d),typeof c=="function")){typeof m!="function"&&m!==null&&(i in t?t[i]=null:t.hasAttribute(i)&&t.removeAttribute(i)),t.addEventListener(r,c,d);break e}i in t?t[i]=c:c===!0?t.setAttribute(i,""):wa(t,i,c)}}}function Hn(t,r,i){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":bt("error",t),bt("load",t);var c=!1,d=!1,m;for(m in i)if(i.hasOwnProperty(m)){var k=i[m];if(k!=null)switch(m){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Bt(t,r,m,k,i,null)}}d&&Bt(t,r,"srcSet",i.srcSet,i,null),c&&Bt(t,r,"src",i.src,i,null);return;case"input":bt("invalid",t);var U=m=k=d=null,ne=null,pe=null;for(c in i)if(i.hasOwnProperty(c)){var Ee=i[c];if(Ee!=null)switch(c){case"name":d=Ee;break;case"type":k=Ee;break;case"checked":ne=Ee;break;case"defaultChecked":pe=Ee;break;case"value":m=Ee;break;case"defaultValue":U=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(s(137,r));break;default:Bt(t,r,c,Ee,i,null)}}hs(t,m,U,ne,pe,k,d,!1),sr(t);return;case"select":bt("invalid",t),c=k=m=null;for(d in i)if(i.hasOwnProperty(d)&&(U=i[d],U!=null))switch(d){case"value":m=U;break;case"defaultValue":k=U;break;case"multiple":c=U;default:Bt(t,r,d,U,i,null)}r=m,i=k,t.multiple=!!c,r!=null?lr(t,!!c,r,!1):i!=null&&lr(t,!!c,i,!0);return;case"textarea":bt("invalid",t),m=d=c=null;for(k in i)if(i.hasOwnProperty(k)&&(U=i[k],U!=null))switch(k){case"value":c=U;break;case"defaultValue":d=U;break;case"children":m=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(s(91));break;default:Bt(t,r,k,U,i,null)}ms(t,c,d,m),sr(t);return;case"option":for(ne in i)i.hasOwnProperty(ne)&&(c=i[ne],c!=null)&&(ne==="selected"?t.selected=c&&typeof c!="function"&&typeof c!="symbol":Bt(t,r,ne,c,i,null));return;case"dialog":bt("beforetoggle",t),bt("toggle",t),bt("cancel",t),bt("close",t);break;case"iframe":case"object":bt("load",t);break;case"video":case"audio":for(c=0;c<Gl.length;c++)bt(Gl[c],t);break;case"image":bt("error",t),bt("load",t);break;case"details":bt("toggle",t);break;case"embed":case"source":case"link":bt("error",t),bt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pe in i)if(i.hasOwnProperty(pe)&&(c=i[pe],c!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:Bt(t,r,pe,c,i,null)}return;default:if(aa(r)){for(Ee in i)i.hasOwnProperty(Ee)&&(c=i[Ee],c!==void 0&&cf(t,r,Ee,c,i,void 0));return}}for(U in i)i.hasOwnProperty(U)&&(c=i[U],c!=null&&Bt(t,r,U,c,i,null))}function Gy(t,r,i,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,m=null,k=null,U=null,ne=null,pe=null,Ee=null;for(me in i){var Ne=i[me];if(i.hasOwnProperty(me)&&Ne!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":ne=Ne;default:c.hasOwnProperty(me)||Bt(t,r,me,null,c,Ne)}}for(var he in c){var me=c[he];if(Ne=i[he],c.hasOwnProperty(he)&&(me!=null||Ne!=null))switch(he){case"type":m=me;break;case"name":d=me;break;case"checked":pe=me;break;case"defaultChecked":Ee=me;break;case"value":k=me;break;case"defaultValue":U=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(s(137,r));break;default:me!==Ne&&Bt(t,r,he,me,c,Ne)}}Pa(t,k,U,ne,pe,Ee,m,d);return;case"select":me=k=U=he=null;for(m in i)if(ne=i[m],i.hasOwnProperty(m)&&ne!=null)switch(m){case"value":break;case"multiple":me=ne;default:c.hasOwnProperty(m)||Bt(t,r,m,null,c,ne)}for(d in c)if(m=c[d],ne=i[d],c.hasOwnProperty(d)&&(m!=null||ne!=null))switch(d){case"value":he=m;break;case"defaultValue":U=m;break;case"multiple":k=m;default:m!==ne&&Bt(t,r,d,m,c,ne)}r=U,i=k,c=me,he!=null?lr(t,!!i,he,!1):!!c!=!!i&&(r!=null?lr(t,!!i,r,!0):lr(t,!!i,i?[]:"",!1));return;case"textarea":me=he=null;for(U in i)if(d=i[U],i.hasOwnProperty(U)&&d!=null&&!c.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:Bt(t,r,U,null,c,d)}for(k in c)if(d=c[k],m=i[k],c.hasOwnProperty(k)&&(d!=null||m!=null))switch(k){case"value":he=d;break;case"defaultValue":me=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==m&&Bt(t,r,k,d,c,m)}Tr(t,he,me);return;case"option":for(var st in i)he=i[st],i.hasOwnProperty(st)&&he!=null&&!c.hasOwnProperty(st)&&(st==="selected"?t.selected=!1:Bt(t,r,st,null,c,he));for(ne in c)he=c[ne],me=i[ne],c.hasOwnProperty(ne)&&he!==me&&(he!=null||me!=null)&&(ne==="selected"?t.selected=he&&typeof he!="function"&&typeof he!="symbol":Bt(t,r,ne,he,c,me));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Je in i)he=i[Je],i.hasOwnProperty(Je)&&he!=null&&!c.hasOwnProperty(Je)&&Bt(t,r,Je,null,c,he);for(pe in c)if(he=c[pe],me=i[pe],c.hasOwnProperty(pe)&&he!==me&&(he!=null||me!=null))switch(pe){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(s(137,r));break;default:Bt(t,r,pe,he,c,me)}return;default:if(aa(r)){for(var Ft in i)he=i[Ft],i.hasOwnProperty(Ft)&&he!==void 0&&!c.hasOwnProperty(Ft)&&cf(t,r,Ft,void 0,c,he);for(Ee in c)he=c[Ee],me=i[Ee],!c.hasOwnProperty(Ee)||he===me||he===void 0&&me===void 0||cf(t,r,Ee,he,c,me);return}}for(var ue in i)he=i[ue],i.hasOwnProperty(ue)&&he!=null&&!c.hasOwnProperty(ue)&&Bt(t,r,ue,null,c,he);for(Ne in c)he=c[Ne],me=i[Ne],!c.hasOwnProperty(Ne)||he===me||he==null&&me==null||Bt(t,r,Ne,he,c,me)}var uf=null,ff=null;function sc(t){return t.nodeType===9?t:t.ownerDocument}function Jh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function e0(t,r){if(t===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&r==="foreignObject"?0:t}function df(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var pf=null;function Hy(){var t=window.event;return t&&t.type==="popstate"?t===pf?!1:(pf=t,!0):(pf=null,!1)}var t0=typeof setTimeout=="function"?setTimeout:void 0,Yy=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,qy=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(t){return n0.resolve(null).then(t).catch(Vy)}:t0;function Vy(t){setTimeout(function(){throw t})}function Fs(t){return t==="head"}function a0(t,r){var i=r,c=0,d=0;do{var m=i.nextSibling;if(t.removeChild(i),m&&m.nodeType===8)if(i=m.data,i==="/$"){if(0<c&&8>c){i=c;var k=t.ownerDocument;if(i&1&&Yl(k.documentElement),i&2&&Yl(k.body),i&4)for(i=k.head,Yl(i),k=i.firstChild;k;){var U=k.nextSibling,ne=k.nodeName;k[rr]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&k.rel.toLowerCase()==="stylesheet"||i.removeChild(k),k=U}}if(d===0){t.removeChild(m),Kl(r);return}d--}else i==="$"||i==="$?"||i==="$!"?d++:c=i.charCodeAt(0)-48;else c=0;i=m}while(i);Kl(r)}function hf(t){var r=t.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var i=r;switch(r=r.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":hf(i),Qs(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}t.removeChild(i)}}function Xy(t,r,i,c){for(;t.nodeType===1;){var d=i;if(t.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(c){if(!t[rr])switch(r){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(m=t.getAttribute("rel"),m==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(m!==d.rel||t.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(m=t.getAttribute("src"),(m!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&m&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(r==="input"&&t.type==="hidden"){var m=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===m)return t}else return t;if(t=gr(t.nextSibling),t===null)break}return null}function $y(t,r,i){if(r==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=gr(t.nextSibling),t===null))return null;return t}function mf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function Wy(t,r){var i=t.ownerDocument;if(t.data!=="$?"||i.readyState==="complete")r();else{var c=function(){r(),i.removeEventListener("DOMContentLoaded",c)};i.addEventListener("DOMContentLoaded",c),t._reactRetry=c}}function gr(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return t}var gf=null;function r0(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(r===0)return t;r--}else i==="/$"&&r++}t=t.previousSibling}return null}function s0(t,r,i){switch(r=sc(i),t){case"html":if(t=r.documentElement,!t)throw Error(s(452));return t;case"head":if(t=r.head,!t)throw Error(s(453));return t;case"body":if(t=r.body,!t)throw Error(s(454));return t;default:throw Error(s(451))}}function Yl(t){for(var r=t.attributes;r.length;)t.removeAttributeNode(r[0]);Qs(t)}var er=new Map,i0=new Set;function ic(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var os=te.d;te.d={f:Zy,r:Qy,D:Ky,C:Jy,L:e1,m:t1,X:a1,S:n1,M:r1};function Zy(){var t=os.f(),r=Qo();return t||r}function Qy(t){var r=Ln(t);r!==null&&r.tag===5&&r.type==="form"?Cp(r):os.r(t)}var Ji=typeof document>"u"?null:document;function l0(t,r,i){var c=Ji;if(c&&typeof r=="string"&&r){var d=Fn(r);d='link[rel="'+t+'"][href="'+d+'"]',typeof i=="string"&&(d+='[crossorigin="'+i+'"]'),i0.has(d)||(i0.add(d),t={rel:t,crossOrigin:i,href:r},c.querySelector(d)===null&&(r=c.createElement("link"),Hn(r,"link",t),ut(r),c.head.appendChild(r)))}}function Ky(t){os.D(t),l0("dns-prefetch",t,null)}function Jy(t,r){os.C(t,r),l0("preconnect",t,r)}function e1(t,r,i){os.L(t,r,i);var c=Ji;if(c&&t&&r){var d='link[rel="preload"][as="'+Fn(r)+'"]';r==="image"&&i&&i.imageSrcSet?(d+='[imagesrcset="'+Fn(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(d+='[imagesizes="'+Fn(i.imageSizes)+'"]')):d+='[href="'+Fn(t)+'"]';var m=d;switch(r){case"style":m=el(t);break;case"script":m=tl(t)}er.has(m)||(t=b({rel:"preload",href:r==="image"&&i&&i.imageSrcSet?void 0:t,as:r},i),er.set(m,t),c.querySelector(d)!==null||r==="style"&&c.querySelector(ql(m))||r==="script"&&c.querySelector(Vl(m))||(r=c.createElement("link"),Hn(r,"link",t),ut(r),c.head.appendChild(r)))}}function t1(t,r){os.m(t,r);var i=Ji;if(i&&t){var c=r&&typeof r.as=="string"?r.as:"script",d='link[rel="modulepreload"][as="'+Fn(c)+'"][href="'+Fn(t)+'"]',m=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=tl(t)}if(!er.has(m)&&(t=b({rel:"modulepreload",href:t},r),er.set(m,t),i.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Vl(m)))return}c=i.createElement("link"),Hn(c,"link",t),ut(c),i.head.appendChild(c)}}}function n1(t,r,i){os.S(t,r,i);var c=Ji;if(c&&t){var d=Nn(c).hoistableStyles,m=el(t);r=r||"default";var k=d.get(m);if(!k){var U={loading:0,preload:null};if(k=c.querySelector(ql(m)))U.loading=5;else{t=b({rel:"stylesheet",href:t,"data-precedence":r},i),(i=er.get(m))&&yf(t,i);var ne=k=c.createElement("link");ut(ne),Hn(ne,"link",t),ne._p=new Promise(function(pe,Ee){ne.onload=pe,ne.onerror=Ee}),ne.addEventListener("load",function(){U.loading|=1}),ne.addEventListener("error",function(){U.loading|=2}),U.loading|=4,lc(k,r,c)}k={type:"stylesheet",instance:k,count:1,state:U},d.set(m,k)}}}function a1(t,r){os.X(t,r);var i=Ji;if(i&&t){var c=Nn(i).hoistableScripts,d=tl(t),m=c.get(d);m||(m=i.querySelector(Vl(d)),m||(t=b({src:t,async:!0},r),(r=er.get(d))&&vf(t,r),m=i.createElement("script"),ut(m),Hn(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function r1(t,r){os.M(t,r);var i=Ji;if(i&&t){var c=Nn(i).hoistableScripts,d=tl(t),m=c.get(d);m||(m=i.querySelector(Vl(d)),m||(t=b({src:t,async:!0,type:"module"},r),(r=er.get(d))&&vf(t,r),m=i.createElement("script"),ut(m),Hn(m,"link",t),i.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function o0(t,r,i,c){var d=(d=Me.current)?ic(d):null;if(!d)throw Error(s(446));switch(t){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(r=el(i.href),i=Nn(d).hoistableStyles,c=i.get(r),c||(c={type:"style",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){t=el(i.href);var m=Nn(d).hoistableStyles,k=m.get(t);if(k||(d=d.ownerDocument||d,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(t,k),(m=d.querySelector(ql(t)))&&!m._p&&(k.instance=m,k.state.loading=5),er.has(t)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},er.set(t,i),m||s1(d,t,i,k.state))),r&&c===null)throw Error(s(528,""));return k}if(r&&c!==null)throw Error(s(529,""));return null;case"script":return r=i.async,i=i.src,typeof i=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=tl(i),i=Nn(d).hoistableScripts,c=i.get(r),c||(c={type:"script",instance:null,count:0,state:null},i.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,t))}}function el(t){return'href="'+Fn(t)+'"'}function ql(t){return'link[rel="stylesheet"]['+t+"]"}function c0(t){return b({},t,{"data-precedence":t.precedence,precedence:null})}function s1(t,r,i,c){t.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=t.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Hn(r,"link",i),ut(r),t.head.appendChild(r))}function tl(t){return'[src="'+Fn(t)+'"]'}function Vl(t){return"script[async]"+t}function u0(t,r,i){if(r.count++,r.instance===null)switch(r.type){case"style":var c=t.querySelector('style[data-href~="'+Fn(i.href)+'"]');if(c)return r.instance=c,ut(c),c;var d=b({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return c=(t.ownerDocument||t).createElement("style"),ut(c),Hn(c,"style",d),lc(c,i.precedence,t),r.instance=c;case"stylesheet":d=el(i.href);var m=t.querySelector(ql(d));if(m)return r.state.loading|=4,r.instance=m,ut(m),m;c=c0(i),(d=er.get(d))&&yf(c,d),m=(t.ownerDocument||t).createElement("link"),ut(m);var k=m;return k._p=new Promise(function(U,ne){k.onload=U,k.onerror=ne}),Hn(m,"link",c),r.state.loading|=4,lc(m,i.precedence,t),r.instance=m;case"script":return m=tl(i.src),(d=t.querySelector(Vl(m)))?(r.instance=d,ut(d),d):(c=i,(d=er.get(m))&&(c=b({},i),vf(c,d)),t=t.ownerDocument||t,d=t.createElement("script"),ut(d),Hn(d,"link",c),t.head.appendChild(d),r.instance=d);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,lc(c,i.precedence,t));return r.instance}function lc(t,r,i){for(var c=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,m=d,k=0;k<c.length;k++){var U=c[k];if(U.dataset.precedence===r)m=U;else if(m!==d)break}m?m.parentNode.insertBefore(t,m.nextSibling):(r=i.nodeType===9?i.head:i,r.insertBefore(t,r.firstChild))}function yf(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.title==null&&(t.title=r.title)}function vf(t,r){t.crossOrigin==null&&(t.crossOrigin=r.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=r.referrerPolicy),t.integrity==null&&(t.integrity=r.integrity)}var oc=null;function f0(t,r,i){if(oc===null){var c=new Map,d=oc=new Map;d.set(i,c)}else d=oc,c=d.get(i),c||(c=new Map,d.set(i,c));if(c.has(t))return c;for(c.set(t,null),i=i.getElementsByTagName(t),d=0;d<i.length;d++){var m=i[d];if(!(m[rr]||m[kt]||t==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var k=m.getAttribute(r)||"";k=t+k;var U=c.get(k);U?U.push(m):c.set(k,[m])}}return c}function d0(t,r,i){t=t.ownerDocument||t,t.head.insertBefore(i,r==="title"?t.querySelector("head > title"):null)}function i1(t,r,i){if(i===1||r.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(t=r.disabled,typeof r.precedence=="string"&&t==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function p0(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}var Xl=null;function l1(){}function o1(t,r,i){if(Xl===null)throw Error(s(475));var c=Xl;if(r.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var d=el(i.href),m=t.querySelector(ql(d));if(m){t=m._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(c.count++,c=cc.bind(c),t.then(c,c)),r.state.loading|=4,r.instance=m,ut(m);return}m=t.ownerDocument||t,i=c0(i),(d=er.get(d))&&yf(i,d),m=m.createElement("link"),ut(m);var k=m;k._p=new Promise(function(U,ne){k.onload=U,k.onerror=ne}),Hn(m,"link",i),r.instance=m}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(r,t),(t=r.state.preload)&&(r.state.loading&3)===0&&(c.count++,r=cc.bind(c),t.addEventListener("load",r),t.addEventListener("error",r))}}function c1(){if(Xl===null)throw Error(s(475));var t=Xl;return t.stylesheets&&t.count===0&&bf(t,t.stylesheets),0<t.count?function(r){var i=setTimeout(function(){if(t.stylesheets&&bf(t,t.stylesheets),t.unsuspend){var c=t.unsuspend;t.unsuspend=null,c()}},6e4);return t.unsuspend=r,function(){t.unsuspend=null,clearTimeout(i)}}:null}function cc(){if(this.count--,this.count===0){if(this.stylesheets)bf(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var uc=null;function bf(t,r){t.stylesheets=null,t.unsuspend!==null&&(t.count++,uc=new Map,r.forEach(u1,t),uc=null,cc.call(t))}function u1(t,r){if(!(r.state.loading&4)){var i=uc.get(t);if(i)var c=i.get(null);else{i=new Map,uc.set(t,i);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<d.length;m++){var k=d[m];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(i.set(k.dataset.precedence,k),c=k)}c&&i.set(null,c)}d=r.instance,k=d.getAttribute("data-precedence"),m=i.get(k)||c,m===c&&i.set(null,d),i.set(k,d),this.count++,c=cc.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),m?m.parentNode.insertBefore(d,m.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),r.state.loading|=4}}var $l={$$typeof:D,Provider:null,Consumer:null,_currentValue:ce,_currentValue2:ce,_threadCount:0};function f1(t,r,i,c,d,m,k,U){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vn(0),this.hiddenUpdates=Vn(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=m,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function h0(t,r,i,c,d,m,k,U,ne,pe,Ee,Ne){return t=new f1(t,r,i,k,U,ne,pe,Ne),r=1,m===!0&&(r|=24),m=Na(3,null,null,r),t.current=m,m.stateNode=t,r=Jc(),r.refCount++,t.pooledCache=r,r.refCount++,m.memoizedState={element:c,isDehydrated:i,cache:r},au(m),t}function m0(t){return t?(t=_i,t):_i}function g0(t,r,i,c,d,m){d=m0(d),c.context===null?c.context=d:c.pendingContext=d,c=Cs(r),c.payload={element:i},m=m===void 0?null:m,m!==null&&(c.callback=m),i=Ms(t,c,r),i!==null&&(Oa(i,t,r),Al(i,t,r))}function y0(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<r?i:r}}function xf(t,r){y0(t,r),(t=t.alternate)&&y0(t,r)}function v0(t){if(t.tag===13){var r=Di(t,67108864);r!==null&&Oa(r,t,67108864),xf(t,67108864)}}var fc=!0;function d1(t,r,i,c){var d=V.T;V.T=null;var m=te.p;try{te.p=2,Sf(t,r,i,c)}finally{te.p=m,V.T=d}}function p1(t,r,i,c){var d=V.T;V.T=null;var m=te.p;try{te.p=8,Sf(t,r,i,c)}finally{te.p=m,V.T=d}}function Sf(t,r,i,c){if(fc){var d=wf(c);if(d===null)of(t,r,c,dc,i),x0(t,c);else if(m1(d,t,r,i,c))c.stopPropagation();else if(x0(t,c),r&4&&-1<h1.indexOf(t)){for(;d!==null;){var m=Ln(d);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var k=hn(m.pendingLanes);if(k!==0){var U=m;for(U.pendingLanes|=2,U.entangledLanes|=2;k;){var ne=1<<31-Xt(k);U.entanglements[1]|=ne,k&=~ne}Ur(m),(Ot&6)===0&&(Wo=Le()+500,zl(0))}}break;case 13:U=Di(m,2),U!==null&&Oa(U,m,2),Qo(),xf(m,2)}if(m=wf(c),m===null&&of(t,r,c,dc,i),m===d)break;d=m}d!==null&&c.stopPropagation()}else of(t,r,c,null,i)}}function wf(t){return t=ys(t),Ef(t)}var dc=null;function Ef(t){if(dc=null,t=Sa(t),t!==null){var r=o(t);if(r===null)t=null;else{var i=r.tag;if(i===13){if(t=u(r),t!==null)return t;t=null}else if(i===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null)}}return dc=t,null}function b0(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(rt()){case Wt:return 2;case pn:return 8;case ke:case Se:return 32;case Kt:return 268435456;default:return 32}default:return 32}}var Af=!1,Ps=null,zs=null,Gs=null,Wl=new Map,Zl=new Map,Hs=[],h1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function x0(t,r){switch(t){case"focusin":case"focusout":Ps=null;break;case"dragenter":case"dragleave":zs=null;break;case"mouseover":case"mouseout":Gs=null;break;case"pointerover":case"pointerout":Wl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zl.delete(r.pointerId)}}function Ql(t,r,i,c,d,m){return t===null||t.nativeEvent!==m?(t={blockedOn:r,domEventName:i,eventSystemFlags:c,nativeEvent:m,targetContainers:[d]},r!==null&&(r=Ln(r),r!==null&&v0(r)),t):(t.eventSystemFlags|=c,r=t.targetContainers,d!==null&&r.indexOf(d)===-1&&r.push(d),t)}function m1(t,r,i,c,d){switch(r){case"focusin":return Ps=Ql(Ps,t,r,i,c,d),!0;case"dragenter":return zs=Ql(zs,t,r,i,c,d),!0;case"mouseover":return Gs=Ql(Gs,t,r,i,c,d),!0;case"pointerover":var m=d.pointerId;return Wl.set(m,Ql(Wl.get(m)||null,t,r,i,c,d)),!0;case"gotpointercapture":return m=d.pointerId,Zl.set(m,Ql(Zl.get(m)||null,t,r,i,c,d)),!0}return!1}function S0(t){var r=Sa(t.target);if(r!==null){var i=o(r);if(i!==null){if(r=i.tag,r===13){if(r=u(i),r!==null){t.blockedOn=r,ta(t.priority,function(){if(i.tag===13){var c=_a();c=ca(c);var d=Di(i,c);d!==null&&Oa(d,i,c),xf(i,c)}});return}}else if(r===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function pc(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var i=wf(t.nativeEvent);if(i===null){i=t.nativeEvent;var c=new i.constructor(i.type,i);Js=c,i.target.dispatchEvent(c),Js=null}else return r=Ln(i),r!==null&&v0(r),t.blockedOn=i,!1;r.shift()}return!0}function w0(t,r,i){pc(t)&&i.delete(r)}function g1(){Af=!1,Ps!==null&&pc(Ps)&&(Ps=null),zs!==null&&pc(zs)&&(zs=null),Gs!==null&&pc(Gs)&&(Gs=null),Wl.forEach(w0),Zl.forEach(w0)}function hc(t,r){t.blockedOn===r&&(t.blockedOn=null,Af||(Af=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,g1)))}var mc=null;function E0(t){mc!==t&&(mc=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){mc===t&&(mc=null);for(var r=0;r<t.length;r+=3){var i=t[r],c=t[r+1],d=t[r+2];if(typeof c!="function"){if(Ef(c||i)===null)continue;break}var m=Ln(i);m!==null&&(t.splice(r,3),r-=3,wu(m,{pending:!0,data:d,method:i.method,action:c},c,d))}}))}function Kl(t){function r(ne){return hc(ne,t)}Ps!==null&&hc(Ps,t),zs!==null&&hc(zs,t),Gs!==null&&hc(Gs,t),Wl.forEach(r),Zl.forEach(r);for(var i=0;i<Hs.length;i++){var c=Hs[i];c.blockedOn===t&&(c.blockedOn=null)}for(;0<Hs.length&&(i=Hs[0],i.blockedOn===null);)S0(i),i.blockedOn===null&&Hs.shift();if(i=(t.ownerDocument||t).$$reactFormReplay,i!=null)for(c=0;c<i.length;c+=3){var d=i[c],m=i[c+1],k=d[gn]||null;if(typeof m=="function")k||E0(i);else if(k){var U=null;if(m&&m.hasAttribute("formAction")){if(d=m,k=m[gn]||null)U=k.formAction;else if(Ef(d)!==null)continue}else U=k.action;typeof U=="function"?i[c+1]=U:(i.splice(c,3),c-=3),E0(i)}}}function Tf(t){this._internalRoot=t}gc.prototype.render=Tf.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(s(409));var i=r.current,c=_a();g0(i,c,t,r,null,null)},gc.prototype.unmount=Tf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;g0(t.current,2,null,t,null,null),Qo(),r[Xn]=null}};function gc(t){this._internalRoot=t}gc.prototype.unstable_scheduleHydration=function(t){if(t){var r=ba();t={blockedOn:null,target:t,priority:r};for(var i=0;i<Hs.length&&r!==0&&r<Hs[i].priority;i++);Hs.splice(i,0,t),i===0&&S0(t)}};var A0=e.version;if(A0!=="19.1.1")throw Error(s(527,A0,"19.1.1"));te.findDOMNode=function(t){var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(s(188)):(t=Object.keys(t).join(","),Error(s(268,t)));return t=p(r),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var y1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yc.isDisabled&&yc.supportsFiber)try{Gt=yc.inject(y1),Ke=yc}catch{}}return eo.createRoot=function(t,r){if(!l(t))throw Error(s(299));var i=!1,c="",d=Pp,m=zp,k=Gp,U=null;return r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(d=r.onUncaughtError),r.onCaughtError!==void 0&&(m=r.onCaughtError),r.onRecoverableError!==void 0&&(k=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(U=r.unstable_transitionCallbacks)),r=h0(t,1,!1,null,null,i,c,d,m,k,U,null),t[Xn]=r.current,lf(t),new Tf(r)},eo.hydrateRoot=function(t,r,i){if(!l(t))throw Error(s(299));var c=!1,d="",m=Pp,k=zp,U=Gp,ne=null,pe=null;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(m=i.onUncaughtError),i.onCaughtError!==void 0&&(k=i.onCaughtError),i.onRecoverableError!==void 0&&(U=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(ne=i.unstable_transitionCallbacks),i.formState!==void 0&&(pe=i.formState)),r=h0(t,1,!0,r,i??null,c,d,m,k,U,ne,pe),r.context=m0(null),i=r.current,c=_a(),c=ca(c),d=Cs(c),d.callback=null,Ms(i,d,c),i=c,r.current.lanes=i,In(r,i),Ur(r),t[Xn]=r.current,lf(t),new gc(r)},eo.version="19.1.1",eo}var I0;function C1(){if(I0)return Nf.exports;I0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Nf.exports=T1(),Nf.exports}var M1=C1();const N1=ad(M1),k1="modulepreload",R1=function(n,e){return new URL(n,e).href},L0={},U0=function(e,a,s){let l=Promise.resolve();if(a&&a.length>0){let g=function(b){return Promise.all(b.map(C=>Promise.resolve(C).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};const u=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");l=g(a.map(b=>{if(b=R1(b,s),b in L0)return;L0[b]=!0;const C=b.endsWith(".css"),w=C?'[rel="stylesheet"]':"";if(s)for(let M=u.length-1;M>=0;M--){const R=u[M];if(R.href===b&&(!C||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${w}`))return;const x=document.createElement("link");if(x.rel=C?"stylesheet":k1,C||(x.as="script"),x.crossOrigin="",x.href=b,p&&x.setAttribute("nonce",p),document.head.appendChild(x),C)return new Promise((M,R)=>{x.addEventListener("load",M),x.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${b}`)))})}))}function o(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return l.then(u=>{for(const h of u||[])h.status==="rejected"&&o(h.reason);return e().catch(o)})};class yr{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,a,s={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==yr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof a!="function")throw new TypeError("The callback must be a function.");const l=new j0(e,this,a,s);return this.eventMap[e]||(this.eventMap[e]=[]),s.prepend?this.eventMap[e].unshift(l):this.eventMap[e].push(l),l}addOneTimeListener(e,a,s={}){s.remaining=1,this.addListener(e,a,s)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,a){return e===void 0?this.eventMap[yr.ANY_EVENT]&&this.eventMap[yr.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,s])=>s.length>0):this.eventMap[e]&&this.eventMap[e].length>0?a instanceof j0?this.eventMap[e].filter(l=>l===a).length>0:typeof a=="function"?this.eventMap[e].filter(l=>l.callback===a).length>0:a==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(a=>{a.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...a){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let s=[],l=this.eventMap[yr.ANY_EVENT]||[];return this.eventMap[e]&&(l=l.concat(this.eventMap[e])),l.forEach(o=>{if(o.suspended)return;let u=[...a];Array.isArray(o.arguments)&&(u=u.concat(o.arguments)),o.remaining>0&&(s.push(o.callback.apply(o.context,u)),o.count++),--o.remaining<1&&o.remove()}),s}removeListener(e,a,s={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let l=this.eventMap[e].filter(o=>a&&o.callback!==a||s.remaining&&s.remaining!==o.remaining||s.context&&s.context!==o.context);l.length?this.eventMap[e]=l:delete this.eventMap[e]}async waitFor(e,a={}){return a.duration=parseInt(a.duration),(isNaN(a.duration)||a.duration<=0)&&(a.duration=1/0),new Promise((s,l)=>{let o,u=this.addListener(e,()=>{clearTimeout(o),s()},{remaining:1});a.duration!==1/0&&(o=setTimeout(()=>{u.remove(),l("The duration expired before the event was emitted.")},a.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class j0{constructor(e,a,s,l={}){if(typeof e!="string"&&!(e instanceof String)&&e!==yr.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!a)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof s!="function")throw new TypeError("The 'callback' must be a function.");l.arguments!==void 0&&!Array.isArray(l.arguments)&&(l.arguments=[l.arguments]),l=Object.assign({context:a,remaining:1/0,arguments:void 0,duration:1/0},l),l.duration!==1/0&&setTimeout(()=>this.remove(),l.duration),this.arguments=l.arguments,this.callback=s,this.context=l.context,this.count=0,this.event=e,this.remaining=parseInt(l.remaining)>=1?parseInt(l.remaining):1/0,this.suspended=!1,this.target=a}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class Ce{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Ce.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Ce.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Ce.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Ce.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class sl{constructor(e,a={}){this.duration=_e.defaults.note.duration,this.attack=_e.defaults.note.attack,this.release=_e.defaults.note.release,a.duration!=null&&(this.duration=a.duration),a.attack!=null&&(this.attack=a.attack),a.rawAttack!=null&&(this.attack=Oe.from7bitToFloat(a.rawAttack)),a.release!=null&&(this.release=a.release),a.rawRelease!=null&&(this.release=Oe.from7bitToFloat(a.rawRelease)),Number.isInteger(e)?this.identifier=Oe.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const a=Oe.getNoteDetails(e);if(_e.validation&&!e)throw new Error("Invalid note identifier");this._name=a.name,this._accidental=a.accidental,this._octave=a.octave}get name(){return this._name}set name(e){if(_e.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(_e.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(_e.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(_e.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Oe.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Oe.from7bitToFloat(e)}get rawRelease(){return Oe.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Oe.from7bitToFloat(e)}get number(){return Oe.toNoteNumber(this.identifier)}getOffsetNumber(e=0,a=0){return _e.validation&&(e=parseInt(e)||0,a=parseInt(a)||0),Math.min(Math.max(this.number+e*12+a,0),127)}}class Oe{static toNoteNumber(e,a=0){if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const s=this.getNoteDetails(e);if(!s)throw new TypeError("Invalid note identifier");const l={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let o=(s.octave+1+a)*12;if(o+=l[s.name],s.accidental&&(s.accidental.startsWith("b")?o-=s.accidental.length:o+=s.accidental.length),o<0||o>127)throw new RangeError("Invalid octaveOffset value");return o}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const a=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!a)throw new TypeError("Invalid note identifier");const s=a[1].toUpperCase(),l=parseInt(a[3]);let o=a[2].toLowerCase();return o=o===""?void 0:o,{accidental:o,identifier:s+(o||"")+l,name:s,octave:l}}static sanitizeChannels(e){let a;if(_e.validation){if(e==="all")a=["all"];else if(e==="none")return[]}return Array.isArray(e)?a=e:a=[e],a.indexOf("all")>-1&&(a=Ce.MIDI_CHANNEL_NUMBERS),a.map(function(s){return parseInt(s)}).filter(function(s){return s>=1&&s<=16})}static toTimestamp(e){let a=!1;const s=parseFloat(e);return isNaN(s)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?s>=0&&(a=_e.time+s):s>=0&&(a=s),a)}static guessNoteNumber(e,a){a=parseInt(a)||0;let s=!1;if(Number.isInteger(e)&&e>=0&&e<=127)s=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)s=parseInt(e);else if(typeof e=="string"||e instanceof String)try{s=this.toNoteNumber(e.trim(),a)}catch{return!1}return s}static toNoteIdentifier(e,a){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(a=a==null?0:parseInt(a),isNaN(a))throw new RangeError("Invalid octaveOffset value");const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=Math.floor(e/12-1)+a;return s[e%12]+l.toString()}static buildNote(e,a={}){if(a.octaveOffset=parseInt(a.octaveOffset)||0,e instanceof sl)return e;let s=this.guessNoteNumber(e,a.octaveOffset);if(s===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return a.octaveOffset=void 0,new sl(s,a)}static buildNoteArray(e,a={}){let s=[];return Array.isArray(e)||(e=[e]),e.forEach(l=>{s.push(this.buildNote(l,a))}),s}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,a=0){_e.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),a=Math.min(Math.max(parseInt(a)||0,0),127));const s=((e<<7)+a)/16383;return Math.min(Math.max(s,0),1)}static fromFloatToMsbLsb(e){_e.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const a=Math.round(e*16383);return{msb:a>>7,lsb:a&127}}static offsetNumber(e,a=0,s=0){if(_e.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");a=parseInt(a)||0,s=parseInt(s)||0}return Math.min(Math.max(e+a*12+s,0),127)}static getPropertyByValue(e,a){return Object.keys(e).find(s=>e[s]===a)}static getCcNameByNumber(e){if(!(_e.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return Ce.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let a=Ce.CONTROL_CHANGE_MESSAGES.find(s=>s.name===e);return a?a.number:Ce.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let a in Ce.CHANNEL_MODE_MESSAGES)if(Ce.CHANNEL_MODE_MESSAGES.hasOwnProperty(a)&&e===Ce.CHANNEL_MODE_MESSAGES[a])return a;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}class D1 extends yr{constructor(e,a){super(),this._output=e,this._number=a,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,a={time:0}){return this.output.send(e,a),this}sendKeyAftertouch(e,a,s={}){if(_e.validation){if(s.useRawValue&&(s.rawValue=s.useRawValue),isNaN(parseFloat(a)))throw new RangeError("Invalid key aftertouch value.");if(s.rawValue){if(!(a>=0&&a<=127&&Number.isInteger(a)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(a>=0&&a<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}s.rawValue||(a=Oe.fromFloatTo7Bit(a));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Oe.buildNoteArray(e).forEach(o=>{this.send([(Ce.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),o.getOffsetNumber(l),a],{time:Oe.toTimestamp(s.time)})}),this}sendControlChange(e,a,s={}){if(typeof e=="string"&&(e=Oe.getCcNumberByName(e)),Array.isArray(a)||(a=[a]),_e.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(a=a.map(l=>{const o=Math.min(Math.max(parseInt(l),0),127);if(isNaN(o))throw new TypeError("Values must be integers between 0 and 127");return o}),a.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return a.forEach((l,o)=>{this.send([(Ce.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+o*32,a[o]],{time:Oe.toTimestamp(s.time)})}),this}_selectNonRegisteredParameter(e,a={}){return this.sendControlChange(99,e[0],a),this.sendControlChange(98,e[1],a),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,a={}){return this.sendControlChange(101,e[0],a),this.sendControlChange(100,e[1],a),this}_setCurrentParameter(e,a={}){return e=[].concat(e),this.sendControlChange(6,e[0],a),e.length<2?this:(this.sendControlChange(38,e[1],a),this)}sendRpnDecrement(e,a={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),_e.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Ce.REGISTERED_PARAMETERS).forEach(l=>{Ce.REGISTERED_PARAMETERS[l][0]===e[0]&&Ce.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(97,0,a),this._deselectRegisteredParameter(a),this}sendRpnIncrement(e,a={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),_e.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let s=!1;if(Object.getOwnPropertyNames(Ce.REGISTERED_PARAMETERS).forEach(l=>{Ce.REGISTERED_PARAMETERS[l][0]===e[0]&&Ce.REGISTERED_PARAMETERS[l][1]===e[1]&&(s=!0)}),!s)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,a),this.sendControlChange(96,0,a),this._deselectRegisteredParameter(a),this}playNote(e,a={}){this.sendNoteOn(e,a);const s=Array.isArray(e)?e:[e];for(let l of s)if(parseInt(l.duration)>0){const o={time:(Oe.toTimestamp(a.time)||_e.time)+parseInt(l.duration),release:l.release,rawRelease:l.rawRelease};this.sendNoteOff(l,o)}else if(parseInt(a.duration)>0){const o={time:(Oe.toTimestamp(a.time)||_e.time)+parseInt(a.duration),release:a.release,rawRelease:a.rawRelease};this.sendNoteOff(l,o)}return this}sendNoteOff(e,a={}){if(_e.validation){if(a.rawRelease!=null&&!(a.rawRelease>=0&&a.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(a.release!=null&&!(a.release>=0&&a.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");a.rawVelocity&&(a.rawRelease=a.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),a.velocity&&(a.release=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawRelease!=null?s=a.rawRelease:isNaN(a.release)||(s=Math.round(a.release*127));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Oe.buildNoteArray(e,{rawRelease:parseInt(s)}).forEach(o=>{this.send([(Ce.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),o.getOffsetNumber(l),o.rawRelease],{time:Oe.toTimestamp(a.time)})}),this}stopNote(e,a={}){return this.sendNoteOff(e,a)}sendNoteOn(e,a={}){if(_e.validation){if(a.rawAttack!=null&&!(a.rawAttack>=0&&a.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(a.attack!=null&&!(a.attack>=0&&a.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");a.rawVelocity&&(a.rawAttack=a.velocity,a.rawRelease=a.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),a.velocity&&(a.attack=a.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;a.rawAttack!=null?s=a.rawAttack:isNaN(a.attack)||(s=Math.round(a.attack*127));const l=_e.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Oe.buildNoteArray(e,{rawAttack:s}).forEach(o=>{this.send([(Ce.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),o.getOffsetNumber(l),o.rawAttack],{time:Oe.toTimestamp(a.time)})}),this}sendChannelMode(e,a=0,s={}){if(typeof e=="string"&&(e=Ce.CHANNEL_MODE_MESSAGES[e]),_e.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(a))||a<0||a>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Ce.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,a],{time:Oe.toTimestamp(s.time)}),this}sendOmniMode(e,a={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,a):this.sendChannelMode("omnimodeoff",0,a),this}sendChannelAftertouch(e,a={}){if(_e.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(a.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return a.rawValue||(e=Oe.fromFloatTo7Bit(e)),this.send([(Ce.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:Oe.toTimestamp(a.time)}),this}sendMasterTuning(e,a={}){if(e=parseFloat(e)||0,_e.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let s=Math.floor(e)+64,l=e-Math.floor(e);l=Math.round((l+1)/2*16383);let o=l>>7&127,u=l&127;return this.sendRpnValue("channelcoarsetuning",s,a),this.sendRpnValue("channelfinetuning",[o,u],a),this}sendModulationRange(e,a,s={}){if(_e.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(a!=null&&(!Number.isInteger(a)||!(a>=0&&a<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return a>=0&&a<=127||(a=0),this.sendRpnValue("modulationrange",[e,a],s),this}sendNrpnValue(e,a,s={}){if(a=[].concat(a),_e.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");a.forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectNonRegisteredParameter(s),this}sendPitchBend(e,a={}){if(_e.validation)if(a.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(a.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let s=0,l=0;if(a.rawValue&&Array.isArray(e))s=e[0],l=e[1];else if(a.rawValue&&!Array.isArray(e))s=e;else{const o=Oe.fromFloatToMsbLsb((e+1)/2);s=o.msb,l=o.lsb}return this.send([(Ce.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),l,s],{time:Oe.toTimestamp(a.time)}),this}sendPitchBendRange(e,a,s={}){if(_e.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(a)||!(a>=0&&a<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,a],s),this}sendProgramChange(e,a={}){if(e=parseInt(e)||0,_e.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Ce.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Oe.toTimestamp(a.time)}),this}sendRpnValue(e,a,s={}){if(Array.isArray(e)||(e=Ce.REGISTERED_PARAMETERS[e]),_e.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(a).forEach(l=>{if(!(l>=0&&l<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,s),this._setCurrentParameter(a,s),this._deselectRegisteredParameter(s),this}sendTuningBank(e,a={}){if(_e.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,a),this}sendTuningProgram(e,a={}){if(_e.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,a),this}sendLocalControl(e,a={}){return e?this.sendChannelMode("localcontrol",127,a):this.sendChannelMode("localcontrol",0,a)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,a={}){return e==="mono"?this.sendChannelMode("monomodeon",0,a):this.sendChannelMode("polymodeon",0,a)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class Yf extends yr{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new D1(this,a);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let a={timestamp:_e.time};e.port.connection==="open"?(a.type="opened",a.target=this,a.port=a.target,this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",a.target=this,a.port=a.target,this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,a={time:0},s=0){if(e instanceof zm&&(e=Oe.isNode?e.data:e.rawData),e instanceof Uint8Array&&Oe.isNode&&(e=Array.from(e)),_e.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(a)&&(e=e.concat(a)),a=isNaN(s)?{time:0}:{time:s}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(l=>{if(l=parseInt(l),!(l>=0&&l<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),a||(a={time:0})}return this._midiOutput.send(e,Oe.toTimestamp(a.time)),this}sendSysex(e,a=[],s={}){if(e=[].concat(e),a instanceof Uint8Array){const l=new Uint8Array(1+e.length+a.length+1);l[0]=Ce.SYSTEM_MESSAGES.sysex,l.set(Uint8Array.from(e),1),l.set(a,1+e.length),l[l.length-1]=Ce.SYSTEM_MESSAGES.sysexend,this.send(l,{time:s.time})}else{const l=e.concat(a,Ce.SYSTEM_MESSAGES.sysexend);this.send([Ce.SYSTEM_MESSAGES.sysex].concat(l),{time:s.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():_e.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,a={}){if(_e.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Ce.SYSTEM_MESSAGES.timecode,e],{time:a.time}),this}sendSongPosition(e=0,a={}){e=Math.floor(e)||0;var s=e>>7&127,l=e&127;return this.send([Ce.SYSTEM_MESSAGES.songposition,s,l],{time:a.time}),this}sendSongSelect(e=0,a={}){if(_e.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Ce.SYSTEM_MESSAGES.songselect,e],{time:a.time}),this}sendTuneRequest(e={}){return this.send([Ce.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Ce.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Ce.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Ce.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Ce.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Ce.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Ce.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return _e.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,a,s={}){return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendKeyAftertouch(e,a,s)}),this}sendControlChange(e,a,s={},l={}){if(_e.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendControlChange(e,a,s)}),this}sendPitchBendRange(e=0,a=0,s={}){return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendPitchBendRange(e,a,s)}),this}setPitchBendRange(e=0,a=0,s="all",l={}){return _e.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,a,l)}sendRpnValue(e,a,s={}){return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendRpnValue(e,a,s)}),this}setRegisteredParameter(e,a=[],s="all",l={}){return _e.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,a,l)}sendChannelAftertouch(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendChannelAftertouch(e,a)}),this}sendPitchBend(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPitchBend(e,a)}),this}sendProgramChange(e=0,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendProgramChange(e,a)}),this}sendModulationRange(e,a,s={}){return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendModulationRange(e,a,s)}),this}setModulationRange(e=0,a=0,s="all",l={}){return _e.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),l.channels=s,l.channels==="all"&&(l.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,a,l)}sendMasterTuning(e,a={}){return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendMasterTuning(e,a)}),this}setMasterTuning(e,a={},s={}){return _e.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),s.channels=a,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,s)}sendTuningProgram(e,a={}){return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningProgram(e,a)}),this}setTuningProgram(e,a="all",s={}){return _e.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),s.channels=a,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,s)}sendTuningBank(e=0,a={}){return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendTuningBank(e,a)}),this}setTuningBank(e,a="all",s={}){return _e.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),s.channels=a,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,s)}sendChannelMode(e,a=0,s={},l={}){if(_e.validation&&(Array.isArray(s)||Number.isInteger(s)||s==="all")){const o=s;s=l,s.channels=o,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)}return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(o=>{this.channels[o].sendChannelMode(e,a,s)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(e.channels).forEach(a=>{this.channels[a].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},a={}){if(_e.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const s=e;e=a,e.channels=s,e.channels==="all"&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(e.channels).forEach(s=>{this.channels[s].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendPolyphonicMode(e,a)}),this}sendLocalControl(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendLocalControl(e,a)}),this}sendOmniMode(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendOmniMode(e,a)}),this}sendNrpnValue(e,a,s={}){return s.channels==null&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].sendNrpnValue(e,a,s)}),this}setNonRegisteredParameter(e,a=[],s="all",l={}){return _e.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),l.channels=s,l.channels==="all"&&(l.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,a,l)}sendRpnIncrement(e,a={}){return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnIncrement(e,a)}),this}incrementRegisteredParameter(e,a="all",s={}){return _e.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,s)}sendRpnDecrement(e,a={}){return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(s=>{this.channels[s].sendRpnDecrement(e,a)}),this}decrementRegisteredParameter(e,a="all",s={}){return _e.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),s.channels=a,s.channels==="all"&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,s)}sendNoteOff(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOff(e,a)}),this}stopNote(e,a){return this.sendNoteOff(e,a)}playNote(e,a={},s={}){if(_e.validation&&(a.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),a.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].playNote(e,a)}),this}sendNoteOn(e,a={},s={}){if(_e.validation&&(Array.isArray(a)||Number.isInteger(a)||a==="all")){const l=a;a=s,a.channels=l,a.channels==="all"&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS)}return a.channels==null&&(a.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(a.channels).forEach(l=>{this.channels[l].sendNoteOn(e,a)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class B0{constructor(e=[],a={}){this.destinations=[],this.types=[...Object.keys(Ce.SYSTEM_MESSAGES),...Object.keys(Ce.CHANNEL_MESSAGES)],this.channels=Ce.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),a.types&&!Array.isArray(a.types)&&(a.types=[a.types]),a.channels&&!Array.isArray(a.channels)&&(a.channels=[a.channels]),_e.validation&&(e.forEach(s=>{if(!(s instanceof Yf))throw new TypeError("Destinations must be of type 'Output'.")}),a.types!==void 0&&a.types.forEach(s=>{if(!Ce.SYSTEM_MESSAGES.hasOwnProperty(s)&&!Ce.CHANNEL_MESSAGES.hasOwnProperty(s))throw new TypeError("Type must be a valid message type.")}),a.channels!==void 0&&a.channels.forEach(s=>{if(!Ce.MIDI_CHANNEL_NUMBERS.includes(s))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,a.types&&(this.types=a.types),a.channels&&(this.channels=a.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(a=>{_e.validation&&!(a instanceof Yf)||a.send(e)}))}}class _1 extends yr{constructor(e,a){super(),this._input=e,this._number=a,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const a=Object.assign({},e);a.port=this.input,a.target=this,a.type="midimessage",this.emit(a.type,a),this._parseEventForStandardMessages(a)}_parseEventForStandardMessages(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmessage";const s=e.message.dataBytes[0],l=e.message.dataBytes[1];if(a.type==="noteoff"||a.type==="noteon"&&l===0)this.notesState[s]=!1,a.type="noteoff",a.note=new sl(Oe.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset),{rawAttack:0,rawRelease:l}),a.value=Oe.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.release,a.rawVelocity=a.note.rawRelease;else if(a.type==="noteon")this.notesState[s]=!0,a.note=new sl(Oe.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset),{rawAttack:l}),a.value=Oe.from7bitToFloat(l),a.rawValue=l,a.velocity=a.note.attack,a.rawVelocity=a.note.rawAttack;else if(a.type==="keyaftertouch")a.note=new sl(Oe.offsetNumber(s,this.octaveOffset+this.input.octaveOffset+_e.octaveOffset)),a.value=Oe.from7bitToFloat(l),a.rawValue=l,a.identifier=a.note.identifier,a.key=a.note.number,a.rawKey=s;else if(a.type==="controlchange"){a.controller={number:s,name:Ce.CONTROL_CHANGE_MESSAGES[s].name,description:Ce.CONTROL_CHANGE_MESSAGES[s].description,position:Ce.CONTROL_CHANGE_MESSAGES[s].position},a.subtype=a.controller.name||"controller"+s,a.value=Oe.from7bitToFloat(l),a.rawValue=l;const o=Object.assign({},a);o.type=`${a.type}-controller${s}`,delete o.subtype,this.emit(o.type,o);const u=Object.assign({},a);u.type=`${a.type}-`+Ce.CONTROL_CHANGE_MESSAGES[s].name,delete u.subtype,u.type.indexOf("controller")!==0&&this.emit(u.type,u),a.message.dataBytes[0]>=120&&this._parseChannelModeMessage(a),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(a.message.dataBytes[0])&&this._parseEventForParameterNumber(a)}else a.type==="programchange"?(a.value=s,a.rawValue=a.value):a.type==="channelaftertouch"?(a.value=Oe.from7bitToFloat(s),a.rawValue=s):a.type==="pitchbend"?(a.value=((l<<7)+s-8192)/8192,a.rawValue=(l<<7)+s):a.type="unknownmessage";this.emit(a.type,a)}_parseChannelModeMessage(e){const a=Object.assign({},e);a.type=a.controller.name,a.type==="localcontrol"&&(a.value=a.message.data[2]===127,a.rawValue=a.message.data[2]),a.type==="omnimodeon"?(a.type="omnimode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="omnimodeoff"&&(a.type="omnimode",a.value=!1,a.rawValue=a.message.data[2]),a.type==="monomodeon"?(a.type="monomode",a.value=!0,a.rawValue=a.message.data[2]):a.type==="polymodeon"&&(a.type="monomode",a.value=!1,a.rawValue=a.message.data[2]),this.emit(a.type,a)}_parseEventForParameterNumber(e){const a=e.message.dataBytes[0],s=e.message.dataBytes[1];a===99||a===101?(this._nrpnBuffer=[],this._rpnBuffer=[],a===99?this._nrpnBuffer=[e.message]:s!==127&&(this._rpnBuffer=[e.message])):a===98||a===100?a===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&s!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(a===6||a===38||a===96||a===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,a,s,l){e=e==="nrpn"?"nrpn":"rpn";const o={target:l.target,timestamp:l.timestamp,message:l.message,parameterMsb:a,parameterLsb:s,value:Oe.from7bitToFloat(l.message.dataBytes[1]),rawValue:l.message.dataBytes[1]};e==="rpn"?o.parameter=Object.keys(Ce.REGISTERED_PARAMETERS).find(p=>Ce.REGISTERED_PARAMETERS[p][0]===a&&Ce.REGISTERED_PARAMETERS[p][1]===s):o.parameter=(a<<7)+s;const u=Ce.CONTROL_CHANGE_MESSAGES[l.message.dataBytes[0]].name;o.type=`${e}-${u}`,this.emit(o.type,o);const h=Object.assign({},o);h.type==="nrpn-dataincrement"?h.type="nrpn-databuttonincrement":h.type==="nrpn-datadecrement"?h.type="nrpn-databuttondecrement":h.type==="rpn-dataincrement"?h.type="rpn-databuttonincrement":h.type==="rpn-datadecrement"&&(h.type="rpn-databuttondecrement"),this.emit(h.type,h),o.type=e,o.subtype=u,this.emit(o.type,o)}getChannelModeByNumber(e){return _e.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Oe.getChannelModeByNumber(e)}getCcNameByNumber(e){if(_e.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Oe.getCcNameByNumber(e)}getNoteState(e){e instanceof sl&&(e=e.identifier);const a=Oe.guessNoteNumber(e,_e.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[a]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class zm{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Oe.getPropertyByValue(Ce.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Oe.getPropertyByValue(Ce.SYSTEM_MESSAGES,this.command)),this.statusByte===Ce.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class O1 extends yr{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let a=1;a<=16;a++)this.channels[a]=new _1(this,a);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let a={timestamp:_e.time,target:this,port:this};e.port.connection==="open"?(a.type="opened",this.emit("opened",a)):e.port.connection==="closed"&&e.port.state==="connected"?(a.type="closed",this.emit("closed",a)):e.port.connection==="closed"&&e.port.state==="disconnected"?(a.type="disconnected",a.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",a)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const a=new zm(e.data),s={port:this,target:this,message:a,timestamp:e.timeStamp,type:"midimessage",data:a.data,rawData:a.data,statusByte:a.data[0],dataBytes:a.dataBytes};this.emit("midimessage",s),a.isSystemMessage?this._parseEvent(s):a.isChannelMessage&&this.channels[a.channel]._processMidiMessageEvent(s),this._forwarders.forEach(l=>l.forward(a))}_parseEvent(e){const a=Object.assign({},e);a.type=a.message.type||"unknownmidimessage",a.type==="songselect"&&(a.song=e.data[1]+1,a.value=e.data[1],a.rawValue=a.value),this.emit(a.type,a)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){_e.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=a!=null?[].concat(a):void 0;a=s,s={channels:l}}if(Ce.CHANNEL_EVENTS.includes(e)){s.channels===void 0&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS);let l=[];return Oe.sanitizeChannels(s.channels).forEach(o=>{l.push(this.channels[o].addListener(e,a,s))}),l}else return super.addListener(e,a,s)}addOneTimeListener(e,a,s={}){return s.remaining=1,this.addListener(e,a,s)}on(e,a,s,l){return this.addListener(e,a,s,l)}hasListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}return Ce.CHANNEL_EVENTS.includes(e)?(s.channels===void 0&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),Oe.sanitizeChannels(s.channels).every(l=>this.channels[l].hasListener(e,a))):super.hasListener(e,a)}removeListener(e,a,s={}){if(_e.validation&&typeof s=="function"){let l=[].concat(a);a=s,s={channels:l}}if(s.channels===void 0&&(s.channels=Ce.MIDI_CHANNEL_NUMBERS),e==null)return Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l]&&this.channels[l].removeListener()}),super.removeListener();Ce.CHANNEL_EVENTS.includes(e)?Oe.sanitizeChannels(s.channels).forEach(l=>{this.channels[l].removeListener(e,a,s)}):super.removeListener(e,a,s)}addForwarder(e,a={}){let s;return e instanceof B0?s=e:s=new B0(e,a),this._forwarders.push(s),s}removeForwarder(e){this._forwarders=this._forwarders.filter(a=>a!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return _e.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}class I1 extends yr{constructor(){super(),this.defaults={note:{attack:Oe.from7bitToFloat(64),release:Oe.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},a=!1){if(Oe.isNode)try{window.navigator}catch{let h=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,h)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:a}),a&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const s={timestamp:this.time,target:this,type:"error",error:void 0},l={timestamp:this.time,target:this,type:"midiaccessgranted"},o={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}this.emit("midiaccessgranted",l),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(u){return s.error=u,this.emit("error",s),typeof e.callback=="function"&&e.callback(u),Promise.reject(u)}return this.emit("enabled",o),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(this._disconnectedInputs[s]._midiInput&&this._disconnectedInputs[s].id===e.toString())return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(this.inputs[s]._midiInput&&this.inputs[s].id===e.toString())return this.inputs[s]}getInputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedInputs.length;s++)if(~this._disconnectedInputs[s].name.indexOf(e))return this._disconnectedInputs[s]}else for(let s=0;s<this.inputs.length;s++)if(~this.inputs[s].name.indexOf(e))return this.inputs[s]}getOutputByName(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(~this._disconnectedOutputs[s].name.indexOf(e))return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(~this.outputs[s].name.indexOf(e))return this.outputs[s]}getOutputById(e,a={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(a.disconnected){for(let s=0;s<this._disconnectedOutputs.length;s++)if(this._disconnectedOutputs[s]._midiOutput&&this._disconnectedOutputs[s].id===e.toString())return this._disconnectedOutputs[s]}else for(let s=0;s<this.outputs.length;s++)if(this.outputs[s]._midiOutput&&this.outputs[s].id===e.toString())return this.outputs[s]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Oe.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?Oe.getNoteDetails(Oe.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Oe.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Oe.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Oe.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,a={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Oe.buildNoteArray(e,a)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Oe.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(a=>e.push(a.destroy())),this.outputs.forEach(a=>e.push(a.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let a={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?a.port=this.getOutputById(e.port.id):e.port.type==="input"&&(a.port=this.getInputById(e.port.id)),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?a.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(a.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,a);const s=Object.assign({},a);s.type="portschanged",this.emit(s.type,s)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let a=this._inputs.length-1;a>=0;a--){const s=this._inputs[a];Array.from(this.interface.inputs.values()).find(o=>o===s._midiInput)||(this._disconnectedInputs.push(s),this._inputs.splice(a,1))}let e=[];return this.interface.inputs.forEach(a=>{if(!this._inputs.find(s=>s._midiInput===a)){let s=this._disconnectedInputs.find(l=>l._midiInput===a);s||(s=new O1(a)),this._inputs.push(s),e.push(s.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let a=this._outputs.length-1;a>=0;a--){const s=this._outputs[a];Array.from(this.interface.outputs.values()).find(o=>o===s._midiOutput)||(this._disconnectedOutputs.push(s),this._outputs.splice(a,1))}let e=[];return this.interface.outputs.forEach(a=>{if(!this._outputs.find(s=>s._midiOutput===a)){let s=this._disconnectedOutputs.find(l=>l._midiOutput===a);s||(s=new Yf(a)),this._outputs.push(s),e.push(s.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Oe.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Oe.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Ce.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Ce.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Ce.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Ce.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Ce.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const _e=new I1;_e.constructor=null;const L1=async()=>{if(_e.enabled)return _e;try{return await _e.enable({sysex:!0}),console.log("WebMidi is enabled with SysEx support!"),_e}catch(n){throw console.error("WebMidi could not be enabled.",n),n}},F0=()=>_e.enabled?_e.inputs.map(n=>({id:n.id,name:n.name})):[],U1=(n,e)=>{if(_e.enabled){const a=_e.getInputById(n);if(a){const s=u=>{e({type:"noteon",note:u.note.identifier,velocity:u.velocity,controller:null,channel:u.message.channel})},l=u=>{e({type:"noteoff",note:u.note.identifier,velocity:0,controller:null,channel:u.message.channel})},o=u=>{e({type:"controlchange",controller:u.controller.number,value:u.rawValue,note:null,channel:u.message.channel})};return a.addListener("noteon",s),a.addListener("noteoff",l),a.addListener("controlchange",o),()=>{a.removeListener("noteon",s),a.removeListener("noteoff",l),a.removeListener("controlchange",o)}}}return()=>{}},j1=n=>{if(_e.enabled){const e=a=>{n(a)};return _e.addListener("connected",e),_e.addListener("disconnected",e),()=>{_e.removeListener("connected",e),_e.removeListener("disconnected",e)}}return()=>{}},B1=(n,e)=>{if(_e.enabled){const a=_e.getInputById(n);if(a){const s=_e.outputs.find(l=>l.name===a.name);s?(s.sendSysex(71,e),console.log(`Sent SysEx to ${s.name}`)):console.warn("Could not find matching MIDI Output for SysEx")}}},Ac=(n,e,a,s)=>{if(_e.enabled){const l=_e.getInputById(n);if(l){const o=_e.outputs.find(u=>u.name===l.name);o&&o.sendNoteOn(e,{attack:a/127,channels:s})}}},Gm=N.createContext(null),Ic=()=>N.useContext(Gm),F1=({children:n,onMidiCommand:e})=>{const[a,s]=N.useState(!1),[l,o]=N.useState([]),[u,h]=N.useState(""),[p,g]=N.useState(!1),[b,C]=N.useState(null),[w,x]=N.useState({}),[M,R]=N.useState(null),[I,H]=N.useState(!1),B=N.useRef(!1),D=N.useRef(e);N.useEffect(()=>{D.current=e},[e]),N.useEffect(()=>{(async()=>{try{if(await L1(),s(!0),o(F0()),j1(()=>{console.log("MIDI Device change detected, refreshing inputs..."),o(F0())}),window.electronAPI&&window.electronAPI.getMidiMappings){const V=await window.electronAPI.getMidiMappings();V&&(console.log("Loaded saved MIDI mappings:",V),x(V))}}catch(V){console.error("MIDI Init Failed:",V)}})()},[]),N.useEffect(()=>{(async()=>{if(!a||l.length===0)return;let V=u;if(!V&&window.electronAPI?.getSelectedMidiInput){const te=await window.electronAPI.getSelectedMidiInput();te&&l.some(ce=>ce.id===te)&&(V=te)}(!V||!l.some(te=>te.id===V))&&(V=l[0].id),V!==u&&(console.log(`MIDI: Auto-selecting input: ${V}`),h(V))})()},[a,l,u]);const j=async()=>{window.electronAPI&&window.electronAPI.saveMidiMappings&&(await window.electronAPI.saveMidiMappings(w),console.log("MIDI mappings saved to default."))},_=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(w,"midi")},G=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const ee=await window.electronAPI.importMappings("midi");ee.success&&ee.mappings&&(x(ee.mappings),console.log("MIDI mappings imported."))}},Y=ee=>{const V=l.find(te=>te.id===ee);V&&V.name.toLowerCase().includes("apc40")&&(console.log("Detected APC40, sending initialization SysEx..."),B1(ee,[127,41,96,0,4,65,1,1,1]))};N.useEffect(()=>{u&&window.electronAPI&&window.electronAPI.saveSelectedMidiInput&&window.electronAPI.saveSelectedMidiInput(u),u&&a&&Y(u)},[u,a,l]);const J=N.useCallback((ee,V,te=null)=>{if(!u||!a)return;const ce=w[ee];if(ce&&ce.type==="note"){let xe=0;typeof V=="number"?xe=V:xe=V?127:0;const $=te!==null?te:ce.channel;Ac(u,ce.address,xe,$)}},[u,a,w]);N.useEffect(()=>{let ee=()=>{};return u&&(console.log(`(Re)binding MIDI listener for: ${u}`),ee=U1(u,V=>{ae.current&&R(V),re(V)})),ee},[u,p,b,w,l]);const ae=N.useRef(p);N.useEffect(()=>{ae.current=p},[p]);const re=ee=>{if(ee.channel===1&&ee.note==="D7"){const te=ee.type==="noteon";H(te),B.current=te,console.log(`Shift ${te?"Down":"Up"}`);return}if(p&&b){if(ee.type==="noteoff")return;const te=ee.note||ee.controller,ce=B.current,xe={type:ee.type==="noteon"||ee.type==="noteoff"?"note":"cc",channel:ee.channel,address:te,requiresShift:ce,label:`${ce?"":""}CH${ee.channel}:${te}`};console.log(`Mapped ${b} to:`,xe),x($=>({...$,[b]:xe})),C(null);return}Object.entries(w).forEach(([te,ce])=>{const xe=(ee.type==="noteon"||ee.type==="noteoff")&&ce.type==="note"&&ee.note===ce.address&&ee.channel===ce.channel,$=ee.type==="controlchange"&&ce.type==="cc"&&ee.controller===ce.address&&ee.channel===ce.channel,Q=ce.type==="cc"||!!ce.requiresShift===B.current;if((xe||$)&&Q&&D.current){let ve;ee.type==="controlchange"?ve=ee.value??0:ee.type==="noteoff"?ve=0:ve=ee.velocity??0,D.current(te,ve,127,ee.type)}})},Z={midiInitialized:a,midiInputs:l,selectedMidiInputId:u,setSelectedMidiInputId:h,isMapping:p,startMapping:()=>g(!0),stopMapping:()=>{g(!1),C(null)},learningId:b,setLearningId:C,mappings:w,setMappings:x,removeMapping:ee=>{x(V=>{const te={...V};return delete te[ee],te})},saveMappings:j,exportMappings:_,importMappings:G,initializeApc40:Y,sendFeedback:J,lastMidiEvent:M,isShiftDown:I};return f.jsx(Gm.Provider,{value:Z,children:n})},Hm=N.createContext(null),sd=()=>N.useContext(Hm),P1=({children:n,onArtnetCommand:e})=>{const[a,s]=N.useState(!1),[l,o]=N.useState(!1),[u,h]=N.useState(null),[p,g]=N.useState({}),[b,C]=N.useState(null),w=N.useRef(e);N.useEffect(()=>{w.current=e},[e]),N.useEffect(()=>{(async()=>{try{if(window.electronAPI&&window.electronAPI.initializeArtnet&&(await window.electronAPI.initializeArtnet()).success&&(s(!0),console.log("Art-Net initialized for mapping")),window.electronAPI&&window.electronAPI.getArtnetMappings){const G=await window.electronAPI.getArtnetMappings();G&&(console.log("Loaded saved Art-Net mappings:",G),g(G))}}catch(G){console.error("Art-Net Init Failed:",G)}})()},[]);const x=async()=>{window.electronAPI&&window.electronAPI.saveArtnetMappings&&(await window.electronAPI.saveArtnetMappings(p),console.log("Art-Net mappings saved."))},M=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(p,"artnet")},R=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const _=await window.electronAPI.importMappings("artnet");_.success&&_.mappings&&(g(_.mappings),console.log("Art-Net mappings imported."))}};N.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onArtnetDataReceived)return window.electronAPI.onArtnetDataReceived(G=>{I.current&&C(G),H(G)})},[l,u,p]);const I=N.useRef(l);N.useEffect(()=>{I.current=l},[l]);const H=_=>{const{universe:G,channel:Y,value:J}=_;if(l&&u){if(J===0)return;const ae={universe:G,channel:Y,label:`U${G}:CH${Y+1}`};console.log(`Mapped ${u} to Art-Net:`,ae),g(re=>({...re,[u]:ae})),h(null);return}Object.entries(p).forEach(([ae,re])=>{re.universe===G&&re.channel===Y&&w.current&&w.current(ae,J)})},j={artnetInitialized:a,isMapping:l,startMapping:()=>o(!0),stopMapping:()=>{o(!1),h(null)},learningId:u,setLearningId:h,mappings:p,setMappings:g,saveMappings:x,exportMappings:M,importMappings:R,lastDmxEvent:b};return f.jsx(Hm.Provider,{value:j,children:n})},Ym=N.createContext(null),id=()=>N.useContext(Ym),z1=({children:n,onCommand:e,enabled:a=!1})=>{const[s,l]=N.useState(!1),[o,u]=N.useState(null),[h,p]=N.useState({}),g=N.useRef(e);N.useEffect(()=>{g.current=e},[e]),N.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getKeyboardMappings){const R=await window.electronAPI.getKeyboardMappings();R&&p(R)}})()},[]);const b=async()=>{window.electronAPI&&window.electronAPI.saveKeyboardMappings&&await window.electronAPI.saveKeyboardMappings(h)},C=async()=>{window.electronAPI&&window.electronAPI.exportMappings&&await window.electronAPI.exportMappings(h,"keyboard")},w=async()=>{if(window.electronAPI&&window.electronAPI.importMappings){const M=await window.electronAPI.importMappings("keyboard");M.success&&M.mappings&&p(M.mappings)}};N.useEffect(()=>{const M=R=>{if(a&&!(R.target.tagName==="INPUT"||R.target.tagName==="TEXTAREA"||R.target.isContentEditable)){if(s&&o){R.preventDefault();const I={key:R.code,label:R.code.replace("Key","").replace("Digit","")};p(H=>({...H,[o]:I})),u(null);return}Object.entries(h).forEach(([I,H])=>{R.code===H.key&&(R.preventDefault(),g.current&&g.current(I,1,1,"keydown"))})}};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[a,s,o,h]);const x={isMapping:s,startMapping:()=>l(!0),stopMapping:()=>{l(!1),u(null)},learningId:o,setLearningId:u,mappings:h,setMappings:p,saveMappings:b,exportMappings:C,importMappings:w,removeMapping:M=>p(R=>{const I={...R};return delete I[M],I})};return f.jsx(Ym.Provider,{value:x,children:n})},$t=({id:n,children:e})=>{const{isMapping:a,setLearningId:s,removeMapping:l}=Ic(),{isMapping:o,setLearningId:u,removeMapping:h}=sd()||{},{isMapping:p,setLearningId:g,removeMapping:b}=id()||{},C=a||o||p,w=R=>{C&&(R.preventDefault(),R.stopPropagation(),a&&s(n),o&&u(n),p&&g(n))},x=R=>{C&&(R.preventDefault(),R.stopPropagation(),a&&l(n),o&&h(n),p&&b(n))},M=Yn.Children.only(e);return Yn.cloneElement(M,{"data-mappable-id":n,onClickCapture:C?w:M.props.onClickCapture,onContextMenu:C?x:M.props.onContextMenu,className:`${M.props.className||""} ${C?"mappable-target":""}`.trim()})},G1=({masterIntensity:n,onMasterIntensityChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_intensity",targetType:"global",label:"MASTER",min:0,max:1,step:.01}))};return f.jsx("div",{className:"master-intensity-slider",draggable:!0,onDragStart:a,children:f.jsx($t,{id:"master_intensity",children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n,className:"slider_hor",id:"masterIntensityRange",onChange:s=>e(parseFloat(s.target.value))})})})},H1=({masterIntensity:n,onMasterIntensityChange:e,onClearAllActive:a,isGlobalBlackout:s,onToggleGlobalBlackout:l})=>{const o=(u,h)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"global",label:h.toUpperCase()}))};return f.jsxs("div",{className:"composition-controls",children:[f.jsx("span",{className:"layer-control-button",children:"Comp"}),f.jsx($t,{id:"comp_clear",children:f.jsx("span",{className:"layer-control-button",onClick:a,style:{cursor:"pointer"},draggable:!0,onDragStart:u=>o(u,"clear"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsx($t,{id:"comp_blackout",style:{width:"100%",display:"flex"},children:f.jsx("span",{className:"layer-control-button",onClick:l,style:{cursor:"pointer",backgroundColor:s?"red":""},draggable:!0,onDragStart:u=>o(u,"blackout"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx(G1,{masterIntensity:n,onMasterIntensityChange:e})]})},Y1=({name:n,index:e,onTrigger:a,onShowColumnHeaderContextMenu:s})=>{const l=u=>{u.preventDefault(),s&&s(e)},o=u=>{u.button===0&&a&&a()};return f.jsx($t,{id:`column_${e}`,children:f.jsx("div",{className:"column-header trigger-button",onClick:o,onContextMenu:l,style:{cursor:"pointer"},children:n})})},ll=[{id:"rotate",name:"Rotate",type:"transform",description:"Rotates the shape around its center.",defaultParams:{angle:0,speed:0,direction:"CW"},paramControls:[{id:"angle",label:"Angle",type:"range",min:0,max:360,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["CW","CCW"]}]},{id:"scale",name:"Scale",type:"transform",description:"Scales the shape.",defaultParams:{scaleX:1,scaleY:1},paramControls:[{id:"scaleX",label:"Scale X",type:"range",min:.01,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"range",min:.01,max:5,step:.01}]},{id:"translate",name:"Translate",type:"transform",description:"Moves the shape.",defaultParams:{translateX:0,translateY:0},paramControls:[{id:"translateX",label:"Translate X",type:"range",min:-1,max:1,step:.01},{id:"translateY",label:"Translate Y",type:"range",min:-1,max:1,step:.01}]},{id:"color",name:"Color",type:"color",description:"Changes the color of the shape with solid, rainbow or custom palette modes.",defaultParams:{mode:"solid",color:"#ffffff",r:255,g:255,b:255,cycleSpeed:0,rainbowSpread:1,rainbowOffset:0,rainbowPalette:"rainbow",paletteColors:["#ff0000","#00ff00","#0000ff","#ffff00"],paletteSize:4,paletteSpread:1,hue:0,saturation:0,brightness:1,enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["solid","rainbow","palette"]},{id:"color",label:"Color",type:"color",showIf:{mode:"solid"}},{id:"hue",label:"Hue",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"saturation",label:"Saturation",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"brightness",label:"Brightness",type:"range",min:0,max:1,step:.001,showIf:{mode:"hsv_advanced"}},{id:"paletteSize",label:"Palette Size",type:"range",min:2,max:16,step:1,showIf:{mode:"palette"}},{id:"paletteSpread",label:"Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"palette"}},{id:"cycleSpeed",label:"Cycle Speed",type:"range",min:0,max:10,step:.1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowSpread",label:"Rainbow Spread",type:"range",min:.1,max:10,step:.1,showIf:{mode:"rainbow"}},{id:"rainbowOffset",label:"Offset",type:"range",min:0,max:360,step:1,showIf:{mode:["rainbow","palette"]}},{id:"rainbowPalette",label:"Preset",type:"select",options:["rainbow","fire","ice","cyber"],showIf:{mode:"rainbow"}}]},{id:"wave",name:"Wave",type:"animation",description:"Applies a wave distortion to the shape.",defaultParams:{amplitude:.1,frequency:10,speed:1,direction:"x"},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:.01,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1},{id:"direction",label:"Direction",type:"select",options:["x","y"]}]},{id:"warp",name:"Warp",type:"animation",description:"Symmetrical chaotic wave distortion.",defaultParams:{amount:.1,chaos:.5,speed:1},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"chaos",label:"Chaos",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:10,step:.1}]},{id:"distortion",name:"Distortion",type:"transform",description:"Distorts the point data.",defaultParams:{amount:.1,scale:10,speed:.5},paramControls:[{id:"amount",label:"Amount",type:"range",min:0,max:1,step:.01},{id:"scale",label:"Scale",type:"range",min:1,max:50,step:1},{id:"speed",label:"Speed",type:"range",min:0,max:5,step:.1}]},{id:"move",name:"Move (Bounce)",type:"transform",description:"Moves points and bounces them off the borders.",defaultParams:{speedX:.1,speedY:.1},paramControls:[{id:"speedX",label:"Speed X",type:"range",min:0,max:2,step:.01},{id:"speedY",label:"Speed Y",type:"range",min:0,max:2,step:.01}]},{id:"delay",name:"Delay",type:"effect",description:"Frame or Channel based delay effect.",defaultParams:{mode:"segment",playstyle:"repeat",useCustomOrder:!1,delayDirection:"left_to_right",delayAmount:5,decay:.8,steps:10,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","frame","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat"]},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"delayDirection",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}},{id:"steps",label:"Steps",type:"range",min:2,max:20,step:1,showIf:{mode:["segment","frame"]}},{id:"delayAmount",label:"Delay Time",type:"range",min:1,max:60,step:1},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01}]},{id:"chase",name:"Chase",type:"effect",description:"Frame or Channel based chase effect.",defaultParams:{mode:"segment",playstyle:"repeat",steps:4,decay:.8,speed:1,overlap:1,direction:"left_to_right",useCustomOrder:!1,customOrder:[],enabled:!0},paramControls:[{id:"mode",label:"Mode",type:"select",options:["segment","channel"]},{id:"playstyle",label:"Playstyle",type:"select",options:["once","repeat","bounce"]},{id:"steps",label:"Steps",type:"range",min:2,max:16,step:1,showIf:{mode:"segment"}},{id:"decay",label:"Decay",type:"range",min:0,max:1,step:.01},{id:"speed",label:"Speed",type:"range",min:.1,max:5,step:.1},{id:"overlap",label:"Overlap",type:"range",min:1,max:4,step:1},{id:"useCustomOrder",label:"Custom Order",type:"checkbox",showIf:{mode:"channel"}},{id:"direction",label:"Direction",type:"select",options:["center_to_out","out_to_center","left_to_right","right_to_left"],showIf:{useCustomOrder:!1}}]},{id:"blanking",name:"Blanking",type:"animation",description:"Controls the blanking of the laser output.",defaultParams:{blankingInterval:0,spacing:0},paramControls:[{id:"blankingInterval",label:"Blanking Interval",type:"range",min:0,max:10,step:1},{id:"spacing",label:"Spacing",type:"range",min:0,max:20,step:1}]},{id:"strobe",name:"Strobe",type:"animation",description:"Applies a strobe effect to the laser output.",defaultParams:{strobeSpeed:100,strobeAmount:.5},paramControls:[{id:"strobeSpeed",label:"Strobe Speed (ms)",type:"range",min:10,max:1e3,step:10},{id:"strobeAmount",label:"Strobe Amount (0-1)",type:"range",min:0,max:1,step:.01}]},{id:"mirror",name:"Mirror",type:"transform",description:"Mirrors the shape from the center.",defaultParams:{mode:"none",additive:!0,axisOffset:0,planeRotation:0},paramControls:[{id:"mode",label:"Mirror Mode",type:"select",options:["none","x+","x-","y+","y-"]},{id:"additive",label:"Additive",type:"checkbox"},{id:"axisOffset",label:"Axis Offset",type:"range",min:-1,max:1,step:.01},{id:"planeRotation",label:"Plane Rotation",type:"range",min:0,max:360,step:1}]}],q1=ll.reduce((n,e)=>(n[e.id]=e,n),{});function P0(n,e,a,s){const l=e.style||"loop",o=e.direction||"forward";if(o==="pause")return a;let u=n;l==="bounce"&&(u*=2);let h=0;if(l==="once")h=Math.min(u,1),o==="backward"&&(h=1-h);else if(l==="bounce"){let p=u%1;Math.floor(u)%2===1?h=1-p:h=p,o==="backward"&&(h=1-h)}else h=u%1,o==="backward"&&(h=1-h);return s&&Array.isArray(s)&&s.length===2?s[0]+(s[1]-s[0])*h:a}function Mc(n,e,a,s,l,o){if(!a)return e;const u=typeof a=="string"?{syncMode:a}:a;if(!u.syncMode)return e;const{time:h,progress:p=0,bpm:g=120,clipDuration:b=0,fftLevels:C={low:0,mid:0,high:0},activationTime:w=0}=s;let x=u.range;(!x||!Array.isArray(x)||x.length!==2)&&l!==void 0&&o!==void 0&&(x=[l,o]);let M=0;const R=u.speedMultiplier||1;if((u.style||"loop")==="once"&&w>0){const H=(h-w)*.001;let B=1;if(u.syncMode==="timeline")B=Math.max(.01,u.duration||1);else if(u.syncMode==="bpm"){const D=Math.max(.1,u.beats||4),j=g/60;B=D/(j||2)}else if(u.syncMode==="fps")return M=H*R,P0(M,u,e,x);M=H/B*R}else if(u.syncMode==="fps")M=h*.001*R;else if(u.syncMode==="timeline"){const H=Math.max(.01,u.duration||1);b>0?M=p*b/H*R:M=0}else if(u.syncMode==="bpm"){const H=Math.max(.1,u.beats||4),B=g/60,D=H/(B||2);b>0?M=p*b/D*R:M=0}else if(u.syncMode==="fft"){const H=C[u.fftRange||"low"]||0;return x?x[0]+(x[1]-x[0])*H:e}return P0(M,u,e,x)}let qf=new Float32Array(1024*8);function V1(n){qf.length<n*8&&(qf=new Float32Array(n*8*2))}function lo(n,e,a={}){const{progress:s=0,time:l=performance.now(),effectStates:o,syncSettings:u={},fftLevels:h}=a;if(!e||e.length===0)return n;const p=n.points,g=n.isTypedArray||p instanceof Float32Array,b=g?p.length/8:p.length;V1(b);const C=qf.subarray(0,b*8);if(g)C.set(p);else for(let M=0;M<b;M++){const R=p[M],I=M*8;C[I]=R.x,C[I+1]=R.y,C[I+2]=R.z||0,C[I+3]=R.r,C[I+4]=R.g,C[I+5]=R.b,C[I+6]=R.blanking?1:0,C[I+7]=R.lastPoint?1:0}let w=C;for(const M of e){const R=M.params;if(R.enabled===!1||!q1[M.id])continue;const H=w.length/8;let B=R;const D=M.instanceId?`${M.instanceId}.`:`${M.id}.`;let j=!1;for(const _ in R)if(u[D+_]){j=!0;break}if(j){B={...R};for(const _ in B){const G=D+_;u[G]&&(B[_]=Mc(_,B[_],u[G],a))}}switch(M.id){case"rotate":X1(w,H,B,s,l);break;case"scale":$1(w,H,B);break;case"translate":W1(w,H,B);break;case"color":Q1(w,H,B,l);break;case"wave":J1(w,H,B,l);break;case"blanking":ev(w,H,B);break;case"strobe":tv(w,H,B,l);break;case"mirror":w=nv(w,H,B);break;case"warp":av(w,H,B,l);break;case"distortion":rv(w,H,B,l);break;case"move":sv(w,H,B,l);break;case"delay":o&&M.instanceId&&(w=iv(w,H,B,o,M.instanceId,a));break;case"chase":w=lv(w,H,B,l,a);break}}const x=new Float32Array(w);return w._channelDistributions&&(x._channelDistributions=w._channelDistributions),{...n,points:x,isTypedArray:!0}}function X1(n,e,a,s,l){const{angle:o,speed:u,direction:h}=a,p=h==="CCW"?-1:1,g=l*.001*u*p,b=o*Math.PI/180+g,C=Math.sin(b),w=Math.cos(b);for(let x=0;x<e;x++){const M=x*8,R=n[M],I=n[M+1];n[M]=R*w-I*C,n[M+1]=R*C+I*w}}function $1(n,e,a){const{scaleX:s,scaleY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]*=s,n[u+1]*=l}}function W1(n,e,a){const{translateX:s,translateY:l}=a;for(let o=0;o<e;o++){const u=o*8;n[u]+=s,n[u+1]+=l}}function z0(n){if(!n)return{r:255,g:255,b:255};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function Z1(n,e,a){let s,l,o;const u=Math.floor(n*6),h=n*6-u,p=a*(1-e),g=a*(1-h*e),b=a*(1-(1-h)*e);switch(u%6){case 0:s=a,l=b,o=p;break;case 1:s=g,l=a,o=p;break;case 2:s=p,l=a,o=b;break;case 3:s=p,l=g,o=a;break;case 4:s=b,l=p,o=a;break;case 5:s=a,l=p,o=g;break}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function Q1(n,e,a,s){const{mode:l,r:o,g:u,b:h,color:p,hue:g,saturation:b,brightness:C,cycleSpeed:w,rainbowSpread:x,rainbowOffset:M,rainbowPalette:R,paletteColors:I=[],paletteSize:H=4,paletteSpread:B=1}=a,D=s*.001*w;if(l==="palette"){const j=Math.min(I.length,H),_=I.slice(0,j).map(z0);_.length===0&&_.push({r:255,g:255,b:255});for(let G=0;G<e;G++){const Y=G*8,ae=(G/e*B+D*.5+M/360)%1*_.length,re=Math.floor(ae)%_.length,O=(re+1)%_.length,W=ae-Math.floor(ae),K=_[re],Z=_[O];n[Y+3]=Math.round(K.r+(Z.r-K.r)*W),n[Y+4]=Math.round(K.g+(Z.g-K.g)*W),n[Y+5]=Math.round(K.b+(Z.b-K.b)*W)}}else if(l==="rainbow"){const j=R||"rainbow";for(let _=0;_<e;_++){const G=_*8,Y=(_/e*x+D*.5+M/360)%1;let J,ae,re;j==="rainbow"?[J,ae,re]=G0(Y,1,.5):[J,ae,re]=K1(j,Y),n[G+3]=J,n[G+4]=ae,n[G+5]=re}}else{let j=o,_=u,G=h;if(g!==void 0&&b!==void 0&&C!==void 0)[j,_,G]=Z1(g,b,C);else if(p){const Y=z0(p);j=Y.r,_=Y.g,G=Y.b}if(w>0){const Y=D*50%360,[J,ae,re]=G0(Y/360,1,.5);for(let O=0;O<e;O++){const W=O*8;n[W+3]=J,n[W+4]=ae,n[W+5]=re}}else for(let Y=0;Y<e;Y++){const J=Y*8;n[J+3]=j,n[J+4]=_,n[J+5]=G}}}function K1(n,e){const a={fire:[{r:255,g:0,b:0},{r:255,g:128,b:0},{r:255,g:255,b:0},{r:255,g:0,b:0}],ice:[{r:0,g:0,b:255},{r:0,g:255,b:255},{r:255,g:255,b:255},{r:0,g:0,b:255}],cyber:[{r:255,g:0,b:255},{r:0,g:255,b:255},{r:0,g:0,b:255},{r:255,g:0,b:255}]},s=a[n]||a.fire,l=e*(s.length-1),o=Math.floor(l),u=l-o,h=s[o],p=s[o+1]||s[o];return[Math.round(h.r+(p.r-h.r)*u),Math.round(h.g+(p.g-h.g)*u),Math.round(h.b+(p.b-h.b)*u)]}function G0(n,e,a){let s,l,o;{const u=(g,b,C)=>(C<0&&(C+=1),C>1&&(C-=1),C<.16666666666666666?g+(b-g)*6*C:C<.5?b:C<.6666666666666666?g+(b-g)*(.6666666666666666-C)*6:g),h=a+e-a*e,p=2*a-h;s=u(p,h,n+1/3),l=u(p,h,n),o=u(p,h,n-1/3)}return[Math.round(s*255),Math.round(l*255),Math.round(o*255)]}function J1(n,e,a,s){const{amplitude:l,frequency:o,speed:u,direction:h}=a,p=s*.001*u;for(let g=0;g<e;g++){const b=g*8;h==="x"?n[b+1]+=l*Math.sin(n[b]*o+p):h==="y"&&(n[b]+=l*Math.sin(n[b+1]*o+p))}}function ev(n,e,a){const{blankingInterval:s,spacing:l=0}=a;if(s<=0)return;const o=s+1+l;for(let u=0;u<e;u++)u%o>=s&&(n[u*8+6]=1)}function tv(n,e,a,s){const{strobeSpeed:l,strobeAmount:o}=a;if(s%l/l<o)for(let h=0;h<e;h++)n[h*8+6]=1}function nv(n,e,a){const{mode:s,additive:l=!0,axisOffset:o=0,planeRotation:u=0}=a;if(s==="none"||e===0)return n;const h=u*Math.PI/180,p=Math.cos(h),g=Math.sin(h),b={x:0,y:0},C=(R,I)=>{let H=R,B=I;if(h!==0){const D=R*p+I*g,j=-R*g+I*p;H=D,B=j}if(s==="x-"||s==="x+"?H=2*o-H:(s==="y-"||s==="y+")&&(B=2*o-B),h!==0){const D=H*p-B*g,j=H*g+B*p;H=D,B=j}b.x=H,b.y=B},w=(R,I)=>{if(l)return!0;let H=R,B=I;return h!==0&&(H=R*p+I*g,B=-R*g+I*p),s==="x+"?H>=o:s==="x-"?H<=o:s==="y+"?B>=o:s==="y-"?B<=o:!0};let x;const M=n._channelDistributions;if(M){x=new Float32Array((e*2+M.size*2+50)*8);const R=new Map;let I=0;for(const[B,D]of M){const j=D.length/8,_=D.start,G=I;let Y=0,J=!0;for(let ae=0;ae<j;ae++){const re=_+ae*8,O=w(n[re],n[re+1]);O&&(!J&&Y>0&&(x.set(n.subarray(re,re+8),I),x[I+6]=1,x[I+3]=0,x[I+4]=0,x[I+5]=0,I+=8,Y++),x.set(n.subarray(re,re+8),I),I+=8,Y++),J=O}if(Y>0){const ae=I-8;x.set(x.subarray(ae,ae+8),I),x[I+6]=1,x[I+3]=0,x[I+4]=0,x[I+5]=0,I+=8;let re=!0,O=0;for(let W=j-1;W>=0;W--){const K=_+W*8,Z=w(n[K],n[K+1]);if(Z){!re&&O>0&&(x.set(n.subarray(K,K+8),I),C(x[I],x[I+1]),x[I]=b.x,x[I+1]=b.y,x[I+6]=1,x[I+3]=0,x[I+4]=0,x[I+5]=0,I+=8),x.set(n.subarray(K,K+8),I);const ee=I;C(x[ee],x[ee+1]),x[ee]=b.x,x[ee+1]=b.y,W===j-1?(x[ee+6]=1,x[ee+3]=0,x[ee+4]=0,x[ee+5]=0):x[ee+6]=n[K+8+6],I+=8,O++}re=Z}R.set(B,{start:G,length:I-G})}}const H=new Float32Array(I);return H.set(x.subarray(0,I)),H._channelDistributions=R,H}else{x=new Float32Array((e*2+50)*8);let R=0,I=0,H=!0;for(let B=0;B<e;B++){const D=B*8,j=w(n[D],n[D+1]);j&&(!H&&I>0&&(x.set(n.subarray(D,D+8),R),x[R+6]=1,x[R+3]=0,x[R+4]=0,x[R+5]=0,R+=8,I++),x.set(n.subarray(D,D+8),R),R+=8,I++),H=j}if(I>0){const B=R-8;x.set(x.subarray(B,B+8),R),x[R+6]=1,x[R+3]=0,x[R+4]=0,x[R+5]=0,R+=8;let D=!0,j=0;for(let _=e-1;_>=0;_--){const G=_*8,Y=w(n[G],n[G+1]);if(Y){!D&&j>0&&(x.set(n.subarray(G,G+8),R),C(x[R],x[R+1]),x[R]=b.x,x[R+1]=b.y,x[R+6]=1,x[R+3]=0,x[R+4]=0,x[R+5]=0,R+=8),x.set(n.subarray(G,G+8),R);const J=R;C(x[J],x[J+1]),x[J]=b.x,x[J+1]=b.y,_===e-1?(x[J+6]=1,x[J+3]=0,x[J+4]=0,x[J+5]=0):x[J+6]=n[G+8+6],R+=8,j++}D=Y}}return x.slice(0,R)}}function av(n,e,a,s){const{amount:l,chaos:o,speed:u}=a,h=s*.001*u;for(let p=0;p<e;p++){const g=p*8,b=n[g],C=n[g+1],w=Math.abs(C);n[g]+=Math.sin(w*10*(1+o)+h)*l*Math.cos(h*o),n[g+1]+=Math.cos(Math.abs(b)*10*(1+o)+h)*l*Math.sin(h*o)}}function rv(n,e,a,s){const{amount:l,scale:o,speed:u}=a,h=s*.001*u;for(let p=0;p<e;p++){const g=p*8,b=Math.sin(n[g]*o+h)*Math.cos(n[g+1]*o-h),C=Math.cos(n[g]*o-h)*Math.sin(n[g+1]*o+h);n[g]+=b*l,n[g+1]+=C*l}}function sv(n,e,a,s){const{speedX:l,speedY:o}=a,u=s*.001,h=u*l,p=u*o,g=4;for(let b=0;b<e;b++){const C=b*8;let w=n[C]+h,x=n[C+1]+p,M=(w+1)%g;M<0&&(M+=g),M>2&&(M=4-M),w=M-1;let R=(x+1)%g;R<0&&(R+=g),R>2&&(R=4-R),x=R-1,n[C]=w,n[C+1]=x}}function iv(n,e,a,s,l,o){const{mode:u="segment",delayAmount:h,decay:p,delayDirection:g,useCustomOrder:b,customOrder:C,playstyle:w="repeat",steps:x=10}=a;s.has(l)||s.set(l,[]);const M=s.get(l);if(M.unshift(new Float32Array(n)),u==="segment"){const R=h*x+1;M.length>R&&(M.length=R);const I=new Float32Array(n.length);for(let H=0;H<e;H++){let B=0;const D=H/e;g==="left_to_right"?B=Math.floor(D*x):g==="right_to_left"?B=Math.floor((1-D)*x):g==="center_to_out"?B=Math.floor(Math.abs(D-.5)*2*x):g==="out_to_center"&&(B=Math.floor((1-Math.abs(D-.5)*2)*x)),B=Math.min(x-1,Math.max(0,B));const j=B*h,_=j<M.length?M[j]:null,G=Math.pow(p,B),Y=H*8;if(_&&_.length>0){let J;if(_.length===n.length)J=Y;else{const re=_.length/8;let O=Math.floor(D*re);O>=re&&(O=re-1),J=O*8}I[Y]=_[J],I[Y+1]=_[J+1],I[Y+2]=_[J+2],I[Y+3]=_[J+3]*G,I[Y+4]=_[J+4]*G,I[Y+5]=_[J+5]*G;const ae=n[Y+6]>.5;if(I[Y+6]=ae?1:_[J+6],I[Y+6]>.5&&(I[Y+3]=0,I[Y+4]=0,I[Y+5]=0),I[Y+7]=_[J+7],H>0){const re=(H-1)/e;let O=0;if(g==="left_to_right"?O=Math.floor(re*x):g==="right_to_left"?O=Math.floor((1-re)*x):g==="center_to_out"?O=Math.floor(Math.abs(re-.5)*2*x):g==="out_to_center"&&(O=Math.floor((1-Math.abs(re-.5)*2)*x)),O=Math.min(x-1,Math.max(0,O)),O!==B){I[Y+6]=1,I[Y+3]=0,I[Y+4]=0,I[Y+5]=0;const W=(H-1)*8;I[W+6]=1,I[W+3]=0,I[W+4]=0,I[W+5]=0}}}else I.set(n.subarray(Y,Y+8),Y),I[Y+3]=0,I[Y+4]=0,I[Y+5]=0,I[Y+6]=1}return n._channelDistributions&&(I._channelDistributions=n._channelDistributions),I}else if(u==="frame"){const R=x,I=h*R+1;M.length>I&&(M.length=I);const H=[];for(let _=0;_<R;_++){const G=_*h,Y=G<M.length?M[G]:null;H.push({points:Y,factor:Math.pow(p,_)})}let B=0;for(let _=0;_<H.length;_++){const G=H[_].points||n;B+=G.length/8,_<H.length-1&&(B+=1)}const D=new Float32Array(B*8);let j=0;for(let _=0;_<H.length;_++){const G=H[_],Y=G.points||n,J=G.factor,ae=Y.length/8;for(let re=0;re<ae;re++){const O=re*8,W=j+re*8;D[W]=Y[O],D[W+1]=Y[O+1],D[W+2]=Y[O+2],D[W+3]=Y[O+3]*J,D[W+4]=Y[O+4]*J,D[W+5]=Y[O+5]*J,D[W+6]=Y[O+6],D[W+7]=Y[O+7]}if(j+=ae*8,_<H.length-1){const re=(ae-1)*8,O=j;D[O]=Y[re],D[O+1]=Y[re+1],D[O+2]=Y[re+2],D[O+3]=0,D[O+4]=0,D[O+5]=0,D[O+6]=1,D[O+7]=0,j+=8}}return n._channelDistributions&&(D._channelDistributions=n._channelDistributions),D}else{const{assignedDacs:R}=o||{};let I=new Map,H=0;if(b||a.delayMode==="channel")(C&&C.length>0?C.map(W=>W.originalIndex):R?R.map((W,K)=>K):[0]).forEach((W,K)=>{I.set(W,K),H=Math.max(H,K)});else{const W=(R||[]).length||1;for(let K=0;K<W;K++){let Z=K;g==="right_to_left"?Z=W-1-K:g==="center_to_out"?Z=Math.floor(Math.abs(K-(W-1)/2)):g==="out_to_center"&&(Z=Math.min(K,W-1-K)),I.set(K,Z),H=Math.max(H,Z)}}const D=H+1,j=h*D+1;M.length>j&&(M.length=j);const _=[];for(let O=0;O<D;O++){const W=O*h;_.push({points:W<M.length?M[W]:null,factor:Math.pow(p,O),index:O})}const G=_.reduce((O,W)=>O+(W.points?W.points.length/8:n.length/8),0),Y=new Float32Array(G*8);let J=0;const ae=new Array(_.length);for(let O=0;O<_.length;O++){const W=_[O],K=W.points,Z=K?K.length/8:n.length/8;ae[O]=J;for(let ee=0;ee<Z;ee++){const V=ee*8,te=J+ee*8;K?(Y[te]=K[V],Y[te+1]=K[V+1],Y[te+2]=K[V+2],Y[te+3]=K[V+3]*W.factor,Y[te+4]=K[V+4]*W.factor,Y[te+5]=K[V+5]*W.factor,Y[te+6]=K[V+6],Y[te+7]=K[V+7]):Y[te+6]=1}J+=Z*8}const re=new Map;return I.forEach((O,W)=>{O<_.length&&re.set(W,{start:ae[O],length:_[O].points?_[O].points.length:n.length})}),Y._channelDistributions=re,Y}}function lv(n,e,a,s,l={}){const{mode:o="segment",steps:u,decay:h,speed:p,overlap:g,direction:b,useCustomOrder:C,customOrder:w,playstyle:x="loop"}=a,{progress:M=0,clipDuration:R=1,syncSettings:I={}}=l,H=a.instanceId?`${a.instanceId}.`:"chase.",B=!!I[H+"speed"],D=M!==void 0&&R>0||B;if(o==="segment"){const j=u;let _=(D?M*j:s*.001)*p;if(x==="bounce"){const Y=j,J=_%(Y*2);_=J>Y?Y*2-J:J}else x==="once"?_=Math.min(_,j):_=_%j;const G=new Float32Array(n.length);for(let Y=0;Y<e;Y++){const J=Y/e;let ae=0;b==="left_to_right"?ae=Math.min(j-1,Math.floor(J*j)):b==="right_to_left"?ae=Math.min(j-1,Math.floor((1-J)*j)):b==="center_to_out"?ae=Math.min(j-1,Math.floor(Math.abs(J-.5)*2*j)):b==="out_to_center"&&(ae=Math.min(j-1,Math.floor((1-Math.abs(J-.5)*2)*j)));let re=Math.abs(_-ae);re>j/2&&(re=j-re);let O=re<g?1-re/g:0;h>0&&(O=Math.pow(O,1-h));const W=Y*8;if(G.set(n.subarray(W,W+8),W),G[W+3]*=O,G[W+4]*=O,G[W+5]*=O,(O<.05||n[W+6]>.5)&&(G[W+6]=1,G[W+3]=0,G[W+4]=0,G[W+5]=0),Y>0){const K=(Y-1)/e;let Z=0;if(b==="left_to_right"?Z=Math.min(j-1,Math.floor(K*j)):b==="right_to_left"?Z=Math.min(j-1,Math.floor((1-K)*j)):b==="center_to_out"?Z=Math.min(j-1,Math.floor(Math.abs(K-.5)*2*j)):b==="out_to_center"&&(Z=Math.min(j-1,Math.floor((1-Math.abs(K-.5)*2)*j))),Z!==ae){G[W+6]=1,G[W+3]=0,G[W+4]=0,G[W+5]=0;const ee=(Y-1)*8;G[ee+6]=1,G[ee+3]=0,G[ee+4]=0,G[ee+5]=0}}}return n._channelDistributions&&(G._channelDistributions=n._channelDistributions),G}else{const{assignedDacs:j}=l||{};let _=new Map,G=0;if(C)(w&&w.length>0?w.map(ee=>ee.originalIndex):j?j.map((ee,V)=>V):[0]).forEach((ee,V)=>{_.set(ee,V),G++});else{G=(j?j.length:1)||1;for(let Z=0;Z<G;Z++){let ee=Z;b==="right_to_left"?ee=G-1-Z:b==="center_to_out"?ee=Math.floor(Math.abs(Z-(G-1)/2)):b==="out_to_center"&&(ee=Math.min(Z,G-1-Z)),_.set(Z,ee)}}const Y=G;let J=(D?M*Y:s*.001)*p;if(x==="bounce"){const Z=Y,ee=J%(Z*2);J=ee>Z?Z*2-ee:ee}else x==="once"?J=Math.min(J,Y):J=J%Y;const ae=e*G,re=new Float32Array(ae*8),O=new Map;let W=0;const K=Array.from(_.keys());K.length===0&&K.push(0);for(const Z of K){const ee=_.get(Z)||0;let V=Math.abs(J-ee);V>Y/2&&(V=Y-V);let te=V<g?1-V/g:0;h>0&&(te=Math.pow(te,1-h));const ce=W;for(let xe=0;xe<e;xe++){const $=xe*8,Q=W+xe*8;re.set(n.subarray($,$+8),Q),re[Q+3]*=te,re[Q+4]*=te,re[Q+5]*=te,te<.05&&(re[Q+6]=1)}O.set(Z,{start:ce,length:e*8}),W+=e*8}return re._channelDistributions=O,re}}function Vf(n,e,a=!1){if(!e||!n||!n.points)return n;const{safetyZones:s,outputArea:l,transformationEnabled:o,transformationMode:u,flipX:h,flipY:p}=e;let g=n.points;const b=n.isTypedArray||g instanceof Float32Array,C=b?g.length/8:g.length;let w=a?g:b?new Float32Array(g):g.map(x=>({...x}));for(let x=0;x<C;x++){let M,R,I,H,B,D;if(b?(M=w[x*8],R=w[x*8+1],I=w[x*8+3],H=w[x*8+4],B=w[x*8+5],D=w[x*8+6]):(M=w[x].x,R=w[x].y,I=w[x].r,H=w[x].g,B=w[x].b,D=w[x].blanking?1:0),o&&l){let j=(M+1)/2,_=(1-R)/2;u==="crop"?(j<l.x||j>l.x+l.w||_<l.y||_>l.y+l.h)&&(I=0,H=0,B=0,D=1):u==="scale"&&(j=l.x+j*l.w,_=l.y+_*l.h,M=j*2-1,R=1-_*2)}if(s&&s.length>0){let j=(M+1)/2,_=(1-R)/2;for(const G of s)if(j>=G.x&&j<=G.x+G.w&&_>=G.y&&_<=G.y+G.h){I=0,H=0,B=0,D=1;break}}h&&(M=-M),p&&(R=-R),M=Math.max(-1,Math.min(1,M)),R=Math.max(-1,Math.min(1,R)),b?(w[x*8]=M,w[x*8+1]=R,w[x*8+3]=I,w[x*8+4]=H,w[x*8+5]=B,w[x*8+6]=D):(w[x].x=M,w[x].y=R,w[x].r=I,w[x].g=H,w[x].b=B,w[x].blanking=D>.5)}return{...n,points:w,isTypedArray:b}}const H0=.08,Y0=4;function ld(n){if(!n)return new Float32Array(0);const e=n instanceof Float32Array||n.isTypedArray,a=e?n.length/8:n.length;if(a>4e3){if(n instanceof Float32Array)return n;const p=new Float32Array(a*8);for(let g=0;g<a;g++){const b=n[g];p[g*8]=b.x,p[g*8+1]=b.y,p[g*8+2]=b.z||0,p[g*8+3]=b.r,p[g*8+4]=b.g,p[g*8+5]=b.b,p[g*8+6]=b.blanking?1:0,p[g*8+7]=b.lastPoint?1:0}return p}const s=[],l=(p,g,b,C,w,x,M)=>{const R=M?0:C,I=M?0:w,H=M?0:x;s.push(p,g,b,R,I,H,M?1:0,0)},o=p=>{if(e){const g=p*8;return{x:n[g],y:n[g+1],z:n[g+2],r:n[g+3],g:n[g+4],b:n[g+5],blanking:n[g+6]>.5}}else{const g=n[p];return{x:g.x||0,y:g.y||0,z:g.z||0,r:g.r||0,g:g.g||0,b:g.b||0,blanking:!!g.blanking}}};if(a===0)return new Float32Array(0);let u=o(0);for(let p=0;p<a;p++){const g=o(p);if(u.blanking!==g.blanking)if(g.blanking)for(let x=0;x<Y0;x++)l(u.x,u.y,u.z,0,0,0,!0);else{l(g.x,g.y,g.z,0,0,0,!0);for(let x=0;x<Y0;x++)l(g.x,g.y,g.z,0,0,0,!0)}const b=g.x-u.x,C=g.y-u.y,w=Math.sqrt(b*b+C*C);if(w>H0){const x=Math.floor(w/H0);for(let M=1;M<x;M++){const R=M/x;l(u.x+b*R,u.y+C*R,u.z+(g.z-u.z)*R,g.blanking?0:g.r,g.blanking?0:g.g,g.blanking?0:g.b,g.blanking)}}l(g.x,g.y,g.z,g.r,g.g,g.b,g.blanking),u=g}const h=new Float32Array(s);return n._channelDistributions&&(h._channelDistributions=n._channelDistributions),h}class ov{constructor(e,a){if(this.canvas=e,this.type=a,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.animationFrameId=null,this.frameIndexes=Array(10).fill(0),this.pointIndexes=Array(10).fill(0),this.showBeamEffect=!1,this.beamAlpha=.5,this.fadeAlpha=.13,this.beamRenderMode="both",this.positionBuffer=null,this.colorBuffer=null,this.alphaBuffer=null,this.alphaBufferData=new Float32Array(131072),this.lastPointDrawTime=0,!this.gl){console.error("WebGL not supported");return}this.setup()}setup(){const e=this.gl,a=`
      attribute vec2 aPosition;
      attribute vec3 aColor;
      attribute float aAlpha;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        gl_PointSize = 2.0;
        vColor = aColor;
        vAlpha = aAlpha;
      }
    `,s=`
      precision mediump float;
      varying vec3 vColor;
      varying float vAlpha;
      void main() {
        gl_FragColor = vec4(vColor, vAlpha);
      }
    `,l=this.createShader(e.VERTEX_SHADER,a),o=this.createShader(e.FRAGMENT_SHADER,s),u=this.createProgram(l,o);this.program=u,this.positionAttributeLocation=e.getAttribLocation(u,"aPosition"),this.colorAttributeLocation=e.getAttribLocation(u,"aColor"),this.alphaAttributeLocation=e.getAttribLocation(u,"aAlpha"),this.quadPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer);const h=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];e.bufferData(e.ARRAY_BUFFER,new Float32Array(h),e.STATIC_DRAW),this.quadColorUniformLocation=e.getUniformLocation(u,"uColor"),this.quadAlphaUniformLocation=e.getUniformLocation(u,"uAlpha");const p=`
      attribute vec2 aPosition;
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `,g=`
      precision mediump float;
      uniform vec4 uColor;
      void main() {
        gl_FragColor = uColor;
      }
    `,b=this.createShader(e.VERTEX_SHADER,p),C=this.createShader(e.FRAGMENT_SHADER,g);this.fadeProgram=this.createProgram(b,C),this.fadePositionAttributeLocation=e.getAttribLocation(this.fadeProgram,"aPosition"),this.fadeColorUniformLocation=e.getUniformLocation(this.fadeProgram,"uColor"),e.useProgram(u);const w=131072;this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,w*2*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,w*3*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),this.alphaBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.alphaBuffer),e.bufferData(e.ARRAY_BUFFER,w*1*Float32Array.BYTES_PER_ELEMENT,e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,1)}reset(){this.frameIndexes.fill(0),this.pointIndexes.fill(0),this.clearCanvas()}createShader(e,a){const s=this.gl,l=s.createShader(e);if(s.shaderSource(l,a),s.compileShader(l),s.getShaderParameter(l,s.COMPILE_STATUS))return l;console.error(s.getShaderInfoLog(l)),s.deleteShader(l)}createProgram(e,a){const s=this.gl,l=s.createProgram();if(s.attachShader(l,e),s.attachShader(l,a),s.linkProgram(l),s.getProgramParameter(l,s.LINK_STATUS))return l;console.error(s.getProgramInfoLog(l)),s.deleteProgram(l)}render(e){e.showBeamEffect!==void 0&&this.setBeamEffect(e.showBeamEffect),e.beamAlpha!==void 0&&this.setBeamAlpha(e.beamAlpha),e.fadeAlpha!==void 0&&this.setFadeAlpha(e.fadeAlpha),e.beamRenderMode!==void 0&&(this.beamRenderMode=e.beamRenderMode),this.type==="world"?this.renderWorld(e.worldData,e.previewScanRate,e.layerIntensities,e.masterIntensity,e.dacSettings,e.previewTime,e.fftLevels,e.optimizationEnabled):this.renderSingle(e.ildaFrames,e.previewScanRate,e.intensity,e.effects,e.syncSettings,e.bpm,e.clipDuration,e.progress,e.previewTime,e.fftLevels,e.effectStates,e.optimizationEnabled)}renderSingle(e,a,s,l,o={},u=120,h=1,p=null,g=null,b={low:0,mid:0,high:0},C=null,w=!0){const x=this.gl;if(x.viewport(0,0,x.canvas.width,x.canvas.height),this.drawFadeQuad(),!e||e.length===0)return;const M=this.frameIndexes[0]%e.length,R=e[M],I=p!==null?p:M/e.length,H=g!==null?g:performance.now();this.draw(R,l,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,s,0,I,H,o,u,h,b,C,w),this.frameIndexes[0]++,this.frameIndexes[0]>=e.length&&(this.frameIndexes[0]=0)}renderWorld(e,a,s,l,o,u=null,h={low:0,mid:0,high:0},p=!0){const g=this.gl;g.viewport(0,0,g.canvas.width,g.canvas.height),this.drawFadeQuad();const b=u!==null?u:performance.now();e.forEach(C=>{if(C&&C.frames&&C.frames.length>0){const w=C.frames[0];if(w){const x=C.layerIndex||0;if(C.syncSettings,C.bpm,x>=this.frameIndexes.length){const I=x+5;for(;this.frameIndexes.length<I;)this.frameIndexes.push(0),this.pointIndexes.push(0)}const R=(s[x]!==void 0?s[x]:1)*l;if(R>.001){const I=C.progress!==void 0?C.progress:this.frameIndexes[x]%C.frames.length/C.frames.length,{syncSettings:H={},bpm:B=120,clipDuration:D=1,effectStates:j=null}=C;let _=w;if(o){let G=w;if(o.dimmer!==void 0&&o.dimmer<1){const Y=w.points,J=w.isTypedArray||Y instanceof Float32Array,ae=J?Y.length/8:Y.length,re=J?new Float32Array(Y):Y.map(O=>({...O}));for(let O=0;O<ae;O++)J?(re[O*8+3]*=o.dimmer,re[O*8+4]*=o.dimmer,re[O*8+5]*=o.dimmer):(re[O].r*=o.dimmer,re[O].g*=o.dimmer,re[O].b*=o.dimmer);G={...w,points:re,isTypedArray:J}}_=Vf(G,o)}this.draw(_,C.effects,this.showBeamEffect,this.beamAlpha,a,this.beamRenderMode,R,x,I,b,H,B,D,h,j,p)}}}}),e.forEach(C=>{if(C&&C.frames){const w=C.layerIndex||0;this.frameIndexes[w]++,this.frameIndexes[w]>=C.frames.length&&(this.frameIndexes[w]=0)}})}drawFadeQuad(){const e=this.gl;this.fadeProgram&&(e.useProgram(this.fadeProgram),e.bindBuffer(e.ARRAY_BUFFER,this.quadPositionBuffer),e.enableVertexAttribArray(this.fadePositionAttributeLocation),e.vertexAttribPointer(this.fadePositionAttributeLocation,2,e.FLOAT,!1,0,0),e.uniform4f(this.fadeColorUniformLocation,0,0,0,this.fadeAlpha),e.drawArrays(e.TRIANGLES,0,6))}setBeamEffect(e){this.showBeamEffect=e}setBeamAlpha(e){this.beamAlpha=e}setFadeAlpha(e){this.fadeAlpha=e}draw(e,a,s,l,o,u,h=1,p=0,g=0,b=performance.now(),C={},w=120,x=1,M={low:0,mid:0,high:0},R=null,I=!0){if(this.gl,!e||!e.points)return;let H=e;if(I){const W=ld(e.points);H={...e,points:W,isTypedArray:!0}}const B=lo(H,a,{progress:g,time:b,syncSettings:C,bpm:w,clipDuration:x,fftLevels:M,effectStates:R}),D=B.points,j=B.isTypedArray,_=j?D.length/8:D.length;if(_===0)return;const G=Math.max(1,Math.floor(_/o));let Y=this.pointIndexes[p]||0;Y>=_&&(Y=0);const J=W=>{const K=(Y+W)%_;if(j){const Z=K*8;return{x:D[Z],y:D[Z+1],r:D[Z+3],g:D[Z+4],b:D[Z+5],blanking:D[Z+6]===1}}else{const Z=D[K];return{x:Z.x,y:Z.y,r:Z.r,g:Z.g,b:Z.b,blanking:Z.blanking}}},ae=()=>{const W=u==="points"||u==="both";if(u==="lines"||u==="both"){let Z=[],ee=[],V=J(0);for(let te=1;te<G;te++){const ce=J(te),xe=(Y+te)%_,$=(Y+te-1)%_,Q=xe<$;ce.blanking||Q?Z.length>0&&(this._drawSegment(new Float32Array(Z),new Float32Array(ee),1,Z.length/2,!1),Z=[],ee=[]):(Z.length===0&&(Z.push(V.x,V.y),ee.push(ce.r/255*h,ce.g/255*h,ce.b/255*h)),Z.push(ce.x,ce.y),ee.push(ce.r/255*h,ce.g/255*h,ce.b/255*h)),V=ce}Z.length>0&&this._drawSegment(new Float32Array(Z),new Float32Array(ee),1,Z.length/2,!1)}if(W){const Z=[],ee=[];for(let V=0;V<G;V++){const te=J(V);te.blanking||(Z.push(te.x,te.y),ee.push(te.r/255*h,te.g/255*h,te.b/255*h))}Z.length>0&&this._drawSegment(new Float32Array(Z),new Float32Array(ee),1,Z.length/2,!0)}},re=()=>{const W=[],K=[];for(let Z=0;Z<G;Z++){const ee=J(Z);if(!ee.blanking){W.push(0,0,ee.x,ee.y);const V=[ee.r/255*h,ee.g/255*h,ee.b/255*h];K.push(...V,...V)}}W.length>0&&this._drawLines(new Float32Array(W),new Float32Array(K),l,W.length/2)},O=()=>{const W=[],K=[];let Z=J(0);for(let ee=1;ee<G;ee++){const V=J(ee);if((Y+ee)%_<(Y+ee-1)%_){Z=V;continue}if(!V.blanking){W.push(0,0,Z.x,Z.y,V.x,V.y);const ce=[V.r/255*h,V.g/255*h,V.b/255*h],xe=[V.r/255*h,V.g/255*h,V.b/255*h],$=[ce[0],ce[1],ce[2]],Q=.3,ve=[ce[0]*Q,ce[1]*Q,ce[2]*Q],Re=[xe[0]*Q,xe[1]*Q,xe[2]*Q];K.push(...$,...ve,...Re)}Z=V}W.length>0&&this._drawTriangles(new Float32Array(W),new Float32Array(K),l,W.length/2)};ae(),s&&(u==="points"?re():u==="lines"?O():u==="both"&&(O(),re())),this.pointIndexes[p]=(Y+G)%_}_drawSegment(e,a,s,l,o=!1){const u=this.gl;u.useProgram(this.program),u.bindBuffer(u.ARRAY_BUFFER,this.positionBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,e),u.enableVertexAttribArray(this.positionAttributeLocation),u.vertexAttribPointer(this.positionAttributeLocation,2,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,this.colorBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,a),u.enableVertexAttribArray(this.colorAttributeLocation),u.vertexAttribPointer(this.colorAttributeLocation,3,u.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const h=this.alphaBufferData.subarray(0,l);u.bindBuffer(u.ARRAY_BUFFER,this.alphaBuffer),u.bufferSubData(u.ARRAY_BUFFER,0,h),u.enableVertexAttribArray(this.alphaAttributeLocation),u.vertexAttribPointer(this.alphaAttributeLocation,1,u.FLOAT,!1,0,0),u.drawArrays(o?u.POINTS:u.LINE_STRIP,0,l)}_drawLines(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.LINES,0,l)}_drawTriangles(e,a,s,l){const o=this.gl;o.useProgram(this.program),o.bindBuffer(o.ARRAY_BUFFER,this.positionBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,e),o.enableVertexAttribArray(this.positionAttributeLocation),o.vertexAttribPointer(this.positionAttributeLocation,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,a),o.enableVertexAttribArray(this.colorAttributeLocation),o.vertexAttribPointer(this.colorAttributeLocation,3,o.FLOAT,!1,0,0),this.alphaBufferData.length<l&&(this.alphaBufferData=new Float32Array(l*2)),this.alphaBufferData.fill(s,0,l);const u=this.alphaBufferData.subarray(0,l);o.bindBuffer(o.ARRAY_BUFFER,this.alphaBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,u),o.enableVertexAttribArray(this.alphaAttributeLocation),o.vertexAttribPointer(this.alphaAttributeLocation,1,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,l)}clearCanvas(){const e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}destroy(){if(cancelAnimationFrame(this.animationFrameId),this.gl){const e=this.gl.getExtension("WEBGL_losing_context");e&&e.loseContext()}}}const qm=({frame:n,effects:e,width:a=100,height:s=100})=>{const l=N.useRef(null),o=N.useRef(null),[u,h]=N.useState(null);return N.useEffect(()=>(l.current&&!o.current&&(o.current=new ov(l.current,"single")),()=>{o.current&&(o.current.destroy(),o.current=null)}),[]),N.useEffect(()=>{if(!n){h(null);return}let p=n;if(e&&e.length>0){const g=n.points,b=n.isTypedArray||g instanceof Float32Array;let C;b?C=new Float32Array(g):C=g.map(x=>({...x}));const w={...n,points:C,isTypedArray:b};p=lo(w,e,{time:performance.now(),progress:0,effectStates:new Map})}h(p)},[n,e]),N.useEffect(()=>{o.current&&u?o.current.render({ildaFrames:[u],previewScanRate:1,intensity:1,effects:[],syncSettings:{}}):o.current&&o.current.clearCanvas()},[u]),f.jsx("div",{className:"clip-thumbnail",style:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"black"},children:f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"100%",height:"100%",backgroundColor:"black"}})})},cv=({frame:n,bitmap:e,width:a=50,height:s=50})=>{const l=N.useRef(null);return N.useEffect(()=>{const o=l.current;if(!o)return;const u=o.getContext("2d");if(e){u.clearRect(0,0,a,s),u.drawImage(e,0,0,a,s);return}if(!n||!n.points)return;u.fillStyle="#000000",u.fillRect(0,0,a,s);const h=n.points,p=n.isTypedArray||h instanceof Float32Array,g=p?h.length/8:h.length;u.lineWidth=1.5,u.lineCap="round";let b=null,C=null;for(let w=0;w<g;w++){let x,M,R,I,H,B;if(p)x=h[w*8],M=h[w*8+1],R=h[w*8+3],I=h[w*8+4],H=h[w*8+5],B=h[w*8+6]>.5;else{const _=h[w];x=_.x,M=_.y,R=_.r,I=_.g,H=_.b,B=_.blanking}const D=(x+1)*.5*a,j=(1-(M+1)*.5)*s;if(B){b=null,C=null;continue}else if(b!==null){u.beginPath(),u.moveTo(b,C),u.lineTo(D,j);const _=Math.floor(Math.max(0,Math.min(255,R))),G=Math.floor(Math.max(0,Math.min(255,I))),Y=Math.floor(Math.max(0,Math.min(255,H)));u.strokeStyle=`rgb(${_},${G},${Y})`,u.stroke()}b=D,C=j}},[n,a,s]),f.jsx("canvas",{ref:l,width:a,height:s,style:{width:"50px",height:"50px",backgroundColor:"black",display:"block",borderRadius:"5px"}})},od=Yn.memo(cv),uv=({layerName:n,index:e,onDropEffect:a,onDropDac:s,layerEffects:l,activeClipData:o,onDeactivateLayerClips:u,onShowLayerFullContextMenu:h,thumbnailRenderMode:p,intensity:g,onIntensityChange:b,liveFrame:C,isBlackout:w,isSolo:x,onToggleBlackout:M,onToggleSolo:R,onLayerSelect:I})=>{const[H,B]=N.useState(l||[]),[D,j]=N.useState(!1),[_,G]=N.useState(!1);N.useEffect(()=>{B(l||[])},[l]);const Y=N.useMemo(()=>[...o?.effects||[],...l||[]],[o?.effects,l]),J=(Z,ee,V,te,ce)=>{Z.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:ee,paramName:V,targetType:te,layerIndex:e,label:ce}))},ae=Z=>{Z.preventDefault(),console.log(`Right-clicked LayerControls at index: ${e}`),h&&h(e)},re=Z=>{Z.preventDefault(),Z.stopPropagation(),j(!0),Z.dataTransfer.dropEffect="copy"},O=Z=>{Z.preventDefault(),Z.stopPropagation(),j(!1)},W=Z=>{Z.preventDefault(),Z.stopPropagation(),j(!1);const ee=Z.dataTransfer.getData("application/json");if(ee)try{const te=JSON.parse(ee);if(te.type==="transform"||te.type==="animation"||te.type==="color"||te.type==="effect"){if(a){a(te.id||te.name);return}}else if(te.ip&&(typeof te.channel=="number"||te.allChannels)&&s){s(e,te);return}}catch(te){console.error("Error parsing drop data in LayerControls:",te)}const V=Z.dataTransfer.getData("text/plain");if(V.startsWith("effect_")){const te=V.replace("effect_","");a&&a(te)}},K=p==="active"||p==="hover"&&_;return f.jsxs("div",{className:`layer-controls ${D?"dragging":""}`,onContextMenu:ae,onDragOver:re,onDragLeave:O,onDrop:W,children:[f.jsxs("div",{className:"grid-layer",children:[f.jsx($t,{id:`layer_${e}_clear`,children:f.jsx("span",{className:"layer-control-button full-height",onClick:()=>u(e),draggable:!0,onDragStart:Z=>J(Z,"toggle","clear","layer",`L${e+1} Clear`),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-lg",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})})})}),f.jsxs("div",{className:"layer-control-group",children:[f.jsx($t,{id:`layer_${e}_blackout`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:M,style:{backgroundColor:w?"red":""},draggable:!0,onDragStart:Z=>J(Z,"toggle","blackout","layer",`L${e+1} Blackout`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye-slash-fill",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx($t,{id:`layer_${e}_solo`,children:f.jsx("span",{className:"layer-control-button half-height",onClick:R,style:{backgroundColor:x?"var(--theme-color)":"",color:x?"black":""},draggable:!0,onDragStart:Z=>J(Z,"toggle","solo","layer",`L${e+1} Solo`),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-1-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M9.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z"}),f.jsx("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"})]})})})]}),f.jsxs("select",{className:"layer-blend-dropdown",children:[f.jsx("option",{children:"Normal"}),f.jsx("option",{children:"Add"}),f.jsx("option",{children:"Subtract"})]})]}),f.jsx("div",{className:"layer-control-row",children:f.jsx($t,{id:`layer_${e}_intensity`,children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,className:"slider_ver",id:"layer-intensity-slider",onChange:Z=>b(parseFloat(Z.target.value))})})}),f.jsx("div",{className:"layer-preview-thumbnail",onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),style:{overflow:"hidden"},children:o?K?f.jsx(qm,{frame:C||o.stillFrame,effects:Y}):o.thumbnailPath?f.jsx("img",{src:`file://${o.thumbnailPath}?t=${o.thumbnailVersion||Date.now()}`,alt:"layer-thumbnail",style:{width:"100%",height:"100%",objectFit:"contain"}}):f.jsx(od,{frame:o.stillFrame}):H.length>0&&f.jsx("div",{className:"applied-effects",children:H.map((Z,ee)=>f.jsx("span",{className:"effect-tag",children:(Z.name||Z.id||"???").substring(0,3).toUpperCase()},Z.instanceId||ee))})}),f.jsx("span",{className:"layer-name-label",onClick:()=>I&&I(e),children:n})]})},fv=({clipName:n,layerIndex:e,colIndex:a,onDropGenerator:s,onDropEffect:l,clipContent:o,thumbnailFrameIndex:u,onUnsupportedFile:h,onActivateClick:p,onLabelClick:g,isSelected:b,isActive:C,ildaParserWorker:w,onDropDac:x,thumbnailRenderMode:M,liveFrame:R,stillFrame:I,onClipHover:H,onThumbnailError:B})=>{const[D,j]=N.useState(!1),[_,G]=N.useState(!1),Y=n,J=M==="active"||M==="hover"&&D,ae=ce=>{ce.preventDefault(),ce.stopPropagation(),G(!0),ce.dataTransfer.dropEffect="copy"},re=ce=>{ce.preventDefault(),ce.stopPropagation(),ce.currentTarget.contains(ce.relatedTarget)||G(!1)},O=()=>{j(!0),H&&H(e,a,!0)},W=()=>{j(!1),p(!1),H&&H(e,a,!1)},K=async ce=>{const xe=ce.name;if(!w){h("ILDA parser not available.");return}if(xe.toLowerCase().endsWith(".ild"))try{const $=await ce.arrayBuffer();console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFileDrop): ${$.byteLength}`),w.postMessage({type:"parse-ilda",arrayBuffer:$,fileName:xe,filePath:ce.path,layerIndex:e,colIndex:a},[$])}catch($){console.error("[Clip.jsx] handleFileDrop - Error reading file:",$),h(`Error reading file: ${$.message}`)}else h("Please drop a valid .ild file")},Z=async(ce,xe)=>{if(!xe.toLowerCase().endsWith(".ild")){console.log("Unsupported file type:",xe),h("Please drop a valid .ild file");return}if(!w){h("ILDA parser not available.");return}try{if(window.electronAPI&&window.electronAPI.readFileAsBinary){const $=await window.electronAPI.readFileAsBinary(ce);if(!$||!($ instanceof ArrayBuffer)){console.error("[Clip.jsx] readFileAsBinary did not return an ArrayBuffer:",$),h("Error reading file: Invalid data format received.");return}console.log(`[Clip.jsx] ArrayBuffer byteLength before posting to worker (handleFilePathDrop): ${$.byteLength}`),w.postMessage({type:"parse-ilda",arrayBuffer:$,fileName:xe,filePath:ce,layerIndex:e,colIndex:a},[$])}else h("Binary file access not available")}catch($){console.error("Error processing file path:",$),console.error("Error stack:",$.stack),h(`Error processing file: ${$.message}`)}},ee=ce=>{ce.preventDefault(),ce.stopPropagation(),G(!1);const xe=ce.dataTransfer.getData("application/json");if(xe)try{const Q=JSON.parse(xe);if(Q.filePath&&Q.fileName){Z(Q.filePath,Q.fileName);return}if(Q.type==="transform"||Q.type==="animation"||Q.type==="color"||Q.type==="effect"){if(l){l(Q),g();return}}else if(Q.ip&&(typeof Q.channel=="number"||Q.allChannels)){if(x){x(e,a,Q);return}}else if(Q.name&&s){s(e,a,Q);return}}catch(Q){console.error("Error parsing dropped data:",Q)}const $=ce.dataTransfer.files;if($&&$.length>0){K($[0]);return}console.log("No recognized data format found in drop"),h("No valid ILD file, effect, or generator dropped.")},V=ce=>{ce.preventDefault(),ce.stopPropagation()},te=ce=>{ce.preventDefault(),window.electronAPI&&window.electronAPI.showClipContextMenu&&window.electronAPI.showClipContextMenu(e,a,o?.triggerStyle||"normal")};return f.jsxs("div",{className:`clip ${_?"dragging":""} ${C?"active-clip":""} `,onDragEnter:V,onDragOver:ae,onDragLeave:re,onDrop:ee,onContextMenu:te,children:[f.jsx($t,{id:`clip_${e}_${a}`,children:f.jsx("div",{className:"clip-thumbnail",onMouseDown:ce=>{ce.button===0&&p(!0)},onMouseUp:ce=>{ce.button===0&&p(!1)},onMouseEnter:O,onMouseLeave:W,style:{overflow:"hidden"},children:o&&o.parsing?f.jsx("div",{className:"clip-loading-spinner"}):f.jsxs(f.Fragment,{children:[J&&o?f.jsx(qm,{frame:R||I,effects:o?.effects}):o?.thumbnailPath?f.jsx("img",{src:`file://${o.thumbnailPath}?t=${o.thumbnailVersion||Date.now()}`,alt:"thumbnail",onError:()=>B&&B(e,a),style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none"}}):I&&f.jsx(od,{frame:I}),o?.triggerStyle&&o.triggerStyle!=="normal"&&f.jsxs("p",{className:"clip_icons",children:[o.triggerStyle==="toggle"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-toggles",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M4.5 9a3.5 3.5 0 1 0 0 7h7a3.5 3.5 0 1 0 0-7zm7 6a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m-7-14a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5m2.45 0A3.5 3.5 0 0 1 8 3.5 3.5 3.5 0 0 1 6.95 6h4.55a2.5 2.5 0 0 0 0-5zM4.5 0h7a3.5 3.5 0 1 1 0 7h-7a3.5 3.5 0 1 1 0-7"})}),o.triggerStyle==="flash"&&f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-lightning-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641z"})})]})]})})}),f.jsx($t,{id:`clip_${e}_${a}_preview`,children:f.jsx("span",{className:`clip-label ${b?"selected-clip":""}`,onClick:g,children:Y})})]})},dv=Yn.memo(fv),Vm=N.createContext(null),Xm=()=>N.useContext(Vm),pv=({children:n})=>{const[e,a]=N.useState(null);return N.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(Vm.Provider,{value:e,children:n})},hv=({onDropIld:n,viewMode:e="list",onViewModeChange:a,path:s,onPathChange:l})=>{const[o,u]=N.useState([]),[h,p]=N.useState({}),[g,b]=N.useState(new Set),C=Xm(),w=N.useRef(new Set),x=N.useRef([]),M=N.useRef(!1),R=s,I=l,H=N.useCallback(()=>{if(M.current||x.current.length===0||!C)return;M.current=!0;const D=x.current.shift(),j=D.split(/[/\\]/).pop();C.postMessage({type:"load-and-parse-ilda",fileName:j,filePath:D,browserFile:!0,stopAtFirstFrame:!0})},[C]);N.useEffect(()=>{if(!C)return;const D=j=>{j.data.browserFile&&(j.data.type==="parse-ilda"?j.data.success?C.postMessage({type:"get-frame",workerId:j.data.workerId,frameIndex:0,browserFile:!0,filePath:j.data.filePath}):(console.warn(`[FileBrowser] Skipping invalid ILDA file: ${j.data.filePath}. Reason: ${j.data.error}`),b(_=>new Set(_).add(j.data.filePath)),M.current=!1,H()):j.data.type==="get-frame"&&(j.data.success&&p(_=>({..._,[j.data.filePath]:j.data.bitmap||j.data.frame})),M.current=!1,H()))};return C.addEventListener("message",D),()=>C.removeEventListener("message",D)},[C,H]),N.useEffect(()=>{if(e==="thumbnails"&&o.length>0&&C){let D=!1;o.forEach(j=>{!h[j]&&!w.current.has(j)&&(w.current.add(j),x.current.push(j),D=!0)}),D&&!M.current&&H()}},[e,o,C,h,H]),N.useEffect(()=>{(async()=>{if(s){const j=await window.electronAPI.readIldFiles(s);u(j),w.current.clear(),x.current=[],M.current=!1,p({});return}if(window.electronAPI&&window.electronAPI.getUserIldaPath){const j=await window.electronAPI.getUserIldaPath();if(j){I(j);const _=await window.electronAPI.readIldFiles(j);u(_),w.current.clear(),x.current=[],M.current=!1,p({})}}})()},[s]);const B=async()=>{if(window.electronAPI){const D=await window.electronAPI.openFileExplorer();if(D){I(D);const j=await window.electronAPI.readIldFiles(D);u(j),w.current.clear(),x.current=[],M.current=!1,p({})}}};return f.jsxs("div",{className:"file-browser",children:[f.jsx("button",{onClick:B,children:"Open Folder"}),f.jsxs("div",{className:"list_switcher",children:[f.jsx("button",{className:e==="list"?"active":"",onClick:()=>a&&a("list"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-list",viewBox:"0 0 16 16",children:f.jsx("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"})})}),f.jsx("button",{className:e==="thumbnails"?"active":"",onClick:()=>a&&a("thumbnails"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"}),f.jsx("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"})]})})]}),R&&f.jsxs("p",{className:"fileBrowser",children:["Selected Directory: ",R.split(/[/\\]/).filter(Boolean).pop()]}),f.jsx("div",{className:"ild-file-grid",style:{display:e==="thumbnails"?null:"none"},children:o.filter(D=>!g.has(D)).length>0?o.filter(D=>!g.has(D)).map((D,j)=>{const _=D.split(/[/\\]/).pop(),G=h[D];return f.jsxs("div",{className:"ild-file-preview",draggable:!0,onDragStart:Y=>Y.dataTransfer.setData("application/json",JSON.stringify({filePath:D,fileName:_})),children:[f.jsx("div",{className:"file_thumbnail",children:G?f.jsx(od,{bitmap:G instanceof ImageBitmap?G:null,frame:G instanceof ImageBitmap?null:G}):f.jsx("div",{className:"clip-loading-spinner"})}),f.jsx("div",{className:"file_name",children:_})]},j)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})}),f.jsx("div",{className:"ild-file-list",style:{display:e==="list"?null:"none"},children:o.filter(D=>!g.has(D)).length>0?o.filter(D=>!g.has(D)).map((D,j)=>{const _=D.split(/[/\\]/).pop();return f.jsx("div",{className:"ild-file-item",draggable:!0,onDragStart:G=>G.dataTransfer.setData("application/json",JSON.stringify({filePath:D,fileName:_})),children:_},j)}):f.jsx("p",{children:"No valid ILD files found in selected directory."})})]})},Xf=[{id:"circle",name:"Circle",description:"Generates a simple circle.",defaultParams:{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"radius",label:"Radius",type:"range",min:.01,max:1,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:3,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"square",name:"Square",description:"Generates a simple square.",defaultParams:{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"width",label:"Width",type:"range",min:.01,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"triangle",name:"Triangle",description:"Generates a simple symmetrical triangle.",defaultParams:{size:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"size",label:"Size",type:"range",min:.01,max:2,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:25,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"line",name:"Line",description:"Generates a straight line.",defaultParams:{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"x1",label:"X1",type:"range",min:-1,max:1,step:.01},{id:"y1",label:"Y1",type:"range",min:-1,max:1,step:.01},{id:"x2",label:"X2",type:"range",min:-1,max:1,step:.01},{id:"y2",label:"Y2",type:"range",min:-1,max:1,step:.01},{id:"pointDensity",label:"Point Density",type:"range",min:2,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"text",name:"Text",description:"Generates text.",defaultParams:{text:"TrueLazer",x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"text",label:"Text Content",type:"text"},{id:"fontUrl",label:"Fonts",type:"text"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:300,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"star",name:"Star",description:"Generates a star shape.",defaultParams:{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"outerRadius",label:"Outer Radius",type:"range",min:.01,max:1,step:.01},{id:"innerRadius",label:"Inner Radius",type:"range",min:.01,max:1,step:.01},{id:"numSpikes",label:"Number of Spikes",type:"range",min:3,max:20,step:1},{id:"pointDensity",label:"Point Density",type:"range",min:1,max:20,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"ndi-source",name:"NDI Source",description:"Placeholder for NDI Video Input.",defaultParams:{sourceName:"No Source",threshold:128,edgeDetection:!1,captureWidth:480,captureHeight:480,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Source Name",type:"text"},{id:"captureWidth",label:"Width",type:"range",min:128,max:1280,step:1},{id:"captureHeight",label:"Height",type:"range",min:128,max:1280,step:1},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"spout-receiver",name:"Spout Receiver",description:"Placeholder for Spout Video Input.",defaultParams:{sourceName:"Spout Input",threshold:128,edgeDetection:!1,x:0,y:0,scale:1,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"sourceName",label:"Sender Name",type:"text"},{id:"threshold",label:"Threshold",type:"range",min:0,max:255,step:1},{id:"edgeDetection",label:"Edge Detection",type:"checkbox"},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"scale",label:"Scale",type:"range",min:.1,max:2,step:.1},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"sinewave",name:"Sine Wave",description:"Generates a customizable sine wave.",defaultParams:{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"amplitude",label:"Amplitude",type:"range",min:0,max:1,step:.01},{id:"frequency",label:"Frequency",type:"range",min:.1,max:10,step:.1},{id:"phase",label:"Phase",type:"range",min:0,max:Math.PI*2,step:.01},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"numPoints",label:"Number of Points",type:"range",min:10,max:100,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"thickness",label:"Thickness",type:"range",min:1,max:10,step:1,condition:n=>n.renderingStyle==="dotted"},{id:"blankingSize",label:"Blanking Size",type:"range",min:1,max:20,step:1,condition:n=>n.renderingStyle==="blanked"},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"waveform",name:"Waveform",description:"Generates a real-time audio visualization.",defaultParams:{mode:"bars",width:2,height:1,numBins:32,freqRange:[0,1],x:0,y:0,r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Visualization Mode",type:"select",options:[{label:"Candle Bar",value:"bars"},{label:"Waveform (Osc)",value:"waveform"},{label:"Spectrum Line",value:"spectrum"}]},{id:"freqRange",label:"Frequency Range",type:"range",min:0,max:1,step:.01,isRange:!0,default:[0,1],showIf:{mode:["bars","spectrum"]}},{id:"numBins",label:"Resolution",type:"range",min:8,max:128,step:1},{id:"width",label:"Width",type:"range",min:.1,max:2,step:.01},{id:"height",label:"Height",type:"range",min:.1,max:2,step:.01},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]},{id:"timer",name:"Timer",description:"Generates a clock, count-up or count-down visualization.",defaultParams:{mode:"clock",format:"MM:SS",startTime:60,x:0,y:.3,fontSize:72,numPoints:100,fontUrl:"src/fonts/Geometr415 Blk BT Black.ttf",r:255,g:255,b:255,renderingStyle:"normal",thickness:1,blankingSize:3},paramControls:[{id:"mode",label:"Mode",type:"select",options:[{label:"Clock",value:"clock"},{label:"Count-up",value:"count-up"},{label:"Count-down",value:"count-down"}]},{id:"format",label:"Format",type:"select",options:[{label:"HH:MM:SS",value:"HH:MM:SS"},{label:"MM:SS",value:"MM:SS"},{label:"SS.mm",value:"SS.mm"}]},{id:"startTime",label:"Start Time (Sec)",type:"range",min:1,max:3600,step:1,showIf:{mode:"count-down"}},{id:"fontUrl",label:"Fonts",type:"text"},{id:"fontSize",label:"Font Size",type:"range",min:10,max:200,step:1},{id:"numPoints",label:"Target Points",type:"range",min:10,max:500,step:1},{id:"renderingStyle",label:"Beam Style",type:"select",options:[{label:"Normal",value:"normal"},{label:"Dotted",value:"dotted"},{label:"Blanked",value:"blanked"},{label:"Dots",value:"dots"}]},{id:"x",label:"X Position",type:"range",min:-1,max:1,step:.01},{id:"y",label:"Y Position",type:"range",min:-1,max:1,step:.01},{id:"r",label:"Red",type:"range",min:0,max:255,step:1},{id:"g",label:"Green",type:"range",min:0,max:255,step:1},{id:"b",label:"Blue",type:"range",min:0,max:255,step:1}]}],mv=()=>{const[n,e]=N.useState([]);N.useEffect(()=>{const l=async()=>{if(window.electronAPI&&window.electronAPI.ndiFindSources){const u=await window.electronAPI.ndiFindSources();e(u||[])}};l();const o=setInterval(l,5e3);return()=>clearInterval(o)},[]);const a=(l,o)=>{l.dataTransfer.setData("application/json",JSON.stringify(o))},s=(l,o)=>{const u=Xf.find(p=>p.id==="ndi-source"),h={...u,defaultParams:{...u.defaultParams,sourceName:o.name}};l.dataTransfer.setData("application/json",JSON.stringify(h))};return f.jsxs("div",{className:"generator-panel",children:[f.jsx("div",{className:"generator-list",children:Xf.filter(l=>l.id!=="ndi-source"&&l.id!=="spout-receiver").map(l=>f.jsx("div",{className:"generator-item",draggable:!0,onDragStart:o=>a(o,l),children:l.name},l.id))}),f.jsx("h3",{style:{marginTop:"10px"},children:"NDI Sources"}),f.jsx("div",{className:"generator-list",children:n.length>0?n.map((l,o)=>f.jsx("div",{className:"generator-item ndi-item",draggable:!0,onDragStart:u=>s(u,l),children:l.name},`${l.name}-${o}`)):f.jsx("div",{className:"empty-msg",children:"No NDI sources found"})})]})},gv=()=>{const n=(e,a)=>{e.dataTransfer.setData("application/json",JSON.stringify(a))};return f.jsx("div",{className:"effect-panel",children:ll.map(e=>f.jsx("div",{draggable:!0,onDragStart:a=>n(a,e),className:"effect-item",children:e.name},e.id))})},bi=({value:n,onChange:e,label:a,onDrop:s,size:l=40,isAssigned:o,className:u,...h})=>{const p=N.useRef(null),g=x=>{s&&(x.preventDefault(),x.dataTransfer.dropEffect="link")},b=x=>{if(s){x.preventDefault();try{const M=x.dataTransfer.getData("application/x-truelazer-param");console.log("[RadialKnob] Dropped Data Raw:",M);const R=JSON.parse(M);console.log("[RadialKnob] Dropped Data Parsed:",R),R&&(R.type==="range"||R.type==="number")?s(R):console.warn("[RadialKnob] Invalid data type for knob:",R?.type)}catch(M){console.error("[RadialKnob] Drop Error:",M)}}},C=-135+n*270,w=x=>{if(!o||x.button!==0)return;x.preventDefault();const M=x.clientY,R=n,I=B=>{const j=(M-B.clientY)/200;let _=Math.max(0,Math.min(1,R+j));e(_)},H=()=>{window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",H)};window.addEventListener("mousemove",I),window.addEventListener("mouseup",H)};return N.useEffect(()=>{const x=p.current;if(!x)return;const M=R=>{if(!o)return;R.preventDefault(),R.stopPropagation();const I=R.deltaY*-.001;let H=Math.max(0,Math.min(1,n+I));e(H)};return x.addEventListener("wheel",M,{passive:!1}),()=>{x.removeEventListener("wheel",M)}},[n,e,o]),f.jsxs("div",{className:`quick-assign-knob ${o?"":"unassigned"} ${u||""}`.trim(),ref:p,style:{cursor:o?"ns-resize":"default",userSelect:"none",opacity:o?1:.5},onDragOver:g,onDrop:b,onMouseDown:w,...h,children:[f.jsx("div",{className:"knob-label",title:a,children:a}),f.jsx("div",{className:"knob-circle",children:f.jsx("div",{className:"knob-indicator",style:{transform:`rotate(${C}deg)`}})}),f.jsxs("div",{className:"knob-value",style:{fontSize:"9px",color:"#888",marginTop:"2px"},children:[Math.round(n*100),"%"]})]})},yv=({dacs:n=[],onDacSelected:e,onDacsDiscovered:a,dacSettings:s={},onUpdateDacSettings:l})=>{const[o,u]=N.useState(!1),[h,p]=N.useState(null),[g,b]=N.useState([]),[C,w]=N.useState(null),x=Yn.useRef(!1);N.useEffect(()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(B=>{b(B),B.length>0&&w(B[0])})},[]),N.useEffect(()=>{o&&!x.current&&(x.current=!0,console.log("Starting DAC scan on:",C?.address),window.electronAPI?window.electronAPI.discoverDacs(2e3,C?.address).then(async B=>{console.log("DACs discovered:",B);const D=await Promise.all(B.map(async j=>{try{const _=await window.electronAPI.getDacServices(j.ip,C?.address,j.type),G=j.type&&j.type.toLowerCase()==="etherdream"?_:_.filter(Y=>Y.serviceID!==0);return{...j,channels:G}}catch(_){return console.error(`Error fetching services for DAC ${j.ip}:`,_),{...j,channels:[]}}}));a&&a(D)}).catch(B=>{console.error("Error discovering DACs:",B)}).finally(()=>{u(!1),x.current=!1}):(console.warn("electronAPI is not available. Cannot discover DACs."),u(!1),x.current=!1))},[o,C,a]);const M=(B,D)=>{const j={...B,channel:D};p(j),e&&e(j)},R=(B,D,j)=>{B.stopPropagation();const _={...D,channel:j};B.dataTransfer.setData("application/json",JSON.stringify(_))},I=B=>{const D=B.target.value,j=g.find(_=>_.address===D);w(j)},H=(B,D)=>{B.stopPropagation();const j={...D,allChannels:!0};B.dataTransfer.setData("application/json",JSON.stringify(j))};return f.jsxs("div",{className:"dac-panel",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"DACs"})}),f.jsxs("div",{className:"network-interface-selector",style:{display:"flex",gap:5,padding:"5px 10px"},children:[f.jsxs("div",{style:{flex:1,display:"flex"},children:[f.jsx("select",{onChange:I,value:C?.address||"",style:{width:"100%",height:"100%",background:"#2a2a2a",color:"#aaa",borderRadius:"5px",cursor:"pointer",marginBottom:2},children:g.map(B=>f.jsxs("option",{value:B.address,children:[B.name," (",B.address,")"]},B.address))}),f.jsx("button",{onClick:()=>{window.electronAPI&&window.electronAPI.getNetworkInterfaces().then(B=>{b(B),B.length>0&&!C&&w(B[0])})},style:{fontSize:"9px",padding:"2px",background:"#333",border:"1px solid #555",color:"#ccc",cursor:"pointer",borderRadius:"5px"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-clockwise",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"}),f.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"})]})})]}),f.jsx("label",{style:{display:"flex",alignItems:"center",fontSize:"10px"},children:f.jsx("input",{type:"checkbox",checked:o,onChange:B=>u(B.target.checked),disabled:o,style:{height:"100%"}})})]}),f.jsx("div",{className:"dac-list",children:n.map(B=>f.jsxs("div",{className:"dac-group",draggable:!0,onDragStart:D=>H(D,B),children:[f.jsxs("div",{className:"dac-ip",children:[B.hostName||B.ip," (",B.ip,")"]}),f.jsx("div",{className:"dac-channels",children:B.channels&&B.channels.length>0?B.channels.map(D=>f.jsxs("div",{className:`dac-channel-item ${h&&(h.unitID===B.unitID||h.ip===B.ip)&&h.channel===D.serviceID?"selected":""}`,onClick:()=>M(B,D.serviceID),draggable:!0,onDragStart:j=>R(j,B,D.serviceID),children:["Channel ",D.serviceID," (",D.name,")"]},`${B.unitID||B.ip}-${D.serviceID}`)):f.jsx("div",{className:"dac-channel-item no-channels",children:"No channels found"})})]},B.unitID||B.ip))}),n.length>0&&f.jsxs("div",{className:"dac-dimmers-section",children:[f.jsx("h4",{children:"Channel Dimmers"}),f.jsx("div",{className:"dac-dimmers-grid",children:n.flatMap(B=>(B.channels||[]).map(D=>({dac:B,ch:D}))).map(({dac:B,ch:D})=>{const j=`${B.ip}:${D.serviceID}`,_=s[j]||{},G=_.dimmer!==void 0?_.dimmer:1;return f.jsx($t,{id:`dimmer_${j.replace(/\./g,"_")}`,children:f.jsx(bi,{label:`${B.hostName||B.ip} Ch${D.serviceID}`,value:G,onChange:Y=>{l&&l(j,{..._,dimmer:Y})}})},`dimmer_${j}`)})})]})]})},$m=({min:n,max:e,step:a,value:s,rangeValue:l,onChange:o,onRangeChange:u,showRange:h=!1,disabled:p=!1,animSettings:g,progressRef:b,workerId:C,clipDuration:w,bpm:x,getFftLevels:M})=>{const R=N.useRef(null),I=N.useRef(null),H=N.useRef(null),[B,D]=N.useState(null),j=n!==void 0?n:0,_=e!==void 0?e:1,G=l&&l[0]!==void 0?l[0]:j,Y=l&&l[1]!==void 0?l[1]:_,J=s!==void 0?s:j,ae=O=>{const W=_-j;return W===0?0:(O-j)/W*100};N.useEffect(()=>{let O;const W=()=>{if(B==="value"){O=requestAnimationFrame(W);return}let K=J;if(g&&g.syncMode&&b&&b.current){const V={progress:C&&b.current[C]!==void 0?b.current[C]:0,time:performance.now(),clipDuration:w||1,bpm:x||120,fftLevels:M?M():{low:0,mid:0,high:0}};K=Mc(null,J,g,V,j,_)}const Z=ae(K);I.current&&(I.current.style.left=`${Z}%`),H.current&&(H.current.style.width=`${Z}%`),O=requestAnimationFrame(W)};return O=requestAnimationFrame(W),()=>cancelAnimationFrame(O)},[g,b,C,J,B,j,_,x,M,w]);const re=(O,W)=>{if(p)return;O.preventDefault(),O.stopPropagation(),D(W);const K=ee=>{if(!R.current)return;const V=R.current.getBoundingClientRect(),te=ee.clientX-V.left;let ce=Math.max(0,Math.min(100,te/V.width*100)),xe=j+ce/100*(_-j);a&&(xe=Math.round(xe/a)*a,ce=(xe-j)/(_-j)*100),W==="value"?(xe=Math.max(G,Math.min(Y,xe)),I.current&&(I.current.style.left=`${ae(xe)}%`),H.current&&!h&&(H.current.style.width=`${ae(xe)}%`),o&&o(xe)):W==="min"?(xe=Math.max(j,Math.min(Y,xe)),u&&u([xe,Y])):W==="max"&&(xe=Math.max(G,Math.min(_,xe)),u&&u([G,xe]))},Z=()=>{D(null),window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",Z)};window.addEventListener("mousemove",K),window.addEventListener("mouseup",Z)};return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:R,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[h&&f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:`${ae(G)}%`,width:`${ae(Y)-ae(G)}%`}}),!h&&f.jsx("div",{className:"value-slider-fill",ref:H,style:{position:"absolute",height:"100%",background:"var(--theme-color-transparent)",left:"0%",borderRadius:"2px"}}),h&&f.jsx("div",{className:"range-slider-handle min-handle",style:{left:`${ae(G)}%`},onMouseDown:O=>re(O,"min"),title:`Min: ${G.toFixed(2)}`}),h&&f.jsx("div",{className:"range-slider-handle max-handle",style:{left:`${ae(Y)}%`},onMouseDown:O=>re(O,"max"),title:`Max: ${Y.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle value-handle",ref:I,style:{position:"absolute",width:"6px",height:"16px",top:"-50%",transform:"translate(-50%, -25%)",cursor:"pointer",zIndex:20,boxShadow:"0 0 2px rgba(0,0,0,0.5)"},onMouseDown:O=>re(O,"value"),title:`Value: ${J.toFixed(2)}`})]})})},Wm=({min:n=0,max:e=1,step:a=.01,value:s=[0,1],onChange:l,disabled:o=!1})=>{const u=N.useRef(null),[h,p]=N.useState(null),g=s[0]!==void 0?s[0]:n,b=s[1]!==void 0?s[1]:e,C=N.useCallback(x=>{const M=e-n;return M===0?0:(x-n)/M*100},[n,e]),w=(x,M)=>{if(o)return;x.preventDefault(),x.stopPropagation(),p(M);const R=H=>{if(!u.current)return;const B=u.current.getBoundingClientRect(),D=H.clientX-B.left;let j=Math.max(0,Math.min(100,D/B.width*100)),_=n+j/100*(e-n);if(a&&(_=Math.round(_/a)*a),M==="low"){const G=Math.min(_,b-a);l&&l([G,b])}else{const G=Math.max(_,g+a);l&&l([g,G])}},I=()=>{p(null),window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",I)};window.addEventListener("mousemove",R),window.addEventListener("mouseup",I)};return f.jsx("div",{className:"range-slider-container",style:{position:"relative",width:"100%",height:"20px",display:"flex",alignItems:"center"},children:f.jsxs("div",{className:"range-slider-track",ref:u,style:{width:"100%",height:"4px",background:"#444",borderRadius:"2px",position:"relative"},children:[f.jsx("div",{className:"range-slider-fill",style:{position:"absolute",height:"100%",background:"var(--theme-color)",left:`${C(g)}%`,width:`${C(b)-C(g)}%`}}),f.jsx("div",{className:"range-slider-handle",style:{left:`${C(g)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:x=>w(x,"low"),title:`Low: ${g.toFixed(2)}`}),f.jsx("div",{className:"range-slider-handle",style:{left:`${C(b)}%`,position:"absolute",width:"10px",height:"10px",borderRadius:"50%",background:"#fff",top:"50%",transform:"translate(-50%, -50%)",cursor:"pointer",zIndex:20},onMouseDown:x=>w(x,"high"),title:`High: ${b.toFixed(2)}`})]})})},ea=({title:n,children:e,icon:a,defaultCollapsed:s=!1,headerActions:l,onToggle:o,isCollapsed:u,dragHandle:h})=>{const[p,g]=N.useState(s),b=o!==void 0?u:p,C=()=>{o?o(!b):g(!b)};return f.jsxs("div",{className:`settings-card ${b?"collapsed":""}`,children:[f.jsxs("div",{className:"settings-card-header",onClick:C,style:{userSelect:"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",cursor:"pointer",flex:1,overflow:"hidden"},children:[h&&f.jsx("div",{onClick:w=>w.stopPropagation(),style:{display:"flex",alignItems:"center"},children:h}),f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",style:{transform:b?"rotate(0deg)":"rotate(90deg)",transition:"transform 0.2s",flexShrink:0},children:f.jsx("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})}),a&&f.jsx("span",{className:`bi ${a}`,style:{flexShrink:0}}),f.jsx("h4",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",margin:0},children:n})]}),l&&f.jsx("div",{onClick:w=>w.stopPropagation(),style:{flexShrink:0,marginLeft:"5px"},children:l})]}),!b&&f.jsx("div",{className:"settings-card-content",children:e})]})},Zm=({animSettings:n,onChange:e})=>{const{direction:a="forward",style:s="loop",syncMode:l=null,duration:o=1,beats:u=8,speedMultiplier:h=1}=n||{},p=(b,C)=>e({...n,[b]:C}),g=(b,C,w=!1)=>{let M=n?.[b]||(b==="beats"?8:1);w?M=C>1?M*2:M/2:M+=C,M<.01&&(M=.01),!w&&b!=="beats"&&(M=Math.round(M*100)/100),p(b,M)};return f.jsxs("div",{className:"anim-controls-container",children:[f.jsxs("div",{className:"anim-row controls-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"5px"},children:[f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${a==="backward"?"active":""}`,onClick:()=>p("direction","backward"),title:"Backward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",transform:"scale(-1 1)",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})}),f.jsx("button",{className:`speed-control-button ${a==="pause"?"active":""}`,onClick:()=>p("direction","pause"),title:"Pause",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"25",height:"20",viewBox:"0 0 16 16",className:"icon flat-color",children:f.jsx("path",{d:"M3 1h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m7 0h3c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1m0 0"})})}),f.jsx("button",{className:`speed-control-button ${a==="forward"?"active":""}`,onClick:()=>p("direction","forward"),title:"Forward",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsx("svg",{width:"30",height:"20",viewBox:"0 0 24 24","data-name":"Flat Color",className:"icon flat-color",children:f.jsx("path",{d:"M17 2a1 1 0 0 0-1 1v7.08l-8.43-5.9a1 1 0 0 0-1-.07A1 1 0 0 0 6 5v14a1 1 0 0 0 .54.89A1 1 0 0 0 7 20a1 1 0 0 0 .57-.18l8.43-5.9V21a1 1 0 0 0 2 0V3a1 1 0 0 0-1-1",stroke:"black"})})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${s==="once"?"active":""}`,onClick:()=>p("style","once"),title:"Once",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M43.8233 25.2305C43.7019 25.9889 43.5195 26.727 43.2814 27.4395 42.763 28.9914 41.9801 30.4222 40.9863 31.6785 38.4222 34.9201 34.454 37 30 37H16C9.39697 37 4 31.6785 4 25 4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19V31",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M24 19 21 22 19.5 23.5",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="bounce"?"active":""}`,onClick:()=>p("style","bounce"),title:"Bounce",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M42 19H5.99998",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M30 7 42 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79897 29H42.799",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M6.79895 29 18.799 41",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})}),f.jsx("button",{className:`speed-control-button ${s==="loop"?"active":""}`,onClick:()=>p("style","loop"),title:"Loop",style:{flex:1,padding:0,fontSize:"10px"},children:f.jsxs("svg",{width:"30",height:"20",viewBox:"0 0 48 48",fill:"none",className:"icon two-color",children:[f.jsx("path",{d:"M4 25C4 18.3502 9.39624 13 16 13L44 13",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M38 7 44 13 38 19",stroke:"black",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M44 23C44 29.6498 38.6038 35 32 35H4",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),f.jsx("path",{d:"M10 41 4 35 10 29",stroke:"var(--theme-color)",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),f.jsxs("div",{className:"btn-group",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:`speed-control-button ${l==="fps"?"active":""}`,onClick:()=>p("syncMode",l==="fps"?null:"fps"),style:{flex:1,padding:0,fontSize:"10px"},children:"F"}),f.jsx("button",{className:`speed-control-button ${l==="timeline"?"active":""}`,onClick:()=>p("syncMode",l==="timeline"?null:"timeline"),style:{flex:1,padding:0,fontSize:"10px"},children:"T"}),f.jsx("button",{className:`speed-control-button ${l==="bpm"?"active":""}`,onClick:()=>p("syncMode",l==="bpm"?null:"bpm"),style:{flex:1,padding:0,fontSize:"10px"},children:"B"}),f.jsx("button",{className:`speed-control-button ${l==="fft"?"active":""}`,onClick:()=>p("syncMode",l==="fft"?null:"fft"),style:{flex:1,padding:0,fontSize:"10px"},children:"FFT"})]})]}),l==="fft"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Range"}),f.jsxs("select",{value:n?.fftRange||"low",onChange:b=>p("fftRange",b.target.value),style:{fontSize:"10px",background:"#333",border:"1px solid #555",color:"white"},children:[f.jsx("option",{value:"low",children:"Low"}),f.jsx("option",{value:"mid",children:"Mid"}),f.jsx("option",{value:"high",children:"High"})]})]})}),l==="timeline"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:typeof o=="number"?o.toFixed(2):o,onChange:b=>p("duration",parseFloat(b.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("duration",2,!0),children:"*2"})]})]})}),l==="bpm"&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Beats"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:b=>p("beats",parseInt(b.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",1),children:"+1"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",.5,!0),children:"/2"}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("beats",2,!0),children:"*2"})]})]})}),(l==="timeline"||l==="bpm"||l==="fps")&&f.jsx("div",{className:"anim-sub-settings",style:{marginTop:"5px",padding:"2px",background:"rgba(0,0,0,0.2)"},children:f.jsxs("div",{className:"control-group",style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"10px"},children:[f.jsx("label",{style:{color:"#aaa",marginRight:"5px"},children:"Speed"}),f.jsxs("div",{className:"value-adjuster",style:{display:"flex",gap:"2px"},children:[f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:typeof h=="number"?h.toFixed(2):h,onChange:b=>p("speedMultiplier",parseFloat(b.target.value)||1),style:{width:"40px",fontSize:"10px",textAlign:"center",background:"#333",border:"1px solid #555",color:"white"}}),f.jsx("button",{className:"tiny-btn",onClick:()=>g("speedMultiplier",.1),children:"+0.1"})]})]})})]})},to=(n,e,a)=>{let s,l,o;const u=Math.floor(n*6),h=n*6-u,p=a*(1-e),g=a*(1-h*e),b=a*(1-(1-h)*e);switch(u%6){case 0:s=a,l=b,o=p;break;case 1:s=g,l=a,o=p;break;case 2:s=p,l=a,o=b;break;case 3:s=p,l=g,o=a;break;case 4:s=b,l=p,o=a;break;case 5:s=a,l=p,o=g;break}const C=w=>{const x=Math.round(w*255).toString(16);return x.length===1?"0"+x:x};return`#${C(s)}${C(l)}${C(o)}`},q0=n=>{let e=parseInt(n.slice(1,3),16)/255,a=parseInt(n.slice(3,5),16)/255,s=parseInt(n.slice(5,7),16)/255,l=Math.max(e,a,s),o=Math.min(e,a,s),u,h,p=l,g=l-o;if(h=l===0?0:g/l,l===o)u=0;else{switch(l){case e:u=(a-s)/g+(a<s?6:0);break;case a:u=(s-e)/g+2;break;case s:u=(e-a)/g+4;break}u/=6}return{h:u,s:h,v:p}},V0=({color:n="#ffffff",onChange:e})=>{const a=N.useRef(null),[s,l]=N.useState(()=>q0(n)),[o,u]=N.useState(!1);N.useEffect(()=>{const b=q0(n);to(b.h,b.s,b.v)!==to(s.h,s.s,s.v)&&l(b)},[n]);const h=N.useCallback(()=>{const b=a.current;if(!b)return;const C=b.getContext("2d"),w=b.width,x=b.height;C.fillStyle=to(s.h,1,1),C.fillRect(0,0,w,x);const M=C.createLinearGradient(0,0,w,0);M.addColorStop(0,"rgba(255,255,255,1)"),M.addColorStop(1,"rgba(255,255,255,0)"),C.fillStyle=M,C.fillRect(0,0,w,x);const R=C.createLinearGradient(0,0,0,x);R.addColorStop(0,"rgba(0,0,0,0)"),R.addColorStop(1,"rgba(0,0,0,1)"),C.fillStyle=R,C.fillRect(0,0,w,x);const I=s.s*w,H=(1-s.v)*x;C.strokeStyle=s.v>.5?"#000":"#fff",C.lineWidth=2,C.beginPath(),C.arc(I,H,5,0,Math.PI*2),C.stroke()},[s]);N.useEffect(()=>{h()},[h]);const p=b=>{const w=a.current.getBoundingClientRect(),x=Math.max(0,Math.min(1,(b.clientX-w.left)/w.width)),M=Math.max(0,Math.min(1,(b.clientY-w.top)/w.height)),R={...s,s:x,v:1-M};l(R),e&&e(to(R.h,R.s,R.v))},g=b=>{u(!0),p(b)};return N.useEffect(()=>{if(!o)return;const b=w=>p(w),C=()=>u(!1);return window.addEventListener("mousemove",b),window.addEventListener("mouseup",C),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",C)}},[o,s]),f.jsxs("div",{className:"custom-color-picker",style:{padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("canvas",{ref:a,width:150,height:100,style:{width:"100%",height:"100px",cursor:"crosshair",borderRadius:"2px"},onMouseDown:g}),f.jsx("div",{className:"hue-slider-container",style:{marginTop:"8px"},children:f.jsx("input",{type:"range",min:"0",max:"1",step:"0.001",value:s.h,onChange:b=>{const C={...s,h:parseFloat(b.target.value)};l(C),e&&e(to(C.h,C.s,C.v))},style:{width:"100%",height:"10px",appearance:"none",background:"linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)",borderRadius:"5px"}})})]})},Qm=({control:n,value:e,onChange:a,animSettings:s,onAnimChange:l,effectId:o,context:u,progressRef:h,workerId:p,clipDuration:g,bpm:b,getFftLevels:C,uiState:w,onUpdateUiState:x,paramKey:M})=>{const[R,I]=N.useState(!1),H=!!w?.expandedParams?.[M],B=Y=>{x&&x({expandedParams:{...w?.expandedParams||{},[M]:Y}})},D=Y=>{Y.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,effectId:o,min:n.min,max:n.max,step:n.step,...u}))},j=s?.range||[n.min,n.max],_=Y=>{l({...s,range:Y})},G=Y=>{l({range:j,...Y})};return f.jsxs("div",{className:`param-editor ${H?"expanded":""}`,onMouseEnter:()=>I(!0),onMouseLeave:()=>I(!1),style:{marginBottom:"8px",display:"grid",gridTemplateColumns:"1fr",gap:"2px"},children:[f.jsx("div",{className:"param-row-label",style:{width:"100%"},children:f.jsx("label",{className:"param-label",draggable:!0,onDragStart:D,style:{fontSize:"11px",color:"#aaa"},children:n.label})}),f.jsxs("div",{className:"param-row-control",style:{display:"grid",gridTemplateColumns:"20px 1fr 60px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${H?"active":""}`,style:{visibility:R||H||s?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>B(!H),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",style:{display:"flex",alignItems:"center",height:"100%"},children:n.type==="range"?n.isRange?f.jsx(Wm,{min:n.min,max:n.max,step:n.step,value:e,onChange:a}):f.jsx($t,{id:`${o}_${n.id}`,style:{width:"100%"},children:f.jsx($m,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:j,onChange:a,onRangeChange:_,showRange:H,animSettings:s,progressRef:h,workerId:p,clipDuration:g,bpm:b,getFftLevels:C})}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:Y=>a(Y.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx($t,{id:`${o}_${n.id}`,children:f.jsx("input",{type:"checkbox",checked:e,onChange:Y=>a(Y.target.checked),className:"param-checkbox"})}):n.type==="select"?f.jsx("select",{value:e,onChange:Y=>a(Y.target.value),className:"param-select",children:n.options.map(Y=>f.jsx("option",{value:Y,children:Y},Y))}):null}),n.type==="range"&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:Y=>a(parseFloat(Y.target.value)||0),className:"param-number-input",step:n.step,style:{fontSize:"10px"}})]}),H&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Zm,{animSettings:s,onChange:G})})]})},vv=({customOrder:n=[],assignedDacs:e=[],onChange:a})=>{const[s,l]=N.useState(null),o=n&&n.length>0?n:e.map((p,g)=>({ip:p.ip,channel:p.channel,label:`Ch ${p.channel} (${p.hostName||p.ip})`,originalIndex:g})),u=(p,g)=>{l(o[g])},h=(p,g)=>{p.preventDefault();const b=o[g];if(s===b)return;const C=o.filter(w=>w!==s);C.splice(g,0,s),a(C)};return f.jsxs("div",{className:"custom-order-editor",style:{marginBottom:"10px",padding:"5px",background:"#222",borderRadius:"4px"},children:[f.jsx("label",{style:{fontSize:"10px",color:"#888"},children:"Channel Order (Drag to Sort)"}),f.jsx("ul",{style:{listStyle:"none",padding:0,margin:"5px 0"},children:o.map((p,g)=>f.jsxs("li",{draggable:!0,onDragStart:b=>u(b,g),onDragOver:b=>h(b,g),style:{background:"#333",border:"1px solid #444",padding:"4px",marginBottom:"2px",fontSize:"10px",cursor:"grab",display:"flex",alignItems:"center"},children:[f.jsx("span",{style:{marginRight:"5px",color:"#666"},children:""}),p.label||`Ch ${p.channel} ${p.ip?`(${p.ip})`:""}`]},g))})]})},bv=({effect:n,onParamChange:e,syncSettings:a,onSetParamSync:s,context:l,progressRef:o,workerId:u,clipDuration:h,bpm:p,getFftLevels:g,uiState:b,onUpdateUiState:C})=>{const{mode:w,color:x,paletteColors:M=[],paletteSize:R=4}=n.params,[I,H]=N.useState(0),B=!!b?.showHsv?.[n.instanceId],D=re=>{C&&C({showHsv:{...b?.showHsv||{},[n.instanceId]:re}})},j=re=>{const O=[...M];for(;O.length<16;)O.push("#ffffff");O[I]=re,e("paletteColors",O)},_=ll.find(re=>re.id==="color"),G=re=>{if(!re)return{h:0,s:0,v:1};const O=parseInt(re.slice(1,3),16)/255,W=parseInt(re.slice(3,5),16)/255,K=parseInt(re.slice(5,7),16)/255,Z=Math.max(O,W,K),ee=Math.min(O,W,K);let V,te,ce=Z;const xe=Z-ee;if(te=Z===0?0:xe/Z,Z===ee)V=0;else{switch(Z){case O:V=(W-K)/xe+(W<K?6:0);break;case W:V=(K-O)/xe+2;break;case K:V=(O-W)/xe+4;break}V/=6}return{h:V,s:te,v:ce}},Y=re=>{e("color",re);const O=G(re);e("hue",O.h),e("saturation",O.s),e("brightness",O.v)},J=[{name:"RGBY",colors:["#ff0000","#00ff00","#0000ff","#ffff00"]},{name:"CYBER",colors:["#ff00ff","#00ffff","#ffffff","#0000ff"]},{name:"FIRE",colors:["#ff8800","#ff0000","#ffff00","#880000"]},{name:"ICE",colors:["#0000ff","#0088ff","#00ffff","#ffffff"]}],ae=re=>{const O=_.paramControls.find(K=>K.id===re);if(!O)return null;const W=`${n.instanceId||n.id}.${O.id}`;return f.jsx(Qm,{control:O,value:n.params[re],onChange:K=>e(re,K),animSettings:a[W],onAnimChange:K=>s(W,K),effectId:n.id,context:l,progressRef:o,workerId:u,clipDuration:h,bpm:p,getFftLevels:g,uiState:b,onUpdateUiState:C,paramKey:W},re)};return f.jsxs("div",{className:"color-effect-editor",children:[ae("mode"),w==="solid"&&f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[f.jsx("label",{style:{fontSize:"11px",color:"#aaa"},children:"Pick Color"}),f.jsx("button",{className:`anim-toggle-btn ${B?"active":""}`,style:{background:"none",border:"none",color:B?"var(--theme-color)":"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>D(!B),title:"Advanced HSV Controls",children:""})]}),!B&&f.jsx(V0,{color:x||"#ffffff",onChange:Y}),B&&f.jsxs("div",{className:"hsv-sliders",style:{padding:"5px",background:"rgba(0,0,0,0.2)",borderRadius:"4px"},children:[ae("hue"),ae("saturation"),ae("brightness"),f.jsx("div",{style:{marginTop:"5px",height:"10px",borderRadius:"2px",background:x||"#ffffff",border:"1px solid #444"}})]})]}),w==="palette"&&f.jsxs("div",{style:{marginTop:"10px"},children:[ae("paletteSize"),ae("paletteSpread"),ae("cycleSpeed"),ae("rainbowOffset"),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Presets"}),f.jsx("div",{className:"preset-row",style:{display:"flex",gap:"4px",marginBottom:"10px"},children:J.map(re=>f.jsx("button",{onClick:()=>e("paletteColors",re.colors),style:{fontSize:"9px",padding:"2px 5px",background:"#333",color:"#ccc",border:"1px solid #444",borderRadius:"3px",cursor:"pointer"},children:re.name},re.name))}),f.jsx("label",{style:{fontSize:"11px",color:"#aaa",display:"block",margin:"10px 0 5px"},children:"Palette Colors"}),f.jsx("div",{className:"palette-grid",style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"10px"},children:Array.from({length:R}).map((re,O)=>f.jsx("div",{onClick:()=>H(O),style:{width:"20px",height:"20px",background:M[O]||"#ffffff",border:I===O?"2px solid white":"1px solid #444",borderRadius:"3px",cursor:"pointer",boxSizing:"border-box"}},O))}),f.jsx(V0,{color:M[I]||"#ffffff",onChange:j})]}),w==="rainbow"&&f.jsxs("div",{style:{marginTop:"10px"},children:[ae("cycleSpeed"),ae("rainbowSpread"),ae("rainbowOffset"),ae("rainbowPalette")]})]})},Km=({effect:n,assignedDacs:e=[],onParamChange:a,onRemove:s,syncSettings:l={},onSetParamSync:o,context:u={},progressRef:h,clipDuration:p,bpm:g,getFftLevels:b,uiState:C,onUpdateUiState:w,dragHandle:x})=>{if(!n)return null;const M=ll.find(G=>G.id===n.id);if(!M)return null;const R=n.id==="delay";n.id;const I=n.id==="color",H=n.params.enabled!==!1;n.params.mode;const B=C?.collapsedEffects||{},D=!!B[n.instanceId],j=G=>{w&&w({collapsedEffects:{...B,[n.instanceId]:G}})},_=G=>{G.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"enabled",label:`${n.name} ON`,...u}))};return f.jsx(ea,{title:n.name,isCollapsed:D,onToggle:j,dragHandle:x,headerActions:f.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[f.jsx($t,{id:`${n.id}_blackout`,children:f.jsx("button",{className:`layer-control-button ${H?"":"active"}`,onClick:()=>a("enabled",!H),draggable:!0,onDragStart:_,style:{padding:"2px",background:H?"none":"red",border:"none",color:"white",cursor:"pointer",display:"flex"},title:"Toggle Effect",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z"}),f.jsx("path",{d:"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z"})]})})}),f.jsx("button",{className:"remove-effect-btn",onClick:s,children:""})]}),children:I?f.jsx(bv,{effect:n,onParamChange:a,syncSettings:l,onSetParamSync:o,context:u,progressRef:h,workerId:u.workerId,clipDuration:p,bpm:g,getFftLevels:b,uiState:C,onUpdateUiState:w}):f.jsxs(f.Fragment,{children:[R&&f.jsx(f.Fragment,{children:n.params.useCustomOrder&&f.jsx(vv,{customOrder:n.params.customOrder,assignedDacs:e,onChange:G=>a("customOrder",G)})}),M.paramControls.map(G=>{if(R&&["customOrder"].includes(G.id)||G.showIf&&!Object.entries(G.showIf).every(([re,O])=>Array.isArray(O)?O.includes(n.params[re]):n.params[re]===O))return null;const Y=`${n.instanceId||n.id}.${G.id}`,J=typeof l[Y]=="object"?l[Y]:{syncMode:l[Y]};return f.jsx(Qm,{control:G,value:n.params[G.id],onChange:ae=>a(G.id,ae),animSettings:J,onAnimChange:ae=>o(Y,ae),effectId:n.id,context:u,progressRef:h,workerId:u.workerId,clipDuration:p,bpm:g,getFftLevels:b,uiState:C,onUpdateUiState:w,paramKey:Y},G.id)})]})})},xv=({control:n,value:e,onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,generatorId:g,clipDuration:b,uiState:C,onUpdateUiState:w})=>{const[x,M]=N.useState(!1),R=`${g}.${n.id}`,I=!!C?.expandedParams?.[R],H=G=>{w&&w({expandedParams:{...C?.expandedParams||{},[R]:G}})},B=G=>{G.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:n.type,paramName:n.id,targetType:"generator",layerIndex:o,colIndex:u,min:n.min,max:n.max,step:n.step}))},D=typeof s[R]=="object"?s[R]:{syncMode:s[R]},j=D?.range||[n.min,n.max],_=G=>{l(R,{...D,range:G})};return f.jsxs("div",{className:`param-editor ${I?"expanded":""}`,onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),style:{marginBottom:"8px"},children:[f.jsx("div",{className:"param-label-row",style:{display:"flex",alignItems:"center"},children:f.jsx("label",{draggable:!0,onDragStart:B,className:"param-label",style:{fontSize:"11px",color:"#aaa",cursor:"grab"},children:n.label})}),f.jsxs("div",{className:"control-row",style:{display:"grid",gridTemplateColumns:"20px 1fr 50px",gap:"5px",alignItems:"center"},children:[f.jsx("button",{className:`anim-toggle-btn ${I?"active":""}`,style:{visibility:x||I||D?.syncMode?"visible":"hidden",background:"none",border:"none",color:"#666",cursor:"pointer",padding:0,fontSize:"14px"},onClick:()=>H(!I),title:"Animate",children:""}),f.jsx("div",{className:"control-input-wrapper",children:n.type==="range"?n.isRange?f.jsx(Wm,{min:n.min,max:n.max,step:n.step,value:e,onChange:G=>a(n.id,G)}):f.jsx($m,{min:n.min,max:n.max,step:n.step,value:e,rangeValue:j,onChange:G=>a(n.id,G),onRangeChange:_,showRange:I,animSettings:D,progressRef:h,workerId:p,clipDuration:b}):n.type==="number"?f.jsx("input",{type:"number",value:e,onChange:G=>a(n.id,parseFloat(G.target.value)||0),className:"param-number-input",step:n.step}):n.type==="text"?f.jsx("input",{type:"text",value:e,onChange:G=>a(n.id,G.target.value),className:"param-text-input"}):n.type==="checkbox"?f.jsx("input",{type:"checkbox",checked:e,onChange:G=>a(n.id,G.target.checked),className:"param-checkbox"}):n.type==="select"?f.jsx("select",{value:e,onChange:G=>a(n.id,G.target.value),className:"param-select",style:{width:"100%",fontSize:"11px",background:"#333",color:"#fff",border:"1px solid #555"},children:n.options.map(G=>f.jsx("option",{value:G.value,children:G.label},G.value))}):null}),n.type==="range"&&f.jsx("input",{type:"number",value:typeof e=="number"?e.toFixed(2):e,onChange:G=>a(n.id,parseFloat(G.target.value)||0),className:"param-number-input",step:n.step,style:{width:"100%",fontSize:"10px"}})]}),I&&n.type==="range"&&f.jsx("div",{className:"param-anim-settings",style:{marginTop:"5px",padding:"5px",background:"rgba(255,255,255,0.05)",borderRadius:"4px"},children:f.jsx(Zm,{animSettings:D,onChange:G=>l(R,G)})})]})},Sv=({selectedGeneratorId:n,selectedGeneratorParams:e,onParameterChange:a,syncSettings:s={},onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,clipDuration:g,uiState:b,onUpdateUiState:C})=>{const[w,x]=N.useState([]),[M,R]=N.useState([]),[I,H]=N.useState(!1);if(!n)return f.jsx("div",{className:"generator-settings-panel",children:"No generator selected."});const B=Xf.find(G=>G.id===n);if(!B)return f.jsxs("div",{className:"generator-settings-panel",children:["Generator definition not found for ID: ",n]});const D=b?.collapsedPanels||{},j=G=>{C&&C({collapsedPanels:{...D,generator:G}})};N.useEffect(()=>{(async()=>{if(window.electronAPI&&window.electronAPI.getProjectFonts)try{const Y=await window.electronAPI.getProjectFonts();R(Y)}catch(Y){console.error("Failed to load project fonts:",Y)}})()},[]);const _=async G=>{const Y=G.target.value;if(Y==="browse")if(window.electronAPI&&window.electronAPI.showFontFileDialog){const J=await window.electronAPI.showFontFileDialog();J&&a("fontUrl",J)}else console.error("Font file dialog API not available.");else if(Y==="load-system"){H(!0);try{const ae=(await window.electronAPI.getSystemFonts()).map(re=>({name:re.split(/[\\/]/).pop(),path:re})).sort((re,O)=>re.name.localeCompare(O.name));x(ae)}catch(J){console.error("Failed to load system fonts:",J)}H(!1)}else a("fontUrl",Y)};return f.jsx(ea,{title:`${B.name} Settings`,isCollapsed:!!D.generator,onToggle:j,children:B.paramControls.filter(G=>G.condition&&!G.condition(e)?!1:G.showIf?Object.entries(G.showIf).every(([Y,J])=>Array.isArray(J)?J.includes(e[Y]):e[Y]===J):!0).map(G=>{if(G.id==="fontUrl"){const Y=e[G.id]||"src/fonts/Geometr415 Blk BT Black.ttf";return f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{className:"param-label",children:G.label}),f.jsxs("div",{className:"font-selector-container",children:[f.jsxs("select",{className:"param-select",onChange:_,value:Y,children:[M.length>0?f.jsx("optgroup",{label:"Project Fonts",children:M.map(J=>f.jsx("option",{value:J.path,children:J.name},J.path))}):f.jsx("optgroup",{label:"Default Fonts",children:f.jsx("option",{value:"src/fonts/Geometr415 Blk BT Black.ttf",children:"Geometr415"})}),w.length>0?f.jsx("optgroup",{label:"System Fonts",children:w.map(J=>f.jsx("option",{value:J.path,children:J.name},J.path))}):f.jsx("option",{value:"load-system",children:I?"Loading...":"Load System Fonts..."}),f.jsx("optgroup",{label:"Actions",children:f.jsx("option",{value:"browse",children:"Browse File..."})})]}),f.jsx("span",{className:"font-path-tiny",title:Y,children:Y.split(/[\\/]/).pop()})]})]},G.id)}return f.jsx(xv,{control:G,value:e[G.id],onChange:a,syncSettings:s,onSetParamSync:l,layerIndex:o,colIndex:u,progressRef:h,workerId:p,generatorId:n,clipDuration:g,uiState:b,onUpdateUiState:C},G.id)})})},wv=({settings:n,onUpdate:e,uiState:a,onUpdateUiState:s})=>{const{mode:l="fps",duration:o=1,beats:u=8,speedMultiplier:h=1,fps:p=60}=n||{},g=a?.collapsedPanels||{},b=x=>{s&&s({collapsedPanels:{...g,playback:x}})},C=x=>{e({mode:x})},w=(x,M,R=!1)=>{let I=n[x]||(x==="beats"?8:x==="fps"?60:1);R?I=M>1?I*2:I/2:I+=M,I<.01&&(I=.01),e({[x]:I})};return f.jsxs(ea,{title:"Clip Playback",isCollapsed:!!g.playback,onToggle:b,children:[f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:l==="fps"?"active":"button_inactive",onClick:()=>C("fps"),children:"FPS"}),f.jsx("button",{className:l==="timeline"?"active":"button_inactive",onClick:()=>C("timeline"),children:"Timeline"}),f.jsx("button",{className:l==="bpm"?"active":"button_inactive",onClick:()=>C("bpm"),children:"BPM Sync"})]}),f.jsxs("div",{className:"playback-controls",children:[l==="fps"&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed (FPS)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>w("fps",-1),children:"-1"}),f.jsx("input",{type:"number",value:p,onChange:x=>e({fps:parseInt(x.target.value)||60})}),f.jsx("button",{onClick:()=>w("fps",1),children:"+1"}),f.jsx("button",{onClick:()=>w("fps",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>w("fps",2,!0),children:"*2"})]})]}),f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s) (for effects)"}),f.jsx("div",{className:"value-adjuster",children:f.jsx("input",{type:"number",value:o.toFixed(2),onChange:x=>e({duration:parseFloat(x.target.value)||1})})})]})]}),l==="timeline"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Duration (s)"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>w("duration",-1),children:"-1"}),f.jsx("input",{type:"number",value:o.toFixed(2),onChange:x=>e({duration:parseFloat(x.target.value)||1})}),f.jsx("button",{onClick:()=>w("duration",1),children:"+1"}),f.jsx("button",{onClick:()=>w("duration",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>w("duration",2,!0),children:"*2"})]})]}),l==="bpm"&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Beats"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>w("beats",-1),children:"-1"}),f.jsx("input",{type:"number",value:u,onChange:x=>e({beats:parseInt(x.target.value)||1})}),f.jsx("button",{onClick:()=>w("beats",1),children:"+1"}),f.jsx("button",{onClick:()=>w("beats",.5,!0),children:"/2"}),f.jsx("button",{onClick:()=>w("beats",2,!0),children:"*2"})]})]}),(l==="timeline"||l==="bpm")&&f.jsxs("div",{className:"control-group",children:[f.jsx("label",{children:"Speed Multiplier"}),f.jsxs("div",{className:"value-adjuster",children:[f.jsx("button",{onClick:()=>w("speedMultiplier",-.1),children:"-0.1"}),f.jsx("input",{type:"number",value:h.toFixed(2),onChange:x=>e({speedMultiplier:parseFloat(x.target.value)||1})}),f.jsx("button",{onClick:()=>w("speedMultiplier",.1),children:"+0.1"})]})]})]})]})},Jm=N.createContext(),po=()=>N.useContext(Jm),Ev=({children:n})=>{const[e,a]=N.useState(null),[s,l]=N.useState(null),[o,u]=N.useState(null),[h,p]=N.useState({source:"external",lowRange:[20,250],midRange:[250,4e3],highRange:[4e3,2e4],gain:1,holdTime:100,fallTime:500,calculationMode:"average",smoothingTimeConstant:.8}),[g,b]=N.useState({low:0,mid:0,high:0}),C=N.useRef(new Uint8Array(0)),w=N.useRef(new Uint8Array(0)),x=N.useRef({low:0,mid:0,high:0}),M=N.useRef({low:0,mid:0,high:0,lastUpdateTime:Date.now(),peakTimes:{low:0,mid:0,high:0}}),[R,I]=N.useState([]),[H,B]=N.useState("default"),[D,j]=N.useState(1),_=N.useRef({}),G=N.useRef({}),Y=N.useRef({}),J=N.useCallback(async()=>{try{const Me=(await navigator.mediaDevices.enumerateDevices()).filter(ze=>ze.kind==="audiooutput");if(I(Me),window.electronAPI&&window.electronAPI.setAudioDevices){const ze=Me.map(Xe=>({deviceId:Xe.deviceId,label:Xe.label,groupId:Xe.groupId}));window.electronAPI.setAudioDevices(ze)}}catch(we){console.error("Error enumerating audio devices:",we)}},[]);N.useEffect(()=>{J();let we;return window.electronAPI&&window.electronAPI.onUpdateAudioDeviceId&&(we=window.electronAPI.onUpdateAudioDeviceId(Me=>{B(Me)})),navigator.mediaDevices.addEventListener("devicechange",J),()=>{navigator.mediaDevices.removeEventListener("devicechange",J),we&&we()}},[J]);const ae=N.useCallback(we=>{if(!e||!s)return null;try{const Me=e.createMediaElementSource(we);return Me.connect(s),Me.connect(e.destination),Me}catch(Me){return console.warn("MediaElementSource already connected?",Me),null}},[e,s]),re=N.useCallback(async(we,Me,ze=1,Xe=!0)=>{if(_.current[we]&&(_.current[we].pause(),_.current[we].src=""),Y.current[we]=ze,!Me)return;if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(Me))throw new Error(`Audio file not found: ${Me}`);const ot=new Audio(`file:///${Me}`);if(ot.volume=ze*D,H&&ot.setSinkId)try{await ot.setSinkId(H)}catch(At){console.error("Error setting audio sink ID:",At)}if(_.current[we]=ot,e){e.state==="suspended"&&await e.resume();const At=ae(ot);At&&(G.current[we]=At)}if(Xe)try{await ot.play()}catch(At){throw console.error("Error playing audio:",At),At}return ot},[H,ae,D,e]),O=N.useCallback(we=>{j(we),Object.keys(_.current).forEach(Me=>{const ze=_.current[Me],Xe=Y.current[Me]??1;ze&&(ze.volume=we*Xe)})},[]),W=N.useCallback((we,Me)=>{Y.current[we]=Me;const ze=_.current[we];ze&&(ze.volume=Me*D)},[D]),K=N.useCallback(we=>{if(_.current[we]&&(_.current[we].pause(),_.current[we].src="",delete _.current[we],G.current[we])){try{G.current[we].disconnect()}catch{}delete G.current[we]}},[]),Z=N.useCallback(we=>{_.current[we]&&_.current[we].pause()},[]),ee=N.useCallback(async we=>{if(_.current[we]&&_.current[we].paused)try{await _.current[we].play()}catch(Me){console.error("Error resuming:",Me)}},[]),V=N.useCallback(we=>{const Me=Math.max(.0625,Math.min(we,16));Object.values(_.current).forEach(ze=>{try{ze.playbackRate=Me}catch(Xe){console.warn("Failed to set playbackRate:",Xe)}})},[]),te=N.useCallback(we=>{_.current[we]&&(_.current[we].currentTime=0)},[]),ce=N.useCallback((we,Me)=>{_.current[we]&&(_.current[we].currentTime=Me)},[]),xe=N.useCallback(()=>Object.keys(_.current).forEach(K),[K]),$=N.useCallback(()=>Object.keys(_.current).forEach(Z),[Z]),Q=N.useCallback(()=>Object.keys(_.current).forEach(ee),[ee]),ve=N.useCallback(()=>Object.keys(_.current).forEach(te),[te]),Re=N.useCallback(we=>{const Me=_.current[we];return Me?{currentTime:Me.currentTime,duration:Me.duration,paused:Me.paused}:null},[]),Ue=N.useCallback(async()=>{if(e)return;const we=new(window.AudioContext||window.webkitAudioContext),Me=we.createAnalyser();Me.fftSize=2048,Me.smoothingTimeConstant=h.smoothingTimeConstant,C.current=new Uint8Array(Me.frequencyBinCount),w.current=new Uint8Array(Me.frequencyBinCount),we.state==="suspended"&&await we.resume(),a(we),l(Me)},[e,h.smoothingTimeConstant]);return N.useEffect(()=>{const we=()=>{Ue(),window.removeEventListener("mousedown",we),window.removeEventListener("keydown",we)};return window.addEventListener("mousedown",we),window.addEventListener("keydown",we),()=>{window.removeEventListener("mousedown",we),window.removeEventListener("keydown",we)}},[Ue]),N.useEffect(()=>{s&&(s.smoothingTimeConstant=h.smoothingTimeConstant)},[s,h.smoothingTimeConstant]),N.useEffect(()=>{if(!e||!s||h.source!=="external"){o&&(o.disconnect(),u(null));return}let we=null;return(async()=>{try{e.state==="suspended"&&await e.resume(),we=await navigator.mediaDevices.getUserMedia({audio:!0});const ze=e.createMediaStreamSource(we);ze.connect(s),u(ze)}catch(ze){console.error("Failed to get external audio stream:",ze)}})(),()=>{we&&we.getTracks().forEach(ze=>ze.stop())}},[e,s,h.source]),N.useEffect(()=>{if(!s)return;let we;const Me=()=>{s.getByteFrequencyData(C.current),s.getByteTimeDomainData(w.current);const ze=e.sampleRate,Xe=s.frequencyBinCount,ot=ze/s.fftSize,At=rt=>{const Wt=Math.floor(rt[0]/ot),pn=Math.floor(rt[1]/ot);if(h.calculationMode==="peak"){let ke=0;for(let Se=Wt;Se<=pn&&Se<Xe;Se++)C.current[Se]>ke&&(ke=C.current[Se]);return ke/255}else{let ke=0,Se=0;for(let Kt=Wt;Kt<=pn&&Kt<Xe;Kt++)ke+=C.current[Kt],Se++;return Se>0?ke/Se/255:0}},Ct=At(h.lowRange),on=At(h.midRange),Qt=At(h.highRange),cn=Date.now(),je=Math.max(0,cn-M.current.lastUpdateTime);M.current.lastUpdateTime=cn;const Ve=(rt,Wt)=>{let pn=rt*h.gain;const ke=M.current[Wt],Se=M.current.peakTimes[Wt]||0;if(pn>=ke)return M.current.peakTimes[Wt]=cn,pn;{if(cn-Se<h.holdTime)return ke;if(h.fallTime<=0)return 0;const zt=je/h.fallTime,On=ke-zt;return Math.max(0,isNaN(On)?0:On)}},Le={low:Ve(Ct,"low"),mid:Ve(on,"mid"),high:Ve(Qt,"high")};x.current=Le,M.current={...Le,lastUpdateTime:cn,peakTimes:M.current.peakTimes},we=requestAnimationFrame(Me)};return Me(),()=>cancelAnimationFrame(we)},[e,s,h]),f.jsx(Jm.Provider,{value:{audioCtx:e,analyser:s,fftSettings:h,setFftSettings:p,fftLevels:x.current,fftLevelsRef:x,fftDataRef:C,timeDataRef:w,getFftLevels:()=>x.current,connectMediaElement:ae,initAudio:Ue,devices:R,selectedDeviceId:H,setSelectedDeviceId:B,globalVolume:D,setVolume:O,setClipVolume:W,playAudio:re,stopAudio:K,pauseAudio:Z,resumeAudio:ee,setPlaybackRate:V,resetAudio:te,seekAudio:ce,stopAllAudio:xe,pauseAllAudio:$,resumeAllAudio:Q,resetAllAudio:ve,getAudioInfo:Re},children:n})},Av=({audioFile:n,layerIndex:e,onSeek:a,onLoadError:s})=>{const l=N.useRef(null),o=N.useRef(null),{audioCtx:u,getAudioInfo:h}=po(),[p,g]=N.useState(null),[b,C]=N.useState("rgb(255, 94, 0)"),w=N.useRef(null),x=N.useRef(!1),M=N.useRef([]),R=N.useRef(null),I=N.useCallback(()=>{const _=document.createElement("div");_.style.display="none",_.style.color="var(--theme-color)",document.body.appendChild(_);const G=getComputedStyle(_).color;document.body.removeChild(_),G&&G!=="rgba(0, 0, 0, 0)"&&C(G)},[]);N.useEffect(()=>{I();const _=new MutationObserver(I);return _.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class"]}),()=>_.disconnect()},[I]),N.useEffect(()=>{if(!n?.path||!u)return;let _=!0;const G=async()=>{try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(n.path))throw new Error(`File not found: ${n.path}`);const Y=await fetch(`file:///${n.path}`);if(!Y.ok)throw new Error(`HTTP error! status: ${Y.status}`);const J=await Y.arrayBuffer();if(!_)return;const ae=await u.decodeAudioData(J);if(_){const re=ae.getChannelData(0),O=[],W=Math.max(1,Math.floor(re.length/500));for(let K=0;K<re.length;K+=W){let Z=1,ee=-1;for(let V=0;V<W&&K+V<re.length;V++){const te=re[K+V];te<Z&&(Z=te),te>ee&&(ee=te)}O.push({min:Z,max:ee})}M.current=O,R.current=null,g(ae)}}catch(Y){if(!_)return;console.error("Failed to load/decode audio for waveform:",Y),s&&s(Y)}};return g(null),G(),()=>{_=!1}},[n,u,s]);const H=N.useCallback((_,G,Y,J)=>{const ae=M.current;if(!ae||ae.length===0)return;const re=Y/2,O=2,K=O+1;if(!R.current||R.current.width!==G||R.current.height!==Y){const ee=document.createElement("canvas");ee.width=G,ee.height=Y;const V=ee.getContext("2d");let te=b;b.startsWith("rgb(")&&(te=b.replace("rgb","rgba").replace(")",", 0.2)")),V.fillStyle=te;const ce=Math.ceil(G/K);for(let xe=0;xe<ce;xe++){const $=Math.floor(xe/ce*ae.length),Q=ae[$],ve=(1+Q.min)*re,Re=Math.max(1,(Q.max-Q.min)*re);V.fillRect(xe*K,ve,O,Re)}R.current=ee}_.clearRect(0,0,G,Y),_.drawImage(R.current,0,0);const Z=G*J;if(Z>0){_.save(),_.beginPath(),_.rect(0,0,Z,Y),_.clip(),_.fillStyle=b;const ee=Math.ceil(G/K);for(let V=0;V<ee;V++){const te=V*K;if(te>Z)break;const ce=Math.floor(V/ee*ae.length),xe=ae[ce],$=(1+xe.min)*re,Q=Math.max(1,(xe.max-xe.min)*re);_.fillRect(te,$,O,Q)}_.restore()}_.fillStyle="#ffffff",_.fillRect(Z,0,1,Y)},[b]);N.useEffect(()=>{const _=l.current;if(!_||!p)return;const G=_.getContext("2d"),Y=()=>{const J=_.getBoundingClientRect();(_.width!==J.width||_.height!==J.height)&&(_.width=J.width,_.height=J.height,R.current=null);const ae=_.width,re=_.height;let O=0;if(e!=null){const W=h(e);W&&W.duration>0&&(O=W.currentTime/W.duration)}H(G,ae,re,Math.max(0,Math.min(1,O))),w.current=requestAnimationFrame(Y)};return Y(),()=>{w.current&&cancelAnimationFrame(w.current)}},[p,e,h,H]);const B=_=>{x.current=!0,j(_),window.addEventListener("mouseup",D),window.addEventListener("mousemove",j)},D=()=>{x.current=!1,window.removeEventListener("mouseup",D),window.removeEventListener("mousemove",j)},j=_=>{if(!l.current||!p)return;const G=l.current.getBoundingClientRect(),Y=_.clientX-G.left,J=G.width,re=Math.max(0,Math.min(1,Y/J))*p.duration;a&&a(re)};return f.jsx("div",{ref:o,className:"wave-player-container",style:{width:"100%",height:"35px",marginBottom:"10px",background:"transparent",borderRadius:"4px",overflow:"hidden"},onMouseDown:B,children:f.jsx("canvas",{ref:l,style:{width:"100%",height:"100%",display:"block",cursor:"pointer"}})})},Tv=({selectedLayerIndex:n,selectedColIndex:e,clip:a,audioInfo:s,bpm:l,getFftLevels:o,onAssignAudio:u,onRemoveAudio:h,onUpdateAudioVolume:p,onUpdatePlaybackSettings:g,onSetParamSync:b,onToggleDacMirror:C,onRemoveDac:w,onRemoveEffect:x,onReorderEffects:M,onAddEffect:R,onParameterChange:I,onGeneratorParameterChange:H,onUpdateClipUiState:B,progressRef:D,onAudioError:j})=>{const[_,G]=N.useState({}),[Y,J]=N.useState(null),{seekAudio:ae}=po(),re=N.useRef(0),O=a?.uiState||{},W=O.collapsedPanels||{},K=(je,Ve)=>{B&&B(n,e,{collapsedPanels:{...W,[je]:Ve}})},Z=Yn.useCallback(je=>{j&&j(n,e)},[j,n,e]);if(N.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(Ve=>{G(Le=>({...Le,[Ve.ip]:Ve.status}))})},[]),n===null||e===null)return f.jsx("div",{className:"clip-settings-panel settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a clip to view settings."})});const ee=je=>{je.preventDefault(),je.stopPropagation();try{const Ve=je.dataTransfer.getData("application/json");if(!Ve)return;const Le=JSON.parse(Ve);Le&&Le.type&&R&&R(Le)}catch(Ve){console.error("Failed to drop effect in ClipSettingsPanel:",Ve)}},V=je=>{je.preventDefault(),je.dataTransfer.dropEffect="copy"},te=je=>{J(je)},ce=(je,Ve)=>{if(je.preventDefault(),Y===null||Y===Ve)return;const Le=Date.now();Le-re.current<200||(re.current=Le,M&&(M(n,e,Y,Ve),J(Ve)))},xe=je=>{J(null)},{effects:$=[],assignedDacs:Q=[],playbackSettings:ve={},syncSettings:Re={},audioFile:Ue=null,audioVolume:we=1,type:Me=null,generatorDefinition:ze=null,currentParams:Xe={},workerId:ot=null}=a||{},At=$.length>0,Ct=Me==="generator"&&!!ze,on=Q.length>0;let Qt=1;if(ve.mode==="timeline")Qt=ve.duration||1;else if(ve.mode==="bpm"){const je=l||120;Qt=(ve.beats||8)*60/je}else{const je=ve.fps||a?.fps||30;Qt=(a?.totalFrames||30)/je}const cn=ot||(Me==="ilda"?`ilda-${n}-${e}`:Me==="generator"?`generator-${n}-${e}`:null);return s&&s.duration&&s.currentTime/s.duration*100,f.jsxs("div",{className:"clip-settings-panel settings-panel-base",onDrop:ee,onDragOver:V,children:[f.jsx(ea,{title:"Audio",isCollapsed:!!W.audio,onToggle:je=>K("audio",je),children:Ue?f.jsxs("div",{className:"assigned-audio-info",style:{position:"relative"},children:[f.jsx("button",{className:"remove-effect-btn",onClick:h,style:{position:"absolute",top:"-5px",right:"-5px",fontSize:"14px"},children:""}),f.jsx("div",{className:"audio-file-name",title:Ue.path,style:{paddingRight:"15px",marginBottom:"8px",fontSize:"11px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:Ue.name}),f.jsx(Av,{audioFile:Ue,audioInfo:s,layerIndex:n,onSeek:je=>ae(n,je),onLoadError:Z}),f.jsxs("div",{className:"audio-volume-control",style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"10px",display:"block",marginBottom:"2px"},children:["Volume: ",Math.round(we*100),"%"]}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:we,onChange:je=>p(n,e,parseFloat(je.target.value)),className:"slider_hor",style:{width:"100%",height:"4px"}})]})]}):f.jsx("button",{className:"assign-audio-btn",onClick:u,children:"Assign Audio File"})}),f.jsx(wv,{settings:ve,onUpdate:je=>g(n,e,je),uiState:O,onUpdateUiState:je=>B(n,e,je)}),on&&f.jsx(ea,{title:"Assigned DACs",isCollapsed:!!W.dacs,onToggle:je=>K("dacs",je),children:f.jsx("ul",{className:"assigned-dacs-list",children:Q.map((je,Ve)=>{const Le=_[je.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[je.hostName||je.ip," - Ch ",je.channel]}),Le&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",Le.playback_state===2?"PLAYING":Le.playback_state===1?"PREPARED":"IDLE"," | Buf: ",Le.buffer_fullness,Le.buffer_capacity?`/${Le.buffer_capacity}`:""," | PPS: ",Le.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${je.mirrorX?"active":""}`,onClick:()=>C(n,e,Ve,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${je.mirrorY?"active":""}`,onClick:()=>C(n,e,Ve,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>w(Ve),children:""})]},`${je.unitID||je.ip}-${je.channel}-${Ve}`)})})}),Ct&&f.jsx(Sv,{selectedGeneratorId:ze.id,selectedGeneratorParams:Xe,onParameterChange:H,syncSettings:Re,onSetParamSync:b,layerIndex:n,colIndex:e,progressRef:D,workerId:cn,clipDuration:Qt,bpm:l,getFftLevels:o,uiState:O,onUpdateUiState:je=>B(n,e,je)}),f.jsx(ea,{title:"Clip Effects",isCollapsed:!!W.effects,onToggle:je=>K("effects",je),children:f.jsx("div",{className:"clip-effects-list",style:{minHeight:"50px"},onDrop:xe,children:At?$.map((je,Ve)=>f.jsx("div",{onDragOver:Le=>ce(Le,Ve),style:{marginBottom:"4px"},children:f.jsx(Km,{effect:je,assignedDacs:Q,syncSettings:Re,onSetParamSync:b,context:{layerIndex:n,colIndex:e,effectIndex:Ve,targetType:"effect",workerId:cn},onParamChange:(Le,rt)=>I(n,e,Ve,Le,rt),onRemove:()=>x(n,e,Ve),progressRef:D,clipDuration:Qt,bpm:l,getFftLevels:o,uiState:O,onUpdateUiState:Le=>B(n,e,Le),dragHandle:f.jsx("div",{draggable:!0,onDragStart:()=>te(Ve),style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},je.instanceId||je.id+Ve)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Cv=({selectedLayerIndex:n,autopilotMode:e,onAutopilotChange:a,layerEffects:s,assignedDacs:l=[],onToggleDacMirror:o,onRemoveDac:u,onAddEffect:h,onRemoveEffect:p,onParamChange:g,uiState:b,onUpdateUiState:C})=>{const[w,x]=N.useState({}),M=b?.collapsedPanels||{},R=(B,D)=>{C&&C({collapsedPanels:{...M,[B]:D}})};if(N.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onDacStatus)return window.electronAPI.onDacStatus(D=>{x(j=>({...j,[D.ip]:D.status}))})},[]),n===null)return f.jsx("div",{className:"settings-panel-base",children:f.jsx("p",{className:"info-text",children:"Select a layer to edit settings"})});const I=B=>{B.preventDefault(),B.stopPropagation();try{const D=JSON.parse(B.dataTransfer.getData("application/json"));D&&D.id&&h(D)}catch(D){console.error("Failed to drop effect:",D)}},H=B=>{B.preventDefault(),B.dataTransfer.dropEffect="copy"};return f.jsxs("div",{className:"settings-panel-base",onDrop:I,onDragOver:H,children:[l&&l.length>0&&f.jsx(ea,{title:"Assigned DACs",isCollapsed:!!M.dacs,onToggle:B=>R("dacs",B),children:f.jsx("ul",{className:"assigned-dacs-list",children:l.map((B,D)=>{const j=w[B.ip];return f.jsxs("li",{className:"assigned-dac-item",children:[f.jsxs("div",{className:"dac-info-block",children:[f.jsxs("span",{className:"dac-name-tiny",children:[B.hostName||B.ip," - Ch ",B.channel]}),j&&f.jsxs("div",{className:"dac-status-tiny",style:{fontSize:"9px",color:"#888"},children:["State: ",j.playback_state===2?"PLAYING":j.playback_state===1?"PREPARED":"IDLE"," | Buf: ",j.buffer_fullness,j.buffer_capacity?`/${j.buffer_capacity}`:""," | PPS: ",j.point_rate]})]}),f.jsxs("div",{className:"dac-mirror-controls",children:[f.jsx("button",{className:`mirror-btn ${B.mirrorX?"active":""}`,onClick:()=>o(n,D,"x"),title:"Mirror X Axis",children:"X"}),f.jsx("button",{className:`mirror-btn ${B.mirrorY?"active":""}`,onClick:()=>o(n,D,"y"),title:"Mirror Y Axis",children:"Y"})]}),f.jsx("button",{className:"remove-dac-btn",onClick:()=>u(n,D),children:""})]},`${B.unitID||B.ip}-${B.channel}-${D}`)})})}),f.jsx(ea,{title:`Layer ${n+1} Autopilot`,isCollapsed:!!M.autopilot,onToggle:B=>R("autopilot",B),children:f.jsxs("div",{className:"param-editor",children:[f.jsx("label",{children:"Mode"}),f.jsx("div",{className:"clip-playback-settings",children:f.jsxs("div",{className:"playback-mode-selector",children:[f.jsx("button",{className:e==="off"?"active":"",onClick:()=>a("off"),children:"OFF"}),f.jsx("button",{className:e==="forward"?"active":"",onClick:()=>a("forward"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-forward-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m9.77 12.11 4.012-2.953a.647.647 0 0 0 0-1.114L9.771 5.09a.644.644 0 0 0-.971.557V6.65H2v3.9h6.8v1.003c0 .505.545.808.97.557"})})}),f.jsx("button",{className:e==="random"?"active":"",onClick:()=>a("random"),children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[f.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),f.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})})]})})]})}),f.jsx(ea,{title:"Layer Effects",isCollapsed:!!M.effects,onToggle:B=>R("effects",B),children:f.jsx("div",{className:"layer-effects-list",style:{minHeight:"50px"},children:s&&s.length>0?s.map((B,D)=>f.jsx("div",{style:{marginBottom:"4px"},children:f.jsx(Km,{effect:B,onRemove:()=>p(D),onParamChange:(j,_)=>g(D,j,_),syncSettings:{},onSetParamSync:()=>{},context:{layerIndex:n,colIndex:null,effectIndex:D,targetType:"layerEffect"},uiState:b,onUpdateUiState:C,dragHandle:f.jsx("div",{draggable:!0,onDragStart:j=>{j.dataTransfer.setData("application/json",JSON.stringify({type:"effect-reorder",index:D,layerIndex:n}))},style:{cursor:"grab",marginRight:"5px",display:"flex",alignItems:"center",color:"#666"},title:"Drag to reorder",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})})})},B.instanceId||D)):f.jsx("div",{className:"info-text",style:{padding:"20px",border:"1px dashed #444",borderRadius:"5px"},children:"Drag Effects Here"})})})]})},Mv=({message:n,visible:e})=>e?f.jsx("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#333",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:1e3,opacity:e?1:0,transition:"opacity 0.5s ease-in-out"},children:n}):null,eg=N.createContext(null),tg=()=>N.useContext(eg),Nv=({children:n,onWorkerMessage:e})=>{const a=N.useRef(null);return a.current===null&&(a.current=new Worker(new URL(""+new URL("rendering.worker-DNKCDvdt.js",import.meta.url).href,import.meta.url),{type:"module"})),N.useEffect(()=>{const s=a.current;return e&&(s.onmessage=e),()=>{s.terminate(),e&&(s.onmessage=null)}},[e]),f.jsx(eg.Provider,{value:a.current,children:n})},kv=({frame:n,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p={},bpm:g=120,clipDuration:b=1,progress:C=0,previewTime:w=0,fftLevels:x={low:0,mid:0,high:0},effectStates:M=null,optimizationEnabled:R=!0,onToggleBeamEffect:I,onCycleDisplayMode:H})=>{const B=N.useRef(null),D=tg(),j=N.useRef(`ilda-player-${Math.random()}`);return N.useEffect(()=>{const _=B.current;if(!_||!D)return;const G=_.transferControlToOffscreen();return D.postMessage({action:"register",payload:{id:j.current,canvas:G,type:"single",data:{showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p,bpm:g,clipDuration:b,progress:C,previewTime:w,fftLevels:x,effectStates:M,optimizationEnabled:R}}},[G]),()=>{D.postMessage({action:"deregister",payload:{id:j.current}})}},[]),N.useEffect(()=>{if(!D)return;const _=n?[n]:[];D.postMessage({action:"update",payload:{id:j.current,data:{ildaFrames:_,effects:e,showBeamEffect:a,beamAlpha:s,fadeAlpha:l,previewScanRate:o,beamRenderMode:u,intensity:h,syncSettings:p,bpm:g,clipDuration:b,progress:C,previewTime:w,fftLevels:x,effectStates:M,optimizationEnabled:R}}})},[D,n,e,a,s,l,o,u,h,p,g,b,C,w,x,M,R]),f.jsxs("div",{className:"ilda-player",children:[f.jsx("h3",{children:"Selected Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:I,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:H,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:B,width:"300",height:"300",style:{backgroundColor:"black"}})]})},Rv=Yn.memo(kv),Dv=({activeFrames:n,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:h,dacSettings:p,previewTime:g=0,fftLevels:b={low:0,mid:0,high:0},optimizationEnabled:C=!0,onToggleBeamEffect:w,onCycleDisplayMode:x})=>{const M=N.useRef(null),R=tg(),I=N.useRef(`world-preview-${Math.random()}`);return N.useEffect(()=>{const H=M.current;if(!H||!R)return;const B=H.transferControlToOffscreen();return R.postMessage({action:"register",payload:{id:I.current,canvas:B,type:"world",data:{showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,previewTime:g,fftLevels:b,optimizationEnabled:C}}},[B]),()=>{R.postMessage({action:"deregister",payload:{id:I.current}})}},[]),N.useEffect(()=>{if(!R)return;const H=Object.entries(n).map(([B,{frame:D,effects:j,layerIndex:_,syncSettings:G,bpm:Y,clipDuration:J,progress:ae,effectStates:re}])=>({frames:[D],effects:j,workerId:B,layerIndex:_,syncSettings:G,bpm:Y,clipDuration:J,progress:ae,effectStates:re}));R.postMessage({action:"update",payload:{id:I.current,data:{worldData:H,showBeamEffect:e,beamAlpha:a,fadeAlpha:s,previewScanRate:l,beamRenderMode:o,layerIntensities:u,masterIntensity:h,dacSettings:p,previewTime:g,fftLevels:b,optimizationEnabled:C}}})},[R,n,e,a,s,l,o,u,h,p,g,b,C]),f.jsxs("div",{className:"world-preview",children:[f.jsx("h3",{children:"World Preview"}),f.jsxs("div",{className:"renderSettingToggle",children:[f.jsx("button",{onClick:w,title:"Toggle 2D/3D (Beam Effect)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-badge-3d",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M4.52 8.368h.664c.646 0 1.055.378 1.06.9.008.537-.427.919-1.086.919-.598-.004-1.037-.325-1.068-.756H3c.03.914.791 1.688 2.153 1.688 1.24 0 2.285-.66 2.272-1.798-.013-.953-.747-1.38-1.292-1.432v-.062c.44-.07 1.125-.527 1.108-1.375-.013-.906-.8-1.57-2.053-1.565-1.31.005-2.043.734-2.074 1.67h1.103c.022-.391.383-.751.936-.751.532 0 .928.33.928.813.004.479-.383.835-.928.835h-.632v.914zm3.606-3.367V11h2.189C12.125 11 13 9.893 13 7.985c0-1.894-.861-2.984-2.685-2.984zm1.187.967h.844c1.112 0 1.621.686 1.621 2.04 0 1.353-.505 2.02-1.621 2.02h-.844z"}),f.jsx("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"})]})}),f.jsx("button",{onClick:x,title:"Cycle Display Mode (Points/Lines)",style:{background:"transparent",border:"none",cursor:"pointer",color:"#aaa"},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-three-dots",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"})})})]}),f.jsx("canvas",{ref:M,width:"300",height:"300",style:{backgroundColor:"black"}})]})},_v=({bpm:n,onBpmChange:e})=>{const[a,s]=N.useState([]),[l,o]=N.useState(n);N.useEffect(()=>{o(n)},[n]);const u=()=>{const p=Date.now(),g=[...a,p].slice(-4);if(s(g),g.length>=2){const b=[];for(let x=1;x<g.length;x++)b.push(g[x]-g[x-1]);const C=b.reduce((x,M)=>x+M)/b.length,w=Math.round(6e4/C);e(w)}},h=p=>{const g=parseFloat(p.target.value);o(p.target.value),!isNaN(g)&&g>0&&g<999&&e(g)};return f.jsx("div",{className:"bpm-controls",children:f.jsxs("div",{className:"bpm-display",children:[f.jsx($t,{id:"bpm_tap",children:f.jsx("button",{className:"bpm-tap-btn",onClick:u,children:"TAP"})}),f.jsxs("div",{className:"bpm-fine-controls",children:[f.jsx($t,{id:"bpm_fine_down",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.max(1,n-.1)),children:"-"})}),f.jsx($t,{id:"bpm_value",children:f.jsx("input",{type:"number",className:"bpm-input",value:l,onChange:h,min:"1",max:"999",step:"0.1"})}),f.jsx($t,{id:"bpm_fine_up",children:f.jsx("button",{className:"bpm-fine-btn",onClick:()=>e(Math.min(999,n+.1)),children:"+"})})]}),f.jsx("span",{className:"bpm-label",children:"BPM"})]})})},Ov=({onPlay:n,onPause:e,onStop:a,isPlaying:s,isStopped:l})=>{const o=(u,h)=>{u.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:h,targetType:"transport",label:h.toUpperCase()}))};return f.jsxs("div",{className:"transport-controls",children:[f.jsx($t,{id:"transport_play",children:f.jsx("button",{className:`speed-control-button ${s?"active":""}`,onClick:n,draggable:!0,onDragStart:u=>o(u,"play"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-play-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"})})})}),f.jsx($t,{id:"transport_pause",children:f.jsx("button",{className:`speed-control-button ${!s&&!l?"active":""}`,onClick:e,draggable:!0,onDragStart:u=>o(u,"pause"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pause-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"})})})}),f.jsx($t,{id:"transport_stop",children:f.jsx("button",{className:`speed-control-button ${l?"active":""}`,onClick:a,draggable:!0,onDragStart:u=>o(u,"stop"),children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-stop-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5"})})})})]})},Iv=({value:n,onToggle:e,label:a,onDrop:s,isAssigned:l,onContextMenu:o,className:u,...h})=>{const p=b=>{b.preventDefault(),b.dataTransfer.dropEffect="link"},g=b=>{b.preventDefault();try{const C=b.dataTransfer.getData("application/x-truelazer-param");console.log("[QuickButton] Dropped Data Raw:",C);const w=JSON.parse(C);console.log("[QuickButton] Dropped Data Parsed:",w),w&&(w.type==="toggle"||w.type==="checkbox")?s(w):console.warn("[QuickButton] Invalid data type for button:",w?.type)}catch(C){console.error("[QuickButton] Drop Error:",C)}};return f.jsx("div",{className:`quick-assign-button ${n?"active":""} ${l?"":"unassigned"} ${u||""}`.trim(),style:{cursor:l?"pointer":"default",userSelect:"none",width:"90%",opacity:l?1:.5},onDragOver:p,onDrop:g,onContextMenu:o,...h,onClick:l?e:b=>b.preventDefault(),children:f.jsx("div",{className:"button-label",title:a||"Empty",children:a||"Assign"})})},Lv=({assigns:n,onUpdateKnob:e,onToggleButton:a,onAssign:s})=>{const l=(o,u,h)=>{o.preventDefault(),window.electronAPI&&window.electronAPI.showQuickAssignContextMenu&&window.electronAPI.showQuickAssignContextMenu(u,h)};return f.jsxs("div",{className:"global-quick-assigns-panel",children:[f.jsx("div",{className:"quick-assigns-row knobs-row",children:Array.from({length:8}).map((o,u)=>{const h=!!n.knobs[u].link;return f.jsx($t,{id:`quick_knob_${u}`,children:f.jsx(bi,{value:n.knobs[u]?.value||0,label:n.knobs[u]?.label,isAssigned:h,onChange:p=>h&&e(u,p),onContextMenu:p=>l(p,"knob",u),onDrop:p=>{console.log(`[GlobalQuickAssigns] Knob ${u} Drop Data:`,p),s("knob",u,p)}})},`knob-${u}`)})}),f.jsx("div",{className:"quick-assigns-row buttons-row",children:Array.from({length:8}).map((o,u)=>{const h=!!n.buttons[u].link;return f.jsx($t,{id:`quick_btn_${u}`,children:f.jsx(Iv,{value:n.buttons[u]?.value||!1,label:n.buttons[u]?.label,isAssigned:h,onToggle:()=>a(u),onContextMenu:p=>l(p,"button",u),onDrop:p=>{console.log(`[GlobalQuickAssigns] Button ${u} Drop Data:`,p),s("button",u,p)}})},`btn-${u}`)})})]})},Uv=({enabledShortcuts:n={},onOpenOutputSettings:e,quickAssigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o,renderSettings:u={},onSetRenderSetting:h})=>{const{midiInitialized:p,midiInputs:g,selectedMidiInputId:b,setSelectedMidiInputId:C,isMapping:w,startMapping:x,stopMapping:M,learningId:R,lastMidiEvent:I,setMappings:H,saveMappings:B,exportMappings:D,importMappings:j}=Ic(),_=u.settingsPanelCollapsed||{},G=(ke,Se)=>{h&&h("settingsPanelCollapsed",{..._,[ke]:Se})},{artnetInitialized:Y,isMapping:J,startMapping:ae,stopMapping:re,setMappings:O,saveMappings:W,exportMappings:K,importMappings:Z,lastDmxEvent:ee}=sd()||{},{isMapping:V,startMapping:te,stopMapping:ce,setMappings:xe,saveMappings:$,exportMappings:Q,importMappings:ve}=id()||{},[Re,Ue]=N.useState([]),[we,Me]=N.useState(""),[ze,Xe]=N.useState(!1),[ot,At]=N.useState(57121),[Ct,on]=N.useState("127.0.0.1"),[Qt,cn]=N.useState(57120),[je,Ve]=N.useState(null);N.useEffect(()=>{const ke=async()=>{if(n.artnet)try{const zt=await window.electronAPI.getArtnetUniverses();Ue(zt),zt.length>0&&Me(zt[0].id)}catch(zt){console.error("Failed to fetch Art-Net universes:",zt)}},Se=async()=>{if(n.osc)try{if((await window.electronAPI.initializeOsc({localPort:ot,remoteAddress:Ct,remotePort:Qt})).success)return Xe(!0),window.electronAPI.onOscMessageReceived(({oscMessage:Gt})=>{Ve(Gt)})}catch(zt){console.error("Failed to initialize OSC:",zt)}};let Kt=()=>{};return ke(),Se().then(zt=>{typeof zt=="function"&&(Kt=zt)}),()=>{typeof Kt=="function"&&Kt()}},[n]);const Le=ke=>C(ke.target.value),rt=()=>w?M():x(),Wt=()=>J?re():ae(),pn=()=>V?ce():te();return f.jsxs("div",{className:"settings-panel settings-panel-base",children:[f.jsx("div",{className:"settings-card-header",children:f.jsx("h4",{children:"Global Settings"})}),a&&f.jsx(ea,{title:"Quick Assigns",isCollapsed:!!_.quickAssigns,onToggle:ke=>G("quickAssigns",ke),children:f.jsx(Lv,{assigns:a,onUpdateKnob:s,onToggleButton:l,onAssign:o})}),f.jsxs(ea,{title:"Channel/DAC Settings",isCollapsed:!!_.dacSettings,onToggle:ke=>G("dacSettings",ke),children:[f.jsx("p",{className:"info-text",children:"Output routing and safety zones configuration."}),f.jsx("button",{className:"small-btn",style:{width:"100%",marginTop:"5px"},onClick:e,children:"Open Output Settings"})]}),f.jsxs(ea,{title:"Processing",isCollapsed:!!_.processing,onToggle:ke=>G("processing",ke),children:[f.jsxs("div",{className:"param-editor",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("label",{className:"param-label",style:{fontSize:"11px"},children:"Point Optimization"}),f.jsx("input",{type:"checkbox",checked:u.optimizationEnabled,onChange:ke=>h("optimizationEnabled",ke.target.checked)})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:"Optimizes geometry (interpolation/dwell) before applying effects. Fixes lines in Delay effect but increases point count."})]}),(n.midi||n.artnet||n.osc||n.keyboard)&&f.jsxs("div",{className:"shortcuts-settings-panel",children:[n.keyboard&&f.jsx(ea,{title:"Keyboard Shortcuts",isCollapsed:!!_.keyboard,onToggle:ke=>G("keyboard",ke),children:f.jsxs("div",{className:"keyboard-config",children:[f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${V?"active":""}`,onClick:pn,style:{backgroundColor:V?"var(--theme-color)":"",gridColumn:"span 2"},children:V?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:$,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:Q,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:ve,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>xe({}),children:"Clear"})]}),f.jsx("p",{className:"info-text",style:{fontSize:"9px",color:"#666",marginTop:"5px"},children:'Assign keys to buttons/sliders by activating "Start Mapping" and clicking a control.'})]})}),n.midi&&f.jsx(ea,{title:"MIDI Shortcuts",isCollapsed:!!_.midi,onToggle:ke=>G("midi",ke),children:p?f.jsxs("div",{className:"midi-config",children:[f.jsx("select",{className:"param-select",value:b,onChange:Le,style:{marginBottom:"8px",width:"100%"},children:g.map(ke=>f.jsx("option",{value:ke.id,children:ke.name},ke.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${w?"active":""}`,onClick:rt,style:{backgroundColor:w?"var(--theme-color)":"",gridColumn:"span 2"},children:w?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:B,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:D,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:j,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>H({}),children:"Clear"})]}),I&&f.jsxs("div",{className:"last-event-status",children:[I.type," ",I.note||I.controller," (CH",I.channel,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing MIDI..."})}),n.artnet&&f.jsx(ea,{title:"ArtNet Shortcuts",isCollapsed:!!_.artnet,onToggle:ke=>G("artnet",ke),children:Y?f.jsxs("div",{className:"artnet-config",children:[f.jsx("select",{className:"param-select",value:we,onChange:ke=>{Me(ke.target.value);const Se=parseInt(ke.target.value.replace("universe-",""));window.electronAPI&&window.electronAPI.listenArtnetUniverse&&window.electronAPI.listenArtnetUniverse(Se)},style:{marginBottom:"8px",width:"100%"},children:Re.map(ke=>f.jsx("option",{value:ke.id,children:ke.name},ke.id))}),f.jsxs("div",{className:"button-grid",children:[f.jsx("button",{className:`mapping-btn ${J?"active":""}`,onClick:Wt,style:{backgroundColor:J?"var(--theme-color)":"",gridColumn:"span 2"},children:J?"Stop Mapping":"Start Mapping"}),f.jsx("button",{className:"small-btn",onClick:W,children:"Save Default"}),f.jsx("button",{className:"small-btn",onClick:K,children:"Export"}),f.jsx("button",{className:"small-btn",onClick:Z,children:"Import"}),f.jsx("button",{className:"small-btn clear",onClick:()=>O({}),children:"Clear"})]}),ee&&f.jsxs("div",{className:"last-event-status",children:["UNIV ",ee.universe," CH ",ee.channel+1," (Val: ",ee.value,")"]})]}):f.jsx("p",{className:"loading-text",children:"Initializing Art-Net..."})}),n.osc&&f.jsx(ea,{title:"OSC Shortcuts",isCollapsed:!!_.osc,onToggle:ke=>G("osc",ke),children:f.jsx("div",{className:"osc-config",children:f.jsxs("p",{className:"info-text",children:["Listening on port: ",ot]})})})]})]})},jv=({show:n,title:e,initialValue:a,onSave:s,onClose:l})=>{const[o,u]=N.useState(a||"");if(N.useEffect(()=>{n&&u(a||"")},[n,a]),!n)return null;const h=()=>{s(o),l()},p=g=>{g.key==="Enter"&&h(),g.key==="Escape"&&l()};return f.jsx("div",{className:"shortcuts-modal-overlay",style:{pointerEvents:"auto"},children:f.jsxs("div",{className:"shortcuts-modal-content",style:{maxWidth:"400px"},children:[f.jsx("h3",{children:e||"Rename"}),f.jsxs("div",{className:"settings-section",style:{border:"none"},children:[f.jsx("input",{type:"text",value:o,onChange:g=>u(g.target.value),onKeyDown:p,autoFocus:!0,style:{width:"100%",padding:"8px",backgroundColor:"#1a1a1a",color:"white",border:"1px solid var(--theme-color)",borderRadius:"4px",marginBottom:"15px"}}),f.jsxs("div",{className:"button-row",style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[f.jsx("button",{onClick:l,children:"Cancel"}),f.jsx("button",{onClick:h,style:{backgroundColor:"var(--theme-color)",color:"black"},children:"Save"})]})]})]})})},Bv=({safetyZones:n,outputArea:e,testLineY:a,testLineEnabled:s,transformationEnabled:l,transformationMode:o,flipX:u,flipY:h,onUpdateSafetyZones:p,onUpdateOutputArea:g,selectedZoneIndex:b,onSelectZone:C,gridSize:w=20,snapToGrid:x=!1})=>{const M=N.useRef(null),[R,I]=N.useState(null),H=(O,W,K)=>{O.strokeStyle="#333",O.lineWidth=1,O.beginPath();for(let Z=0;Z<=w;Z++){const ee=Z/w,V=ee*W,te=ee*K;O.moveTo(V,0),O.lineTo(V,K),O.moveTo(0,te),O.lineTo(W,te)}O.stroke(),O.strokeStyle="#666",O.lineWidth=2,O.beginPath(),O.moveTo(W/2,0),O.lineTo(W/2,K),O.moveTo(0,K/2),O.lineTo(W,K/2),O.stroke(),O.fillStyle="#aaa",O.font="10px monospace",O.fillText("0,0",5,12),O.fillText("1,0",W-25,12),O.fillText("0,1",5,K-5),O.fillText("1,1",W-25,K-5)},B=(O,W,K,Z=!1,ee=!1)=>{const{x:V,y:te,w:ce,h:xe}=W;if(O.fillStyle=K,O.fillRect(V,te,ce,xe),O.strokeStyle=Z?"#fff":ee?"#0089ff":"#ff0000",O.lineWidth=Z?2:1,O.strokeRect(V,te,ce,xe),Z||ee){O.fillStyle="#fff";const Q=(Ue,we)=>O.fillRect(Ue-6/2,we-6/2,6,6);Q(V,te),Q(V+ce,te),Q(V,te+xe),Q(V+ce,te+xe);const ve=4;O.fillStyle="#ccc";const Re=(Ue,we)=>O.fillRect(Ue-ve/2,we-ve/2,ve,ve);Re(V+ce/2,te),Re(V+ce/2,te+xe),Re(V,te+xe/2),Re(V+ce,te+xe/2)}},D=()=>{const O=M.current;if(!O)return;const W=O.getContext("2d"),{width:K,height:Z}=O;if(W.clearRect(0,0,K,Z),H(W,K,Z),l&&e&&B(W,{x:e.x*K,y:e.y*Z,w:e.w*K,h:e.h*Z},"rgba(0, 137, 255, 0.2)",!1,!0),n.forEach((ee,V)=>{B(W,{x:ee.x*K,y:ee.y*Z,w:ee.w*K,h:ee.h*Z},"rgba(255, 0, 0, 0.3)",V===b)}),s){let ee=a,V=0,te=1;if(l&&e){if(o==="scale")V=e.x,te=e.x+e.w,ee=e.y+ee*e.h;else if(o==="crop"){if(ee<e.y||ee>e.y+e.h)return;V=Math.max(0,e.x),te=Math.min(1,e.x+e.w)}}const ce=ee*Z,xe=V*K,$=te*K;let Q=[[xe,$]];n&&n.length>0&&n.forEach(ve=>{const Re=ve.y*Z,Ue=ve.h*Z,we=ve.x*K,Me=ve.w*K;if(ce>=Re&&ce<=Re+Ue){const ze=[];Q.forEach(Xe=>{const[ot,At]=Xe,Ct=we,on=we+Me;on<=ot||Ct>=At?ze.push(Xe):(Ct>ot&&ze.push([ot,Ct]),on<At&&ze.push([on,At]))}),Q=ze}}),W.strokeStyle="#00ff00",W.lineWidth=2,W.beginPath(),Q.forEach(ve=>{W.moveTo(ve[0],ce),W.lineTo(ve[1],ce)}),W.stroke()}};N.useEffect(()=>{D()},[n,e,a,s,l,b,w,u,h]);const j=O=>{const W=M.current.getBoundingClientRect();return{x:(O.clientX-W.left)/W.width,y:(O.clientY-W.top)/W.height}},_=(O,W,K)=>{if(!K)return null;const Z=.03;return Math.abs(O-K.x)<Z&&Math.abs(W-K.y)<Z?"nw":Math.abs(O-(K.x+K.w))<Z&&Math.abs(W-K.y)<Z?"ne":Math.abs(O-K.x)<Z&&Math.abs(W-(K.y+K.h))<Z?"sw":Math.abs(O-(K.x+K.w))<Z&&Math.abs(W-(K.y+K.h))<Z?"se":Math.abs(W-K.y)<Z&&O>=K.x&&O<=K.x+K.w?"n":Math.abs(W-(K.y+K.h))<Z&&O>=K.x&&O<=K.x+K.w?"s":Math.abs(O-K.x)<Z&&W>=K.y&&W<=K.y+K.h?"w":Math.abs(O-(K.x+K.w))<Z&&W>=K.y&&W<=K.y+K.h?"e":null},G=(O,W,K)=>K?O>=K.x&&O<=K.x+K.w&&W>=K.y&&W<=K.y+K.h:!1,Y=O=>{const{x:W,y:K}=j(O);if(b!==null&&n[b]){const Z=n[b],ee=_(W,K,Z);if(ee){I({type:"zone",index:b,handle:ee,startX:W,startY:K,originalRect:{...Z}});return}}for(let Z=n.length-1;Z>=0;Z--){const ee=n[Z];if(ee&&G(W,K,ee)){C(Z);const V=_(W,K,ee);I({type:"zone",index:Z,handle:V||"move",startX:W,startY:K,originalRect:{...ee}});return}}if(l&&e){const Z=_(W,K,e);if(Z){I({type:"output",handle:Z,startX:W,startY:K,originalRect:{...e}}),C(null);return}if(G(W,K,e)){I({type:"output",handle:"move",startX:W,startY:K,originalRect:{...e}}),C(null);return}}C(null)},J=O=>{if(!x)return O;const W=1/w;return Math.round(O/W)*W},ae=O=>{if(!R)return;const{x:W,y:K}=j(O),Z=W-R.startX,ee=K-R.startY,V=(te,ce,xe,$)=>{let Q={...te};if(ce==="move")Q.x=J(te.x+xe),Q.y=J(te.y+$);else{if(ce.includes("w")){const ve=J(te.x+xe);Q.w=te.x+te.w-ve,Q.x=ve}if(ce.includes("e")){const ve=J(te.x+te.w+xe);Q.w=ve-Q.x}if(ce.includes("n")){const ve=J(te.y+$);Q.h=te.y+te.h-ve,Q.y=ve}if(ce.includes("s")){const ve=J(te.y+te.h+$);Q.h=ve-Q.y}}return Q.w<.01&&(Q.w=.01),Q.h<.01&&(Q.h=.01),Q};if(R.type==="zone"){const te=V(R.originalRect,R.handle,Z,ee);p(R.index,te)}else if(R.type==="output"){const te=V(R.originalRect,R.handle,Z,ee);g(te)}},re=()=>{I(null)};return f.jsx("div",{className:"output-canvas-container",style:{width:"100%",height:"100%"},children:f.jsx("canvas",{ref:M,width:600,height:600,style:{width:"100%",height:"100%",display:"block"},className:"output-canvas",onMouseDown:Y,onMouseMove:ae,onMouseUp:re,onMouseLeave:re})})},Fv=({show:n,onClose:e,dacs:a=[],dacSettings:s={},onUpdateDacSettings:l})=>{const[o,u]=N.useState(null),[h,p]=N.useState(null),[g,b]=N.useState(20),[C,w]=N.useState(!1),x=N.useMemo(()=>{const D=[];return a.forEach(j=>{j.channels&&j.channels.length>0?j.channels.forEach(_=>{D.push({id:`${j.ip}:${_.serviceID}`,displayName:`${j.hostName||j.unitID||"DAC"} : ${_.name||`CH ${_.serviceID}`}`,ip:j.ip,channel:_.serviceID,dacName:j.hostName||j.unitID})}):D.push({id:`${j.ip}:0`,displayName:j.hostName||j.unitID||`DAC ${j.ip}`,ip:j.ip,channel:0,dacName:j.hostName||j.unitID})}),D},[a]);if(N.useEffect(()=>{x.length>0&&!o&&u(x[0].id)},[x,o]),!n)return null;const M=s[o]||{safetyZones:[],outputArea:{x:.1,y:.1,w:.8,h:.8},transformationEnabled:!1,transformationMode:"crop",testLineEnabled:!1,testLineY:.5,flipX:!1,flipY:!1},R=D=>{o&&l(o,{...M,...D})},I=()=>{const D={x:.4,y:.4,w:.2,h:.2};R({safetyZones:[...M.safetyZones,D]}),p(M.safetyZones.length)},H=()=>{R({safetyZones:[]}),p(null)},B=(D,j)=>{const _=[...M.safetyZones];_[D]=j,R({safetyZones:_})};return f.jsx("div",{className:"output-settings-modal-overlay",children:f.jsxs("div",{className:"output-settings-modal-content",children:[f.jsxs("div",{className:"output-settings-header",children:[f.jsx("h2",{children:"Output Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:"Close"})]}),f.jsxs("div",{className:"output-settings-body",children:[f.jsx("div",{className:"output-settings-col",children:f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Available Outputs"}),f.jsxs("ul",{className:"dac-list",children:[x.length===0?f.jsx("li",{style:{color:"#666",fontStyle:"italic"},children:"No Outputs detected"}):null,x.map((D,j)=>f.jsxs("li",{className:`dac-list-item ${o===D.id?"selected":""}`,onClick:()=>u(D.id),children:[f.jsx("span",{style:{fontWeight:"bold",fontSize:"0.9em"},children:D.displayName}),f.jsx("span",{style:{fontSize:"0.7em",color:"#888"},children:D.ip})]},D.id))]})]})}),f.jsxs("div",{className:"output-settings-col canvas-col",children:[f.jsxs("div",{className:"canvas-toolbar",children:[f.jsx("button",{className:"tool-btn",onClick:I,title:"Add Safety Zone",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus-square",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),f.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})]})}),f.jsx("button",{className:`tool-btn ${M.transformationEnabled?"active":""}`,onClick:()=>R({transformationEnabled:!M.transformationEnabled}),title:"Toggle Output Transformation",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-border-outer",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M7.5 1.906v.938h1v-.938zm0 1.875v.938h1V3.78h-1zm0 1.875v.938h1v-.938zM1.906 8.5h.938v-1h-.938zm1.875 0h.938v-1H3.78v1zm1.875 0h.938v-1h-.938zm2.813 0v-.031H8.5V7.53h-.031V7.5H7.53v.031H7.5v.938h.031V8.5zm.937 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zm1.875 0h.938v-1h-.938zM7.5 9.406v.938h1v-.938zm0 1.875v.938h1v-.938zm0 1.875v.938h1v-.938z"}),f.jsx("path",{d:"M0 0v16h16V0zm1 1h14v14H1z"})]})}),f.jsx("button",{className:`tool-btn ${M.testLineEnabled?"active":""}`,onClick:()=>R({testLineEnabled:!M.testLineEnabled}),title:"Toggle Test Line",children:f.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[f.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),f.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})]})}),f.jsx("span",{style:{width:1,background:"#555",margin:"0 5px"}}),f.jsx("button",{className:`tool-btn ${C?"active":""}`,onClick:()=>w(!C),title:"Snap to Grid",children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-magnet-fill",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M15 12h-4v3h4zM5 12H1v3h4zM0 8a8 8 0 1 1 16 0v8h-6V8a2 2 0 1 0-4 0v8H0z"})})}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:5},children:[f.jsx("span",{style:{fontSize:10,color:"#aaa"},children:"Grid:"}),f.jsx("input",{type:"number",min:"5",max:"100",value:g,onChange:D=>b(parseInt(D.target.value)),className:"param-number-input",style:{width:40}})]})]}),f.jsx(Bv,{safetyZones:M.safetyZones,outputArea:M.outputArea,testLineY:M.testLineY,testLineEnabled:M.testLineEnabled,transformationEnabled:M.transformationEnabled,transformationMode:M.transformationMode,flipX:M.flipX,flipY:M.flipY,onUpdateSafetyZones:B,onUpdateOutputArea:D=>R({outputArea:D}),selectedZoneIndex:h,onSelectZone:p,gridSize:g,snapToGrid:C})]}),f.jsx("div",{className:"output-settings-col",children:o?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Output Transformation"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Editing"}),f.jsx("input",{type:"checkbox",checked:M.transformationEnabled,onChange:D=>R({transformationEnabled:D.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip X"}),f.jsx("input",{type:"checkbox",checked:M.flipX||!1,onChange:D=>R({flipX:D.target.checked})})]}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Flip Y"}),f.jsx("input",{type:"checkbox",checked:M.flipY||!1,onChange:D=>R({flipY:D.target.checked})})]}),M.transformationEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{style:{flex:1},children:"Mode"}),f.jsxs("select",{className:"param-select",value:M.transformationMode,onChange:D=>R({transformationMode:D.target.value}),children:[f.jsx("option",{value:"crop",children:"Crop"}),f.jsx("option",{value:"scale",children:"Scale"})]})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Safety Zones"}),f.jsxs("div",{className:"control-row",style:{justifyContent:"space-between",marginBottom:5},children:[f.jsx("button",{className:"small-btn",onClick:I,children:"Add New"}),f.jsx("button",{className:"small-btn clear",onClick:H,children:"Clear All"})]}),f.jsx("div",{className:"zone-list",children:M.safetyZones.map((D,j)=>f.jsxs("div",{className:`zone-item ${h===j?"selected":""}`,onClick:()=>p(j),children:[f.jsxs("span",{children:["Zone ",j+1]}),f.jsx("button",{className:"delete-zone-btn",onClick:_=>{_.stopPropagation(),h===j&&p(null);const G=M.safetyZones.filter((Y,J)=>J!==j);R({safetyZones:G})},children:""})]},j))}),h!==null&&f.jsxs("div",{style:{marginTop:10,borderTop:"1px solid #333",paddingTop:5},children:[f.jsx("label",{children:"Selected Zone Properties"}),f.jsx("div",{style:{fontSize:"0.8em",color:"#aaa"},children:"Select and drag zone on canvas to resize."})]})]}),f.jsxs("div",{className:"settings-group",children:[f.jsx("h4",{children:"Test Output"}),f.jsxs("div",{className:"control-row",style:{marginBottom:10},children:[f.jsx("label",{style:{flex:1},children:"Enable Test Line"}),f.jsx("input",{type:"checkbox",checked:M.testLineEnabled,onChange:D=>R({testLineEnabled:D.target.checked})})]}),M.testLineEnabled&&f.jsxs("div",{className:"control-row",children:[f.jsx("label",{children:"Y Position"}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:M.testLineY,onChange:D=>R({testLineY:parseFloat(D.target.value)}),className:"param-slider"})]})]})]}):f.jsx("div",{style:{padding:20,textAlign:"center",color:"#666"},children:"Select an Output to configure settings"})})]})]})})},ng=()=>{const n=po();return n||{}},Pv=({show:n,onClose:e,initialTab:a="output"})=>{const s=po(),{fftSettings:l,setFftSettings:o}=s||{},{devices:u,selectedDeviceId:h,setSelectedDeviceId:p,globalVolume:g,setVolume:b}=ng(),[C,w]=N.useState(a);if(Yn.useEffect(()=>{n&&w(a)},[n,a]),!n)return null;if(!l)return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{padding:"20px",color:"red",border:"1px solid red",background:"#222"},children:[f.jsx("h3",{children:"Error"}),f.jsx("p",{children:"Audio Context is not available."}),f.jsx("p",{children:"Please restart the application or report this bug."}),f.jsx("button",{onClick:e,style:{marginTop:"10px",padding:"5px 10px"},children:"Close"})]}),f.jsx("style",{children:`
                    .modal-overlay {
                        position: fixed;
                        top: 0; left: 0; right: 0; bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 10000;
                    }
                `})]});const x=(M,R,I)=>{const H={...l},B=`${M}Range`;H[B][R]=parseFloat(I),o(H)};return f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Audio Settings"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsxs("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"},children:[f.jsx("button",{className:`tab-btn ${C==="output"?"active":""}`,onClick:()=>w("output"),style:{padding:"8px 15px",background:"none",border:"none",color:C==="output"?"var(--theme-color)":"#888",borderBottom:C==="output"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"Audio Output"}),f.jsx("button",{className:`tab-btn ${C==="fft"?"active":""}`,onClick:()=>w("fft"),style:{padding:"8px 15px",background:"none",border:"none",color:C==="fft"?"var(--theme-color)":"#888",borderBottom:C==="fft"?"2px solid var(--theme-color)":"none",cursor:"pointer"},children:"FFT Settings"})]}),f.jsxs("div",{className:"modal-body",children:[C==="output"&&f.jsxs("div",{className:"audio-output-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Device"}),f.jsx("select",{className:"param-select",value:h,onChange:M=>p(M.target.value),style:{width:"100%",padding:"5px"},children:u.map(M=>f.jsx("option",{value:M.deviceId,children:M.label||`Device ${M.deviceId.slice(0,5)}`},M.deviceId))})]}),f.jsxs("div",{className:"settings-row",style:{textAlign:"center"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Volume"}),f.jsx("div",{style:{display:"flex",justifyContent:"center"},children:f.jsx(bi,{value:g,onChange:b,label:"MASTER",isAssigned:!0,size:60})})]})]}),C==="fft"&&f.jsxs("div",{className:"fft-settings",children:[f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Source"}),f.jsxs("select",{className:"param-select",value:l.source,onChange:M=>o({...l,source:M.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"external",children:"External (Microphone/Loopback)"}),f.jsx("option",{value:"clip",children:"Clip FFT (Audio from active clips)"})]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Calculation Mode"}),f.jsxs("select",{className:"param-select",value:l.calculationMode||"average",onChange:M=>o({...l,calculationMode:M.target.value}),style:{width:"100%",padding:"5px"},children:[f.jsx("option",{value:"average",children:"Average (Smooth)"}),f.jsx("option",{value:"peak",children:"Peak (Transient/Punchy)"})]})]}),f.jsxs("div",{className:"settings-row",style:{marginBottom:"15px"},children:[f.jsx("label",{style:{display:"block",marginBottom:"10px"},children:"Ranges (Hz)"}),f.jsxs("div",{className:"range-controls",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"10px",alignItems:"center"},children:[f.jsx("span",{children:"Low:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.lowRange[0],onChange:M=>x("low",0,M.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.lowRange[1],onChange:M=>x("low",1,M.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"Mid:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.midRange[0],onChange:M=>x("mid",0,M.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.midRange[1],onChange:M=>x("mid",1,M.target.value),style:{width:"60px"}})]}),f.jsx("span",{children:"High:"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:l.highRange[0],onChange:M=>x("high",0,M.target.value),style:{width:"60px"}}),f.jsx("span",{children:"-"}),f.jsx("input",{type:"number",value:l.highRange[1],onChange:M=>x("high",1,M.target.value),style:{width:"60px"}})]})]})]}),f.jsxs("div",{className:"settings-row",style:{display:"flex",justifyContent:"space-around",textAlign:"center"},children:[f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"GAIN"}),f.jsx(bi,{value:l.gain/5,onChange:M=>o({...l,gain:M*5}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"SMOOTH"}),f.jsx(bi,{value:l.smoothingTimeConstant||.8,onChange:M=>o({...l,smoothingTimeConstant:M}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"HOLD"}),f.jsx(bi,{value:l.holdTime/1e3,onChange:M=>o({...l,holdTime:M*1e3}),isAssigned:!0,size:40})]}),f.jsxs("div",{children:[f.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"10px"},children:"FALL"}),f.jsx(bi,{value:l.fallTime/2e3,onChange:M=>o({...l,fallTime:M*2e3}),isAssigned:!0,size:40})]})]})]})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]})},zv=({missingFiles:n,onRelocate:e,onClose:a})=>!n||n.length===0?null:f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content",style:{width:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"Missing Files"}),f.jsx("button",{className:"close-btn",onClick:a,children:""})]}),f.jsxs("div",{className:"modal-body",style:{overflowY:"auto",flex:1},children:[f.jsx("p",{style:{marginBottom:"15px",color:"#ccc",fontSize:"0.9em"},children:"The following files could not be found. Please locate one of them to update the path for all matching files in the same directory."}),f.jsx("ul",{style:{listStyle:"none",padding:0},children:n.map((s,l)=>f.jsxs("li",{style:{background:"#333",padding:"10px",marginBottom:"5px",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[f.jsxs("div",{style:{overflow:"hidden"},children:[f.jsx("div",{style:{fontWeight:"bold",fontSize:"0.9em"},children:s.fileName}),f.jsx("div",{style:{fontSize:"0.8em",color:"#888",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"350px"},children:s.filePath})]}),f.jsx("button",{className:"small-btn",onClick:()=>e(s),style:{marginLeft:"10px",whiteSpace:"nowrap"},children:"Locate"})]},l))})]})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex; justify-content: center; align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .small-btn {
                    background: var(--theme-color);
                    color: black;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-weight: bold;
                }
                .small-btn:hover {
                    opacity: 0.9;
                }
            `})]});class Gv extends Yn.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,a){console.error("Uncaught error:",e,a)}render(){return this.state.hasError?f.jsx("h1",{children:"Something went wrong."}):this.props.children}}const _f=32,X0=8;function nl(n,e,a,s){for(let l=0;l<s;l++)n.setUint8(e+l,l<a.length?a.charCodeAt(l):0)}function ag(n){let e=_f;n.forEach(o=>{e+=_f;const u=o.points?o.points.length:0;e+=u*X0});const a=new ArrayBuffer(e),s=new DataView(a);let l=0;return n.forEach((o,u)=>{const h=o.points||[],p=h.length;nl(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),nl(s,l+8,o.frameName||"TrueLazr",8),nl(s,l+16,o.companyName||"Gemini",8),s.setUint16(l+24,p,!1),s.setUint16(l+26,u,!1),s.setUint16(l+28,n.length,!1),s.setUint8(l+30,o.scannerHead||0),s.setUint8(l+31,0),l+=_f;for(let g=0;g<p;g++){const b=h[g];let C=Math.max(-32768,Math.min(32767,Math.round((b.x||0)*32767))),w=Math.max(-32768,Math.min(32767,Math.round((b.y||0)*32767)));s.setInt16(l,C,!1),s.setInt16(l+2,w,!1);let x=0;b.blanking&&(x|=64),g===p-1&&(x|=128),s.setUint8(l+4,x);let M=0,R=0,I=0;if(!b.blanking){const H=b.r??0,B=b.g??0,D=b.b??0;H<=1&&B<=1&&D<=1&&(H>0||B>0||D>0)?(M=Math.round(H*255),R=Math.round(B*255),I=Math.round(D*255)):(M=Math.round(H),R=Math.round(B),I=Math.round(D))}s.setUint8(l+5,Math.max(0,Math.min(255,I))),s.setUint8(l+6,Math.max(0,Math.min(255,R))),s.setUint8(l+7,Math.max(0,Math.min(255,M))),l+=X0}}),nl(s,l,"ILDA",4),s.setUint8(l+4,0),s.setUint8(l+5,0),s.setUint8(l+6,0),s.setUint8(l+7,5),nl(s,l+8,"EOF",8),nl(s,l+16,"TrueLazr",8),s.setUint16(l+24,0,!1),s.setUint16(l+26,0,!1),s.setUint16(l+28,0,!1),s.setUint8(l+30,0),s.setUint8(l+31,0),a}const $0=Object.freeze(Object.defineProperty({__proto__:null,framesToIlda:ag},Symbol.toStringTag,{value:"Module"})),Of=[{r:255,g:0,b:0},{r:255,g:17,b:0},{r:255,g:34,b:0},{r:255,g:51,b:0},{r:255,g:68,b:0},{r:255,g:85,b:0},{r:255,g:102,b:0},{r:255,g:119,b:0},{r:255,g:136,b:0},{r:255,g:153,b:0},{r:255,g:170,b:0},{r:255,g:187,b:0},{r:255,g:204,b:0},{r:255,g:221,b:0},{r:255,g:238,b:0},{r:255,g:255,b:0},{r:255,g:255,b:0},{r:238,g:255,b:0},{r:204,g:255,b:0},{r:170,g:255,b:0},{r:136,g:255,b:0},{r:102,g:255,b:0},{r:68,g:255,b:0},{r:34,g:255,b:0},{r:0,g:255,b:0},{r:0,g:255,b:34},{r:0,g:255,b:68},{r:0,g:255,b:102},{r:0,g:255,b:136},{r:0,g:255,b:170},{r:0,g:255,b:204},{r:0,g:255,b:238},{r:0,g:136,b:255},{r:0,g:119,b:255},{r:0,g:102,b:255},{r:0,g:102,b:255},{r:0,g:85,b:255},{r:0,g:68,b:255},{r:0,g:68,b:255},{r:0,g:34,b:255},{r:0,g:0,b:255},{r:34,g:0,b:255},{r:68,g:0,b:255},{r:102,g:0,b:255},{r:136,g:0,b:255},{r:170,g:0,b:255},{r:204,g:0,b:255},{r:238,g:0,b:255},{r:255,g:0,b:255},{r:255,g:34,b:255},{r:255,g:68,b:255},{r:255,g:102,b:255},{r:255,g:136,b:255},{r:255,g:170,b:255},{r:255,g:204,b:255},{r:255,g:238,b:255},{r:255,g:255,b:255},{r:255,g:238,b:238},{r:255,g:204,b:204},{r:255,g:170,b:170},{r:255,g:136,b:136},{r:255,g:102,b:102},{r:255,g:68,b:68},{r:0,g:34,b:34}];function Hv(n,e,a,s,l=Of){const o=[],u=new DataView(n);let h=0;try{for(let p=0;p<s;p++){if(e===2){h+=a;continue}let g,b,C=0,w,x,M,R;e===0||e===4?(g=u.getInt16(h,!1)/32768,b=u.getInt16(h+2,!1)/32768,C=u.getInt16(h+4,!1)/32768,R=u.getUint8(h+6)):(g=u.getInt16(h,!1)/32768,b=u.getInt16(h+2,!1)/32768,R=u.getUint8(h+4));const I=(R&64)!==0,H=(R&128)!==0;if(e===0||e===1){const B=u.getUint8(h+(e===0?7:5)),D=l||Of,j=D[B%D.length]||Of[0];w=j.r,x=j.g,M=j.b}else(e===4||e===5)&&(M=u.getUint8(h+(e===4?7:5)),x=u.getUint8(h+(e===4?8:6)),w=u.getUint8(h+(e===4?9:7)));if(o.push({x:g,y:b,z:C,r:w===void 0?255:w,g:x===void 0?255:x,b:M===void 0?255:M,blanking:I,lastPoint:H}),h+=a,H)break}}catch(p){console.warn("Parser: Error reading points:",p)}return o}const Yv=n=>{const e=[],a=new DataView(n);let s=0,l=null,o=null;for(;s+32<=a.byteLength;){if(String.fromCharCode(a.getUint8(s),a.getUint8(s+1),a.getUint8(s+2),a.getUint8(s+3))!=="ILDA"){s++;continue}const h=a.getUint8(s+7);o===null&&(o=h);const p=String.fromCharCode(...new Uint8Array(n,s+8,8)).trim(),g=String.fromCharCode(...new Uint8Array(n,s+16,8)).trim();let b=a.getUint16(s+24,!1);const C=a.getUint16(s+26,!1),w=a.getUint16(s+28,!1),x=a.getUint8(s+30);let M;switch(h){case 0:M=8;break;case 1:M=6;break;case 2:M=3;break;case 4:M=10;break;case 5:M=8;break;default:s+=32;continue}if(h===2){l=[];const H=s+32;for(let B=0;B<b;B++){const D=a.getUint8(H+B*3),j=a.getUint8(H+B*3+1),_=a.getUint8(H+B*3+2);l.push({r:D,g:j,b:_})}}let R=b*M,I=32+R;if(s+I>n.byteLength)break;if(b>0&&h!==2){const H=n.slice(s+32,s+32+R),B=Hv(H,h,M,b,l);e.push({frameName:p,companyName:g,frameNumber:C,totalFrames:w,scannerHead:x,points:B,formatCode:h})}s+=I}return{frames:e,firstFormatCode:o,colorPalette:l}};function al(n,e=!1,a=.5){if(!n||n.length<2)return n||[];const s=[],l=n.length,o=h=>e?n[(h+l)%l]:n[Math.max(0,Math.min(l-1,h))],u=e?l:l-1;for(let h=0;h<u;h++){const p=o(h-1),g=o(h),b=o(h+1),C=o(h+2);let w,x;!e&&l===2?(w={x:g.x+(b.x-g.x)/3,y:g.y+(b.y-g.y)/3},x={x:b.x-(b.x-g.x)/3,y:b.y-(b.y-g.y)/3}):(w={x:g.x+(b.x-p.x)*a/3,y:g.y+(b.y-p.y)*a/3},x={x:b.x-(C.x-g.x)*a/3,y:b.y-(C.y-g.y)*a/3}),h===0&&s.push({...g}),s.push(w),s.push(x),s.push({...b})}return s}const qv=({onBack:n})=>{const[e,a]=N.useState("select"),[s,l]=N.useState("#00ff00"),[o,u]=N.useState("simple"),[h,p]=N.useState(!1),[g,b]=N.useState(1),[C,w]=N.useState(1),[x,M]=N.useState(0),[R,I]=N.useState(!1),[H,B]=N.useState(!0),[D,j]=N.useState([[]]),[_,G]=N.useState(null),[Y,J]=N.useState([[[]]]),[ae,re]=N.useState(0),[O,W]=N.useState([]),[K,Z]=N.useState([]),[ee,V]=N.useState([]),[te,ce]=N.useState(null),[xe,$]=N.useState(null),[Q,ve]=N.useState(.6),[Re,Ue]=N.useState({x:0,y:0}),[we,Me]=N.useState(!0),[ze,Xe]=N.useState(!1),[ot,At]=N.useState(25),[Ct,on]=N.useState(!1),[Qt,cn]=N.useState(!1),[je,Ve]=N.useState(!1),[Le,rt]=N.useState({visible:!1,x:0,y:0,target:null}),[Wt,pn]=N.useState(0),[ke,Se]=N.useState(-1),[Kt,zt]=N.useState(0),[On,Gt]=N.useState(0),[Ke,qn]=N.useState(!0),[Xt,tr]=N.useState(!0),[nr,zr]=N.useState(0),[wn,va]=N.useState("fps"),[hn,ar]=N.useState(1),[En,Ze]=N.useState(120),[ct,ds]=N.useState(2),[Vn,In]=N.useState(30),[Gr,ja]=N.useState(8),Hr=N.useRef(wn),ca=N.useRef(hn),ua=N.useRef(En),ba=N.useRef(ct),ta=N.useRef(Vn),mn=N.useRef(Gr),kt=N.useRef(g),gn=N.useRef(nr);N.useEffect(()=>{Hr.current=wn},[wn]),N.useEffect(()=>{ca.current=hn},[hn]),N.useEffect(()=>{ua.current=En},[En]),N.useEffect(()=>{ba.current=ct},[ct]),N.useEffect(()=>{ta.current=Vn},[Vn]),N.useEffect(()=>{mn.current=Gr},[Gr]),N.useEffect(()=>{kt.current=g},[g]),N.useEffect(()=>{gn.current=nr},[nr]);const Xn=N.useRef(null),na=N.useRef(null),et=N.useRef({x:0,y:0}),xa=N.useRef(!1),Mn=N.useRef(!1),rr=N.useRef(!1),Qs=N.useRef(!1),Sa=N.useRef(!1),Ln=N.useRef(!1),Et=N.useRef(null);N.useRef(null);const Nn=N.useRef(performance.now()),ut=N.useRef(0),Qe=1e3,Pe=D[x]||[],nt=y=>{const v=Y.slice(0,ae+1);v.push(JSON.parse(JSON.stringify(y))),v.length>30&&v.shift(),J(v),re(v.length-1)},fa=(y,v=!0)=>{const S=Bn(y,v);if(S.length===0)return{x:0,y:0,w:0,h:0};const A=Math.min(...S.map(P=>P.x)),E=Math.max(...S.map(P=>P.x)),T=Math.min(...S.map(P=>P.y)),L=Math.max(...S.map(P=>P.y));return{x:A,y:T,w:E-A,h:L-T}},ps=()=>{if(O.length<2)return;const y=[...D],v=[...y[x]],S=O.sort((T,L)=>L-T).map(T=>v.splice(T,1)[0]),A={type:"group",shapes:S.reverse(),color:S[0].color,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0},E=jn(A);A.pivotX=E.x,A.pivotY=E.y,v.push(A),y[x]=v,j(y),nt(y),W([v.length-1])},Yr=()=>{if(O.length!==1)return;const y=Pe[O[0]];if(y.type!=="group")return;const v=[...D],S=[...v[x]];S.splice(O[0],1);const A=y.shapes.map(E=>{const T=pa(Ut(E),y);return{...E,points:T,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}});S.push(...A),v[x]=S,j(v),nt(v),W([])},Lt=(y,v)=>Math.sqrt(Math.pow(v.x-y.x,2)+Math.pow(v.y-y.y,2)),Un=y=>{if(y.startsWith("rgb")){const S=y.match(/\d+/g);return{r:parseInt(S[0]),g:parseInt(S[1]),b:parseInt(S[2])}}const v=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return v?{r:parseInt(v[1],16),g:parseInt(v[2],16),b:parseInt(v[3],16)}:{r:0,g:0,b:0}},wa=y=>{if(!y)return"#ffffff";if(y.startsWith("#"))return y;if(y.startsWith("rgb")){const v=Un(y),S=v.r.toString(16).padStart(2,"0"),A=v.g.toString(16).padStart(2,"0"),E=v.b.toString(16).padStart(2,"0");return`#${S}${A}${E}`}return"#ffffff"},da=y=>{const{r:v,g:S,b:A}=Un(wa(y));return`rgb(${255-v}, ${255-S}, ${255-A})`},$n=(y,v,S)=>{const A=Math.pow(Lt(v,S),2);if(A===0)return Lt(y,v);let E=((y.x-v.x)*(S.x-v.x)+(y.y-v.y)*(S.y-v.y))/A;return E=Math.max(0,Math.min(1,E)),Lt(y,{x:v.x+E*(S.x-v.x),y:v.y+E*(S.y-v.y)})},jn=(y,v=!1)=>{if(!y)return{x:500,y:500};if(y.type==="rect"&&!v)return{x:y.start.x+y.width/2,y:y.start.y+y.height/2};if((y.type==="circle"||y.type==="star"||y.type==="triangle")&&!v)return y.start;if(y.type==="line"&&!v)return{x:(y.start.x+y.end.x)/2,y:(y.start.y+y.end.y)/2};const S=Bn(y,v);if(S.length===0)return{x:500,y:500};const A=S.reduce((E,T)=>({x:E.x+(T.x||0),y:E.y+(T.y||0)}),{x:0,y:0});return{x:A.x/S.length,y:A.y/S.length}},qr=(y,v)=>{if(!v||!y)return null;const S=Array.isArray(v)?v:[v];if(y.type==="group")return qr(y.shapes[S[0]],S.slice(1));const A=S[0];return y.type==="line"?A===0?y.start:y.end:y.type==="rect"?[y.start,{x:y.start.x+y.width,y:y.start.y},{x:y.start.x+y.width,y:y.start.y+y.height},{x:y.start.x,y:y.start.y+y.height}][A]:y.type==="circle"||y.type==="star"||y.type==="triangle"?[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}][A]:y.points?y.points[A]:null},Wn=y=>y?y.pivotX!==void 0&&y.pivotY!==void 0?{x:y.pivotX,y:y.pivotY}:jn(y):{x:500,y:500},pa=N.useCallback((y,v)=>{if(!y||y.length===0||!v)return y;v.type==="group"&&v.shapes;const S=Wn(v),A=v.scaleX??1,E=v.scaleY??1,T=v.rotationX||0,L=v.rotationY||0,P=v.rotationZ||v.rotation||0;return A===1&&E===1&&T===0&&L===0&&P===0?y:y.map(z=>{let F=z.x-S.x,X=z.y-S.y,q=z.z||0;if(F*=A,X*=E,P!==0){const ie=F*Math.cos(P)-X*Math.sin(P),le=F*Math.sin(P)+X*Math.cos(P);F=ie,X=le}if(T!==0){const ie=X*Math.cos(T)-q*Math.sin(T),le=X*Math.sin(T)+q*Math.cos(T);X=ie,q=le}if(L!==0){const ie=F*Math.cos(L)+q*Math.sin(L),le=-F*Math.sin(L)+q*Math.cos(L);F=ie,q=le}return{...z,x:S.x+F,y:S.y+X,z:q}})},[]),Ut=N.useCallback(y=>{if(!y)return[];let v=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline")v=y.points||[];else if(y.type==="bezier"){const S=(y.points||[]).filter(A=>!!A);if(S.length>=4)for(let A=0;A<=S.length-4;A+=3){const E=S[A],T=S[A+1],L=S[A+2],P=S[A+3];if(E&&T&&L&&P){const z=A===0?0:1;for(let F=z;F<=20;F++){const X=F/20,q=1-X;v.push({x:Math.pow(q,3)*E.x+3*Math.pow(q,2)*X*T.x+3*q*Math.pow(X,2)*L.x+Math.pow(X,3)*P.x,y:Math.pow(q,3)*E.y+3*Math.pow(q,2)*X*T.y+3*q*Math.pow(X,2)*L.y+Math.pow(X,3)*P.y,color:E.color})}}}else v=S}else if(y.type==="line")v=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const S=y.color,A=y.cornerColors||[S,S,S,S];v=[{x:y.start.x,y:y.start.y,color:A[0]},{x:y.start.x+y.width,y:y.start.y,color:A[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:A[2]},{x:y.start.x,y:y.start.y+y.height,color:A[3]}]}else if(y.type==="circle"){const S=Math.abs(y.end.x-y.start.x),A=Math.abs(y.end.y-y.start.y),E=y.color;for(let T=0;T<32;T++){const L=T/32*Math.PI*2;v.push({x:y.start.x+Math.cos(L)*S,y:y.start.y+Math.sin(L)*A,color:E})}}else if(y.type==="star"){const S=Math.abs(y.end.x-y.start.x),A=Math.abs(y.end.y-y.start.y),E=y.color,T=5,L=S,P=S/2.5;let z=Math.PI/2*3;const F=Math.PI/T;for(let X=0;X<T;X++)v.push({x:y.start.x+Math.cos(z)*L,y:y.start.y+Math.sin(z)*A,color:E}),z+=F,v.push({x:y.start.x+Math.cos(z)*P,y:y.start.y+Math.sin(z)*(A/2.5),color:E}),z+=F}else if(y.type==="triangle"){const S=Math.abs(y.end.x-y.start.x),A=Math.abs(y.end.y-y.start.y),E=y.color;v=[{x:y.start.x-S,y:y.start.y+A,color:E},{x:y.start.x+S,y:y.start.y+A,color:E},{x:y.start.x,y:y.start.y-A,color:E}]}else y.type==="group"&&y.shapes.forEach(S=>v.push(...Ut(S)));return pa(v,y)},[pa]),Bn=N.useCallback((y,v=!0)=>{if(!y)return[];let S=[];if(y.type==="pen"||y.type==="polygon"||y.type==="polyline"||y.type==="bezier")S=y.points||[];else if(y.type==="line")S=[{x:y.start.x,y:y.start.y,color:y.startColor||y.color},{x:y.end.x,y:y.end.y,color:y.endColor||y.color}];else if(y.type==="rect"){const A=y.color,E=y.cornerColors||[A,A,A,A];S=[{x:y.start.x,y:y.start.y,color:E[0]},{x:y.start.x+y.width,y:y.start.y,color:E[1]},{x:y.start.x+y.width,y:y.start.y+y.height,color:E[2]},{x:y.start.x,y:y.start.y+y.height,color:E[3]}]}else y.type==="circle"||y.type==="star"||y.type==="triangle"?S=[y.start,{x:y.end.x,y:y.start.y},{x:y.start.x,y:y.end.y}]:y.type==="group"&&y.shapes.forEach(A=>S.push(...Bn(A,!0)));return v?pa(S,y):S},[pa]),Ba=(y,v,S,A=[],E=[])=>{if(y.hidden||y.locked)return null;const T=15/Q,L=Bn(y);if(y.type!=="group"){const q=[];for(let ie=0;ie<L.length;ie++)Lt(L[ie],v)<T&&q.push({type:"point",index:ie,path:[...E,ie]});if(q.length>0)return q.find(le=>!A.some(oe=>JSON.stringify(oe)===JSON.stringify(le.path)))||q[0]}const P=jn(y),z=Wn(y);if(S&&Lt(z,v)<15/Q)return{type:"pivot"};if(S&&Lt(P,v)<20/Q)return{type:"shape"};if(y.type==="group")for(let q=y.shapes.length-1;q>=0;q--){const ie=Ba(y.shapes[q],v,!0,A,[...E,q]);if(ie&&ie.type==="point")return ie}const F=Ut(y),X=["rect","circle","star","polygon"].includes(y.type);for(let q=0;q<F.length-1;q++)if($n(v,F[q],F[q+1])<T)return{type:"segment",index:q,path:[...E,q]};return X&&F.length>2&&$n(v,F[F.length-1],F[0])<T?{type:"segment",index:F.length-1,path:[...E,F.length-1]}:null},An=N.useCallback((y,v)=>{if(!Xn.current)return{x:500,y:500};const S=Xn.current.getBoundingClientRect(),A=y-S.left,E=v-S.top;return{x:(A-S.width/2)/Q+Qe/2-Re.x,y:(E-S.height/2)/Q+Qe/2-Re.y}},[Q,Re]),Fa=N.useCallback((y,v,S=[])=>{if(!ze)return{x:y,y:v};const A=10/Q;let E=null,T=A;return Pe.forEach((L,P)=>{if(L.hidden)return;Bn(L).forEach((F,X)=>{const q=[P,X];if(S.some(oe=>JSON.stringify(oe)===JSON.stringify(q)))return;const le=Lt({x:y,y:v},F);le<T&&(T=le,E={x:F.x,y:F.y})})}),E||{x:Math.round(y/ot)*ot,y:Math.round(v/ot)*ot}},[ze,ot,Pe,Q,Bn]),Er=y=>{y.preventDefault();const v=Math.pow(1.1,-y.deltaY/100);ve(S=>Math.max(.1,Math.min(10,S*v)))},sr=y=>{if(y.preventDefault(),h&&_){Ss();return}const v=An(y.clientX,y.clientY);for(let S=Pe.length-1;S>=0;S--){const A=Ba(Pe[S],v,O.includes(S),K);if(A){rt({visible:!0,x:y.clientX,y:y.clientY,target:{...A,shapeIndex:S,pos:v}}),O.includes(S)||W([S]);return}}rt({visible:!0,x:y.clientX,y:y.clientY,target:{type:"canvas"}})},Ks=()=>{if(O.length!==1||K.length===0)return;const y=O[0],v=[...D],S=[...v[x]],A=S[y];if(!A.points){alert("Only point-based shapes can be split. Convert to points first.");return}const E=K.map(z=>Array.isArray(z)?z[0]:z).sort((z,F)=>z-F),T=E.map(z=>({...A.points[z]})),L=A.points.filter((z,F)=>!E.includes(F));if(T.length===0)return;L.length<2?S.splice(y,1):S[y]={...A,points:L};const P={...A,type:"polyline",points:T,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};S.push(P),v[x]=S,j(v),nt(v),W([S.length-1]),Z([]),rt({visible:!1,x:0,y:0,target:null})},Ar=()=>{const y=K.length>0?K:Le.target?.type==="point"?[Le.target.path||[Le.target.index]]:[];if(y.length===0)return;const v=[...D],S=[...v[x]],A={};y.forEach(L=>{const P=Array.isArray(L)?L:[L];if(O.length===1){const z=O[0];A[z]||(A[z]=[]),A[z].push(P)}else if(Le.target?.shapeIndex!==void 0){const z=Le.target.shapeIndex;A[z]||(A[z]=[]),A[z].push(P)}});const E=(L,P)=>{if(L.type==="group")return L.shapes=L.shapes.map((z,F)=>{const X=P.filter(q=>q[0]===F).map(q=>q.slice(1));return X.length>0?E({...z},X):z}).filter(z=>!!z),L.shapes.length>0?L:null;{if(!L.points)return null;const z=P.map(X=>X[0]),F=L.points.filter((X,q)=>!z.includes(q));return F.length<2?null:{...L,points:F}}};let T=!1;Object.keys(A).forEach(L=>{const P=parseInt(L),z=E(S[P],A[L]);z?S[P]=z:S.splice(P,1),T=!0}),T&&(v[x]=S,j(v),nt(v),Z([])),rt({visible:!1,x:0,y:0,target:null})},ir=()=>{if(!Le.target||Le.target.type!=="segment")return;const{shapeIndex:y,index:v}=Le.target,S=[...D],A=[...S[x]],E={...A[y]};if(E.type==="line"||E.type==="rect"||E.type==="circle"||E.type==="star")A.splice(y,1),W([]);else if(E.points){if(E.type==="polygon"){const T=[];for(let L=0;L<E.points.length;L++)T.push(E.points[(v+1+L)%E.points.length]);E.points=T,E.type="polyline",A[y]=E}else if(E.type==="polyline"||E.type==="pen"){const T=E.points.slice(0,v+1),L=E.points.slice(v+1);A.splice(y,1),T.length>1&&A.push({...E,points:T}),L.length>1&&A.push({...E,points:L}),W([])}else if(E.type==="bezier"){const T=[...E.points];T.splice(v,2),T.length<3?A.splice(y,1):(E.points=T,A[y]=E),W([])}}S[x]=A,j(S),nt(S),rt({visible:!1,x:0,y:0,target:null})},Fn=()=>{if(!Le.target||Le.target.type!=="segment")return;const{shapeIndex:y,index:v,pos:S}=Le.target,A=[...D],E=[...A[x]],T={...E[y]};if(T.points){const L=[...T.points];L.splice(v+1,0,{...S,color:s}),E[y]={...T,points:L}}else T.type==="line"&&(E[y]={type:"polyline",color:T.color,renderMode:T.renderMode||"simple",points:[{x:T.start.x,y:T.start.y,color:T.startColor||T.color},{x:S.x,y:S.y,color:s},{x:T.end.x,y:T.end.y,color:T.endColor||T.color}],rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1});A[x]=E,j(A),nt(A),rt({visible:!1,x:0,y:0,target:null})},Pa=()=>{if(!Le.target||Le.target.shapeIndex===void 0)return;const{shapeIndex:y}=Le.target,v=[...D],S=[...v[x]],A=S[y];if(["rect","circle","star","line"].includes(A.type)){const E=Ut(A),T={type:A.type==="line"?"polyline":"polygon",color:A.color,renderMode:A.renderMode||"simple",points:E,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};S[y]=T,v[x]=S,j(v),nt(v)}rt({visible:!1,x:0,y:0,target:null})},hs=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]];O.forEach(S=>{const A={...v[S]};delete A.pivotX,delete A.pivotY,v[S]=A}),y[x]=v,j(y),nt(y),rt({visible:!1,x:0,y:0,target:null})},Vr=N.useCallback(y=>va(y),[]),lr=N.useCallback(y=>Ze(y),[]),Tr=N.useCallback(y=>In(y),[]),ms=N.useCallback(y=>ds(y),[]),za=N.useCallback(y=>ja(y),[]),or=N.useCallback(y=>ar(y),[]),Ga=(y,v,S=1)=>{y.preventDefault();const A=y.deltaY<0?S:-S;v(E=>Math.max(0,E+A))},Ha=y=>Ga(y,Ze),aa=y=>Ga(y,ja),Ai=y=>Ga(y,ds,.1),gs=y=>{y.preventDefault();const v=y.deltaY<0?1:-1;zt(S=>Math.max(0,S+v))},cr=y=>{y.preventDefault();const v=y.deltaY<0?1:-1;Gt(S=>Math.max(0,S+v))},Js=y=>{y.preventDefault();const v=y.deltaY<0?1:-1;zr(S=>Math.max(0,Math.min(g-1,S+v)))},ys=()=>{if(Kt>=On){alert("Start frame must be before end frame");return}const y=[...D],v=D[Kt],S=D[On];if(!v||!S||v.length===0||S.length===0){alert("Both start and end frames must contain shapes");return}const A=On-Kt;for(let E=1;E<A;E++){const T=E/A,L=Kt+E,P=[];v.forEach((z,F)=>{const X=S[F];if(!X||z.type!==X.type){P.push(T<.5?JSON.parse(JSON.stringify(z)):JSON.parse(JSON.stringify(X)));return}const q=JSON.parse(JSON.stringify(z));if(Ke&&(z.start&&X.start&&(q.start.x=z.start.x+(X.start.x-z.start.x)*T,q.start.y=z.start.y+(X.start.y-z.start.y)*T),z.end&&X.end&&(q.end.x=z.end.x+(X.end.x-z.end.x)*T,q.end.y=z.end.y+(X.end.y-z.end.y)*T),z.width!==void 0&&X.width!==void 0&&(q.width=z.width+(X.width-z.width)*T),z.height!==void 0&&X.height!==void 0&&(q.height=z.height+(X.height-z.height)*T),q.scaleX=(z.scaleX??1)+((X.scaleX??1)-(z.scaleX??1))*T,q.scaleY=(z.scaleY??1)+((X.scaleY??1)-(z.scaleY??1))*T,q.rotationX=(z.rotationX??0)+((X.rotationX??0)-(z.rotationX??0))*T,q.rotationY=(z.rotationY??0)+((X.rotationY??0)-(z.rotationY??0))*T,q.rotationZ=(z.rotationZ??0)+((X.rotationZ??0)-(z.rotationZ??0))*T,z.rotation!==void 0&&X.rotation!==void 0&&(q.rotation=z.rotation+(X.rotation-z.rotation)*T)),Xt){const ie=Un(z.color),le=Un(X.color),oe=Math.round(ie.r+(le.r-ie.r)*T),ge=Math.round(ie.g+(le.g-ie.g)*T),fe=Math.round(ie.b+(le.b-ie.b)*T);q.color=`rgb(${oe},${ge},${fe})`}z.points&&X.points&&z.points.length===X.points.length&&(q.points=z.points.map((ie,le)=>{const oe=X.points[le];let ge=ie.x,fe=ie.y,be=ie.z||0,Ae=ie.color||z.color;if(Ke&&(ge=ie.x+(oe.x-ie.x)*T,fe=ie.y+(oe.y-ie.y)*T,be=(ie.z||0)+((oe.z||0)-(ie.z||0))*T),Xt){const De=Un(ie.color||z.color),Ie=Un(oe.color||X.color),Ge=Math.round(De.r+(Ie.r-De.r)*T),ft=Math.round(De.g+(Ie.g-De.g)*T),it=Math.round(De.b+(Ie.b-De.b)*T);Ae=`rgb(${Ge},${ft},${it})`}return{x:ge,y:fe,z:be,color:Ae}})),P.push(q)}),y[L]=P}j(y),nt(y),alert("Interpolation complete!")},ur=()=>{if(O.length!==1)return;const y=Pe[O[0]];if(!y||!y.points)return;const v=[];for(let S=1;S<y.points.length;S+=2)v.push(S);Z(v)},qt=()=>{if(O.length!==1)return;const y=Pe[O[0]];if(!y||!y.points)return;const v=[];for(let S=0;S<y.points.length;S+=2)v.push(S);Z(v)},ei=()=>{if(O.length!==1)return;const y=Pe[O[0]];if(!y||!y.points)return;const v=[];for(let S=0;S<y.points.length;S++)K.includes(S)||v.push(S);Z(v)},Ya=()=>{if(O.length!==1||K.length===0)return;const y=Pe[O[0]];if(!y||!y.points)return;const v=new Set(K);K.forEach(S=>{S>0&&v.add(S-1),S<y.points.length-1&&v.add(S+1),(y.type==="polygon"||y.type==="rect"||y.type==="circle"||y.type==="star")&&(S===0&&v.add(y.points.length-1),S===y.points.length-1&&v.add(0))}),Z(Array.from(v).sort((S,A)=>S-A))},ti=()=>{if(O.length!==1||K.length===0)return;const y=Pe[O[0]];if(!y||!y.points)return;const v=K.filter(S=>{const A=S===0&&(y.type==="polygon"||y.type==="rect")?y.points.length-1:S-1,E=S===y.points.length-1&&(y.type==="polygon"||y.type==="rect")?0:S+1;return K.includes(A)&&K.includes(E)});Z(v)},Xr=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Select Background Image",filters:[{name:"Images",extensions:["jpg","png","png","webp","bmp"]}],properties:["openFile"]});if(!y)return;const v=new Image;v.onload=()=>{ce(v)},v.src=`file://${y}`},Ea=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]],S=15/Q,A=E=>{let T=[];return E.points?T=[...E.points]:T=Ut(E),{...E,type:"polyline",points:T,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}};if(O.length===1){const E=O[0],T={...v[E]};if(T.points||(T.points=Ut(T),T.rotationX=0,T.rotationY=0,T.rotationZ=0,T.scaleX=1,T.scaleY=1),K.length===2){const[L,P]=[...K].sort((X,q)=>X-q),z=[],F=T.points.length;for(let X=0;X<F;X++)z.push(T.points[(L+X)%F]);T.points=z,T.type="polygon"}else T.type="polygon";v[E]=T}else{const T=[...O].sort((L,P)=>P-L).map(L=>A(v.splice(L,1)[0]));if(T.length>0){let L=T.pop();for(;T.length>0;){let P=1/0,z=-1,F="end-end",X=!1,q=!1,ie=-1;const le=L.points[0],oe=L.points[L.points.length-1];if(T.forEach((fe,be)=>{const Ae=fe.points[0],De=fe.points[fe.points.length-1],Ie=Lt(oe,Ae),Ge=Lt(oe,De),ft=Lt(le,Ae),it=Lt(le,De);if(Ie<P&&(P=Ie,z=be,F="end-end",X=!1,q=!1),Ge<P&&(P=Ge,z=be,F="end-end",X=!1,q=!0),ft<P&&(P=ft,z=be,F="end-end",X=!0,q=!1),it<P&&(P=it,z=be,F="end-end",X=!0,q=!0),P>S)for(let ht=0;ht<L.points.length;ht++){const xt=L.points[ht],$e=Lt(xt,Ae),ra=Lt(xt,De);$e<P&&(P=$e,z=be,F="mid-insert",ie=ht,q=!1),ra<P&&(P=ra,z=be,F="mid-insert",ie=ht,q=!0)}}),z===-1)break;const ge=T.splice(z,1)[0];if(F==="end-end")X&&L.points.reverse(),q&&ge.points.reverse(),L.points=[...L.points,...ge.points];else{q&&ge.points.reverse();const fe=[...ge.points].reverse();fe.shift();const be=[...ge.points,...fe],Ae=L.points.slice(0,ie+1),De=L.points.slice(ie+1);L.points=[...Ae,...be,...De]}}v.push(L)}}y[x]=v,j(y),nt(y),W([v.length-1]),Z([])},vs=(y,v=!1,S=!1)=>{if(!y||y.length<2)return y;const A=[],E=T=>S?y[(T+y.length)%y.length]:y[Math.max(0,Math.min(y.length-1,T))];for(let T=0;T<y.length;T++){if(!S&&T===y.length-1){A.push(y[T]);break}const L=E(T-1),P=E(T),z=E(T+1),F=E(T+2);if(A.push(P),v){const oe=-.0625*L.x+.5625*P.x+.5625*z.x+-.0625*F.x,ge=-.0625*L.y+.5625*P.y+.5625*z.y+-.0625*F.y,fe=Un(P.color||"#ffffff"),be=Un(z.color||"#ffffff");Math.round((fe.r+be.r)/2),Math.round((fe.g+be.g)/2),Math.round((fe.b+be.b)/2),A.push({x:oe,y:ge,color:P.color})}else{const X=(P.x+z.x)/2,q=(P.y+z.y)/2;A.push({x:X,y:q,color:P.color})}}return A},Zn=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]];let S=!1;O.forEach(A=>{const E={...v[A]};E.type==="polyline"?(E.type="polygon",v[A]=E,S=!0):E.type==="polygon"&&(E.type="polyline",v[A]=E,S=!0)}),S&&(y[x]=v,j(y),nt(y)),rt({visible:!1,x:0,y:0,target:null})},tn=(y=!1)=>{if(O.length===0)return;const v=[...D],S=[...v[x]];let A=!1;const E=(T,L,P,z)=>{if(P.length===0&&z.length===0||z.includes(T))return!0;const F=T,X=(T+1)%L;return P.includes(F)&&P.includes(X)};O.forEach(T=>{const L={...S[T]};let P=[];K.forEach(F=>{const X=Array.isArray(F)?F:[F];X.length===1&&P.push(X[0])});let z=[];if(ee.forEach(F=>{const X=Array.isArray(F)?F:[F];X.length===1&&z.push(X[0])}),L.type==="pen"||L.type==="polyline"||L.type==="polygon")if(P.length>0||z.length>0){const X=L.points,q=[],ie=L.type==="polygon",le=X.length;for(let oe=0;oe<le;oe++){if(!ie&&oe===le-1){q.push(X[oe]);break}if(q.push(X[oe]),E(oe,le,P,z)){const ge=X[oe],fe=X[(oe+1)%le];if(y){const be=$e=>X[($e+le)%le],Ae=ie?be(oe-1):oe>0?X[oe-1]:ge,De=ie?be(oe+2):oe<le-2?X[oe+2]:fe,Ie=-.0625,Ge=.5625,ft=.5625,it=-.0625,ht=Ie*Ae.x+Ge*ge.x+ft*fe.x+it*De.x,xt=Ie*Ae.y+Ge*ge.y+ft*fe.y+it*De.y;q.push({x:ht,y:xt,color:ge.color})}else{const be=(ge.x+fe.x)/2,Ae=(ge.y+fe.y)/2;q.push({x:be,y:Ae,color:ge.color})}}}L.points=q,S[T]=L,A=!0}else{const X=L.type==="polygon";L.points=vs(L.points,y,X),S[T]=L,A=!0}else if(L.type==="circle"||L.type==="star"||L.type==="rect"){const F=P.length>0||z.length>0,X=Ut(L);if(F){const q=[],ie=X.length;for(let le=0;le<ie;le++)if(q.push(X[le]),E(le,ie,P,z)){const oe=X[le],ge=X[(le+1)%ie];if(y){const fe=Ge=>X[(Ge+ie)%ie],be=fe(le-1),Ae=fe(le+2),De=-.0625*be.x+.5625*oe.x+.5625*ge.x-.0625*Ae.x,Ie=-.0625*be.y+.5625*oe.y+.5625*ge.y-.0625*Ae.y;q.push({x:De,y:Ie,color:oe.color})}else q.push({x:(oe.x+ge.x)/2,y:(oe.y+ge.y)/2,color:oe.color})}S[T]={...L,type:"polygon",points:q,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else S[T]={...L,type:"polygon",points:vs(X,y,!0),rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};A=!0}}),A&&(v[x]=S,j(v),nt(v))},qa=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]];let S=!1;O.forEach(A=>{const E={...v[A]};let T=[];K.forEach(P=>{const z=Array.isArray(P)?P:[P];z.length===1&&T.push(z[0])});let L=[];if(ee.forEach(P=>{const z=Array.isArray(P)?P:[P];z.length===1&&L.push(z[0])}),L.length>0){const P=E.type==="polyline"||E.type==="polygon"||E.type==="pen"?E.points:Ut(E);L.forEach(z=>{T.push(z),T.push((z+1)%P.length)}),T=Array.from(new Set(T))}if(E.type==="pen"||E.type==="polyline"||E.type==="polygon")if(T.length>0){T.sort((z,F)=>z-F);const P=T.filter((z,F)=>F%2===1);E.points.length-P.length>=2&&(E.points=E.points.filter((z,F)=>!P.includes(F)),v[A]=E,S=!0)}else E.points.length>2&&(E.points=E.points.filter((P,z)=>z%2===0),v[A]=E,S=!0);else if(E.type==="circle"||E.type==="star"||E.type==="rect"){const P=Ut(E);let z=[];if(T.length>0){T.sort((X,q)=>X-q);const F=T.filter((X,q)=>q%2===1);z=P.filter((X,q)=>!F.includes(q))}else z=P.filter((F,X)=>X%2===0);if(z.length>=2){const F={type:"polygon",color:E.color,renderMode:E.renderMode,points:z,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1};v[A]=F,S=!0}}}),S&&(y[x]=v,j(y),nt(y),K.length>0&&Z([]),ee.length>0&&V([]))},Aa=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]];let S=!1;const A=.5;O.forEach(E=>{const T={...v[E]};let L=[];T.type==="pen"||T.type==="polyline"||T.type==="polygon"?L=T.points:(T.type==="circle"||T.type==="star"||T.type==="rect")&&(L=Ut(T),T.type="polygon",T.rotationX=0,T.rotationY=0,T.rotationZ=0,T.scaleX=1,T.scaleY=1);let P=[];if(K.length>0&&K.forEach(z=>{const F=Array.isArray(z)?z:[z];F.length===1&&P.push(F[0])}),L.length>1){const z=[L[0]];for(let F=1;F<L.length;F++)P.length===0||P.includes(F)?Lt(L[F],z[z.length-1])>A&&z.push(L[F]):z.push(L[F]);T.type==="polygon"&&z.length>2&&(P.length===0||P.includes(L.length-1),Lt(z[z.length-1],z[0])<A&&(P.length,z.pop())),z.length!==L.length&&(T.points=z,v[E]=T,S=!0)}}),S&&(y[x]=v,j(y),nt(y),K.length>0&&Z([]))},Cr=()=>{if(O.length===0)return;const y=[...D],v=[...y[x]];let S=!1;const A=150*(Math.PI/180),E=(T,L,P)=>{const z=Math.atan2(T.y-L.y,T.x-L.x),F=Math.atan2(P.y-L.y,P.x-L.x);let X=Math.abs(z-F);return X>Math.PI&&(X=2*Math.PI-X),X};O.forEach(T=>{const L={...v[T]};let P=[];L.type==="pen"||L.type==="polyline"||L.type==="polygon"?P=L.points:(L.type==="circle"||L.type==="star"||L.type==="rect")&&(P=Ut(L),L.type="polygon",L.rotationX=0,L.rotationY=0,L.rotationZ=0,L.scaleX=1,L.scaleY=1);let z=[];if(K.length>0&&K.forEach(F=>{const X=Array.isArray(F)?F:[F];X.length===1&&z.push(X[0])}),P.length>2){const F=[],X=L.type==="polygon"||L.type==="rect"||L.type==="circle"||L.type==="star";for(let q=0;q<P.length;q++){if(F.push(P[q]),z.length>0&&!z.includes(q))continue;let ie,le;if(q===0)if(X)ie=P[P.length-1];else continue;else ie=P[q-1];if(q===P.length-1)if(X)le=P[0];else continue;else le=P[q+1];E(ie,P[q],le)<A&&F.push({...P[q]})}F.length!==P.length&&(L.points=F,v[T]=L,S=!0)}}),S&&(y[x]=v,j(y),nt(y)),rt({visible:!1,x:0,y:0,target:null})},Va=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import ILDA",filters:[{name:"ILDA Files",extensions:["ild"]}],properties:["openFile"]});if(y){Ve(!0);try{const v=await window.electronAPI.readFileAsBinary(y),{frames:S}=Yv(v);if(S&&S.length>0){const A=S.map(E=>{const T=[];let L=[];if(E.points.forEach(P=>{const z=P.x*500+500,F=(1-P.y)*500,X=`rgb(${P.r},${P.g},${P.b})`;if(P.blanking){if(L.length>1){const q=L[0];Math.sqrt(Math.pow(q.x-z,2)+Math.pow(q.y-F,2))<2?T.push({type:"polygon",points:L,color:L[0].color,renderMode:"simple",rotation:0}):T.push({type:"polyline",points:L,color:L[0].color,renderMode:"simple",rotation:0})}L=[]}else L.push({x:z,y:F,color:X})}),L.length>1){const P=L[0],z=L[L.length-1];Math.sqrt(Math.pow(P.x-z.x,2)+Math.pow(P.y-z.y,2))<2?T.push({type:"polygon",points:L,color:L[0].color,renderMode:"simple",rotation:0}):T.push({type:"polyline",points:L,color:L[0].color,renderMode:"simple",rotation:0})}return T});j(A),nt(A),b(A.length),M(0)}}catch(v){console.error(v)}finally{Ve(!1)}}},Mr=async()=>{if(!window.electronAPI)return;const y=await window.electronAPI.showOpenDialog({title:"Import SVG",filters:[{name:"SVG Files",extensions:["svg"]}],properties:["openFile"]});if(y){Ve(!0);try{const v=await window.electronAPI.readFileContent(y),S=new DOMParser,A=new TextDecoder().decode(v),T=S.parseFromString(A,"image/svg+xml").querySelector("svg");if(!T)throw new Error("Invalid SVG");let L=T.getAttribute("viewBox")?.split(/[\s,]+/).map(parseFloat);if(!L||L.length!==4){const Ae=parseFloat(T.getAttribute("width"))||1e3,De=parseFloat(T.getAttribute("height"))||1e3;L=[0,0,Ae,De]}const[P,z,F,X]=L,q=Math.min(Qe/F,Qe/X)*.8,ie=(Qe-F*q)/2-P*q,le=(Qe-X*q)/2-z*q,oe=[],ge=document.createElement("div");ge.style.display="none",ge.innerHTML=A,document.body.appendChild(ge);const fe=ge.querySelector("svg"),be=(Ae,De=new DOMMatrix)=>{let Ie="";const Ge=Ae.tagName.toLowerCase();let ft=new DOMMatrix(Ae.getAttribute("transform")||"");const it=De.multiply(ft);if(Ge==="g"){Array.from(Ae.children).forEach($e=>be($e,it));return}if(Ge==="path")Ie=Ae.getAttribute("d");else if(Ge==="rect"){const $e=parseFloat(Ae.getAttribute("x"))||0,ra=parseFloat(Ae.getAttribute("y"))||0,Ht=parseFloat(Ae.getAttribute("width"))||0,Rt=parseFloat(Ae.getAttribute("height"))||0;Ie=`M${$e},${ra} h${Ht} v${Rt} h${-Ht} z`}else if(Ge==="circle"||Ge==="ellipse"){const $e=parseFloat(Ae.getAttribute("cx"))||0,ra=parseFloat(Ae.getAttribute("cy"))||0,Ht=parseFloat(Ae.getAttribute("rx"))||parseFloat(Ae.getAttribute("r"))||0,Rt=parseFloat(Ae.getAttribute("ry"))||parseFloat(Ae.getAttribute("r"))||0;Ie=`M${$e-Ht},${ra} a${Ht},${Rt} 0 1,0 ${Ht*2},0 a${Ht},${Rt} 0 1,0 ${-Ht*2},0 z`}else Ge==="line"?Ie=`M${Ae.getAttribute("x1")},${Ae.getAttribute("y1")} L${Ae.getAttribute("x2")},${Ae.getAttribute("y2")}`:(Ge==="polyline"||Ge==="polygon")&&(Ie=`M${Ae.getAttribute("points")}${Ge==="polygon"?" z":""}`);if(!Ie)return;const ht=document.createElementNS("http://www.w3.org/2000/svg","path");ht.setAttribute("d",Ie),fe.appendChild(ht);const xt=ht.getTotalLength();if(xt>0){const $e=[],ra=xt*q*Math.max(it.a,it.d),Ht=Math.min(1e3,Math.max(10,Math.floor(ra/5)));for(let Rt=0;Rt<=Ht;Rt++){const Mt=ht.getPointAtLength(Rt/Ht*xt),St=new DOMPoint(Mt.x,Mt.y).matrixTransform(it);$e.push({x:St.x*q+ie,y:St.y*q+le,color:s})}oe.push({type:"polyline",points:$e,color:s,renderMode:"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1})}};if(Array.from(T.children).forEach(Ae=>be(Ae)),document.body.removeChild(ge),oe.length>0){const Ae=[...D];Ae[x]=[...Ae[x]||[],...oe],j(Ae),nt(Ae)}}catch(v){console.error("SVG Import Error:",v),alert("Error importing SVG: "+v.message)}finally{Ve(!1)}}},Nr=()=>{if(confirm("Press OK to clear ALL frames in the animation, or CANCEL to clear only the CURRENT frame.")){const v=D.map(()=>[]);j(v),nt(v)}else{const v=[...D];v[x]=[],j(v),nt(v)}W([]),Z([])},yn=()=>{if(O.length===0)return;let y;if(K.length>0&&O.length===1){const v=Pe[O[0]],S=Bn(v);y={type:"polyline",points:K.map(E=>({...S[E]})),color:v.color,renderMode:v.renderMode||"simple",rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}}else y=O.map(v=>JSON.parse(JSON.stringify(Pe[v])));$({data:y,sourceFrameIndex:x}),rt({visible:!1})},Pn=()=>{if(!xe)return;const{data:y}=xe,v=Array.isArray(y)?JSON.parse(JSON.stringify(y)):[JSON.parse(JSON.stringify(y))],S=[...D],A=[...S[x]||[]];v.forEach(E=>{A.push(E)}),S[x]=A,j(S),nt(S),W(v.map((E,T)=>A.length-v.length+T)),Z([]),rt({visible:!1})},bs=()=>{const y=[...D];y.splice(x+1,0,JSON.parse(JSON.stringify(D[x]))),j(y),nt(y),b(v=>v+1),M(v=>v+1)},kr=()=>{if(ae>0&&Y[ae-1]){const y=ae-1;re(y),j(JSON.parse(JSON.stringify(Y[y])))}},Ti=()=>{if(ae<Y.length-1&&Y[ae+1]){const y=ae+1;re(y),j(JSON.parse(JSON.stringify(Y[y])))}};N.useEffect(()=>{},[D]);const vn=y=>{if(O.length===0)return;const v=(S,A)=>{let E={...S,...A};return A.color&&(E.points&&(E.points=E.points.map(T=>({...T,color:A.color}))),E.startColor&&(E.startColor=A.color),E.endColor&&(E.endColor=A.color),E.cornerColors&&(E.cornerColors=E.cornerColors.map(()=>A.color)),E.centerColor&&(E.centerColor=A.color),E.outerColor&&(E.outerColor=A.color)),E.type==="group"&&E.shapes&&(E.shapes=E.shapes.map(T=>v(T,A))),E};j(S=>{const A=[...S],E=[...A[x]];return O.forEach(T=>{E[T]&&(E[T]=v(E[T],y))}),A[x]=E,nt(A),A})},xs=y=>{O.length!==1||K.length===0||j(v=>{const S=[...v],A=[...S[x]],E=O[0];if(!A[E])return v;let T={...A[E]};return K.forEach(L=>{const P=Array.isArray(L)?L:[L],z=(F,X,q)=>{if(X.length===1){const ie=X[0],le={...F};return le.points?(le.points=[...le.points],le.points[ie]={...le.points[ie],color:q}):le.type==="line"?ie===0?le.startColor=q:le.endColor=q:le.type==="rect"?(le.cornerColors=[...le.cornerColors||[le.color,le.color,le.color,le.color]],le.cornerColors[ie]=q):(le.type==="circle"||le.type==="star")&&(ie===0?le.centerColor=q:le.outerColor=q),le}else{const[ie,...le]=X,oe={...F};return oe.shapes=[...oe.shapes],oe.shapes[ie]=z(oe.shapes[ie],le,q),oe}};T=z(T,P,y)}),A[E]=T,S[x]=A,nt(S),S})},$r=async()=>{if(!D.every(y=>y.length===0)){cn(!0);try{const v=D.slice(nr).map(A=>{const E=[];return A.forEach((T,L)=>{const P=T.renderMode||"simple",z=Ut(T),F=ie=>({...ie,x:(ie.x-500)/500,y:1-ie.y/500}),X=z.map(F);if(X.length<2)return;const q=[];for(let ie=0;ie<X.length-1;ie++){let le=P;P==="dashed"&&ie%2===1&&(le="blanked");const oe=fr(X[ie],X[ie+1],le);ie<X.length-2?q.push(...oe.slice(0,-1)):q.push(...oe)}if(T.type==="polygon"||T.type==="rect"||T.type==="circle"||T.type==="star"||T.type==="triangle"){const ie=X[0],le=X[X.length-1];if(Math.sqrt(Math.pow(ie.x-le.x,2)+Math.pow(ie.y-le.y,2))>.001){let ge=P;P==="dashed"&&(X.length-1)%2===1&&(ge="blanked");const fe=fr(X[X.length-1],X[0],ge);fe.length>1&&q.push(...fe.slice(1))}}q.length>0&&(E.push({...q[0],blanking:!0}),E.push(...q))}),{points:E,frameName:"SHAPE"}}),S=ag(v);await window.electronAPI.saveIldaFile(S,"built_shape.ild")}catch(y){console.error(y)}finally{cn(!1)}}},fr=(y,v,S)=>{const A=Un(y.color||s),E=Un(v.color||s);if(S==="dotted")return[{x:y.x,y:y.y,r:A.r,g:A.g,b:A.b,blanking:!1},{x:y.x,y:y.y,r:A.r,g:A.g,b:A.b,blanking:!1}];const T=S==="blanked";return[{x:y.x,y:y.y,r:A.r,g:A.g,b:A.b,blanking:T},{x:v.x,y:v.y,r:E.r,g:E.g,b:E.b,blanking:T}]},Ss=()=>{if(_&&(_.type==="polygon"||_.type==="polyline"||_.type==="bezier")){let y={..._};if(_.type==="polygon"||_.type==="polyline"?y.points=_.points.slice(0,-1):_.type==="bezier"&&Ct&&(y.anchors=_.anchors.slice(0,-1),y.points=al(y.anchors,!1)),y.type==="bezier"&&y.anchors.length>1||y.points.length>1){const v=[...D];v[x]=[...v[x]||[],y],j(v),nt(v),W([v[x].length-1])}}p(!1),G(null)},dl=y=>{if(y.button===1||y.button===0&&y.altKey){Sa.current=!0,et.current={x:y.clientX,y:y.clientY};return}if(y.button!==0)return;const v=An(y.clientX,y.clientY),S=Fa(v.x,v.y),A=S.x,E=S.y;if(rt({visible:!1}),e==="select"){const T=[];for(let L=Pe.length-1;L>=0;L--){const P=Ba(Pe[L],v,O.includes(L),K);P&&T.push({...P,shapeIndex:L})}if(T.length>0){let L=T[0];const P=O[0];if(T.length>1&&T[0].shapeIndex===P)if(T[0].type==="point"){const X=T[0].path||[T[0].index];K.some(ie=>JSON.stringify(ie)===JSON.stringify(X))&&(L=T[1])}else L=T[1];const z=L.shapeIndex,F=L;if(F.type==="point"){const X=F.path||[F.index];y.shiftKey?O.includes(z)?Z(q=>q.some(le=>JSON.stringify(le)===JSON.stringify(X))?q.filter(le=>JSON.stringify(le)!==JSON.stringify(X)):[...q,X]):(W([z]),Z([X])):(Z([X]),W([z])),xa.current=!0}else if(F.type==="segment"){const X=F.path||[F.index];y.shiftKey?O.includes(z)?V(q=>q.some(le=>JSON.stringify(le)===JSON.stringify(X))?q.filter(le=>JSON.stringify(le)!==JSON.stringify(X)):[...q,X]):(W([z]),V([X])):(V([X]),W([z]),Z([])),Mn.current=!0}else F.type==="pivot"?rr.current=!0:(!y.shiftKey&&!O.includes(z)?W([z]):y.shiftKey&&W(X=>X.includes(z)?X.filter(q=>q!==z):[...X,z]),Mn.current=!0);et.current=v}else Ln.current=!0,et.current=v,Et.current={x:v.x,y:v.y,w:0,h:0};return}if(p(!0),et.current=v,e==="polygon"||e==="polyline"||(e==="line"||e==="bezier")&&Ct)if(!_)e==="bezier"?(G({type:"bezier",color:s,renderMode:o,isSmooth:!0,anchors:[{x:A,y:E,color:s},{x:A,y:E,color:s}],points:[{x:A,y:E,color:s},{x:A,y:E,color:s},{x:A,y:E,color:s},{x:A,y:E,color:s}],rotation:0}),Se(-1)):G({type:e==="polygon"?"polygon":"polyline",color:s,renderMode:o,points:[{x:A,y:E,color:s},{x:A,y:E,color:s}],rotation:0});else{const T=_.type==="bezier"?_.anchors[0]:_.points[0];if(Lt({x:A,y:E},T)<15/Q&&(_.type==="bezier"&&_.anchors.length>2||_.points.length>3)){let P={..._};_.type==="bezier"?(P.anchors=_.anchors.slice(0,-1),P.closed=!0,P.points=al(P.anchors,!0)):(P.points=_.points.slice(0,-1),P.type="polygon");const z=[...D];z[x]=[...z[x]||[],P],j(z),nt(z),W([z[x].length-1]),p(!1),G(null);return}if(e==="bezier"){const P=[..._.anchors,{x:A,y:E,color:s}],z=al(P,!1);G(F=>({...F,anchors:P,points:z}))}else G(P=>({...P,points:[...P.points,{x:A,y:E,color:s}]}))}else{const T={type:e,color:s,renderMode:o,start:{x:A,y:E},end:{x:A,y:E},width:0,height:0,rotation:0,scaleX:1,scaleY:1,rotationX:0,rotationY:0,rotationZ:0};if(e==="pen")T.points=[{x:A,y:E,color:s},{x:A,y:E,color:s}];else if(e==="bezier"){const L=[{x:A,y:E,color:s},{x:A,y:E,color:s}],P=al(L,!1);T.isSmooth=!0,T.anchors=L,T.points=P}G(T)}},Rr=N.useCallback((y,v,S)=>{const A={...y};return y.type==="group"?A.shapes=y.shapes.map(E=>Rr(E,v,S)):(y.points&&(A.points=y.points.map(E=>({...E,x:E.x+v,y:E.y+S}))),y.anchors&&(A.anchors=y.anchors.map(E=>({...E,x:E.x+v,y:E.y+S}))),y.start&&(A.start={...y.start,x:y.start.x+v,y:y.start.y+S}),y.end&&(A.end={...y.end,x:y.end.x+v,y:y.end.y+S})),y.pivotX!==void 0&&(A.pivotX=y.pivotX+v),y.pivotY!==void 0&&(A.pivotY=y.pivotY+S),A},[]),ha=N.useCallback((y,v,S,A)=>{if(v.length===1){const E=v[0],T={...y};if(T.type==="line")E===0?T.start={...T.start,x:T.start.x+S,y:T.start.y+A}:T.end={...T.end,x:T.end.x+S,y:T.end.y+A};else if(T.type==="rect")E===0?(T.start={...T.start,x:T.start.x+S,y:T.start.y+A},T.width-=S,T.height-=A):E===1?(T.start={...T.start,y:T.start.y+A},T.width+=S,T.height-=A):E===2?(T.width+=S,T.height+=A):E===3&&(T.start={...T.start,x:T.start.x+S},T.width-=S,T.height+=A);else if(T.type==="circle"||T.type==="star"||T.type==="triangle")E===0?T.start={...T.start,x:T.start.x+S,y:T.start.y+A}:E===1?T.end={...T.end,x:T.end.x+S}:E===2&&(T.end={...T.end,y:T.end.y+A});else if(T.points&&(T.points=[...T.points],T.points[E]&&(T.points[E]={...T.points[E],x:T.points[E].x+S,y:T.points[E].y+A},T.type==="bezier"&&T.isSmooth)))if(E%3!==0)T.manualIndices||(T.manualIndices=[]),T.manualIndices.includes(E)||T.manualIndices.push(E);else{const P=E/3;T.anchors&&T.anchors[P]&&(T.anchors[P].x+=S,T.anchors[P].y+=A,al(T.anchors,T.closed).forEach((F,X)=>{T.manualIndices&&T.manualIndices.includes(X)||(T.points[X].x=F.x,T.points[X].y=F.y)}))}return T}else{const[E,...T]=v,L={...y};return L.shapes=[...L.shapes],L.shapes[E]=ha(L.shapes[E],T,S,A),L}},[]),ws=y=>{const v=An(y.clientX,y.clientY);if(Sa.current){const T=(y.clientX-et.current.x)/Q,L=(y.clientY-et.current.y)/Q;Ue(P=>({x:P.x+T,y:P.y+L})),et.current={x:y.clientX,y:y.clientY};return}if(Qs.current&&O.length>0){const T=Wn(Pe[O[0]]);vn({rotationZ:Math.atan2(v.y-T.y,v.x-T.x)+Math.PI/2});return}if(Ln.current){Et.current={x:Math.min(et.current.x,v.x),y:Math.min(et.current.y,v.y),w:Math.abs(v.x-et.current.x),h:Math.abs(v.y-et.current.y)},pn(T=>T+1);return}if(Mn.current){const T=v.x-et.current.x,L=v.y-et.current.y,P=Pe[O[0]],z=jn(P),F=Fa(z.x+T,z.y+L),X=F.x-z.x,q=F.y-z.y;(X!==0||q!==0)&&(j(ie=>{const le=[...ie],oe=[...le[x]];return O.forEach(ge=>{oe[ge]=Rr({...oe[ge]},X,q)}),le[x]=oe,le}),et.current.x+=X,et.current.y+=q);return}if(rr.current&&O.length===1){const T=Fa(v.x,v.y);j(L=>{const P=[...L],z=[...P[x]];return z[O[0]]={...z[O[0]],pivotX:T.x,pivotY:T.y},P[x]=z,P});return}if(xa.current&&O.length===1){const T=v.x-et.current.x,L=v.y-et.current.y,P=Pe[O[0]],z=K[0],F=qr(P,z);if(F){const X=Fa(F.x+T,F.y+L,K),q=X.x-F.x,ie=X.y-F.y;(q!==0||ie!==0)&&(j(le=>{const oe=[...le],ge=[...oe[x]];let fe={...ge[O[0]]};return K.forEach(be=>{const Ae=Array.isArray(be)?be:[be];fe=ha(fe,Ae,q,ie)}),ge[O[0]]=fe,oe[x]=ge,oe}),et.current.x+=q,et.current.y+=ie)}return}if(!h)return;const S=Fa(v.x,v.y),A=S.x,E=S.y;G(T=>{if(!T)return null;const L={...T},P=y.shiftKey;if(e==="pen")L.points=[...T.points,{x:A,y:E,color:s}];else if(e==="bezier"){const z=[...L.anchors],F=z.length-1;z[F]={x:A,y:E,color:s},L.anchors=z,L.points=al(z,!1)}else if(L.type==="polyline"||L.type==="polygon"){const z=[...L.points];let F=A,X=E;if(P){const q=z[z.length-2];Math.abs(A-q.x)>Math.abs(E-q.y)?X=q.y:F=q.x}z[z.length-1]={x:F,y:X,color:s},L.points=z}else if(e==="line"){let z=A,F=E;P&&(Math.abs(A-et.current.x)>Math.abs(E-et.current.y)?F=et.current.y:z=et.current.x),L.end={x:z,y:F}}else if(e==="circle"||e==="star"||e==="triangle"){let z=A,F=E;if(P){const X=Math.max(Math.abs(A-et.current.x),Math.abs(E-et.current.y));z=et.current.x+(A>=et.current.x?X:-X),F=et.current.y+(E>=et.current.y?X:-X)}L.end={x:z,y:F}}else if(e==="rect"){let z=A-et.current.x,F=E-et.current.y;if(P){const X=Math.max(Math.abs(z),Math.abs(F));z=z>0?X:-X,F=F>0?X:-X}L.width=z,L.height=F}return L})},Ci=y=>{if(Ln.current&&Et.current){const A=Et.current,E=y.shiftKey;if(A.w<5/Q&&A.h<5/Q)E||(W([]),Z([]),V([]));else if(O.length===1){const T=O[0],L=Pe[T],P=Bn(L),z=[];if(P.forEach((F,X)=>{F.x>=A.x&&F.x<=A.x+A.w&&F.y>=A.y&&F.y<=A.y+A.h&&z.push(X)}),z.length>0)Z(E?F=>Array.from(new Set([...F,...z])).sort((X,q)=>X-q):z);else{const F=[];Pe.forEach((X,q)=>{if(X.hidden||X.locked)return;const ie=fa(X);ie.x<A.x+A.w&&ie.x+ie.w>A.x&&ie.y<A.y+A.h&&ie.y+ie.h>A.y&&F.push(q)}),E?W(X=>Array.from(new Set([...X,...F]))):(W(F),Z([]))}}else{const T=[];Pe.forEach((L,P)=>{if(L.hidden||L.locked)return;const z=fa(L);z.x<A.x+A.w&&z.x+z.w>A.x&&z.y<A.y+A.h&&z.y+z.h>A.y&&T.push(P)}),E?W(L=>Array.from(new Set([...L,...T]))):(W(T),Z([]))}}if((xa.current||Mn.current||rr.current)&&nt(D),xa.current=!1,Mn.current=!1,rr.current=!1,Qs.current=!1,Ln.current=!1,Sa.current=!1,Et.current=null,!h)return;const v=_.type==="polygon"||_.type==="polyline",S=_.type==="bezier"&&Ct;if(_&&!v&&!S){const A=[...D];A[x]=[...A[x]||[],_],j(A),nt(A),W([A[x].length-1]),p(!1),G(null)}},Dr=(y,v,S,A=!1,E=[])=>{if(!v||v.hidden)return;if(y.save(),v.type==="group"){if(v.shapes.forEach((F,X)=>Dr(y,F,!1,A,[...E,X])),y.restore(),S&&!A){y.save();const F=jn(v),X=Wn(v);y.fillStyle="#0089ff",y.beginPath(),y.arc(F.x,F.y,6/Q,0,Math.PI*2),y.fill(),y.strokeStyle="white",y.lineWidth=1/Q,y.stroke();const q=fa(v);y.beginPath(),y.moveTo(F.x,q.y),y.lineTo(F.x,q.y-30/Q),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(F.x,q.y-30/Q,6/Q,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke(),y.strokeStyle="var(--theme-color)",y.lineWidth=2/Q,y.beginPath(),y.moveTo(X.x-10/Q,X.y),y.lineTo(X.x+10/Q,X.y),y.moveTo(X.x,X.y-10/Q),y.lineTo(X.x,X.y+10/Q),y.stroke(),y.beginPath(),y.arc(X.x,X.y,5/Q,0,Math.PI*2),y.stroke(),y.restore()}return}const T=jn(v);y.lineWidth=(S?2.5:1.5)/Q;const L=(F,X,q="simple",ie=[])=>{if(!F||F.length<2)return;if(ee.length>0){y.save(),y.lineWidth=6/Q,y.globalAlpha=.6,y.lineCap="round";for(let oe=0;oe<F.length-1;oe++){const ge=[...ie,oe];ee.some(be=>JSON.stringify(be)===JSON.stringify(ge))&&(y.strokeStyle=da(F[oe].color||v.color),y.beginPath(),y.moveTo(F[oe].x,F[oe].y),y.lineTo(F[oe+1].x,F[oe+1].y),y.stroke())}if(X&&F.length>2){const oe=F.length-1,ge=[...ie,oe];ee.some(be=>JSON.stringify(be)===JSON.stringify(ge))&&(y.strokeStyle=da(F[oe].color||v.color),y.beginPath(),y.moveTo(F[oe].x,F[oe].y),y.lineTo(F[0].x,F[0].y),y.stroke())}y.restore()}let le=!1;y.beginPath(),F[0]&&y.moveTo(F[0].x,F[0].y);for(let oe=0;oe<F.length-1;oe++){if(q==="dashed"&&oe%2===1){le&&(y.stroke(),le=!1),y.moveTo(F[oe+1].x,F[oe+1].y);continue}const ge=F[oe],fe=F[oe+1];if(!ge||!fe)continue;const be=A?"#444":ge.color||v.color,Ae=A?"#444":fe.color||v.color;if(be!==Ae){le&&(y.stroke(),le=!1);const De=y.createLinearGradient(ge.x,ge.y,fe.x,fe.y);De.addColorStop(0,be),De.addColorStop(1,Ae),y.strokeStyle=De,y.beginPath(),y.moveTo(ge.x,ge.y),y.lineTo(fe.x,fe.y),y.stroke(),y.beginPath(),y.moveTo(fe.x,fe.y)}else y.strokeStyle!==be&&(le&&(y.stroke(),y.beginPath(),y.moveTo(ge.x,ge.y)),y.strokeStyle=be),y.lineTo(fe.x,fe.y),le=!0}if(X&&F.length>2){const oe=F.length-1;if(q==="dashed"&&oe%2===1)le&&y.stroke();else{const ge=F[oe],fe=F[0],be=A?"#444":ge.color||v.color,Ae=A?"#444":fe.color||v.color;if(be!==Ae){le&&y.stroke();const De=y.createLinearGradient(ge.x,ge.y,fe.x,fe.y);De.addColorStop(0,be),De.addColorStop(1,Ae),y.strokeStyle=De,y.beginPath(),y.moveTo(ge.x,ge.y),y.lineTo(fe.x,fe.y),y.stroke()}else y.strokeStyle!==be&&le&&(y.stroke(),y.beginPath(),y.moveTo(ge.x,ge.y),y.strokeStyle=be),y.lineTo(fe.x,fe.y),y.stroke(),le=!1}}else le&&y.stroke();q==="dotted"&&F.forEach(oe=>{y.fillStyle=A?"#444":oe.color||v.color,y.beginPath(),y.arc(oe.x,oe.y,3/Q,0,Math.PI*2),y.fill()})},P=(F,X,q="simple",ie=[])=>{if(!F||!X)return;const le=[...ie,0];if(ee.some(be=>JSON.stringify(be)===JSON.stringify(le))&&(y.save(),y.strokeStyle=da(F.color||v.color),y.lineWidth=6/Q,y.globalAlpha=.6,y.lineCap="round",y.beginPath(),y.moveTo(F.x,F.y),y.lineTo(X.x,X.y),y.stroke(),y.restore()),q==="dotted"){[F,X].forEach(be=>{y.fillStyle=A?"#444":be.color||v.color,y.beginPath(),y.arc(be.x,be.y,3/Q,0,Math.PI*2),y.fill()});return}const ge=A?"#444":F.color||v.color,fe=A?"#444":X.color||v.color;if(ge===fe)y.strokeStyle=ge;else{const be=y.createLinearGradient(F.x,F.y,X.x,X.y);be.addColorStop(0,ge),be.addColorStop(1,fe),y.strokeStyle=be}y.beginPath(),y.moveTo(F.x,F.y),y.lineTo(X.x,X.y),y.stroke()};if(v.renderMode==="points"){Ut({...v,rotation:0,rotationX:0,rotationY:0,rotationZ:0,scaleX:1,scaleY:1}).forEach(F=>{y.fillStyle=A?"#444":F.color||v.color,y.beginPath(),y.arc(F.x,F.y,3/Q,0,Math.PI*2),y.fill()}),y.restore();return}const z=v.renderMode||"simple";switch(v.type){case"pen":case"polyline":case"bezier":{const F=Ut(v);L(F,!1,z,E);break}case"polygon":{const F=Ut(v);L(F,!0,z,E);break}case"line":{const F=Ut(v);P(F[0],F[1],z,E);break}case"rect":{const F=Ut(v);L(F,!0,z,E);break}case"circle":{const F=Ut(v);L(F,!0,z,E);break}case"star":{const F=Ut(v);L(F,!0,z,E);break}}if(S&&!A){const F=Bn(v);if(v.type==="bezier"){y.save(),y.setLineDash([5/Q,5/Q]),y.strokeStyle="rgba(255,255,255,0.3)",y.lineWidth=1/Q;for(let ie=0;ie<=F.length-4;ie+=3)y.beginPath(),y.moveTo(F[ie].x,F[ie].y),y.lineTo(F[ie+1].x,F[ie+1].y),y.stroke(),y.beginPath(),y.moveTo(F[ie+2].x,F[ie+2].y),y.lineTo(F[ie+3].x,F[ie+3].y),y.stroke();y.restore()}F.forEach((ie,le)=>{const oe=[...E,le],ge=K.some(be=>{const Ae=Array.isArray(be)?be:[be];return JSON.stringify(Ae)===JSON.stringify(oe)});let fe=!1;if(v.type==="bezier"&&(fe=le%3!==0),y.fillStyle=ge?"var(--theme-color)":fe?"#888":"white",y.beginPath(),fe){const be=4/Q;y.rect(ie.x-be,ie.y-be,be*2,be*2)}else y.arc(ie.x,ie.y,5/Q,0,Math.PI*2);y.fill(),y.strokeStyle=ge?"white":"black",y.lineWidth=1/Q,y.stroke()});const X=Math.min(...F.map(ie=>ie.y));y.beginPath(),y.moveTo(T.x,X),y.lineTo(T.x,X-30/Q),y.strokeStyle="white",y.stroke(),y.beginPath(),y.arc(T.x,X-30/Q,6/Q,0,Math.PI*2),y.fillStyle="#0089ff",y.fill(),y.stroke();const q=Wn(v);y.strokeStyle="var(--theme-color)",y.lineWidth=2/Q,y.beginPath(),y.moveTo(q.x-10/Q,q.y),y.lineTo(q.x+10/Q,q.y),y.moveTo(q.x,q.y-10/Q),y.lineTo(q.x,q.y+10/Q),y.stroke(),y.beginPath(),y.arc(q.x,q.y,5/Q,0,Math.PI*2),y.stroke()}y.restore()};N.useEffect(()=>{const y=Xn.current;if(!y)return;const v=y.getContext("2d");let S;const A=()=>{if(Xn.current){if(v.save(),v.clearRect(0,0,y.width,y.height),v.translate(y.width/2,y.height/2),v.scale(Q,Q),v.translate(-Qe/2+Re.x,-Qe/2+Re.y),v.fillStyle="#000",v.fillRect(0,0,Qe,Qe),we){v.beginPath(),v.strokeStyle="#222",v.lineWidth=.5/Q;for(let E=0;E<=Qe;E+=ot)v.moveTo(E,0),v.lineTo(E,Qe);for(let E=0;E<=Qe;E+=ot)v.moveTo(0,E),v.lineTo(Qe,E);v.stroke(),v.beginPath(),v.strokeStyle="#444",v.lineWidth=1/Q,v.moveTo(Qe/2,0),v.lineTo(Qe/2,Qe),v.moveTo(0,Qe/2),v.lineTo(Qe,Qe/2),v.stroke()}te&&(v.globalAlpha=.3,v.drawImage(te,0,0,Qe,Qe),v.globalAlpha=1),H&&x>0&&!R&&D[x-1]&&(v.globalAlpha=.15,D[x-1].forEach(E=>Dr(v,E,!1,!0)),v.globalAlpha=1),Pe.length>0&&Pe.forEach((E,T)=>Dr(v,E,O.includes(T))),h&&_&&Dr(v,_,!1),Ln.current&&Et.current&&(v.fillStyle="rgba(0, 137, 255, 0.3)",v.fillRect(Et.current.x,Et.current.y,Et.current.w,Et.current.h),v.strokeStyle="#0089ff",v.lineWidth=2/Q,v.setLineDash([]),v.strokeRect(Et.current.x,Et.current.y,Et.current.w,Et.current.h)),v.restore(),S=requestAnimationFrame(A)}};return S=requestAnimationFrame(A),()=>cancelAnimationFrame(S)},[D,x,_,h,te,we,ot,O,K,ee,H,R,Q,Re,Wt]),N.useEffect(()=>{if(!R||g<=1){ut.current=0;return}let y;Nn.current=performance.now();const v=S=>{const A=S-Nn.current;if(Nn.current=S,A>500||A<=0){y=requestAnimationFrame(v);return}ut.current+=A;const E=Hr.current,T=Math.max(.01,ca.current),L=Math.max(1,kt.current),P=gn.current,z=Math.max(1,L-P);let F=33.33;if(E==="fps"?F=1e3/(Math.max(1,ta.current)*T):E==="bpm"?F=6e4/Math.max(1,ua.current)*Math.max(1,mn.current)/z/T:E==="time"&&(F=Math.max(.1,ba.current)*1e3/z/T),F=Math.max(1,F),ut.current>=F){const X=Math.floor(ut.current/F);X>0&&(M(q=>{const ie=q+X;return ie>=L?P+(ie-P)%z:ie}),ut.current-=X*F)}y=requestAnimationFrame(v)};return y=requestAnimationFrame(v),()=>{y&&cancelAnimationFrame(y)}},[R,g]),N.useEffect(()=>{const y=na.current;if(y)return y.addEventListener("wheel",Er,{passive:!1}),()=>y.removeEventListener("wheel",Er)},[Q]),N.useEffect(()=>{w(g)},[g]),N.useEffect(()=>{j(y=>{const v=[...y];if(g>y.length)for(let S=y.length;S<g;S++)v.push([]);else if(g<y.length)return v.slice(0,g);return v})},[g]),N.useEffect(()=>{const y=v=>{rt({visible:!1,x:0,y:0,target:null}),h&&_&&v.target!==Xn.current&&Ss()};return window.addEventListener("click",y),()=>window.removeEventListener("click",y)},[h,_]),N.useEffect(()=>{R||(W([]),Z([]),V([]))},[x,R]),N.useEffect(()=>{const y=v=>{const S=["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)||document.activeElement.isContentEditable;if((v.ctrlKey||v.metaKey)&&v.key==="z")S||(v.preventDefault(),kr());else if((v.ctrlKey||v.metaKey)&&v.key==="y")S||(v.preventDefault(),Ti());else if((v.ctrlKey||v.metaKey)&&v.key==="c")S||(v.preventDefault(),yn());else if((v.ctrlKey||v.metaKey)&&v.key==="v")S||(v.preventDefault(),Pn());else if(v.key===" "||v.code==="Space")S||(v.preventDefault(),I(A=>!A));else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(v.key)){if(!S){const A=O.length>0||K.length>0;if(!A&&(v.key==="ArrowLeft"||v.key==="ArrowRight"))v.preventDefault(),v.key==="ArrowLeft"?M(E=>Math.max(0,E-1)):M(E=>Math.min(g-1,E+1));else if(A){v.preventDefault();const E=v.shiftKey?10:1;let T=0,L=0;v.key==="ArrowLeft"?T=-E:v.key==="ArrowRight"?T=E:v.key==="ArrowUp"?L=-E:v.key==="ArrowDown"&&(L=E),j(P=>{const z=[...P],F=[...z[x]];if(K.length>0&&O.length===1){const X=O[0];let q={...F[X]};K.forEach(ie=>{const le=Array.isArray(ie)?ie:[ie];q=ha(q,le,T,L)}),F[X]=q}else O.forEach(X=>{F[X]&&(F[X]=Rr({...F[X]},T,L))});return z[x]=F,nt(z),z})}}}else if((v.key==="Delete"||v.key==="Backspace")&&!S&&O.length>0){const A=[...D];A[x]=A[x].filter((E,T)=>!O.includes(T)),j(A),nt(A),W([]),Z([])}};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[D,x,O,K,xe,Y,ae,R,g,Rr,ha]);const pl=({currentFrame:y,frameCount:v,syncMode:S,bpm:A,beats:E,duration:T,fps:L,onSeek:P,snapToGrid:z})=>{const F=N.useRef(null),X=oe=>{if(S==="bpm"){const ge=6e4/(A||120),fe=ge*(E||8),be=oe/v*fe,Ae=Math.floor(be/ge)+1,De=Math.floor(be%ge/ge*4)+1;return`B${Ae}.${De}`}else if(S==="time"){const ge=(T||2)*1e3,fe=oe/v*ge,be=Math.floor(fe/1e3),Ae=Math.floor(fe%1e3);return`${be}:${Ae.toString().padStart(3,"0")}`}return`F${oe+1}`},q=oe=>{if(!F.current)return;const ge=F.current.getBoundingClientRect();let be=(oe.clientX-ge.left)/ge.width,Ae=Math.round(be*(v-1));if(z){if(S==="bpm"){const De=v/E;Ae=Math.round(Ae/De)*De}else if(S==="time"){const De=v/T;Ae=Math.round(Ae/De)*De}}P(Math.max(0,Math.min(v-1,Math.round(Ae))))},ie=[],le=S==="bpm"?E||8:10;for(let oe=0;oe<=le;oe++){const ge=oe/le*100;let fe="";S==="bpm"?fe=`B${oe+1}`:S==="time"?fe=`${(oe/le*(T||2)).toFixed(1)}s`:fe=Math.round(oe/le*v),ie.push(f.jsx("div",{style:{position:"absolute",left:`${ge}%`,top:0,bottom:0,borderLeft:"1px solid #444",pointerEvents:"none"},children:f.jsx("span",{style:{fontSize:"0.6rem",color:"#666",marginLeft:"2px"},children:fe})},oe))}return f.jsxs("div",{ref:F,onMouseDown:q,style:{position:"relative",height:"35px",background:"#111",borderRadius:"4px",border:"1px solid #333",cursor:"pointer",overflow:"hidden"},children:[ie,f.jsx("div",{style:{position:"absolute",left:`${y/(v-1)*100}%`,top:0,bottom:0,width:"2px",background:"var(--theme-color)",boxShadow:"0 0 5px var(--theme-color)",zIndex:10}}),f.jsx("div",{style:{position:"absolute",right:"5px",bottom:"2px",fontSize:"0.7rem",color:"var(--theme-color)",fontWeight:"bold"},children:X(y)})]})},Ta=Yn.memo(({active:y,onClick:v,icon:S})=>f.jsx("button",{onClick:v,style:{width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",background:y?"var(--theme-color)":"#222",color:y?"black":"#888",border:"none",borderRadius:"4px",fontSize:"1.2rem",padding:0},children:f.jsx("i",{className:`bi ${S}`})})),Es=Yn.memo(({active:y,onClick:v,children:S})=>f.jsx("button",{onClick:v,style:{background:y?"#444":"#222",color:y?"var(--theme-color)":"#888",border:y?"1px solid var(--theme-color)":"1px solid #333",fontSize:"0.7rem",padding:"5px"},children:S})),Mi=O.length===1&&Pe[O[0]]&&K.length>0?Bn(Pe[O[0]])[K[0]]?.color||Pe[O[0]].color:"#000000";return f.jsxs("div",{className:"shape-builder",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column",userSelect:"none"},children:[je&&f.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",zIndex:2e4,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsx("h3",{children:"WORKING..."})}),f.jsxs("header",{style:{height:"50px",padding:"0 20px",background:"#1a1a1a",borderBottom:"1px solid #333",display:"flex",alignItems:"center",gap:"15px"},children:[f.jsx("h2",{style:{margin:0,fontSize:"1rem",color:"var(--theme-color)",width:"180px"},children:"SHAPE BUILDER"}),f.jsxs("div",{className:"action-group",style:{display:"flex",gap:"8px"},children:[f.jsx("button",{onClick:kr,title:"Undo",children:f.jsx("i",{className:"bi bi-arrow-counterclockwise"})}),f.jsx("button",{onClick:Ti,title:"Redo",children:f.jsx("i",{className:"bi bi-arrow-clockwise"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:yn,title:"Copy",children:f.jsx("i",{className:"bi bi-clipboard"})}),f.jsx("button",{onClick:Pn,title:"Paste",children:f.jsx("i",{className:"bi bi-clipboard-check"})}),f.jsx("button",{onClick:Ea,title:"Join Points / Shapes",children:f.jsx("i",{className:"bi bi-share"})}),f.jsx("button",{onClick:ps,title:"Group",disabled:O.length<2,children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:Yr,title:"Ungroup",disabled:O.length!==1||Pe[O[0]]?.type!=="group",children:f.jsx("i",{className:"bi bi-exclude"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:()=>tn(!1),title:"Subdivide (Linear)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-grid-3x3"})}),f.jsx("button",{onClick:()=>tn(!0),title:"Subdivide (Smooth)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-bezier"})}),f.jsx("button",{onClick:qa,title:"Decimate (Reduce Points)",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-filter-left"})}),f.jsx("button",{onClick:Aa,title:"Merge Overlapping Points",disabled:O.length===0,children:f.jsx("i",{className:"bi bi-node-plus"})}),f.jsx("button",{onClick:Mr,title:"Import SVG",children:f.jsx("i",{className:"bi bi-vector-pen"})}),f.jsx("button",{onClick:Va,title:"Import ILDA",children:f.jsx("i",{className:"bi bi-folder2-open"})}),f.jsx("button",{onClick:Xr,title:"Import Background Image",children:f.jsx("i",{className:"bi bi-image"})}),f.jsx("div",{className:"separator",style:{width:"1px",height:"20px",background:"#333"}}),f.jsx("button",{onClick:Nr,title:"Clear All",children:f.jsx("i",{className:"bi bi-trash"})}),f.jsx("button",{onClick:()=>{ve(.6),Ue({x:0,y:0})},title:"Recenter",children:f.jsx("i",{className:"bi bi-aspect-ratio"})})]}),f.jsxs("div",{className:"grid-controls",style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.8rem",marginLeft:"15px"},children:[f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:we,onChange:y=>Me(y.target.checked)})," Grid"]}),f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:ze,onChange:y=>Xe(y.target.checked)})," Snap"]}),(e==="line"||e==="bezier")&&f.jsxs("label",{children:[f.jsx("input",{type:"checkbox",checked:Ct,onChange:y=>on(y.target.checked)})," Continuous"]}),f.jsxs("select",{value:ot,onChange:y=>At(parseInt(y.target.value)),style:{background:"#222",color:"white",border:"1px solid #444",borderRadius:"3px"},children:[f.jsx("option",{value:"10",children:"10px"}),f.jsx("option",{value:"25",children:"25px"}),f.jsx("option",{value:"50",children:"50px"}),f.jsx("option",{value:"100",children:"100px"})]})]}),f.jsx("button",{onClick:n,style:{marginLeft:"auto"},children:"Back to Show Control"})]}),f.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[f.jsxs("aside",{style:{width:"60px",background:"#1a1a1a",borderRight:"1px solid #333",display:"flex",flexDirection:"column",alignItems:"center",padding:"10px 0",gap:"10px"},children:[f.jsx(Ta,{active:e==="select",onClick:()=>{a("select"),p(!1),G(null)},icon:"bi-cursor"}),e==="select"&&f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",background:"#222",padding:"4px",borderRadius:"4px",border:"1px solid #333"},children:[f.jsx("button",{onClick:ur,title:"Select Odd Points",style:{padding:"4px",fontSize:"0.7rem"},children:"ODD"}),f.jsx("button",{onClick:qt,title:"Select Even Points",style:{padding:"4px",fontSize:"0.7rem"},children:"EVN"}),f.jsx("button",{onClick:ei,title:"Invert Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-arrow-left-right"})}),f.jsx("button",{onClick:Ya,title:"Expand Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-plus-lg"})}),f.jsx("button",{onClick:ti,title:"Shrink Selection",style:{padding:"4px"},children:f.jsx("i",{className:"bi bi-dash-lg"})})]}),f.jsx(Ta,{active:e==="pen",onClick:()=>{a("pen"),p(!1),G(null)},icon:"bi-pencil"}),f.jsx(Ta,{active:e==="bezier",onClick:()=>{a("bezier"),p(!1),G(null)},icon:"bi-bezier2"}),f.jsx(Ta,{active:e==="line",onClick:()=>{a("line"),p(!1),G(null)},icon:"bi-slash-lg"}),f.jsx(Ta,{active:e==="rect",onClick:()=>{a("rect"),p(!1),G(null)},icon:"bi-square"}),f.jsx(Ta,{active:e==="circle",onClick:()=>{a("circle"),p(!1),G(null)},icon:"bi-circle"}),f.jsx(Ta,{active:e==="polygon",onClick:()=>{a("polygon"),p(!1),G(null)},icon:"bi-pentagon"}),f.jsx(Ta,{active:e==="star",onClick:()=>{a("star"),p(!1),G(null)},icon:"bi-star"}),f.jsx(Ta,{active:e==="triangle",onClick:()=>{a("triangle"),p(!1),G(null)},icon:"bi-triangle"}),f.jsxs("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",paddingBottom:"10px"},children:[f.jsx("input",{type:"color",value:wa(s),onChange:y=>{l(y.target.value),O.length>0&&vn({color:y.target.value})},title:"Custom Color",style:{width:"35px",height:"35px",border:"2px solid #333",background:"none",cursor:"pointer",marginBottom:"5px"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"4px"},children:[{name:"Red",hex:"#ff0000"},{name:"Orange",hex:"#ff6400"},{name:"Yellow",hex:"#ffff00"},{name:"Green",hex:"#00ff00"},{name:"Cyan",hex:"#00ffff"},{name:"Blue",hex:"#0000ff"},{name:"Violette",hex:"#8000ff"},{name:"Pink",hex:"#ff6496"},{name:"Magenta",hex:"#ff00ff"},{name:"White",hex:"#ffffff"}].map(y=>f.jsx("button",{onClick:()=>{l(y.hex),O.length>0&&vn({color:y.hex})},title:y.name,style:{width:"18px",height:"18px",background:y.hex,border:s===y.hex?"2px solid white":"1px solid #444",borderRadius:"2px",padding:0,cursor:"pointer"}},y.hex))})]})]}),f.jsxs("main",{style:{flex:1,background:"#050505",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"},children:[f.jsxs("div",{ref:na,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[f.jsx("canvas",{ref:Xn,width:window.innerWidth-300,height:window.innerHeight-130,onMouseDown:dl,onMouseMove:ws,onMouseUp:Ci,onContextMenu:sr,onDoubleClick:Ss,style:{background:"transparent"}}),Le.visible&&f.jsxs("div",{className:"context-menu",style:{position:"fixed",top:Le.y,left:Le.x,background:"#222",border:"1px solid #444",borderRadius:"4px",padding:"5px 0",zIndex:1e4},children:[(Le.target?.type==="point"||K.length>0)&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"menu-item",onClick:Ar,children:["Delete ",K.length>1?"Points":"Point"]}),f.jsx("div",{className:"menu-item",onClick:Ks,children:"Split to New Shape"})]}),Le.target?.type==="segment"&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"menu-item",onClick:ir,children:"Delete Line"}),f.jsx("div",{className:"menu-item",onClick:Fn,children:"Split Line"})]}),(Le.target?.type==="shape"||O.length>0)&&f.jsxs(f.Fragment,{children:[O.some(y=>Pe[y]?.type==="polyline"||Pe[y]?.type==="polygon")&&f.jsx("div",{className:"menu-item",onClick:Zn,children:O.every(y=>Pe[y]?.type==="polygon")?"Open Shape":"Close Shape"}),f.jsx("div",{className:"menu-item",onClick:()=>tn(!1),children:"Subdivide (Linear)"}),f.jsx("div",{className:"menu-item",onClick:()=>tn(!0),children:"Subdivide (Smooth)"}),f.jsx("div",{className:"menu-item",onClick:qa,children:"Decimate"}),f.jsx("div",{className:"menu-item",onClick:Aa,children:"Merge Points"}),f.jsx("div",{className:"menu-item",onClick:Cr,children:"Add Corner Points"}),f.jsx("div",{className:"menu-item",onClick:hs,children:"Reset Anchor Point"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),O.length===1&&["rect","circle","star","line"].includes(Pe[O[0]]?.type)&&f.jsx("div",{className:"menu-item",onClick:Pa,children:"Convert to Points"}),f.jsx("div",{className:"menu-item",onClick:()=>{const y=[...D],v=O.length>0?O:[Le.target.shapeIndex];y[x]=y[x].filter((S,A)=>!v.includes(A)),j(y),W([]),Z([]),rt({visible:!1})},children:"Delete Shape(s)"})]}),te&&f.jsx("div",{className:"menu-item",onClick:()=>{ce(null),rt({visible:!1})},children:"Clear Background"}),f.jsx("div",{className:"separator",style:{height:"1px",background:"#444",margin:"5px 0"}}),f.jsx("div",{className:"menu-item",onClick:yn,children:"Copy"}),f.jsx("div",{className:"menu-item",onClick:Pn,children:"Paste"})]})]}),f.jsxs("div",{className:"timeline-bar",style:{height:"80px",background:"#1a1a1a",borderTop:"1px solid #333",display:"flex",alignItems:"center",padding:"0 20px",gap:"20px"},children:[f.jsxs("div",{className:"playback-controls",style:{display:"flex",gap:"10px"},children:[f.jsx("button",{onClick:()=>I(!R),style:{width:"40px",height:"40px",borderRadius:"50%",background:R?"var(--theme-color)":"#333",color:R?"black":"white"},children:f.jsx("i",{className:`bi ${R?"bi-pause-fill":"bi-play-fill"}`})}),f.jsx("button",{onClick:()=>M(y=>Math.max(0,y-1)),children:f.jsx("i",{className:"bi bi-chevron-left"})}),f.jsx("button",{onClick:()=>M(y=>Math.min(g-1,y+1)),children:f.jsx("i",{className:"bi bi-chevron-right"})}),f.jsx("button",{onClick:bs,title:"Duplicate Frame",children:f.jsx("i",{className:"bi bi-layers-half"})})]}),f.jsxs("div",{className:"frame-slider-container",style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[f.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.7rem",color:"#666"},children:[f.jsxs("span",{children:["FRAME ",x+1," / ",g]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",checked:H,onChange:y=>B(y.target.checked)})," Onion Skin"]})]}),f.jsx(pl,{currentFrame:x,frameCount:g,syncMode:wn,bpm:En,beats:Gr,duration:ct,fps:Vn,snapToGrid:ze,onSeek:M})]}),f.jsxs("div",{className:"timeline-settings",style:{display:"flex",alignItems:"center",gap:"15px"},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"START:"}),f.jsx("input",{type:"number",min:"1",max:g,value:nr+1,onChange:y=>zr(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:Js,style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]}),f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888"},children:"LENGTH:"}),f.jsx("input",{type:"number",min:"1",max:"999",value:C,onChange:y=>w(y.target.value),onBlur:()=>b(Math.max(1,parseInt(C)||1)),onKeyDown:y=>{y.key==="Enter"&&b(Math.max(1,parseInt(C)||1))},onWheel:y=>Ga(y,b),style:{width:"60px",background:"#111",border:"1px solid #444",color:"white",padding:"4px",borderRadius:"3px"}})]})]})]})]}),f.jsxs("aside",{style:{width:"260px",background:"#1a1a1a",borderLeft:"1px solid #333",display:"flex",flexDirection:"column",overflow:"hidden"},children:[f.jsxs("div",{className:"layers-panel",style:{display:"flex",flexDirection:"column",height:"220px",flexShrink:0,overflowY:"auto",borderBottom:"1px solid #333",padding:"15px"},children:[f.jsxs("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["LAYERS",f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("button",{onClick:ps,title:"Group",disabled:O.length<2,style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-intersect"})}),f.jsx("button",{onClick:Yr,title:"Ungroup",disabled:O.length!==1||Pe[O[0]]?.type!=="group",style:{padding:"2px 5px",fontSize:"0.7rem"},children:f.jsx("i",{className:"bi bi-exclude"})})]})]}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:Pe.map((y,v)=>({s:y,i:v})).reverse().map(({s:y,i:v})=>f.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"5px",background:O.includes(v)?"#333":"transparent",borderRadius:"3px",cursor:"pointer",border:O.includes(v)?"1px solid var(--theme-color)":"1px solid transparent"},onClick:S=>{y.locked&&!y.hidden||(S.shiftKey?W(A=>A.includes(v)?A.filter(E=>E!==v):[...A,v]):W([v]))},children:[f.jsx("div",{style:{width:"10px",height:"10px",background:y.color,marginRight:"8px",borderRadius:"2px"}}),f.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[y.type.toUpperCase()," ",v]}),f.jsx("button",{onClick:S=>{S.stopPropagation();const A=[...D];A[x][v]={...y,hidden:!y.hidden},j(A),nt(A)},style:{background:"none",border:"none",padding:"2px",color:y.hidden?"#555":"#ccc"},title:y.hidden?"Show":"Hide",children:f.jsx("i",{className:`bi ${y.hidden?"bi-eye-slash":"bi-eye"}`})}),f.jsx("button",{onClick:S=>{S.stopPropagation();const A=[...D];A[x][v]={...y,locked:!y.locked},j(A),nt(A)},style:{background:"none",border:"none",padding:"2px",color:y.locked?"var(--theme-color)":"#555"},title:y.locked?"Unlock":"Lock",children:f.jsx("i",{className:`bi ${y.locked?"bi-lock-fill":"bi-unlock"}`})})]},v))})]}),f.jsxs("div",{className:"properties-scroll-container",style:{flex:1,overflowY:"auto",padding:"15px",display:"flex",flexDirection:"column",gap:"20px"},children:[f.jsx("h3",{style:{fontSize:"0.9rem",color:"#888",margin:"0 0 10px 0",borderBottom:"1px solid #333",paddingBottom:"5px"},children:"PROPERTIES"}),f.jsxs("div",{className:"animation-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"TWEENING TOOL"}),f.jsxs("div",{style:{display:"flex",gap:"5px",marginBottom:"8px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"START FRAME"}),f.jsx("input",{type:"number",value:Kt+1,onChange:y=>zt(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:gs,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsx("label",{style:{fontSize:"0.6rem",color:"#888"},children:"END FRAME"}),f.jsx("input",{type:"number",value:On+1,onChange:y=>Gt(Math.max(1,parseInt(y.target.value)||1)-1),onWheel:cr,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white",fontSize:"0.8rem"}})]})]}),f.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"8px",fontSize:"0.7rem",color:"#ccc"},children:[f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:Ke,onChange:y=>qn(y.target.checked)})," POS"]}),f.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[f.jsx("input",{type:"checkbox",className:"sb-checkbox",checked:Xt,onChange:y=>tr(y.target.checked)})," COLOR"]})]}),"                                              ",f.jsx("button",{onClick:ys,className:"primary-btn",style:{width:"100%",padding:"5px"},children:"INTERPOLATE"})]}),f.jsxs("div",{className:"sync-tools",style:{padding:"10px",background:"#222",borderRadius:"4px",border:"1px solid #333",flexShrink:0},children:[f.jsx("h4",{style:{fontSize:"0.8rem",color:"var(--theme-color)",margin:"0 0 10px 0"},children:"PLAYBACK SYNC"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px",marginBottom:"10px"},children:[f.jsx(Es,{active:wn==="fps",onClick:()=>Vr("fps"),children:"FPS"}),f.jsx(Es,{active:wn==="bpm",onClick:()=>Vr("bpm"),children:"BPM"}),f.jsx(Es,{active:wn==="time",onClick:()=>Vr("time"),children:"TIME"})]}),wn==="fps"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["FPS: ",Vn]}),f.jsx("input",{type:"range",min:"1",max:"60",value:Vn,onChange:y=>Tr(parseInt(y.target.value))})]}),wn==="bpm"&&f.jsxs("div",{style:{marginBottom:"8px",display:"flex",gap:"5px"},children:[f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BPM: ",En]}),f.jsx("input",{type:"number",value:En,onChange:y=>lr(parseInt(y.target.value)||0),onWheel:Ha,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{flex:1},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["BEATS: ",Gr]}),f.jsx("input",{type:"number",value:Gr,onChange:y=>za(parseInt(y.target.value)||1),onWheel:aa,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]})]}),wn==="time"&&f.jsxs("div",{style:{marginBottom:"8px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888"},children:["DURATION (S): ",ct]}),f.jsx("input",{type:"number",step:"0.1",value:ct,onChange:y=>ms(parseFloat(y.target.value)||0),onWheel:Ai,style:{width:"100%",background:"#111",border:"1px solid #444",color:"white"}})]}),f.jsxs("div",{style:{marginTop:"10px"},children:[f.jsxs("label",{style:{fontSize:"0.7rem",color:"#888",display:"flex",justifyContent:"space-between"},children:["SPEED: ",f.jsxs("span",{children:[hn.toFixed(1),"x"]})]}),f.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:hn,onChange:y=>or(parseFloat(y.target.value))}),f.jsxs("div",{style:{display:"flex",gap:"4px",marginTop:"4px"},children:[f.jsx("button",{onClick:()=>or(.5),style:{flex:1,fontSize:"0.6rem"},children:"0.5x"}),f.jsx("button",{onClick:()=>or(1),style:{flex:1,fontSize:"0.6rem"},children:"1.0x"}),f.jsx("button",{onClick:()=>or(2),style:{flex:1,fontSize:"0.6rem"},children:"2.0x"})]})]})]}),O.length>0?f.jsxs("div",{className:"shape-properties",style:{display:"flex",flexDirection:"column",gap:"15px"},children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#666",display:"block"},children:O.length===1?`TYPE: ${Pe[O[0]]?.type?.toUpperCase()}`:`${O.length} SHAPES SELECTED`}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"COLOR"}),f.jsx("input",{type:"color",value:wa(Pe[O[0]]?.color||"#ffffff"),onChange:y=>vn({color:y.target.value}),style:{width:"100%",height:"30px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>vn({color:y}),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]}),O.length===1&&Pe[O[0]]&&["rect","circle","star","line"].includes(Pe[O[0]].type)&&f.jsxs("div",{className:"primitive-properties",style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",background:"#222",borderRadius:"4px"},children:[f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"POSITION (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Pe[O[0]].start?.x||0),onChange:y=>{const v=Pe[O[0]];if(!v||!v.start)return;const S=(parseInt(y.target.value)||0)-v.start.x;j(A=>{const E=[...A],T=[...E[x]];return T[O[0]]=Rr({...T[O[0]]},S,0),E[x]=T,E})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Pe[O[0]].start?.y||0),onChange:y=>{const v=Pe[O[0]];if(!v||!v.start)return;const S=(parseInt(y.target.value)||0)-v.start.y;j(A=>{const E=[...A],T=[...E[x]];return T[O[0]]=Rr({...T[O[0]]},0,S),E[x]=T,E})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),Pe[O[0]].type==="rect"&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"SIZE (W / H)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Pe[O[0]].width||0),onChange:y=>vn({width:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Pe[O[0]].height||0),onChange:y=>vn({height:parseInt(y.target.value)||0}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]}),(Pe[O[0]].type==="circle"||Pe[O[0]].type==="star")&&f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.7rem",color:"#888",display:"block",marginBottom:"3px"},children:"RADIUS (X / Y)"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",value:Math.round(Math.abs((Pe[O[0]].end?.x||0)-(Pe[O[0]].start?.x||0))),onChange:y=>{const v=parseInt(y.target.value)||0,S=Pe[O[0]];!S||!S.start||!S.end||vn({end:{...S.end,x:S.start.x+v}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}}),f.jsx("input",{type:"number",value:Math.round(Math.abs((Pe[O[0]].end?.y||0)-(Pe[O[0]].start?.y||0))),onChange:y=>{const v=parseInt(y.target.value)||0,S=Pe[O[0]];!S||!S.start||!S.end||vn({end:{...S.end,y:S.start.y+v}})},style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px",fontSize:"0.8rem"}})]})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"SCALE X / Y"}),f.jsxs("div",{style:{display:"flex",gap:"5px"},children:[f.jsx("input",{type:"number",step:"0.1",value:Pe[O[0]]?.scaleX||1,onChange:y=>vn({scaleX:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}}),f.jsx("input",{type:"number",step:"0.1",value:Pe[O[0]]?.scaleY||1,onChange:y=>vn({scaleY:parseFloat(y.target.value)||1}),style:{width:"50%",background:"#111",border:"1px solid #444",color:"white",padding:"4px"}})]})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"ROTATION X / Y / Z (DEG)"}),f.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:["rotationX","rotationY","rotationZ"].map(y=>{const v=Pe[O[0]]?.[y]||0,S=Math.round(v*180/Math.PI*100)/100;return f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[f.jsx("span",{style:{fontSize:"0.7rem",color:"#555",width:"10px"},children:y.slice(-1)}),f.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:S,onChange:A=>vn({[y]:parseFloat(A.target.value)*Math.PI/180}),style:{flex:1}}),f.jsx("input",{type:"number",value:S,onChange:A=>vn({[y]:(parseFloat(A.target.value)||0)*Math.PI/180}),style:{width:"50px",background:"#111",border:"1px solid #444",color:"white",padding:"2px",fontSize:"0.7rem"}})]},y)})})]}),f.jsxs("div",{className:"property-group",children:[f.jsx("label",{style:{fontSize:"0.8rem",color:"#888",display:"block",marginBottom:"5px"},children:"RENDER MODE"}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"5px"},children:["simple","dotted","dashed","points"].map(y=>f.jsx(Es,{active:Pe[O[0]]?.renderMode===y,onClick:()=>vn({renderMode:y}),children:y},y))})]})]}):f.jsx("p",{style:{fontSize:"0.8rem",color:"#555",textAlign:"center",marginTop:"20px"},children:"Select shapes or drag a box to begin."}),K.length>0&&O.length===1&&f.jsxs("div",{className:"point-properties",style:{background:"#222",padding:"10px",borderRadius:"4px",border:"1px solid var(--theme-color)",flexShrink:0},children:[f.jsxs("label",{style:{fontSize:"0.8rem",color:"var(--theme-color)",display:"block",marginBottom:"5px"},children:[K.length," POINTS SELECTED"]}),f.jsx("input",{type:"color",value:wa(Mi),onChange:y=>xs(y.target.value),style:{width:"100%",height:"40px",background:"none",border:"1px solid #444",cursor:"pointer"}}),f.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"4px",marginTop:"8px"},children:["#ff0000","#ff6400","#ffff00","#00ff00","#00ffff","#0000ff","#8000ff","#ff6496","#ff00ff","#ffffff"].map(y=>f.jsx("button",{onClick:()=>xs(y),style:{width:"100%",height:"20px",background:y,border:"1px solid #444",borderRadius:"2px",padding:0}},y))})]})]}),f.jsx("div",{className:"save-container",style:{padding:"15px",borderTop:"1px solid #333",background:"#1a1a1a"},children:f.jsx("button",{className:"primary-btn",style:{width:"100%",padding:"12px"},onClick:$r,disabled:D.every(y=>y.length===0)||Qt,children:Qt?"EXPORTING...":"SAVE AS CLIP"})})]})]}),f.jsx("style",{children:`
        button { padding: 4px 10px; background: #333; border: 1px solid #444; color: #ccc; border-radius: 3px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; }
        button:hover:not(:disabled) { background: #444; color: white; }
        .primary-btn { background: var(--theme-color) !important; color: black !important; font-weight: bold; border: none !important; }
        .context-menu { background: #222; border: 1px solid #444; border-radius: 4px; padding: 5px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5); min-width: 120px; }
        .context-menu .menu-item { padding: 8px 15px; font-size: 0.8rem; cursor: pointer; color: #ccc; }
        .context-menu .menu-item:hover { background: var(--theme-color); color: black; }
        input[type="range"] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--theme-color); border-radius: 50%; cursor: pointer; }
        
        .sb-checkbox {
            appearance: none !important;
            -webkit-appearance: none !important;
            width: 14px !important;
            height: 14px !important;
            min-width: 14px !important;
            min-height: 14px !important;
            background: #111 !important;
            border: 1px solid #444 !important;
            border-radius: 2px !important;
            cursor: pointer;
            position: relative;
            margin: 0 4px 0 0 !important;
            display: inline-block;
            vertical-align: middle;
        }
        /* Crucial: Kill the global "OFF/ON" toggle styling */
        .sb-checkbox:before {
            content: none !important;
            display: none !important;
        }
        .sb-checkbox:checked {
            background: var(--theme-color) !important;
            border-color: var(--theme-color) !important;
        }
        .sb-checkbox:checked::after {
            content: '\\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 10px;
            font-weight: bold;
            display: block !important;
        }
      `})]})},Vv=({onBack:n})=>f.jsxs("div",{className:"timeline-editor-page",style:{width:"100vw",height:"100vh",background:"#111",color:"white",display:"flex",flexDirection:"column"},children:[f.jsxs("header",{style:{padding:"10px 20px",borderBottom:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[f.jsx("h2",{children:"Timeline Editor (Coming Soon)"}),f.jsx("button",{onClick:n,style:{padding:"8px 16px",background:"#ff5e00",border:"none",color:"white",borderRadius:"4px",cursor:"pointer"},children:"Back to Show Control"})]}),f.jsx("main",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:f.jsxs("div",{style:{textAlign:"center"},children:[f.jsx("p",{children:"This is the Timeline Editor placeholder."}),f.jsx("p",{children:"Goal: Arrange clips on a timeline for synchronized playback."})]})})]}),Xv=({show:n,onClose:e,initialTab:a="output"})=>{const[s,l]=N.useState(a);return Yn.useEffect(()=>{n&&l(a)},[n,a]),n?f.jsxs("div",{className:"modal-overlay",children:[f.jsxs("div",{className:"modal-content audio-settings-window",style:{minWidth:"400px"},children:[f.jsxs("div",{className:"modal-header",children:[f.jsx("h3",{children:"About"}),f.jsx("button",{className:"close-btn",onClick:e,children:""})]}),f.jsx("div",{className:"tab-header",style:{display:"flex",gap:"10px",marginBottom:"15px",borderBottom:"1px solid #444"}}),f.jsx("div",{className:"modal-body",children:f.jsx("div",{className:"audio-output-settings"})})]}),f.jsx("style",{children:`
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                }
                .modal-content {
                    background: #222;
                    color: white;
                    border-radius: 8px;
                    border: 1px solid #444;
                    padding: 0;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                }
                .modal-header {
                    background: #333;
                    padding: 10px 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .modal-body {
                    padding: 20px;
                }
                .close-btn {
                    background: none;
                    border: none;
                    color: #888;
                    font-size: 24px;
                    cursor: pointer;
                }
                .close-btn:hover {
                    color: white;
                }
                .param-select, input {
                    background: #111;
                    border: 1px solid #444;
                    color: white;
                    border-radius: 4px;
                }
            `})]}):null},rg=N.createContext(null),$v=()=>N.useContext(rg),Wv=({children:n})=>{const[e,a]=N.useState(null);return N.useEffect(()=>{if(!e){const s=new Worker(new URL(""+new URL("ilda-parser.worker-D8-24Bip.js",import.meta.url).href,import.meta.url));a(s)}return()=>{e&&e.terminate()}},[e]),f.jsx(rg.Provider,{value:e,children:n})},sg=N.createContext(null),Zv=({children:n})=>{const e=N.useMemo(()=>{try{const a=new Worker(new URL(""+new URL("generators.worker-Dhgp-URH.js",import.meta.url).href,import.meta.url),{type:"module"});return a.onerror=s=>{console.error("Generator Worker instantiation or internal error:",s)},a}catch(a){return console.error("Failed to create Generator Worker:",a),null}},[]);return N.useEffect(()=>{if(e)return()=>{e.terminate()}},[e]),f.jsx(sg.Provider,{value:e,children:n})},Qv=()=>{const n=N.useContext(sg);if(n===void 0)throw new Error("useGeneratorWorker must be used within a GeneratorWorkerProvider");return n};var Kv=Pm();const Jv=ad(Kv),eb=()=>{const{isMapping:n,mappings:e,learningId:a}=Ic(),{isMapping:s,mappings:l,learningId:o}=sd()||{},{isMapping:u,mappings:h,learningId:p}=id()||{},g=n||s||u,[b,C]=N.useState([]),w=N.useCallback(()=>{if(!g)return;const x=document.querySelectorAll("[data-mappable-id]"),M=Array.from(x).map(R=>{const I=R.getBoundingClientRect();return{id:R.getAttribute("data-mappable-id"),rect:{top:I.top,left:I.left,width:I.width,height:I.height}}});C(M)},[g]);return N.useEffect(()=>{if(g){w(),window.addEventListener("resize",w);const x=setTimeout(w,100);return()=>{window.removeEventListener("resize",w),clearTimeout(x)}}else C([])},[g,w]),g?Jv.createPortal(f.jsx("div",{className:"midi-mapping-global-overlay-container",children:b.map(x=>{const M=e[x.id],R=l?l[x.id]:null,I=h?h[x.id]:null,H=n&&a===x.id||s&&o===x.id||u&&p===x.id;let B=null;return n?B=M?M.label:null:s?B=R?R.label:null:u&&(B=I?I.label:null),f.jsx("div",{className:`midi-mapping-label-box ${H?"learning":""} ${B?"mapped":""} ${s?"artnet-mapping":""} ${u?"keyboard-mapping":""}`,style:{position:"fixed",top:x.rect.top,left:x.rect.left,width:x.rect.width,height:x.rect.height,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:f.jsx("div",{className:"mapping-label",children:B||"+"})},x.id)})}),document.body):null};String.prototype.codePointAt||(function(){var n=(function(){try{var a={},s=Object.defineProperty,l=s(a,a,a)&&s}catch{}return l})(),e=function(a){if(this==null)throw TypeError();var s=String(this),l=s.length,o=a?Number(a):0;if(o!=o&&(o=0),!(o<0||o>=l)){var u=s.charCodeAt(o),h;return u>=55296&&u<=56319&&l>o+1&&(h=s.charCodeAt(o+1),h>=56320&&h<=57343)?(u-55296)*1024+h-56320+65536:u}};n?n(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e})();var cd=0,ig=-3;function oo(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function tb(n,e){this.source=n,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new oo,this.dtree=new oo}var lg=new oo,og=new oo,ud=new Uint8Array(30),fd=new Uint16Array(30),cg=new Uint8Array(30),ug=new Uint16Array(30),nb=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W0=new oo,jr=new Uint8Array(320);function fg(n,e,a,s){var l,o;for(l=0;l<a;++l)n[l]=0;for(l=0;l<30-a;++l)n[l+a]=l/a|0;for(o=s,l=0;l<30;++l)e[l]=o,o+=1<<n[l]}function ab(n,e){var a;for(a=0;a<7;++a)n.table[a]=0;for(n.table[7]=24,n.table[8]=152,n.table[9]=112,a=0;a<24;++a)n.trans[a]=256+a;for(a=0;a<144;++a)n.trans[24+a]=a;for(a=0;a<8;++a)n.trans[168+a]=280+a;for(a=0;a<112;++a)n.trans[176+a]=144+a;for(a=0;a<5;++a)e.table[a]=0;for(e.table[5]=32,a=0;a<32;++a)e.trans[a]=a}var Z0=new Uint16Array(16);function If(n,e,a,s){var l,o;for(l=0;l<16;++l)n.table[l]=0;for(l=0;l<s;++l)n.table[e[a+l]]++;for(n.table[0]=0,o=0,l=0;l<16;++l)Z0[l]=o,o+=n.table[l];for(l=0;l<s;++l)e[a+l]&&(n.trans[Z0[e[a+l]]++]=l)}function rb(n){n.bitcount--||(n.tag=n.source[n.sourceIndex++],n.bitcount=7);var e=n.tag&1;return n.tag>>>=1,e}function Br(n,e,a){if(!e)return a;for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var s=n.tag&65535>>>16-e;return n.tag>>>=e,n.bitcount-=e,s+a}function $f(n,e){for(;n.bitcount<24;)n.tag|=n.source[n.sourceIndex++]<<n.bitcount,n.bitcount+=8;var a=0,s=0,l=0,o=n.tag;do s=2*s+(o&1),o>>>=1,++l,a+=e.table[l],s-=e.table[l];while(s>=0);return n.tag=o,n.bitcount-=l,e.trans[a+s]}function sb(n,e,a){var s,l,o,u,h,p;for(s=Br(n,5,257),l=Br(n,5,1),o=Br(n,4,4),u=0;u<19;++u)jr[u]=0;for(u=0;u<o;++u){var g=Br(n,3,0);jr[nb[u]]=g}for(If(W0,jr,0,19),h=0;h<s+l;){var b=$f(n,W0);switch(b){case 16:var C=jr[h-1];for(p=Br(n,2,3);p;--p)jr[h++]=C;break;case 17:for(p=Br(n,3,3);p;--p)jr[h++]=0;break;case 18:for(p=Br(n,7,11);p;--p)jr[h++]=0;break;default:jr[h++]=b;break}}If(e,jr,0,s),If(a,jr,s,l)}function Q0(n,e,a){for(;;){var s=$f(n,e);if(s===256)return cd;if(s<256)n.dest[n.destLen++]=s;else{var l,o,u,h;for(s-=257,l=Br(n,ud[s],fd[s]),o=$f(n,a),u=n.destLen-Br(n,cg[o],ug[o]),h=u;h<u+l;++h)n.dest[n.destLen++]=n.dest[h]}}}function ib(n){for(var e,a,s;n.bitcount>8;)n.sourceIndex--,n.bitcount-=8;if(e=n.source[n.sourceIndex+1],e=256*e+n.source[n.sourceIndex],a=n.source[n.sourceIndex+3],a=256*a+n.source[n.sourceIndex+2],e!==(~a&65535))return ig;for(n.sourceIndex+=4,s=e;s;--s)n.dest[n.destLen++]=n.source[n.sourceIndex++];return n.bitcount=0,cd}function lb(n,e){var a=new tb(n,e),s,l,o;do{switch(s=rb(a),l=Br(a,2,0),l){case 0:o=ib(a);break;case 1:o=Q0(a,lg,og);break;case 2:sb(a,a.ltree,a.dtree),o=Q0(a,a.ltree,a.dtree);break;default:o=ig}if(o!==cd)throw new Error("Data error")}while(!s);return a.destLen<a.dest.length?typeof a.dest.slice=="function"?a.dest.slice(0,a.destLen):a.dest.subarray(0,a.destLen):a.dest}ab(lg,og);fg(ud,fd,4,3);fg(cg,ug,2,1);ud[28]=0;fd[28]=258;var ob=lb;function rl(n,e,a,s,l){return Math.pow(1-l,3)*n+3*Math.pow(1-l,2)*l*e+3*(1-l)*Math.pow(l,2)*a+Math.pow(l,3)*s}function fs(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}fs.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};fs.prototype.addPoint=function(n,e){typeof n=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=n,this.x2=n),n<this.x1&&(this.x1=n),n>this.x2&&(this.x2=n)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};fs.prototype.addX=function(n){this.addPoint(n,null)};fs.prototype.addY=function(n){this.addPoint(null,n)};fs.prototype.addBezier=function(n,e,a,s,l,o,u,h){var p=[n,e],g=[a,s],b=[l,o],C=[u,h];this.addPoint(n,e),this.addPoint(u,h);for(var w=0;w<=1;w++){var x=6*p[w]-12*g[w]+6*b[w],M=-3*p[w]+9*g[w]-9*b[w]+3*C[w],R=3*g[w]-3*p[w];if(M===0){if(x===0)continue;var I=-R/x;0<I&&I<1&&(w===0&&this.addX(rl(p[w],g[w],b[w],C[w],I)),w===1&&this.addY(rl(p[w],g[w],b[w],C[w],I)));continue}var H=Math.pow(x,2)-4*R*M;if(!(H<0)){var B=(-x+Math.sqrt(H))/(2*M);0<B&&B<1&&(w===0&&this.addX(rl(p[w],g[w],b[w],C[w],B)),w===1&&this.addY(rl(p[w],g[w],b[w],C[w],B)));var D=(-x-Math.sqrt(H))/(2*M);0<D&&D<1&&(w===0&&this.addX(rl(p[w],g[w],b[w],C[w],D)),w===1&&this.addY(rl(p[w],g[w],b[w],C[w],D)))}}};fs.prototype.addQuad=function(n,e,a,s,l,o){var u=n+.6666666666666666*(a-n),h=e+2/3*(s-e),p=u+1/3*(l-n),g=h+1/3*(o-e);this.addBezier(n,e,u,h,p,g,l,o)};function Sn(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Sn.prototype.moveTo=function(n,e){this.commands.push({type:"M",x:n,y:e})};Sn.prototype.lineTo=function(n,e){this.commands.push({type:"L",x:n,y:e})};Sn.prototype.curveTo=Sn.prototype.bezierCurveTo=function(n,e,a,s,l,o){this.commands.push({type:"C",x1:n,y1:e,x2:a,y2:s,x:l,y:o})};Sn.prototype.quadTo=Sn.prototype.quadraticCurveTo=function(n,e,a,s){this.commands.push({type:"Q",x1:n,y1:e,x:a,y:s})};Sn.prototype.close=Sn.prototype.closePath=function(){this.commands.push({type:"Z"})};Sn.prototype.extend=function(n){if(n.commands)n=n.commands;else if(n instanceof fs){var e=n;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,n)};Sn.prototype.getBoundingBox=function(){for(var n=new fs,e=0,a=0,s=0,l=0,o=0;o<this.commands.length;o++){var u=this.commands[o];switch(u.type){case"M":n.addPoint(u.x,u.y),e=s=u.x,a=l=u.y;break;case"L":n.addPoint(u.x,u.y),s=u.x,l=u.y;break;case"Q":n.addQuad(s,l,u.x1,u.y1,u.x,u.y),s=u.x,l=u.y;break;case"C":n.addBezier(s,l,u.x1,u.y1,u.x2,u.y2,u.x,u.y),s=u.x,l=u.y;break;case"Z":s=e,l=a;break;default:throw new Error("Unexpected path command "+u.type)}}return n.isEmpty()&&n.addPoint(0,0),n};Sn.prototype.draw=function(n){n.beginPath();for(var e=0;e<this.commands.length;e+=1){var a=this.commands[e];a.type==="M"?n.moveTo(a.x,a.y):a.type==="L"?n.lineTo(a.x,a.y):a.type==="C"?n.bezierCurveTo(a.x1,a.y1,a.x2,a.y2,a.x,a.y):a.type==="Q"?n.quadraticCurveTo(a.x1,a.y1,a.x,a.y):a.type==="Z"&&n.closePath()}this.fill&&(n.fillStyle=this.fill,n.fill()),this.stroke&&(n.strokeStyle=this.stroke,n.lineWidth=this.strokeWidth,n.stroke())};Sn.prototype.toPathData=function(n){n=n!==void 0?n:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(n)}function a(){for(var u=arguments,h="",p=0;p<arguments.length;p+=1){var g=u[p];g>=0&&p>0&&(h+=" "),h+=e(g)}return h}for(var s="",l=0;l<this.commands.length;l+=1){var o=this.commands[l];o.type==="M"?s+="M"+a(o.x,o.y):o.type==="L"?s+="L"+a(o.x,o.y):o.type==="C"?s+="C"+a(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?s+="Q"+a(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(s+="Z")}return s};Sn.prototype.toSVG=function(n){var e='<path d="';return e+=this.toPathData(n),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Sn.prototype.toDOMElement=function(n){var e=this.toPathData(n),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",e),a};function dg(n){throw new Error(n)}function K0(n,e){n||dg(e)}var at={fail:dg,argument:K0,assert:K0},J0=32768,em=2147483648,ol={},Be={},lt={};function Sr(n){return function(){return n}}Be.BYTE=function(n){return at.argument(n>=0&&n<=255,"Byte value should be between 0 and 255."),[n]};lt.BYTE=Sr(1);Be.CHAR=function(n){return[n.charCodeAt(0)]};lt.CHAR=Sr(1);Be.CHARARRAY=function(n){typeof n>"u"&&(n="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],a=0;a<n.length;a+=1)e[a]=n.charCodeAt(a);return e};lt.CHARARRAY=function(n){return typeof n>"u"?0:n.length};Be.USHORT=function(n){return[n>>8&255,n&255]};lt.USHORT=Sr(2);Be.SHORT=function(n){return n>=J0&&(n=-(2*J0-n)),[n>>8&255,n&255]};lt.SHORT=Sr(2);Be.UINT24=function(n){return[n>>16&255,n>>8&255,n&255]};lt.UINT24=Sr(3);Be.ULONG=function(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]};lt.ULONG=Sr(4);Be.LONG=function(n){return n>=em&&(n=-(2*em-n)),[n>>24&255,n>>16&255,n>>8&255,n&255]};lt.LONG=Sr(4);Be.FIXED=Be.ULONG;lt.FIXED=lt.ULONG;Be.FWORD=Be.SHORT;lt.FWORD=lt.SHORT;Be.UFWORD=Be.USHORT;lt.UFWORD=lt.USHORT;Be.LONGDATETIME=function(n){return[0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255]};lt.LONGDATETIME=Sr(8);Be.TAG=function(n){return at.argument(n.length===4,"Tag should be exactly 4 ASCII characters."),[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]};lt.TAG=Sr(4);Be.Card8=Be.BYTE;lt.Card8=lt.BYTE;Be.Card16=Be.USHORT;lt.Card16=lt.USHORT;Be.OffSize=Be.BYTE;lt.OffSize=lt.BYTE;Be.SID=Be.USHORT;lt.SID=lt.USHORT;Be.NUMBER=function(n){return n>=-107&&n<=107?[n+139]:n>=108&&n<=1131?(n=n-108,[(n>>8)+247,n&255]):n>=-1131&&n<=-108?(n=-n-108,[(n>>8)+251,n&255]):n>=-32768&&n<=32767?Be.NUMBER16(n):Be.NUMBER32(n)};lt.NUMBER=function(n){return Be.NUMBER(n).length};Be.NUMBER16=function(n){return[28,n>>8&255,n&255]};lt.NUMBER16=Sr(3);Be.NUMBER32=function(n){return[29,n>>24&255,n>>16&255,n>>8&255,n&255]};lt.NUMBER32=Sr(5);Be.REAL=function(n){var e=n.toString(),a=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(a){var s=parseFloat("1e"+((a[2]?+a[2]:0)+a[1].length));e=(Math.round(n*s)/s).toString()}for(var l="",o=0,u=e.length;o<u;o+=1){var h=e[o];h==="e"?l+=e[++o]==="-"?"c":"b":h==="."?l+="a":h==="-"?l+="e":l+=h}l+=l.length&1?"f":"ff";for(var p=[30],g=0,b=l.length;g<b;g+=2)p.push(parseInt(l.substr(g,2),16));return p};lt.REAL=function(n){return Be.REAL(n).length};Be.NAME=Be.CHARARRAY;lt.NAME=lt.CHARARRAY;Be.STRING=Be.CHARARRAY;lt.STRING=lt.CHARARRAY;ol.UTF8=function(n,e,a){for(var s=[],l=a,o=0;o<l;o++,e+=1)s[o]=n.getUint8(e);return String.fromCharCode.apply(null,s)};ol.UTF16=function(n,e,a){for(var s=[],l=a/2,o=0;o<l;o++,e+=2)s[o]=n.getUint16(e);return String.fromCharCode.apply(null,s)};Be.UTF16=function(n){for(var e=[],a=0;a<n.length;a+=1){var s=n.charCodeAt(a);e[e.length]=s>>8&255,e[e.length]=s&255}return e};lt.UTF16=function(n){return n.length*2};var Wf={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};ol.MACSTRING=function(n,e,a,s){var l=Wf[s];if(l!==void 0){for(var o="",u=0;u<a;u++){var h=n.getUint8(e+u);h<=127?o+=String.fromCharCode(h):o+=l[h&127]}return o}};var vc=typeof WeakMap=="function"&&new WeakMap,bc,cb=function(n){if(!bc){bc={};for(var e in Wf)bc[e]=new String(e)}var a=bc[n];if(a!==void 0){if(vc){var s=vc.get(a);if(s!==void 0)return s}var l=Wf[n];if(l!==void 0){for(var o={},u=0;u<l.length;u++)o[l.charCodeAt(u)]=u+128;return vc&&vc.set(a,o),o}}};Be.MACSTRING=function(n,e){var a=cb(e);if(a!==void 0){for(var s=[],l=0;l<n.length;l++){var o=n.charCodeAt(l);if(o>=128&&(o=a[o],o===void 0))return;s[l]=o}return s}};lt.MACSTRING=function(n,e){var a=Be.MACSTRING(n,e);return a!==void 0?a.length:0};function Zf(n){return n>=-128&&n<=127}function ub(n,e,a){for(var s=0,l=n.length;e<l&&s<64&&n[e]===0;)++e,++s;return a.push(128|s-1),e}function fb(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(!Zf(u)||u===0&&o+1<l&&n[o+1]===0)break;++o,++s}a.push(s-1);for(var h=e;h<o;++h)a.push(n[h]+256&255);return o}function db(n,e,a){for(var s=0,l=n.length,o=e;o<l&&s<64;){var u=n[o];if(u===0||Zf(u)&&o+1<l&&Zf(n[o+1]))break;++o,++s}a.push(64|s-1);for(var h=e;h<o;++h){var p=n[h];a.push(p+65536>>8&255,p+256&255)}return o}Be.VARDELTAS=function(n){for(var e=0,a=[];e<n.length;){var s=n[e];s===0?e=ub(n,e,a):s>=-128&&s<=127?e=fb(n,e,a):e=db(n,e,a)}return a};Be.INDEX=function(n){for(var e=1,a=[e],s=[],l=0;l<n.length;l+=1){var o=Be.OBJECT(n[l]);Array.prototype.push.apply(s,o),e+=o.length,a.push(e)}if(s.length===0)return[0,0];for(var u=[],h=1+Math.floor(Math.log(e)/Math.log(2))/8|0,p=[void 0,Be.BYTE,Be.USHORT,Be.UINT24,Be.ULONG][h],g=0;g<a.length;g+=1){var b=p(a[g]);Array.prototype.push.apply(u,b)}return Array.prototype.concat(Be.Card16(n.length),Be.OffSize(h),u,s)};lt.INDEX=function(n){return Be.INDEX(n).length};Be.DICT=function(n){for(var e=[],a=Object.keys(n),s=a.length,l=0;l<s;l+=1){var o=parseInt(a[l],0),u=n[o];e=e.concat(Be.OPERAND(u.value,u.type)),e=e.concat(Be.OPERATOR(o))}return e};lt.DICT=function(n){return Be.DICT(n).length};Be.OPERATOR=function(n){return n<1200?[n]:[12,n-1200]};Be.OPERAND=function(n,e){var a=[];if(Array.isArray(e))for(var s=0;s<e.length;s+=1)at.argument(n.length===e.length,"Not enough arguments given for type"+e),a=a.concat(Be.OPERAND(n[s],e[s]));else if(e==="SID")a=a.concat(Be.NUMBER(n));else if(e==="offset")a=a.concat(Be.NUMBER32(n));else if(e==="number")a=a.concat(Be.NUMBER(n));else if(e==="real")a=a.concat(Be.REAL(n));else throw new Error("Unknown operand type "+e);return a};Be.OP=Be.BYTE;lt.OP=lt.BYTE;var xc=typeof WeakMap=="function"&&new WeakMap;Be.CHARSTRING=function(n){if(xc){var e=xc.get(n);if(e!==void 0)return e}for(var a=[],s=n.length,l=0;l<s;l+=1){var o=n[l];a=a.concat(Be[o.type](o.value))}return xc&&xc.set(n,a),a};lt.CHARSTRING=function(n){return Be.CHARSTRING(n).length};Be.OBJECT=function(n){var e=Be[n.type];return at.argument(e!==void 0,"No encoding function for type "+n.type),e(n.value)};lt.OBJECT=function(n){var e=lt[n.type];return at.argument(e!==void 0,"No sizeOf function for type "+n.type),e(n.value)};Be.TABLE=function(n){for(var e=[],a=n.fields.length,s=[],l=[],o=0;o<a;o+=1){var u=n.fields[o],h=Be[u.type];at.argument(h!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var p=n[u.name];p===void 0&&(p=u.value);var g=h(p);u.type==="TABLE"?(l.push(e.length),e=e.concat([0,0]),s.push(g)):e=e.concat(g)}for(var b=0;b<s.length;b+=1){var C=l[b],w=e.length;at.argument(w<65536,"Table "+n.tableName+" too big."),e[C]=w>>8,e[C+1]=w&255,e=e.concat(s[b])}return e};lt.TABLE=function(n){for(var e=0,a=n.fields.length,s=0;s<a;s+=1){var l=n.fields[s],o=lt[l.type];at.argument(o!==void 0,"No sizeOf function for field type "+l.type+" ("+l.name+")");var u=n[l.name];u===void 0&&(u=l.value),e+=o(u),l.type==="TABLE"&&(e+=2)}return e};Be.RECORD=Be.TABLE;lt.RECORD=lt.TABLE;Be.LITERAL=function(n){return n};lt.LITERAL=function(n){return n.length};function _n(n,e,a){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var s=0;s<e.length;s+=1){var l=e[s];this[l.name]=l.value}if(this.tableName=n,this.fields=e,a)for(var o=Object.keys(a),u=0;u<o.length;u+=1){var h=o[u],p=a[h];this[h]!==void 0&&(this[h]=p)}}_n.prototype.encode=function(){return Be.TABLE(this)};_n.prototype.sizeOf=function(){return lt.TABLE(this)};function co(n,e,a){a===void 0&&(a=e.length);var s=new Array(e.length+1);s[0]={name:n+"Count",type:"USHORT",value:a};for(var l=0;l<e.length;l++)s[l+1]={name:n+l,type:"USHORT",value:e[l]};return s}function Qf(n,e,a){var s=e.length,l=new Array(s+1);l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l[o+1]={name:n+o,type:"TABLE",value:a(e[o],o)};return l}function uo(n,e,a){var s=e.length,l=[];l[0]={name:n+"Count",type:"USHORT",value:s};for(var o=0;o<s;o++)l=l.concat(a(e[o],o));return l}function Nc(n){n.format===1?_n.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(co("glyph",n.glyphs))):n.format===2?_n.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(uo("rangeRecord",n.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):at.assert(!1,"Coverage format must be 1 or 2.")}Nc.prototype=Object.create(_n.prototype);Nc.prototype.constructor=Nc;function kc(n){_n.call(this,"scriptListTable",uo("scriptRecord",n,function(e,a){var s=e.script,l=s.defaultLangSys;return at.assert(!!l,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+a,type:"TAG",value:e.tag},{name:"script"+a,type:"TABLE",value:new _n("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new _n("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(co("featureIndex",l.featureIndexes)))}].concat(uo("langSys",s.langSysRecords,function(o,u){var h=o.langSys;return[{name:"langSysTag"+u,type:"TAG",value:o.tag},{name:"langSys"+u,type:"TABLE",value:new _n("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:h.reqFeatureIndex}].concat(co("featureIndex",h.featureIndexes)))}]})))}]}))}kc.prototype=Object.create(_n.prototype);kc.prototype.constructor=kc;function Rc(n){_n.call(this,"featureListTable",uo("featureRecord",n,function(e,a){var s=e.feature;return[{name:"featureTag"+a,type:"TAG",value:e.tag},{name:"feature"+a,type:"TABLE",value:new _n("featureTable",[{name:"featureParams",type:"USHORT",value:s.featureParams}].concat(co("lookupListIndex",s.lookupListIndexes)))}]}))}Rc.prototype=Object.create(_n.prototype);Rc.prototype.constructor=Rc;function Dc(n,e){_n.call(this,"lookupListTable",Qf("lookup",n,function(a){var s=e[a.lookupType];return at.assert(!!s,"Unable to write GSUB lookup type "+a.lookupType+" tables."),new _n("lookupTable",[{name:"lookupType",type:"USHORT",value:a.lookupType},{name:"lookupFlag",type:"USHORT",value:a.lookupFlag}].concat(Qf("subtable",a.subtables,s)))}))}Dc.prototype=Object.create(_n.prototype);Dc.prototype.constructor=Dc;var Fe={Table:_n,Record:_n,Coverage:Nc,ScriptList:kc,FeatureList:Rc,LookupList:Dc,ushortList:co,tableList:Qf,recordList:uo};function tm(n,e){return n.getUint8(e)}function _c(n,e){return n.getUint16(e,!1)}function pb(n,e){return n.getInt16(e,!1)}function dd(n,e){return n.getUint32(e,!1)}function pg(n,e){var a=n.getInt16(e,!1),s=n.getUint16(e+2,!1);return a+s/65535}function hb(n,e){for(var a="",s=e;s<e+4;s+=1)a+=String.fromCharCode(n.getInt8(s));return a}function mb(n,e,a){for(var s=0,l=0;l<a;l+=1)s<<=8,s+=n.getUint8(e+l);return s}function gb(n,e,a){for(var s=[],l=e;l<a;l+=1)s.push(n.getUint8(l));return s}function yb(n){for(var e="",a=0;a<n.length;a+=1)e+=String.fromCharCode(n[a]);return e}var vb={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function ye(n,e){this.data=n,this.offset=e,this.relativeOffset=0}ye.prototype.parseByte=function(){var n=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};ye.prototype.parseChar=function(){var n=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,n};ye.prototype.parseCard8=ye.prototype.parseByte;ye.prototype.parseUShort=function(){var n=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};ye.prototype.parseCard16=ye.prototype.parseUShort;ye.prototype.parseSID=ye.prototype.parseUShort;ye.prototype.parseOffset16=ye.prototype.parseUShort;ye.prototype.parseShort=function(){var n=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,n};ye.prototype.parseF2Dot14=function(){var n=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,n};ye.prototype.parseULong=function(){var n=dd(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};ye.prototype.parseOffset32=ye.prototype.parseULong;ye.prototype.parseFixed=function(){var n=pg(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,n};ye.prototype.parseString=function(n){var e=this.data,a=this.offset+this.relativeOffset,s="";this.relativeOffset+=n;for(var l=0;l<n;l++)s+=String.fromCharCode(e.getUint8(a+l));return s};ye.prototype.parseTag=function(){return this.parseString(4)};ye.prototype.parseLongDateTime=function(){var n=dd(this.data,this.offset+this.relativeOffset+4);return n-=2082844800,this.relativeOffset+=8,n};ye.prototype.parseVersion=function(n){var e=_c(this.data,this.offset+this.relativeOffset),a=_c(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,n===void 0&&(n=4096),e+a/n/10};ye.prototype.skip=function(n,e){e===void 0&&(e=1),this.relativeOffset+=vb[n]*e};ye.prototype.parseULongList=function(n){n===void 0&&(n=this.parseULong());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint32(s),s+=4;return this.relativeOffset+=n*4,e};ye.prototype.parseOffset16List=ye.prototype.parseUShortList=function(n){n===void 0&&(n=this.parseUShort());for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint16(s),s+=2;return this.relativeOffset+=n*2,e};ye.prototype.parseShortList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getInt16(s),s+=2;return this.relativeOffset+=n*2,e};ye.prototype.parseByteList=function(n){for(var e=new Array(n),a=this.data,s=this.offset+this.relativeOffset,l=0;l<n;l++)e[l]=a.getUint8(s++);return this.relativeOffset+=n,e};ye.prototype.parseList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};ye.prototype.parseList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=0;s<n;s++)a[s]=e.call(this);return a};ye.prototype.parseRecordList=function(n,e){e||(e=n,n=this.parseUShort());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var h=s[u],p=e[h];o[h]=p.call(this)}a[l]=o}return a};ye.prototype.parseRecordList32=function(n,e){e||(e=n,n=this.parseULong());for(var a=new Array(n),s=Object.keys(e),l=0;l<n;l++){for(var o={},u=0;u<s.length;u++){var h=s[u],p=e[h];o[h]=p.call(this)}a[l]=o}return a};ye.prototype.parseStruct=function(n){if(typeof n=="function")return n.call(this);for(var e=Object.keys(n),a={},s=0;s<e.length;s++){var l=e[s],o=n[l];a[l]=o.call(this)}return a};ye.prototype.parseValueRecord=function(n){if(n===void 0&&(n=this.parseUShort()),n!==0){var e={};return n&1&&(e.xPlacement=this.parseShort()),n&2&&(e.yPlacement=this.parseShort()),n&4&&(e.xAdvance=this.parseShort()),n&8&&(e.yAdvance=this.parseShort()),n&16&&(e.xPlaDevice=void 0,this.parseShort()),n&32&&(e.yPlaDevice=void 0,this.parseShort()),n&64&&(e.xAdvDevice=void 0,this.parseShort()),n&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};ye.prototype.parseValueRecordList=function(){for(var n=this.parseUShort(),e=this.parseUShort(),a=new Array(e),s=0;s<e;s++)a[s]=this.parseValueRecord(n);return a};ye.prototype.parsePointer=function(n){var e=this.parseOffset16();if(e>0)return new ye(this.data,this.offset+e).parseStruct(n)};ye.prototype.parsePointer32=function(n){var e=this.parseOffset32();if(e>0)return new ye(this.data,this.offset+e).parseStruct(n)};ye.prototype.parseListOfLists=function(n){for(var e=this.parseOffset16List(),a=e.length,s=this.relativeOffset,l=new Array(a),o=0;o<a;o++){var u=e[o];if(u===0){l[o]=void 0;continue}if(this.relativeOffset=u,n){for(var h=this.parseOffset16List(),p=new Array(h.length),g=0;g<h.length;g++)this.relativeOffset=u+h[g],p[g]=n.call(this);l[o]=p}else l[o]=this.parseUShortList()}return this.relativeOffset=s,l};ye.prototype.parseCoverage=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort(),a=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(a)};if(e===2){for(var s=new Array(a),l=0;l<a;l++)s[l]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:s}}throw new Error("0x"+n.toString(16)+": Coverage format must be 1 or 2.")};ye.prototype.parseClassDef=function(){var n=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:ye.uShort,end:ye.uShort,classId:ye.uShort})};throw new Error("0x"+n.toString(16)+": ClassDef format must be 1 or 2.")};ye.list=function(n,e){return function(){return this.parseList(n,e)}};ye.list32=function(n,e){return function(){return this.parseList32(n,e)}};ye.recordList=function(n,e){return function(){return this.parseRecordList(n,e)}};ye.recordList32=function(n,e){return function(){return this.parseRecordList32(n,e)}};ye.pointer=function(n){return function(){return this.parsePointer(n)}};ye.pointer32=function(n){return function(){return this.parsePointer32(n)}};ye.tag=ye.prototype.parseTag;ye.byte=ye.prototype.parseByte;ye.uShort=ye.offset16=ye.prototype.parseUShort;ye.uShortList=ye.prototype.parseUShortList;ye.uLong=ye.offset32=ye.prototype.parseULong;ye.uLongList=ye.prototype.parseULongList;ye.struct=ye.prototype.parseStruct;ye.coverage=ye.prototype.parseCoverage;ye.classDef=ye.prototype.parseClassDef;var nm={reserved:ye.uShort,reqFeatureIndex:ye.uShort,featureIndexes:ye.uShortList};ye.prototype.parseScriptList=function(){return this.parsePointer(ye.recordList({tag:ye.tag,script:ye.pointer({defaultLangSys:ye.pointer(nm),langSysRecords:ye.recordList({tag:ye.tag,langSys:ye.pointer(nm)})})}))||[]};ye.prototype.parseFeatureList=function(){return this.parsePointer(ye.recordList({tag:ye.tag,feature:ye.pointer({featureParams:ye.offset16,lookupListIndexes:ye.uShortList})}))||[]};ye.prototype.parseLookupList=function(n){return this.parsePointer(ye.list(ye.pointer(function(){var e=this.parseUShort();at.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var a=this.parseUShort(),s=a&16;return{lookupType:e,lookupFlag:a,subtables:this.parseList(ye.pointer(n[e])),markFilteringSet:s?this.parseUShort():void 0}})))||[]};ye.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var n=this.parseUShort(),e=this.parseUShort();at.argument(n===1&&e<1,"GPOS/GSUB feature variations table unknown.");var a=this.parseRecordList32({conditionSetOffset:ye.offset32,featureTableSubstitutionOffset:ye.offset32});return a})||[]};var qe={getByte:tm,getCard8:tm,getUShort:_c,getCard16:_c,getShort:pb,getULong:dd,getFixed:pg,getTag:hb,getOffset:mb,getBytes:gb,bytesToString:yb,Parser:ye};function bb(n,e){e.parseUShort(),n.length=e.parseULong(),n.language=e.parseULong();var a;n.groupCount=a=e.parseULong(),n.glyphIndexMap={};for(var s=0;s<a;s+=1)for(var l=e.parseULong(),o=e.parseULong(),u=e.parseULong(),h=l;h<=o;h+=1)n.glyphIndexMap[h]=u,u++}function xb(n,e,a,s,l){n.length=e.parseUShort(),n.language=e.parseUShort();var o;n.segCount=o=e.parseUShort()>>1,e.skip("uShort",3),n.glyphIndexMap={};for(var u=new qe.Parser(a,s+l+14),h=new qe.Parser(a,s+l+16+o*2),p=new qe.Parser(a,s+l+16+o*4),g=new qe.Parser(a,s+l+16+o*6),b=s+l+16+o*8,C=0;C<o-1;C+=1)for(var w=void 0,x=u.parseUShort(),M=h.parseUShort(),R=p.parseShort(),I=g.parseUShort(),H=M;H<=x;H+=1)I!==0?(b=g.offset+g.relativeOffset-2,b+=I,b+=(H-M)*2,w=qe.getUShort(a,b),w!==0&&(w=w+R&65535)):w=H+R&65535,n.glyphIndexMap[H]=w}function Sb(n,e){var a={};a.version=qe.getUShort(n,e),at.argument(a.version===0,"cmap table version should be 0."),a.numTables=qe.getUShort(n,e+2);for(var s=-1,l=a.numTables-1;l>=0;l-=1){var o=qe.getUShort(n,e+4+l*8),u=qe.getUShort(n,e+4+l*8+2);if(o===3&&(u===0||u===1||u===10)||o===0&&(u===0||u===1||u===2||u===3||u===4)){s=qe.getULong(n,e+4+l*8+4);break}}if(s===-1)throw new Error("No valid cmap sub-tables found.");var h=new qe.Parser(n,e+s);if(a.format=h.parseUShort(),a.format===12)bb(a,h);else if(a.format===4)xb(a,h,n,e,s);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+a.format+").");return a}function wb(n,e,a){n.segments.push({end:e,start:e,delta:-(e-a),offset:0,glyphIndex:a})}function Eb(n){n.segments.push({end:65535,start:65535,delta:1,offset:0})}function Ab(n){var e=!0,a;for(a=n.length-1;a>0;a-=1){var s=n.get(a);if(s.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var l=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(l=l.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),l=l.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new Fe.Table("cmap",l);for(o.segments=[],a=0;a<n.length;a+=1){for(var u=n.get(a),h=0;h<u.unicodes.length;h+=1)wb(o,u.unicodes[h],a);o.segments=o.segments.sort(function(B,D){return B.start-D.start})}Eb(o);var p=o.segments.length,g=0,b=[],C=[],w=[],x=[],M=[],R=[];for(a=0;a<p;a+=1){var I=o.segments[a];I.end<=65535&&I.start<=65535?(b=b.concat({name:"end_"+a,type:"USHORT",value:I.end}),C=C.concat({name:"start_"+a,type:"USHORT",value:I.start}),w=w.concat({name:"idDelta_"+a,type:"SHORT",value:I.delta}),x=x.concat({name:"idRangeOffset_"+a,type:"USHORT",value:I.offset}),I.glyphId!==void 0&&(M=M.concat({name:"glyph_"+a,type:"USHORT",value:I.glyphId}))):g+=1,!e&&I.glyphIndex!==void 0&&(R=R.concat({name:"cmap12Start_"+a,type:"ULONG",value:I.start}),R=R.concat({name:"cmap12End_"+a,type:"ULONG",value:I.end}),R=R.concat({name:"cmap12Glyph_"+a,type:"ULONG",value:I.glyphIndex}))}if(o.segCountX2=(p-g)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(p-g)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(b),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(C),o.fields=o.fields.concat(w),o.fields=o.fields.concat(x),o.fields=o.fields.concat(M),o.cmap4Length=14+b.length*2+2+C.length*2+w.length*2+x.length*2+M.length*2,!e){var H=16+R.length*4;o.cmap12Offset=20+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:H},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:R.length/3}]),o.fields=o.fields.concat(R)}return o}var hg={parse:Sb,make:Ab},Tc=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Tb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Cb=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],xi=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function mg(n){this.font=n}mg.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.font.glyphs;if(a){for(var s=0;s<a.length;s+=1)for(var l=a.get(s),o=0;o<l.unicodes.length;o+=1)if(l.unicodes[o]===e)return s}return null};function gg(n){this.cmap=n}gg.prototype.charToGlyphIndex=function(n){return this.cmap.glyphIndexMap[n.codePointAt(0)]||0};function Oc(n,e){this.encoding=n,this.charset=e}Oc.prototype.charToGlyphIndex=function(n){var e=n.codePointAt(0),a=this.encoding[e];return this.charset.indexOf(a)};function pd(n){switch(n.version){case 1:this.names=xi.slice();break;case 2:this.names=new Array(n.numberOfGlyphs);for(var e=0;e<n.numberOfGlyphs;e++)n.glyphNameIndex[e]<xi.length?this.names[e]=xi[n.glyphNameIndex[e]]:this.names[e]=n.names[n.glyphNameIndex[e]-xi.length];break;case 2.5:this.names=new Array(n.numberOfGlyphs);for(var a=0;a<n.numberOfGlyphs;a++)this.names[a]=xi[a+n.glyphNameIndex[a]];break;case 3:this.names=[];break;default:this.names=[];break}}pd.prototype.nameToGlyphIndex=function(n){return this.names.indexOf(n)};pd.prototype.glyphIndexToName=function(n){return this.names[n]};function Mb(n){for(var e,a=n.tables.cmap.glyphIndexMap,s=Object.keys(a),l=0;l<s.length;l+=1){var o=s[l],u=a[o];e=n.glyphs.get(u),e.addUnicode(parseInt(o))}for(var h=0;h<n.glyphs.length;h+=1)e=n.glyphs.get(h),n.cffEncoding?n.isCIDFont?e.name="gid"+h:e.name=n.cffEncoding.charset[h]:n.glyphNames.names&&(e.name=n.glyphNames.glyphIndexToName(h))}function Nb(n){n._IndexToUnicodeMap={};for(var e=n.tables.cmap.glyphIndexMap,a=Object.keys(e),s=0;s<a.length;s+=1){var l=a[s],o=e[l];n._IndexToUnicodeMap[o]===void 0?n._IndexToUnicodeMap[o]={unicodes:[parseInt(l)]}:n._IndexToUnicodeMap[o].unicodes.push(parseInt(l))}}function kb(n,e){e.lowMemory?Nb(n):Mb(n)}function Rb(n,e,a,s,l){n.beginPath(),n.moveTo(e,a),n.lineTo(s,l),n.stroke()}var vi={line:Rb};function Db(n,e){var a=e||new Sn;return{configurable:!0,get:function(){return typeof a=="function"&&(a=a()),a},set:function(s){a=s}}}function Ia(n){this.bindConstructorValues(n)}Ia.prototype.bindConstructorValues=function(n){this.index=n.index||0,this.name=n.name||null,this.unicode=n.unicode||void 0,this.unicodes=n.unicodes||n.unicode!==void 0?[n.unicode]:[],"xMin"in n&&(this.xMin=n.xMin),"yMin"in n&&(this.yMin=n.yMin),"xMax"in n&&(this.xMax=n.xMax),"yMax"in n&&(this.yMax=n.yMax),"advanceWidth"in n&&(this.advanceWidth=n.advanceWidth),Object.defineProperty(this,"path",Db(this,n.path))};Ia.prototype.addUnicode=function(n){this.unicodes.length===0&&(this.unicode=n),this.unicodes.push(n)};Ia.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Ia.prototype.getPath=function(n,e,a,s,l){n=n!==void 0?n:0,e=e!==void 0?e:0,a=a!==void 0?a:72;var o,u;s||(s={});var h=s.xScale,p=s.yScale;if(s.hinting&&l&&l.hinting&&(u=this.path&&l.hinting.exec(this,a)),u)o=l.hinting.getCommands(u),n=Math.round(n),e=Math.round(e),h=p=1;else{o=this.path.commands;var g=1/(this.path.unitsPerEm||1e3)*a;h===void 0&&(h=g),p===void 0&&(p=g)}for(var b=new Sn,C=0;C<o.length;C+=1){var w=o[C];w.type==="M"?b.moveTo(n+w.x*h,e+-w.y*p):w.type==="L"?b.lineTo(n+w.x*h,e+-w.y*p):w.type==="Q"?b.quadraticCurveTo(n+w.x1*h,e+-w.y1*p,n+w.x*h,e+-w.y*p):w.type==="C"?b.curveTo(n+w.x1*h,e+-w.y1*p,n+w.x2*h,e+-w.y2*p,n+w.x*h,e+-w.y*p):w.type==="Z"&&b.closePath()}return b};Ia.prototype.getContours=function(){if(this.points===void 0)return[];for(var n=[],e=[],a=0;a<this.points.length;a+=1){var s=this.points[a];e.push(s),s.lastPointOfContour&&(n.push(e),e=[])}return at.argument(e.length===0,"There are still points left in the current contour."),n};Ia.prototype.getMetrics=function(){for(var n=this.path.commands,e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];l.type!=="Z"&&(e.push(l.x),a.push(l.y)),(l.type==="Q"||l.type==="C")&&(e.push(l.x1),a.push(l.y1)),l.type==="C"&&(e.push(l.x2),a.push(l.y2))}var o={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,a),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o};Ia.prototype.draw=function(n,e,a,s,l){this.getPath(e,a,s,l).draw(n)};Ia.prototype.drawPoints=function(n,e,a,s){function l(C,w,x,M){n.beginPath();for(var R=0;R<C.length;R+=1)n.moveTo(w+C[R].x*M,x+C[R].y*M),n.arc(w+C[R].x*M,x+C[R].y*M,2,0,Math.PI*2,!1);n.closePath(),n.fill()}e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24;for(var o=1/this.path.unitsPerEm*s,u=[],h=[],p=this.path,g=0;g<p.commands.length;g+=1){var b=p.commands[g];b.x!==void 0&&u.push({x:b.x,y:-b.y}),b.x1!==void 0&&h.push({x:b.x1,y:-b.y1}),b.x2!==void 0&&h.push({x:b.x2,y:-b.y2})}n.fillStyle="blue",l(u,e,a,o),n.fillStyle="red",l(h,e,a,o)};Ia.prototype.drawMetrics=function(n,e,a,s){var l;e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:24,l=1/this.path.unitsPerEm*s,n.lineWidth=1,n.strokeStyle="black",vi.line(n,e,-1e4,e,1e4),vi.line(n,-1e4,a,1e4,a);var o=this.xMin||0,u=this.yMin||0,h=this.xMax||0,p=this.yMax||0,g=this.advanceWidth||0;n.strokeStyle="blue",vi.line(n,e+o*l,-1e4,e+o*l,1e4),vi.line(n,e+h*l,-1e4,e+h*l,1e4),vi.line(n,-1e4,a+-u*l,1e4,a+-u*l),vi.line(n,-1e4,a+-p*l,1e4,a+-p*l),n.strokeStyle="green",vi.line(n,e+g*l,-1e4,e+g*l,1e4)};function Sc(n,e,a){Object.defineProperty(n,e,{get:function(){return n.path,n[a]},set:function(s){n[a]=s},enumerable:!0,configurable:!0})}function hd(n,e){if(this.font=n,this.glyphs={},Array.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];s.path.unitsPerEm=n.unitsPerEm,this.glyphs[a]=s}this.length=e&&e.length||0}hd.prototype.get=function(n){if(this.glyphs[n]===void 0){this.font._push(n),typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());var e=this.glyphs[n],a=this.font._IndexToUnicodeMap[n];if(a)for(var s=0;s<a.unicodes.length;s++)e.addUnicode(a.unicodes[s]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+n:e.name=this.font.cffEncoding.charset[n]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(n)),this.glyphs[n].advanceWidth=this.font._hmtxTableData[n].advanceWidth,this.glyphs[n].leftSideBearing=this.font._hmtxTableData[n].leftSideBearing}else typeof this.glyphs[n]=="function"&&(this.glyphs[n]=this.glyphs[n]());return this.glyphs[n]};hd.prototype.push=function(n,e){this.glyphs[n]=e,this.length++};function _b(n,e){return new Ia({index:e,font:n})}function Ob(n,e,a,s,l,o){return function(){var u=new Ia({index:e,font:n});return u.path=function(){a(u,s,l);var h=o(n.glyphs,u);return h.unitsPerEm=n.unitsPerEm,h},Sc(u,"xMin","_xMin"),Sc(u,"xMax","_xMax"),Sc(u,"yMin","_yMin"),Sc(u,"yMax","_yMax"),u}}function Ib(n,e,a,s){return function(){var l=new Ia({index:e,font:n});return l.path=function(){var o=a(n,l,s);return o.unitsPerEm=n.unitsPerEm,o},l}}var Pr={GlyphSet:hd,glyphLoader:_b,ttfGlyphLoader:Ob,cffGlyphLoader:Ib};function yg(n,e){if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var a=0;a<n.length;a+=1)if(!yg(n[a],e[a]))return!1;return!0}else return!1}function Kf(n){var e;return n.length<1240?e=107:n.length<33900?e=1131:e=32768,e}function Xs(n,e,a){var s=[],l=[],o=qe.getCard16(n,e),u,h;if(o!==0){var p=qe.getByte(n,e+2);u=e+(o+1)*p+2;for(var g=e+3,b=0;b<o+1;b+=1)s.push(qe.getOffset(n,g,p)),g+=p;h=u+s[o]}else h=e+2;for(var C=0;C<s.length-1;C+=1){var w=qe.getBytes(n,u+s[C],u+s[C+1]);a&&(w=a(w)),l.push(w)}return{objects:l,startOffset:e,endOffset:h}}function Lb(n,e){var a=[],s=qe.getCard16(n,e),l,o;if(s!==0){var u=qe.getByte(n,e+2);l=e+(s+1)*u+2;for(var h=e+3,p=0;p<s+1;p+=1)a.push(qe.getOffset(n,h,u)),h+=u;o=l+a[s]}else o=e+2;return{offsets:a,startOffset:e,endOffset:o}}function Ub(n,e,a,s,l){var o=qe.getCard16(a,s),u=0;if(o!==0){var h=qe.getByte(a,s+2);u=s+(o+1)*h+2}var p=qe.getBytes(a,u+e[n],u+e[n+1]);return p}function jb(n){for(var e="",a=15,s=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var l=n.parseByte(),o=l>>4,u=l&15;if(o===a||(e+=s[o],u===a))break;e+=s[u]}return parseFloat(e)}function Bb(n,e){var a,s,l,o;if(e===28)return a=n.parseByte(),s=n.parseByte(),a<<8|s;if(e===29)return a=n.parseByte(),s=n.parseByte(),l=n.parseByte(),o=n.parseByte(),a<<24|s<<16|l<<8|o;if(e===30)return jb(n);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return a=n.parseByte(),(e-247)*256+a+108;if(e>=251&&e<=254)return a=n.parseByte(),-(e-251)*256-a-108;throw new Error("Invalid b0 "+e)}function Fb(n){for(var e={},a=0;a<n.length;a+=1){var s=n[a][0],l=n[a][1],o=void 0;if(l.length===1?o=l[0]:o=l,e.hasOwnProperty(s)&&!isNaN(e[s]))throw new Error("Object "+e+" already has key "+s);e[s]=o}return e}function vg(n,e,a){e=e!==void 0?e:0;var s=new qe.Parser(n,e),l=[],o=[];for(a=a!==void 0?a:n.length;s.relativeOffset<a;){var u=s.parseByte();u<=21?(u===12&&(u=1200+s.parseByte()),l.push([u,o]),o=[]):o.push(Bb(s,u))}return Fb(l)}function ro(n,e){return e<=390?e=Tc[e]:e=n[e-391],e}function bg(n,e,a){for(var s={},l,o=0;o<e.length;o+=1){var u=e[o];if(Array.isArray(u.type)){var h=[];h.length=u.type.length;for(var p=0;p<u.type.length;p++)l=n[u.op]!==void 0?n[u.op][p]:void 0,l===void 0&&(l=u.value!==void 0&&u.value[p]!==void 0?u.value[p]:null),u.type[p]==="SID"&&(l=ro(a,l)),h[p]=l;s[u.name]=h}else l=n[u.op],l===void 0&&(l=u.value!==void 0?u.value:null),u.type==="SID"&&(l=ro(a,l)),s[u.name]=l}return s}function Pb(n,e){var a={};return a.formatMajor=qe.getCard8(n,e),a.formatMinor=qe.getCard8(n,e+1),a.size=qe.getCard8(n,e+2),a.offsetSize=qe.getCard8(n,e+3),a.startOffset=e,a.endOffset=e+4,a}var xg=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Sg=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function zb(n,e){var a=vg(n,0,n.byteLength);return bg(a,xg,e)}function wg(n,e,a,s){var l=vg(n,e,a);return bg(l,Sg,s)}function am(n,e,a,s){for(var l=[],o=0;o<a.length;o+=1){var u=new DataView(new Uint8Array(a[o]).buffer),h=zb(u,s);h._subrs=[],h._subrsBias=0,h._defaultWidthX=0,h._nominalWidthX=0;var p=h.private[0],g=h.private[1];if(p!==0&&g!==0){var b=wg(n,g+e,p,s);if(h._defaultWidthX=b.defaultWidthX,h._nominalWidthX=b.nominalWidthX,b.subrs!==0){var C=g+b.subrs,w=Xs(n,C+e);h._subrs=w.objects,h._subrsBias=Kf(h._subrs)}h._privateDict=b}l.push(h)}return l}function Gb(n,e,a,s){var l,o,u=new qe.Parser(n,e);a-=1;var h=[".notdef"],p=u.parseCard8();if(p===0)for(var g=0;g<a;g+=1)l=u.parseSID(),h.push(ro(s,l));else if(p===1)for(;h.length<=a;){l=u.parseSID(),o=u.parseCard8();for(var b=0;b<=o;b+=1)h.push(ro(s,l)),l+=1}else if(p===2)for(;h.length<=a;){l=u.parseSID(),o=u.parseCard16();for(var C=0;C<=o;C+=1)h.push(ro(s,l)),l+=1}else throw new Error("Unknown charset format "+p);return h}function Hb(n,e,a){var s,l={},o=new qe.Parser(n,e),u=o.parseCard8();if(u===0)for(var h=o.parseCard8(),p=0;p<h;p+=1)s=o.parseCard8(),l[s]=p;else if(u===1){var g=o.parseCard8();s=1;for(var b=0;b<g;b+=1)for(var C=o.parseCard8(),w=o.parseCard8(),x=C;x<=C+w;x+=1)l[x]=s,s+=1}else throw new Error("Unknown encoding format "+u);return new Oc(l,a)}function rm(n,e,a){var s,l,o,u,h=new Sn,p=[],g=0,b=!1,C=!1,w=0,x=0,M,R,I,H;if(n.isCIDFont){var B=n.tables.cff.topDict._fdSelect[e.index],D=n.tables.cff.topDict._fdArray[B];M=D._subrs,R=D._subrsBias,I=D._defaultWidthX,H=D._nominalWidthX}else M=n.tables.cff.topDict._subrs,R=n.tables.cff.topDict._subrsBias,I=n.tables.cff.topDict._defaultWidthX,H=n.tables.cff.topDict._nominalWidthX;var j=I;function _(J,ae){C&&h.closePath(),h.moveTo(J,ae),C=!0}function G(){var J;J=p.length%2!==0,J&&!b&&(j=p.shift()+H),g+=p.length>>1,p.length=0,b=!0}function Y(J){for(var ae,re,O,W,K,Z,ee,V,te,ce,xe,$,Q=0;Q<J.length;){var ve=J[Q];switch(Q+=1,ve){case 1:G();break;case 3:G();break;case 4:p.length>1&&!b&&(j=p.shift()+H,b=!0),x+=p.pop(),_(w,x);break;case 5:for(;p.length>0;)w+=p.shift(),x+=p.shift(),h.lineTo(w,x);break;case 6:for(;p.length>0&&(w+=p.shift(),h.lineTo(w,x),p.length!==0);)x+=p.shift(),h.lineTo(w,x);break;case 7:for(;p.length>0&&(x+=p.shift(),h.lineTo(w,x),p.length!==0);)w+=p.shift(),h.lineTo(w,x);break;case 8:for(;p.length>0;)s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u+p.shift(),h.curveTo(s,l,o,u,w,x);break;case 10:K=p.pop()+R,Z=M[K],Z&&Y(Z);break;case 11:return;case 12:switch(ve=J[Q],Q+=1,ve){case 35:s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),ee=o+p.shift(),V=u+p.shift(),te=ee+p.shift(),ce=V+p.shift(),xe=te+p.shift(),$=ce+p.shift(),w=xe+p.shift(),x=$+p.shift(),p.shift(),h.curveTo(s,l,o,u,ee,V),h.curveTo(te,ce,xe,$,w,x);break;case 34:s=w+p.shift(),l=x,o=s+p.shift(),u=l+p.shift(),ee=o+p.shift(),V=u,te=ee+p.shift(),ce=u,xe=te+p.shift(),$=x,w=xe+p.shift(),h.curveTo(s,l,o,u,ee,V),h.curveTo(te,ce,xe,$,w,x);break;case 36:s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),ee=o+p.shift(),V=u,te=ee+p.shift(),ce=u,xe=te+p.shift(),$=ce+p.shift(),w=xe+p.shift(),h.curveTo(s,l,o,u,ee,V),h.curveTo(te,ce,xe,$,w,x);break;case 37:s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),ee=o+p.shift(),V=u+p.shift(),te=ee+p.shift(),ce=V+p.shift(),xe=te+p.shift(),$=ce+p.shift(),Math.abs(xe-w)>Math.abs($-x)?w=xe+p.shift():x=$+p.shift(),h.curveTo(s,l,o,u,ee,V),h.curveTo(te,ce,xe,$,w,x);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+ve),p.length=0}break;case 14:p.length>0&&!b&&(j=p.shift()+H,b=!0),C&&(h.closePath(),C=!1);break;case 18:G();break;case 19:case 20:G(),Q+=g+7>>3;break;case 21:p.length>2&&!b&&(j=p.shift()+H,b=!0),x+=p.pop(),w+=p.pop(),_(w,x);break;case 22:p.length>1&&!b&&(j=p.shift()+H,b=!0),w+=p.pop(),_(w,x);break;case 23:G();break;case 24:for(;p.length>2;)s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u+p.shift(),h.curveTo(s,l,o,u,w,x);w+=p.shift(),x+=p.shift(),h.lineTo(w,x);break;case 25:for(;p.length>6;)w+=p.shift(),x+=p.shift(),h.lineTo(w,x);s=w+p.shift(),l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u+p.shift(),h.curveTo(s,l,o,u,w,x);break;case 26:for(p.length%2&&(w+=p.shift());p.length>0;)s=w,l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o,x=u+p.shift(),h.curveTo(s,l,o,u,w,x);break;case 27:for(p.length%2&&(x+=p.shift());p.length>0;)s=w+p.shift(),l=x,o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u,h.curveTo(s,l,o,u,w,x);break;case 28:ae=J[Q],re=J[Q+1],p.push((ae<<24|re<<16)>>16),Q+=2;break;case 29:K=p.pop()+n.gsubrsBias,Z=n.gsubrs[K],Z&&Y(Z);break;case 30:for(;p.length>0&&(s=w,l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,w,x),p.length!==0);)s=w+p.shift(),l=x,o=s+p.shift(),u=l+p.shift(),x=u+p.shift(),w=o+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,w,x);break;case 31:for(;p.length>0&&(s=w+p.shift(),l=x,o=s+p.shift(),u=l+p.shift(),x=u+p.shift(),w=o+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,w,x),p.length!==0);)s=w,l=x+p.shift(),o=s+p.shift(),u=l+p.shift(),w=o+p.shift(),x=u+(p.length===1?p.shift():0),h.curveTo(s,l,o,u,w,x);break;default:ve<32?console.log("Glyph "+e.index+": unknown operator "+ve):ve<247?p.push(ve-139):ve<251?(ae=J[Q],Q+=1,p.push((ve-247)*256+ae+108)):ve<255?(ae=J[Q],Q+=1,p.push(-(ve-251)*256-ae-108)):(ae=J[Q],re=J[Q+1],O=J[Q+2],W=J[Q+3],Q+=4,p.push((ae<<24|re<<16|O<<8|W)/65536))}}}return Y(a),e.advanceWidth=j,h}function Yb(n,e,a,s){var l=[],o,u=new qe.Parser(n,e),h=u.parseCard8();if(h===0)for(var p=0;p<a;p++){if(o=u.parseCard8(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");l.push(o)}else if(h===3){var g=u.parseCard16(),b=u.parseCard16();if(b!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+b);for(var C,w=0;w<g;w++){if(o=u.parseCard8(),C=u.parseCard16(),o>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+s+")");if(C>a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+C);for(;b<C;b++)l.push(o);b=C}if(C!==a)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+C)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+h);return l}function qb(n,e,a,s){a.tables.cff={};var l=Pb(n,e),o=Xs(n,l.endOffset,qe.bytesToString),u=Xs(n,o.endOffset),h=Xs(n,u.endOffset,qe.bytesToString),p=Xs(n,h.endOffset);a.gsubrs=p.objects,a.gsubrsBias=Kf(a.gsubrs);var g=am(n,e,u.objects,h.objects);if(g.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+g.length);var b=g[0];if(a.tables.cff.topDict=b,b._privateDict&&(a.defaultWidthX=b._privateDict.defaultWidthX,a.nominalWidthX=b._privateDict.nominalWidthX),b.ros[0]!==void 0&&b.ros[1]!==void 0&&(a.isCIDFont=!0),a.isCIDFont){var C=b.fdArray,w=b.fdSelect;if(C===0||w===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");C+=e;var x=Xs(n,C),M=am(n,e,x.objects,h.objects);b._fdArray=M,w+=e,b._fdSelect=Yb(n,w,a.numGlyphs,M.length)}var R=e+b.private[1],I=wg(n,R,b.private[0],h.objects);if(a.defaultWidthX=I.defaultWidthX,a.nominalWidthX=I.nominalWidthX,I.subrs!==0){var H=R+I.subrs,B=Xs(n,H);a.subrs=B.objects,a.subrsBias=Kf(a.subrs)}else a.subrs=[],a.subrsBias=0;var D;s.lowMemory?(D=Lb(n,e+b.charStrings),a.nGlyphs=D.offsets.length):(D=Xs(n,e+b.charStrings),a.nGlyphs=D.objects.length);var j=Gb(n,e+b.charset,a.nGlyphs,h.objects);if(b.encoding===0?a.cffEncoding=new Oc(Tb,j):b.encoding===1?a.cffEncoding=new Oc(Cb,j):a.cffEncoding=Hb(n,e+b.encoding,j),a.encoding=a.encoding||a.cffEncoding,a.glyphs=new Pr.GlyphSet(a),s.lowMemory)a._push=function(Y){var J=Ub(Y,D.offsets,n,e+b.charStrings);a.glyphs.push(Y,Pr.cffGlyphLoader(a,Y,rm,J))};else for(var _=0;_<a.nGlyphs;_+=1){var G=D.objects[_];a.glyphs.push(_,Pr.cffGlyphLoader(a,_,rm,G))}}function Eg(n,e){var a,s=Tc.indexOf(n);return s>=0&&(a=s),s=e.indexOf(n),s>=0?a=s+Tc.length:(a=Tc.length+e.length,e.push(n)),a}function Vb(){return new Fe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Xb(n){var e=new Fe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var a=0;a<n.length;a+=1)e.names.push({name:"name_"+a,type:"NAME",value:n[a]});return e}function Ag(n,e,a){for(var s={},l=0;l<n.length;l+=1){var o=n[l],u=e[o.name];u!==void 0&&!yg(u,o.value)&&(o.type==="SID"&&(u=Eg(u,a)),s[o.op]={name:o.name,type:o.type,value:u})}return s}function sm(n,e){var a=new Fe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=Ag(xg,n,e),a}function im(n){var e=new Fe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:n}],e}function $b(n){var e=new Fe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var a=0;a<n.length;a+=1)e.strings.push({name:"string_"+a,type:"STRING",value:n[a]});return e}function Wb(){return new Fe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Zb(n,e){for(var a=new Fe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),s=0;s<n.length;s+=1){var l=n[s],o=Eg(l,e);a.fields.push({name:"glyph_"+s,type:"SID",value:o})}return a}function Qb(n){var e=[],a=n.path;e.push({name:"width",type:"NUMBER",value:n.advanceWidth});for(var s=0,l=0,o=0;o<a.commands.length;o+=1){var u=void 0,h=void 0,p=a.commands[o];if(p.type==="Q"){var g=.3333333333333333,b=2/3;p={type:"C",x:p.x,y:p.y,x1:Math.round(g*s+b*p.x1),y1:Math.round(g*l+b*p.y1),x2:Math.round(g*p.x+b*p.x1),y2:Math.round(g*p.y+b*p.y1)}}if(p.type==="M")u=Math.round(p.x-s),h=Math.round(p.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rmoveto",type:"OP",value:21}),s=Math.round(p.x),l=Math.round(p.y);else if(p.type==="L")u=Math.round(p.x-s),h=Math.round(p.y-l),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rlineto",type:"OP",value:5}),s=Math.round(p.x),l=Math.round(p.y);else if(p.type==="C"){var C=Math.round(p.x1-s),w=Math.round(p.y1-l),x=Math.round(p.x2-p.x1),M=Math.round(p.y2-p.y1);u=Math.round(p.x-p.x2),h=Math.round(p.y-p.y2),e.push({name:"dx1",type:"NUMBER",value:C}),e.push({name:"dy1",type:"NUMBER",value:w}),e.push({name:"dx2",type:"NUMBER",value:x}),e.push({name:"dy2",type:"NUMBER",value:M}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:h}),e.push({name:"rrcurveto",type:"OP",value:8}),s=Math.round(p.x),l=Math.round(p.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Kb(n){for(var e=new Fe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),a=0;a<n.length;a+=1){var s=n.get(a),l=Qb(s);e.charStrings.push({name:s.name,type:"CHARSTRING",value:l})}return e}function Jb(n,e){var a=new Fe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=Ag(Sg,n,e),a}function ex(n,e){for(var a=new Fe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),s=1/e.unitsPerEm,l={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[s,0,0,s,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},u=[],h,p=1;p<n.length;p+=1)h=n.get(p),u.push(h.name);var g=[];a.header=Vb(),a.nameIndex=Xb([e.postScriptName]);var b=sm(l,g);a.topDictIndex=im(b),a.globalSubrIndex=Wb(),a.charsets=Zb(u,g),a.charStringsIndex=Kb(n),a.privateDict=Jb(o,g),a.stringIndex=$b(g);var C=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return l.charset=C,l.encoding=0,l.charStrings=l.charset+a.charsets.sizeOf(),l.private[1]=l.charStrings+a.charStringsIndex.sizeOf(),b=sm(l,g),a.topDictIndex=im(b),a}var Tg={parse:qb,make:ex};function tx(n,e){var a={},s=new qe.Parser(n,e);return a.version=s.parseVersion(),a.fontRevision=Math.round(s.parseFixed()*1e3)/1e3,a.checkSumAdjustment=s.parseULong(),a.magicNumber=s.parseULong(),at.argument(a.magicNumber===1594834165,"Font header has wrong magic number."),a.flags=s.parseUShort(),a.unitsPerEm=s.parseUShort(),a.created=s.parseLongDateTime(),a.modified=s.parseLongDateTime(),a.xMin=s.parseShort(),a.yMin=s.parseShort(),a.xMax=s.parseShort(),a.yMax=s.parseShort(),a.macStyle=s.parseUShort(),a.lowestRecPPEM=s.parseUShort(),a.fontDirectionHint=s.parseShort(),a.indexToLocFormat=s.parseShort(),a.glyphDataFormat=s.parseShort(),a}function nx(n){var e=Math.round(new Date().getTime()/1e3)+2082844800,a=e;return n.createdTimestamp&&(a=n.createdTimestamp+2082844800),new Fe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:a},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],n)}var Cg={parse:tx,make:nx};function ax(n,e){var a={},s=new qe.Parser(n,e);return a.version=s.parseVersion(),a.ascender=s.parseShort(),a.descender=s.parseShort(),a.lineGap=s.parseShort(),a.advanceWidthMax=s.parseUShort(),a.minLeftSideBearing=s.parseShort(),a.minRightSideBearing=s.parseShort(),a.xMaxExtent=s.parseShort(),a.caretSlopeRise=s.parseShort(),a.caretSlopeRun=s.parseShort(),a.caretOffset=s.parseShort(),s.relativeOffset+=8,a.metricDataFormat=s.parseShort(),a.numberOfHMetrics=s.parseUShort(),a}function rx(n){return new Fe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],n)}var Mg={parse:ax,make:rx};function sx(n,e,a,s,l){for(var o,u,h=new qe.Parser(n,e),p=0;p<s;p+=1){p<a&&(o=h.parseUShort(),u=h.parseShort());var g=l.get(p);g.advanceWidth=o,g.leftSideBearing=u}}function ix(n,e,a,s,l){n._hmtxTableData={};for(var o,u,h=new qe.Parser(e,a),p=0;p<l;p+=1)p<s&&(o=h.parseUShort(),u=h.parseShort()),n._hmtxTableData[p]={advanceWidth:o,leftSideBearing:u}}function lx(n,e,a,s,l,o,u){u.lowMemory?ix(n,e,a,s,l):sx(e,a,s,l,o)}function ox(n){for(var e=new Fe.Table("hmtx",[]),a=0;a<n.length;a+=1){var s=n.get(a),l=s.advanceWidth||0,o=s.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+a,type:"USHORT",value:l}),e.fields.push({name:"leftSideBearing_"+a,type:"SHORT",value:o})}return e}var Ng={parse:lx,make:ox};function cx(n){for(var e=new Fe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:n.length}]),a="",s=12+n.length*4,l=0;l<n.length;++l){var o=a.indexOf(n[l]);o<0&&(o=a.length,a+=n[l]),e.fields.push({name:"offset "+l,type:"USHORT",value:s+o}),e.fields.push({name:"length "+l,type:"USHORT",value:n[l].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),e}function ux(n,e){var a=new qe.Parser(n,e),s=a.parseULong();at.argument(s===1,"Unsupported ltag table version."),a.skip("uLong",1);for(var l=a.parseULong(),o=[],u=0;u<l;u++){for(var h="",p=e+a.parseUShort(),g=a.parseUShort(),b=p;b<p+g;++b)h+=String.fromCharCode(n.getInt8(b));o.push(h)}return o}var kg={make:cx,parse:ux};function fx(n,e){var a={},s=new qe.Parser(n,e);return a.version=s.parseVersion(),a.numGlyphs=s.parseUShort(),a.version===1&&(a.maxPoints=s.parseUShort(),a.maxContours=s.parseUShort(),a.maxCompositePoints=s.parseUShort(),a.maxCompositeContours=s.parseUShort(),a.maxZones=s.parseUShort(),a.maxTwilightPoints=s.parseUShort(),a.maxStorage=s.parseUShort(),a.maxFunctionDefs=s.parseUShort(),a.maxInstructionDefs=s.parseUShort(),a.maxStackElements=s.parseUShort(),a.maxSizeOfInstructions=s.parseUShort(),a.maxComponentElements=s.parseUShort(),a.maxComponentDepth=s.parseUShort()),a}function dx(n){return new Fe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:n}])}var Rg={parse:fx,make:dx},Dg=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],_g={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},px={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Og={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function hx(n,e,a){switch(n){case 0:if(e===65535)return"und";if(a)return a[e];break;case 1:return _g[e];case 3:return Og[e]}}var Jf="utf-16",mx={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},gx={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Ig(n,e,a){switch(n){case 0:return Jf;case 1:return gx[a]||mx[e];case 3:if(e===1||e===10)return Jf;break}}function yx(n,e,a){for(var s={},l=new qe.Parser(n,e),o=l.parseUShort(),u=l.parseUShort(),h=l.offset+l.parseUShort(),p=0;p<u;p++){var g=l.parseUShort(),b=l.parseUShort(),C=l.parseUShort(),w=l.parseUShort(),x=Dg[w]||w,M=l.parseUShort(),R=l.parseUShort(),I=hx(g,C,a),H=Ig(g,b,C);if(H!==void 0&&I!==void 0){var B=void 0;if(H===Jf?B=ol.UTF16(n,h+R,M):B=ol.MACSTRING(n,h+R,M,H),B){var D=s[x];D===void 0&&(D=s[x]={}),D[I]=B}}}return o===1&&l.parseUShort(),s}function Lf(n){var e={};for(var a in n)e[n[a]]=parseInt(a);return e}function lm(n,e,a,s,l,o){return new Fe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:n},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:a},{name:"nameID",type:"USHORT",value:s},{name:"length",type:"USHORT",value:l},{name:"offset",type:"USHORT",value:o}])}function vx(n,e){var a=n.length,s=e.length-a+1;e:for(var l=0;l<s;l++)for(;l<s;l++){for(var o=0;o<a;o++)if(e[l+o]!==n[o])continue e;return l}return-1}function om(n,e){var a=vx(n,e);if(a<0){a=e.length;for(var s=0,l=n.length;s<l;++s)e.push(n[s])}return a}function bx(n,e){var a,s=[],l={},o=Lf(Dg);for(var u in n){var h=o[u];if(h===void 0&&(h=u),a=parseInt(h),isNaN(a))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');l[a]=n[u],s.push(a)}for(var p=Lf(_g),g=Lf(Og),b=[],C=[],w=0;w<s.length;w++){a=s[w];var x=l[a];for(var M in x){var R=x[M],I=1,H=p[M],B=px[H],D=Ig(I,B,H),j=Be.MACSTRING(R,D);j===void 0&&(I=0,H=e.indexOf(M),H<0&&(H=e.length,e.push(M)),B=4,j=Be.UTF16(R));var _=om(j,C);b.push(lm(I,B,H,a,j.length,_));var G=g[M];if(G!==void 0){var Y=Be.UTF16(R),J=om(Y,C);b.push(lm(3,1,G,a,Y.length,J))}}}b.sort(function(O,W){return O.platformID-W.platformID||O.encodingID-W.encodingID||O.languageID-W.languageID||O.nameID-W.nameID});for(var ae=new Fe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:b.length},{name:"stringOffset",type:"USHORT",value:6+b.length*12}]),re=0;re<b.length;re++)ae.fields.push({name:"record_"+re,type:"RECORD",value:b[re]});return ae.fields.push({name:"strings",type:"LITERAL",value:C}),ae}var Lg={parse:yx,make:bx},ed=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function xx(n){for(var e=0;e<ed.length;e+=1){var a=ed[e];if(n>=a.begin&&n<a.end)return e}return-1}function Sx(n,e){var a={},s=new qe.Parser(n,e);a.version=s.parseUShort(),a.xAvgCharWidth=s.parseShort(),a.usWeightClass=s.parseUShort(),a.usWidthClass=s.parseUShort(),a.fsType=s.parseUShort(),a.ySubscriptXSize=s.parseShort(),a.ySubscriptYSize=s.parseShort(),a.ySubscriptXOffset=s.parseShort(),a.ySubscriptYOffset=s.parseShort(),a.ySuperscriptXSize=s.parseShort(),a.ySuperscriptYSize=s.parseShort(),a.ySuperscriptXOffset=s.parseShort(),a.ySuperscriptYOffset=s.parseShort(),a.yStrikeoutSize=s.parseShort(),a.yStrikeoutPosition=s.parseShort(),a.sFamilyClass=s.parseShort(),a.panose=[];for(var l=0;l<10;l++)a.panose[l]=s.parseByte();return a.ulUnicodeRange1=s.parseULong(),a.ulUnicodeRange2=s.parseULong(),a.ulUnicodeRange3=s.parseULong(),a.ulUnicodeRange4=s.parseULong(),a.achVendID=String.fromCharCode(s.parseByte(),s.parseByte(),s.parseByte(),s.parseByte()),a.fsSelection=s.parseUShort(),a.usFirstCharIndex=s.parseUShort(),a.usLastCharIndex=s.parseUShort(),a.sTypoAscender=s.parseShort(),a.sTypoDescender=s.parseShort(),a.sTypoLineGap=s.parseShort(),a.usWinAscent=s.parseUShort(),a.usWinDescent=s.parseUShort(),a.version>=1&&(a.ulCodePageRange1=s.parseULong(),a.ulCodePageRange2=s.parseULong()),a.version>=2&&(a.sxHeight=s.parseShort(),a.sCapHeight=s.parseShort(),a.usDefaultChar=s.parseUShort(),a.usBreakChar=s.parseUShort(),a.usMaxContent=s.parseUShort()),a}function wx(n){return new Fe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],n)}var td={parse:Sx,make:wx,unicodeRanges:ed,getUnicodeRange:xx};function Ex(n,e){var a={},s=new qe.Parser(n,e);switch(a.version=s.parseVersion(),a.italicAngle=s.parseFixed(),a.underlinePosition=s.parseShort(),a.underlineThickness=s.parseShort(),a.isFixedPitch=s.parseULong(),a.minMemType42=s.parseULong(),a.maxMemType42=s.parseULong(),a.minMemType1=s.parseULong(),a.maxMemType1=s.parseULong(),a.version){case 1:a.names=xi.slice();break;case 2:a.numberOfGlyphs=s.parseUShort(),a.glyphNameIndex=new Array(a.numberOfGlyphs);for(var l=0;l<a.numberOfGlyphs;l++)a.glyphNameIndex[l]=s.parseUShort();a.names=[];for(var o=0;o<a.numberOfGlyphs;o++)if(a.glyphNameIndex[o]>=xi.length){var u=s.parseChar();a.names.push(s.parseString(u))}break;case 2.5:a.numberOfGlyphs=s.parseUShort(),a.offset=new Array(a.numberOfGlyphs);for(var h=0;h<a.numberOfGlyphs;h++)a.offset[h]=s.parseChar();break}return a}function Ax(){return new Fe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Ug={parse:Ex,make:Ax},vr=new Array(9);vr[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(ye.coverage),deltaGlyphId:this.parseUShort()};if(a===2)return{substFormat:2,coverage:this.parsePointer(ye.coverage),substitute:this.parseOffset16List()};at.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};vr[2]=function(){var e=this.parseUShort();return at.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),sequences:this.parseListOfLists()}};vr[3]=function(){var e=this.parseUShort();return at.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),alternateSets:this.parseListOfLists()}};vr[4]=function(){var e=this.parseUShort();return at.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var il={sequenceIndex:ye.uShort,lookupListIndex:ye.uShort};vr[5]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:a,coverage:this.parsePointer(ye.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,il)}})};if(a===2)return{substFormat:a,coverage:this.parsePointer(ye.coverage),classDef:this.parsePointer(ye.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(u,il)}})};if(a===3){var s=this.parseUShort(),l=this.parseUShort();return{substFormat:a,coverages:this.parseList(s,ye.pointer(ye.coverage)),lookupRecords:this.parseRecordList(l,il)}}at.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};vr[6]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{substFormat:1,coverage:this.parsePointer(ye.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(il)}})};if(a===2)return{substFormat:2,coverage:this.parsePointer(ye.coverage),backtrackClassDef:this.parsePointer(ye.classDef),inputClassDef:this.parsePointer(ye.classDef),lookaheadClassDef:this.parsePointer(ye.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(il)}})};if(a===3)return{substFormat:3,backtrackCoverage:this.parseList(ye.pointer(ye.coverage)),inputCoverage:this.parseList(ye.pointer(ye.coverage)),lookaheadCoverage:this.parseList(ye.pointer(ye.coverage)),lookupRecords:this.parseRecordList(il)};at.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};vr[7]=function(){var e=this.parseUShort();at.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var a=this.parseUShort(),s=new ye(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:a,extension:vr[a].call(s)}};vr[8]=function(){var e=this.parseUShort();return at.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(ye.coverage),backtrackCoverage:this.parseList(ye.pointer(ye.coverage)),lookaheadCoverage:this.parseList(ye.pointer(ye.coverage)),substitutes:this.parseUShortList()}};function Tx(n,e){e=e||0;var a=new ye(n,e),s=a.parseVersion(1);return at.argument(s===1||s===1.1,"Unsupported GSUB table version."),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(vr)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(vr),variations:a.parseFeatureVariationsList()}}var cl=new Array(9);cl[1]=function(e){return e.substFormat===1?new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.ushortList("substitute",e.substitute)))};cl[2]=function(e){return at.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("seqSet",e.sequences,function(a){return new Fe.Table("sequenceSetTable",Fe.ushortList("sequence",a))})))};cl[3]=function(e){return at.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("altSet",e.alternateSets,function(a){return new Fe.Table("alternateSetTable",Fe.ushortList("alternate",a))})))};cl[4]=function(e){return at.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("ligSet",e.ligatureSets,function(a){return new Fe.Table("ligatureSetTable",Fe.tableList("ligature",a,function(s){return new Fe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:s.ligGlyph}].concat(Fe.ushortList("component",s.components,s.components.length+1)))}))})))};cl[6]=function(e){if(e.substFormat===1){var a=new Fe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Fe.Coverage(e.coverage)}].concat(Fe.tableList("chainRuleSet",e.chainRuleSets,function(o){return new Fe.Table("chainRuleSetTable",Fe.tableList("chainRule",o,function(u){var h=Fe.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(Fe.ushortList("inputGlyph",u.input,u.input.length+1)).concat(Fe.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(Fe.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(p,g){h=h.concat({name:"sequenceIndex"+g,type:"USHORT",value:p.sequenceIndex}).concat({name:"lookupListIndex"+g,type:"USHORT",value:p.lookupListIndex})}),new Fe.Table("chainRuleTable",h)}))})));return a}else if(e.substFormat===2)at.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var s=[{name:"substFormat",type:"USHORT",value:e.substFormat}];s.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(o,u){s.push({name:"backtrackCoverage"+u,type:"TABLE",value:new Fe.Coverage(o)})}),s.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(o,u){s.push({name:"inputCoverage"+u,type:"TABLE",value:new Fe.Coverage(o)})}),s.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(o,u){s.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new Fe.Coverage(o)})}),s.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(o,u){s=s.concat({name:"sequenceIndex"+u,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:o.lookupListIndex})});var l=new Fe.Table("chainContextTable",s);return l}at.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Cx(n){return new Fe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Fe.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new Fe.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new Fe.LookupList(n.lookups,cl)}])}var jg={parse:Tx,make:Cx};function Mx(n,e){var a=new qe.Parser(n,e),s=a.parseULong();at.argument(s===1,"Unsupported META table version."),a.parseULong(),a.parseULong();for(var l=a.parseULong(),o={},u=0;u<l;u++){var h=a.parseTag(),p=a.parseULong(),g=a.parseULong(),b=ol.UTF8(n,e+p,g);o[h]=b}return o}function Nx(n){var e=Object.keys(n).length,a="",s=16+e*12,l=new Fe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:s},{name:"numTags",type:"ULONG",value:e}]);for(var o in n){var u=a.length;a+=n[o],l.fields.push({name:"tag "+o,type:"TAG",value:o}),l.fields.push({name:"offset "+o,type:"ULONG",value:s+u}),l.fields.push({name:"length "+o,type:"ULONG",value:n[o].length})}return l.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),l}var Bg={parse:Mx,make:Nx};function cm(n){return Math.log(n)/Math.log(2)|0}function md(n){for(;n.length%4!==0;)n.push(0);for(var e=0,a=0;a<n.length;a+=4)e+=(n[a]<<24)+(n[a+1]<<16)+(n[a+2]<<8)+n[a+3];return e%=Math.pow(2,32),e}function um(n,e,a,s){return new Fe.Record("Table Record",[{name:"tag",type:"TAG",value:n!==void 0?n:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:a!==void 0?a:0},{name:"length",type:"ULONG",value:s!==void 0?s:0}])}function Fg(n){var e=new Fe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=n,e.numTables=n.length;var a=Math.pow(2,cm(e.numTables));e.searchRange=16*a,e.entrySelector=cm(a),e.rangeShift=e.numTables*16-e.searchRange;for(var s=[],l=[],o=e.sizeOf()+um().sizeOf()*e.numTables;o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<n.length;u+=1){var h=n[u];at.argument(h.tableName.length===4,"Table name"+h.tableName+" is invalid.");var p=h.sizeOf(),g=um(h.tableName,md(h.encode()),o,p);for(s.push({name:g.tag+" Table Record",type:"RECORD",value:g}),l.push({name:h.tableName+" table",type:"RECORD",value:h}),o+=p,at.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,l.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(b,C){return b.value.tag>C.value.tag?1:-1}),e.fields=e.fields.concat(s),e.fields=e.fields.concat(l),e}function fm(n,e,a){for(var s=0;s<e.length;s+=1){var l=n.charToGlyphIndex(e[s]);if(l>0){var o=n.glyphs.get(l);return o.getMetrics()}}return a}function kx(n){for(var e=0,a=0;a<n.length;a+=1)e+=n[a];return e/n.length}function Rx(n){for(var e=[],a=[],s=[],l=[],o=[],u=[],h=[],p,g=0,b=0,C=0,w=0,x=0,M=0;M<n.glyphs.length;M+=1){var R=n.glyphs.get(M),I=R.unicode|0;if(isNaN(R.advanceWidth))throw new Error("Glyph "+R.name+" ("+M+"): advanceWidth is not a number.");(p>I||p===void 0)&&I>0&&(p=I),g<I&&(g=I);var H=td.getUnicodeRange(I);if(H<32)b|=1<<H;else if(H<64)C|=1<<H-32;else if(H<96)w|=1<<H-64;else if(H<123)x|=1<<H-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(R.name!==".notdef"){var B=R.getMetrics();e.push(B.xMin),a.push(B.yMin),s.push(B.xMax),l.push(B.yMax),u.push(B.leftSideBearing),h.push(B.rightSideBearing),o.push(R.advanceWidth)}}var D={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,l),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:kx(o),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,h)};D.ascender=n.ascender,D.descender=n.descender;var j=Cg.make({flags:3,unitsPerEm:n.unitsPerEm,xMin:D.xMin,yMin:D.yMin,xMax:D.xMax,yMax:D.yMax,lowestRecPPEM:3,createdTimestamp:n.createdTimestamp}),_=Mg.make({ascender:D.ascender,descender:D.descender,advanceWidthMax:D.advanceWidthMax,minLeftSideBearing:D.minLeftSideBearing,minRightSideBearing:D.minRightSideBearing,xMaxExtent:D.maxLeftSideBearing+(D.xMax-D.xMin),numberOfHMetrics:n.glyphs.length}),G=Rg.make(n.glyphs.length),Y=td.make(Object.assign({xAvgCharWidth:Math.round(D.advanceWidthAvg),usFirstCharIndex:p,usLastCharIndex:g,ulUnicodeRange1:b,ulUnicodeRange2:C,ulUnicodeRange3:w,ulUnicodeRange4:x,sTypoAscender:D.ascender,sTypoDescender:D.descender,sTypoLineGap:0,usWinAscent:D.yMax,usWinDescent:Math.abs(D.yMin),ulCodePageRange1:1,sxHeight:fm(n,"xyvw",{yMax:Math.round(D.ascender/2)}).yMax,sCapHeight:fm(n,"HIKLEFJMNTZBDPRAGOQSUVWXY",D).yMax,usDefaultChar:n.hasChar(" ")?32:0,usBreakChar:n.hasChar(" ")?32:0},n.tables.os2)),J=Ng.make(n.glyphs),ae=hg.make(n.glyphs),re=n.getEnglishName("fontFamily"),O=n.getEnglishName("fontSubfamily"),W=re+" "+O,K=n.getEnglishName("postScriptName");K||(K=re.replace(/\s/g,"")+"-"+O);var Z={};for(var ee in n.names)Z[ee]=n.names[ee];Z.uniqueID||(Z.uniqueID={en:n.getEnglishName("manufacturer")+":"+W}),Z.postScriptName||(Z.postScriptName={en:K}),Z.preferredFamily||(Z.preferredFamily=n.names.fontFamily),Z.preferredSubfamily||(Z.preferredSubfamily=n.names.fontSubfamily);var V=[],te=Lg.make(Z,V),ce=V.length>0?kg.make(V):void 0,xe=Ug.make(),$=Tg.make(n.glyphs,{version:n.getEnglishName("version"),fullName:W,familyName:re,weightName:O,postScriptName:K,unitsPerEm:n.unitsPerEm,fontBBox:[0,D.yMin,D.ascender,D.advanceWidthMax]}),Q=n.metas&&Object.keys(n.metas).length>0?Bg.make(n.metas):void 0,ve=[j,_,G,Y,te,ae,xe,$,J];ce&&ve.push(ce),n.tables.gsub&&ve.push(jg.make(n.tables.gsub)),Q&&ve.push(Q);for(var Re=Fg(ve),Ue=Re.encode(),we=md(Ue),Me=Re.fields,ze=!1,Xe=0;Xe<Me.length;Xe+=1)if(Me[Xe].name==="head table"){Me[Xe].value.checkSumAdjustment=2981146554-we,ze=!0;break}if(!ze)throw new Error("Could not find head table with checkSum to adjust.");return Re}var Dx={make:Fg,fontToTable:Rx,computeCheckSum:md};function Uf(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l].tag;if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function dm(n,e){for(var a=0,s=n.length-1;a<=s;){var l=a+s>>>1,o=n[l];if(o===e)return l;o<e?a=l+1:s=l-1}return-a-1}function pm(n,e){for(var a,s=0,l=n.length-1;s<=l;){var o=s+l>>>1;a=n[o];var u=a.start;if(u===e)return a;u<e?s=o+1:l=o-1}if(s>0)return a=n[s-1],e>a.end?0:a}function ho(n,e){this.font=n,this.tableName=e}ho.prototype={searchTag:Uf,binSearch:dm,getTable:function(n){var e=this.font.tables[this.tableName];return!e&&n&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var n=this.getTable();return n?n.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var n=this.getTable();if(n){for(var e=!1,a=0;a<n.scripts.length;a++){var s=n.scripts[a].tag;if(s==="DFLT")return s;s==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(n,e){var a=this.getTable(e);if(a){n=n||"DFLT";var s=a.scripts,l=Uf(a.scripts,n);if(l>=0)return s[l].script;if(e){var o={tag:n,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return s.splice(-1-l,0,o),o.script}}},getLangSysTable:function(n,e,a){var s=this.getScriptTable(n,a);if(s){if(!e||e==="dflt"||e==="DFLT")return s.defaultLangSys;var l=Uf(s.langSysRecords,e);if(l>=0)return s.langSysRecords[l].langSys;if(a){var o={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return s.langSysRecords.splice(-1-l,0,o),o.langSys}}},getFeatureTable:function(n,e,a,s){var l=this.getLangSysTable(n,e,s);if(l){for(var o,u=l.featureIndexes,h=this.font.tables[this.tableName].features,p=0;p<u.length;p++)if(o=h[u[p]],o.tag===a)return o.feature;if(s){var g=h.length;return at.assert(g===0||a>=h[g-1].tag,"Features must be added in alphabetical order."),o={tag:a,feature:{params:0,lookupListIndexes:[]}},h.push(o),u.push(g),o.feature}}},getLookupTables:function(n,e,a,s,l){var o=this.getFeatureTable(n,e,a,l),u=[];if(o){for(var h,p=o.lookupListIndexes,g=this.font.tables[this.tableName].lookups,b=0;b<p.length;b++)h=g[p[b]],h.lookupType===s&&u.push(h);if(u.length===0&&l){h={lookupType:s,lookupFlag:0,subtables:[],markFilteringSet:void 0};var C=g.length;return g.push(h),p.push(C),[h]}}return u},getGlyphClass:function(n,e){switch(n.format){case 1:return n.startGlyph<=e&&e<n.startGlyph+n.classes.length?n.classes[e-n.startGlyph]:0;case 2:var a=pm(n.ranges,e);return a?a.classId:0}},getCoverageIndex:function(n,e){switch(n.format){case 1:var a=dm(n.glyphs,e);return a>=0?a:-1;case 2:var s=pm(n.ranges,e);return s?s.index+e-s.start:-1}},expandCoverage:function(n){if(n.format===1)return n.glyphs;for(var e=[],a=n.ranges,s=0;s<a.length;s++)for(var l=a[s],o=l.start,u=l.end,h=o;h<=u;h++)e.push(h);return e}};function mo(n){ho.call(this,n,"gpos")}mo.prototype=ho.prototype;mo.prototype.init=function(){var n=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(n)};mo.prototype.getKerningValue=function(n,e,a){for(var s=0;s<n.length;s++)for(var l=n[s].subtables,o=0;o<l.length;o++){var u=l[o],h=this.getCoverageIndex(u.coverage,e);if(!(h<0))switch(u.posFormat){case 1:for(var p=u.pairSets[h],g=0;g<p.length;g++){var b=p[g];if(b.secondGlyph===a)return b.value1&&b.value1.xAdvance||0}break;case 2:var C=this.getGlyphClass(u.classDef1,e),w=this.getGlyphClass(u.classDef2,a),x=u.classRecords[C][w];return x.value1&&x.value1.xAdvance||0}}return 0};mo.prototype.getKerningTables=function(n,e){if(this.font.tables.gpos)return this.getLookupTables(n,e,"kern",2)};function La(n){ho.call(this,n,"gsub")}function _x(n,e){var a=n.length;if(a!==e.length)return!1;for(var s=0;s<a;s++)if(n[s]!==e[s])return!1;return!0}function gd(n,e,a){for(var s=n.subtables,l=0;l<s.length;l++){var o=s[l];if(o.substFormat===e)return o}if(a)return s.push(a),a}La.prototype=ho.prototype;La.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};La.prototype.getSingle=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,1),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++){var p=u[h],g=this.expandCoverage(p.coverage),b=void 0;if(p.substFormat===1){var C=p.deltaGlyphId;for(b=0;b<g.length;b++){var w=g[b];s.push({sub:w,by:w+C})}}else{var x=p.substitute;for(b=0;b<g.length;b++)s.push({sub:g[b],by:x[b]})}}return s};La.prototype.getMultiple=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,2),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++){var p=u[h],g=this.expandCoverage(p.coverage),b=void 0;for(b=0;b<g.length;b++){var C=g[b],w=p.sequences[b];s.push({sub:C,by:w})}}return s};La.prototype.getAlternates=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,3),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++)for(var p=u[h],g=this.expandCoverage(p.coverage),b=p.alternateSets,C=0;C<g.length;C++)s.push({sub:g[C],by:b[C]});return s};La.prototype.getLigatures=function(n,e,a){for(var s=[],l=this.getLookupTables(e,a,n,4),o=0;o<l.length;o++)for(var u=l[o].subtables,h=0;h<u.length;h++)for(var p=u[h],g=this.expandCoverage(p.coverage),b=p.ligatureSets,C=0;C<g.length;C++)for(var w=g[C],x=b[C],M=0;M<x.length;M++){var R=x[M];s.push({sub:[w].concat(R.components),by:R.ligGlyph})}return s};La.prototype.addSingle=function(n,e,a,s){var l=this.getLookupTables(a,s,n,1,!0)[0],o=gd(l,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});at.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.substitute.splice(h,0,0)),o.substitute[h]=e.by};La.prototype.addMultiple=function(n,e,a,s){at.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var l=this.getLookupTables(a,s,n,2,!0)[0],o=gd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});at.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.sequences.splice(h,0,0)),o.sequences[h]=e.by};La.prototype.addAlternate=function(n,e,a,s){var l=this.getLookupTables(a,s,n,3,!0)[0],o=gd(l,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});at.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var u=e.sub,h=this.binSearch(o.coverage.glyphs,u);h<0&&(h=-1-h,o.coverage.glyphs.splice(h,0,u),o.alternateSets.splice(h,0,0)),o.alternateSets[h]=e.by};La.prototype.addLigature=function(n,e,a,s){var l=this.getLookupTables(a,s,n,4,!0)[0],o=l.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},l.subtables[0]=o),at.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var u=e.sub[0],h=e.sub.slice(1),p={ligGlyph:e.by,components:h},g=this.binSearch(o.coverage.glyphs,u);if(g>=0){for(var b=o.ligatureSets[g],C=0;C<b.length;C++)if(_x(b[C].components,h))return;b.push(p)}else g=-1-g,o.coverage.glyphs.splice(g,0,u),o.ligatureSets.splice(g,0,[p])};La.prototype.getFeature=function(n,e,a){if(/ss\d\d/.test(n))return this.getSingle(n,e,a);switch(n){case"aalt":case"salt":return this.getSingle(n,e,a).concat(this.getAlternates(n,e,a));case"dlig":case"liga":case"rlig":return this.getLigatures(n,e,a);case"ccmp":return this.getMultiple(n,e,a).concat(this.getLigatures(n,e,a));case"stch":return this.getMultiple(n,e,a)}};La.prototype.add=function(n,e,a,s){if(/ss\d\d/.test(n))return this.addSingle(n,e,a,s);switch(n){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(n,e,a,s):this.addAlternate(n,e,a,s);case"dlig":case"liga":case"rlig":return this.addLigature(n,e,a,s);case"ccmp":return e.by instanceof Array?this.addMultiple(n,e,a,s):this.addLigature(n,e,a,s)}};function Ox(){return typeof window<"u"}function Pg(n){for(var e=new ArrayBuffer(n.length),a=new Uint8Array(e),s=0;s<n.length;++s)a[s]=n[s];return e}function Ix(n){for(var e=new Buffer(n.byteLength),a=new Uint8Array(n),s=0;s<e.length;++s)e[s]=a[s];return e}function no(n,e){if(!n)throw e}function hm(n,e,a,s,l){var o;return(e&s)>0?(o=n.parseByte(),(e&l)===0&&(o=-o),o=a+o):(e&l)>0?o=a:o=a+n.parseShort(),o}function zg(n,e,a){var s=new qe.Parser(e,a);n.numberOfContours=s.parseShort(),n._xMin=s.parseShort(),n._yMin=s.parseShort(),n._xMax=s.parseShort(),n._yMax=s.parseShort();var l,o;if(n.numberOfContours>0){for(var u=n.endPointIndices=[],h=0;h<n.numberOfContours;h+=1)u.push(s.parseUShort());n.instructionLength=s.parseUShort(),n.instructions=[];for(var p=0;p<n.instructionLength;p+=1)n.instructions.push(s.parseByte());var g=u[u.length-1]+1;l=[];for(var b=0;b<g;b+=1)if(o=s.parseByte(),l.push(o),(o&8)>0)for(var C=s.parseByte(),w=0;w<C;w+=1)l.push(o),b+=1;if(at.argument(l.length===g,"Bad flags."),u.length>0){var x=[],M;if(g>0){for(var R=0;R<g;R+=1)o=l[R],M={},M.onCurve=!!(o&1),M.lastPointOfContour=u.indexOf(R)>=0,x.push(M);for(var I=0,H=0;H<g;H+=1)o=l[H],M=x[H],M.x=hm(s,o,I,2,16),I=M.x;for(var B=0,D=0;D<g;D+=1)o=l[D],M=x[D],M.y=hm(s,o,B,4,32),B=M.y}n.points=x}else n.points=[]}else if(n.numberOfContours===0)n.points=[];else{n.isComposite=!0,n.points=[],n.components=[];for(var j=!0;j;){l=s.parseUShort();var _={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(l&1)>0?(l&2)>0?(_.dx=s.parseShort(),_.dy=s.parseShort()):_.matchedPoints=[s.parseUShort(),s.parseUShort()]:(l&2)>0?(_.dx=s.parseChar(),_.dy=s.parseChar()):_.matchedPoints=[s.parseByte(),s.parseByte()],(l&8)>0?_.xScale=_.yScale=s.parseF2Dot14():(l&64)>0?(_.xScale=s.parseF2Dot14(),_.yScale=s.parseF2Dot14()):(l&128)>0&&(_.xScale=s.parseF2Dot14(),_.scale01=s.parseF2Dot14(),_.scale10=s.parseF2Dot14(),_.yScale=s.parseF2Dot14()),n.components.push(_),j=!!(l&32)}if(l&256){n.instructionLength=s.parseUShort(),n.instructions=[];for(var G=0;G<n.instructionLength;G+=1)n.instructions.push(s.parseByte())}}}function jf(n,e){for(var a=[],s=0;s<n.length;s+=1){var l=n[s],o={x:e.xScale*l.x+e.scale01*l.y+e.dx,y:e.scale10*l.x+e.yScale*l.y+e.dy,onCurve:l.onCurve,lastPointOfContour:l.lastPointOfContour};a.push(o)}return a}function Lx(n){for(var e=[],a=[],s=0;s<n.length;s+=1){var l=n[s];a.push(l),l.lastPointOfContour&&(e.push(a),a=[])}return at.argument(a.length===0,"There are still points left in the current contour."),e}function Gg(n){var e=new Sn;if(!n)return e;for(var a=Lx(n),s=0;s<a.length;++s){var l=a[s],o=null,u=l[l.length-1],h=l[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(h.onCurve)e.moveTo(h.x,h.y);else{var p={x:(u.x+h.x)*.5,y:(u.y+h.y)*.5};e.moveTo(p.x,p.y)}for(var g=0;g<l.length;++g)if(o=u,u=h,h=l[(g+1)%l.length],u.onCurve)e.lineTo(u.x,u.y);else{var b=h;o.onCurve||((u.x+o.x)*.5,(u.y+o.y)*.5),h.onCurve||(b={x:(u.x+h.x)*.5,y:(u.y+h.y)*.5}),e.quadraticCurveTo(u.x,u.y,b.x,b.y)}e.closePath()}return e}function Hg(n,e){if(e.isComposite)for(var a=0;a<e.components.length;a+=1){var s=e.components[a],l=n.get(s.glyphIndex);if(l.getPath(),l.points){var o=void 0;if(s.matchedPoints===void 0)o=jf(l.points,s);else{if(s.matchedPoints[0]>e.points.length-1||s.matchedPoints[1]>l.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[s.matchedPoints[0]],h=l.points[s.matchedPoints[1]],p={xScale:s.xScale,scale01:s.scale01,scale10:s.scale10,yScale:s.yScale,dx:0,dy:0};h=jf([h],p)[0],p.dx=u.x-h.x,p.dy=u.y-h.y,o=jf(l.points,p)}e.points=e.points.concat(o)}}return Gg(e.points)}function Ux(n,e,a,s){for(var l=new Pr.GlyphSet(s),o=0;o<a.length-1;o+=1){var u=a[o],h=a[o+1];u!==h?l.push(o,Pr.ttfGlyphLoader(s,o,zg,n,e+u,Hg)):l.push(o,Pr.glyphLoader(s,o))}return l}function jx(n,e,a,s){var l=new Pr.GlyphSet(s);return s._push=function(o){var u=a[o],h=a[o+1];u!==h?l.push(o,Pr.ttfGlyphLoader(s,o,zg,n,e+u,Hg)):l.push(o,Pr.glyphLoader(s,o))},l}function Bx(n,e,a,s,l){return l.lowMemory?jx(n,e,a,s):Ux(n,e,a,s)}var Yg={getPath:Gg,parse:Bx},qg,wi,Vg,nd;function Xg(n){this.font=n,this.getCommands=function(e){return Yg.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Fx(n){return n}function $g(n){return Math.sign(n)*Math.round(Math.abs(n))}function Px(n){return Math.sign(n)*Math.round(Math.abs(n*2))/2}function zx(n){return Math.sign(n)*(Math.round(Math.abs(n)+.5)-.5)}function Gx(n){return Math.sign(n)*Math.ceil(Math.abs(n))}function Hx(n){return Math.sign(n)*Math.floor(Math.abs(n))}var Wg=function(n){var e=this.srPeriod,a=this.srPhase,s=this.srThreshold,l=1;return n<0&&(n=-n,l=-1),n+=s-a,n=Math.trunc(n/e)*e,n+=a,n<0?a*l:n*l},Fr={x:1,y:0,axis:"x",distance:function(n,e,a,s){return(a?n.xo:n.x)-(s?e.xo:e.x)},interpolate:function(n,e,a,s){var l,o,u,h,p,g,b;if(!s||s===this){if(l=n.xo-e.xo,o=n.xo-a.xo,p=e.x-e.xo,g=a.x-a.xo,u=Math.abs(l),h=Math.abs(o),b=u+h,b===0){n.x=n.xo+(p+g)/2;return}n.x=n.xo+(p*h+g*u)/b;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),p=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),h=Math.abs(o),b=u+h,b===0){Fr.setRelative(n,n,(p+g)/2,s,!0);return}Fr.setRelative(n,n,(p*h+g*u)/b,s,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(n,e,a,s,l){if(!s||s===this){n.x=(l?e.xo:e.x)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y;n.x=h+(n.y-p)/s.normalSlope},slope:0,touch:function(n){n.xTouched=!0},touched:function(n){return n.xTouched},untouch:function(n){n.xTouched=!1}},cs={x:0,y:1,axis:"y",distance:function(n,e,a,s){return(a?n.yo:n.y)-(s?e.yo:e.y)},interpolate:function(n,e,a,s){var l,o,u,h,p,g,b;if(!s||s===this){if(l=n.yo-e.yo,o=n.yo-a.yo,p=e.y-e.yo,g=a.y-a.yo,u=Math.abs(l),h=Math.abs(o),b=u+h,b===0){n.y=n.yo+(p+g)/2;return}n.y=n.yo+(p*h+g*u)/b;return}if(l=s.distance(n,e,!0,!0),o=s.distance(n,a,!0,!0),p=s.distance(e,e,!1,!0),g=s.distance(a,a,!1,!0),u=Math.abs(l),h=Math.abs(o),b=u+h,b===0){cs.setRelative(n,n,(p+g)/2,s,!0);return}cs.setRelative(n,n,(p*h+g*u)/b,s,!0)},normalSlope:0,setRelative:function(n,e,a,s,l){if(!s||s===this){n.y=(l?e.yo:e.y)+a;return}var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y;n.y=p+s.normalSlope*(n.x-h)},slope:Number.POSITIVE_INFINITY,touch:function(n){n.yTouched=!0},touched:function(n){return n.yTouched},untouch:function(n){n.yTouched=!1}};Object.freeze(Fr);Object.freeze(cs);function go(n,e){this.x=n,this.y=e,this.axis=void 0,this.slope=e/n,this.normalSlope=-n/e,Object.freeze(this)}go.prototype.distance=function(n,e,a,s){return this.x*Fr.distance(n,e,a,s)+this.y*cs.distance(n,e,a,s)};go.prototype.interpolate=function(n,e,a,s){var l,o,u,h,p,g,b;if(u=s.distance(n,e,!0,!0),h=s.distance(n,a,!0,!0),l=s.distance(e,e,!1,!0),o=s.distance(a,a,!1,!0),p=Math.abs(u),g=Math.abs(h),b=p+g,b===0){this.setRelative(n,n,(l+o)/2,s,!0);return}this.setRelative(n,n,(l*g+o*p)/b,s,!0)};go.prototype.setRelative=function(n,e,a,s,l){s=s||this;var o=l?e.xo:e.x,u=l?e.yo:e.y,h=o+a*s.x,p=u+a*s.y,g=s.normalSlope,b=this.slope,C=n.x,w=n.y;n.x=(b*C-g*h+p-w)/(b-g),n.y=b*(n.x-C)+w};go.prototype.touch=function(n){n.xTouched=!0,n.yTouched=!0};function yo(n,e){var a=Math.sqrt(n*n+e*e);return n/=a,e/=a,n===1&&e===0?Fr:n===0&&e===1?cs:new go(n,e)}function us(n,e,a,s){this.x=this.xo=Math.round(n*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=a,this.onCurve=s,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}us.prototype.nextTouched=function(n){for(var e=this.nextPointOnContour;!n.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};us.prototype.prevTouched=function(n){for(var e=this.prevPointOnContour;!n.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var fo=Object.freeze(new us(0,0)),Yx={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function $s(n,e){switch(this.env=n,this.stack=[],this.prog=e,n){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Fr,this.round=$g}}Xg.prototype.exec=function(n,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var a=this.font,s=this._prepState;if(!s||s.ppem!==e){var l=this._fpgmState;if(!l){$s.prototype=Yx,l=this._fpgmState=new $s("fpgm",a.tables.fpgm),l.funcs=[],l.font=a,exports.DEBUG&&(console.log("---EXEC FPGM---"),l.step=-1);try{wi(l)}catch(g){console.log("Hinting error in FPGM:"+g),this._errorState=3;return}}$s.prototype=l,s=this._prepState=new $s("prep",a.tables.prep),s.ppem=e;var o=a.tables.cvt;if(o)for(var u=s.cvt=new Array(o.length),h=e/a.unitsPerEm,p=0;p<o.length;p++)u[p]=o[p]*h;else s.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),s.step=-1);try{wi(s)}catch(g){this._errorState<2&&console.log("Hinting error in PREP:"+g),this._errorState=2}}if(!(this._errorState>1))try{return Vg(n,s)}catch(g){this._errorState<1&&(console.log("Hinting error:"+g),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Vg=function(n,e){var a=e.ppem/e.font.unitsPerEm,s=a,l=n.components,o,u,h;if($s.prototype=e,!l)h=new $s("glyf",n.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),h.step=-1),nd(n,h,a,s),u=h.gZone;else{var p=e.font;u=[],o=[];for(var g=0;g<l.length;g++){var b=l[g],C=p.glyphs.get(b.glyphIndex);h=new $s("glyf",C.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+g+"---"),h.step=-1),nd(C,h,a,s);for(var w=Math.round(b.dx*a),x=Math.round(b.dy*s),M=h.gZone,R=h.contours,I=0;I<M.length;I++){var H=M[I];H.xTouched=H.yTouched=!1,H.xo=H.x=H.x+w,H.yo=H.y=H.y+x}var B=u.length;u.push.apply(u,M);for(var D=0;D<R.length;D++)o.push(R[D]+B)}n.instructions&&!h.inhibitGridFit&&(h=new $s("glyf",n.instructions),h.gZone=h.z0=h.z1=h.z2=u,h.contours=o,u.push(new us(0,0),new us(Math.round(n.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),h.step=-1),wi(h),u.length-=2)}return u};nd=function(n,e,a,s){for(var l=n.points||[],o=l.length,u=e.gZone=e.z0=e.z1=e.z2=[],h=e.contours=[],p,g=0;g<o;g++)p=l[g],u[g]=new us(p.x*a,p.y*s,p.lastPointOfContour,p.onCurve);for(var b,C,w=0;w<o;w++)p=u[w],b||(b=p,h.push(w)),p.lastPointOfContour?(p.nextPointOnContour=b,b.prevPointOnContour=p,b=void 0):(C=u[w+1],p.nextPointOnContour=C,C.prevPointOnContour=p);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var x=0;x<o;x++)console.log(x,u[x].x,u[x].y)}if(u.push(new us(0,0),new us(Math.round(n.advanceWidth*a),0)),wi(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var M=0;M<o;M++)console.log(M,u[M].x,u[M].y)}}};wi=function(n){var e=n.prog;if(e){var a=e.length,s;for(n.ip=0;n.ip<a;n.ip++){if(exports.DEBUG&&n.step++,s=qg[e[n.ip]],!s)throw new Error("unknown instruction: 0x"+Number(e[n.ip]).toString(16));s(n)}}};function Lc(n){for(var e=n.tZone=new Array(n.gZone.length),a=0;a<e.length;a++)e[a]=new us(0,0)}function Zg(n,e){var a=n.prog,s=n.ip,l=1,o;do if(o=a[++s],o===88)l++;else if(o===89)l--;else if(o===64)s+=a[s+1]+1;else if(o===65)s+=2*a[s+1]+1;else if(o>=176&&o<=183)s+=o-176+1;else if(o>=184&&o<=191)s+=(o-184+1)*2;else if(e&&l===1&&o===27)break;while(l>0);n.ip=s}function mm(n,e){exports.DEBUG&&console.log(e.step,"SVTCA["+n.axis+"]"),e.fv=e.pv=e.dpv=n}function gm(n,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+n.axis+"]"),e.pv=e.dpv=n}function ym(n,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+n.axis+"]"),e.fv=n}function vm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SPVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.pv=e.dpv=yo(h,p)}function bm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log("SFVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.fv=yo(h,p)}function qx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.pv=n.dpv=yo(s,a)}function Vx(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SPVFS[]",a,s),n.fv=yo(s,a)}function Xx(n){var e=n.stack,a=n.pv;exports.DEBUG&&console.log(n.step,"GPV[]"),e.push(a.x*16384),e.push(a.y*16384)}function $x(n){var e=n.stack,a=n.fv;exports.DEBUG&&console.log(n.step,"GFV[]"),e.push(a.x*16384),e.push(a.y*16384)}function Wx(n){n.fv=n.pv,exports.DEBUG&&console.log(n.step,"SFVTPV[]")}function Zx(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop(),o=e.pop(),u=e.pop(),h=n.z0,p=n.z1,g=h[a],b=h[s],C=p[l],w=p[o],x=n.z2[u];exports.DEBUG&&console.log("ISECT[], ",a,s,l,o,u);var M=g.x,R=g.y,I=b.x,H=b.y,B=C.x,D=C.y,j=w.x,_=w.y,G=(M-I)*(D-_)-(R-H)*(B-j),Y=M*H-R*I,J=B*_-D*j;x.x=(Y*(B-j)-J*(M-I))/G,x.y=(Y*(D-_)-J*(R-H))/G}function Qx(n){n.rp0=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP0[]",n.rp0)}function Kx(n){n.rp1=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP1[]",n.rp1)}function Jx(n){n.rp2=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SRP2[]",n.rp2)}function eS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP0[]",e),n.zp0=e,e){case 0:n.tZone||Lc(n),n.z0=n.tZone;break;case 1:n.z0=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function tS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP1[]",e),n.zp1=e,e){case 0:n.tZone||Lc(n),n.z1=n.tZone;break;case 1:n.z1=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function nS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZP2[]",e),n.zp2=e,e){case 0:n.tZone||Lc(n),n.z2=n.tZone;break;case 1:n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function aS(n){var e=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"SZPS[]",e),n.zp0=n.zp1=n.zp2=e,e){case 0:n.tZone||Lc(n),n.z0=n.z1=n.z2=n.tZone;break;case 1:n.z0=n.z1=n.z2=n.gZone;break;default:throw new Error("Invalid zone pointer")}}function rS(n){n.loop=n.stack.pop(),exports.DEBUG&&console.log(n.step,"SLOOP[]",n.loop)}function sS(n){exports.DEBUG&&console.log(n.step,"RTG[]"),n.round=$g}function iS(n){exports.DEBUG&&console.log(n.step,"RTHG[]"),n.round=zx}function lS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SMD[]",e),n.minDis=e/64}function oS(n){exports.DEBUG&&console.log(n.step,"ELSE[]"),Zg(n,!1)}function cS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"JMPR[]",e),n.ip+=e-1}function uS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCVTCI[]",e),n.cvCutIn=e/64}function fS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DUP[]"),e.push(e[e.length-1])}function Bf(n){exports.DEBUG&&console.log(n.step,"POP[]"),n.stack.pop()}function dS(n){exports.DEBUG&&console.log(n.step,"CLEAR[]"),n.stack.length=0}function pS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SWAP[]"),e.push(a),e.push(s)}function hS(n){var e=n.stack;exports.DEBUG&&console.log(n.step,"DEPTH[]"),e.push(e.length)}function mS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LOOPCALL[]",a,s);var l=n.ip,o=n.prog;n.prog=n.funcs[a];for(var u=0;u<s;u++)wi(n),exports.DEBUG&&console.log(++n.step,u+1<s?"next loopcall":"done loopcall",u);n.ip=l,n.prog=o}function gS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"CALL[]",e);var a=n.ip,s=n.prog;n.prog=n.funcs[e],wi(n),n.ip=a,n.prog=s,exports.DEBUG&&console.log(++n.step,"returning from",e)}function yS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CINDEX[]",a),e.push(e[e.length-a])}function vS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"MINDEX[]",a),e.push(e.splice(e.length-a,1)[0])}function bS(n){if(n.env!=="fpgm")throw new Error("FDEF not allowed here");var e=n.stack,a=n.prog,s=n.ip,l=e.pop(),o=s;for(exports.DEBUG&&console.log(n.step,"FDEF[]",l);a[++s]!==45;);n.ip=s,n.funcs[l]=a.slice(o+1,s)}function xm(n,e){var a=e.stack.pop(),s=e.z0[a],l=e.fv,o=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+n+"]",a);var u=o.distance(s,fo);n&&(u=e.round(u)),l.setRelative(s,fo,u,o),l.touch(s),e.rp0=e.rp1=a}function Sm(n,e){var a=e.z2,s=a.length-2,l,o,u;exports.DEBUG&&console.log(e.step,"IUP["+n.axis+"]");for(var h=0;h<s;h++)l=a[h],!n.touched(l)&&(o=l.prevTouched(n),o!==l&&(u=l.nextTouched(n),o===u&&n.setRelative(l,l,n.distance(o,o,!1,!0),n,!0),n.interpolate(l,o,u,n)))}function wm(n,e){for(var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=e.loop,p=e.z2;h--;){var g=a.pop(),b=p[g],C=u.distance(l,l,!1,!0);o.setRelative(b,b,C,u),o.touch(b),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-h)+": ":"")+"SHP["+(n?"rp1":"rp2")+"]",g)}e.loop=1}function Em(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=a.pop(),p=e.z2[e.contours[h]],g=p;exports.DEBUG&&console.log(e.step,"SHC["+n+"]",h);var b=u.distance(l,l,!1,!0);do g!==l&&o.setRelative(g,g,b,u),g=g.nextPointOnContour;while(g!==p)}function Am(n,e){var a=e.stack,s=n?e.rp1:e.rp2,l=(n?e.z0:e.z1)[s],o=e.fv,u=e.pv,h=a.pop();exports.DEBUG&&console.log(e.step,"SHZ["+n+"]",h);var p;switch(h){case 0:p=e.tZone;break;case 1:p=e.gZone;break;default:throw new Error("Invalid zone")}for(var g,b=u.distance(l,l,!1,!0),C=p.length-2,w=0;w<C;w++)g=p[w],o.setRelative(g,g,b,u)}function xS(n){for(var e=n.stack,a=n.loop,s=n.fv,l=e.pop()/64,o=n.z2;a--;){var u=e.pop(),h=o[u];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-a)+": ":"")+"SHPIX[]",u,l),s.setRelative(h,h,l),s.touch(h)}n.loop=1}function SS(n){for(var e=n.stack,a=n.rp1,s=n.rp2,l=n.loop,o=n.z0[a],u=n.z1[s],h=n.fv,p=n.dpv,g=n.z2;l--;){var b=e.pop(),C=g[b];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"IP[]",b,a,"<->",s),h.interpolate(C,o,u,p),h.touch(C)}n.loop=1}function Tm(n,e){var a=e.stack,s=a.pop()/64,l=a.pop(),o=e.z1[l],u=e.z0[e.rp0],h=e.fv,p=e.pv;h.setRelative(o,u,s,p),h.touch(o),exports.DEBUG&&console.log(e.step,"MSIRP["+n+"]",s,l),e.rp1=e.rp0,e.rp2=l,n&&(e.rp0=l)}function wS(n){for(var e=n.stack,a=n.rp0,s=n.z0[a],l=n.loop,o=n.fv,u=n.pv,h=n.z1;l--;){var p=e.pop(),g=h[p];exports.DEBUG&&console.log(n.step,(n.loop>1?"loop "+(n.loop-l)+": ":"")+"ALIGNRP[]",p),o.setRelative(g,s,0,u),o.touch(g)}n.loop=1}function ES(n){exports.DEBUG&&console.log(n.step,"RTDG[]"),n.round=Px}function Cm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z0[l],u=e.fv,h=e.pv,p=e.cvt[s];exports.DEBUG&&console.log(e.step,"MIAP["+n+"]",s,"(",p,")",l);var g=h.distance(o,fo);n&&(Math.abs(g-p)<e.cvCutIn&&(g=p),g=e.round(g)),u.setRelative(o,fo,g,h),e.zp0===0&&(o.xo=o.x,o.yo=o.y),u.touch(o),e.rp0=e.rp1=l}function AS(n){var e=n.prog,a=n.ip,s=n.stack,l=e[++a];exports.DEBUG&&console.log(n.step,"NPUSHB[]",l);for(var o=0;o<l;o++)s.push(e[++a]);n.ip=a}function TS(n){var e=n.ip,a=n.prog,s=n.stack,l=a[++e];exports.DEBUG&&console.log(n.step,"NPUSHW[]",l);for(var o=0;o<l;o++){var u=a[++e]<<8|a[++e];u&32768&&(u=-((u^65535)+1)),s.push(u)}n.ip=e}function CS(n){var e=n.stack,a=n.store;a||(a=n.store=[]);var s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"WS",s,l),a[l]=s}function MS(n){var e=n.stack,a=n.store,s=e.pop();exports.DEBUG&&console.log(n.step,"RS",s);var l=a&&a[s]||0;e.push(l)}function NS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTP",a,s),n.cvt[s]=a/64}function kS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"RCVT",a),e.push(n.cvt[a]*64)}function Mm(n,e){var a=e.stack,s=a.pop(),l=e.z2[s];exports.DEBUG&&console.log(e.step,"GC["+n+"]",s),a.push(e.dpv.distance(l,fo,n,!1)*64)}function Nm(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z1[s],u=e.z0[l],h=e.dpv.distance(u,o,n,n);exports.DEBUG&&console.log(e.step,"MD["+n+"]",s,l,"->",h),e.stack.push(Math.round(h*64))}function RS(n){exports.DEBUG&&console.log(n.step,"MPPEM[]"),n.stack.push(n.ppem)}function DS(n){exports.DEBUG&&console.log(n.step,"FLIPON[]"),n.autoFlip=!0}function _S(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LT[]",a,s),e.push(s<a?1:0)}function OS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"LTEQ[]",a,s),e.push(s<=a?1:0)}function IS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GT[]",a,s),e.push(s>a?1:0)}function LS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"GTEQ[]",a,s),e.push(s>=a?1:0)}function US(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"EQ[]",a,s),e.push(a===s?1:0)}function jS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"NEQ[]",a,s),e.push(a!==s?1:0)}function BS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ODD[]",a),e.push(Math.trunc(a)%2?1:0)}function FS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"EVEN[]",a),e.push(Math.trunc(a)%2?0:1)}function PS(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"IF[]",e),e||(Zg(n,!0),exports.DEBUG&&console.log(n.step,"EIF[]"))}function zS(n){exports.DEBUG&&console.log(n.step,"EIF[]")}function GS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"AND[]",a,s),e.push(a&&s?1:0)}function HS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"OR[]",a,s),e.push(a||s?1:0)}function YS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NOT[]",a),e.push(a?0:1)}function Ff(n,e){var a=e.stack,s=a.pop(),l=e.fv,o=e.pv,u=e.ppem,h=e.deltaBase+(n-1)*16,p=e.deltaShift,g=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+n+"]",s,a);for(var b=0;b<s;b++){var C=a.pop(),w=a.pop(),x=h+((w&240)>>4);if(x===u){var M=(w&15)-8;M>=0&&M++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",C,"by",M*p);var R=g[C];l.setRelative(R,R,M*p,o)}}}function qS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDB[]",a),n.deltaBase=a}function VS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"SDS[]",a),n.deltaShift=Math.pow(.5,a)}function XS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"ADD[]",a,s),e.push(s+a)}function $S(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"SUB[]",a,s),e.push(s-a)}function WS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"DIV[]",a,s),e.push(s*64/a)}function ZS(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MUL[]",a,s),e.push(s*a/64)}function QS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"ABS[]",a),e.push(Math.abs(a))}function KS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"NEG[]",a),e.push(-a)}function JS(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"FLOOR[]",a),e.push(Math.floor(a/64)*64)}function e2(n){var e=n.stack,a=e.pop();exports.DEBUG&&console.log(n.step,"CEILING[]",a),e.push(Math.ceil(a/64)*64)}function wc(n,e){var a=e.stack,s=a.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),a.push(e.round(s/64)*64)}function t2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"WCVTF[]",a,s),n.cvt[s]=a*n.ppem/n.font.unitsPerEm}function Pf(n,e){var a=e.stack,s=a.pop(),l=e.ppem,o=e.deltaBase+(n-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+n+"]",s,a);for(var h=0;h<s;h++){var p=a.pop(),g=a.pop(),b=o+((g&240)>>4);if(b===l){var C=(g&15)-8;C>=0&&C++;var w=C*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",p,"by",w),e.cvt[p]+=w}}}function n2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SROUND[]",e),n.round=Wg;var a;switch(e&192){case 0:a=.5;break;case 64:a=1;break;case 128:a=2;break;default:throw new Error("invalid SROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function a2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"S45ROUND[]",e),n.round=Wg;var a;switch(e&192){case 0:a=Math.sqrt(2)/2;break;case 64:a=Math.sqrt(2);break;case 128:a=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(n.srPeriod=a,e&48){case 0:n.srPhase=0;break;case 16:n.srPhase=.25*a;break;case 32:n.srPhase=.5*a;break;case 48:n.srPhase=.75*a;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?n.srThreshold=0:n.srThreshold=(e/8-.5)*a}function r2(n){exports.DEBUG&&console.log(n.step,"ROFF[]"),n.round=Fx}function s2(n){exports.DEBUG&&console.log(n.step,"RUTG[]"),n.round=Gx}function i2(n){exports.DEBUG&&console.log(n.step,"RDTG[]"),n.round=Hx}function l2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANCTRL[]",e)}function km(n,e){var a=e.stack,s=a.pop(),l=a.pop(),o=e.z2[s],u=e.z1[l];exports.DEBUG&&console.log(e.step,"SDPVTL["+n+"]",s,l);var h,p;n?(h=o.y-u.y,p=u.x-o.x):(h=u.x-o.x,p=u.y-o.y),e.dpv=yo(h,p)}function o2(n){var e=n.stack,a=e.pop(),s=0;exports.DEBUG&&console.log(n.step,"GETINFO[]",a),a&1&&(s=35),a&32&&(s|=4096),e.push(s)}function c2(n){var e=n.stack,a=e.pop(),s=e.pop(),l=e.pop();exports.DEBUG&&console.log(n.step,"ROLL[]"),e.push(s),e.push(a),e.push(l)}function u2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MAX[]",a,s),e.push(Math.max(s,a))}function f2(n){var e=n.stack,a=e.pop(),s=e.pop();exports.DEBUG&&console.log(n.step,"MIN[]",a,s),e.push(Math.min(s,a))}function d2(n){var e=n.stack.pop();exports.DEBUG&&console.log(n.step,"SCANTYPE[]",e)}function p2(n){var e=n.stack.pop(),a=n.stack.pop();switch(exports.DEBUG&&console.log(n.step,"INSTCTRL[]",e,a),e){case 1:n.inhibitGridFit=!!a;return;case 2:n.ignoreCvt=!!a;return;default:throw new Error("invalid INSTCTRL[] selector")}}function qs(n,e){var a=e.stack,s=e.prog,l=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+n+"]");for(var o=0;o<n;o++)a.push(s[++l]);e.ip=l}function Vs(n,e){var a=e.ip,s=e.prog,l=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+n+"]");for(var o=0;o<n;o++){var u=s[++a]<<8|s[++a];u&32768&&(u=-((u^65535)+1)),l.push(u)}e.ip=a}function Ye(n,e,a,s,l,o){var u=o.stack,h=n&&u.pop(),p=u.pop(),g=o.rp0,b=o.z0[g],C=o.z1[p],w=o.minDis,x=o.fv,M=o.dpv,R,I,H,B;I=R=M.distance(C,b,!0,!0),H=I>=0?1:-1,I=Math.abs(I),n&&(B=o.cvt[h],s&&Math.abs(I-B)<o.cvCutIn&&(I=B)),a&&I<w&&(I=w),s&&(I=o.round(I)),x.setRelative(C,b,H*I,M),x.touch(C),exports.DEBUG&&console.log(o.step,(n?"MIRP[":"MDRP[")+(e?"M":"m")+(a?">":"_")+(s?"R":"_")+(l===0?"Gr":l===1?"Bl":l===2?"Wh":"")+"]",n?h+"("+o.cvt[h]+","+B+")":"",p,"(d =",R,"->",H*I,")"),o.rp1=o.rp0,o.rp2=p,e&&(o.rp0=p)}qg=[mm.bind(void 0,cs),mm.bind(void 0,Fr),gm.bind(void 0,cs),gm.bind(void 0,Fr),ym.bind(void 0,cs),ym.bind(void 0,Fr),vm.bind(void 0,0),vm.bind(void 0,1),bm.bind(void 0,0),bm.bind(void 0,1),qx,Vx,Xx,$x,Wx,Zx,Qx,Kx,Jx,eS,tS,nS,aS,rS,sS,iS,lS,oS,cS,uS,void 0,void 0,fS,Bf,dS,pS,hS,yS,vS,void 0,void 0,void 0,mS,gS,bS,void 0,xm.bind(void 0,0),xm.bind(void 0,1),Sm.bind(void 0,cs),Sm.bind(void 0,Fr),wm.bind(void 0,0),wm.bind(void 0,1),Em.bind(void 0,0),Em.bind(void 0,1),Am.bind(void 0,0),Am.bind(void 0,1),xS,SS,Tm.bind(void 0,0),Tm.bind(void 0,1),wS,ES,Cm.bind(void 0,0),Cm.bind(void 0,1),AS,TS,CS,MS,NS,kS,Mm.bind(void 0,0),Mm.bind(void 0,1),void 0,Nm.bind(void 0,0),Nm.bind(void 0,1),RS,void 0,DS,void 0,void 0,_S,OS,IS,LS,US,jS,BS,FS,PS,zS,GS,HS,YS,Ff.bind(void 0,1),qS,VS,XS,$S,WS,ZS,QS,KS,JS,e2,wc.bind(void 0,0),wc.bind(void 0,1),wc.bind(void 0,2),wc.bind(void 0,3),void 0,void 0,void 0,void 0,t2,Ff.bind(void 0,2),Ff.bind(void 0,3),Pf.bind(void 0,1),Pf.bind(void 0,2),Pf.bind(void 0,3),n2,a2,void 0,void 0,r2,void 0,s2,i2,Bf,Bf,void 0,void 0,void 0,void 0,void 0,l2,km.bind(void 0,0),km.bind(void 0,1),o2,void 0,c2,u2,f2,d2,p2,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,qs.bind(void 0,1),qs.bind(void 0,2),qs.bind(void 0,3),qs.bind(void 0,4),qs.bind(void 0,5),qs.bind(void 0,6),qs.bind(void 0,7),qs.bind(void 0,8),Vs.bind(void 0,1),Vs.bind(void 0,2),Vs.bind(void 0,3),Vs.bind(void 0,4),Vs.bind(void 0,5),Vs.bind(void 0,6),Vs.bind(void 0,7),Vs.bind(void 0,8),Ye.bind(void 0,0,0,0,0,0),Ye.bind(void 0,0,0,0,0,1),Ye.bind(void 0,0,0,0,0,2),Ye.bind(void 0,0,0,0,0,3),Ye.bind(void 0,0,0,0,1,0),Ye.bind(void 0,0,0,0,1,1),Ye.bind(void 0,0,0,0,1,2),Ye.bind(void 0,0,0,0,1,3),Ye.bind(void 0,0,0,1,0,0),Ye.bind(void 0,0,0,1,0,1),Ye.bind(void 0,0,0,1,0,2),Ye.bind(void 0,0,0,1,0,3),Ye.bind(void 0,0,0,1,1,0),Ye.bind(void 0,0,0,1,1,1),Ye.bind(void 0,0,0,1,1,2),Ye.bind(void 0,0,0,1,1,3),Ye.bind(void 0,0,1,0,0,0),Ye.bind(void 0,0,1,0,0,1),Ye.bind(void 0,0,1,0,0,2),Ye.bind(void 0,0,1,0,0,3),Ye.bind(void 0,0,1,0,1,0),Ye.bind(void 0,0,1,0,1,1),Ye.bind(void 0,0,1,0,1,2),Ye.bind(void 0,0,1,0,1,3),Ye.bind(void 0,0,1,1,0,0),Ye.bind(void 0,0,1,1,0,1),Ye.bind(void 0,0,1,1,0,2),Ye.bind(void 0,0,1,1,0,3),Ye.bind(void 0,0,1,1,1,0),Ye.bind(void 0,0,1,1,1,1),Ye.bind(void 0,0,1,1,1,2),Ye.bind(void 0,0,1,1,1,3),Ye.bind(void 0,1,0,0,0,0),Ye.bind(void 0,1,0,0,0,1),Ye.bind(void 0,1,0,0,0,2),Ye.bind(void 0,1,0,0,0,3),Ye.bind(void 0,1,0,0,1,0),Ye.bind(void 0,1,0,0,1,1),Ye.bind(void 0,1,0,0,1,2),Ye.bind(void 0,1,0,0,1,3),Ye.bind(void 0,1,0,1,0,0),Ye.bind(void 0,1,0,1,0,1),Ye.bind(void 0,1,0,1,0,2),Ye.bind(void 0,1,0,1,0,3),Ye.bind(void 0,1,0,1,1,0),Ye.bind(void 0,1,0,1,1,1),Ye.bind(void 0,1,0,1,1,2),Ye.bind(void 0,1,0,1,1,3),Ye.bind(void 0,1,1,0,0,0),Ye.bind(void 0,1,1,0,0,1),Ye.bind(void 0,1,1,0,0,2),Ye.bind(void 0,1,1,0,0,3),Ye.bind(void 0,1,1,0,1,0),Ye.bind(void 0,1,1,0,1,1),Ye.bind(void 0,1,1,0,1,2),Ye.bind(void 0,1,1,0,1,3),Ye.bind(void 0,1,1,1,0,0),Ye.bind(void 0,1,1,1,0,1),Ye.bind(void 0,1,1,1,0,2),Ye.bind(void 0,1,1,1,0,3),Ye.bind(void 0,1,1,1,1,0),Ye.bind(void 0,1,1,1,1,1),Ye.bind(void 0,1,1,1,1,2),Ye.bind(void 0,1,1,1,1,3)];function ul(n){this.char=n,this.state={},this.activeState=null}function yd(n,e,a){this.contextName=a,this.startIndex=n,this.endOffset=e}function h2(n,e,a){this.contextName=n,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=a}function br(n,e){this.context=n,this.index=e,this.length=n.length,this.current=n[e],this.backtrack=n.slice(0,e),this.lookahead=n.slice(e+1)}function Uc(n){this.eventId=n,this.subscribers=[]}function m2(n){var e=this,a=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];a.forEach(function(l){Object.defineProperty(e.events,l,{value:new Uc(l)})}),n&&a.forEach(function(l){var o=n[l];typeof o=="function"&&e.events[l].subscribe(o)});var s=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];s.forEach(function(l){e.events[l].subscribe(e.updateContextsRanges)})}function ln(n){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],m2.call(this,n)}ul.prototype.setState=function(n,e){return this.state[n]=e,this.activeState={key:n,value:this.state[n]},this.activeState};ul.prototype.getState=function(n){return this.state[n]||null};ln.prototype.inboundIndex=function(n){return n>=0&&n<this.tokens.length};ln.prototype.composeRUD=function(n){var e=this,a=!0,s=n.map(function(o){return e[o[0]].apply(e,o.slice(1).concat(a))}),l=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(s.every(l))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:s.filter(l)};this.dispatch("composeRUD",[s.filter(function(o){return!l(o)})])};ln.prototype.replaceRange=function(n,e,a,s){e=e!==null?e:this.tokens.length;var l=a.every(function(u){return u instanceof ul});if(!isNaN(n)&&this.inboundIndex(n)&&l){var o=this.tokens.splice.apply(this.tokens,[n,e].concat(a));return s||this.dispatch("replaceToken",[n,e,a]),[o,a]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};ln.prototype.replaceToken=function(n,e,a){if(!isNaN(n)&&this.inboundIndex(n)&&e instanceof ul){var s=this.tokens.splice(n,1,e);return a||this.dispatch("replaceToken",[n,e]),[s[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};ln.prototype.removeRange=function(n,e,a){e=isNaN(e)?this.tokens.length:e;var s=this.tokens.splice(n,e);return a||this.dispatch("removeRange",[s,n,e]),s};ln.prototype.removeToken=function(n,e){if(!isNaN(n)&&this.inboundIndex(n)){var a=this.tokens.splice(n,1);return e||this.dispatch("removeToken",[a,n]),a}else return{FAIL:"removeToken: invalid token index."}};ln.prototype.insertToken=function(n,e,a){var s=n.every(function(l){return l instanceof ul});return s?(this.tokens.splice.apply(this.tokens,[e,0].concat(n)),a||this.dispatch("insertToken",[n,e]),n):{FAIL:"insertToken: invalid token(s)."}};ln.prototype.registerModifier=function(n,e,a){this.events.newToken.subscribe(function(s,l){var o=[s,l],u=e===null||e.apply(this,o)===!0,h=[s,l];if(u){var p=a.apply(this,h);s.setState(n,p)}}),this.registeredModifiers.push(n)};Uc.prototype.subscribe=function(n){return typeof n=="function"?this.subscribers.push(n)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Uc.prototype.unsubscribe=function(n){this.subscribers.splice(n,1)};br.prototype.setCurrentIndex=function(n){this.index=n,this.current=this.context[n],this.backtrack=this.context.slice(0,n),this.lookahead=this.context.slice(n+1)};br.prototype.get=function(n){switch(!0){case n===0:return this.current;case(n<0&&Math.abs(n)<=this.backtrack.length):return this.backtrack.slice(n)[0];case(n>0&&n<=this.lookahead.length):return this.lookahead[n-1];default:return null}};ln.prototype.rangeToText=function(n){if(n instanceof yd)return this.getRangeTokens(n).map(function(e){return e.char}).join("")};ln.prototype.getText=function(){return this.tokens.map(function(n){return n.char}).join("")};ln.prototype.getContext=function(n){var e=this.registeredContexts[n];return e||null};ln.prototype.on=function(n,e){var a=this.events[n];return a?a.subscribe(e):null};ln.prototype.dispatch=function(n,e){var a=this,s=this.events[n];s instanceof Uc&&s.subscribers.forEach(function(l){l.apply(a,e||[])})};ln.prototype.registerContextChecker=function(n,e,a){if(this.getContext(n))return{FAIL:"context name '"+n+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof a!="function")return{FAIL:"missing context end check."};var s=new h2(n,e,a);return this.registeredContexts[n]=s,this.contextCheckers.push(s),s};ln.prototype.getRangeTokens=function(n){var e=n.startIndex+n.endOffset;return[].concat(this.tokens.slice(n.startIndex,e))};ln.prototype.getContextRanges=function(n){var e=this.getContext(n);return e?e.ranges:{FAIL:"context checker '"+n+"' is not registered."}};ln.prototype.resetContextsRanges=function(){var n=this.registeredContexts;for(var e in n)if(n.hasOwnProperty(e)){var a=n[e];a.ranges=[]}};ln.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var n=this.tokens.map(function(s){return s.char}),e=0;e<n.length;e++){var a=new br(n,e);this.runContextCheck(a)}this.dispatch("updateContextsRanges",[this.registeredContexts])};ln.prototype.setEndOffset=function(n,e){var a=this.getContext(e).openRange.startIndex,s=new yd(a,n,e),l=this.getContext(e).ranges;return s.rangeId=e+"."+l.length,l.push(s),this.getContext(e).openRange=null,s};ln.prototype.runContextCheck=function(n){var e=this,a=n.index;this.contextCheckers.forEach(function(s){var l=s.contextName,o=e.getContext(l).openRange;if(!o&&s.checkStart(n)&&(o=new yd(a,null,l),e.getContext(l).openRange=o,e.dispatch("contextStart",[l,a])),o&&s.checkEnd(n)){var u=a-o.startIndex+1,h=e.setEndOffset(u,l);e.dispatch("contextEnd",[l,h])}})};ln.prototype.tokenize=function(n){this.tokens=[],this.resetContextsRanges();var e=Array.from(n);this.dispatch("start");for(var a=0;a<e.length;a++){var s=e[a],l=new br(e,a);this.dispatch("next",[l]),this.runContextCheck(l);var o=new ul(s);this.tokens.push(o),this.dispatch("newToken",[o,l])}return this.dispatch("end",[this.tokens]),this.tokens};function Ws(n){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(n)}function Qg(n){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(n)}function Zs(n){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(n)}function Cc(n){return/[A-z]/.test(n)}function g2(n){return/\s/.test(n)}function Ua(n){this.font=n,this.features={}}function Si(n){this.id=n.id,this.tag=n.tag,this.substitution=n.substitution}function vo(n,e){if(!n)return-1;switch(e.format){case 1:return e.glyphs.indexOf(n);case 2:for(var a=e.ranges,s=0;s<a.length;s++){var l=a[s];if(n>=l.start&&n<=l.end){var o=n-l.start;return l.index+o}}break;default:return-1}return-1}function y2(n,e){var a=vo(n,e.coverage);return a===-1?null:n+e.deltaGlyphId}function v2(n,e){var a=vo(n,e.coverage);return a===-1?null:e.substitute[a]}function zf(n,e){for(var a=[],s=0;s<n.length;s++){var l=n[s],o=e.current;o=Array.isArray(o)?o[0]:o;var u=vo(o,l);u!==-1&&a.push(u)}return a.length!==n.length?-1:a}function b2(n,e){var a=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(n.context.length<a)return[];var s=zf(e.inputCoverage,n);if(s===-1)return[];var l=e.inputCoverage.length-1;if(n.lookahead.length<e.lookaheadCoverage.length)return[];for(var o=n.lookahead.slice(l);o.length&&Zs(o[0].char);)o.shift();var u=new br(o,0),h=zf(e.lookaheadCoverage,u),p=[].concat(n.backtrack);for(p.reverse();p.length&&Zs(p[0].char);)p.shift();if(p.length<e.backtrackCoverage.length)return[];var g=new br(p,0),b=zf(e.backtrackCoverage,g),C=s.length===e.inputCoverage.length&&h.length===e.lookaheadCoverage.length&&b.length===e.backtrackCoverage.length,w=[];if(C)for(var x=0;x<e.lookupRecords.length;x++)for(var M=e.lookupRecords[x],R=M.lookupListIndex,I=this.getLookupByIndex(R),H=0;H<I.subtables.length;H++){var B=I.subtables[H],D=this.getLookupMethod(I,B),j=this.getSubstitutionType(I,B);if(j==="12")for(var _=0;_<s.length;_++){var G=n.get(_),Y=D(G);Y&&w.push(Y)}}return w}function x2(n,e){var a=n.current,s=vo(a,e.coverage);if(s===-1)return null;for(var l,o=e.ligatureSets[s],u=0;u<o.length;u++){l=o[u];for(var h=0;h<l.components.length;h++){var p=n.lookahead[h],g=l.components[h];if(p!==g)break;if(h===l.components.length-1)return l}}return null}function S2(n,e){var a=vo(n,e.coverage);return a===-1?null:e.sequences[a]}Ua.prototype.getDefaultScriptFeaturesIndexes=function(){for(var n=this.font.tables.gsub.scripts,e=0;e<n.length;e++){var a=n[e];if(a.tag==="DFLT")return a.script.defaultLangSys.featureIndexes}return[]};Ua.prototype.getScriptFeaturesIndexes=function(n){var e=this.font.tables;if(!e.gsub)return[];if(!n)return this.getDefaultScriptFeaturesIndexes();for(var a=this.font.tables.gsub.scripts,s=0;s<a.length;s++){var l=a[s];if(l.tag===n&&l.script.defaultLangSys)return l.script.defaultLangSys.featureIndexes;var o=l.langSysRecords;if(o)for(var u=0;u<o.length;u++){var h=o[u];if(h.tag===n){var p=h.langSys;return p.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};Ua.prototype.mapTagsToFeatures=function(n,e){for(var a={},s=0;s<n.length;s++){var l=n[s].tag,o=n[s].feature;a[l]=o}this.features[e].tags=a};Ua.prototype.getScriptFeatures=function(n){var e=this.features[n];if(this.features.hasOwnProperty(n))return e;var a=this.getScriptFeaturesIndexes(n);if(!a)return null;var s=this.font.tables.gsub;return e=a.map(function(l){return s.features[l]}),this.features[n]=e,this.mapTagsToFeatures(e,n),e};Ua.prototype.getSubstitutionType=function(n,e){var a=n.lookupType.toString(),s=e.substFormat.toString();return a+s};Ua.prototype.getLookupMethod=function(n,e){var a=this,s=this.getSubstitutionType(n,e);switch(s){case"11":return function(l){return y2.apply(a,[l,e])};case"12":return function(l){return v2.apply(a,[l,e])};case"63":return function(l){return b2.apply(a,[l,e])};case"41":return function(l){return x2.apply(a,[l,e])};case"21":return function(l){return S2.apply(a,[l,e])};default:throw new Error("lookupType: "+n.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};Ua.prototype.lookupFeature=function(n){var e=n.contextParams,a=e.index,s=this.getFeature({tag:n.tag,script:n.script});if(!s)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+n.tag+"' for script '"+n.script+"'.");for(var l=this.getFeatureLookups(s),o=[].concat(e.context),u=0;u<l.length;u++)for(var h=l[u],p=this.getLookupSubtables(h),g=0;g<p.length;g++){var b=p[g],C=this.getSubstitutionType(h,b),w=this.getLookupMethod(h,b),x=void 0;switch(C){case"11":x=w(e.current),x&&o.splice(a,1,new Si({id:11,tag:n.tag,substitution:x}));break;case"12":x=w(e.current),x&&o.splice(a,1,new Si({id:12,tag:n.tag,substitution:x}));break;case"63":x=w(e),Array.isArray(x)&&x.length&&o.splice(a,1,new Si({id:63,tag:n.tag,substitution:x}));break;case"41":x=w(e),x&&o.splice(a,1,new Si({id:41,tag:n.tag,substitution:x}));break;case"21":x=w(e.current),x&&o.splice(a,1,new Si({id:21,tag:n.tag,substitution:x}));break}e=new br(o,a),!(Array.isArray(x)&&!x.length)&&(x=null)}return o.length?o:null};Ua.prototype.supports=function(n){if(!n.script)return!1;this.getScriptFeatures(n.script);var e=this.features.hasOwnProperty(n.script);if(!n.tag)return e;var a=this.features[n.script].some(function(s){return s.tag===n.tag});return e&&a};Ua.prototype.getLookupSubtables=function(n){return n.subtables||null};Ua.prototype.getLookupByIndex=function(n){var e=this.font.tables.gsub.lookups;return e[n]||null};Ua.prototype.getFeatureLookups=function(n){return n.lookupListIndexes.map(this.getLookupByIndex.bind(this))};Ua.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var a=this.features[e.script];return a?a.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function w2(n){var e=n.current,a=n.get(-1);return a===null&&Ws(e)||!Ws(a)&&Ws(e)}function E2(n){var e=n.get(1);return e===null||!Ws(e)}var A2={startCheck:w2,endCheck:E2};function T2(n){var e=n.current,a=n.get(-1);return(Ws(e)||Zs(e))&&!Ws(a)}function C2(n){var e=n.get(1);switch(!0){case e===null:return!0;case(!Ws(e)&&!Zs(e)):var a=g2(e);if(!a)return!0;if(a){var s=!1;if(s=n.lookahead.some(function(l){return Ws(l)||Zs(l)}),!s)return!0}break;default:return!1}}var M2={startCheck:T2,endCheck:C2};function N2(n,e,a){e[a].setState(n.tag,n.substitution)}function k2(n,e,a){e[a].setState(n.tag,n.substitution)}function R2(n,e,a){n.substitution.forEach(function(s,l){var o=e[a+l];o.setState(n.tag,s)})}function D2(n,e,a){var s=e[a];s.setState(n.tag,n.substitution.ligGlyph);for(var l=n.substitution.components.length,o=0;o<l;o++)s=e[a+o+1],s.setState("deleted",!0)}var Rm={11:N2,12:k2,63:R2,41:D2};function vd(n,e,a){n instanceof Si&&Rm[n.id]&&Rm[n.id](n,e,a)}function _2(n){for(var e=[].concat(n.backtrack),a=e.length-1;a>=0;a--){var s=e[a],l=Qg(s),o=Zs(s);if(!l&&!o)return!0;if(l)return!1}return!1}function O2(n){if(Qg(n.current))return!1;for(var e=0;e<n.lookahead.length;e++){var a=n.lookahead[e],s=Zs(a);if(!s)return!0}return!1}function I2(n){var e=this,a="arab",s=this.featuresTags[a],l=this.tokenizer.getRangeTokens(n);if(l.length!==1){var o=new br(l.map(function(h){return h.getState("glyphIndex")}),0),u=new br(l.map(function(h){return h.char}),0);l.forEach(function(h,p){if(!Zs(h.char)){o.setCurrentIndex(p),u.setCurrentIndex(p);var g=0;_2(u)&&(g|=1),O2(u)&&(g|=2);var b;switch(g){case 1:b="fina";break;case 2:b="init";break;case 3:b="medi";break}if(s.indexOf(b)!==-1){var C=e.query.lookupFeature({tag:b,script:a,contextParams:o});if(C instanceof Error)return console.info(C.message);C.forEach(function(w,x){w instanceof Si&&(vd(w,l,x),o.context[x]=w.substitution)})}}})}}function Dm(n,e){var a=n.map(function(s){return s.activeState.value});return new br(a,0)}function L2(n){var e=this,a="arab",s=this.tokenizer.getRangeTokens(n),l=Dm(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var h=e.query.lookupFeature({tag:"rlig",script:a,contextParams:l});h.length&&(h.forEach(function(p){return vd(p,s,u)}),l=Dm(s))})}function U2(n){var e=n.current,a=n.get(-1);return a===null&&Cc(e)||!Cc(a)&&Cc(e)}function j2(n){var e=n.get(1);return e===null||!Cc(e)}var B2={startCheck:U2,endCheck:j2};function _m(n,e){var a=n.map(function(s){return s.activeState.value});return new br(a,0)}function F2(n){var e=this,a="latn",s=this.tokenizer.getRangeTokens(n),l=_m(s);l.context.forEach(function(o,u){l.setCurrentIndex(u);var h=e.query.lookupFeature({tag:"liga",script:a,contextParams:l});h.length&&(h.forEach(function(p){return vd(p,s,u)}),l=_m(s))})}function wr(n){this.baseDir=n||"ltr",this.tokenizer=new ln,this.featuresTags={}}wr.prototype.setText=function(n){this.text=n};wr.prototype.contextChecks={latinWordCheck:B2,arabicWordCheck:A2,arabicSentenceCheck:M2};function Gf(n){var e=this.contextChecks[n+"Check"];return this.tokenizer.registerContextChecker(n,e.startCheck,e.endCheck)}function P2(){return Gf.call(this,"latinWord"),Gf.call(this,"arabicWord"),Gf.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function z2(){var n=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(a){var s=n.tokenizer.getRangeTokens(a);n.tokenizer.replaceRange(a.startIndex,a.endOffset,s.reverse())})}wr.prototype.registerFeatures=function(n,e){var a=this,s=e.filter(function(l){return a.query.supports({script:n,tag:l})});this.featuresTags.hasOwnProperty(n)?this.featuresTags[n]=this.featuresTags[n].concat(s):this.featuresTags[n]=s};wr.prototype.applyFeatures=function(n,e){if(!n)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Ua(n));for(var a=0;a<e.length;a++){var s=e[a];this.query.supports({script:s.script})&&this.registerFeatures(s.script,s.tags)}};wr.prototype.registerModifier=function(n,e,a){this.tokenizer.registerModifier(n,e,a)};function bd(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function G2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){bd.call(this);var a=this.tokenizer.getContextRanges("arabicWord");a.forEach(function(s){I2.call(n,s)})}}function H2(){var n=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("rlig")!==-1){bd.call(this);var s=this.tokenizer.getContextRanges("arabicWord");s.forEach(function(l){L2.call(n,l)})}}}function Y2(){var n=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var a=this.featuresTags[e];if(a.indexOf("liga")!==-1){bd.call(this);var s=this.tokenizer.getContextRanges("latinWord");s.forEach(function(l){F2.call(n,l)})}}}wr.prototype.checkContextReady=function(n){return!!this.tokenizer.getContext(n)};wr.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(G2.call(this),H2.call(this)),this.checkContextReady("latinWord")&&Y2.call(this),this.checkContextReady("arabicSentence")&&z2.call(this)};wr.prototype.processText=function(n){(!this.text||this.text!==n)&&(this.setText(n),P2.call(this),this.applyFeaturesToContexts())};wr.prototype.getBidiText=function(n){return this.processText(n),this.tokenizer.getText()};wr.prototype.getTextGlyphs=function(n){this.processText(n);for(var e=[],a=0;a<this.tokenizer.tokens.length;a++){var s=this.tokenizer.tokens[a];if(!s.state.deleted){var l=s.activeState.value;e.push(Array.isArray(l)?l[0]:l)}}return e};function Pt(n){n=n||{},n.tables=n.tables||{},n.empty||(no(n.familyName,"When creating a new Font object, familyName is required."),no(n.styleName,"When creating a new Font object, styleName is required."),no(n.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),no(n.ascender,"When creating a new Font object, ascender is required."),no(n.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:n.familyName||" "},fontSubfamily:{en:n.styleName||" "},fullName:{en:n.fullName||n.familyName+" "+n.styleName},postScriptName:{en:n.postScriptName||(n.familyName+n.styleName).replace(/\s/g,"")},designer:{en:n.designer||" "},designerURL:{en:n.designerURL||" "},manufacturer:{en:n.manufacturer||" "},manufacturerURL:{en:n.manufacturerURL||" "},license:{en:n.license||" "},licenseURL:{en:n.licenseURL||" "},version:{en:n.version||"Version 0.1"},description:{en:n.description||" "},copyright:{en:n.copyright||" "},trademark:{en:n.trademark||" "}},this.unitsPerEm=n.unitsPerEm||1e3,this.ascender=n.ascender,this.descender=n.descender,this.createdTimestamp=n.createdTimestamp,this.tables=Object.assign(n.tables,{os2:Object.assign({usWeightClass:n.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:n.widthClass||this.usWidthClasses.MEDIUM,fsSelection:n.fsSelection||this.fsSelectionValues.REGULAR},n.tables.os2)})),this.supported=!0,this.glyphs=new Pr.GlyphSet(this,n.glyphs||[]),this.encoding=new mg(this),this.position=new mo(this),this.substitution=new La(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Xg(this)}})}Pt.prototype.hasChar=function(n){return this.encoding.charToGlyphIndex(n)!==null};Pt.prototype.charToGlyphIndex=function(n){return this.encoding.charToGlyphIndex(n)};Pt.prototype.charToGlyph=function(n){var e=this.charToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};Pt.prototype.updateFeatures=function(n){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(a){return n[a]})}:e})};Pt.prototype.stringToGlyphs=function(n,e){var a=this,s=new wr,l=function(C){return a.charToGlyphIndex(C.char)};s.registerModifier("glyphIndex",null,l);var o=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;s.applyFeatures(this,o);for(var u=s.getTextGlyphs(n),h=u.length,p=new Array(h),g=this.glyphs.get(0),b=0;b<h;b+=1)p[b]=this.glyphs.get(u[b])||g;return p};Pt.prototype.nameToGlyphIndex=function(n){return this.glyphNames.nameToGlyphIndex(n)};Pt.prototype.nameToGlyph=function(n){var e=this.nameToGlyphIndex(n),a=this.glyphs.get(e);return a||(a=this.glyphs.get(0)),a};Pt.prototype.glyphIndexToName=function(n){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(n):""};Pt.prototype.getKerningValue=function(n,e){n=n.index||n,e=e.index||e;var a=this.position.defaultKerningTables;return a?this.position.getKerningValue(a,n,e):this.kerningPairs[n+","+e]||0};Pt.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Pt.prototype.forEachGlyph=function(n,e,a,s,l,o){e=e!==void 0?e:0,a=a!==void 0?a:0,s=s!==void 0?s:72,l=Object.assign({},this.defaultRenderOptions,l);var u=1/this.unitsPerEm*s,h=this.stringToGlyphs(n,l),p;if(l.kerning){var g=l.script||this.position.getDefaultScriptName();p=this.position.getKerningTables(g,l.language)}for(var b=0;b<h.length;b+=1){var C=h[b];if(o.call(this,C,e,a,s,l),C.advanceWidth&&(e+=C.advanceWidth*u),l.kerning&&b<h.length-1){var w=p?this.position.getKerningValue(p,C.index,h[b+1].index):this.getKerningValue(C,h[b+1]);e+=w*u}l.letterSpacing?e+=l.letterSpacing*s:l.tracking&&(e+=l.tracking/1e3*s)}return e};Pt.prototype.getPath=function(n,e,a,s,l){var o=new Sn;return this.forEachGlyph(n,e,a,s,l,function(u,h,p,g){var b=u.getPath(h,p,g,l,this);o.extend(b)}),o};Pt.prototype.getPaths=function(n,e,a,s,l){var o=[];return this.forEachGlyph(n,e,a,s,l,function(u,h,p,g){var b=u.getPath(h,p,g,l,this);o.push(b)}),o};Pt.prototype.getAdvanceWidth=function(n,e,a){return this.forEachGlyph(n,0,0,e,a,function(){})};Pt.prototype.draw=function(n,e,a,s,l,o){this.getPath(e,a,s,l,o).draw(n)};Pt.prototype.drawPoints=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,h,p,g){u.drawPoints(n,h,p,g)})};Pt.prototype.drawMetrics=function(n,e,a,s,l,o){this.forEachGlyph(e,a,s,l,o,function(u,h,p,g){u.drawMetrics(n,h,p,g)})};Pt.prototype.getEnglishName=function(n){var e=this.names[n];if(e)return e.en};Pt.prototype.validate=function(){var n=this;function e(s,l){}function a(s){var l=n.getEnglishName(s);l&&l.trim().length>0}a("fontFamily"),a("weightName"),a("manufacturer"),a("copyright"),a("version"),this.unitsPerEm>0};Pt.prototype.toTables=function(){return Dx.fontToTable(this)};Pt.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Pt.prototype.toArrayBuffer=function(){for(var n=this.toTables(),e=n.encode(),a=new ArrayBuffer(e.length),s=new Uint8Array(a),l=0;l<e.length;l++)s[l]=e[l];return a};Pt.prototype.download=function(n){var e=this.getEnglishName("fontFamily"),a=this.getEnglishName("fontSubfamily");n=n||e.replace(/\s/g,"")+"-"+a+".otf";var s=this.toArrayBuffer();if(Ox())if(window.URL=window.URL||window.webkitURL,window.URL){var l=new DataView(s),o=new Blob([l],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(o),u.download=n;var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!1),u.dispatchEvent(h)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var p=require("fs"),g=Ix(s);p.writeFileSync(n,g)}};Pt.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Pt.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Pt.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function Kg(n,e){var a=JSON.stringify(n),s=256;for(var l in e){var o=parseInt(l);if(!(!o||o<256)){if(JSON.stringify(e[l])===a)return o;s<=o&&(s=o+1)}}return e[s]=n,s}function q2(n,e,a){var s=Kg(e.name,a);return[{name:"tag_"+n,type:"TAG",value:e.tag},{name:"minValue_"+n,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+n,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+n,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+n,type:"USHORT",value:0},{name:"nameID_"+n,type:"USHORT",value:s}]}function V2(n,e,a){var s={},l=new qe.Parser(n,e);return s.tag=l.parseTag(),s.minValue=l.parseFixed(),s.defaultValue=l.parseFixed(),s.maxValue=l.parseFixed(),l.skip("uShort",1),s.name=a[l.parseUShort()]||{},s}function X2(n,e,a,s){for(var l=Kg(e.name,s),o=[{name:"nameID_"+n,type:"USHORT",value:l},{name:"flags_"+n,type:"USHORT",value:0}],u=0;u<a.length;++u){var h=a[u].tag;o.push({name:"axis_"+n+" "+h,type:"FIXED",value:e.coordinates[h]<<16})}return o}function $2(n,e,a,s){var l={},o=new qe.Parser(n,e);l.name=s[o.parseUShort()]||{},o.skip("uShort",1),l.coordinates={};for(var u=0;u<a.length;++u)l.coordinates[a[u].tag]=o.parseFixed();return l}function W2(n,e){var a=new Fe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:n.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:n.instances.length},{name:"instanceSize",type:"USHORT",value:4+n.axes.length*4}]);a.offsetToData=a.sizeOf();for(var s=0;s<n.axes.length;s++)a.fields=a.fields.concat(q2(s,n.axes[s],e));for(var l=0;l<n.instances.length;l++)a.fields=a.fields.concat(X2(l,n.instances[l],n.axes,e));return a}function Z2(n,e,a){var s=new qe.Parser(n,e),l=s.parseULong();at.argument(l===65536,"Unsupported fvar table version.");var o=s.parseOffset16();s.skip("uShort",1);for(var u=s.parseUShort(),h=s.parseUShort(),p=s.parseUShort(),g=s.parseUShort(),b=[],C=0;C<u;C++)b.push(V2(n,e+o+C*h,a));for(var w=[],x=e+o+u*h,M=0;M<p;M++)w.push($2(n,x+M*g,b,a));return{axes:b,instances:w}}var Q2={make:W2,parse:Z2},K2=function(){return{coverage:this.parsePointer(ye.coverage),attachPoints:this.parseList(ye.pointer(ye.uShortList))}},J2=function(){var n=this.parseUShort();if(at.argument(n===1||n===2||n===3,"Unsupported CaretValue table version."),n===1)return{coordinate:this.parseShort()};if(n===2)return{pointindex:this.parseShort()};if(n===3)return{coordinate:this.parseShort()}},ew=function(){return this.parseList(ye.pointer(J2))},tw=function(){return{coverage:this.parsePointer(ye.coverage),ligGlyphs:this.parseList(ye.pointer(ew))}},nw=function(){return this.parseUShort(),this.parseList(ye.pointer(ye.coverage))};function aw(n,e){e=e||0;var a=new ye(n,e),s=a.parseVersion(1);at.argument(s===1||s===1.2||s===1.3,"Unsupported GDEF table version.");var l={version:s,classDef:a.parsePointer(ye.classDef),attachList:a.parsePointer(K2),ligCaretList:a.parsePointer(tw),markAttachClassDef:a.parsePointer(ye.classDef)};return s>=1.2&&(l.markGlyphSets=a.parsePointer(nw)),l}var rw={parse:aw},xr=new Array(10);xr[1]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();if(a===1)return{posFormat:1,coverage:this.parsePointer(ye.coverage),value:this.parseValueRecord()};if(a===2)return{posFormat:2,coverage:this.parsePointer(ye.coverage),values:this.parseValueRecordList()};at.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};xr[2]=function(){var e=this.offset+this.relativeOffset,a=this.parseUShort();at.assert(a===1||a===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var s=this.parsePointer(ye.coverage),l=this.parseUShort(),o=this.parseUShort();if(a===1)return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,pairSets:this.parseList(ye.pointer(ye.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}})))};if(a===2){var u=this.parsePointer(ye.classDef),h=this.parsePointer(ye.classDef),p=this.parseUShort(),g=this.parseUShort();return{posFormat:a,coverage:s,valueFormat1:l,valueFormat2:o,classDef1:u,classDef2:h,class1Count:p,class2Count:g,classRecords:this.parseList(p,ye.list(g,function(){return{value1:this.parseValueRecord(l),value2:this.parseValueRecord(o)}}))}}};xr[3]=function(){return{error:"GPOS Lookup 3 not supported"}};xr[4]=function(){return{error:"GPOS Lookup 4 not supported"}};xr[5]=function(){return{error:"GPOS Lookup 5 not supported"}};xr[6]=function(){return{error:"GPOS Lookup 6 not supported"}};xr[7]=function(){return{error:"GPOS Lookup 7 not supported"}};xr[8]=function(){return{error:"GPOS Lookup 8 not supported"}};xr[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function sw(n,e){e=e||0;var a=new ye(n,e),s=a.parseVersion(1);return at.argument(s===1||s===1.1,"Unsupported GPOS table version "+s),s===1?{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(xr)}:{version:s,scripts:a.parseScriptList(),features:a.parseFeatureList(),lookups:a.parseLookupList(xr),variations:a.parseFeatureVariationsList()}}var iw=new Array(10);function lw(n){return new Fe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Fe.ScriptList(n.scripts)},{name:"features",type:"TABLE",value:new Fe.FeatureList(n.features)},{name:"lookups",type:"TABLE",value:new Fe.LookupList(n.lookups,iw)}])}var ow={parse:sw,make:lw};function cw(n){var e={};n.skip("uShort");var a=n.parseUShort();at.argument(a===0,"Unsupported kern sub-table version."),n.skip("uShort",2);var s=n.parseUShort();n.skip("uShort",3);for(var l=0;l<s;l+=1){var o=n.parseUShort(),u=n.parseUShort(),h=n.parseShort();e[o+","+u]=h}return e}function uw(n){var e={};n.skip("uShort");var a=n.parseULong();a>1&&console.warn("Only the first kern subtable is supported."),n.skip("uLong");var s=n.parseUShort(),l=s&255;if(n.skip("uShort"),l===0){var o=n.parseUShort();n.skip("uShort",3);for(var u=0;u<o;u+=1){var h=n.parseUShort(),p=n.parseUShort(),g=n.parseShort();e[h+","+p]=g}}return e}function fw(n,e){var a=new qe.Parser(n,e),s=a.parseUShort();if(s===0)return cw(a);if(s===1)return uw(a);throw new Error("Unsupported kern table version ("+s+").")}var dw={parse:fw};function pw(n,e,a,s){for(var l=new qe.Parser(n,e),o=s?l.parseUShort:l.parseULong,u=[],h=0;h<a+1;h+=1){var p=o.call(l);s&&(p*=2),u.push(p)}return u}var hw={parse:pw};function mw(n,e){var a=require("fs");a.readFile(n,function(s,l){if(s)return e(s.message);e(null,Pg(l))})}function gw(n,e){var a=new XMLHttpRequest;a.open("get",n,!0),a.responseType="arraybuffer",a.onload=function(){return a.response?e(null,a.response):e("Font could not be loaded: "+a.statusText)},a.onerror=function(){e("Font could not be loaded")},a.send()}function Om(n,e){for(var a=[],s=12,l=0;l<e;l+=1){var o=qe.getTag(n,s),u=qe.getULong(n,s+4),h=qe.getULong(n,s+8),p=qe.getULong(n,s+12);a.push({tag:o,checksum:u,offset:h,length:p,compression:!1}),s+=16}return a}function yw(n,e){for(var a=[],s=44,l=0;l<e;l+=1){var o=qe.getTag(n,s),u=qe.getULong(n,s+4),h=qe.getULong(n,s+8),p=qe.getULong(n,s+12),g=void 0;h<p?g="WOFF":g=!1,a.push({tag:o,offset:u,compression:g,compressedLength:h,length:p}),s+=20}return a}function dn(n,e){if(e.compression==="WOFF"){var a=new Uint8Array(n.buffer,e.offset+2,e.compressedLength-2),s=new Uint8Array(e.length);if(ob(a,s),s.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var l=new DataView(s.buffer,0);return{data:l,offset:0}}else return{data:n,offset:e.offset}}function xd(n,e){e=e??{};var a,s,l=new Pt({empty:!0}),o=new DataView(n,0),u,h=[],p=qe.getTag(o,0);if(p==="\0\0\0"||p==="true"||p==="typ1")l.outlinesFormat="truetype",u=qe.getUShort(o,4),h=Om(o,u);else if(p==="OTTO")l.outlinesFormat="cff",u=qe.getUShort(o,4),h=Om(o,u);else if(p==="wOFF"){var g=qe.getTag(o,4);if(g==="\0\0\0")l.outlinesFormat="truetype";else if(g==="OTTO")l.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+p);u=qe.getUShort(o,12),h=yw(o,u)}else throw new Error("Unsupported OpenType signature "+p);for(var b,C,w,x,M,R,I,H,B,D,j,_,G=0;G<u;G+=1){var Y=h[G],J=void 0;switch(Y.tag){case"cmap":J=dn(o,Y),l.tables.cmap=hg.parse(J.data,J.offset),l.encoding=new gg(l.tables.cmap);break;case"cvt ":J=dn(o,Y),_=new qe.Parser(J.data,J.offset),l.tables.cvt=_.parseShortList(Y.length/2);break;case"fvar":C=Y;break;case"fpgm":J=dn(o,Y),_=new qe.Parser(J.data,J.offset),l.tables.fpgm=_.parseByteList(Y.length);break;case"head":J=dn(o,Y),l.tables.head=Cg.parse(J.data,J.offset),l.unitsPerEm=l.tables.head.unitsPerEm,a=l.tables.head.indexToLocFormat;break;case"hhea":J=dn(o,Y),l.tables.hhea=Mg.parse(J.data,J.offset),l.ascender=l.tables.hhea.ascender,l.descender=l.tables.hhea.descender,l.numberOfHMetrics=l.tables.hhea.numberOfHMetrics;break;case"hmtx":I=Y;break;case"ltag":J=dn(o,Y),s=kg.parse(J.data,J.offset);break;case"maxp":J=dn(o,Y),l.tables.maxp=Rg.parse(J.data,J.offset),l.numGlyphs=l.tables.maxp.numGlyphs;break;case"name":D=Y;break;case"OS/2":J=dn(o,Y),l.tables.os2=td.parse(J.data,J.offset);break;case"post":J=dn(o,Y),l.tables.post=Ug.parse(J.data,J.offset),l.glyphNames=new pd(l.tables.post);break;case"prep":J=dn(o,Y),_=new qe.Parser(J.data,J.offset),l.tables.prep=_.parseByteList(Y.length);break;case"glyf":w=Y;break;case"loca":B=Y;break;case"CFF ":b=Y;break;case"kern":H=Y;break;case"GDEF":x=Y;break;case"GPOS":M=Y;break;case"GSUB":R=Y;break;case"meta":j=Y;break}}var ae=dn(o,D);if(l.tables.name=Lg.parse(ae.data,ae.offset,s),l.names=l.tables.name,w&&B){var re=a===0,O=dn(o,B),W=hw.parse(O.data,O.offset,l.numGlyphs,re),K=dn(o,w);l.glyphs=Yg.parse(K.data,K.offset,W,l,e)}else if(b){var Z=dn(o,b);Tg.parse(Z.data,Z.offset,l,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var ee=dn(o,I);if(Ng.parse(l,ee.data,ee.offset,l.numberOfHMetrics,l.numGlyphs,l.glyphs,e),kb(l,e),H){var V=dn(o,H);l.kerningPairs=dw.parse(V.data,V.offset)}else l.kerningPairs={};if(x){var te=dn(o,x);l.tables.gdef=rw.parse(te.data,te.offset)}if(M){var ce=dn(o,M);l.tables.gpos=ow.parse(ce.data,ce.offset),l.position.init()}if(R){var xe=dn(o,R);l.tables.gsub=jg.parse(xe.data,xe.offset)}if(C){var $=dn(o,C);l.tables.fvar=Q2.parse($.data,$.offset,l.names)}if(j){var Q=dn(o,j);l.tables.meta=Bg.parse(Q.data,Q.offset),l.metas=l.tables.meta}return l}function vw(n,e,a){a=a??{};var s=typeof window>"u",l=s&&!a.isUrl?mw:gw;return new Promise(function(o,u){l(n,function(h,p){if(h){if(e)return e(h);u(h)}var g;try{g=xd(p,a)}catch(b){if(e)return e(b,null);u(b)}if(e)return e(null,g);o(g)})})}function bw(n,e){var a=require("fs"),s=a.readFileSync(n);return xd(Pg(s),e)}var xw=Object.freeze({__proto__:null,Font:Pt,Glyph:Ia,Path:Sn,BoundingBox:fs,_parse:qe,parse:xd,load:vw,loadSync:bw});const Ei=(n,e)=>({...e,...n}),ao=new Map;function fl(n,e){const{renderingStyle:a,thickness:s,blankingSize:l}=Ei(e,{renderingStyle:"normal",thickness:1,blankingSize:3});if(a==="normal"||!n||n.length===0)return n;const o=[];if(a==="dotted")for(const u of n)for(let h=0;h<s;h++)o.push({...u});else if(a==="blanked"){const u=Math.max(1,Math.floor(l));for(let h=0;h<n.length;h++){const p=n[h];p.blanking?o.push({...p}):Math.floor(h/u)%2===0?o.push({...p}):o.push({...p,r:0,g:0,b:0,blanking:!0})}}else if(a==="dots")for(const u of n)o.push({...u,r:0,g:0,b:0,blanking:!0}),o.push({...u,blanking:!1}),o.push({...u,blanking:!1});return o}async function Im(n,e){try{if(!e)throw new Error("A font buffer is required to generate text.");const a=`${e.byteLength}_${new Uint8Array(e.slice(0,100)).join("")}`;let s=ao.get(a);if(!s&&(s=xw.parse(e),ao.set(a,s),ao.size>10)){const ae=ao.keys().next().value;ao.delete(ae)}const{text:l,x:o,y:u,r:h,g:p,b:g,fontSize:b,numPoints:C}=Ei(n,{text:"TrueLazer",x:0,y:.3,r:255,g:255,b:255,fontSize:72,numPoints:100}),w=s.getPath(l,0,0,b),x=w.commands,M=w.getBoundingBox(),R=(M.x1+M.x2)/2,I=(M.y1+M.y2)/2;let H=0,B=0,D=0;x.forEach(ae=>{if(ae.type==="M")B=ae.x,D=ae.y;else if(ae.type==="L"||ae.type==="Q"||ae.type==="C"){const re=ae.x-B,O=ae.y-D;H+=Math.sqrt(re*re+O*O),B=ae.x,D=ae.y}});const j=C/(H||1),_=[];B=0,D=0;let G=0,Y=0;const J=200;if(x.forEach(ae=>{if(ae.type==="M"){if(_.length>0){const W=_[_.length-1];_.push({...W,r:0,g:0,b:0,blanking:!0})}G=ae.x,Y=ae.y;const re=(ae.x-R)/J+o,O=-(ae.y-I)/J+u;_.push({x:re,y:O,r:0,g:0,b:0,blanking:!0}),_.push({x:re,y:O,r:h,g:p,b:g,blanking:!1}),B=ae.x,D=ae.y}else if(ae.type==="L"){const re=ae.x-B,O=ae.y-D,W=Math.sqrt(re*re+O*O),K=Math.max(1,Math.floor(W*j));for(let Z=1;Z<=K;Z++){const ee=Z/K;_.push({x:(B+re*ee-R)/J+o,y:-(D+O*ee-I)/J+u,r:h,g:p,b:g})}B=ae.x,D=ae.y}else if(ae.type==="Q"){const re=ae.x-B,O=ae.y-D,W=Math.sqrt(re*re+O*O),K=Math.max(2,Math.floor(W*j));for(let Z=1;Z<=K;Z++){const ee=Z/K,V=Math.pow(1-ee,2)*B+2*(1-ee)*ee*ae.x1+Math.pow(ee,2)*ae.x,te=Math.pow(1-ee,2)*D+2*(1-ee)*ee*ae.y1+Math.pow(ee,2)*ae.y;_.push({x:(V-R)/J+o,y:-(te-I)/J+u,r:h,g:p,b:g})}B=ae.x,D=ae.y}else if(ae.type==="C"){const re=ae.x-B,O=ae.y-D,W=Math.sqrt(re*re+O*O),K=Math.max(3,Math.floor(W*j));for(let Z=1;Z<=K;Z++){const ee=Z/K,V=Math.pow(1-ee,3)*B+3*Math.pow(1-ee,2)*ee*ae.x1+3*(1-ee)*Math.pow(ee,2)*ae.x2+Math.pow(ee,3)*ae.x,te=Math.pow(1-ee,3)*D+3*Math.pow(1-ee,2)*ee*ae.y1+3*(1-ee)*Math.pow(ee,2)*ae.y2+Math.pow(ee,3)*ae.y;_.push({x:(V-R)/J+o,y:-(te-I)/J+u,r:h,g:p,b:g})}B=ae.x,D=ae.y}else ae.type==="Z"&&(_.push({x:(G-R)/J+o,y:-(Y-I)/J+u,r:h,g:p,b:g}),B=G,D=Y)}),_.length>0){const ae=_[_.length-1];_.push({...ae,r:0,g:0,b:0,blanking:!0})}return{points:fl(_,n)}}catch(a){throw console.error("Error in generateText:",a),a}}function Lm(n){try{const{radius:e,numPoints:a,x:s,y:l,r:o,g:u,b:h}=Ei(n,{radius:.5,numPoints:50,x:0,y:0,r:255,g:255,b:255}),p=[];for(let g=0;g<=a;g++){const b=g/a*2*Math.PI;p.push({x:e*Math.cos(b)+s,y:e*Math.sin(b)+l,r:o,g:u,b:h})}return{points:fl(p,n)}}catch(e){throw console.error("Error in generateCircle:",e),e}}function Um(n){try{const{width:e,height:a,pointDensity:s,x:l,y:o,r:u,g:h,b:p}=Ei(n,{width:1,height:1,pointDensity:12,x:0,y:0,r:255,g:255,b:255}),g=[{x:-e/2+l,y:-a/2+o},{x:e/2+l,y:-a/2+o},{x:e/2+l,y:a/2+o},{x:-e/2+l,y:a/2+o},{x:-e/2+l,y:-a/2+o}],b=[];for(let C=0;C<g.length-1;C++){const w=g[C],x=g[C+1];for(let M=0;M<s;M++){const R=M/s;b.push({x:w.x+(x.x-w.x)*R,y:w.y+(x.y-w.y)*R,r:u,g:h,b:p})}}return b.push({...g[g.length-1],r:u,g:h,b:p}),{points:fl(b,n)}}catch(e){throw console.error("Error in generateSquare:",e),e}}function jm(n){try{const{x1:e,y1:a,x2:s,y2:l,pointDensity:o,r:u,g:h,b:p}=Ei(n,{x1:-.5,y1:0,x2:.5,y2:0,pointDensity:50,r:255,g:255,b:255}),g=[];for(let b=0;b<=o;b++){const C=b/o;g.push({x:e+(s-e)*C,y:a+(l-a)*C,r:u,g:h,b:p})}return{points:fl(g,n)}}catch(e){throw console.error("Error in generateLine:",e),e}}function Bm(n){try{const{outerRadius:e,innerRadius:a,numSpikes:s,pointDensity:l,x:o,y:u,r:h,g:p,b:g}=Ei(n,{outerRadius:.5,innerRadius:.2,numSpikes:5,pointDensity:5,x:0,y:0,r:255,g:255,b:255}),b=[];for(let w=0;w<s*2;w++){const x=w%2===0?e:a,M=w/(s*2)*2*Math.PI-Math.PI/2;b.push({x:x*Math.cos(M)+o,y:x*Math.sin(M)+u})}b.push({...b[0]});const C=[];for(let w=0;w<b.length-1;w++){const x=b[w],M=b[w+1];for(let R=0;R<l;R++){const I=R/l;C.push({x:x.x+(M.x-x.x)*I,y:x.y+(M.y-x.y)*I,r:h,g:p,b:g})}}return C.push({...b[b.length-1],r:h,g:p,b:g}),{points:fl(C,n)}}catch(e){throw console.error("Error in generateStar:",e),e}}function Sw(n){try{const{amplitude:e,frequency:a,phase:s,width:l,numPoints:o,x:u,y:h,r:p,g,b}=Ei(n,{amplitude:.5,frequency:1,phase:0,width:2,numPoints:50,x:0,y:0,r:255,g:255,b:255}),C=[],w=-l/2;for(let x=0;x<=o;x++){const M=x/o,R=w+M*l,I=e*Math.sin(a*(R*Math.PI)+s);C.push({x:R+u,y:I+h,r:p,g,b})}return{points:fl(C,n)}}catch(e){throw console.error("Error in generateSinewave:",e),e}}const so=()=>Math.random().toString(36).substr(2,9),ww=Yn.memo(({playbackFps:n,onSpeedChange:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"range",paramName:"master_speed",targetType:"global",label:"SPEED",min:1,max:120,step:1}))};return f.jsxs("div",{className:"master-speed-slider",children:[f.jsxs("label",{htmlFor:"masterSpeedRange",draggable:!0,onDragStart:a,children:[n," FPS"]}),f.jsx($t,{id:"master_speed",children:f.jsx("input",{type:"range",min:"1",max:"120",value:n,className:"slider_hor",id:"masterSpeedRange",onChange:s=>e(parseInt(s.target.value))})})]})}),Ew=Yn.memo(({isWorldOutputActive:n,onToggleWorldOutput:e})=>{const a=s=>{s.dataTransfer.setData("application/x-truelazer-param",JSON.stringify({type:"toggle",paramName:"laser_output",targetType:"global",label:"LASER"}))};return f.jsx("div",{className:"container",draggable:!0,onDragStart:a,children:f.jsx($t,{id:"laser_output",children:f.jsx("input",{type:"checkbox",checked:n,onChange:e})})})}),io=(n,e,a,s)=>!Array.isArray(n)||n.length!==e?Array(e).fill(null).map((l,o)=>Array(a).fill(null).map((u,h)=>s(o,h))):n.map((l,o)=>!Array.isArray(l)||l.length!==a?Array(a).fill(null).map((u,h)=>s(o,h)):l),Jg=n=>({columns:Array.from({length:8},(e,a)=>`Col ${a+1}`),layers:Array.from({length:5},(e,a)=>`Layer ${a+1}`),clipContents:io(n?.clipContents,5,8,()=>({parsing:!1})),clipNames:io(n?.clipNames,5,8,(e,a)=>`Clip ${e+1}-${a+1}`),thumbnailFrameIndexes:Array(5).fill(null).map(()=>Array(8).fill(0)),layerEffects:Array.from({length:5},()=>[]),layerAssignedDacs:n?.layerAssignedDacs??Array(5).fill([]),layerIntensities:Array(5).fill(1),layerAutopilots:Array(5).fill("off"),layerBlackouts:Array(5).fill(!1),layerSolos:Array(5).fill(!1),masterIntensity:1,globalBlackout:!1,selectedLayerIndex:null,selectedColIndex:null,notification:{message:"",visible:!1},dacs:[],selectedDac:n?.dacAssignment?.selectedDac??n?.selectedDac??null,fileBrowserViewMode:"list",fileBrowserPath:"",layerUiStates:Array(6).fill({}),ildaFrames:[],selectedIldaWorkerId:null,selectedIldaTotalFrames:0,bpm:n?.bpm??120,showBeamEffect:n?.renderSettings?.showBeamEffect??!0,beamAlpha:n?.renderSettings?.beamAlpha??.1,fadeAlpha:n?.renderSettings?.fadeAlpha??.13,playbackFps:n?.renderSettings?.playbackFps??60,previewScanRate:n?.renderSettings?.previewScanRate??1,beamRenderMode:n?.renderSettings?.beamRenderMode??"both",worldShowBeamEffect:n?.renderSettings?.worldShowBeamEffect??!0,worldBeamRenderMode:n?.renderSettings?.worldBeamRenderMode??"both",optimizationEnabled:n?.renderSettings?.optimizationEnabled??!0,activeClipIndexes:Array(5).fill(null),isPlaying:!1,isStopped:!0,isWorldOutputActive:!1,thumbnailRenderMode:n?.thumbnailRenderMode??"still",theme:n?.theme??"orange",projectLoadTimestamp:null,clipClipboard:null,dacOutputSettings:n?.dacOutputSettings??{},quickAssigns:{knobs:Array(8).fill(null).map(()=>({value:0,label:null,link:null})),buttons:Array(8).fill(null).map(()=>({value:!1,label:null,link:null}))}});function Aw(n,e){switch(e.type){case"SET_DAC_OUTPUT_SETTINGS":return{...n,dacOutputSettings:{...n.dacOutputSettings,[e.payload.id]:e.payload.settings}};case"SET_COLUMNS":return{...n,columns:e.payload};case"SET_COLUMN_NAME":{const a=[...n.columns];return a[e.payload.index]=e.payload.name,{...n,columns:a}}case"DUPLICATE_COLUMN":{const a=e.payload.index,s=[...n.columns];s.splice(a+1,0,`${s[a]} (Copy)`);const l=n.clipContents.map(h=>{const p=[...h],g=p[a];let b=null;if(g&&(b=JSON.parse(JSON.stringify(g)),b.type==="ilda"&&(b.workerId=null),b.effects)){const C=b.syncSettings||{};b.effects=b.effects.map(w=>{const x=w.instanceId,M=so();return Object.keys(C).forEach(R=>{x&&R.startsWith(`${x}.`)&&(C[`${M}.${R.split(".")[1]}`]=C[R],delete C[R])}),{...w,instanceId:M}}),b.syncSettings=C}return p.splice(a+1,0,b),p}),o=n.clipNames.map(h=>{const p=[...h];return p.splice(a+1,0,`${p[a]} (Copy)`),p}),u=n.thumbnailFrameIndexes.map(h=>{const p=[...h];return p.splice(a+1,0,p[a]),p});return{...n,columns:s,clipContents:l,clipNames:o,thumbnailFrameIndexes:u}}case"SET_LAYERS":return{...n,layers:e.payload};case"SET_LAYER_NAME":{const a=[...n.layers];return a[e.payload.index]=e.payload.name,{...n,layers:a}}case"SET_CLIP_CONTENT":{const{layerIndex:a,colIndex:s,content:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipContents];if(!o[a])return console.error(`Reducer Error: Layer array at index ${a} is undefined. Action:`,e),n;o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,...l},{...n,clipContents:o}}case"SET_CLIP_NAME":{const{layerIndex:a,colIndex:s,name:l}=e.payload;if(a===void 0||s===void 0)return n;const o=[...n.clipNames];return o[a]&&(o[a]=[...o[a]],o[a][s]=l),{...n,clipNames:o}}case"SET_THUMBNAIL_FRAME_INDEX":{const a=[...n.thumbnailFrameIndexes];return a[e.payload.layerIndex][e.payload.colIndex]=e.payload.index,{...n,thumbnailFrameIndexes:a}}case"ADD_LAYER_EFFECT":{const a=[...n.layerEffects],s={...e.payload.effect,instanceId:so(),params:{...e.payload.effect.defaultParams}};return a[e.payload.layerIndex].push(s),{...n,layerEffects:a}}case"ADD_CLIP_EFFECT":{const a=[...n.clipContents];if(!a[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),n;a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=a[e.payload.layerIndex][e.payload.colIndex]||{},l={...e.payload.effect,instanceId:so(),params:{...e.payload.effect.defaultParams}},o={...s,effects:[...s.effects||[],l]};return a[e.payload.layerIndex][e.payload.colIndex]=o,{...n,clipContents:a}}case"SET_SELECTED_CLIP":return{...n,selectedLayerIndex:e.payload.layerIndex,selectedColIndex:e.payload.colIndex};case"SET_NOTIFICATION":return{...n,notification:e.payload};case"SET_ILDA_FRAMES":return{...n,ildaFrames:e.payload};case"SET_SELECTED_ILDA_DATA":return{...n,selectedIldaWorkerId:e.payload.workerId,selectedIldaTotalFrames:e.payload.totalFrames,selectedGeneratorId:e.payload.generatorId,selectedGeneratorParams:e.payload.generatorParams};case"SET_ACTIVE_CLIP":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]=e.payload.colIndex,{...n,activeClipIndexes:a}}case"CLEAR_CLIP":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]],a[e.payload.layerIndex][e.payload.colIndex]=null;const s=[...n.clipNames];s[e.payload.layerIndex][e.payload.colIndex]=`Clip ${e.payload.layerIndex+1}-${e.payload.colIndex+1}`;const l=[...n.thumbnailFrameIndexes];l[e.payload.layerIndex][e.payload.colIndex]=0;const o=[...n.activeClipIndexes];return o[e.payload.layerIndex]===e.payload.colIndex&&(o[e.payload.layerIndex]=null),n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex?{...n,clipContents:a,clipNames:s,thumbnailFrameIndexes:l,activeClipIndexes:o,selectedLayerIndex:null,selectedColIndex:null,selectedIldaWorkerId:null,selectedIldaTotalFrames:0,selectedGeneratorId:null,selectedGeneratorParams:{}}:{...n,clipContents:a,clipNames:s,thumbnailFrameIndexes:l,activeClipIndexes:o}}case"DEACTIVATE_LAYER_CLIPS":{const a=[...n.activeClipIndexes];return a[e.payload.layerIndex]=null,{...n,activeClipIndexes:a}}case"CLEAR_ALL_ACTIVE_CLIPS":return{...n,activeClipIndexes:Array(n.layers.length).fill(null)};case"SET_LAYER_INTENSITY":{const a=[...n.layerIntensities];return a[e.payload.layerIndex]=e.payload.intensity,{...n,layerIntensities:a}}case"SET_LAYER_AUTOPILOT":{const a=[...n.layerAutopilots];return a[e.payload.layerIndex]=e.payload.mode,{...n,layerAutopilots:a}}case"TOGGLE_LAYER_BLACKOUT":{const a=[...n.layerBlackouts];return a[e.payload.layerIndex]=!a[e.payload.layerIndex],{...n,layerBlackouts:a}}case"TOGGLE_LAYER_SOLO":{const a=[...n.layerSolos],s=a[e.payload.layerIndex];return a.fill(!1),s||(a[e.payload.layerIndex]=!0),{...n,layerSolos:a}}case"SET_MASTER_INTENSITY":return{...n,masterIntensity:e.payload};case"TOGGLE_GLOBAL_BLACKOUT":return{...n,globalBlackout:!n.globalBlackout};case"SET_RENDER_SETTING":return{...n,[e.payload.setting]:e.payload.value};case"SET_FILE_BROWSER_VIEW_MODE":return{...n,fileBrowserViewMode:e.payload};case"SET_FILE_BROWSER_PATH":return{...n,fileBrowserPath:e.payload};case"UPDATE_CLIP_UI_STATE":{const{layerIndex:a,colIndex:s,uiState:l}=e.payload,o=[...n.clipContents];o[a]=[...o[a]];const u={...o[a][s]};return u&&(u.uiState={...u.uiState||{},...l},o[a][s]=u),{...n,clipContents:o}}case"UPDATE_LAYER_UI_STATE":{const{layerIndex:a,uiState:s}=e.payload,l=[...n.layerUiStates];return l[a]={...l[a],...s},{...n,layerUiStates:l}}case"REMOVE_CLIP_EFFECT":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};if(s&&s.effects){const l=[...s.effects];l.splice(e.payload.effectIndex,1),s.effects=l,a[e.payload.layerIndex][e.payload.colIndex]=s}return{...n,clipContents:a}}case"REORDER_CLIP_EFFECTS":{const{layerIndex:a,colIndex:s,oldIndex:l,newIndex:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h&&h.effects){const p=[...h.effects],[g]=p.splice(l,1);p.splice(o,0,g),h.effects=p,u[a][s]=h}return{...n,clipContents:u}}case"REMOVE_LAYER_EFFECT":{const a=[...n.layerEffects];return a[e.payload.layerIndex]&&(a[e.payload.layerIndex]=[...a[e.payload.layerIndex]],a[e.payload.layerIndex].splice(e.payload.effectIndex,1)),{...n,layerEffects:a}}case"UPDATE_LAYER_EFFECT_PARAMETER":{const a=[...n.layerEffects];if(a[e.payload.layerIndex]){a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=e.payload.effectIndex;if(a[e.payload.layerIndex][s]){const l={...a[e.payload.layerIndex][s]};l.params={...l.params,[e.payload.paramName]:e.payload.newValue},a[e.payload.layerIndex][s]=l}}return{...n,layerEffects:a}}case"UPDATE_EFFECT_PARAMETER":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};if(s&&s.effects){const l=[...s.effects],o={...l[e.payload.effectIndex]};o.params={...o.params,[e.payload.paramName]:e.payload.newValue},l[e.payload.effectIndex]=o,s.effects=l,a[e.payload.layerIndex][e.payload.colIndex]=s}return{...n,clipContents:a}}case"UPDATE_CLIP_PLAYBACK_SETTINGS":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};return s&&(s.playbackSettings={...s.playbackSettings||{mode:"fps",duration:1,beats:8,speedMultiplier:1},...e.payload.settings},a[e.payload.layerIndex][e.payload.colIndex]=s),{...n,clipContents:a}}case"SET_CLIP_PARAM_SYNC":{const{layerIndex:a,colIndex:s,paramId:l,syncMode:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h){const p=h.syncSettings||{},g=p[l]===o?null:o;h.syncSettings={...p,[l]:g},u[a][s]=h}return{...n,clipContents:u}}case"UPDATE_GENERATOR_PARAM":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s={...a[e.payload.layerIndex][e.payload.colIndex]};return s&&s.type==="generator"&&s.currentParams&&(s.currentParams={...s.currentParams,[e.payload.paramName]:e.payload.newValue},a[e.payload.layerIndex][e.payload.colIndex]=s,n.selectedLayerIndex===e.payload.layerIndex&&n.selectedColIndex===e.payload.colIndex)?{...n,clipContents:a,selectedGeneratorParams:s.currentParams}:{...n,clipContents:a}}case"SET_DACS":return{...n,dacs:e.payload};case"SET_BPM":return{...n,bpm:e.payload};case"SET_SELECTED_DAC":return{...n,selectedDac:e.payload};case"SET_IS_PLAYING":return{...n,isPlaying:e.payload};case"SET_IS_STOPPED":return{...n,isStopped:e.payload};case"SET_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:e.payload};case"SET_OPTIMIZATION_ENABLED":return{...n,optimizationEnabled:e.payload};case"TOGGLE_WORLD_OUTPUT_ACTIVE":return{...n,isWorldOutputActive:!n.isWorldOutputActive};case"SET_CLIPBOARD":return{...n,clipClipboard:e.payload};case"SET_CLIP_DAC":{const a=[...n.clipContents];if(!a[e.payload.layerIndex])return console.error(`Reducer Error: Layer array at index ${e.payload.layerIndex} is undefined. Action:`,e),n;a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const s=a[e.payload.layerIndex][e.payload.colIndex]||{};let l=s.assignedDacs||[];const o=[],u=p=>{const{channels:g,allChannels:b,...C}=p;return C};if(e.payload.dac.allChannels&&e.payload.dac.channels)e.payload.dac.channels.forEach(p=>{l.some(g=>g.ip===e.payload.dac.ip&&g.channel===p.serviceID)||o.push({...u(e.payload.dac),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=e.payload.dac.channel;p!==void 0&&!l.some(g=>g.ip===e.payload.dac.ip&&g.channel===p)&&o.push({...u(e.payload.dac),channel:p,mirrorX:!1,mirrorY:!1})}if(o.length===0)return n;const h={...s,assignedDacs:[...l,...o]};return a[e.payload.layerIndex][e.payload.colIndex]=h,{...n,clipContents:a}}case"SET_LAYER_DAC":{const{layerIndex:a,dac:s}=e.payload,l=[...n.layerAssignedDacs],o=l[a]||[];let u=[];const h=p=>{const{channels:g,allChannels:b,...C}=p;return C};if(s.allChannels&&s.channels)s.channels.forEach(p=>{o.some(g=>g.ip===s.ip&&g.channel===p.serviceID)||u.push({...h(s),channel:p.serviceID,mirrorX:!1,mirrorY:!1})});else{const p=s.channel;p!==void 0&&!o.some(g=>g.ip===s.ip&&g.channel===p)&&u.push({...h(s),channel:p,mirrorX:!1,mirrorY:!1})}return u.length===0?n:(l[a]=[...o,...u],{...n,layerAssignedDacs:l})}case"TOGGLE_CLIP_DAC_MIRROR":{const{layerIndex:a,colIndex:s,dacIndex:l,axis:o}=e.payload,u=[...n.clipContents];u[a]=[...u[a]];const h={...u[a][s]};if(h&&h.assignedDacs){const p=[...h.assignedDacs],g={...p[l]};return o==="x"&&(g.mirrorX=!g.mirrorX),o==="y"&&(g.mirrorY=!g.mirrorY),p[l]=g,h.assignedDacs=p,u[a][s]=h,{...n,clipContents:u}}return n}case"REMOVE_CLIP_DAC":{const a=[...n.clipContents];a[e.payload.layerIndex]=[...a[e.payload.layerIndex]];const{layerIndex:s,colIndex:l,dacIndex:o}=e.payload,u=a[s][l];if(u&&u.assignedDacs){const h=[...u.assignedDacs];return h.splice(o,1),a[e.payload.layerIndex][e.payload.colIndex]={...u,assignedDacs:h},{...n,clipContents:a}}return n}case"TOGGLE_LAYER_DAC_MIRROR":{const{layerIndex:a,dacIndex:s,axis:l}=e.payload,o=[...n.layerAssignedDacs],u=o[a]?[...o[a]]:[];if(u[s]){const h={...u[s]};return l==="x"&&(h.mirrorX=!h.mirrorX),l==="y"&&(h.mirrorY=!h.mirrorY),u[s]=h,o[a]=u,{...n,layerAssignedDacs:o}}return n}case"REMOVE_LAYER_DAC":{const{layerIndex:a,dacIndex:s}=e.payload,l=[...n.layerAssignedDacs];if(l[a]){const o=[...l[a]];return o.splice(s,1),l[a]=o,{...n,layerAssignedDacs:l}}return n}case"SET_CLIP_AUDIO":{const a=[...n.clipContents],{layerIndex:s,colIndex:l,audioFile:o}=e.payload;a[s]=[...a[s]];const u=a[s][l];return u?(a[s][l]={...u,audioFile:o,audioVolume:u.audioVolume!==void 0?u.audioVolume:1},{...n,clipContents:a}):n}case"SET_CLIP_AUDIO_VOLUME":{const a=[...n.clipContents],{layerIndex:s,colIndex:l,volume:o}=e.payload;a[s]=[...a[s]];const u=a[s][l];return u?(a[s][l]={...u,audioVolume:o},{...n,clipContents:a}):n}case"REMOVE_CLIP_AUDIO":{const a=[...n.clipContents],{layerIndex:s,colIndex:l}=e.payload;a[s]=[...a[s]];const o=a[s][l];return o?(a[s][l]={...o,audioFile:null},{...n,clipContents:a}):n}case"SET_CLIP_PARSING_STATUS":{const{layerIndex:a,colIndex:s,status:l}=e.payload,o=[...n.clipContents];if(o[a]){o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,parsing:l},{...n,clipContents:o}}return n}case"SET_BULK_PARSING_STATUS":{const a=[...n.clipContents];return new Set(e.payload.map(l=>l.layerIndex)).forEach(l=>{a[l]&&(a[l]=[...a[l]])}),e.payload.forEach(({layerIndex:l,colIndex:o,status:u})=>{if(a[l]){const h=a[l][o]||{};a[l][o]={...h,parsing:u}}}),{...n,clipContents:a}}case"SET_THUMBNAIL_RENDER_MODE":return{...n,thumbnailRenderMode:e.payload};case"SET_CLIP_TRIGGER_STYLE":{const{layerIndex:a,colIndex:s,style:l}=e.payload,o=[...n.clipContents];o[a]=[...o[a]];const u=o[a][s]||{};return o[a][s]={...u,triggerStyle:l},{...n,clipContents:o}}case"SET_THEME":return{...n,theme:e.payload};case"UPDATE_THUMBNAIL":{const{layerIndex:a,colIndex:s,frameIndex:l}=e.payload,o=[...n.thumbnailFrameIndexes];return o[a]=[...o[a]],o[a][s]=l,{...n,thumbnailFrameIndexes:o}}case"RESET_STATE":return Jg({});case"LOAD_PROJECT":{const a={...n,...e.payload};return a.clipContents=io(a.clipContents,5,8,()=>({parsing:!1})),a.clipNames=io(a.clipNames,5,8,(s,l)=>`Clip ${s+1}-${l+1}`),a.clipContents=a.clipContents.map(s=>s.map(l=>l&&l.type==="ilda"?{...l,workerId:null,parsing:!1}:l)),a.activeClipIndexes=Array(n.layers.length).fill(null),a.selectedLayerIndex=null,a.selectedColIndex=null,a.selectedIldaWorkerId=null,a.selectedIldaTotalFrames=0,a.selectedGeneratorId=null,a.selectedGeneratorParams={},a.projectLoadTimestamp=Date.now(),a}case"LOAD_SETTINGS":return{...n,showBeamEffect:e.payload.renderSettings?.showBeamEffect??n.showBeamEffect,beamAlpha:e.payload.renderSettings?.beamAlpha??n.beamAlpha,fadeAlpha:e.payload.renderSettings?.fadeAlpha??n.fadeAlpha,playbackFps:e.payload.renderSettings?.playbackFps??n.playbackFps,previewScanRate:e.payload.renderSettings?.previewScanRate??n.previewScanRate,beamRenderMode:e.payload.renderSettings?.beamRenderMode??n.beamRenderMode,theme:e.payload.theme??n.theme,thumbnailRenderMode:e.payload.thumbnailRenderMode??n.thumbnailRenderMode,selectedDac:e.payload.selectedDac??n.selectedDac,clipNames:e.payload.clipNames?io(e.payload.clipNames,5,8,(a,s)=>`Clip ${a+1}-${s+1}`):n.clipNames,dacOutputSettings:e.payload.dacOutputSettings??n.dacOutputSettings};case"ASSIGN_QUICK_CONTROL":{const{type:a,index:s,link:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons";return o[u][s]={...o[u][s],label:l.paramName||l.paramId,link:l,min:l.min,max:l.max,step:l.step},{...n,quickAssigns:o}}case"CLEAR_QUICK_CONTROL":{const{type:a,index:s}=e.payload,l={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},o=a==="knob"?"knobs":"buttons";return l[o][s]={value:a==="knob"?0:!1,label:null,link:null},{...n,quickAssigns:l}}case"UPDATE_QUICK_CONTROL":{const{type:a,index:s,value:l}=e.payload,o={knobs:[...n.quickAssigns.knobs],buttons:[...n.quickAssigns.buttons]},u=a==="knob"?"knobs":"buttons",h=o[u][s];o[u][s]={...h,value:l};let p={...n,quickAssigns:o};if(h.link){const{layerIndex:g,colIndex:b,effectIndex:C,targetType:w}=h.link,x=h.link.paramName||h.link.paramId;let M=l;if(a==="knob"&&h.min!==void 0&&h.max!==void 0&&(M=h.min+l*(h.max-h.min),h.step&&(M=Math.round(M/h.step)*h.step),M=parseFloat(M.toFixed(5))),console.log(`Updating ${w} param ${x} to ${M} (Link: L${g} C${b} E${C})`),w==="layerEffect"){const R=[...p.layerEffects];if(R[g]&&(R[g]=[...R[g]],R[g][C])){const I={...R[g][C]};I.params={...I.params,[x]:M},R[g][C]=I,p={...p,layerEffects:R}}}else if(w==="global")x==="master_intensity"?p={...p,masterIntensity:M}:x==="master_speed"&&(p={...p,playbackFps:M});else{const R=[...p.clipContents];if(R[g]){R[g]=[...R[g]];const I=R[g][b];if(I)if(w==="effect"&&I.effects&&I.effects[C]){const H=[...I.effects],B={...H[C]};B.params={...B.params,[x]:M},H[C]=B,R[g][b]={...I,effects:H}}else w==="generator"&&(R[g][b]={...I,currentParams:{...I.currentParams,[x]:M}});p.clipContents=R}}}return p}case"TOGGLE_QUICK_BUTTON":{const{index:a}=e.payload,l=!n.quickAssigns.buttons[a].value,o={...n.quickAssigns,buttons:[...n.quickAssigns.buttons]};o.buttons[a]={...o.buttons[a],value:l};let u={...n,quickAssigns:o};const h=o.buttons[a];if(h.link){const{layerIndex:p,colIndex:g,effectIndex:b,targetType:C}=h.link,w=h.link.paramName||h.link.paramId;if(C==="global")w==="blackout"?u.globalBlackout=l:w==="laser_output"&&(u.isWorldOutputActive=l);else if(C==="layer"){if(w==="blackout"){const x=[...u.layerBlackouts];x[p]=l,u={...u,layerBlackouts:x}}else if(w==="solo"){const x=[...u.layerSolos];l?(x.fill(!1),x[p]=!0):x[p]=!1,u={...u,layerSolos:x}}else if(w==="clear"){if(l){const x=[...u.activeClipIndexes];x[p]=null,u={...u,activeClipIndexes:x},o.buttons[a].value=!1,u.quickAssigns=o}}else if(w==="autopilot"){const x=[...u.layerAutopilots];x[p]=l?"forward":"off",u={...u,layerAutopilots:x}}}else if(C==="layerEffect"){const x=[...u.layerEffects];if(x[p]&&(x[p]=[...x[p]],x[p][b])){const M={...x[p][b]};M.params={...M.params,[w]:l},x[p][b]=M,u={...u,layerEffects:x}}}else{const x=[...u.clipContents];if(x[p]){x[p]=[...x[p]];const M=x[p][g];if(M)if(C==="effect"&&M.effects&&M.effects[b]){const R=[...M.effects],I={...R[b]};I.params={...I.params,[w]:l},R[b]=I,x[p][g]={...M,effects:R}}else C==="generator"&&(x[p][g]={...M,currentParams:{...M.currentParams,[w]:l}});u.clipContents=x}}}return u}case"UPDATE_CLIP_FILE_PATH":{const{oldPath:a,newPath:s}=e.payload;console.log(`Reducer: Updating clip path from ${a} to ${s}`);const l=n.clipContents.map(o=>o.map(u=>{let h=u;return u&&u.filePath===a&&(h={...h,filePath:s,parsingFailed:!1}),u&&u.audioFile&&u.audioFile.path===a&&(h={...h,audioFile:{...u.audioFile,path:s}}),h}));return{...n,clipContents:l}}case"SET_CLIP_PARSING_FAILED":{const{layerIndex:a,colIndex:s,failed:l}=e.payload,o=[...n.clipContents];if(o[a]){o[a]=[...o[a]];const u=o[a][s];u&&(o[a][s]={...u,parsingFailed:l})}return{...n,clipContents:o}}default:return n}}const Ec={orange:{full:60,dim:10},yellow:{full:74,dim:15},cyan:{full:36,dim:35},"light-blue":{full:41,dim:43},blue:{full:45,dim:47},magenta:{full:53,dim:55},red:{full:5,dim:7},green:{full:21,dim:23},white:{full:3,dim:1}},Tw=({isPlaying:n,globalBlackout:e,layerBlackouts:a,layerSolos:s,isWorldOutputActive:l,clipContents:o,activeClipIndexes:u,theme:h,bpm:p,quickAssigns:g})=>{const{sendFeedback:b,mappings:C,selectedMidiInputId:w,midiInitialized:x}=Ic();return N.useEffect(()=>{if(!w||!x||!n){x&&w&&Ac(w,"F#6",0,1);return}let M=!1;const R=6e4/(p||120),I=setInterval(()=>{M=!M,Ac(w,"F#6",M?127:0,1)},R/2);return()=>{clearInterval(I),Ac(w,"F#6",0,1)}},[n,p,w,x]),N.useEffect(()=>{b("transport_play",n),b("transport_stop",!n)},[n,b]),N.useEffect(()=>{b("comp_blackout",e)},[e,b]),N.useEffect(()=>{b("laser_output",l)},[l,b]),N.useEffect(()=>{a.forEach((M,R)=>{b(`layer_${R}_blackout`,M)})},[a,b]),N.useEffect(()=>{s.forEach((M,R)=>{b(`layer_${R}_solo`,M)})},[s,b]),N.useEffect(()=>{if(!o||!u)return;const M=Ec[h]||Ec.orange;o.forEach((R,I)=>{R.forEach((H,B)=>{const D=`clip_${I}_${B}`;if(C[D]){const j=u[I]===B,_=H!==null&&(H.type==="ilda"||H.type==="generator"),G=H?.triggerStyle||"normal";let Y=0,J=null;j?(Y=M.full,G==="toggle"&&(J=10)):_&&(Y=M.dim),b(D,Y,J)}})})},[o,u,h,C,b]),N.useEffect(()=>{if(!g)return;const M=Ec[h]||Ec.orange;g.buttons.forEach((R,I)=>{b(`quick_btn_${I}`,R.value?M.full:0)})},[g,h,b]),null},Hf=async(n,e,a,s,l=!0)=>{if(!n||!n.points)return null;let o=n;if(l)try{const H=ld(n.points);o={...n,points:H,isTypedArray:!0}}catch(H){console.warn("Failed to optimize points for thumbnail:",H)}let u=o;try{e&&e.length>0&&(u=lo(o,e,{progress:0,time:0,effectStates:{},assignedDacs:[]}))}catch(H){console.warn("Failed to apply effects for thumbnail:",H)}const h=128,p=128,g=document.createElement("canvas");g.width=h,g.height=p;const b=g.getContext("2d");b.fillStyle="#000000",b.fillRect(0,0,h,p);const C=u.points,w=u.isTypedArray||C instanceof Float32Array,x=w?C.length/8:C.length;b.lineWidth=1.5,b.lineCap="round";let M=null,R=null,I=!0;for(let H=0;H<x;H++){let B,D,j,_,G,Y;if(w){const re=H*8;B=C[re],D=C[re+1],j=C[re+3],_=C[re+4],G=C[re+5],Y=C[re+6]>.5}else{const re=C[H];B=re.x,D=re.y,j=re.r,_=re.g,G=re.b,Y=!!re.blanking}const J=(B+1)*.5*h,ae=(1-(D+1)*.5)*p;if(!Y&&!I&&M!==null){b.beginPath(),b.moveTo(M,R),b.lineTo(J,ae);const re=Math.floor(Math.max(0,Math.min(255,j))),O=Math.floor(Math.max(0,Math.min(255,_))),W=Math.floor(Math.max(0,Math.min(255,G)));b.strokeStyle=`rgb(${re},${O},${W})`,b.stroke()}M=J,R=ae,I=Y}try{const B=await(await new Promise(D=>g.toBlob(D,"image/png"))).arrayBuffer();if(window.electronAPI&&window.electronAPI.saveThumbnail){const D=`thumb_L${a}_C${s}.png`;return await window.electronAPI.saveThumbnail(B,D)}}catch(H){console.error("Error generating/saving thumbnail:",H)}return null},Fm=Yn.memo(({type:n,previewFrameCountRef:e,totalPointsSentRef:a,activeChannelsCountRef:s,lastStatUpdateTimeRef:l})=>{const[o,u]=N.useState({cpu:"0.0",ram:"0",fps:0,pps:0,avgPps:0});return N.useEffect(()=>{const h=window.electronAPI?.onSystemStats(g=>{u(b=>({...b,...g}))});let p;return n==="performance"&&l&&e&&a&&s&&(p=setInterval(()=>{const g=performance.now(),b=(g-(l.current||0))/1e3;if(b>0){const C=Math.round((e.current||0)/b),w=Math.round((a.current||0)/b),x=(s.current||0)>0?Math.round(w/s.current):0;u(M=>({...M,fps:C,pps:w,avgPps:x})),e.current=0,a.current=0,l.current=g}},1e3)),()=>{h&&h(),p&&clearInterval(p)}},[n,e,a,s,l]),n==="system"?f.jsxs("div",{className:"systemStats",children:[f.jsxs("p",{className:"sysStats",children:["CPU: ",o.cpu,"%"]}),f.jsxs("p",{className:"sysStats",children:["RAM: ",o.ram,"MB"]})]}):f.jsxs("div",{className:"performanceStats",children:[f.jsxs("p",{className:"perfStats",children:["FPS: ",o.fps]}),f.jsxs("p",{className:"perfStats",children:["AnimPPS: ",o.avgPps," (Avg)"]})]})}),Cw=Yn.memo(({playbackFps:n,previewScanRate:e,previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})=>f.jsxs("div",{className:"system-monitor-grid",children:[f.jsx(Fm,{type:"performance",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o}),f.jsx(Fm,{type:"system",previewFrameCountRef:a,totalPointsSentRef:s,activeChannelsCountRef:l,lastStatUpdateTimeRef:o})]})),Mw=Yn.memo(({clipContents:n,activeClipIndexes:e,layerEffects:a,bpm:s,playbackFps:l,selectedLayerIndex:o,selectedColIndex:u,liveFramesRef:h,progressRef:p,selectedDac:g,liveDacOutputSettingsRef:b,dacOutputSettings:C,getAudioInfo:w,fftLevels:x,getFftLevels:M,effectStatesRef:R,clipActivationTimesRef:I,showBeamEffect:H,beamAlpha:B,fadeAlpha:D,previewScanRate:j,beamRenderMode:_,worldShowBeamEffect:G,worldBeamRenderMode:Y,masterIntensity:J,layerIntensities:ae,globalBlackout:re,layerSolos:O,layerBlackouts:W,handleToggleBeamEffect:K,handleCycleDisplayMode:Z,previewFrameCountRef:ee,totalPointsSentRef:V,activeChannelsCountRef:te,lastStatUpdateTimeRef:ce,liveClipContentsRef:xe,optimizationEnabled:$})=>{const[Q,ve]=N.useState(0),Re=N.useRef(0),Ue=N.useRef(performance.now()),we=1e3/70;N.useEffect(()=>{let je;const Ve=Le=>{Le-Re.current>we&&(ee.current++,Ue.current=performance.now(),ve(rt=>rt+1),Re.current=Le),je=requestAnimationFrame(Ve)};return je=requestAnimationFrame(Ve),()=>cancelAnimationFrame(je)},[we,ee]);const Me=xe?.current||n,ze=o!==null&&u!==null?Me[o][u]:null,Xe=u!==null?ze?.type==="ilda"?ze?.workerId:`generator-${o}-${u}`:o!==null&&e[o]!==null?Me[o][e[o]]?.type==="ilda"?Me[o][e[o]]?.workerId:`generator-${o}-${e[o]}`:null,ot=Xe?h.current[Xe]:null,At=Xe&&p.current[Xe]||0;let Ct=[],on=1;if(o!==null){const je=a[o]||[];if(u!==null)Ct=[...ze?.effects||[],...je];else{const rt=e[o];rt!==null?Ct=[...Me[o][rt]?.effects||[],...je]:Ct=je}const Ve=O.some(rt=>rt);let Le=ae[o];re?Le=0:Ve?Le=O[o]?W[o]?0:Le:0:W[o]&&(Le=0),on=Le*J}const Qt=N.useMemo(()=>{const je={};return e.forEach((Ve,Le)=>{if(Ve!==null){const rt=Me[Le][Ve];if(rt){let Wt=rt.type==="ilda"?rt.workerId:`generator-${Le}-${Ve}`;Wt&&h.current[Wt]&&(je[Wt]={frame:h.current[Wt],effects:[...rt.effects||[],...a[Le]||[]],layerIndex:Le,syncSettings:rt.syncSettings||{},bpm:s,clipDuration:(()=>{const pn=rt.playbackSettings||{};return pn.mode==="timeline"?pn.duration||1:pn.mode==="bpm"?(pn.beats||8)*60/(s||120):(rt.totalFrames||30)/(rt.fps||l||30)})(),progress:p.current[Wt]||0,effectStates:R.current,clipActivationTime:I.current[Le]||0})}}}),je},[e,Me,Q,s,a,l,h,p,R,I]),cn=N.useMemo(()=>{const je=O.some(Ve=>Ve);return ae.map((Ve,Le)=>re?0:je?O[Le]?W[Le]?0:Ve:0:W[Le]?0:Ve)},[ae,W,O,re]);return f.jsxs("div",{className:"side-panel",children:[f.jsx(Rv,{frame:ot,effects:Ct,showBeamEffect:H,beamAlpha:B,fadeAlpha:D,previewScanRate:j,beamRenderMode:_,intensity:on,syncSettings:ze?.syncSettings,bpm:s,clipDuration:(()=>{const je=ze?.playbackSettings||{};return je.mode==="timeline"?je.duration||1:je.mode==="bpm"?(je.beats||8)*60/(s||120):(ze?.totalFrames||30)/(ze?.fps||l||30)})(),progress:At,previewTime:Ue.current,fftLevels:M?M():x,effectStates:R.current,clipActivationTime:o!==null&&I.current[o]||0,optimizationEnabled:$,onToggleBeamEffect:()=>K("clip"),onCycleDisplayMode:()=>Z("clip")}),f.jsx(Dv,{activeFrames:Qt,showBeamEffect:G,beamAlpha:B,fadeAlpha:D,previewScanRate:j,beamRenderMode:Y,layerIntensities:cn,masterIntensity:J,dacSettings:g?b.current?b.current[`${g.ip}:${g.channel}`]:C[`${g.ip}:${g.channel}`]:null,previewTime:Ue.current,fftLevels:M?M():x,optimizationEnabled:$,onToggleBeamEffect:()=>K("world"),onCycleDisplayMode:()=>Z("world")})]})});function Nw(){const n=$v(),e=Xm(),a=Qv(),{fftLevels:s,getFftLevels:l,fftDataRef:o,timeDataRef:u}=po()||{},{devices:h,selectedDeviceId:p,setSelectedDeviceId:g,playAudio:b,stopAudio:C,pauseAllAudio:w,resumeAllAudio:x,setPlaybackRate:M,resetAllAudio:R,stopAllAudio:I,getAudioInfo:H,setClipVolume:B}=ng();N.useRef(new Set),N.useRef(0);const D=N.useRef({}),j=N.useRef(new Map),_=N.useRef({}),G=N.useRef({}),Y=N.useRef({}),J=N.useRef({}),[ae,re]=N.useState(null),[O,W]=N.useState(!1),[K,Z]=N.useState("main"),[ee,V]=N.useState(!1),[te,ce]=N.useState(!1),[xe,$]=N.useState({midi:!1,artnet:!1,osc:!1,keyboard:!1}),[Q,ve]=N.useState(!1),[Re,Ue]=N.useState(!1),[we,Me]=N.useState(!1),[ze,Xe]=N.useState(!1),[ot,At]=N.useState({title:"",initialValue:"",onSave:()=>{}}),[Ct,on]=N.useState("files"),[Qt,cn]=N.useState("clip"),[je,Ve]=N.useState([]),Le=N.useRef(0),rt=N.useRef(0),Wt=N.useRef(0),pn=N.useRef(performance.now()),[ke,Se]=N.useReducer(Aw,Jg(O?ae:{})),Kt=N.useRef(new Map),zt=N.useCallback((v,S,A=30)=>{Kt.current.has(v)&&clearTimeout(Kt.current.get(v));const E=setTimeout(()=>{Se(S),Kt.current.delete(v)},A);Kt.current.set(v,E)},[]),{columns:On,layers:Gt,clipContents:Ke,clipNames:qn,thumbnailFrameIndexes:Xt,layerEffects:tr,layerAssignedDacs:nr,layerIntensities:zr,layerAutopilots:wn,layerBlackouts:va,layerSolos:hn,masterIntensity:ar,globalBlackout:En,selectedLayerIndex:Ze,selectedColIndex:ct,notification:ds,dacs:Vn,selectedDac:In,ildaFrames:Gr,selectedIldaWorkerId:ja,selectedIldaTotalFrames:Hr,showBeamEffect:ca,beamAlpha:ua,fadeAlpha:ba,playbackFps:ta,previewScanRate:mn,beamRenderMode:kt,worldShowBeamEffect:gn,worldBeamRenderMode:Xn,optimizationEnabled:na,activeClipIndexes:et,isPlaying:xa,isWorldOutputActive:Mn,selectedGeneratorId:rr,selectedGeneratorParams:Qs,thumbnailRenderMode:Sa,theme:Ln,dacOutputSettings:Et}=ke,Nn=N.useMemo(()=>Gt.map((v,S)=>{const A=et[S];if(A!==null){const E=Ke[S][A];if(E){let T,L=null;if(E.type==="ilda"&&E.workerId&&E.totalFrames)return T=E.workerId,L=E.stillFrame,{type:"ilda",workerId:T,totalFrames:E.totalFrames,effects:E.effects||[],dac:E.dac||null,assignedDacs:E.assignedDacs||[],ildaFormat:E.ildaFormat||0,stillFrame:L,layerIndex:S,syncSettings:E.syncSettings||{},fps:E.fps||null};if(E.type==="generator"&&E.frames&&E.generatorDefinition)return T=`generator-${S}-${A}`,L=E.stillFrame||E.frames?.[0]||null,{type:"generator",workerId:T,totalFrames:E.frames.length,effects:E.effects||[],dac:E.dac||null,assignedDacs:E.assignedDacs||[],ildaFormat:0,stillFrame:L,layerIndex:S,syncSettings:E.syncSettings||{},fps:E.fps||null}}}return null}).filter(Boolean),[Gt,et,Ke]),ut=N.useRef(Ke),Qe=N.useRef(null),Pe=N.useRef(!1),nt=N.useRef(null),fa=N.useRef(!1);N.useEffect(()=>{Ke&&(Qe.current=structuredClone(Ke))},[]),N.useEffect(()=>{Et&&(nt.current=structuredClone(Et))},[]);const ps=N.useRef(zr),Yr=N.useRef(wn),Lt=N.useRef(tr),Un=N.useRef(ar),wa=N.useRef(va),da=N.useRef(hn),$n=N.useRef(En),jn=N.useRef(xa),qr=N.useRef(Mn),Wn=N.useRef(In),pa=N.useRef(ke.bpm),Ut=N.useRef(Ze),Bn=N.useRef(ct),Ba=N.useRef(null),An=N.useRef(H),Fa=N.useRef(na);N.useEffect(()=>{jn.current=xa},[xa]),N.useEffect(()=>{qr.current=Mn},[Mn]),N.useEffect(()=>{Wn.current=In},[In]),N.useEffect(()=>{pa.current=ke.bpm},[ke.bpm]),N.useEffect(()=>{Ut.current=Ze},[Ze]),N.useEffect(()=>{Bn.current=ct},[ct]),N.useEffect(()=>{An.current=H},[H]),N.useEffect(()=>{Fa.current=na},[na]);const Er=N.useRef(ta);N.useEffect(()=>{Er.current=ta},[ta]);const sr=N.useRef(Et),Ks=N.useRef(Vn),Ar=N.useRef([]),ir=N.useRef(et),Fn=N.useRef(nr),Pa=N.useRef(qn),hs=N.useRef(ja),Vr=N.useRef(Hr),lr=N.useRef({}),Tr=N.useRef(new Map),ms=N.useRef(new Map),za=N.useRef(new Map),or=N.useRef(null),Ga=N.useRef({}),Ha=N.useRef(null),aa=N.useRef(0),Ai=N.useRef(new Map),gs=N.useRef(new Map),cr=N.useRef(new Map);N.useRef(performance.now()),N.useEffect(()=>{if(Pe.current){Pe.current=!1;return}Ke&&(Qe.current=structuredClone(Ke))},[Ke]),N.useEffect(()=>{if(fa.current){fa.current=!1;return}Et&&(nt.current=structuredClone(Et))},[Et]),N.useEffect(()=>{ps.current=zr,Yr.current=wn,Lt.current=tr,Un.current=ar,wa.current=va,da.current=hn,$n.current=En,Er.current=ta,Ks.current=Vn,Ar.current=Nn,ut.current=Ke,ir.current=et,Fn.current=nr,Pa.current=qn,hs.current=ja,Vr.current=Hr},[zr,nr,wn,tr,ar,va,hn,En,Et,Vn,Nn,Ke,et,qn,ja,Hr]);const Js=N.useCallback(v=>{const S=1-v*2,A=[],E=100;for(let T=0;T<E;T++){const L=T/(E-1)*2-1;A.push({x:L,y:S,r:0,g:255,b:0,blanking:!1})}return{points:A,isTypedArray:!1}},[]),ys=N.useCallback((v,S)=>{nt.current&&(nt.current[v]=S,fa.current=!0),Se({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:v,settings:S}})},[]),ur=N.useCallback(v=>{Se({type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:v}})},[]);N.useEffect(()=>{const v=ta/60;M(v)},[ta,M]);const qt=v=>{Se({type:"SET_NOTIFICATION",payload:{message:v,visible:!0}}),setTimeout(()=>{Se({type:"SET_NOTIFICATION",payload:{message:"",visible:!1}})},3e3)};N.useEffect(()=>{const v={orange:"#ff5e00",yellow:"#ffd400",cyan:"#00fff3","light-blue":"#0089ff",blue:"#005aff",magenta:"#fb00ff",red:"#ff0000",green:"#00ff00",white:"#ffffff"},S=v[Ln]||v.orange;document.documentElement.style.setProperty("--theme-color",S);const A=parseInt(S.slice(1,3),16),E=parseInt(S.slice(3,5),16),T=parseInt(S.slice(5,7),16);document.documentElement.style.setProperty("--theme-color-transparent",`rgba(${A}, ${E}, ${T}, 0.3)`),window.electronAPI&&window.electronAPI.setTheme&&window.electronAPI.setTheme(Ln)},[Ln]),N.useEffect(()=>{window.electronAPI&&window.electronAPI.setSelectedDac&&window.electronAPI.setSelectedDac(In)},[In]),N.useMemo(()=>{const v=new Set;return ja&&v.add(ja),Nn.forEach(S=>{S&&S.type==="ilda"&&S.workerId&&v.add(S.workerId)}),Array.from(v)},[ja,Nn]),N.useEffect(()=>{if(!n)return;const v=async q=>{if(!q.data.browserFile){if(q.data.type==="get-frame"&&q.data.success)if(q.data.isStillFrame){const{workerId:ie,frame:le,layerIndex:oe,colIndex:ge}=q.data;if(oe===void 0||ge===void 0)return;let fe=null;const Ae=(Qe.current?Qe.current:ut.current)?.[oe]?.[ge],De=Ae?.effects||[];let Ie=null;const Ge=Ae?.assignedDacs||[];if(Ge.length>0){const it=Ge[0],ht=`${it.ip}:${it.channel}`;Ie=sr.current[ht]}else if(In){const it=`${In.ip}:${In.channel}`;Ie=sr.current[it]}let ft=le;Ie&&(ft=Vf(le,Ie)),fe=await Hf(ft,De,oe,ge,na),Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:oe,colIndex:ge,content:{stillFrame:le,parsing:!1,thumbnailPath:fe,thumbnailVersion:Date.now()}}})}else D.current[q.data.workerId]=q.data.frame;else if(q.data.type==="parse-ilda"&&q.data.success){const{workerId:ie,totalFrames:le,ildaFormat:oe,fileName:ge,filePath:fe,layerIndex:be,colIndex:Ae}=q.data;if(be===void 0||Ae===void 0)return;const De={type:"ilda",workerId:ie,totalFrames:le,ildaFormat:oe,fileName:ge,filePath:fe,parsing:!0,playbackSettings:{mode:"fps",duration:le/60,beats:8,speedMultiplier:1}};Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:be,colIndex:Ae,content:De}});const Ie=Pa.current[be][Ae],Ge=`Clip ${be+1}-${Ae+1}`;Ie===Ge&&Se({type:"SET_CLIP_NAME",payload:{layerIndex:be,colIndex:Ae,name:ge}})}else if(q.data.type==="get-all-frames"&&q.data.success){console.log("Received get-all-frames response:",q.data);const{frames:ie,workerId:le,layerIndex:oe,colIndex:ge}=q.data;if(oe===void 0||ge===void 0)return;U0(async()=>{const{framesToIlda:fe}=await Promise.resolve().then(()=>$0);return{framesToIlda:fe}},void 0,import.meta.url).then(({framesToIlda:fe})=>{const be=fe(ie),De=ut.current[oe][ge].fileName||"export.ild";window.electronAPI&&window.electronAPI.saveIldaFile&&window.electronAPI.saveIldaFile(be,De).then(Ie=>{Ie.success?qt(`Exported to ${Ie.filePath}`):Ie.error&&qt(`Export failed: ${Ie.error}`)})}).catch(fe=>console.error("Failed to load ilda-writer in response:",fe))}else if(q.data.success===!1){qt(`Worker error: ${q.data.error}`);const{layerIndex:ie,colIndex:le}=q.data;ie!==void 0&&le!==void 0&&Se({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:ie,colIndex:le,status:!1}})}}};n.addEventListener("message",v);let S,A,E=0;const T=60,L=1e3/T,P=q=>{if(q.length===0)return null;if(q.length===1){const ge=q[0],fe=ge.points instanceof Float32Array||ge.isTypedArray;return{...ge,points:fe?new Float32Array(ge.points):ge.points.map(be=>({...be})),isTypedArray:fe}}let ie=0;q.forEach((ge,fe)=>{const Ae=ge.points instanceof Float32Array||ge.isTypedArray?ge.points.length/8:ge.points.length;ie+=Ae,fe<q.length-1&&(ie+=2)});const le=new Float32Array(ie*8);let oe=0;return q.forEach((ge,fe)=>{const be=ge.points instanceof Float32Array||ge.isTypedArray,Ae=be?ge.points.length/8:ge.points.length;for(let De=0;De<Ae;De++){const Ie=(oe+De)*8;if(be){const Ge=De*8;le.set(ge.points.subarray(Ge,Ge+8),Ie)}else{const Ge=ge.points[De];le[Ie]=Ge.x,le[Ie+1]=Ge.y,le[Ie+2]=Ge.z||0,le[Ie+3]=Ge.r,le[Ie+4]=Ge.g,le[Ie+5]=Ge.b,le[Ie+6]=Ge.blanking?1:0,le[Ie+7]=Ge.lastPoint?1:0}le[Ie+7]=0}if(oe+=Ae,fe<q.length-1){const De=q[fe+1],Ie=De.points instanceof Float32Array||De.isTypedArray,Ge=le[(oe-1)*8],ft=le[(oe-1)*8+1];let it,ht;Ie?(it=De.points[0],ht=De.points[1]):(it=De.points[0].x,ht=De.points[0].y);let xt=oe*8;le[xt]=Ge,le[xt+1]=ft,le[xt+6]=1,le[xt+3]=0,le[xt+4]=0,le[xt+5]=0;let $e=(oe+1)*8;le[$e]=it,le[$e+1]=ht,le[$e+6]=1,le[$e+3]=0,le[$e+4]=0,le[$e+5]=0,oe+=2}}),le[(ie-1)*8+7]=1,{points:le,isTypedArray:!0}},z=q=>{if(!qr.current){cancelAnimationFrame(A);return}if(q-E>L){if(window.electronAPI&&qr.current){const ie=new Map;Ar.current.forEach(oe=>{if(oe&&D.current[oe.workerId]){const ge=Fn.current[oe.layerIndex]||[],fe=oe.assignedDacs||[];let be=[...ge,...fe];be.length===0&&Wn.current&&(be=[Wn.current]);const Ae=[],De=new Set;if(be.forEach(dt=>{const Ca=dt.channel!==void 0?dt.channel:dt.channels&&dt.channels.length>0?dt.channels[0].serviceID:0,Qn=`${dt.ip}:${Ca}`;De.has(Qn)||(De.add(Qn),Ae.push({...dt,channel:Ca}))}),Ae.length===0)return;const Ge=(Qe.current||ut.current)[oe.layerIndex][ir.current[oe.layerIndex]],ft=Ge?Ge.effects||[]:oe.effects||[],it=oe.layerIndex,ht=Lt.current[it]||[],xt=[...ft,...ht],$e=D.current[oe.workerId],ra=ps.current[oe.layerIndex],Ht=$n.current,Rt=wa.current[oe.layerIndex],Mt=da.current[oe.layerIndex],St=da.current.some(dt=>dt);let Jt=ra;Ht?Jt=0:St?Mt?Rt&&(Jt=0):Jt=0:Rt&&(Jt=0);const Dt=Jt*Un.current;if(Dt<=0)return;const mt=_.current[oe.workerId]||0;oe.syncSettings;const _t={...$e,points:F($e.points)?$e.points:$e.points.map(dt=>({...dt,r:Math.round(dt.r*Dt),g:Math.round(dt.g*Dt),b:Math.round(dt.b*Dt)}))};if(F(_t.points)){const dt=_t.points,Ca=dt.length/8,Qn=new Float32Array(dt);for(let Ma=0;Ma<Ca;Ma++)Qn[Ma*8+3]*=Dt,Qn[Ma*8+4]*=Dt,Qn[Ma*8+5]*=Dt;_t.points=Qn}const nn=Ge?Ge.playbackSettings:oe.playbackSettings||{};let Xa=1;if(nn.mode==="timeline")Xa=nn.duration||1;else if(nn.mode==="bpm"){const dt=pa.current||120;Xa=(nn.beats||8)*60/dt}else{const dt=nn.fps||oe.fps||Er.current||30;Xa=(oe.totalFrames||30)/dt}const dr=nn.speedMultiplier||1;dr!==0&&(Xa/=dr);const an=lo(_t,xt,{progress:mt,time:q,effectStates:j.current,assignedDacs:Ae,syncSettings:oe.syncSettings||{},bpm:pa.current,clipDuration:Xa,fftLevels:l?l():s});if(Fa.current){const dt=ld(an.points);an.points=dt,an.isTypedArray=!0}Ae.forEach((dt,Ca)=>{const Qn=dt.ip,Ma=dt.channel||(dt.channels&&dt.channels.length>0?dt.channels[0].serviceID:0);if(Ma!==void 0){const hl=`${Qn}:${Ma}`;ie.has(hl)||ie.set(hl,{ip:Qn,channel:Ma,type:dt.type,frames:[]});let Wr=an;if(an.points&&an.points._channelDistributions){const pr=an.points._channelDistributions.get(Ca);if(pr){const ni=an.points.subarray(pr.start,pr.start+pr.length);Wr={...an,points:ni}}else Wr={...an,points:new Float32Array(0)}}if(dt.mirrorX||dt.mirrorY){const pr=Wr.points,ni=Wr.isTypedArray,sa=ni?pr.length/8:pr.length,ia=ni?new Float32Array(pr):pr.map(la=>({...la}));for(let la=0;la<sa;la++)ni?(dt.mirrorX&&(ia[la*8]=-ia[la*8]),dt.mirrorY&&(ia[la*8+1]=-ia[la*8+1])):(dt.mirrorX&&(ia[la].x=-ia[la].x),dt.mirrorY&&(ia[la].y=-ia[la].y));Wr={...Wr,points:ia}}ie.get(hl).frames.push(Wr)}})}}),Ks.current.forEach(oe=>{(oe.channels&&oe.channels.length>0?oe.channels.map(fe=>fe.serviceID):[0]).forEach(fe=>{const be=`${oe.ip}:${fe}`,Ae=nt.current?nt.current[be]:sr.current[be];if(Ae){ie.has(be)||ie.set(be,{ip:oe.ip,channel:fe,type:oe.type,frames:[]});const De=ie.get(be);if(Ae.testLineEnabled){const Ie=Js(Ae.testLineY!==void 0?Ae.testLineY:.5);De.frames=[Ie]}}})});let le=0;ie.forEach(oe=>{let ge=P(oe.frames);const fe=`${oe.ip}:${oe.channel}`,be=nt.current?nt.current[fe]:sr.current[fe];if(ge&&be){if(be.dimmer!==void 0&&be.dimmer<1){const Ae=be.dimmer,De=ge.points,Ie=ge.isTypedArray,Ge=Ie?De.length/8:De.length;for(let ft=0;ft<Ge;ft++)Ie?(De[ft*8+3]*=Ae,De[ft*8+4]*=Ae,De[ft*8+5]*=Ae):(De[ft].r*=Ae,De[ft].g*=Ae,De[ft].b*=Ae)}ge=Vf(ge,be,!1)}if(ge){le++;const Ae=F(ge.points)?ge.points.length/8:ge.points.length;rt.current+=Ae,window.electronAPI.sendFrame(oe.ip,oe.channel,ge.points,T,oe.type,{skipOptimization:!Fa.current})}}),Wt.current=le}E=q}A=requestAnimationFrame(z)};function F(q){return!!q&&(q instanceof Float32Array||q.buffer instanceof ArrayBuffer)}const X=q=>{const ie=1e3/Er.current,le=pa.current||120,oe=(fe,be,Ae,De)=>{Y.current[De]||(Y.current[De]=q);let Ie=q-Y.current[De];Ie>1e3&&(Ie=ie),jn.current&&(Ga.current[De]===void 0&&(Ga.current[De]=0),Ga.current[De]+=Ie);const Ge=Ga.current[De]||0,ft=ir.current[be]!==null?An.current(be):null;let it=J.current[De]||0,ht=0;const xt=fe.totalFrames||1,$e=fe.playbackSettings||{mode:"fps",duration:xt/60,beats:8,speedMultiplier:1};if(ft&&jn.current&&!ft.paused)ht=ft.duration>0?ft.currentTime/ft.duration:0,it=Math.floor(ht*xt);else if($e.mode==="timeline"){const Mt=$e.duration*1e3/($e.speedMultiplier||1);Mt>0&&(ht=Ge/Mt%1,it=Math.floor(ht*xt))}else if($e.mode==="bpm"){const Mt=6e4/le,St=$e.beats*Mt/($e.speedMultiplier||1);St>0&&(ht=Ge/St%1,it=Math.floor(ht*xt))}else{const St=1e3/(($e.fps||60)*($e.speedMultiplier||1));if(Ie>=St){const Jt=Math.floor(Ie/St);jn.current?(Y.current[De]=q-Ie%St,it=it+Jt):Y.current[De]=q,ht=xt>0?it%xt/xt:0}else return}$e.mode!=="fps"&&(Y.current[De]=q),isNaN(it)&&(it=0),isNaN(ht)&&(ht=0);const Ht=(lr.current[De]||0)>.9&&ht<.1;if(lr.current[De]=ht,_.current[De]=ht,xt>0&&(it=it%xt,it<0&&(it+=xt)),Ht&&jn.current){const Mt=Yr.current[be];if(Mt&&Mt!=="off"){const St=ut.current[be],Jt=ir.current[be];let Dt=-1;if(Mt==="forward")for(let mt=1;mt<St.length;mt++){const _t=(Jt+mt)%St.length,nn=St[_t];if(nn&&(nn.type==="ilda"||nn.type==="generator")){Dt=_t;break}}else if(Mt==="random"){const mt=St.map((_t,nn)=>_t&&(_t.type==="ilda"||_t.type==="generator")?nn:-1).filter(_t=>_t!==-1);if(mt.length>0){const _t=Math.floor(Math.random()*mt.length);Dt=mt[_t],Dt===Jt&&mt.length>1&&(Dt=mt[(_t+1)%mt.length])}}Dt!==-1&&Dt!==Jt&&setTimeout(()=>{Pn(be,Dt)},0)}}let Rt=1;if($e.mode==="timeline"?Rt=$e.duration||1:$e.mode==="bpm"?Rt=($e.beats||8)*60/le:fe.type==="generator"&&(!fe.frames||fe.frames.length<=1)?Rt=$e.duration||1:Rt=xt/($e.fps||60),fe.type==="generator"){const Mt=fe.syncSettings||{},St=fe.generatorDefinition?.id,Jt=fe.generatorDefinition,Dt=Object.keys(Mt).filter(mt=>mt.startsWith(`${St}.`));if(Dt.length>0){const mt=fe.currentParams||{},_t={...mt};let nn=!1;const Xa={time:q,progress:ht,bpm:le,clipDuration:Rt,fftLevels:l?l():s,activationTime:G.current[be]||0};for(const dr of Dt){const an=dr.split(".")[1],dt=Jt?.paramControls?.find(Ma=>Ma.id===an),Ca=mt[an]!==void 0?mt[an]:fe.generatorDefinition.defaultParams[an],Qn=Mc(an,Ca,Mt[dr],Xa,dt?.min,dt?.max);Qn!==_t[an]&&(_t[an]=Qn,nn=!0)}if(nn){const dr=++aa.current;Zn(be,Ae,fe.generatorDefinition,_t,dr,!0)}}if(St==="waveform"){const mt=fe.currentParams||{},_t=mt.mode==="waveform"?u.current:o.current,nn=++aa.current,Xa={time:q,activationTime:G.current[be]||0};Zn(be,Ae,fe.generatorDefinition,mt,nn,!1,!0,_t,Xa)}else if(St==="timer"){const mt=fe.currentParams||{},_t=++aa.current,nn={time:q,activationTime:G.current[be]||0};Zn(be,Ae,fe.generatorDefinition,mt,_t,!1,!0,null,nn)}}(J.current[De]!==it||!D.current[De])&&(J.current[De]=it,fe.type==="ilda"?n.postMessage({type:"get-frame",workerId:De,frameIndex:it}):fe.type==="generator"&&(fe.frames&&fe.frames.length>1?fe.frames[it%fe.frames.length]&&(D.current[De]=fe.frames[it%fe.frames.length]):!D.current[De]&&fe.frames&&fe.frames.length>0&&(D.current[De]=fe.frames[0])))};Gt.forEach((fe,be)=>{const Ae=ir.current[be];if(Ae===null)return;const Ie=(Qe.current||ut.current)[be][Ae];if(!Ie)return;let Ge=Ie.type==="ilda"?Ie.workerId:Ie.type==="generator"?`generator-${be}-${Ae}`:null;Ge&&oe(Ie,be,Ae,Ge)});const ge=hs.current;if(ge&&!Ar.current.some(fe=>fe.workerId===ge)){const fe=Ut.current,be=Bn.current;if(fe!==null&&be!==null){const De=(Qe.current||ut.current)[fe][be];De&&oe(De,fe,be,ge)}}if(Ha.current){const{layerIndex:fe,colIndex:be}=Ha.current,Ae=ir.current[fe]===be;Ut.current===fe&&Bn.current;const De=hs.current;if(!Ae){const Ge=(Qe.current||ut.current)[fe]?.[be];if(Ge){let ft=Ge.type==="ilda"?Ge.workerId:Ge.type==="generator"?`generator-${fe}-${be}`:null;ft&&ft!==De&&oe(Ge,fe,be,ft)}}}S=requestAnimationFrame(X)};return S=requestAnimationFrame(X),Mn?A=requestAnimationFrame(z):cancelAnimationFrame(A),()=>{n.removeEventListener("message",v),cancelAnimationFrame(S),cancelAnimationFrame(A)}},[n,Mn]),N.useEffect(()=>{let v,S,A;return window.electronAPI&&(v=window.electronAPI.onClipContextMenuCommand((E,T,L)=>{if(console.log(`Clip context menu command received: ${E} for ${T}-${L}`),E==="export-ilda"){const P=ut.current[T][L];console.log("Exporting clip:",P),P&&(P.type==="ilda"&&P.workerId&&n?(qt("Preparing ILDA export..."),console.log("Requesting frames from worker:",P.workerId),n.postMessage({type:"get-all-frames",workerId:P.workerId,layerIndex:T,colIndex:L})):P.type==="generator"?(console.log("Exporting generator frames with parameter animation..."),(async()=>{const{framesToIlda:F}=await U0(async()=>{const{framesToIlda:Ie}=await Promise.resolve().then(()=>$0);return{framesToIlda:Ie}},void 0,import.meta.url),X=ta||60;let q=2;const ie=P.playbackSettings||{};ie.mode==="timeline"?q=ie.duration||2:ie.mode==="bpm"?q=(ie.beats||8)*60/(ke.bpm||120):P.frames?.length>1&&(q=P.frames.length/X);const le=Math.ceil(q*X),oe=[],ge=new Map,fe=P.generatorDefinition?.id;let be=null;if(["text","spout-receiver"].includes(fe)){const Ie=P.currentParams?.fontUrl||"src/fonts/Geometr415 Blk BT Black.ttf";try{Ie.startsWith("http")?be=await window.electronAPI.fetchUrlAsArrayBuffer(Ie):be=await window.electronAPI.readFileForWorker(Ie)}catch(Ge){console.error("Failed to load font for export:",Ge)}}for(let Ie=0;Ie<le;Ie++){const Ge=Ie*(1e3/X),ft=Ie/le,it=P.syncSettings||{},ht=P.generatorDefinition,xt=P.currentParams||{},$e={...xt},ra={time:Ge,progress:ft,bpm:ke.bpm,clipDuration:q,fftLevels:{low:0,mid:0,high:0},activationTime:0};for(const Rt in it)if(Rt.startsWith(`${fe}.`)){const Mt=Rt.split(".")[1],St=ht?.paramControls?.find(Dt=>Dt.id===Mt),Jt=xt[Mt]!==void 0?xt[Mt]:ht.defaultParams[Mt];$e[Mt]=Mc(Mt,Jt,it[Rt],ra,St?.min,St?.max)}let Ht=null;try{if(fe==="circle")Ht=Lm($e);else if(fe==="square")Ht=Um($e);else if(fe==="line")Ht=jm($e);else if(fe==="star")Ht=Bm($e);else if(fe==="text")Ht=await Im($e,be);else if(fe==="spout-receiver")Ht=await Im({...$e,text:$e.sourceName},be);else if(P.frames){const Rt=Math.floor(ft*P.frames.length)%P.frames.length;Ht=P.frames[Rt]}}catch(Rt){console.error("Generation failed during export:",Rt)}if(Ht){const Rt=(P.effects||[]).filter(mt=>!((mt.id==="delay"||mt.id==="chase")&&mt.params?.mode==="channel")),Mt=lo(Ht,Rt,{time:Ge,progress:ft,effectStates:ge,syncSettings:P.syncSettings||{},bpm:ke.bpm,clipDuration:q,assignedDacs:P.assignedDacs||[]}),St=Mt.points,Jt=St.length/8,Dt=[];for(let mt=0;mt<Jt;mt++)Dt.push({x:St[mt*8],y:St[mt*8+1],z:St[mt*8+2],r:St[mt*8+3],g:St[mt*8+4],b:St[mt*8+5],blanking:St[mt*8+6]>.5,lastPoint:St[mt*8+7]>.5});oe.push({...Mt,points:Dt,frameName:`Frame ${Ie}`,companyName:"TrueLazer"})}}const Ae=F(oe),De=`${P.generatorDefinition?.name||"generator"}_export.ild`;if(window.electronAPI&&window.electronAPI.saveIldaFile){const Ie=await window.electronAPI.saveIldaFile(Ae,De);Ie.success?qt(`Exported to ${Ie.filePath}`):Ie.error&&qt(`Export failed: ${Ie.error}`)}})().catch(F=>console.error("Failed to export generator:",F))):(console.warn("Clip type not supported for export or missing data:",P.type,P),P.type==="ilda"&&!P.workerId?qt("Clip data not loaded. Please play the clip to load it."):P.type==="generator"&&!P.frames&&qt("Generator not rendered yet.")))}else if(E==="update-thumbnail"){const P=Ke[T][L];if(P){if(P.type==="ilda"&&P.workerId&&n){const z=J.current[P.workerId]||0;n.postMessage({type:"get-frame",workerId:P.workerId,frameIndex:z,isStillFrame:!0,layerIndex:T,colIndex:L})}else if(P.type==="generator"&&P.generatorDefinition){const z=J.current[`generator-${T}-${L}`]||0,F=P.frames?.[z%P.frames.length];if(F){const X=P.effects||[];Hf(F,X,T,L,na).then(q=>{Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:T,colIndex:L,content:{stillFrame:F,thumbnailPath:q,thumbnailVersion:Date.now()}}})})}}}}else if(E==="clear-clip")Se({type:"CLEAR_CLIP",payload:{layerIndex:T,colIndex:L}});else if(E==="rename-clip"){const P=Pa.current[T][L];At({title:"Rename Clip",initialValue:P,onSave:z=>Se({type:"SET_CLIP_NAME",payload:{layerIndex:T,colIndex:L,name:z}})}),ve(!0)}else if(E==="copy-clip"){const P={content:ut.current[T][L],name:Pa.current[T][L]};Se({type:"SET_CLIPBOARD",payload:P}),qt("Clip copied.")}else if(E==="cut-clip"){const P={content:ut.current[T][L],name:Pa.current[T][L]};Se({type:"SET_CLIPBOARD",payload:P}),Se({type:"CLEAR_CLIP",payload:{layerIndex:T,colIndex:L}}),qt("Clip cut.")}else if(E==="paste-clip")if(ke.clipClipboard){const{content:P,name:z}=ke.clipClipboard;let F=JSON.parse(JSON.stringify(P));if(F.type==="ilda"&&(F.workerId=null),F.effects&&F.effects.length>0){const q={...F.syncSettings||{}};F.effects=F.effects.map(ie=>{const le=ie.instanceId,oe=so();return Object.keys(q).forEach(ge=>{if(le&&ge.startsWith(`${le}.`)){const fe=ge.substring(le.length);q[`${oe}${fe}`]=q[ge],delete q[ge]}}),{...ie,instanceId:oe}}),F.syncSettings=q}Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:T,colIndex:L,content:F}}),Se({type:"SET_CLIP_NAME",payload:{layerIndex:T,colIndex:L,name:z}}),qt("Clip pasted."),setTimeout(()=>{const X=F;if(X.type==="generator"&&X.generatorDefinition){const q=`${T}-${L}`,ie={...X.generatorDefinition.defaultParams,...X.currentParams};Tr.current.set(q,JSON.stringify(ie));const le=++aa.current;Zn(T,L,X.generatorDefinition,X.currentParams,le)}},100)}else qt("Clipboard is empty.");else E==="set-trigger-style-normal"?Se({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:T,colIndex:L,style:"normal"}}):E==="set-trigger-style-toggle"?Se({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:T,colIndex:L,style:"toggle"}}):E==="set-trigger-style-flash"&&Se({type:"SET_CLIP_TRIGGER_STYLE",payload:{layerIndex:T,colIndex:L,style:"flash"}})}),S=window.electronAPI.onLayerFullContextMenuCommand((E,T)=>{if(console.log(`Layer context menu command received: ${E} for ${T}`),E==="layer-rename"){const L=Gt[T];At({title:"Rename Layer",initialValue:L,onSave:P=>Se({type:"SET_LAYER_NAME",payload:{index:T,name:P}})}),ve(!0)}else E==="layer-clear-clips"&&Se({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:T}})}),A=window.electronAPI.onContextMenuActionFromMain(E=>{if(console.log("General context menu action received:",E),E.type==="rename-column"){const T=On[E.index];At({title:"Rename Column",initialValue:T,onSave:L=>Se({type:"SET_COLUMN_NAME",payload:{index:E.index,name:L}})}),ve(!0)}else if(E.type==="rename-layer"){const T=Gt[E.index];At({title:"Rename Layer",initialValue:T,onSave:L=>Se({type:"SET_LAYER_NAME",payload:{index:E.index,name:L}})}),ve(!0)}else if(E.type==="reset-quick-assign"){const T=E.controlType==="knob"?0:!1;Se({type:"UPDATE_QUICK_CONTROL",payload:{type:E.controlType,index:E.index,value:T}})}else E.type==="clear-quick-assign"&&Se({type:"CLEAR_QUICK_CONTROL",payload:{type:E.controlType,index:E.index}})})),()=>{v&&v(),S&&S(),A&&A()}},[Ke,qn,Gt,On,n,a,ke.clipClipboard]);const ei=N.useRef(Xt);N.useEffect(()=>{for(let v=0;v<Gt.length;v++)for(let S=0;S<On.length;S++){const A=Xt[v][S],E=ei.current[v][S],T=Ke[v][S],L=T?.workerId,P=ms.current.get(`${v}-${S}`),z=A!==E;(z||L&&!P)&&T&&T.type==="ilda"&&L&&(console.log(`[App.jsx] Fetching still frame for ${v}-${S} at index ${A}. Reason: ${z?"index change":"worker ready"}`),n.postMessage({type:"get-frame",workerId:L,frameIndex:A,isStillFrame:!0,layerIndex:v,colIndex:S})),L?ms.current.set(`${v}-${S}`,L):ms.current.delete(`${v}-${S}`)}ei.current=Xt},[Xt,Ke,Gt.length,On.length,n]),N.useEffect(()=>{a&&Ke.forEach((v,S)=>{v.forEach((A,E)=>{if(A&&A.type==="generator"&&A.generatorDefinition){if(A.generatorDefinition.id==="ndi-source")return;const T=`${S}-${E}`,L={...A.generatorDefinition.defaultParams,...A.currentParams||{}},P=JSON.stringify(L);if(Tr.current.get(T)!==P){console.log(`[App.jsx] Generator ${T} params changed, regenerating...`);const z=++aa.current;Zn(S,E,A.generatorDefinition,A.currentParams,z),Tr.current.set(T,P)}}})})},[Ke,a]),N.useEffect(()=>{if(!ke.projectLoadTimestamp||!n||!a)return;console.log("Project loaded, regenerating content...");const v=[];Ke.forEach((S,A)=>{S.forEach((E,T)=>{if(E){if(E.type==="ilda"&&E.filePath&&!E.workerId)console.log(`Reparsing ILDA file for clip ${A}-${T}: ${E.filePath}`),n.postMessage({type:"load-and-parse-ilda",fileName:E.fileName,filePath:E.filePath,layerIndex:A,colIndex:T});else if(E.type==="generator"&&E.generatorDefinition){console.log(`Regenerating generator clip ${A}-${T} on project load`);const L=++aa.current;Zn(A,T,E.generatorDefinition,E.currentParams,L)}E.audioFile&&E.audioFile.path&&window.electronAPI&&window.electronAPI.checkFileExists&&v.push(window.electronAPI.checkFileExists(E.audioFile.path).then(L=>{L||Ve(P=>{const z=`audio-${A}-${T}`;return P.some(F=>F.requestId===z)?P:[...P,{filePath:E.audioFile.path,fileName:E.audioFile.name||E.audioFile.path.split(/[/\\]/).pop(),requestId:z,type:"audio"}]})}))}})})},[ke.projectLoadTimestamp,n,a]),N.useEffect(()=>{if(window.electronAPI&&window.electronAPI.onUpdateThumbnailRenderMode){const v=window.electronAPI.onUpdateThumbnailRenderMode(S=>{console.log("App.jsx: Received thumbnail mode update:",S),Se({type:"SET_THUMBNAIL_RENDER_MODE",payload:S})});return()=>v()}},[]);const Ya=N.useRef(ke);N.useEffect(()=>{Ya.current=ke},[ke]),N.useEffect(()=>{let v,S,A,E,T;return window.electronAPI&&(v=window.electronAPI.on("new-project",()=>Se({type:"RESET_STATE"})),S=window.electronAPI.on("open-project",()=>{}),A=window.electronAPI.on("save-project",()=>{console.log("Saving project with state:",Ya.current),window.electronAPI.send("save-project",Ya.current)}),E=window.electronAPI.on("save-project-as",()=>{console.log("Saving project AS with state:",Ya.current),window.electronAPI.send("save-project-as",Ya.current)}),T=window.electronAPI.on("load-project-data",L=>{Se({type:"LOAD_PROJECT",payload:L})})),()=>{v&&v(),S&&S(),A&&A(),E&&E(),T&&T()}},[]),N.useEffect(()=>{let v,S;return(async()=>{if(window.electronAPI&&window.electronAPI.getAllSettings){const E=await window.electronAPI.getAllSettings();E&&(E.shortcutsState&&$(E.shortcutsState),Se({type:"LOAD_SETTINGS",payload:E}))}})(),window.electronAPI&&(v=window.electronAPI.onMenuAction(E=>{if(console.log("Menu action received:",E),E==="output-settings")Ue(!0);else if(E==="shapeBuilder")Z("shapeBuilder"),Se({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(E==="timeline")Z("timeline"),Se({type:"SET_WORLD_OUTPUT_ACTIVE",payload:!1});else if(E==="about")V(!0);else if(E==="settings-audio-output")Me(!0);else if(E==="settings-audio-fft")Xe(!0);else if(E.startsWith("set-theme-")){const T=E.split("set-theme-")[1];Se({type:"SET_THEME",payload:T})}else if(E==="shortcuts-window"||E.startsWith("open-")&&E.endsWith("-settings"))ce(!0);else if(E==="column-duplicate")ct!==null&&(Se({type:"DUPLICATE_COLUMN",payload:{index:ct}}),qt("Column duplicated."));else if(E==="column-clear-clips")ct!==null&&Gt.forEach((T,L)=>{Se({type:"CLEAR_CLIP",payload:{layerIndex:L,colIndex:ct}})});else if(E.startsWith("toggle-")){const T=E.split("-");if(T.length===3){const L=T[1],P=T[2]==="true";$(z=>({...z,[L]:P}))}}}),S=window.electronAPI.onRenderSettingsCommand(E=>{console.log("Render settings command received:",E),Se({type:"SET_RENDER_SETTING",payload:{setting:E.setting,value:E.value}})})),()=>{v&&v(),S&&S()}},[]),N.useEffect(()=>{if(!n)return;const v=async S=>{if(S.data.type==="request-file-content"){const{filePath:A,requestId:E,maxBytes:T}=S.data;try{if(window.electronAPI&&window.electronAPI.checkFileExists&&!await window.electronAPI.checkFileExists(A))throw new Error(`File not found: ${A}`);const L=await window.electronAPI.readFileForWorker(A,T);n.postMessage({type:"file-content-response",requestId:E,arrayBuffer:L},[L])}catch(L){console.warn(`File missing or read error: ${A}`,L.message);const P=A.split(/[/\\]/).pop();Ve(z=>z.some(F=>F.requestId===E)?z:[...z,{filePath:A,fileName:P,requestId:E}])}}else if(S.data.type==="parsing-status"){const{layerIndex:A,colIndex:E,status:T}=S.data;A!==void 0&&E!==void 0&&(Se({type:"SET_CLIP_PARSING_STATUS",payload:{layerIndex:A,colIndex:E,status:T}}),T||Se({type:"SET_CLIP_PARSING_FAILED",payload:{layerIndex:A,colIndex:E,failed:!0}}))}};return n.addEventListener("message",v),()=>{n.removeEventListener("message",v)}},[n]),N.useEffect(()=>{if(!e)return;const v=async S=>{if(S.data.type==="request-file-content"){const{filePath:A,requestId:E,maxBytes:T}=S.data;try{const L=await window.electronAPI.readFileForWorker(A,T);e.postMessage({type:"file-content-response",requestId:E,arrayBuffer:L},[L])}catch(L){console.error(`Thumbnail Worker: Error reading file: ${A}`,L),e.postMessage({type:"file-content-response",requestId:E,error:L.message})}}};return e.addEventListener("message",v),()=>{e.removeEventListener("message",v)}},[e]),N.useEffect(()=>{if(!n)return;const v=[];Ke.forEach((S,A)=>{S.forEach((E,T)=>{E&&E.type==="ilda"&&E.filePath&&!E.workerId&&!E.parsing&&!E.parsingFailed&&v.push({layerIndex:A,colIndex:T,fileName:E.fileName,filePath:E.filePath})})}),v.length>0&&(console.log(`Triggering re-parse for ${v.length} clips.`),Se({type:"SET_BULK_PARSING_STATUS",payload:v.map(S=>({layerIndex:S.layerIndex,colIndex:S.colIndex,status:!0}))}),v.forEach(S=>{n.postMessage({type:"load-and-parse-ilda",fileName:S.fileName,filePath:S.filePath,layerIndex:S.layerIndex,colIndex:S.colIndex})}))},[Ke,n]);const ti=Qe.current||Ke;if(Ze!==null){const v=tr[Ze]||[];if(ct!==null)[...ti[Ze][ct]?.effects||[],...v];else{const S=et[Ze];S!==null&&[...ti[Ze][S]?.effects||[],...v]}}const Xr=N.useCallback((v,S,A,E,T)=>{if(Qe.current&&Qe.current[v]&&Qe.current[v][S]){const L=Qe.current[v][S];L&&L.effects&&L.effects[A]&&(L.effects[A].params[E]=T,Pe.current=!0)}zt(`effect-${v}-${S}-${A}-${E}`,{type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:v,colIndex:S,effectIndex:A,paramName:E,newValue:T}})},[zt]);N.useEffect(()=>{if(!a)return;const v=S=>{if(!S.data.browserFile){if(S.data.layerIndex!==void 0&&S.data.colIndex!==void 0){const A=`${S.data.layerIndex}-${S.data.colIndex}`;if(gs.current.set(A,!1),cr.current.has(A)){const{message:E,transferables:T}=cr.current.get(A);cr.current.delete(A),gs.current.set(A,!0),a.postMessage(E,T)}}if(S.data.success){const{layerIndex:A,colIndex:E,frames:T,generatorDefinition:L,currentParams:P,isLive:z,isAutoUpdate:F,seq:X}=S.data;if(A===void 0||E===void 0)return;if(X!==void 0){const ie=`${A}-${E}`,le=Ai.current.get(ie)||0;if(X<le){console.log(`[App.jsx] Discarding stale response: seq ${X} < ${le}`);return}Ai.current.set(ie,X)}const q=`generator-${A}-${E}`;if(D.current[q]=T[0],!z&&!F&&X===aa.current){const ie=ut.current[A][E]||{},le={...ie,type:"generator",generatorDefinition:L,frames:T,stillFrame:T[0],currentParams:P,playbackSettings:ie.playbackSettings||{mode:"fps",duration:T.length/60,beats:8,speedMultiplier:1}};Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:A,colIndex:E,content:le}});const oe=Pa.current[A][E],ge=`Clip ${A+1}-${E+1}`;oe===ge&&Se({type:"SET_CLIP_NAME",payload:{layerIndex:A,colIndex:E,name:L.name}})}else S.data.isNdi&&window.electronAPI&&window.electronAPI.ndiRendererReady&&window.electronAPI.ndiRendererReady()}else qt(`Error generating frames: ${S.data.error}`)}};return a.addEventListener("message",v),()=>{a.removeEventListener("message",v)}},[a]);const Ea=N.useCallback((v,S,A)=>{if(a){const E=`${v}-${S}`,T={...A.defaultParams};Tr.current.set(E,JSON.stringify(T));const L=++aa.current;Zn(v,S,A,A.defaultParams,L)}},[a]),vs=(v,S)=>{try{switch(v){case"circle":return Lm(S);case"square":return Um(S);case"line":return jm(S);case"star":return Bm(S);case"sinewave":return Sw(S);default:return null}}catch(A){return console.error(`Error in synchronous live generation for ${v}:`,A),null}},Zn=async(v,S,A,E,T,L=!1,P=!1,z=null,F=null)=>{const X={...A.defaultParams,...E},q=`${v}-${S}`;let ie=null;if(["text","ndi-source","spout-receiver","timer"].includes(A.id)){const ge="src/fonts/Geometr415 Blk BT Black.ttf";let fe=X.fontUrl||ge;if(["https://raw.githubusercontent.com/google/fonts/main/ofl/roboto/Roboto-Regular.ttf","https://raw.githubusercontent.com/googlefonts/roboto-2/main/src/hinted/Roboto-Regular.ttf"].includes(fe)&&(fe=ge),za.current.has(fe))ie=za.current.get(fe);else try{if(fe.startsWith("http"))if(window.electronAPI&&window.electronAPI.fetchUrlAsArrayBuffer)ie=await window.electronAPI.fetchUrlAsArrayBuffer(fe);else throw new Error("URL fetching API is not available.");else if(window.electronAPI&&window.electronAPI.readFileForWorker)ie=await window.electronAPI.readFileForWorker(fe);else throw new Error("File reading API is not available.");ie&&za.current.set(fe,ie)}catch(Ae){console.error(`Failed to load font for text generator at ${v}-${S}:`,Ae),qt(`Font error: ${Ae.message}`);return}}const le={type:"generate",layerIndex:v,colIndex:S,generator:A,params:X,fontBuffer:ie,audioData:z,context:F,seq:T,isAutoUpdate:L,isLive:P},oe=[];gs.current.get(q)?(console.log(`[App.jsx] Generator ${q} busy, queuing seq ${T}`),cr.current.set(q,{message:le,transferables:oe})):(gs.current.set(q,!0),a&&a.postMessage(le,oe))},tn=N.useCallback(v=>{C(v),Se({type:"DEACTIVATE_LAYER_CLIPS",payload:{layerIndex:v}})},[C]),qa=N.useCallback(()=>{I(),Se({type:"CLEAR_ALL_ACTIVE_CLIPS"})},[I]),Aa=N.useCallback(()=>{x(),Gt.forEach((v,S)=>{const A=et[S];if(A!==null){const E=Ke[S][A];E&&E.audioFile&&!H(S)&&b(S,E.audioFile.path,E.audioVolume??1,!0)}}),Se({type:"SET_IS_PLAYING",payload:!0}),Se({type:"SET_IS_STOPPED",payload:!1})},[x,Gt,et,Ke,H,b]),Cr=N.useCallback(()=>{w(),Se({type:"SET_IS_PLAYING",payload:!1}),Se({type:"SET_IS_STOPPED",payload:!1})},[w]),Va=N.useCallback(()=>{R(),w(),Se({type:"SET_IS_PLAYING",payload:!1}),Se({type:"SET_IS_STOPPED",payload:!0}),J.current={}},[R,w]),Mr=N.useCallback(()=>{const v=!Mn;Se({type:"SET_WORLD_OUTPUT_ACTIVE",payload:v}),window.electronAPI&&(v?ke.dacs.forEach(S=>{window.electronAPI.startDacOutput(S.ip,S.type)}):ke.dacs.forEach(S=>{window.electronAPI.stopDacOutput(S.ip,S.type)}))},[Mn,ke.dacs]),Nr=N.useCallback((v,S)=>{Se({type:"SET_SELECTED_CLIP",payload:{layerIndex:v,colIndex:S}});const A=Ke[v][S];if(A&&A.type==="ilda")Se({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:A.workerId,totalFrames:A.totalFrames,generatorId:null,generatorParams:{}}});else if(A&&A.type==="generator"){const E=`generator-${v}-${S}`;Se({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:E,generatorId:A.generatorDefinition.id,generatorParams:A.currentParams,totalFrames:A.frames.length}})}else Se({type:"SET_SELECTED_ILDA_DATA",payload:{workerId:null,totalFrames:0,generatorId:null,generatorParams:{}}})},[Ke]),yn=N.useCallback((v,S,A)=>{A?Ha.current={layerIndex:v,colIndex:S}:Ha.current&&Ha.current.layerIndex===v&&Ha.current.colIndex===S&&(Ha.current=null)},[]),Pn=N.useCallback((v,S,A=!0)=>{const E=Ke[v][S];if(!E){A&&(Nr(v,S),tn(v));return}const T=E.triggerStyle||"normal",L=et[v];if(T==="normal"){if(!A)return}else if(T==="toggle"){if(!A)return;if(L===S){tn(v);return}}else if(T==="flash"&&!A){L===S&&tn(v);return}if(E&&E.type==="generator"&&E.frames&&E.frames.length>0){const P=`generator-${v}-${S}`;D.current[P]=E.frames[0],Y.current[P]=performance.now(),J.current[P]=0}else E&&E.type==="ilda"&&E.workerId&&(Y.current[E.workerId]=performance.now(),J.current[E.workerId]=0);if(E&&E.audioFile?b(v,E.audioFile.path,E.audioVolume??1,jn.current).catch(P=>{console.warn(`Failed to play audio for clip ${v}-${S}:`,P),Ve(z=>{const F=`audio-${v}-${S}`;return z.some(X=>X.requestId===F)?z:[...z,{filePath:E.audioFile.path,fileName:E.audioFile.name||E.audioFile.path.split(/[/\\]/).pop(),requestId:F,type:"audio"}]})}):C(v),G.current[v]=performance.now(),Se({type:"SET_ACTIVE_CLIP",payload:{layerIndex:v,colIndex:S}}),E){if(E.type==="ilda"&&E.workerId){const P=J.current[E.workerId]||0;Se({type:"UPDATE_THUMBNAIL",payload:{layerIndex:v,colIndex:S,frameIndex:P}})}else if(E.type==="generator"&&E.frames){const P=J.current[`generator-${v}-${S}`]||0,z=E.frames[P%E.frames.length];z&&Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:v,colIndex:S,content:{stillFrame:z}}})}}},[Ke,et,tn,b,xa,C,Nr]),bs=N.useCallback((v,S,A)=>{if(Qe.current&&Qe.current[v]&&Qe.current[v][S]){const E=Qe.current[v][S];if(E){const T={...A,instanceId:so(),params:{...A.defaultParams}};E.effects=[...E.effects||[],T],Pe.current=!0}}Se({type:"ADD_CLIP_EFFECT",payload:{layerIndex:v,colIndex:S,effect:A}})},[]),kr=N.useCallback((v,S)=>{const A=ll.find(E=>(E.id||E.name)===S);A&&Se({type:"ADD_LAYER_EFFECT",payload:{layerIndex:v,effect:A}})},[]),Ti=N.useCallback((v,S,A)=>{Pe.current=!0,Se({type:"SET_CLIP_DAC",payload:{layerIndex:v,colIndex:S,dac:A}})},[]),vn=N.useCallback((v,S)=>{Se({type:"SET_LAYER_DAC",payload:{layerIndex:v,dac:S}})},[]),xs=v=>{window.electronAPI&&window.electronAPI.showLayerFullContextMenu&&window.electronAPI.showLayerFullContextMenu(v)},$r=v=>{window.electronAPI&&window.electronAPI.showColumnContextMenu&&window.electronAPI.showColumnContextMenu(v)},fr=v=>{Gt.forEach((S,A)=>{const E=Ke[A][v];E&&(E.type==="ilda"||E.type==="generator")?Pn(A,v):tn(A)})},Ss=N.useCallback(v=>{Se({type:"SET_SELECTED_DAC",payload:v})},[]),dl=N.useCallback(v=>{Se({type:"SET_DACS",payload:v})},[]),Rr=(v,S)=>{if(Ze!==null&&ct!==null){let A=null,E={};if(Qe.current&&Qe.current[Ze]&&Qe.current[Ze][ct]){const q=Qe.current[Ze][ct];q&&q.currentParams&&(q.currentParams[v]=S,Pe.current=!0,A=q,E=q.currentParams)}if(A||(A=Ke[Ze][ct],A&&A.currentParams&&(E={...A.currentParams,[v]:S})),!A||!A.generatorDefinition)return;const T=A.generatorDefinition.id,L=`generator-${Ze}-${ct}`,P=vs(T,E);P&&(D.current[L]=P),zt(`generator-${Ze}-${ct}-${v}`,{type:"UPDATE_GENERATOR_PARAM",payload:{layerIndex:Ze,colIndex:ct,paramName:v,newValue:S}});const z=`${Ze}-${ct}`,F={...A.generatorDefinition.defaultParams,...E};Tr.current.set(z,JSON.stringify(F));const X=++aa.current;Zn(Ze,ct,A.generatorDefinition,E,X,!1,!0)}},ha=Ze!==null&&ct!==null?Ke[Ze][ct]:null;N.useEffect(()=>{if(!window.electronAPI||!a)return;(async()=>{let S=null;Gt.forEach((E,T)=>{const L=et[T];if(L!==null){const P=Ke[T][L];P&&P.type==="generator"&&P.generatorDefinition?.id==="ndi-source"&&(S=P)}}),!S&&ha?.type==="generator"&&ha?.generatorDefinition?.id==="ndi-source"&&(S=ha);const A=S?.currentParams?.sourceName;A&&A!=="No Source"?A!==or.current&&(console.log(`[NDI] Switching to source: ${A}`),await window.electronAPI.ndiCreateReceiver(A),or.current=A):or.current&&(console.log("[NDI] Destroying receiver"),await window.electronAPI.ndiDestroyReceiver(),or.current=null)})()},[et,Ke,ha,Gt]),N.useEffect(()=>{const v=[...Nn,ha].find(S=>S?.type==="generator"&&S?.generatorDefinition?.id==="ndi-source");if(v&&window.electronAPI?.ndiUpdateSettings){const{captureWidth:S,captureHeight:A}=v.currentParams||{};S&&A&&window.electronAPI.ndiUpdateSettings({width:S,height:A})}},[Nn,ha]),N.useEffect(()=>{if(!window.electronAPI||!a)return;const v=A=>{let E=!1;ir.current.forEach((T,L)=>{if(T===null)return;const P=ut.current[L][T];P&&P.type==="generator"&&P.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:L,colIndex:T,generator:P.generatorDefinition,params:{...P.generatorDefinition.defaultParams,...P.currentParams},ndiFrame:A,isLive:!0,isNdi:!0}),E=!0)}),Ba.current?.type==="generator"&&Ba.current?.generatorDefinition?.id==="ndi-source"&&(a.postMessage({type:"generate",layerIndex:Ut.current,colIndex:Bn.current,generator:Ba.current.generatorDefinition,params:{...Ba.current.generatorDefinition.defaultParams,...Ba.current.currentParams},ndiFrame:A,isLive:!0,isNdi:!0}),E=!0),E||window.electronAPI.ndiRendererReady()},S=window.electronAPI.onNdiFrame(v);return()=>S()},[a]);const ws=N.useCallback((v,S,A)=>{const E=v==="knob"?"knobs":"buttons",T=ke.quickAssigns[E][S];if(T.link){const{layerIndex:L,colIndex:P,effectIndex:z,targetType:F}=T.link,X=T.link.paramName||T.link.paramId;let q=A;if(v==="knob"&&T.min!==void 0&&T.max!==void 0&&(q=T.min+A*(T.max-T.min),T.step&&(q=Math.round(q/T.step)*T.step),q=parseFloat(q.toFixed(5))),F==="global")X==="master_intensity"?Un.current=q:X==="master_speed"&&(Er.current=q);else if(F==="layerEffect")Lt.current[L]&&Lt.current[L][z]&&(Lt.current[L][z].params[X]=q);else if((F==="effect"||F==="generator")&&Qe.current&&Qe.current[L]&&Qe.current[L][P]){const ie=Qe.current[L][P];F==="effect"&&ie.effects&&ie.effects[z]?ie.effects[z].params[X]=q:F==="generator"&&ie.currentParams&&(ie.currentParams[X]=q),Pe.current=!0}}zt(`quick-${v}-${S}`,{type:"UPDATE_QUICK_CONTROL",payload:{type:v,index:S,value:A}})},[ke.quickAssigns,zt]),Ci=N.useCallback(v=>{const S=ke.quickAssigns.buttons[v],A=S.link,E=!S.value;if(A){const{layerIndex:T,colIndex:L,effectIndex:P,targetType:z}=A,F=A.paramName||A.paramId;if(z==="transport"){F==="play"?Aa():F==="pause"?Cr():F==="stop"&&Va();return}if(z==="global"){if(F==="blackout")$n.current=E;else if(F==="laser_output"){Mr();return}else if(F==="clear"){qa();return}}else if(z==="layer")F==="blackout"?wa.current[T]=E:F==="solo"?(da.current.fill(!1),da.current[T]=E):F==="autopilot"&&(Yr.current[T]=E?"forward":"off");else if(z==="layerEffect")Lt.current[T]&&Lt.current[T][P]&&(Lt.current[T][P].params[F]=E);else if((z==="effect"||z==="generator")&&Qe.current&&Qe.current[T]&&Qe.current[T][L]){const X=Qe.current[T][L];z==="effect"&&X.effects&&X.effects[P]?X.effects[P].params[F]=E:z==="generator"&&X.currentParams&&(X.currentParams[F]=E),Pe.current=!0}}Se({type:"TOGGLE_QUICK_BUTTON",payload:{index:v}})},[ke.quickAssigns,Aa,Cr,Va,Mr,qa]),Dr=N.useCallback((v,S,A=127,E="noteon")=>{if(S===0&&!v.endsWith("_intensity")&&v!=="master_intensity"&&v!=="master_speed"&&!v.startsWith("clip_")&&v!=="bpm_value"&&v!=="bpm_fine_up"&&v!=="bpm_fine_down"&&!v.startsWith("quick_")&&!v.startsWith("dimmer_"))return;const T=S/A;switch(v){case"transport_play":S>0&&Aa();break;case"transport_pause":S>0&&Cr();break;case"transport_stop":S>0&&Va();break;case"comp_blackout":S>0&&Se({type:"TOGGLE_GLOBAL_BLACKOUT"});break;case"comp_clear":S>0&&qa();break;case"master_intensity":Un.current=T,zt("master_intensity",{type:"SET_MASTER_INTENSITY",payload:T});break;case"master_speed":const L=Math.max(1,Math.round(T*120));zt("master_speed",{type:"SET_RENDER_SETTING",payload:{setting:"playbackFps",value:L}});break;case"laser_output":S>0&&Se({type:"TOGGLE_WORLD_OUTPUT_ACTIVE"});break;case"bpm_value":if(E==="controlchange"){let P=0;S<=10?P=S:S>=118&&(P=S-128),P!==0&&Se({type:"SET_BPM",payload:Math.max(1,Math.min(999,(ke.bpm||120)+P))})}break;case"bpm_fine_up":S>0&&Se({type:"SET_BPM",payload:Math.min(999,(ke.bpm||120)+.1)});break;case"bpm_fine_down":S>0&&Se({type:"SET_BPM",payload:Math.max(1,(ke.bpm||120)-.1)});break;case"bpm_tap":break;default:if(v.startsWith("layer_")){const P=v.split("_"),z=parseInt(P[1]),F=P[2];F==="blackout"&&S>0?Se({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:z}}):F==="solo"&&S>0?Se({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:z}}):F==="intensity"?(ps.current[z]=T,zt(`layer_${z}_intensity`,{type:"SET_LAYER_INTENSITY",payload:{layerIndex:z,intensity:T}})):F==="clear"&&S>0&&tn(z)}else if(v.startsWith("clip_")){const P=v.split("_"),z=parseInt(P[1]),F=parseInt(P[2]);P[3]==="preview"?S>0&&Nr(z,F):Pn(z,F,S>0)}else if(v.startsWith("column_")){const P=v.split("_"),z=parseInt(P[1]);S>0&&fr(z)}else if(v.startsWith("quick_knob_")){const P=parseInt(v.split("_")[2]);ws("knob",P,T)}else if(v.startsWith("quick_btn_")){const P=parseInt(v.split("_")[2]);S>0&&Ci(P)}else if(v.startsWith("dimmer_")){const P=v.replace("dimmer_","").replace(/_/g,"."),z=Et[P]||{};Se({type:"SET_DAC_OUTPUT_SETTINGS",payload:{id:P,settings:{...z,dimmer:T}}})}else{const P=v.split("_");if(P.length>=2&&Ze!==null&&ct!==null){const z=Ke[Ze][ct];if(z&&z.effects){const F=P[0],X=P.slice(1).join("_"),q=z.effects.findIndex(ie=>ie.id===F);if(q!==-1){const le=ll.find(oe=>oe.id===F)?.paramControls.find(oe=>oe.id===X);if(le){let oe=T;le.type==="range"||le.type==="number"?oe=le.min+(le.max-le.min)*T:le.type==="checkbox"&&(oe=T>.5),Se({type:"UPDATE_EFFECT_PARAMETER",payload:{layerIndex:Ze,colIndex:ct,effectIndex:q,paramName:X,newValue:oe}})}}}}}}},[Aa,Cr,Va,qa,tn,ur,ke.bpm,Nr,Pn,fr,Ke,Ze,ct,Et]),pl=N.useCallback(v=>{if(v==="world"){const A=!(ke.worldShowBeamEffect??!0);if(Se({type:"SET_RENDER_SETTING",payload:{setting:"worldShowBeamEffect",value:A}}),window.electronAPI&&window.electronAPI.setRenderSettings){const E={...ke.renderSettings,showBeamEffect:ke.showBeamEffect,beamRenderMode:ke.beamRenderMode,previewScanRate:ke.previewScanRate,beamAlpha:ke.beamAlpha,fadeAlpha:ke.fadeAlpha,worldShowBeamEffect:A,worldBeamRenderMode:ke.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(E)}}else{const S=!ca;if(Se({type:"SET_RENDER_SETTING",payload:{setting:"showBeamEffect",value:S}}),window.electronAPI&&window.electronAPI.setRenderSettings){const A={showBeamEffect:S,beamRenderMode:kt,previewScanRate:mn,beamAlpha:ua,fadeAlpha:ba,worldShowBeamEffect:ke.worldShowBeamEffect??!0,worldBeamRenderMode:ke.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(A)}}},[ca,kt,mn,ua,ba,ke.worldShowBeamEffect,ke.worldBeamRenderMode]),Ta=N.useCallback(v=>{if(v==="world"){const S=ke.worldBeamRenderMode??"both";let A="points";if(S==="both"?A="points":S==="points"?A="lines":S==="lines"&&(A="both"),Se({type:"SET_RENDER_SETTING",payload:{setting:"worldBeamRenderMode",value:A}}),window.electronAPI&&window.electronAPI.setRenderSettings){const E={showBeamEffect:ca,beamRenderMode:kt,previewScanRate:mn,beamAlpha:ua,fadeAlpha:ba,worldShowBeamEffect:ke.worldShowBeamEffect??!0,worldBeamRenderMode:A};window.electronAPI.setRenderSettings(E)}}else{let S="points";if(kt==="both"?S="points":kt==="points"?S="lines":kt==="lines"&&(S="both"),Se({type:"SET_RENDER_SETTING",payload:{setting:"beamRenderMode",value:S}}),window.electronAPI&&window.electronAPI.setRenderSettings){const A={showBeamEffect:ca,beamRenderMode:S,previewScanRate:mn,beamAlpha:ua,fadeAlpha:ba,worldShowBeamEffect:ke.worldShowBeamEffect??!0,worldBeamRenderMode:ke.worldBeamRenderMode??"both"};window.electronAPI.setRenderSettings(A)}}},[ca,kt,mn,ua,ba,ke.worldShowBeamEffect,ke.worldBeamRenderMode]),Es=async v=>{if(!(!window.electronAPI||!window.electronAPI.showOpenDialog))try{const S=await window.electronAPI.showOpenDialog({title:`Locate missing file: ${v.fileName}`,defaultPath:v.filePath,filters:[{name:"ILDA Files",extensions:["ild"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(S){const A=S,E=window.electronAPI.pathSeparator||(A.includes("/")?"/":"\\");if(Se({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:v.filePath,newPath:A}}),v.type!=="audio"){const q=await window.electronAPI.readFileForWorker(A);n&&n.postMessage({type:"file-content-response",requestId:v.requestId,arrayBuffer:q},[q])}Ve(q=>q.filter(ie=>ie.requestId!==v.requestId));const T=q=>q.substring(0,q.lastIndexOf(E)),L=q=>q.substring(q.lastIndexOf(E)+1),P=T(v.filePath),z=T(A);console.log(`[Relocate] Scanning for other files moving from [${P}] to [${z}]`);const F=Ya.current.clipContents.flat().filter(q=>q),X=new Set([v.filePath]);for(const q of F){if(q.type==="ilda"&&q.filePath&&!X.has(q.filePath)&&T(q.filePath)===P){const ie=L(q.filePath),le=`${z}${E}${ie}`;q.filePath!==le&&await window.electronAPI.checkFileExists(le)&&(console.log(`[Relocate] Auto-resolving ILDA: ${ie}`),Se({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:q.filePath,newPath:le}}),X.add(q.filePath),n&&Ve(ge=>ge.filter(fe=>fe.filePath!==q.filePath)))}if(q.audioFile&&q.audioFile.path&&!X.has(q.audioFile.path)&&T(q.audioFile.path)===P){const ie=L(q.audioFile.path),le=`${z}${E}${ie}`;q.audioFile.path!==le&&await window.electronAPI.checkFileExists(le)&&(console.log(`[Relocate] Auto-resolving Audio: ${ie}`),Se({type:"UPDATE_CLIP_FILE_PATH",payload:{oldPath:q.audioFile.path,newPath:le}}),X.add(q.audioFile.path),Ve(ge=>ge.filter(fe=>fe.filePath!==q.audioFile.path)))}}}}catch(S){console.error("Relocation failed:",S),qt(`Relocation failed: ${S.message}`)}},Mi=N.useCallback((v,S)=>{console.log(`Thumbnail load error for ${v}-${S}, requesting regeneration...`);const A=ut.current[v][S];if(A)if(A.type==="ilda"&&A.workerId&&n){const E=Xt[v][S]||0;n.postMessage({type:"get-frame",workerId:A.workerId,frameIndex:E,isStillFrame:!0,layerIndex:v,colIndex:S})}else A.type==="generator"&&A.stillFrame&&Hf(A.stillFrame,A.effects,v,S,na).then(E=>{E&&Se({type:"SET_CLIP_CONTENT",payload:{layerIndex:v,colIndex:S,content:{thumbnailPath:E,thumbnailVersion:Date.now()}}})})},[ut,Xt,n,na]),y=N.useCallback((v,S)=>{const A=ut.current[v][S];A&&A.audioFile&&Ve(E=>{const T=`audio-${v}-${S}`;return E.some(L=>L.requestId===T)?E:[...E,{filePath:A.audioFile.path,fileName:A.audioFile.name||A.audioFile.path.split(/[/\\]/).pop(),requestId:T,type:"audio"}]})},[ut]);return f.jsx(F1,{onMidiCommand:Dr,children:f.jsx(P1,{onArtnetCommand:(v,S)=>Dr(v,S,255),children:f.jsxs(z1,{onCommand:Dr,enabled:xe.keyboard,children:[f.jsx(Tw,{isPlaying:xa,globalBlackout:En,layerBlackouts:va,layerSolos:hn,isWorldOutputActive:Mn,clipContents:Ke,activeClipIndexes:et,theme:Ln,bpm:ke.bpm,quickAssigns:ke.quickAssigns}),f.jsx(eb,{}),K==="main"?f.jsx("div",{className:"app",children:f.jsxs(Gv,{children:[f.jsx(Mv,{message:ds.message,visible:ds.visible}),f.jsx(Xv,{show:ee,onClose:()=>V(!1)}),f.jsx(Fv,{show:Re,onClose:()=>Ue(!1),dacs:Vn,dacSettings:Et,onUpdateDacSettings:ys}),f.jsx(Pv,{show:we||ze,onClose:()=>{Me(!1),Xe(!1)},initialTab:ze?"fft":"output"}),f.jsx(jv,{show:Q,title:ot.title,initialValue:ot.initialValue,onSave:ot.onSave,onClose:()=>ce(!1)||ve(!1)}),f.jsx(zv,{missingFiles:je,onRelocate:Es,onClose:()=>Ve([])}),f.jsxs("div",{className:"main-content",children:[f.jsxs("div",{className:"top-bar-left-area",children:[f.jsx(H1,{masterIntensity:ke.masterIntensity,onMasterIntensityChange:v=>Se({type:"SET_MASTER_INTENSITY",payload:v}),onClearAllActive:qa,isGlobalBlackout:En,onToggleGlobalBlackout:()=>Se({type:"TOGGLE_GLOBAL_BLACKOUT"})}),f.jsx(Ew,{isWorldOutputActive:Mn,onToggleWorldOutput:Mr})]}),f.jsxs("div",{className:"layer-controls-container",children:[Gt.map((v,S)=>{const A=Nn.find(T=>{const L=et[S];if(L===null)return!1;const P=Ke[S][L];return P?P.type==="ilda"?T.workerId===P.workerId:P.type==="generator"?T.workerId===`generator-${S}-${L}`:!1:!1})||null,E=A?D.current[A.workerId]:null;return f.jsx(uv,{layerName:v,index:S,onDropEffect:T=>kr(S,T),onDropDac:(T,L)=>vn(T,L),layerEffects:tr[S],activeClipData:A,liveFrame:E,thumbnailRenderMode:Sa,intensity:ke.layerIntensities[S],onIntensityChange:T=>Se({type:"SET_LAYER_INTENSITY",payload:{layerIndex:S,intensity:T}}),onDeactivateLayerClips:()=>tn(S),onShowLayerFullContextMenu:()=>xs(S),isBlackout:va[S],isSolo:hn[S],onToggleBlackout:()=>Se({type:"TOGGLE_LAYER_BLACKOUT",payload:{layerIndex:S}}),onToggleSolo:()=>Se({type:"TOGGLE_LAYER_SOLO",payload:{layerIndex:S}}),onLayerSelect:T=>Se({type:"SET_SELECTED_CLIP",payload:{layerIndex:T,colIndex:null}})},S)}),"          "]}),f.jsx("div",{className:"clip-deck-container",children:f.jsxs("div",{className:"clip-deck",children:[f.jsx("div",{className:"column-headers-container",children:On.map((v,S)=>f.jsx(Y1,{name:v,index:S,onTrigger:()=>fr(S),onShowColumnHeaderContextMenu:()=>$r(S)},S))}),Gt.map((v,S)=>f.jsx("div",{className:"layer-row",children:On.map((A,E)=>{const T=Ke?.[S]?.[E];let L=null;T&&T.type==="ilda"?L=T.workerId:T&&T.type==="generator"&&(L=`generator-${S}-${E}`);const P=L?D.current[L]:null,z=T?.stillFrame||(T?.type==="generator"?T.frames?.[0]:null);return f.jsx(dv,{layerIndex:S,colIndex:E,clipName:qn?.[S]?.[E]||`Clip ${S+1}-${E+1}`,clipContent:T,thumbnailFrameIndex:Xt[S][E],thumbnailRenderMode:Sa,liveFrame:P,stillFrame:z,onActivateClick:F=>Pn(S,E,F),isActive:et[S]===E,onUnsupportedFile:qt,onDropEffect:F=>bs(S,E,F),onDropGenerator:Ea,onDropDac:(F,X,q)=>{Ti(F,X,q)},onLabelClick:()=>Nr(S,E),isSelected:Ze===S&&ct===E,ildaParserWorker:n,onClipHover:yn,onThumbnailError:Mi},E)})},S))]})}),f.jsx(Mw,{clipContents:Ke,activeClipIndexes:et,layerEffects:tr,bpm:ke.bpm,playbackFps:ta,selectedLayerIndex:Ze,selectedColIndex:ct,liveFramesRef:D,progressRef:_,selectedDac:In,liveDacOutputSettingsRef:nt,dacOutputSettings:Et,getAudioInfo:H,fftLevels:s,getFftLevels:l,effectStatesRef:j,clipActivationTimesRef:G,showBeamEffect:ca,beamAlpha:ua,fadeAlpha:ba,previewScanRate:mn,beamRenderMode:kt,worldShowBeamEffect:gn,worldBeamRenderMode:Xn,masterIntensity:ar,layerIntensities:zr,globalBlackout:En,layerSolos:hn,layerBlackouts:va,handleToggleBeamEffect:pl,handleCycleDisplayMode:Ta,previewFrameCountRef:Le,totalPointsSentRef:rt,activeChannelsCountRef:Wt,lastStatUpdateTimeRef:pn,liveClipContentsRef:Qe,optimizationEnabled:na}),f.jsxs("div",{className:"middle-bar",children:[f.jsx("div",{className:"middle-bar-left-area",children:f.jsx(_v,{bpm:ke.bpm,onBpmChange:v=>Se({type:"SET_BPM",payload:v})})}),f.jsxs("div",{className:"middle-bar-mid-area",children:[f.jsx(Ov,{onPlay:Aa,onPause:Cr,onStop:Va,isPlaying:xa,isStopped:ke.isStopped}),f.jsx(ww,{playbackFps:ta,onSpeedChange:ur})]}),f.jsx("div",{className:"middle-bar-right-area"})]}),f.jsxs("div",{className:"bottom-panel",children:[f.jsxs("div",{className:"bottom-panel-tabs-container-1",children:[f.jsxs("div",{className:"bottom-panel-tabs-1",children:[f.jsx("button",{className:`tab-button-1 ${Ct==="files"?"active":""}`,onClick:()=>on("files"),children:"Files"}),f.jsx("button",{className:`tab-button-1 ${Ct==="generators"?"active":""}`,onClick:()=>on("generators"),children:"Generators"}),f.jsx("button",{className:`tab-button-1 ${Ct==="effects"?"active":""}`,onClick:()=>on("effects"),children:"Effects"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-1",children:[Ct==="files"&&f.jsx(hv,{viewMode:ke.fileBrowserViewMode,onViewModeChange:v=>Se({type:"SET_FILE_BROWSER_VIEW_MODE",payload:v}),path:ke.fileBrowserPath,onPathChange:v=>Se({type:"SET_FILE_BROWSER_PATH",payload:v}),onDropIld:(v,S,A)=>n.postMessage({type:"parse-ilda",file:A,layerIndex:v,colIndex:S})}),Ct==="generators"&&f.jsx(mv,{}),Ct==="effects"&&f.jsx(gv,{})]})]}),f.jsxs("div",{className:"bottom-panel-tabs-container-2",children:[f.jsxs("div",{className:"bottom-panel-tabs-2",children:[f.jsx("button",{className:`tab-button-2 ${Qt==="clip"?"active":""}`,onClick:()=>cn("clip"),children:"Clip-Settings"}),f.jsx("button",{className:`tab-button-2 ${Qt==="layer"?"active":""}`,onClick:()=>cn("layer"),children:"Layer-Settings"})]}),f.jsxs("div",{className:"bottom-panel-tab-content-2",children:[Qt==="clip"&&f.jsx(Tv,{selectedLayerIndex:Ze,selectedColIndex:ct,clip:ha,audioInfo:H(Ze),bpm:ke.bpm,getFftLevels:l,onAssignAudio:async()=>{const v=await window.electronAPI.showAudioFileDialog();if(v){const S=v.split(/[\\/]/).pop();Se({type:"SET_CLIP_AUDIO",payload:{layerIndex:Ze,colIndex:ct,audioFile:{path:v,name:S}}})}},onRemoveAudio:()=>{C(Ze),Se({type:"REMOVE_CLIP_AUDIO",payload:{layerIndex:Ze,colIndex:ct}})},onUpdateAudioVolume:(v,S,A)=>{Se({type:"SET_CLIP_AUDIO_VOLUME",payload:{layerIndex:v,colIndex:S,volume:A}}),B(v,A)},onUpdatePlaybackSettings:(v,S,A)=>Se({type:"UPDATE_CLIP_PLAYBACK_SETTINGS",payload:{layerIndex:v,colIndex:S,settings:A}}),onSetParamSync:(v,S)=>Se({type:"SET_CLIP_PARAM_SYNC",payload:{layerIndex:Ze,colIndex:ct,paramId:v,syncMode:S}}),onToggleDacMirror:(v,S,A,E)=>Se({type:"TOGGLE_CLIP_DAC_MIRROR",payload:{layerIndex:v,colIndex:S,dacIndex:A,axis:E}}),onRemoveDac:v=>Se({type:"REMOVE_CLIP_DAC",payload:{layerIndex:Ze,colIndex:ct,dacIndex:v}}),onRemoveEffect:(v,S,A)=>Se({type:"REMOVE_CLIP_EFFECT",payload:{layerIndex:v,colIndex:S,effectIndex:A}}),onReorderEffects:(v,S,A,E)=>Se({type:"REORDER_CLIP_EFFECTS",payload:{layerIndex:v,colIndex:S,oldIndex:A,newIndex:E}}),onAddEffect:v=>Se({type:"ADD_CLIP_EFFECT",payload:{layerIndex:Ze,colIndex:ct,effect:v}}),onUpdateClipUiState:(v,S,A)=>Se({type:"UPDATE_CLIP_UI_STATE",payload:{layerIndex:v,colIndex:S,uiState:A}}),onParameterChange:Xr,onGeneratorParameterChange:Rr,progressRef:_,onAudioError:y}),Qt==="layer"&&f.jsx(Cv,{selectedLayerIndex:Ze,autopilotMode:Ze!==null?ke.layerAutopilots[Ze]:"off",onAutopilotChange:v=>Se({type:"SET_LAYER_AUTOPILOT",payload:{layerIndex:Ze,mode:v}}),layerEffects:Ze!==null?tr[Ze]:[],assignedDacs:Ze!==null&&ke.layerAssignedDacs?ke.layerAssignedDacs[Ze]:[],onToggleDacMirror:(v,S,A)=>Se({type:"TOGGLE_LAYER_DAC_MIRROR",payload:{layerIndex:v,dacIndex:S,axis:A}}),onRemoveDac:(v,S)=>Se({type:"REMOVE_LAYER_DAC",payload:{layerIndex:v,dacIndex:S}}),onAddEffect:v=>Ze!==null&&Se({type:"ADD_LAYER_EFFECT",payload:{layerIndex:Ze,effect:v}}),onRemoveEffect:v=>Ze!==null&&Se({type:"REMOVE_LAYER_EFFECT",payload:{layerIndex:Ze,effectIndex:v}}),onParamChange:(v,S,A)=>Ze!==null&&Se({type:"UPDATE_LAYER_EFFECT_PARAMETER",payload:{layerIndex:Ze,effectIndex:v,paramName:S,newValue:A}}),uiState:Ze!==null?ke.layerUiStates[Ze]:{},onUpdateUiState:v=>Se({type:"UPDATE_LAYER_UI_STATE",payload:{layerIndex:Ze,uiState:v}})})]})]}),f.jsx(yv,{dacs:Vn,onDacSelected:Ss,onDacsDiscovered:dl,dacSettings:Et,onUpdateDacSettings:ys}),f.jsx(Uv,{enabledShortcuts:xe,onOpenOutputSettings:()=>Ue(!0),onOpenShortcutsSettings:()=>ce(!0),quickAssigns:ke.quickAssigns,renderSettings:{showBeamEffect:ca,beamAlpha:ua,fadeAlpha:ba,previewScanRate:mn,beamRenderMode:kt,worldShowBeamEffect:gn,worldBeamRenderMode:Xn,settingsPanelCollapsed:ke.settingsPanelCollapsed,optimizationEnabled:ke.optimizationEnabled},onSetRenderSetting:(v,S)=>{Se(v==="optimizationEnabled"?{type:"SET_OPTIMIZATION_ENABLED",payload:S}:{type:"SET_RENDER_SETTING",payload:{setting:v,value:S}})},onUpdateKnob:(v,S)=>{ws("knob",v,S)},onToggleButton:v=>{Ci(v)},onAssign:(v,S,A)=>Se({type:"ASSIGN_QUICK_CONTROL",payload:{type:v,index:S,link:A}})})]}),f.jsx("div",{className:"SystemMonitor",children:f.jsx(Cw,{playbackFps:ta,previewScanRate:mn,previewFrameCountRef:Le,totalPointsSentRef:rt,activeChannelsCountRef:Wt,lastStatUpdateTimeRef:pn})})]})]})}):K==="shapeBuilder"?f.jsx(qv,{onBack:()=>Z("main")}):f.jsx(Vv,{onBack:()=>Z("main")})]})})})}N1.createRoot(document.getElementById("root")).render(f.jsx(Nv,{children:f.jsx(Wv,{children:f.jsxs(Zv,{children:[" ",f.jsx(pv,{children:f.jsx(Ev,{children:f.jsx(Nw,{})})})]})})}));
